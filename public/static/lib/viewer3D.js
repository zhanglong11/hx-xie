/*!
 * LMV v7.9.0
 * 
 * Copyright 2019 Bimfish, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Bimfish, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Bimfish, Inc.
 * 
 * Bimfish Forge Viewer Usage Limitations:
 * 
 * The Bimfish Forge viewer can only be used to view files generated by
 * Bimfish Forge services. The Bimfish Forge Viewer JavaScript must be
 * delivered from an Bimfish hosted URL.
 */
var LMV=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/index.js")}({"../workers/MainWorker-node":
/*!*****************************************!*\
  !*** external "\"DELETED_WORKERNODE\"" ***!
  \*****************************************/
/*! no static exports found */function(e,t){e.exports="DELETED_WORKERNODE"},"./extensions/DefaultTools/NavTools.js":
/*!*********************************************!*\
  !*** ./extensions/DefaultTools/NavTools.js ***!
  \*********************************************/
/*! exports provided: NavToolsExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"NavToolsExtension",(function(){return p}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js"),i=n(/*! ../../src/application/EventTypes */"./src/application/EventTypes.js"),o=n(/*! ../../src/gui/GuiViewerToolbarConst */"./src/gui/GuiViewerToolbarConst.js"),s=n(/*! ../../src/gui/controls/ComboButton */"./src/gui/controls/ComboButton.js"),a=n(/*! ../../src/gui/controls/Button */"./src/gui/controls/Button.js"),l=n(/*! ../../src/tools/FovTool */"./src/tools/FovTool.js"),c=n(/*! ../../src/tools/WorldUpTool */"./src/tools/WorldUpTool.js"),u=n(/*! ../../src/globalization/i18next */"./src/globalization/i18next.js"),d=n(/*! ../../src/gui/controls/RadioButtonGroup */"./src/gui/controls/RadioButtonGroup.js"),h=n(/*! ../../src/compat */"./src/compat.js"),f=n(/*! ../../src/gui/HudMessage */"./src/gui/HudMessage.js");function p(e,t){r.Extension.call(this,e,t),this.name="navtools",this.modes=["pan","dolly","freeorbit","orbit","fov","worldup","fittoview"],this.onToolChanged=this.onToolChanged.bind(this),this.onNavigationModeChanged=this.onNavigationModeChanged.bind(this)}p.prototype=Object.create(r.Extension.prototype),p.prototype.constructor=p;var m=p.prototype;function g(e,t,n){return function(){e.isActive(n)?e.deactivate():e.activate(n)}}m.load=function(){var e=this.viewer,t=new l.FovTool(e),n=new c.WorldUpTool(e.impl,e);return e.toolController.registerTool(t),e.toolController.registerTool(n),this.initFocalLengthOverlay(),e.addEventListener(i.TOOL_CHANGE_EVENT,this.onToolChanged),e.addEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationModeChanged),!0},m.updateUI=function(e){e!==this.is3d&&(this._destroyUI(),this._createUI(e))},m.onToolbarCreated=function(e){var t=this.viewer.model.is3d();this._createUI(t)},m._createUI=function(e){var t=this.viewer,n=t.getToolbar().getControl(o.TOOLBAR.NAVTOOLSID),r=function(e){return t.navigation.isActionEnabled(e)?"block":"none"};if(e){var i=new s.ComboButton("toolbar-orbitTools");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.setDisplay(r("orbit")),this.createOrbitSubmenu(i),n.addControl(i),n.orbittoolsbutton=i,i.setState(a.Button.State.ACTIVE),n.returnToDefault=function(){i.setState(a.Button.State.ACTIVE)}}var l=new a.Button("toolbar-panTool");l.setToolTip("Pan"),l.setIcon("adsk-icon-pan"),l.onClick=g(this,0,"pan"),console.log("点击平移"),l.setDisplay(r("pan")),n.addControl(l),n.panbutton=l,e||(n.returnToDefault=function(){l.setState(a.Button.State.ACTIVE)},n.returnToDefault());var c=new a.Button("toolbar-zoomTool");c.setToolTip("Zoom"),c.setIcon("adsk-icon-zoom"),c.onClick=g(this,0,"dolly"),c.setDisplay(r("zoom")),n.addControl(c),n.dollybutton=c;var u=new s.ComboButton("toolbar-cameraSubmenuTool");u.setToolTip("Camera interactions"),u.setIcon("adsk-icon-camera"),u.saveAsDefault(),this.createCameraSubmenu(u,e),n.addControl(u),n.camerabutton=u,this.is3d=e},m.createOrbitSubmenu=function(e){var t=this.viewer.getToolbar().getControl(o.TOOLBAR.NAVTOOLSID),n=new a.Button("toolbar-freeOrbitTool");n.setToolTip("Free orbit"),n.setIcon("adsk-icon-orbit-free"),n.onClick=g(this,0,"freeorbit"),e.addControl(n),t.freeorbitbutton=n;var r=new a.Button("toolbar-orbitTool");r.setToolTip("Orbit"),r.setIcon("adsk-icon-orbit-constrained"),r.onClick=g(this,0,"orbit"),e.addControl(r),t.orbitbutton=r,e.onClick=r.onClick},m.createCameraSubmenu=function(e,t){var n=this,r=this.viewer,i=r.getToolbar().getControl(o.TOOLBAR.NAVTOOLSID),s=function(e){return r.navigation.isActionEnabled(e)?"block":"none"};if(Object(h.isTouchDevice)()){var l=new a.Button("toolbar-homeTool");l.setToolTip("Home"),l.setIcon("adsk-icon-home"),l.onClick=function(){r.navigation.setRequestHomeView(!0);var t=r.getDefaultNavigationToolName();n.activate(t),e.restoreDefault()},l.setDisplay(s("gotoview")),e.addControl(l),i.homebutton=l}var c=new a.Button("toolbar-fitToViewTool");if(c.setToolTip("Fit to view"),c.setIcon("adsk-icon-fit-to-view"),c.onClick=function(t){r.impl.fitToView(r.impl.selector.getAggregateSelection());var n=r.getDefaultNavigationToolName();console.log(n),r.setActiveNavigationTool(n),e.restoreDefault()},c.setDisplay(s("gotoview")),e.addControl(c),i.fittoviewbutton=c,t){var u=new a.Button("toolbar-focalLengthTool");u.setToolTip("Focal length"),u.setIcon("adsk-icon-fov"),u.onClick=g(this,0,"fov"),u.setDisplay(s("fov")),e.addControl(u),i.fovbutton=u}var d=new a.Button("toolbar-rollTool");d.setToolTip("Roll"),d.setIcon("adsk-icon-roll"),d.onClick=g(this,0,"worldup"),d.setDisplay(s("roll")),e.addControl(d),i.rollbutton=d},m.onToolChanged=function(e){if("fov"===e.toolName&&this.showFocalLengthOverlay(e.active),e.active)switch(e.toolName){case"dolly":this.handleAltRelease("dollybutton");break;case"pan":this.handleAltRelease("panbutton");break;case"worldup":this.handleAltRelease("rollbutton");break;case"fov":this.handleAltRelease("fovbutton")}},m.onNavigationModeChanged=function(e){if(this.viewer.getDefaultNavigationToolName()===e.id){var t=this.viewer.getToolbar();if(!t)return;var n=t.getControl(o.TOOLBAR.NAVTOOLSID);if(!n)return;n.returnToDefault&&n.returnToDefault()}},m.handleAltRelease=function(e){var t=this.viewer.getToolbar();if(t){var n=t.getControl(o.TOOLBAR.NAVTOOLSID),r=n&&n[e];r&&r.setState(a.Button.State.ACTIVE)}},m.initFocalLengthOverlay=function(){var e=this.getDocument(),t=this.focallength=e.createElement("div");t.classList.add("message-panel"),t.classList.add("docking-panel"),t.classList.add("focal-length"),t.classList.add("docking-panel-container-solid-color-b");var n=e.createElement("table"),r=e.createElement("tbody");n.appendChild(r),t.appendChild(n),this.viewer.container.appendChild(t);var i=r.insertRow(-1),o=i.insertCell(0);o.classList.add("name"),o.setAttribute("data-i18n","Focal Length"),o.textContent=u.i18n.translate("Focal Length"),(o=i.insertCell(1)).classList.add("value"),o.textContent="",this.fovCell=o,t.style.visibility="hidden"},m.showFocalLengthOverlay=function(e){var t=this,n=this.viewer,r=0;function o(e){if(e){f.HudMessage.displayMessage(n.container,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."})}else f.HudMessage.dismiss()}function s(e){e&&a(),t.focallength&&(t.focallength.style.visibility=e?"visible":"hidden")}function a(){var e=n.getFocalLength();r!==e&&(r=e,t.fovCell.textContent=e.toString()+" mm")}function l(e){if(a(),"fov"===n.toolController.getActiveToolName()){var t=n.navigation.getCamera(),r=t&&!t.isPerspective;s(!r),o(r)}}var c=n.navigation.getCamera(),u=c&&!c.isPerspective;s(e&&!u),o(e&&u),e?n.addEventListener(i.CAMERA_CHANGE_EVENT,l):n.removeEventListener(i.CAMERA_CHANGE_EVENT,l)},m.unload=function(){return this._destroyUI(),!0},m._destroyUI=function(){var e=this.viewer,t=e.getToolbar();if(!t)return!0;var n=t.getControl(o.TOOLBAR.NAVTOOLSID);return!n||(this.is3d&&(n.orbittoolsbutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,n.orbittoolsbutton.subMenuActiveButtonChangedHandler(n)),n.removeControl(n.orbittoolsbutton.getId()),n.orbittoolsbutton.onClick=null,n.orbittoolsbutton=null,n.orbitbutton.onClick=null,n.orbitbutton=null,n.freeorbitbutton.onClick=null,n.freeorbitbutton=null,n.fovbutton.onClick=null,n.fovbutton=null),n.removeControl(n.panbutton.getId()),n.panbutton.onClick=null,n.panbutton=null,n.removeControl(n.dollybutton.getId()),n.dollybutton.onClick=null,n.dollybutton=null,n.camerabutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,n.camerabutton.subMenuActiveButtonChangedHandler(n)),n.removeControl(n.camerabutton.getId()),n.camerabutton.onClick=null,n.camerabutton=null,n.rollbutton.onClick=null,n.rollbutton=null,n.removeControl(n.fittoviewbutton.getId()),n.fittoviewbutton.onClick=null,n.fittoviewbutton=null,this.focallength&&(e.container.removeChild(this.focallength),this.focallength=null),e.removeEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,e.removeEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},m.activate=function(e){if(this.isActive(e))return!1;if("fittoview"===e)return this.viewer.impl.fitToView(this.viewer.impl.selector.getAggregateSelection()),!0;if(-1!=this.modes.indexOf(e)){var t=this.viewer.getDefaultNavigationToolName();return-1===this.modes.indexOf(t)&&this.viewer.activateDefaultNavigationTools(this.viewer.model.is2d()),this.viewer.setActiveNavigationTool(e),!0}return!1},m.deactivate=function(){return this.viewer.setActiveNavigationTool(),!0},m.isActive=function(e){return this.viewer.getActiveNavigationTool()===e}},"./extensions/Explode/Explode.js":
/*!***************************************!*\
  !*** ./extensions/Explode/Explode.js ***!
  \***************************************/
/*! exports provided: ExplodeExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"ExplodeExtension",(function(){return c}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js"),i=n(/*! ../../src/compat */"./src/compat.js"),o=n(/*! ../../src/gui/controls/Button */"./src/gui/controls/Button.js"),s=n(/*! ../../src/globals */"./src/globals.js"),a=n(/*! ../../src/logger/Logger */"./src/logger/Logger.js"),l=n(/*! ../../src/application/EventTypes */"./src/application/EventTypes.js");function c(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="explode",this.deactivate=this.deactivate.bind(this),this._onExplode=this._onExplode.bind(this),this._slider=null,this._explodeButton=null,this._explodeSubmenu=null,this._tooltip=null}c.prototype=Object.create(r.Extension.prototype),c.prototype.constructor=c;var u=c.prototype;function d(e){e._slider.parentNode.style.display="none",e._tooltip.style.display=""}u.load=function(){return!0},u.unload=function(){return this.deactivate(),function(e){var t=e.viewer;if(!e._slider)return;e._explodeButton&&e._explodeButton.removeFromParent();e._slider=null,e._explodeButton=null,e._explodeSubmenu=null,e._tooltip=null,t.explodeSlider=null,t.explodeSubmenu=null}(this),!0},u.onToolbarCreated=function(e){!function(e,t){Bimfish.Viewing.UI;var n=e.viewer,r=new o.Button("toolbar-explodeTool");r.setIcon("adsk-icon-explode"),r.setToolTip("Explode model"),n.modelTools.addControl(r);var l,c=Object(s.stringToDOM)('<div class="docking-panel docking-panel-container-solid-color-b explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>'),u=e.getDocument();Object(i.isIOSDevice)()?(l=u.querySelector("#toolbar-explodeTool").parentNode,c.classList.add("ios")):Object(i.isAndroidDevice)()?(l=u.querySelector("#toolbar-explodeTool").parentNode,c.classList.add("android")):l=r.container;l.appendChild(c);var d=c.querySelector(".explode-slider");d.addEventListener(i.isIE11?"change":"input",(function(e){n.explode(d.value)})),i.isIE11&&(d.style["padding-top"]="0",d.style["padding-bottom"]="0",d.style["margin-top"]="10px");c.onclick=function(e){e.stopPropagation()};var h=r.container.querySelector(".adsk-control-tooltip");r.onClick=function(t){e.isActive()?e.deactivate():(e.activate(),a.logger.track({category:"tool_changed",name:"explode"}))},e._slider=d,e._explodeButton=r,e._explodeSubmenu=c,e._tooltip=h,n.explodeSlider=d,n.explodeSubmenu=c}(this)},u.activate=function(){if(this.isActive())return!0;this._explodeSubmenu.style.display="",this._explodeButton.setState(o.Button.State.ACTIVE),this._tooltip.style.display="none";var e=this.viewer.impl.getExplodeScale();return this._slider.value=e,this.viewer.addEventListener(l.EXPLODE_CHANGE_EVENT,this._onExplode),!0},u.deactivate=function(){return!this.isActive()||(this._explodeButton.setState(o.Button.State.INACTIVE),d(this),this.viewer.explode(0),this.viewer.removeEventListener(l.EXPLODE_CHANGE_EVENT,this._onExplode),!0)},u.isActive=function(){return!!this._explodeSubmenu&&"none"!==this._explodeSubmenu.style.display},u._onExplode=function(e){this._slider.value=e.scale},u.setUIEnabled=function(e){this._explodeButton&&(e?(this._explodeButton.setState(Bimfish.Viewing.UI.Button.State.INACTIVE),this._wasActive&&this.activate()):(this._wasActive=this.isActive(),d(this),this._explodeButton.setState(Bimfish.Viewing.UI.Button.State.DISABLED)))}},"./extensions/FullScreen/FullScreen.js":
/*!*********************************************!*\
  !*** ./extensions/FullScreen/FullScreen.js ***!
  \*********************************************/
/*! exports provided: FullScreenExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"FullScreenExtension",(function(){return i}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js");function i(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="fullscreen"}i.prototype=Object.create(r.Extension.prototype),i.prototype.constructor=i;var o=i.prototype;o.activate=function(){return this.activeStatus||(this.viewer.nextScreenMode(),this.activeStatus=!0),!0},o.deactivate=function(){return this.activeStatus&&(this.viewer.escapeScreenMode(),this.activeStatus=!1),!0}},"./extensions/FusionOrbit/FusionOrbit.css":
/*!************************************************!*\
  !*** ./extensions/FusionOrbit/FusionOrbit.css ***!
  \************************************************/
/*! no static exports found */function(e,t,n){},"./extensions/FusionOrbit/FusionOrbit.js":
/*!***********************************************!*\
  !*** ./extensions/FusionOrbit/FusionOrbit.js ***!
  \***********************************************/
/*! exports provided: FusionOrbitExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"FusionOrbitExtension",(function(){return a}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js"),i=n(/*! ../../src/gui/GuiViewerToolbarConst */"./src/gui/GuiViewerToolbarConst.js"),o=n(/*! ../../src/gui/controls/Button */"./src/gui/controls/Button.js"),s=n(/*! ./FusionOrbitTool */"./extensions/FusionOrbit/FusionOrbitTool.js");n(/*! ./FusionOrbit.css */"./extensions/FusionOrbit/FusionOrbit.css");function a(e,t){r.Extension.call(this,e,t),this.name="fusionorbit",this.modes=["fusionorbit","fusionfreeorbit"]}a.prototype=Object.create(r.Extension.prototype),a.prototype.constructor=a;var l=a.prototype;l.load=function(){var e=this.viewer;return this.tool=new s.FusionOrbitTool,this.tool.setViewer(e),e.toolController.registerTool(this.tool),!0},l.onToolbarCreated=function(e){var t=this,n=this.viewer,r=e.getControl(i.TOOLBAR.NAVTOOLSID);r&&r.orbitbutton&&(this.classicBehavior={},this.classicBehavior.orbitOnClick=r.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=r.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=r.returnToDefault,r.freeorbitbutton.onClick=function(e){var n=r.freeorbitbutton.getState();n===o.Button.State.INACTIVE?(t.activate("fusionfreeorbit"),r.freeorbitbutton.setState(o.Button.State.ACTIVE)):n===o.Button.State.ACTIVE&&(t.deactivate(),r.freeorbitbutton.setState(o.Button.State.INACTIVE))},r.orbitbutton.onClick=function(e){var n=r.orbitbutton.getState();n===o.Button.State.INACTIVE?(t.activate("fusionorbit"),r.orbitbutton.setState(o.Button.State.ACTIVE)):n===o.Button.State.ACTIVE&&t.deactivate()},r.returnToDefault=function(){r.orbittoolsbutton&&r.orbittoolsbutton.setState(o.Button.State.ACTIVE)},r.orbittoolsbutton.setState(o.Button.State.INACTIVE),n.prefs.fusionOrbitConstrained?(r.orbittoolsbutton.onClick=r.orbitbutton.onClick,r.orbittoolsbutton.setIcon(r.orbitbutton.iconClass),n.setDefaultNavigationTool("orbit")):(r.orbittoolsbutton.onClick=r.freeorbitbutton.onClick,r.orbittoolsbutton.setIcon(r.freeorbitbutton.iconClass),n.setDefaultNavigationTool("freeorbit")),n.setActiveNavigationTool(),r.returnToDefault&&r.returnToDefault())},l.unload=function(){var e=this.viewer;if(this.classicBehavior){var t=e.getToolbar().getControl(i.TOOLBAR.NAVTOOLSID);t&&(t.orbitbutton&&(t.orbitbutton.onClick=this.classicBehavior.orbitOnClick),t.freeorbitbutton&&(t.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),t.returnToDefault=this.classicBehavior.returnToDefault,t.orbittoolsbutton&&(t.orbitbutton?t.orbittoolsbutton.onClick=t.orbitbutton.onClick:t.orbittoolsbutton.onClick=null,t.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),t.orbittoolsbutton.setState(o.Button.State.ACTIVE))),this.classicBehavior=null}return e.setActiveNavigationTool("orbit"),e.setDefaultNavigationTool("orbit"),e.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},l.activate=function(e){if(!this.activeStatus||this.mode!==e){switch(e){default:case"fusionorbit":this.viewer.setActiveNavigationTool("fusion orbit constrained"),this.mode="fusionorbit";break;case"fusionfreeorbit":this.viewer.setActiveNavigationTool("fusion orbit"),this.mode="fusionfreeorbit"}return this.activeStatus=!0,!0}},l.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0}},"./extensions/FusionOrbit/FusionOrbitTool.js":
/*!***************************************************!*\
  !*** ./extensions/FusionOrbit/FusionOrbitTool.js ***!
  \***************************************************/
/*! exports provided: FusionOrbitTool */function(e,t,n){"use strict";n.r(t),n.d(t,"FusionOrbitTool",(function(){return l}));var r=n(/*! ../../src/globals */"./src/globals.js"),i=n(/*! ../../src/compat */"./src/compat.js"),o=n(/*! ../../src/tools/Navigation */"./src/tools/Navigation.js"),s=Bimfish.Viewing,a=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n");function l(){var e,t,n,s,l,c=["fusion orbit","fusion orbit constrained"],u=0,d=1,h=2,f=.005,p=.005,m=1,g={},v=Object(i.isTouchDevice)(),y=!1,_={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},b=this;this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null,e&&this.setGlobalManager(e.globalManager)};var x=function(e){_.buttons[e.touches?0:e.button]=!0,_.src=e.target.className,_.x=0,_.y=0,_.dx=0,_.dy=0,_.firstMove=!0,_.mode=void 0,"ring"===_.src?_.mode=h:"edgemark-area"===_.src&&("layout-ver"===e.target.parentNode.className?_.mode=u:"layout-hor"===e.target.parentNode.className&&(_.mode=d)),T(),e.stopPropagation()},w=function(e){_.buttons[e.touches?0:e.button]=!1,_.src=void 0},E=function(e){_.buttons[0]&&(A(e),M(),_.firstMove=!1)},A=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,n=e.touches?e.touches[0].pageY:e.pageY;_.firstMove||(_.dx=t-_.x,_.dy=n-_.y),_.x=t,_.y=n},M=function(){switch(_.mode){case h:if(!b.navapi.isActionEnabled("roll"))return;break;case u:case d:if(!b.navapi.isActionEnabled("orbit"))return}var e=l.target.clone().sub(l.position).normalize(),t=e.clone().cross(l.up).normalize(),n=t.clone().cross(e).normalize();if(l.up.copy(n),_.mode===h){var r=new THREE.Vector3(_.x-g.center.x,_.y-g.center.y,0),i=new THREE.Vector3(_.dx,_.dy,0).add(r);r.normalize(),i.normalize();var a=r.clone().cross(i),c=Math.asin(a.z);l.up.applyAxisAngle(e,-c*m)}else{var v,y;_.mode===u?(y=-_.dx*f,s&&(l.up=o.Navigation.snapToAxis(l.up.clone())),v=l.up):_.mode===d&&(y=-_.dy*p,s?(_.firstMove&&(l.up=o.Navigation.snapToAxis(l.up.clone())),v=e.clone().cross(l.up).normalize()):v=t,l.up.applyAxisAngle(v,y));var x=b.navapi.getPivotPoint(),w=l.position.clone().sub(x);w.applyAxisAngle(v,y),l.position.addVectors(x,w);var E=l.target.clone().sub(x);E.applyAxisAngle(v,y),l.target.addVectors(x,E)}l.dirty=!0},S=function(e,t){var n=t||e.clone().sub(l.position).normalize();return new THREE.Plane(n,-n.x*e.x-n.y*e.y-n.z*e.z)},T=function(){var e=l.target.clone().sub(l.position).normalize(),t=S(l.position,e).distanceToPoint(l.pivot);l.pivot.copy(e).multiplyScalar(t).add(l.position)},C=function(e){e.touches||0!==e.button||T()},P=function(e){y&&b.viewer.setActiveNavigationTool()},L=function(e,t){var n,r=b.viewer.impl.hitTest(e,t);r&&r.intersectPoint?n=r.intersectPoint:n=b.viewer.impl.viewportToRay(b.viewer.impl.clientToViewport(e,t)).intersectPlane(S(l.target));var i=l.position.clone().sub(function(){var e=l.target.clone().sub(l.position).normalize(),t=b.viewer.impl.rayIntersect(new THREE.Ray(l.position,e));return t&&t.intersectPoint?t.intersectPoint:l.target}()).add(n);b.navapi.setRequestTransition(!0,i,n,l.fov)};this.register=function(){(e=Object(r.stringToDOM)(a)).style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),(t=e.querySelector(".ring")).addEventListener("mousedown",x),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),(function(e,t){e.addEventListener("mousedown",x),v&&e.addEventListener("touchstart",x)})),this.addWindowEventListener("mouseup",w),this.addWindowEventListener("mousemove",E),(n=e.querySelector(".outside")).addEventListener("mousedown",P);var i=e.querySelector(".circle");i.addEventListener("mousedown",C),v&&(t.addEventListener("touchstart",x),this.addWindowEventListener("touchend",w),this.addWindowEventListener("touchmove",E),n.addEventListener("touchstart",P),i.addEventListener("touchstart",C)),l=this.viewer.impl.camera},this.deregister=function(){this.removeWindowEventListener("mouseup",w),this.removeWindowEventListener("mousemove",E),n.removeEventListener("mousedown",P),v&&(this.removeWindowEventListener("touchend",w),this.removeWindowEventListener("touchmove",E),n.removeEventListener("touchstart",P)),this.viewer.canvasWrap.removeChild(e),e=void 0,t=void 0,n=void 0},this.activate=function(t){e.style.display="",this.handleResize(),s="fusion orbit constrained"===t;var n=this.viewer.toolController.isToolActivated("hyperlink");n&&this.viewer.toolController.deactivateTool("hyperlink"),s?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),n&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(t){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return c},this.getName=function(){return c[0]},this.update=function(){return!1},this.handleSingleClick=function(e,t){return L(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return L(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){var t=this.viewer.impl.getCanvasBoundingClientRect(),r=(t.width>t.height?new THREE.Vector2(((e.canvasX+.5)/t.width*2-1)*t.width/t.height,-(e.canvasY+.5)/t.height*2+1):new THREE.Vector2((e.canvasX+.5)/t.width*2-1,(-(e.canvasY+.5)/t.height*2+1)*t.height/t.width)).length()>1.2;return y!==r&&(n.style.cursor=r?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",y=r),!1},this.handleGesture=function(e){return T(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){var n=e.getBoundingClientRect(),r=this.getWindow();g.left=n.left+r.pageXOffset,g.top=n.top+r.pageYOffset,g.width=n.width,g.height=n.height,g.center={},g.center.x=g.left+g.width/2,g.center.y=g.top+g.height/2;var i=.8*(r.innerWidth>r.innerHeight?r.innerHeight:r.innerWidth);e.style.width=e.style.height=i+"px",e.style.top=e.style.left="calc(50% - "+i/2+"px)",t.style.borderWidth=.1*i+"px"}}s.GlobalManagerMixin.call(l.prototype)},"./extensions/GoHome/GoHome.js":
/*!*************************************!*\
  !*** ./extensions/GoHome/GoHome.js ***!
  \*************************************/
/*! exports provided: GoHomeExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"GoHomeExtension",(function(){return i}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js");function i(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="gohome"}i.prototype=Object.create(r.Extension.prototype),i.prototype.constructor=i;var o=i.prototype;o.activate=function(){return this.viewer.navigation.setRequestHomeView(!0),!0},o.deactivate=function(){return!1}},"./extensions/ModelStructure/ModelStructure.js":
/*!*****************************************************!*\
  !*** ./extensions/ModelStructure/ModelStructure.js ***!
  \*****************************************************/
/*! exports provided: ModelStructureExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelStructureExtension",(function(){return l}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js"),i=n(/*! ../../src/gui/ViewerModelStructurePanel */"./src/gui/ViewerModelStructurePanel.js"),o=n(/*! ../../src/compat */"./src/compat.js"),s=n(/*! ../../src/gui/controls/Button */"./src/gui/controls/Button.js"),a=n(/*! ../../src/application/EventTypes */"./src/application/EventTypes.js");function l(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="modelstructure",this._modelstructure=null,this._onLoadModel=this._onLoadModel.bind(this),this._onUnloadModel=this._onUnloadModel.bind(this)}l.prototype=Object.create(r.Extension.prototype),l.prototype.constructor=l;var c=l.prototype;c.load=function(){return this.viewer.addEventListener(a.MODEL_ADDED_EVENT,this._onLoadModel),this.viewer.addEventListener(a.MODEL_ROOT_LOADED_EVENT,this._onLoadModel),this.viewer.addEventListener(a.MODEL_UNLOADED_EVENT,this._onUnloadModel),this.viewer.addEventListener(a.MODEL_REMOVED_EVENT,this._onUnloadModel),!0},c.unload=function(){return this.deactivate(),this.setModelStructurePanel(null),this._structureButton&&(this.viewer.settingsTools.removeControl(this._structureButton),this.viewer.settingsTools.structurebutton=null,this._structureButton=null),this.viewer.removeEventListener(a.MODEL_ADDED_EVENT,this._onLoadModel),this.viewer.removeEventListener(a.MODEL_ROOT_LOADED_EVENT,this._onLoadModel),this.viewer.removeEventListener(a.MODEL_UNLOADED_EVENT,this._onUnloadModel),this.viewer.removeEventListener(a.MODEL_REMOVED_EVENT,this._onUnloadModel),!0},c.onToolbarCreated=function(e){var t=this,n=new s.Button("toolbar-modelStructureTool");n.setToolTip("Model browser"),n.setIcon("adsk-icon-structure"),n.onClick=function(e){!t._modelstructure.isVisible()?t.activate():t.deactivate()};var r=this.viewer.settingsTools;r.addControl(n,{index:0}),r.structurebutton=n,this._structureButton=n,this.restoreDefaultPanel()},c.activate=function(){return!!this._modelstructure&&(this._modelstructure.setVisible(!0),!0)},c.deactivate=function(){return this._modelstructure&&this._modelstructure.setVisible(!1),!0},c.isActive=function(){return!!this._modelstructure&&this._modelstructure.isVisible()},c.setModelStructurePanel=function(e){var t=this;if(e===this._modelstructure)return!1;if(this._modelstructure&&(this._modelstructure.setVisible(!1),this.viewer.removePanel(this._modelstructure),this._modelstructure.uninitialize()),this._modelstructure=e,this.viewer.modelstructure=e,!e)return!0;this.viewer.addPanel(this._modelstructure);for(var n=this.viewer.impl.modelQueue().getModels(),r=0;r<n.length;++r)this._modelstructure.addModel(n[r]);return this._modelstructure.addVisibilityListener((function(e){e&&t.viewer.onPanelVisible(t._modelstructure),t._structureButton.setState(e?s.Button.State.ACTIVE:s.Button.State.INACTIVE)})),!0},c.restoreDefaultPanel=function(){var e=this.viewer.config,t={docStructureConfig:e.docStructureConfig,hideSearch:Object(o.isMobileDevice)(),excludeRoot:e.modelBrowserExcludeRoot,startCollapsed:e.modelBrowserStartCollapsed},n=e.defaultModelStructureTitle||"Browser",r=new i.ViewerModelStructurePanel(this.viewer,n,t);this.setModelStructurePanel(r)},c._onLoadModel=function(e){this._modelstructure&&this._modelstructure.addModel(e.model)},c._onUnloadModel=function(e){this._modelstructure&&this._modelstructure.unloadModel(e.model)}},"./extensions/PropertiesManager/PropertiesManager.js":
/*!***********************************************************!*\
  !*** ./extensions/PropertiesManager/PropertiesManager.js ***!
  \***********************************************************/
/*! exports provided: PropertiesManagerExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"PropertiesManagerExtension",(function(){return c}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js"),i=n(/*! ../../src/gui/PropertyPanel */"./src/gui/PropertyPanel.js"),o=n(/*! ../../src/gui/ViewerPropertyPanel */"./src/gui/ViewerPropertyPanel.js"),s=n(/*! ../../src/gui/controls/Button */"./src/gui/controls/Button.js"),a=n(/*! ../../src/application/EventTypes */"./src/application/EventTypes.js"),l=n(/*! ../../src/application/PreferenceNames */"./src/application/PreferenceNames.js");function c(e,t){r.Extension.call(this,e,t),this.name="propertiesmanager",this._panel=null,this._onIsolateEvent=this._onIsolateEvent.bind(this),this._onSelectionChangeEvent=this._onSelectionChangeEvent.bind(this),this._onPrefChange=this._onPrefChange.bind(this)}c.prototype=Object.create(r.Extension.prototype),c.prototype.constructor=c;var u=c.prototype;u.load=function(){return this.viewer.addEventListener(a.ISOLATE_EVENT,this._onIsolateEvent),this.viewer.addEventListener(a.SELECTION_CHANGED_EVENT,this._onSelectionChangeEvent),this.viewer.prefs.addListeners(l.Prefs.OPEN_PROPERTIES_ON_SELECT,this._onPrefChange),!0},u.unload=function(){this.viewer.removeEventListener(a.ISOLATE_EVENT,this._onIsolateEvent),this.viewer.removeEventListener(a.SELECTION_CHANGED_EVENT,this._onSelectionChangeEvent),this.viewer.prefs.removeListeners(l.Prefs.OPEN_PROPERTIES_ON_SELECT,this._onPrefChange),this.deactivate(),this.setPanel(null),this._toolbarButton&&(this.viewer.settingsTools.removeControl(this._toolbarButton),this.viewer.settingsTools.propertiesbutton=null,this._toolbarButton=null)},u.onToolbarCreated=function(e){this.setDefaultPanel(),this._addToolbarButton()},u.activate=function(){return!!this._panel&&(this._panel.setVisible(!0),!0)},u.deactivate=function(){return this._panel&&this._panel.setVisible(!1),!0},u.isActive=function(){return!!this._panel&&this._panel.isVisible()},u.setPanel=function(e){var t=this;return(e instanceof i.PropertyPanel||!e)&&(this._panel&&(this._panel.setVisible(!1),this.viewer.removePanel(this._panel),this._panel.uninitialize()),this._panel=e,e&&(this.viewer.addPanel(e),e.addVisibilityListener((function(e){e&&t.viewer.onPanelVisible(t._panel),t._toolbarButton.setState(e?s.Button.State.ACTIVE:s.Button.State.INACTIVE)}))),!0)},u.setDefaultPanel=function(){this.setPanel(new o.ViewerPropertyPanel(this.viewer))},u.getPanel=function(){return this._panel},u.getToolbarButton=function(){return this._toolbarButton},u._addToolbarButton=function(){var e=this;if(!this._toolbarButton){var t=this._toolbarButton=new s.Button("toolbar-propertiesTool");t.setToolTip("Properties"),t.setIcon("adsk-icon-properties"),t.onClick=function(t){e._panel.setVisible(!e._panel.isVisible())},t.setVisible(!this.viewer.prefs.openPropertiesOnSelect),this.viewer.settingsTools.addControl(t,{index:1}),this.viewer.settingsTools.propertiesbutton=t}},u._onIsolateEvent=function(e){this._panel&&(this.viewer.prefs.openPropertiesOnSelect||e.nodeIdArray[0]===e.model.getRootId())&&this._panel.setVisible(e.nodeIdArray.length>0||this.viewer.impl.selector.hasSelection())},u._onSelectionChangeEvent=function(e){this.viewer.prefs.openPropertiesOnSelect&&(e.dbIdArray.length>0?this.activate():this.deactivate())},u._onPrefChange=function(e){this._toolbarButton&&this._toolbarButton.setVisible(!e)}},"./extensions/ViewerSettings/ViewerSettings.js":
/*!*****************************************************!*\
  !*** ./extensions/ViewerSettings/ViewerSettings.js ***!
  \*****************************************************/
/*! exports provided: ViewerSettingsExtension */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerSettingsExtension",(function(){return o}));var r=n(/*! ../../src/application/Extension */"./src/application/Extension.js"),i=n(/*! ../../src/gui/ViewerSettingsPanel */"./src/gui/ViewerSettingsPanel.js");function o(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="viewersettings"}o.prototype=Object.create(r.Extension.prototype),o.prototype.constructor=o;var s=o.prototype;s.activate=function(){this.activeStatus||(this.viewer.showViewer3dOptions(!0),this.viewer.getSettingsPanel(!0).selectTab(i.ViewerSettingTab.Performance),this.activeStatus=!0);return!0},s.deactivate=function(){return this.activeStatus&&(this.viewer.showViewer3dOptions(!1),this.activeStatus=!1),!0}},"./extensions/builtinExtensions.js":
/*!*****************************************!*\
  !*** ./extensions/builtinExtensions.js ***!
  \*****************************************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);var r=n(/*! ../src/application/ExtensionManager */"./src/application/ExtensionManager.js"),i=n(/*! ./PropertiesManager/PropertiesManager */"./extensions/PropertiesManager/PropertiesManager.js"),o=n(/*! ./ViewerSettings/ViewerSettings */"./extensions/ViewerSettings/ViewerSettings.js"),s=n(/*! ./ModelStructure/ModelStructure */"./extensions/ModelStructure/ModelStructure.js"),a=n(/*! ./DefaultTools/NavTools */"./extensions/DefaultTools/NavTools.js"),l=n(/*! ./Explode/Explode */"./extensions/Explode/Explode.js"),c=n(/*! ./FullScreen/FullScreen */"./extensions/FullScreen/FullScreen.js"),u=n(/*! ./GoHome/GoHome */"./extensions/GoHome/GoHome.js"),d=n(/*! ./FusionOrbit/FusionOrbit */"./extensions/FusionOrbit/FusionOrbit.js");r.theExtensionManager.registerExtension("Bimfish.PropertiesManager",i.PropertiesManagerExtension),r.theExtensionManager.registerExtension("Bimfish.ViewerSettings",o.ViewerSettingsExtension),r.theExtensionManager.registerExtension("Bimfish.ModelStructure",s.ModelStructureExtension),r.theExtensionManager.registerExtension("Bimfish.DefaultTools.NavTools",a.NavToolsExtension),r.theExtensionManager.registerExtension("Bimfish.Explode",l.ExplodeExtension),r.theExtensionManager.registerExtension("Bimfish.FullScreen",c.FullScreenExtension),r.theExtensionManager.registerExtension("Bimfish.GoHome",u.GoHomeExtension),r.theExtensionManager.registerExtension("Bimfish.Viewing.FusionOrbit",d.FusionOrbitExtension)},"./extensions/externalExtensions.js":
/*!******************************************!*\
  !*** ./extensions/externalExtensions.js ***!
  \******************************************/
/*! no static exports found */function(e,t){e.exports={externalExtensions:[{src:"./extensions/Wireframes/Wireframes.js",ids:["Bimfish.Viewing.Wireframes"]},{src:"./extensions/ZoomWindow/ZoomWindow.js",ids:["Bimfish.Viewing.ZoomWindow"]},{src:"./extensions/AEC/LibraryExports.js",ids:["Bimfish.AEC.LevelsExtension","Bimfish.AEC.HyperlinkExtension","Bimfish.AEC.DropMeExtension","Bimfish.AEC.CanvasBookmarkExtension","Bimfish.AEC.Minimap3DExtension"]},{src:"./extensions/Pushpins/PushPinExtension.js",ids:["Bimfish.BIM360.Extension.PushPin"]},{src:"./extensions/Hyperlink/Hyperlink.js",ids:["Bimfish.Hyperlink"]},{src:"./extensions/Debug/Debug.js",ids:["Bimfish.Debug"]},{src:"./extensions/BimWalk/BimWalk.js",ids:["Bimfish.BimWalk"]},{src:"./extensions/Section/Section.js",ids:["Bimfish.Section"]},{src:"./extensions/CompGeom/index.js",ids:["Bimfish.CompGeom"]},{src:"./extensions/Snapping/index.js",ids:["Bimfish.Snapping"]},{src:"./extensions/Beeline/Beeline.js",ids:["Bimfish.Beeline"]},{src:"./extensions/FirstPerson/FirstPerson.js",ids:["Bimfish.FirstPerson"]},{src:"./extensions/webVR/webVR.js",ids:["Bimfish.Viewing.WebVR"]},{src:"./extensions/CAM360/CAM360.js",ids:["Bimfish.CAM360"]},{src:"./extensions/Collaboration/Collaboration.js",ids:["Bimfish.Viewing.Collaboration"]},{src:"./extensions/FusionSim/FusionSim.js",ids:["Bimfish.Fusion360.Simulation"]},{src:"./extensions/OMV/OMV.js",ids:["Bimfish.OMV"]},{src:"./extensions/SplitScreen/SplitScreen.js",ids:["Bimfish.SplitScreen"]},{src:"./extensions/CrossFadeEffects/CrossFadeEffects.js",ids:["Bimfish.CrossFadeEffects"]},{src:"./extensions/Edit2D/Edit2D.js",ids:["Bimfish.Edit2D"]},{src:"./extensions/VisualClusters/VisualClusters.js",ids:["Bimfish.VisualClusters"]},{src:"./extensions/Moldflow/Moldflow.js",ids:["Bimfish.Moldflow"]},{src:"./extensions/PixelCompare/PixelCompare.js",ids:["Bimfish.Viewing.PixelCompare"]},{src:"./extensions/ScalarisSimulation/ScalarisSimulation.js",ids:["Bimfish.Viewing.ScalarisSimulation"]},{src:"./extensions/Measure/Measure.js",ids:["Bimfish.Measure"]},{src:"./extensions/Markup/Markup.js",ids:["Bimfish.Viewing.MarkupsCore","Bimfish.Viewing.MarkupsGui"]},{src:"./extensions/PDF/index.js",ids:["Bimfish.PDF"]},{src:"./extensions/Scalaris/index.js",ids:["Bimfish.Scalaris"]},{src:"./extensions/DocumentBrowser/index.js",ids:["Bimfish.DocumentBrowser"]},{src:"./extensions/Geolocation/index.js",ids:["Bimfish.Geolocation"]},{src:"./extensions/Fusion360/AnimationExtension.js",ids:["Bimfish.Fusion360.Animation"]},{src:"./extensions/NPR/index.js",ids:["Bimfish.NPR"]},{src:"./extensions/MSDF/index.js",ids:["Bimfish.MSDF"]},{src:"./extensions/MemoryLimited/MemoryLimited.js",ids:["Bimfish.MemoryLimited"]},{src:"./extensions/ViewCubeUi/ViewCubeUi.js",ids:["Bimfish.ViewCubeUi"]},{src:"./extensions/MemoryLimitedDebug/MemoryManager.js",ids:["Bimfish.Viewing.MemoryLimitedDebug"]},{src:"./extensions/BimMarkups/BimMarkups.js",ids:["Bimfish.BIM360.Markups"]},{src:"./extensions/Minimap2D/Minimap2D.js",ids:["Bimfish.BIM360.Minimap"]},{src:"./extensions/GestureDocumentNavigation/GestureDocumentNavigation.js",ids:["Bimfish.BIM360.GestureDocumentNavigation"]},{src:"./extensions/RollCamera/RollCamera.js",ids:["Bimfish.BIM360.RollCamera"]},{src:"./extensions/LayerManager/LayerManager.js",ids:["Bimfish.LayerManager"]},{src:"./extensions/SceneBuilder/sceneBuilder.js",ids:["Bimfish.Viewing.SceneBuilder"]},{src:"./extensions/Popout/index.js",ids:["Bimfish.Viewing.Popout"]},{src:"./extensions/ProfileUi/index.js",ids:["Bimfish.ProfileUi"]},{src:"./extensions/PropertySearch/PropertySearch.js",ids:["Bimfish.PropertySearch"]}],getExtensionEntryKey:function(e){return e.src.split("/")[2]}}},"./extensions/registerExternalExtensions.js":
/*!**************************************************!*\
  !*** ./extensions/registerExternalExtensions.js ***!
  \**************************************************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);var r=n(/*! ../src/application/ExtensionManager */"./src/application/ExtensionManager.js"),i=n(/*! ./externalExtensions */"./extensions/externalExtensions.js");i.externalExtensions.forEach((function(e){var t=Object(i.getExtensionEntryKey)(e),n="extensions/".concat(t,"/").concat(t,".").concat("js");e.ids.forEach((function(e){r.theExtensionManager.registerExternalExtension(e,n)}))})),r.theExtensionManager.registerExternalExtension("Bimfish.DiffTool","extensions/DiffTool/DiffTool.".concat("js"))},"./node_modules/@babel/polyfill/lib/index.js":
/*!***************************************************!*\
  !*** ./node_modules/@babel/polyfill/lib/index.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./noConflict */"./node_modules/@babel/polyfill/lib/noConflict.js");var r,i=(r=n(/*! core-js/library/fn/global */"./node_modules/core-js/library/fn/global.js"))&&r.__esModule?r:{default:r};i.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),i.default._babelPolyfill=!0},"./node_modules/@babel/polyfill/lib/noConflict.js":
/*!********************************************************!*\
  !*** ./node_modules/@babel/polyfill/lib/noConflict.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! core-js/es6 */"./node_modules/core-js/es6/index.js"),n(/*! core-js/fn/array/includes */"./node_modules/core-js/fn/array/includes.js"),n(/*! core-js/fn/array/flat-map */"./node_modules/core-js/fn/array/flat-map.js"),n(/*! core-js/fn/string/pad-start */"./node_modules/core-js/fn/string/pad-start.js"),n(/*! core-js/fn/string/pad-end */"./node_modules/core-js/fn/string/pad-end.js"),n(/*! core-js/fn/string/trim-start */"./node_modules/core-js/fn/string/trim-start.js"),n(/*! core-js/fn/string/trim-end */"./node_modules/core-js/fn/string/trim-end.js"),n(/*! core-js/fn/symbol/async-iterator */"./node_modules/core-js/fn/symbol/async-iterator.js"),n(/*! core-js/fn/object/get-own-property-descriptors */"./node_modules/core-js/fn/object/get-own-property-descriptors.js"),n(/*! core-js/fn/object/values */"./node_modules/core-js/fn/object/values.js"),n(/*! core-js/fn/object/entries */"./node_modules/core-js/fn/object/entries.js"),n(/*! core-js/fn/promise/finally */"./node_modules/core-js/fn/promise/finally.js"),n(/*! core-js/web */"./node_modules/core-js/web/index.js"),n(/*! regenerator-runtime/runtime */"./node_modules/regenerator-runtime/runtime.js")},"./node_modules/clusterize.js/clusterize.js":
/*!**************************************************!*\
  !*** ./node_modules/clusterize.js/clusterize.js ***!
  \**************************************************/
/*! no static exports found */function(e,t,n){e.exports=function(){"use strict";var e=function(){for(var e=3,t=document.createElement("b"),n=t.all||[];t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i><![endif]--\x3e",n[0];);return e>4?e:document.documentMode}(),t=navigator.platform.toLowerCase().indexOf("mac")+1,n=function(e){if(!(this instanceof n))return new n(e);var s=this,a={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};s.options={};for(var l,c=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],u=0;l=c[u];u++)s.options[l]=void 0!==e[l]&&null!=e[l]?e[l]:a[l];var d,h=["scroll","content"];for(u=0;d=h[u];u++)if(s[d+"_elem"]=e[d+"Id"]?document.getElementById(e[d+"Id"]):e[d+"Elem"],!s[d+"_elem"])throw new Error("Error! Could not find "+d+" element");s.content_elem.hasAttribute("tabindex")||s.content_elem.setAttribute("tabindex",0);var f=o(e.rows)?e.rows:s.fetchMarkup(),p={},m=s.scroll_elem.scrollTop;s.insertToDOM(f,p),s.scroll_elem.scrollTop=m;var g=!1,v=0,y=!1,_=function(){t&&(y||(s.content_elem.style.pointerEvents="none"),y=!0,clearTimeout(v),v=setTimeout((function(){s.content_elem.style.pointerEvents="auto",y=!1}),50)),g!=(g=s.getClusterNum())&&s.insertToDOM(f,p),s.options.callbacks.scrollingProgress&&s.options.callbacks.scrollingProgress(s.getScrollProgress())},b=0,x=function(){clearTimeout(b),b=setTimeout(s.refresh,100)};r("scroll",s.scroll_elem,_),r("resize",window,x),s.destroy=function(e){i("scroll",s.scroll_elem,_),i("resize",window,x),s.html((e?s.generateEmptyRow():f).join(""))},s.refresh=function(e){(s.getRowsHeight(f)||e)&&s.update(f)},s.update=function(e){f=o(e)?e:[];var t=s.scroll_elem.scrollTop;f.length*s.options.item_height<t&&(s.scroll_elem.scrollTop=0,g=0),s.insertToDOM(f,p),s.scroll_elem.scrollTop=t},s.clear=function(){s.update([])},s.getRowsAmount=function(){return f.length},s.getScrollProgress=function(){return this.options.scroll_top/(f.length*this.options.item_height)*100||0};var w=function(e,t){var n=o(t)?t:[];n.length&&(f="append"==e?f.concat(n):n.concat(f),s.insertToDOM(f,p))};s.append=function(e){w("append",e)},s.prepend=function(e){w("prepend",e)}};function r(e,t,n){return t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)}function i(e,t,n){return t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n)}function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}return n.prototype={constructor:n,fetchMarkup:function(){for(var e=[],t=this.getChildNodes(this.content_elem);t.length;)e.push(t.shift().outerHTML);return e},exploreEnvironment:function(t,n){var r=this.options;r.content_tag=this.content_elem.tagName.toLowerCase(),t.length&&(e&&e<=9&&!r.tag&&(r.tag=t[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(n.data=this.html(t[0]+t[0]+t[0])),r.tag||(r.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(t))},getRowsHeight:function(e){var t=this.options,n=t.item_height;if(t.cluster_height=0,e.length){var r=this.content_elem.children;if(r.length){var i=r[Math.floor(r.length/2)];if(t.item_height=i.offsetHeight,"tr"==t.tag&&"collapse"!=s("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(s("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){var o=parseInt(s("marginTop",i),10)||0,a=parseInt(s("marginBottom",i),10)||0;t.item_height+=Math.max(o,a)}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,n!=t.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var e=this.options;if(!e.tag||!e.show_no_data_row)return[];var t,n=document.createElement(e.tag),r=document.createTextNode(e.no_data_text);return n.className=e.no_data_class,"tr"==e.tag&&((t=document.createElement("td")).colSpan=100,t.appendChild(r)),n.appendChild(t||r),[n.outerHTML]},generate:function(e,t){var n=this.options,r=e.length;if(r<n.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:r?e:this.generateEmptyRow()};var i=Math.max((n.rows_in_cluster-n.rows_in_block)*t,0),o=i+n.rows_in_cluster,s=Math.max(i*n.item_height,0),a=Math.max((r-o)*n.item_height,0),l=[],c=i;s<1&&c++;for(var u=i;u<o;u++)e[u]&&l.push(e[u]);return{top_offset:s,bottom_offset:a,rows_above:c,rows:l}},renderExtraTag:function(e,t){var n=document.createElement(this.options.tag);return n.className=["clusterize-extra-row","clusterize-"+e].join(" "),t&&(n.style.height=t+"px"),n.outerHTML},insertToDOM:function(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);var n=this.generate(e,this.getClusterNum()),r=n.rows.join(""),i=this.checkChanges("data",r,t),o=this.checkChanges("top",n.top_offset,t),s=this.checkChanges("bottom",n.bottom_offset,t),a=this.options.callbacks,l=[];i||o?(n.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",n.top_offset))),l.push(r),n.bottom_offset&&l.push(this.renderExtraTag("bottom-space",n.bottom_offset)),a.clusterWillChange&&a.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",n.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(n.rows_above-1),a.clusterChanged&&a.clusterChanged()):s&&(this.content_elem.lastChild.style.height=n.bottom_offset+"px")},html:function(t){var n=this.content_elem;if(e&&e<=9&&"tr"==this.options.tag){var r,i=document.createElement("div");for(i.innerHTML="<table><tbody>"+t+"</tbody></table>";r=n.lastChild;)n.removeChild(r);for(var o=this.getChildNodes(i.firstChild.firstChild);o.length;)n.appendChild(o.shift())}else n.innerHTML=t},getChildNodes:function(e){for(var t=e.children,n=[],r=0,i=t.length;r<i;r++)n.push(t[r]);return n},checkChanges:function(e,t,n){var r=t!=n[e];return n[e]=t,r}},n}()},"./node_modules/core-js/es6/index.js":
/*!*******************************************!*\
  !*** ./node_modules/core-js/es6/index.js ***!
  \*******************************************/
/*! no static exports found */function(e,t,n){n(/*! ../modules/es6.symbol */"./node_modules/core-js/modules/es6.symbol.js"),n(/*! ../modules/es6.object.create */"./node_modules/core-js/modules/es6.object.create.js"),n(/*! ../modules/es6.object.define-property */"./node_modules/core-js/modules/es6.object.define-property.js"),n(/*! ../modules/es6.object.define-properties */"./node_modules/core-js/modules/es6.object.define-properties.js"),n(/*! ../modules/es6.object.get-own-property-descriptor */"./node_modules/core-js/modules/es6.object.get-own-property-descriptor.js"),n(/*! ../modules/es6.object.get-prototype-of */"./node_modules/core-js/modules/es6.object.get-prototype-of.js"),n(/*! ../modules/es6.object.keys */"./node_modules/core-js/modules/es6.object.keys.js"),n(/*! ../modules/es6.object.get-own-property-names */"./node_modules/core-js/modules/es6.object.get-own-property-names.js"),n(/*! ../modules/es6.object.freeze */"./node_modules/core-js/modules/es6.object.freeze.js"),n(/*! ../modules/es6.object.seal */"./node_modules/core-js/modules/es6.object.seal.js"),n(/*! ../modules/es6.object.prevent-extensions */"./node_modules/core-js/modules/es6.object.prevent-extensions.js"),n(/*! ../modules/es6.object.is-frozen */"./node_modules/core-js/modules/es6.object.is-frozen.js"),n(/*! ../modules/es6.object.is-sealed */"./node_modules/core-js/modules/es6.object.is-sealed.js"),n(/*! ../modules/es6.object.is-extensible */"./node_modules/core-js/modules/es6.object.is-extensible.js"),n(/*! ../modules/es6.object.assign */"./node_modules/core-js/modules/es6.object.assign.js"),n(/*! ../modules/es6.object.is */"./node_modules/core-js/modules/es6.object.is.js"),n(/*! ../modules/es6.object.set-prototype-of */"./node_modules/core-js/modules/es6.object.set-prototype-of.js"),n(/*! ../modules/es6.object.to-string */"./node_modules/core-js/modules/es6.object.to-string.js"),n(/*! ../modules/es6.function.bind */"./node_modules/core-js/modules/es6.function.bind.js"),n(/*! ../modules/es6.function.name */"./node_modules/core-js/modules/es6.function.name.js"),n(/*! ../modules/es6.function.has-instance */"./node_modules/core-js/modules/es6.function.has-instance.js"),n(/*! ../modules/es6.parse-int */"./node_modules/core-js/modules/es6.parse-int.js"),n(/*! ../modules/es6.parse-float */"./node_modules/core-js/modules/es6.parse-float.js"),n(/*! ../modules/es6.number.constructor */"./node_modules/core-js/modules/es6.number.constructor.js"),n(/*! ../modules/es6.number.to-fixed */"./node_modules/core-js/modules/es6.number.to-fixed.js"),n(/*! ../modules/es6.number.to-precision */"./node_modules/core-js/modules/es6.number.to-precision.js"),n(/*! ../modules/es6.number.epsilon */"./node_modules/core-js/modules/es6.number.epsilon.js"),n(/*! ../modules/es6.number.is-finite */"./node_modules/core-js/modules/es6.number.is-finite.js"),n(/*! ../modules/es6.number.is-integer */"./node_modules/core-js/modules/es6.number.is-integer.js"),n(/*! ../modules/es6.number.is-nan */"./node_modules/core-js/modules/es6.number.is-nan.js"),n(/*! ../modules/es6.number.is-safe-integer */"./node_modules/core-js/modules/es6.number.is-safe-integer.js"),n(/*! ../modules/es6.number.max-safe-integer */"./node_modules/core-js/modules/es6.number.max-safe-integer.js"),n(/*! ../modules/es6.number.min-safe-integer */"./node_modules/core-js/modules/es6.number.min-safe-integer.js"),n(/*! ../modules/es6.number.parse-float */"./node_modules/core-js/modules/es6.number.parse-float.js"),n(/*! ../modules/es6.number.parse-int */"./node_modules/core-js/modules/es6.number.parse-int.js"),n(/*! ../modules/es6.math.acosh */"./node_modules/core-js/modules/es6.math.acosh.js"),n(/*! ../modules/es6.math.asinh */"./node_modules/core-js/modules/es6.math.asinh.js"),n(/*! ../modules/es6.math.atanh */"./node_modules/core-js/modules/es6.math.atanh.js"),n(/*! ../modules/es6.math.cbrt */"./node_modules/core-js/modules/es6.math.cbrt.js"),n(/*! ../modules/es6.math.clz32 */"./node_modules/core-js/modules/es6.math.clz32.js"),n(/*! ../modules/es6.math.cosh */"./node_modules/core-js/modules/es6.math.cosh.js"),n(/*! ../modules/es6.math.expm1 */"./node_modules/core-js/modules/es6.math.expm1.js"),n(/*! ../modules/es6.math.fround */"./node_modules/core-js/modules/es6.math.fround.js"),n(/*! ../modules/es6.math.hypot */"./node_modules/core-js/modules/es6.math.hypot.js"),n(/*! ../modules/es6.math.imul */"./node_modules/core-js/modules/es6.math.imul.js"),n(/*! ../modules/es6.math.log10 */"./node_modules/core-js/modules/es6.math.log10.js"),n(/*! ../modules/es6.math.log1p */"./node_modules/core-js/modules/es6.math.log1p.js"),n(/*! ../modules/es6.math.log2 */"./node_modules/core-js/modules/es6.math.log2.js"),n(/*! ../modules/es6.math.sign */"./node_modules/core-js/modules/es6.math.sign.js"),n(/*! ../modules/es6.math.sinh */"./node_modules/core-js/modules/es6.math.sinh.js"),n(/*! ../modules/es6.math.tanh */"./node_modules/core-js/modules/es6.math.tanh.js"),n(/*! ../modules/es6.math.trunc */"./node_modules/core-js/modules/es6.math.trunc.js"),n(/*! ../modules/es6.string.from-code-point */"./node_modules/core-js/modules/es6.string.from-code-point.js"),n(/*! ../modules/es6.string.raw */"./node_modules/core-js/modules/es6.string.raw.js"),n(/*! ../modules/es6.string.trim */"./node_modules/core-js/modules/es6.string.trim.js"),n(/*! ../modules/es6.string.iterator */"./node_modules/core-js/modules/es6.string.iterator.js"),n(/*! ../modules/es6.string.code-point-at */"./node_modules/core-js/modules/es6.string.code-point-at.js"),n(/*! ../modules/es6.string.ends-with */"./node_modules/core-js/modules/es6.string.ends-with.js"),n(/*! ../modules/es6.string.includes */"./node_modules/core-js/modules/es6.string.includes.js"),n(/*! ../modules/es6.string.repeat */"./node_modules/core-js/modules/es6.string.repeat.js"),n(/*! ../modules/es6.string.starts-with */"./node_modules/core-js/modules/es6.string.starts-with.js"),n(/*! ../modules/es6.string.anchor */"./node_modules/core-js/modules/es6.string.anchor.js"),n(/*! ../modules/es6.string.big */"./node_modules/core-js/modules/es6.string.big.js"),n(/*! ../modules/es6.string.blink */"./node_modules/core-js/modules/es6.string.blink.js"),n(/*! ../modules/es6.string.bold */"./node_modules/core-js/modules/es6.string.bold.js"),n(/*! ../modules/es6.string.fixed */"./node_modules/core-js/modules/es6.string.fixed.js"),n(/*! ../modules/es6.string.fontcolor */"./node_modules/core-js/modules/es6.string.fontcolor.js"),n(/*! ../modules/es6.string.fontsize */"./node_modules/core-js/modules/es6.string.fontsize.js"),n(/*! ../modules/es6.string.italics */"./node_modules/core-js/modules/es6.string.italics.js"),n(/*! ../modules/es6.string.link */"./node_modules/core-js/modules/es6.string.link.js"),n(/*! ../modules/es6.string.small */"./node_modules/core-js/modules/es6.string.small.js"),n(/*! ../modules/es6.string.strike */"./node_modules/core-js/modules/es6.string.strike.js"),n(/*! ../modules/es6.string.sub */"./node_modules/core-js/modules/es6.string.sub.js"),n(/*! ../modules/es6.string.sup */"./node_modules/core-js/modules/es6.string.sup.js"),n(/*! ../modules/es6.date.now */"./node_modules/core-js/modules/es6.date.now.js"),n(/*! ../modules/es6.date.to-json */"./node_modules/core-js/modules/es6.date.to-json.js"),n(/*! ../modules/es6.date.to-iso-string */"./node_modules/core-js/modules/es6.date.to-iso-string.js"),n(/*! ../modules/es6.date.to-string */"./node_modules/core-js/modules/es6.date.to-string.js"),n(/*! ../modules/es6.date.to-primitive */"./node_modules/core-js/modules/es6.date.to-primitive.js"),n(/*! ../modules/es6.array.is-array */"./node_modules/core-js/modules/es6.array.is-array.js"),n(/*! ../modules/es6.array.from */"./node_modules/core-js/modules/es6.array.from.js"),n(/*! ../modules/es6.array.of */"./node_modules/core-js/modules/es6.array.of.js"),n(/*! ../modules/es6.array.join */"./node_modules/core-js/modules/es6.array.join.js"),n(/*! ../modules/es6.array.slice */"./node_modules/core-js/modules/es6.array.slice.js"),n(/*! ../modules/es6.array.sort */"./node_modules/core-js/modules/es6.array.sort.js"),n(/*! ../modules/es6.array.for-each */"./node_modules/core-js/modules/es6.array.for-each.js"),n(/*! ../modules/es6.array.map */"./node_modules/core-js/modules/es6.array.map.js"),n(/*! ../modules/es6.array.filter */"./node_modules/core-js/modules/es6.array.filter.js"),n(/*! ../modules/es6.array.some */"./node_modules/core-js/modules/es6.array.some.js"),n(/*! ../modules/es6.array.every */"./node_modules/core-js/modules/es6.array.every.js"),n(/*! ../modules/es6.array.reduce */"./node_modules/core-js/modules/es6.array.reduce.js"),n(/*! ../modules/es6.array.reduce-right */"./node_modules/core-js/modules/es6.array.reduce-right.js"),n(/*! ../modules/es6.array.index-of */"./node_modules/core-js/modules/es6.array.index-of.js"),n(/*! ../modules/es6.array.last-index-of */"./node_modules/core-js/modules/es6.array.last-index-of.js"),n(/*! ../modules/es6.array.copy-within */"./node_modules/core-js/modules/es6.array.copy-within.js"),n(/*! ../modules/es6.array.fill */"./node_modules/core-js/modules/es6.array.fill.js"),n(/*! ../modules/es6.array.find */"./node_modules/core-js/modules/es6.array.find.js"),n(/*! ../modules/es6.array.find-index */"./node_modules/core-js/modules/es6.array.find-index.js"),n(/*! ../modules/es6.array.species */"./node_modules/core-js/modules/es6.array.species.js"),n(/*! ../modules/es6.array.iterator */"./node_modules/core-js/modules/es6.array.iterator.js"),n(/*! ../modules/es6.regexp.constructor */"./node_modules/core-js/modules/es6.regexp.constructor.js"),n(/*! ../modules/es6.regexp.exec */"./node_modules/core-js/modules/es6.regexp.exec.js"),n(/*! ../modules/es6.regexp.to-string */"./node_modules/core-js/modules/es6.regexp.to-string.js"),n(/*! ../modules/es6.regexp.flags */"./node_modules/core-js/modules/es6.regexp.flags.js"),n(/*! ../modules/es6.regexp.match */"./node_modules/core-js/modules/es6.regexp.match.js"),n(/*! ../modules/es6.regexp.replace */"./node_modules/core-js/modules/es6.regexp.replace.js"),n(/*! ../modules/es6.regexp.search */"./node_modules/core-js/modules/es6.regexp.search.js"),n(/*! ../modules/es6.regexp.split */"./node_modules/core-js/modules/es6.regexp.split.js"),n(/*! ../modules/es6.promise */"./node_modules/core-js/modules/es6.promise.js"),n(/*! ../modules/es6.map */"./node_modules/core-js/modules/es6.map.js"),n(/*! ../modules/es6.set */"./node_modules/core-js/modules/es6.set.js"),n(/*! ../modules/es6.weak-map */"./node_modules/core-js/modules/es6.weak-map.js"),n(/*! ../modules/es6.weak-set */"./node_modules/core-js/modules/es6.weak-set.js"),n(/*! ../modules/es6.typed.array-buffer */"./node_modules/core-js/modules/es6.typed.array-buffer.js"),n(/*! ../modules/es6.typed.data-view */"./node_modules/core-js/modules/es6.typed.data-view.js"),n(/*! ../modules/es6.typed.int8-array */"./node_modules/core-js/modules/es6.typed.int8-array.js"),n(/*! ../modules/es6.typed.uint8-array */"./node_modules/core-js/modules/es6.typed.uint8-array.js"),n(/*! ../modules/es6.typed.uint8-clamped-array */"./node_modules/core-js/modules/es6.typed.uint8-clamped-array.js"),n(/*! ../modules/es6.typed.int16-array */"./node_modules/core-js/modules/es6.typed.int16-array.js"),n(/*! ../modules/es6.typed.uint16-array */"./node_modules/core-js/modules/es6.typed.uint16-array.js"),n(/*! ../modules/es6.typed.int32-array */"./node_modules/core-js/modules/es6.typed.int32-array.js"),n(/*! ../modules/es6.typed.uint32-array */"./node_modules/core-js/modules/es6.typed.uint32-array.js"),n(/*! ../modules/es6.typed.float32-array */"./node_modules/core-js/modules/es6.typed.float32-array.js"),n(/*! ../modules/es6.typed.float64-array */"./node_modules/core-js/modules/es6.typed.float64-array.js"),n(/*! ../modules/es6.reflect.apply */"./node_modules/core-js/modules/es6.reflect.apply.js"),n(/*! ../modules/es6.reflect.construct */"./node_modules/core-js/modules/es6.reflect.construct.js"),n(/*! ../modules/es6.reflect.define-property */"./node_modules/core-js/modules/es6.reflect.define-property.js"),n(/*! ../modules/es6.reflect.delete-property */"./node_modules/core-js/modules/es6.reflect.delete-property.js"),n(/*! ../modules/es6.reflect.enumerate */"./node_modules/core-js/modules/es6.reflect.enumerate.js"),n(/*! ../modules/es6.reflect.get */"./node_modules/core-js/modules/es6.reflect.get.js"),n(/*! ../modules/es6.reflect.get-own-property-descriptor */"./node_modules/core-js/modules/es6.reflect.get-own-property-descriptor.js"),n(/*! ../modules/es6.reflect.get-prototype-of */"./node_modules/core-js/modules/es6.reflect.get-prototype-of.js"),n(/*! ../modules/es6.reflect.has */"./node_modules/core-js/modules/es6.reflect.has.js"),n(/*! ../modules/es6.reflect.is-extensible */"./node_modules/core-js/modules/es6.reflect.is-extensible.js"),n(/*! ../modules/es6.reflect.own-keys */"./node_modules/core-js/modules/es6.reflect.own-keys.js"),n(/*! ../modules/es6.reflect.prevent-extensions */"./node_modules/core-js/modules/es6.reflect.prevent-extensions.js"),n(/*! ../modules/es6.reflect.set */"./node_modules/core-js/modules/es6.reflect.set.js"),n(/*! ../modules/es6.reflect.set-prototype-of */"./node_modules/core-js/modules/es6.reflect.set-prototype-of.js"),e.exports=n(/*! ../modules/_core */"./node_modules/core-js/modules/_core.js")},"./node_modules/core-js/fn/array/flat-map.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/fn/array/flat-map.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.array.flat-map */"./node_modules/core-js/modules/es7.array.flat-map.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").Array.flatMap},"./node_modules/core-js/fn/array/includes.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/fn/array/includes.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.array.includes */"./node_modules/core-js/modules/es7.array.includes.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").Array.includes},"./node_modules/core-js/fn/object/entries.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/fn/object/entries.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.object.entries */"./node_modules/core-js/modules/es7.object.entries.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").Object.entries},"./node_modules/core-js/fn/object/get-own-property-descriptors.js":
/*!************************************************************************!*\
  !*** ./node_modules/core-js/fn/object/get-own-property-descriptors.js ***!
  \************************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.object.get-own-property-descriptors */"./node_modules/core-js/modules/es7.object.get-own-property-descriptors.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").Object.getOwnPropertyDescriptors},"./node_modules/core-js/fn/object/values.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/fn/object/values.js ***!
  \**************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.object.values */"./node_modules/core-js/modules/es7.object.values.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").Object.values},"./node_modules/core-js/fn/promise/finally.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/fn/promise/finally.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ../../modules/es6.promise */"./node_modules/core-js/modules/es6.promise.js"),n(/*! ../../modules/es7.promise.finally */"./node_modules/core-js/modules/es7.promise.finally.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").Promise.finally},"./node_modules/core-js/fn/string/pad-end.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/fn/string/pad-end.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.string.pad-end */"./node_modules/core-js/modules/es7.string.pad-end.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").String.padEnd},"./node_modules/core-js/fn/string/pad-start.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/fn/string/pad-start.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.string.pad-start */"./node_modules/core-js/modules/es7.string.pad-start.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").String.padStart},"./node_modules/core-js/fn/string/trim-end.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/fn/string/trim-end.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.string.trim-right */"./node_modules/core-js/modules/es7.string.trim-right.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").String.trimRight},"./node_modules/core-js/fn/string/trim-start.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/fn/string/trim-start.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.string.trim-left */"./node_modules/core-js/modules/es7.string.trim-left.js"),e.exports=n(/*! ../../modules/_core */"./node_modules/core-js/modules/_core.js").String.trimLeft},"./node_modules/core-js/fn/symbol/async-iterator.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/fn/symbol/async-iterator.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../../modules/es7.symbol.async-iterator */"./node_modules/core-js/modules/es7.symbol.async-iterator.js"),e.exports=n(/*! ../../modules/_wks-ext */"./node_modules/core-js/modules/_wks-ext.js").f("asyncIterator")},"./node_modules/core-js/library/fn/global.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/library/fn/global.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){n(/*! ../modules/es7.global */"./node_modules/core-js/library/modules/es7.global.js"),e.exports=n(/*! ../modules/_core */"./node_modules/core-js/library/modules/_core.js").global},"./node_modules/core-js/library/modules/_a-function.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_a-function.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},"./node_modules/core-js/library/modules/_an-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_an-object.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},"./node_modules/core-js/library/modules/_core.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_core.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t){var n=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=n)},"./node_modules/core-js/library/modules/_ctx.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_ctx.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_a-function */"./node_modules/core-js/library/modules/_a-function.js");e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js/library/modules/_descriptors.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_descriptors.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){e.exports=!n(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/library/modules/_dom-create.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_dom-create.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),i=n(/*! ./_global */"./node_modules/core-js/library/modules/_global.js").document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},"./node_modules/core-js/library/modules/_export.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_export.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),i=n(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),o=n(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),s=n(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js"),a=n(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),l=function(e,t,n){var c,u,d,h=e&l.F,f=e&l.G,p=e&l.S,m=e&l.P,g=e&l.B,v=e&l.W,y=f?i:i[t]||(i[t]={}),_=y.prototype,b=f?r:p?r[t]:(r[t]||{}).prototype;for(c in f&&(n=t),n)(u=!h&&b&&void 0!==b[c])&&a(y,c)||(d=u?b[c]:n[c],y[c]=f&&"function"!=typeof b[c]?n[c]:g&&u?o(d,r):v&&b[c]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):m&&"function"==typeof d?o(Function.call,d):d,m&&((y.virtual||(y.virtual={}))[c]=d,e&l.R&&_&&!_[c]&&s(_,c,d)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},"./node_modules/core-js/library/modules/_fails.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_fails.js ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"./node_modules/core-js/library/modules/_global.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_global.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},"./node_modules/core-js/library/modules/_has.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_has.js ***!
  \******************************************************/
/*! no static exports found */function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},"./node_modules/core-js/library/modules/_hide.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_hide.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js"),i=n(/*! ./_property-desc */"./node_modules/core-js/library/modules/_property-desc.js");e.exports=n(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},"./node_modules/core-js/library/modules/_ie8-dom-define.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_ie8-dom-define.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t,n){e.exports=!n(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")&&!n(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js")((function(){return 7!=Object.defineProperty(n(/*! ./_dom-create */"./node_modules/core-js/library/modules/_dom-create.js")("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/library/modules/_is-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-object.js ***!
  \************************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js/library/modules/_object-dp.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-dp.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),i=n(/*! ./_ie8-dom-define */"./node_modules/core-js/library/modules/_ie8-dom-define.js"),o=n(/*! ./_to-primitive */"./node_modules/core-js/library/modules/_to-primitive.js"),s=Object.defineProperty;t.f=n(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},"./node_modules/core-js/library/modules/_property-desc.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_property-desc.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js/library/modules/_to-primitive.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-primitive.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/library/modules/es7.global.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.global.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/library/modules/_export.js");r(r.G,{global:n(/*! ./_global */"./node_modules/core-js/library/modules/_global.js")})},"./node_modules/core-js/modules/_a-function.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_a-function.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},"./node_modules/core-js/modules/_a-number-value.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/_a-number-value.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js");e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},"./node_modules/core-js/modules/_add-to-unscopables.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/_add-to-unscopables.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("unscopables"),i=Array.prototype;null==i[r]&&n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js")(i,r,{}),e.exports=function(e){i[r][e]=!0}},"./node_modules/core-js/modules/_advance-string-index.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/_advance-string-index.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_string-at */"./node_modules/core-js/modules/_string-at.js")(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},"./node_modules/core-js/modules/_an-instance.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_an-instance.js ***!
  \******************************************************/
/*! no static exports found */function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},"./node_modules/core-js/modules/_an-object.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_an-object.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},"./node_modules/core-js/modules/_array-copy-within.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/_array-copy-within.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),i=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js"),o=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js");e.exports=[].copyWithin||function(e,t){var n=r(this),s=o(n.length),a=i(e,s),l=i(t,s),c=arguments.length>2?arguments[2]:void 0,u=Math.min((void 0===c?s:i(c,s))-l,s-a),d=1;for(l<a&&a<l+u&&(d=-1,l+=u-1,a+=u-1);u-- >0;)l in n?n[a]=n[l]:delete n[a],a+=d,l+=d;return n}},"./node_modules/core-js/modules/_array-fill.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_array-fill.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),i=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js"),o=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js");e.exports=function(e){for(var t=r(this),n=o(t.length),s=arguments.length,a=i(s>1?arguments[1]:void 0,n),l=s>2?arguments[2]:void 0,c=void 0===l?n:i(l,n);c>a;)t[a++]=e;return t}},"./node_modules/core-js/modules/_array-includes.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/_array-includes.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),i=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),o=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js");e.exports=function(e){return function(t,n,s){var a,l=r(t),c=i(l.length),u=o(s,c);if(e&&n!=n){for(;c>u;)if((a=l[u++])!=a)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}}},"./node_modules/core-js/modules/_array-methods.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_array-methods.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),i=n(/*! ./_iobject */"./node_modules/core-js/modules/_iobject.js"),o=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),s=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),a=n(/*! ./_array-species-create */"./node_modules/core-js/modules/_array-species-create.js");e.exports=function(e,t){var n=1==e,l=2==e,c=3==e,u=4==e,d=6==e,h=5==e||d,f=t||a;return function(t,a,p){for(var m,g,v=o(t),y=i(v),_=r(a,p,3),b=s(y.length),x=0,w=n?f(t,b):l?f(t,0):void 0;b>x;x++)if((h||x in y)&&(g=_(m=y[x],x,v),e))if(n)w[x]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return x;case 2:w.push(m)}else if(u)return!1;return d?-1:c||u?u:w}}},"./node_modules/core-js/modules/_array-reduce.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/_array-reduce.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),i=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),o=n(/*! ./_iobject */"./node_modules/core-js/modules/_iobject.js"),s=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js");e.exports=function(e,t,n,a,l){r(t);var c=i(e),u=o(c),d=s(c.length),h=l?d-1:0,f=l?-1:1;if(n<2)for(;;){if(h in u){a=u[h],h+=f;break}if(h+=f,l?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;l?h>=0:d>h;h+=f)h in u&&(a=t(a,u[h],h,c));return a}},"./node_modules/core-js/modules/_array-species-constructor.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/modules/_array-species-constructor.js ***!
  \********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_is-array */"./node_modules/core-js/modules/_is-array.js"),o=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},"./node_modules/core-js/modules/_array-species-create.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/_array-species-create.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_array-species-constructor */"./node_modules/core-js/modules/_array-species-constructor.js");e.exports=function(e,t){return new(r(e))(t)}},"./node_modules/core-js/modules/_bind.js":
/*!***********************************************!*\
  !*** ./node_modules/core-js/modules/_bind.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),i=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),o=n(/*! ./_invoke */"./node_modules/core-js/modules/_invoke.js"),s=[].slice,a={},l=function(e,t,n){if(!(t in a)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";a[t]=Function("F,a","return new F("+r.join(",")+")")}return a[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=s.call(arguments,1),a=function(){var r=n.concat(s.call(arguments));return this instanceof a?l(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(a.prototype=t.prototype),a}},"./node_modules/core-js/modules/_classof.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/modules/_classof.js ***!
  \**************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js"),i=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},"./node_modules/core-js/modules/_cof.js":
/*!**********************************************!*\
  !*** ./node_modules/core-js/modules/_cof.js ***!
  \**********************************************/
/*! no static exports found */function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},"./node_modules/core-js/modules/_collection-strong.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/_collection-strong.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,i=n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js"),o=n(/*! ./_redefine-all */"./node_modules/core-js/modules/_redefine-all.js"),s=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),a=n(/*! ./_an-instance */"./node_modules/core-js/modules/_an-instance.js"),l=n(/*! ./_for-of */"./node_modules/core-js/modules/_for-of.js"),c=n(/*! ./_iter-define */"./node_modules/core-js/modules/_iter-define.js"),u=n(/*! ./_iter-step */"./node_modules/core-js/modules/_iter-step.js"),d=n(/*! ./_set-species */"./node_modules/core-js/modules/_set-species.js"),h=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),f=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js").fastKey,p=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js"),m=h?"_s":"size",g=function(e,t){var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var u=e((function(e,r){a(e,u,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=r&&l(r,n,e[c],e)}));return o(u.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=p(this,t),r=g(n,e);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[m]--}return!!r},forEach:function(e){p(this,t);for(var n,r=s(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!g(p(this,t),e)}}),h&&r(u.prototype,"size",{get:function(){return p(this,t)[m]}}),u},def:function(e,t,n){var r,i,o=g(e,t);return o?o.v=n:(e._l=o={i:i=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:g,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?u(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,u(1))}),n?"entries":"values",!n,!0),d(t)}}},"./node_modules/core-js/modules/_collection-weak.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/_collection-weak.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_redefine-all */"./node_modules/core-js/modules/_redefine-all.js"),i=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js").getWeak,o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),s=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),a=n(/*! ./_an-instance */"./node_modules/core-js/modules/_an-instance.js"),l=n(/*! ./_for-of */"./node_modules/core-js/modules/_for-of.js"),c=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js"),u=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),d=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js"),h=c(5),f=c(6),p=0,m=function(e){return e._l||(e._l=new g)},g=function(){this.a=[]},v=function(e,t){return h(e.a,(function(e){return e[0]===t}))};g.prototype={get:function(e){var t=v(this,e);if(t)return t[1]},has:function(e){return!!v(this,e)},set:function(e,t){var n=v(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=f(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var c=e((function(e,r){a(e,c,t,"_i"),e._t=t,e._i=p++,e._l=void 0,null!=r&&l(r,n,e[o],e)}));return r(c.prototype,{delete:function(e){if(!s(e))return!1;var n=i(e);return!0===n?m(d(this,t)).delete(e):n&&u(n,this._i)&&delete n[this._i]},has:function(e){if(!s(e))return!1;var n=i(e);return!0===n?m(d(this,t)).has(e):n&&u(n,this._i)}}),c},def:function(e,t,n){var r=i(o(t),!0);return!0===r?m(e).set(t,n):r[e._i]=n,e},ufstore:m}},"./node_modules/core-js/modules/_collection.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_collection.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),o=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),s=n(/*! ./_redefine-all */"./node_modules/core-js/modules/_redefine-all.js"),a=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js"),l=n(/*! ./_for-of */"./node_modules/core-js/modules/_for-of.js"),c=n(/*! ./_an-instance */"./node_modules/core-js/modules/_an-instance.js"),u=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),d=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),h=n(/*! ./_iter-detect */"./node_modules/core-js/modules/_iter-detect.js"),f=n(/*! ./_set-to-string-tag */"./node_modules/core-js/modules/_set-to-string-tag.js"),p=n(/*! ./_inherit-if-required */"./node_modules/core-js/modules/_inherit-if-required.js");e.exports=function(e,t,n,m,g,v){var y=r[e],_=y,b=g?"set":"add",x=_&&_.prototype,w={},E=function(e){var t=x[e];o(x,e,"delete"==e||"has"==e?function(e){return!(v&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return v&&!u(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof _&&(v||x.forEach&&!d((function(){(new _).entries().next()})))){var A=new _,M=A[b](v?{}:-0,1)!=A,S=d((function(){A.has(1)})),T=h((function(e){new _(e)})),C=!v&&d((function(){for(var e=new _,t=5;t--;)e[b](t,t);return!e.has(-0)}));T||((_=t((function(t,n){c(t,_,e);var r=p(new y,t,_);return null!=n&&l(n,g,r[b],r),r}))).prototype=x,x.constructor=_),(S||C)&&(E("delete"),E("has"),g&&E("get")),(C||M)&&E(b),v&&x.clear&&delete x.clear}else _=m.getConstructor(t,e,g,b),s(_.prototype,n),a.NEED=!0;return f(_,e),w[e]=_,i(i.G+i.W+i.F*(_!=y),w),v||m.setStrong(_,e,g),_}},"./node_modules/core-js/modules/_core.js":
/*!***********************************************!*\
  !*** ./node_modules/core-js/modules/_core.js ***!
  \***********************************************/
/*! no static exports found */function(e,t){var n=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=n)},"./node_modules/core-js/modules/_create-property.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/_create-property.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),i=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js");e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},"./node_modules/core-js/modules/_ctx.js":
/*!**********************************************!*\
  !*** ./node_modules/core-js/modules/_ctx.js ***!
  \**********************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js");e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js/modules/_date-to-iso-string.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/_date-to-iso-string.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),i=Date.prototype.getTime,o=Date.prototype.toISOString,s=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-50000000000001))}))||!r((function(){o.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+s(e.getUTCMonth()+1)+"-"+s(e.getUTCDate())+"T"+s(e.getUTCHours())+":"+s(e.getUTCMinutes())+":"+s(e.getUTCSeconds())+"."+(n>99?n:"0"+s(n))+"Z"}:o},"./node_modules/core-js/modules/_date-to-primitive.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/_date-to-primitive.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js");e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},"./node_modules/core-js/modules/_defined.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/modules/_defined.js ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},"./node_modules/core-js/modules/_descriptors.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_descriptors.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){e.exports=!n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/modules/_dom-create.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_dom-create.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},"./node_modules/core-js/modules/_enum-bug-keys.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_enum-bug-keys.js ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},"./node_modules/core-js/modules/_enum-keys.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_enum-keys.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js"),i=n(/*! ./_object-gops */"./node_modules/core-js/modules/_object-gops.js"),o=n(/*! ./_object-pie */"./node_modules/core-js/modules/_object-pie.js");e.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,a=n(e),l=o.f,c=0;a.length>c;)l.call(e,s=a[c++])&&t.push(s);return t}},"./node_modules/core-js/modules/_export.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/_export.js ***!
  \*************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_core */"./node_modules/core-js/modules/_core.js"),o=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),s=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),a=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),l=function(e,t,n){var c,u,d,h,f=e&l.F,p=e&l.G,m=e&l.S,g=e&l.P,v=e&l.B,y=p?r:m?r[t]||(r[t]={}):(r[t]||{}).prototype,_=p?i:i[t]||(i[t]={}),b=_.prototype||(_.prototype={});for(c in p&&(n=t),n)d=((u=!f&&y&&void 0!==y[c])?y:n)[c],h=v&&u?a(d,r):g&&"function"==typeof d?a(Function.call,d):d,y&&s(y,c,d,e&l.U),_[c]!=d&&o(_,c,h),g&&b[c]!=d&&(b[c]=d)};r.core=i,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},"./node_modules/core-js/modules/_fails-is-regexp.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/_fails-is-regexp.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},"./node_modules/core-js/modules/_fails.js":
/*!************************************************!*\
  !*** ./node_modules/core-js/modules/_fails.js ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"./node_modules/core-js/modules/_fix-re-wks.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_fix-re-wks.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./es6.regexp.exec */"./node_modules/core-js/modules/es6.regexp.exec.js");var r=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),i=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),o=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),s=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js"),a=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js"),l=n(/*! ./_regexp-exec */"./node_modules/core-js/modules/_regexp-exec.js"),c=a("species"),u=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),d=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=a(e),f=!o((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),p=f?!o((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[c]=function(){return n}),n[h](""),!t})):void 0;if(!f||!p||"replace"===e&&!u||"split"===e&&!d){var m=/./[h],g=n(s,h,""[e],(function(e,t,n,r,i){return t.exec===l?f&&!i?{done:!0,value:m.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),v=g[0],y=g[1];r(String.prototype,e,v),i(RegExp.prototype,h,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}}},"./node_modules/core-js/modules/_flags.js":
/*!************************************************!*\
  !*** ./node_modules/core-js/modules/_flags.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js");e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},"./node_modules/core-js/modules/_flatten-into-array.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/_flatten-into-array.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_is-array */"./node_modules/core-js/modules/_is-array.js"),i=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),o=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),s=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),a=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("isConcatSpreadable");e.exports=function e(t,n,l,c,u,d,h,f){for(var p,m,g=u,v=0,y=!!h&&s(h,f,3);v<c;){if(v in l){if(p=y?y(l[v],v,n):l[v],m=!1,i(p)&&(m=void 0!==(m=p[a])?!!m:r(p)),m&&d>0)g=e(t,n,p,o(p.length),g,d-1)-1;else{if(g>=9007199254740991)throw TypeError();t[g]=p}g++}v++}return g}},"./node_modules/core-js/modules/_for-of.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/_for-of.js ***!
  \*************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),i=n(/*! ./_iter-call */"./node_modules/core-js/modules/_iter-call.js"),o=n(/*! ./_is-array-iter */"./node_modules/core-js/modules/_is-array-iter.js"),s=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),a=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),l=n(/*! ./core.get-iterator-method */"./node_modules/core-js/modules/core.get-iterator-method.js"),c={},u={};(t=e.exports=function(e,t,n,d,h){var f,p,m,g,v=h?function(){return e}:l(e),y=r(n,d,t?2:1),_=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(f=a(e.length);f>_;_++)if((g=t?y(s(p=e[_])[0],p[1]):y(e[_]))===c||g===u)return g}else for(m=v.call(e);!(p=m.next()).done;)if((g=i(m,y,p.value,t))===c||g===u)return g}).BREAK=c,t.RETURN=u},"./node_modules/core-js/modules/_function-to-string.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/_function-to-string.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){e.exports=n(/*! ./_shared */"./node_modules/core-js/modules/_shared.js")("native-function-to-string",Function.toString)},"./node_modules/core-js/modules/_global.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/_global.js ***!
  \*************************************************/
/*! no static exports found */function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},"./node_modules/core-js/modules/_has.js":
/*!**********************************************!*\
  !*** ./node_modules/core-js/modules/_has.js ***!
  \**********************************************/
/*! no static exports found */function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},"./node_modules/core-js/modules/_hide.js":
/*!***********************************************!*\
  !*** ./node_modules/core-js/modules/_hide.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),i=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js");e.exports=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},"./node_modules/core-js/modules/_html.js":
/*!***********************************************!*\
  !*** ./node_modules/core-js/modules/_html.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").document;e.exports=r&&r.documentElement},"./node_modules/core-js/modules/_ie8-dom-define.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/_ie8-dom-define.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){e.exports=!n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")&&!n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return 7!=Object.defineProperty(n(/*! ./_dom-create */"./node_modules/core-js/modules/_dom-create.js")("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/modules/_inherit-if-required.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/_inherit-if-required.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_set-proto */"./node_modules/core-js/modules/_set-proto.js").set;e.exports=function(e,t,n){var o,s=t.constructor;return s!==n&&"function"==typeof s&&(o=s.prototype)!==n.prototype&&r(o)&&i&&i(e,o),e}},"./node_modules/core-js/modules/_invoke.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/_invoke.js ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},"./node_modules/core-js/modules/_iobject.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/modules/_iobject.js ***!
  \**************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},"./node_modules/core-js/modules/_is-array-iter.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_is-array-iter.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_iterators */"./node_modules/core-js/modules/_iterators.js"),i=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},"./node_modules/core-js/modules/_is-array.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/modules/_is-array.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js");e.exports=Array.isArray||function(e){return"Array"==r(e)}},"./node_modules/core-js/modules/_is-integer.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_is-integer.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},"./node_modules/core-js/modules/_is-object.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_is-object.js ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js/modules/_is-regexp.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_is-regexp.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js"),o=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},"./node_modules/core-js/modules/_iter-call.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_iter-call.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js");e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},"./node_modules/core-js/modules/_iter-create.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_iter-create.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js"),i=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js"),o=n(/*! ./_set-to-string-tag */"./node_modules/core-js/modules/_set-to-string-tag.js"),s={};n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js")(s,n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),o(e,t+" Iterator")}},"./node_modules/core-js/modules/_iter-define.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_iter-define.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_library */"./node_modules/core-js/modules/_library.js"),i=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),o=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),s=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),a=n(/*! ./_iterators */"./node_modules/core-js/modules/_iterators.js"),l=n(/*! ./_iter-create */"./node_modules/core-js/modules/_iter-create.js"),c=n(/*! ./_set-to-string-tag */"./node_modules/core-js/modules/_set-to-string-tag.js"),u=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js"),d=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("iterator"),h=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,m,g,v){l(n,t,p);var y,_,b,x=function(e){if(!h&&e in M)return M[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},w=t+" Iterator",E="values"==m,A=!1,M=e.prototype,S=M[d]||M["@@iterator"]||m&&M[m],T=S||x(m),C=m?E?x("entries"):T:void 0,P="Array"==t&&M.entries||S;if(P&&(b=u(P.call(new e)))!==Object.prototype&&b.next&&(c(b,w,!0),r||"function"==typeof b[d]||s(b,d,f)),E&&S&&"values"!==S.name&&(A=!0,T=function(){return S.call(this)}),r&&!v||!h&&!A&&M[d]||s(M,d,T),a[t]=T,a[w]=f,m)if(y={values:E?T:x("values"),keys:g?T:x("keys"),entries:C},v)for(_ in y)_ in M||o(M,_,y[_]);else i(i.P+i.F*(h||A),t,y);return y}},"./node_modules/core-js/modules/_iter-detect.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_iter-detect.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],s=o[r]();s.next=function(){return{done:n=!0}},o[r]=function(){return s},e(o)}catch(e){}return n}},"./node_modules/core-js/modules/_iter-step.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_iter-step.js ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},"./node_modules/core-js/modules/_iterators.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_iterators.js ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports={}},"./node_modules/core-js/modules/_library.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/modules/_library.js ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports=!1},"./node_modules/core-js/modules/_math-expm1.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_math-expm1.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},"./node_modules/core-js/modules/_math-fround.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_math-fround.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_math-sign */"./node_modules/core-js/modules/_math-sign.js"),i=Math.pow,o=i(2,-52),s=i(2,-23),a=i(2,127)*(2-s),l=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),c=r(e);return i<l?c*(i/l/s+1/o-1/o)*l*s:(n=(t=(1+s/o)*i)-(t-i))>a||n!=n?c*(1/0):c*n}},"./node_modules/core-js/modules/_math-log1p.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_math-log1p.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},"./node_modules/core-js/modules/_math-sign.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_math-sign.js ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},"./node_modules/core-js/modules/_meta.js":
/*!***********************************************!*\
  !*** ./node_modules/core-js/modules/_meta.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js")("meta"),i=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),o=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),s=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,a=0,l=Object.isExtensible||function(){return!0},c=!n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return l(Object.preventExtensions({}))})),u=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!l(e))return"F";if(!t)return"E";u(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!l(e))return!0;if(!t)return!1;u(e)}return e[r].w},onFreeze:function(e){return c&&d.NEED&&l(e)&&!o(e,r)&&u(e),e}}},"./node_modules/core-js/modules/_microtask.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_microtask.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_task */"./node_modules/core-js/modules/_task.js").set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,l="process"==n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js")(s);e.exports=function(){var e,t,n,c=function(){var r,i;for(l&&(r=s.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(l)n=function(){s.nextTick(c)};else if(!o||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var u=a.resolve(void 0);n=function(){u.then(c)}}else n=function(){i.call(r,c)};else{var d=!0,h=document.createTextNode("");new o(c).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},"./node_modules/core-js/modules/_new-promise-capability.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/modules/_new-promise-capability.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js");function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},"./node_modules/core-js/modules/_object-assign.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_object-assign.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),i=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js"),o=n(/*! ./_object-gops */"./node_modules/core-js/modules/_object-gops.js"),s=n(/*! ./_object-pie */"./node_modules/core-js/modules/_object-pie.js"),a=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),l=n(/*! ./_iobject */"./node_modules/core-js/modules/_iobject.js"),c=Object.assign;e.exports=!c||n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=a(e),c=arguments.length,u=1,d=o.f,h=s.f;c>u;)for(var f,p=l(arguments[u++]),m=d?i(p).concat(d(p)):i(p),g=m.length,v=0;g>v;)f=m[v++],r&&!h.call(p,f)||(n[f]=p[f]);return n}:c},"./node_modules/core-js/modules/_object-create.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_object-create.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_object-dps */"./node_modules/core-js/modules/_object-dps.js"),o=n(/*! ./_enum-bug-keys */"./node_modules/core-js/modules/_enum-bug-keys.js"),s=n(/*! ./_shared-key */"./node_modules/core-js/modules/_shared-key.js")("IE_PROTO"),a=function(){},l=function(){var e,t=n(/*! ./_dom-create */"./node_modules/core-js/modules/_dom-create.js")("iframe"),r=o.length;for(t.style.display="none",n(/*! ./_html */"./node_modules/core-js/modules/_html.js").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[o[r]];return l()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=l(),void 0===t?n:i(n,t)}},"./node_modules/core-js/modules/_object-dp.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_object-dp.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_ie8-dom-define */"./node_modules/core-js/modules/_ie8-dom-define.js"),o=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js"),s=Object.defineProperty;t.f=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},"./node_modules/core-js/modules/_object-dps.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_object-dps.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),i=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),o=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js");e.exports=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")?Object.defineProperties:function(e,t){i(e);for(var n,s=o(t),a=s.length,l=0;a>l;)r.f(e,n=s[l++],t[n]);return e}},"./node_modules/core-js/modules/_object-gopd.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_object-gopd.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-pie */"./node_modules/core-js/modules/_object-pie.js"),i=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js"),o=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),s=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js"),a=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),l=n(/*! ./_ie8-dom-define */"./node_modules/core-js/modules/_ie8-dom-define.js"),c=Object.getOwnPropertyDescriptor;t.f=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")?c:function(e,t){if(e=o(e),t=s(t,!0),l)try{return c(e,t)}catch(e){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},"./node_modules/core-js/modules/_object-gopn-ext.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/_object-gopn-ext.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),i=n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js").f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(r(e))}},"./node_modules/core-js/modules/_object-gopn.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_object-gopn.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-keys-internal */"./node_modules/core-js/modules/_object-keys-internal.js"),i=n(/*! ./_enum-bug-keys */"./node_modules/core-js/modules/_enum-bug-keys.js").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},"./node_modules/core-js/modules/_object-gops.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_object-gops.js ***!
  \******************************************************/
/*! no static exports found */function(e,t){t.f=Object.getOwnPropertySymbols},"./node_modules/core-js/modules/_object-gpo.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_object-gpo.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),i=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),o=n(/*! ./_shared-key */"./node_modules/core-js/modules/_shared-key.js")("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},"./node_modules/core-js/modules/_object-keys-internal.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/_object-keys-internal.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),i=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),o=n(/*! ./_array-includes */"./node_modules/core-js/modules/_array-includes.js")(!1),s=n(/*! ./_shared-key */"./node_modules/core-js/modules/_shared-key.js")("IE_PROTO");e.exports=function(e,t){var n,a=i(e),l=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>l;)r(a,n=t[l++])&&(~o(c,n)||c.push(n));return c}},"./node_modules/core-js/modules/_object-keys.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_object-keys.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-keys-internal */"./node_modules/core-js/modules/_object-keys-internal.js"),i=n(/*! ./_enum-bug-keys */"./node_modules/core-js/modules/_enum-bug-keys.js");e.exports=Object.keys||function(e){return r(e,i)}},"./node_modules/core-js/modules/_object-pie.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_object-pie.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t){t.f={}.propertyIsEnumerable},"./node_modules/core-js/modules/_object-sap.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_object-sap.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_core */"./node_modules/core-js/modules/_core.js"),o=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js");e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*o((function(){n(1)})),"Object",s)}},"./node_modules/core-js/modules/_object-to-array.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/_object-to-array.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),i=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js"),o=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),s=n(/*! ./_object-pie */"./node_modules/core-js/modules/_object-pie.js").f;e.exports=function(e){return function(t){for(var n,a=o(t),l=i(a),c=l.length,u=0,d=[];c>u;)n=l[u++],r&&!s.call(a,n)||d.push(e?[n,a[n]]:a[n]);return d}}},"./node_modules/core-js/modules/_own-keys.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/modules/_own-keys.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js"),i=n(/*! ./_object-gops */"./node_modules/core-js/modules/_object-gops.js"),o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),s=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").Reflect;e.exports=s&&s.ownKeys||function(e){var t=r.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},"./node_modules/core-js/modules/_parse-float.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_parse-float.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").parseFloat,i=n(/*! ./_string-trim */"./node_modules/core-js/modules/_string-trim.js").trim;e.exports=1/r(n(/*! ./_string-ws */"./node_modules/core-js/modules/_string-ws.js")+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},"./node_modules/core-js/modules/_parse-int.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_parse-int.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").parseInt,i=n(/*! ./_string-trim */"./node_modules/core-js/modules/_string-trim.js").trim,o=n(/*! ./_string-ws */"./node_modules/core-js/modules/_string-ws.js"),s=/^[-+]?0[xX]/;e.exports=8!==r(o+"08")||22!==r(o+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(s.test(n)?16:10))}:r},"./node_modules/core-js/modules/_perform.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/modules/_perform.js ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},"./node_modules/core-js/modules/_promise-resolve.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/_promise-resolve.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),o=n(/*! ./_new-promise-capability */"./node_modules/core-js/modules/_new-promise-capability.js");e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},"./node_modules/core-js/modules/_property-desc.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_property-desc.js ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js/modules/_redefine-all.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/_redefine-all.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js");e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},"./node_modules/core-js/modules/_redefine.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/modules/_redefine.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),o=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),s=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js")("src"),a=n(/*! ./_function-to-string */"./node_modules/core-js/modules/_function-to-string.js"),l=(""+a).split("toString");n(/*! ./_core */"./node_modules/core-js/modules/_core.js").inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,n,a){var c="function"==typeof n;c&&(o(n,"name")||i(n,"name",t)),e[t]!==n&&(c&&(o(n,s)||i(n,s,e[t]?""+e[t]:l.join(String(t)))),e===r?e[t]=n:a?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[s]||a.call(this)}))},"./node_modules/core-js/modules/_regexp-exec-abstract.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/_regexp-exec-abstract.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_classof */"./node_modules/core-js/modules/_classof.js"),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},"./node_modules/core-js/modules/_regexp-exec.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_regexp-exec.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r,i,o=n(/*! ./_flags */"./node_modules/core-js/modules/_flags.js"),s=RegExp.prototype.exec,a=String.prototype.replace,l=s,c=(r=/a/,i=/b*/g,s.call(r,"a"),s.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),u=void 0!==/()??/.exec("")[1];(c||u)&&(l=function(e){var t,n,r,i,l=this;return u&&(n=new RegExp("^"+l.source+"$(?!\\s)",o.call(l))),c&&(t=l.lastIndex),r=s.call(l,e),c&&r&&(l.lastIndex=l.global?r.index+r[0].length:t),u&&r&&r.length>1&&a.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=l},"./node_modules/core-js/modules/_same-value.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_same-value.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},"./node_modules/core-js/modules/_set-proto.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_set-proto.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js")(Function.call,n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js").f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},"./node_modules/core-js/modules/_set-species.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_set-species.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),o=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),s=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("species");e.exports=function(e){var t=r[e];o&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},"./node_modules/core-js/modules/_set-to-string-tag.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/_set-to-string-tag.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,i=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),o=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},"./node_modules/core-js/modules/_shared-key.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_shared-key.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_shared */"./node_modules/core-js/modules/_shared.js")("keys"),i=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js");e.exports=function(e){return r[e]||(r[e]=i(e))}},"./node_modules/core-js/modules/_shared.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/_shared.js ***!
  \*************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_core */"./node_modules/core-js/modules/_core.js"),i=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(/*! ./_library */"./node_modules/core-js/modules/_library.js")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},"./node_modules/core-js/modules/_species-constructor.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/_species-constructor.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),o=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||null==(n=r(s)[o])?t:i(n)}},"./node_modules/core-js/modules/_strict-method.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_strict-method.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js");e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},"./node_modules/core-js/modules/_string-at.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_string-at.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),i=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js");e.exports=function(e){return function(t,n){var o,s,a=String(i(t)),l=r(n),c=a.length;return l<0||l>=c?e?"":void 0:(o=a.charCodeAt(l))<55296||o>56319||l+1===c||(s=a.charCodeAt(l+1))<56320||s>57343?e?a.charAt(l):o:e?a.slice(l,l+2):s-56320+(o-55296<<10)+65536}}},"./node_modules/core-js/modules/_string-context.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/_string-context.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-regexp */"./node_modules/core-js/modules/_is-regexp.js"),i=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js");e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},"./node_modules/core-js/modules/_string-html.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_string-html.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),o=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js"),s=/"/g,a=function(e,t,n,r){var i=String(o(e)),a="<"+t;return""!==n&&(a+=" "+n+'="'+String(r).replace(s,"&quot;")+'"'),a+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(a),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},"./node_modules/core-js/modules/_string-pad.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_string-pad.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),i=n(/*! ./_string-repeat */"./node_modules/core-js/modules/_string-repeat.js"),o=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js");e.exports=function(e,t,n,s){var a=String(o(e)),l=a.length,c=void 0===n?" ":String(n),u=r(t);if(u<=l||""==c)return a;var d=u-l,h=i.call(c,Math.ceil(d/c.length));return h.length>d&&(h=h.slice(0,d)),s?h+a:a+h}},"./node_modules/core-js/modules/_string-repeat.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/_string-repeat.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),i=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js");e.exports=function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},"./node_modules/core-js/modules/_string-trim.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_string-trim.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js"),o=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),s=n(/*! ./_string-ws */"./node_modules/core-js/modules/_string-ws.js"),a="["+s+"]",l=RegExp("^"+a+a+"*"),c=RegExp(a+a+"*$"),u=function(e,t,n){var i={},a=o((function(){return!!s[e]()||"​"!="​"[e]()})),l=i[e]=a?t(d):s[e];n&&(i[n]=l),r(r.P+r.F*a,"String",i)},d=u.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(c,"")),e};e.exports=u},"./node_modules/core-js/modules/_string-ws.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_string-ws.js ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},"./node_modules/core-js/modules/_task.js":
/*!***********************************************!*\
  !*** ./node_modules/core-js/modules/_task.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){var r,i,o,s=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),a=n(/*! ./_invoke */"./node_modules/core-js/modules/_invoke.js"),l=n(/*! ./_html */"./node_modules/core-js/modules/_html.js"),c=n(/*! ./_dom-create */"./node_modules/core-js/modules/_dom-create.js"),u=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),d=u.process,h=u.setImmediate,f=u.clearImmediate,p=u.MessageChannel,m=u.Dispatch,g=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},_=function(e){y.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++g]=function(){a("function"==typeof e?e:Function(e),t)},r(g),g},f=function(e){delete v[e]},"process"==n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js")(d)?r=function(e){d.nextTick(s(y,e,1))}:m&&m.now?r=function(e){m.now(s(y,e,1))}:p?(o=(i=new p).port2,i.port1.onmessage=_,r=s(o.postMessage,o,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(r=function(e){u.postMessage(e+"","*")},u.addEventListener("message",_,!1)):r="onreadystatechange"in c("script")?function(e){l.appendChild(c("script")).onreadystatechange=function(){l.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),e.exports={set:h,clear:f}},"./node_modules/core-js/modules/_to-absolute-index.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/_to-absolute-index.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},"./node_modules/core-js/modules/_to-index.js":
/*!***************************************************!*\
  !*** ./node_modules/core-js/modules/_to-index.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),i=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js");e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},"./node_modules/core-js/modules/_to-integer.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_to-integer.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},"./node_modules/core-js/modules/_to-iobject.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_to-iobject.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_iobject */"./node_modules/core-js/modules/_iobject.js"),i=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js");e.exports=function(e){return r(i(e))}},"./node_modules/core-js/modules/_to-length.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_to-length.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},"./node_modules/core-js/modules/_to-object.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/_to-object.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_defined */"./node_modules/core-js/modules/_defined.js");e.exports=function(e){return Object(r(e))}},"./node_modules/core-js/modules/_to-primitive.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/_to-primitive.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/modules/_typed-array.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/_typed-array.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";if(n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")){var r=n(/*! ./_library */"./node_modules/core-js/modules/_library.js"),i=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),o=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),s=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),a=n(/*! ./_typed */"./node_modules/core-js/modules/_typed.js"),l=n(/*! ./_typed-buffer */"./node_modules/core-js/modules/_typed-buffer.js"),c=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),u=n(/*! ./_an-instance */"./node_modules/core-js/modules/_an-instance.js"),d=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js"),h=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),f=n(/*! ./_redefine-all */"./node_modules/core-js/modules/_redefine-all.js"),p=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),m=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),g=n(/*! ./_to-index */"./node_modules/core-js/modules/_to-index.js"),v=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js"),y=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js"),_=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),b=n(/*! ./_classof */"./node_modules/core-js/modules/_classof.js"),x=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),w=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),E=n(/*! ./_is-array-iter */"./node_modules/core-js/modules/_is-array-iter.js"),A=n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js"),M=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js"),S=n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js").f,T=n(/*! ./core.get-iterator-method */"./node_modules/core-js/modules/core.get-iterator-method.js"),C=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js"),P=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js"),L=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js"),D=n(/*! ./_array-includes */"./node_modules/core-js/modules/_array-includes.js"),R=n(/*! ./_species-constructor */"./node_modules/core-js/modules/_species-constructor.js"),I=n(/*! ./es6.array.iterator */"./node_modules/core-js/modules/es6.array.iterator.js"),j=n(/*! ./_iterators */"./node_modules/core-js/modules/_iterators.js"),O=n(/*! ./_iter-detect */"./node_modules/core-js/modules/_iter-detect.js"),N=n(/*! ./_set-species */"./node_modules/core-js/modules/_set-species.js"),k=n(/*! ./_array-fill */"./node_modules/core-js/modules/_array-fill.js"),F=n(/*! ./_array-copy-within */"./node_modules/core-js/modules/_array-copy-within.js"),V=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),B=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js"),U=V.f,z=B.f,G=i.RangeError,H=i.TypeError,W=i.Uint8Array,X=Array.prototype,q=l.ArrayBuffer,Y=l.DataView,K=L(0),Q=L(2),Z=L(3),J=L(4),$=L(5),ee=L(6),te=D(!0),ne=D(!1),re=I.values,ie=I.keys,oe=I.entries,se=X.lastIndexOf,ae=X.reduce,le=X.reduceRight,ce=X.join,ue=X.sort,de=X.slice,he=X.toString,fe=X.toLocaleString,pe=P("iterator"),me=P("toStringTag"),ge=C("typed_constructor"),ve=C("def_constructor"),ye=a.CONSTR,_e=a.TYPED,be=a.VIEW,xe=L(1,(function(e,t){return Se(R(e,e[ve]),t)})),we=o((function(){return 1===new W(new Uint16Array([1]).buffer)[0]})),Ee=!!W&&!!W.prototype.set&&o((function(){new W(1).set({})})),Ae=function(e,t){var n=p(e);if(n<0||n%t)throw G("Wrong offset!");return n},Me=function(e){if(x(e)&&_e in e)return e;throw H(e+" is not a typed array!")},Se=function(e,t){if(!x(e)||!(ge in e))throw H("It is not a typed array constructor!");return new e(t)},Te=function(e,t){return Ce(R(e,e[ve]),t)},Ce=function(e,t){for(var n=0,r=t.length,i=Se(e,r);r>n;)i[n]=t[n++];return i},Pe=function(e,t,n){U(e,t,{get:function(){return this._d[n]}})},Le=function(e){var t,n,r,i,o,s,a=w(e),l=arguments.length,u=l>1?arguments[1]:void 0,d=void 0!==u,h=T(a);if(null!=h&&!E(h)){for(s=h.call(a),r=[],t=0;!(o=s.next()).done;t++)r.push(o.value);a=r}for(d&&l>2&&(u=c(u,arguments[2],2)),t=0,n=m(a.length),i=Se(this,n);n>t;t++)i[t]=d?u(a[t],t):a[t];return i},De=function(){for(var e=0,t=arguments.length,n=Se(this,t);t>e;)n[e]=arguments[e++];return n},Re=!!W&&o((function(){fe.call(new W(1))})),Ie=function(){return fe.apply(Re?de.call(Me(this)):Me(this),arguments)},je={copyWithin:function(e,t){return F.call(Me(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return J(Me(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return k.apply(Me(this),arguments)},filter:function(e){return Te(this,Q(Me(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return $(Me(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Me(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){K(Me(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Me(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Me(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ce.apply(Me(this),arguments)},lastIndexOf:function(e){return se.apply(Me(this),arguments)},map:function(e){return xe(Me(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ae.apply(Me(this),arguments)},reduceRight:function(e){return le.apply(Me(this),arguments)},reverse:function(){for(var e,t=Me(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Z(Me(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return ue.call(Me(this),e)},subarray:function(e,t){var n=Me(this),r=n.length,i=v(e,r);return new(R(n,n[ve]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,m((void 0===t?r:v(t,r))-i))}},Oe=function(e,t){return Te(this,de.call(Me(this),e,t))},Ne=function(e){Me(this);var t=Ae(arguments[1],1),n=this.length,r=w(e),i=m(r.length),o=0;if(i+t>n)throw G("Wrong length!");for(;o<i;)this[t+o]=r[o++]},ke={entries:function(){return oe.call(Me(this))},keys:function(){return ie.call(Me(this))},values:function(){return re.call(Me(this))}},Fe=function(e,t){return x(e)&&e[_e]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ve=function(e,t){return Fe(e,t=y(t,!0))?d(2,e[t]):z(e,t)},Be=function(e,t,n){return!(Fe(e,t=y(t,!0))&&x(n)&&_(n,"value"))||_(n,"get")||_(n,"set")||n.configurable||_(n,"writable")&&!n.writable||_(n,"enumerable")&&!n.enumerable?U(e,t,n):(e[t]=n.value,e)};ye||(B.f=Ve,V.f=Be),s(s.S+s.F*!ye,"Object",{getOwnPropertyDescriptor:Ve,defineProperty:Be}),o((function(){he.call({})}))&&(he=fe=function(){return ce.call(this)});var Ue=f({},je);f(Ue,ke),h(Ue,pe,ke.values),f(Ue,{slice:Oe,set:Ne,constructor:function(){},toString:he,toLocaleString:Ie}),Pe(Ue,"buffer","b"),Pe(Ue,"byteOffset","o"),Pe(Ue,"byteLength","l"),Pe(Ue,"length","e"),U(Ue,me,{get:function(){return this[_e]}}),e.exports=function(e,t,n,l){var c=e+((l=!!l)?"Clamped":"")+"Array",d="get"+e,f="set"+e,p=i[c],v=p||{},y=p&&M(p),_=!p||!a.ABV,w={},E=p&&p.prototype,T=function(e,n){U(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[d](n*t+r.o,we)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;l&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[f](n*t+i.o,r,we)}(this,n,e)},enumerable:!0})};_?(p=n((function(e,n,r,i){u(e,p,c,"_d");var o,s,a,l,d=0,f=0;if(x(n)){if(!(n instanceof q||"ArrayBuffer"==(l=b(n))||"SharedArrayBuffer"==l))return _e in n?Ce(p,n):Le.call(p,n);o=n,f=Ae(r,t);var v=n.byteLength;if(void 0===i){if(v%t)throw G("Wrong length!");if((s=v-f)<0)throw G("Wrong length!")}else if((s=m(i)*t)+f>v)throw G("Wrong length!");a=s/t}else a=g(n),o=new q(s=a*t);for(h(e,"_d",{b:o,o:f,l:s,e:a,v:new Y(o)});d<a;)T(e,d++)})),E=p.prototype=A(Ue),h(E,"constructor",p)):o((function(){p(1)}))&&o((function(){new p(-1)}))&&O((function(e){new p,new p(null),new p(1.5),new p(e)}),!0)||(p=n((function(e,n,r,i){var o;return u(e,p,c),x(n)?n instanceof q||"ArrayBuffer"==(o=b(n))||"SharedArrayBuffer"==o?void 0!==i?new v(n,Ae(r,t),i):void 0!==r?new v(n,Ae(r,t)):new v(n):_e in n?Ce(p,n):Le.call(p,n):new v(g(n))})),K(y!==Function.prototype?S(v).concat(S(y)):S(v),(function(e){e in p||h(p,e,v[e])})),p.prototype=E,r||(E.constructor=p));var C=E[pe],P=!!C&&("values"==C.name||null==C.name),L=ke.values;h(p,ge,!0),h(E,_e,c),h(E,be,!0),h(E,ve,p),(l?new p(1)[me]==c:me in E)||U(E,me,{get:function(){return c}}),w[c]=p,s(s.G+s.W+s.F*(p!=v),w),s(s.S,c,{BYTES_PER_ELEMENT:t}),s(s.S+s.F*o((function(){v.of.call(p,1)})),c,{from:Le,of:De}),"BYTES_PER_ELEMENT"in E||h(E,"BYTES_PER_ELEMENT",t),s(s.P,c,je),N(c),s(s.P+s.F*Ee,c,{set:Ne}),s(s.P+s.F*!P,c,ke),r||E.toString==he||(E.toString=he),s(s.P+s.F*o((function(){new p(1).slice()})),c,{slice:Oe}),s(s.P+s.F*(o((function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()}))||!o((function(){E.toLocaleString.call([1,2])}))),c,{toLocaleString:Ie}),j[c]=P?C:L,r||P||h(E,pe,L)}}else e.exports=function(){}},"./node_modules/core-js/modules/_typed-buffer.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/_typed-buffer.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),o=n(/*! ./_library */"./node_modules/core-js/modules/_library.js"),s=n(/*! ./_typed */"./node_modules/core-js/modules/_typed.js"),a=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),l=n(/*! ./_redefine-all */"./node_modules/core-js/modules/_redefine-all.js"),c=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),u=n(/*! ./_an-instance */"./node_modules/core-js/modules/_an-instance.js"),d=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),h=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),f=n(/*! ./_to-index */"./node_modules/core-js/modules/_to-index.js"),p=n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js").f,m=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,g=n(/*! ./_array-fill */"./node_modules/core-js/modules/_array-fill.js"),v=n(/*! ./_set-to-string-tag */"./node_modules/core-js/modules/_set-to-string-tag.js"),y=r.ArrayBuffer,_=r.DataView,b=r.Math,x=r.RangeError,w=r.Infinity,E=y,A=b.abs,M=b.pow,S=b.floor,T=b.log,C=b.LN2,P=i?"_b":"buffer",L=i?"_l":"byteLength",D=i?"_o":"byteOffset";function R(e,t,n){var r,i,o,s=new Array(n),a=8*n-t-1,l=(1<<a)-1,c=l>>1,u=23===t?M(2,-24)-M(2,-77):0,d=0,h=e<0||0===e&&1/e<0?1:0;for((e=A(e))!=e||e===w?(i=e!=e?1:0,r=l):(r=S(T(e)/C),e*(o=M(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?u/o:u*M(2,1-c))*o>=2&&(r++,o/=2),r+c>=l?(i=0,r=l):r+c>=1?(i=(e*o-1)*M(2,t),r+=c):(i=e*M(2,c-1)*M(2,t),r=0));t>=8;s[d++]=255&i,i/=256,t-=8);for(r=r<<t|i,a+=t;a>0;s[d++]=255&r,r/=256,a-=8);return s[--d]|=128*h,s}function I(e,t,n){var r,i=8*n-t-1,o=(1<<i)-1,s=o>>1,a=i-7,l=n-1,c=e[l--],u=127&c;for(c>>=7;a>0;u=256*u+e[l],l--,a-=8);for(r=u&(1<<-a)-1,u>>=-a,a+=t;a>0;r=256*r+e[l],l--,a-=8);if(0===u)u=1-s;else{if(u===o)return r?NaN:c?-w:w;r+=M(2,t),u-=s}return(c?-1:1)*r*M(2,u-t)}function j(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function O(e){return[255&e]}function N(e){return[255&e,e>>8&255]}function k(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function F(e){return R(e,52,8)}function V(e){return R(e,23,4)}function B(e,t,n){m(e.prototype,t,{get:function(){return this[n]}})}function U(e,t,n,r){var i=f(+n);if(i+t>e[L])throw x("Wrong index!");var o=e[P]._b,s=i+e[D],a=o.slice(s,s+t);return r?a:a.reverse()}function z(e,t,n,r,i,o){var s=f(+n);if(s+t>e[L])throw x("Wrong index!");for(var a=e[P]._b,l=s+e[D],c=r(+i),u=0;u<t;u++)a[l+u]=c[o?u:t-u-1]}if(s.ABV){if(!c((function(){y(1)}))||!c((function(){new y(-1)}))||c((function(){return new y,new y(1.5),new y(NaN),"ArrayBuffer"!=y.name}))){for(var G,H=(y=function(e){return u(this,y),new E(f(e))}).prototype=E.prototype,W=p(E),X=0;W.length>X;)(G=W[X++])in y||a(y,G,E[G]);o||(H.constructor=y)}var q=new _(new y(2)),Y=_.prototype.setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||l(_.prototype,{setInt8:function(e,t){Y.call(this,e,t<<24>>24)},setUint8:function(e,t){Y.call(this,e,t<<24>>24)}},!0)}else y=function(e){u(this,y,"ArrayBuffer");var t=f(e);this._b=g.call(new Array(t),0),this[L]=t},_=function(e,t,n){u(this,_,"DataView"),u(e,y,"DataView");var r=e[L],i=d(t);if(i<0||i>r)throw x("Wrong offset!");if(i+(n=void 0===n?r-i:h(n))>r)throw x("Wrong length!");this[P]=e,this[D]=i,this[L]=n},i&&(B(y,"byteLength","_l"),B(_,"buffer","_b"),B(_,"byteLength","_l"),B(_,"byteOffset","_o")),l(_.prototype,{getInt8:function(e){return U(this,1,e)[0]<<24>>24},getUint8:function(e){return U(this,1,e)[0]},getInt16:function(e){var t=U(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=U(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return j(U(this,4,e,arguments[1]))},getUint32:function(e){return j(U(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return I(U(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return I(U(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){z(this,1,e,O,t)},setUint8:function(e,t){z(this,1,e,O,t)},setInt16:function(e,t){z(this,2,e,N,t,arguments[2])},setUint16:function(e,t){z(this,2,e,N,t,arguments[2])},setInt32:function(e,t){z(this,4,e,k,t,arguments[2])},setUint32:function(e,t){z(this,4,e,k,t,arguments[2])},setFloat32:function(e,t){z(this,4,e,V,t,arguments[2])},setFloat64:function(e,t){z(this,8,e,F,t,arguments[2])}});v(y,"ArrayBuffer"),v(_,"DataView"),a(_.prototype,s.VIEW,!0),t.ArrayBuffer=y,t.DataView=_},"./node_modules/core-js/modules/_typed.js":
/*!************************************************!*\
  !*** ./node_modules/core-js/modules/_typed.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){for(var r,i=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),o=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),s=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js"),a=s("typed_array"),l=s("view"),c=!(!i.ArrayBuffer||!i.DataView),u=c,d=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");d<9;)(r=i[h[d++]])?(o(r.prototype,a,!0),o(r.prototype,l,!0)):u=!1;e.exports={ABV:c,CONSTR:u,TYPED:a,VIEW:l}},"./node_modules/core-js/modules/_uid.js":
/*!**********************************************!*\
  !*** ./node_modules/core-js/modules/_uid.js ***!
  \**********************************************/
/*! no static exports found */function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},"./node_modules/core-js/modules/_user-agent.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_user-agent.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").navigator;e.exports=r&&r.userAgent||""},"./node_modules/core-js/modules/_validate-collection.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/_validate-collection.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},"./node_modules/core-js/modules/_wks-define.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/_wks-define.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_core */"./node_modules/core-js/modules/_core.js"),o=n(/*! ./_library */"./node_modules/core-js/modules/_library.js"),s=n(/*! ./_wks-ext */"./node_modules/core-js/modules/_wks-ext.js"),a=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},"./node_modules/core-js/modules/_wks-ext.js":
/*!**************************************************!*\
  !*** ./node_modules/core-js/modules/_wks-ext.js ***!
  \**************************************************/
/*! no static exports found */function(e,t,n){t.f=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")},"./node_modules/core-js/modules/_wks.js":
/*!**********************************************!*\
  !*** ./node_modules/core-js/modules/_wks.js ***!
  \**********************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_shared */"./node_modules/core-js/modules/_shared.js")("wks"),i=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js"),o=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").Symbol,s="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=r},"./node_modules/core-js/modules/core.get-iterator-method.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/modules/core.get-iterator-method.js ***!
  \******************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_classof */"./node_modules/core-js/modules/_classof.js"),i=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("iterator"),o=n(/*! ./_iterators */"./node_modules/core-js/modules/_iterators.js");e.exports=n(/*! ./_core */"./node_modules/core-js/modules/_core.js").getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},"./node_modules/core-js/modules/es6.array.copy-within.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.copy-within.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.P,"Array",{copyWithin:n(/*! ./_array-copy-within */"./node_modules/core-js/modules/_array-copy-within.js")}),n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js")("copyWithin")},"./node_modules/core-js/modules/es6.array.every.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.every.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(4);r(r.P+r.F*!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},"./node_modules/core-js/modules/es6.array.fill.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.fill.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.P,"Array",{fill:n(/*! ./_array-fill */"./node_modules/core-js/modules/_array-fill.js")}),n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js")("fill")},"./node_modules/core-js/modules/es6.array.filter.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.filter.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(2);r(r.P+r.F*!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},"./node_modules/core-js/modules/es6.array.find-index.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.find-index.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(6),o="findIndex",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),r(r.P+r.F*s,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js")(o)},"./node_modules/core-js/modules/es6.array.find.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.find.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(5),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),r(r.P+r.F*o,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js")("find")},"./node_modules/core-js/modules/es6.array.for-each.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.for-each.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(0),o=n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].forEach,!0);r(r.P+r.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},"./node_modules/core-js/modules/es6.array.from.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.from.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),i=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),o=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),s=n(/*! ./_iter-call */"./node_modules/core-js/modules/_iter-call.js"),a=n(/*! ./_is-array-iter */"./node_modules/core-js/modules/_is-array-iter.js"),l=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),c=n(/*! ./_create-property */"./node_modules/core-js/modules/_create-property.js"),u=n(/*! ./core.get-iterator-method */"./node_modules/core-js/modules/core.get-iterator-method.js");i(i.S+i.F*!n(/*! ./_iter-detect */"./node_modules/core-js/modules/_iter-detect.js")((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,d,h=o(e),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,g=void 0!==m,v=0,y=u(h);if(g&&(m=r(m,p>2?arguments[2]:void 0,2)),null==y||f==Array&&a(y))for(n=new f(t=l(h.length));t>v;v++)c(n,v,g?m(h[v],v):h[v]);else for(d=y.call(h),n=new f;!(i=d.next()).done;v++)c(n,v,g?s(d,m,[i.value,v],!0):i.value);return n.length=v,n}})},"./node_modules/core-js/modules/es6.array.index-of.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.index-of.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-includes */"./node_modules/core-js/modules/_array-includes.js")(!1),o=[].indexOf,s=!!o&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(s||!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")(o)),"Array",{indexOf:function(e){return s?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},"./node_modules/core-js/modules/es6.array.is-array.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.is-array.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Array",{isArray:n(/*! ./_is-array */"./node_modules/core-js/modules/_is-array.js")})},"./node_modules/core-js/modules/es6.array.iterator.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.iterator.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js"),i=n(/*! ./_iter-step */"./node_modules/core-js/modules/_iter-step.js"),o=n(/*! ./_iterators */"./node_modules/core-js/modules/_iterators.js"),s=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js");e.exports=n(/*! ./_iter-define */"./node_modules/core-js/modules/_iter-define.js")(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},"./node_modules/core-js/modules/es6.array.join.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.join.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),o=[].join;r(r.P+r.F*(n(/*! ./_iobject */"./node_modules/core-js/modules/_iobject.js")!=Object||!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")(o)),"Array",{join:function(e){return o.call(i(this),void 0===e?",":e)}})},"./node_modules/core-js/modules/es6.array.last-index-of.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.last-index-of.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),o=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),s=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),a=[].lastIndexOf,l=!!a&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(l||!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")(a)),"Array",{lastIndexOf:function(e){if(l)return a.apply(this,arguments)||0;var t=i(this),n=s(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,o(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},"./node_modules/core-js/modules/es6.array.map.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.map.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(1);r(r.P+r.F*!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},"./node_modules/core-js/modules/es6.array.of.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.of.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_create-property */"./node_modules/core-js/modules/_create-property.js");r(r.S+r.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},"./node_modules/core-js/modules/es6.array.reduce-right.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.reduce-right.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-reduce */"./node_modules/core-js/modules/_array-reduce.js");r(r.P+r.F*!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},"./node_modules/core-js/modules/es6.array.reduce.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.reduce.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-reduce */"./node_modules/core-js/modules/_array-reduce.js");r(r.P+r.F*!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},"./node_modules/core-js/modules/es6.array.slice.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.slice.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_html */"./node_modules/core-js/modules/_html.js"),o=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js"),s=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js"),a=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),l=[].slice;r(r.P+r.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){i&&l.call(i)})),"Array",{slice:function(e,t){var n=a(this.length),r=o(this);if(t=void 0===t?n:t,"Array"==r)return l.call(this,e,t);for(var i=s(e,n),c=s(t,n),u=a(c-i),d=new Array(u),h=0;h<u;h++)d[h]="String"==r?this.charAt(i+h):this[i+h];return d}})},"./node_modules/core-js/modules/es6.array.some.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.some.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(3);r(r.P+r.F*!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},"./node_modules/core-js/modules/es6.array.sort.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.sort.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),o=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),s=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),a=[].sort,l=[1,2,3];r(r.P+r.F*(s((function(){l.sort(void 0)}))||!s((function(){l.sort(null)}))||!n(/*! ./_strict-method */"./node_modules/core-js/modules/_strict-method.js")(a)),"Array",{sort:function(e){return void 0===e?a.call(o(this)):a.call(o(this),i(e))}})},"./node_modules/core-js/modules/es6.array.species.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.array.species.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_set-species */"./node_modules/core-js/modules/_set-species.js")("Array")},"./node_modules/core-js/modules/es6.date.now.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.date.now.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Date",{now:function(){return(new Date).getTime()}})},"./node_modules/core-js/modules/es6.date.to-iso-string.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.date.to-iso-string.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_date-to-iso-string */"./node_modules/core-js/modules/_date-to-iso-string.js");r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},"./node_modules/core-js/modules/es6.date.to-json.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.date.to-json.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),o=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js");r(r.P+r.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=o(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},"./node_modules/core-js/modules/es6.date.to-primitive.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.date.to-primitive.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("toPrimitive"),i=Date.prototype;r in i||n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js")(i,r,n(/*! ./_date-to-primitive */"./node_modules/core-js/modules/_date-to-primitive.js"))},"./node_modules/core-js/modules/es6.date.to-string.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.date.to-string.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=Date.prototype,i=r.toString,o=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js")(r,"toString",(function(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"}))},"./node_modules/core-js/modules/es6.function.bind.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.function.bind.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.P,"Function",{bind:n(/*! ./_bind */"./node_modules/core-js/modules/_bind.js")})},"./node_modules/core-js/modules/es6.function.has-instance.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.function.has-instance.js ***!
  \*******************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js"),o=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("hasInstance"),s=Function.prototype;o in s||n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f(s,o,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},"./node_modules/core-js/modules/es6.function.name.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.function.name.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},"./node_modules/core-js/modules/es6.map.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/es6.map.js ***!
  \*************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_collection-strong */"./node_modules/core-js/modules/_collection-strong.js"),i=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js");e.exports=n(/*! ./_collection */"./node_modules/core-js/modules/_collection.js")("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},"./node_modules/core-js/modules/es6.math.acosh.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.acosh.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_math-log1p */"./node_modules/core-js/modules/_math-log1p.js"),o=Math.sqrt,s=Math.acosh;r(r.S+r.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},"./node_modules/core-js/modules/es6.math.asinh.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.asinh.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},"./node_modules/core-js/modules/es6.math.atanh.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.atanh.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},"./node_modules/core-js/modules/es6.math.cbrt.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.cbrt.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_math-sign */"./node_modules/core-js/modules/_math-sign.js");r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},"./node_modules/core-js/modules/es6.math.clz32.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.clz32.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},"./node_modules/core-js/modules/es6.math.cosh.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.cosh.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},"./node_modules/core-js/modules/es6.math.expm1.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.expm1.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_math-expm1 */"./node_modules/core-js/modules/_math-expm1.js");r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},"./node_modules/core-js/modules/es6.math.fround.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.fround.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{fround:n(/*! ./_math-fround */"./node_modules/core-js/modules/_math-fround.js")})},"./node_modules/core-js/modules/es6.math.hypot.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.hypot.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,o=0,s=0,a=arguments.length,l=0;s<a;)l<(n=i(arguments[s++]))?(o=o*(r=l/n)*r+1,l=n):o+=n>0?(r=n/l)*r:n;return l===1/0?1/0:l*Math.sqrt(o)}})},"./node_modules/core-js/modules/es6.math.imul.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.imul.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=Math.imul;r(r.S+r.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r;return 0|i*o+((65535&n>>>16)*o+i*(65535&r>>>16)<<16>>>0)}})},"./node_modules/core-js/modules/es6.math.log10.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.log10.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},"./node_modules/core-js/modules/es6.math.log1p.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.log1p.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{log1p:n(/*! ./_math-log1p */"./node_modules/core-js/modules/_math-log1p.js")})},"./node_modules/core-js/modules/es6.math.log2.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.log2.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},"./node_modules/core-js/modules/es6.math.sign.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.sign.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{sign:n(/*! ./_math-sign */"./node_modules/core-js/modules/_math-sign.js")})},"./node_modules/core-js/modules/es6.math.sinh.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.sinh.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_math-expm1 */"./node_modules/core-js/modules/_math-expm1.js"),o=Math.exp;r(r.S+r.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},"./node_modules/core-js/modules/es6.math.tanh.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.tanh.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_math-expm1 */"./node_modules/core-js/modules/_math-expm1.js"),o=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(o(e)+o(-e))}})},"./node_modules/core-js/modules/es6.math.trunc.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.math.trunc.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},"./node_modules/core-js/modules/es6.number.constructor.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.constructor.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),o=n(/*! ./_cof */"./node_modules/core-js/modules/_cof.js"),s=n(/*! ./_inherit-if-required */"./node_modules/core-js/modules/_inherit-if-required.js"),a=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js"),l=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),c=n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js").f,u=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js").f,d=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,h=n(/*! ./_string-trim */"./node_modules/core-js/modules/_string-trim.js").trim,f=r.Number,p=f,m=f.prototype,g="Number"==o(n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js")(m)),v="trim"in String.prototype,y=function(e){var t=a(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,o=(t=v?t.trim():h(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var s,l=t.slice(2),c=0,u=l.length;c<u;c++)if((s=l.charCodeAt(c))<48||s>i)return NaN;return parseInt(l,r)}}return+t};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof f&&(g?l((function(){m.valueOf.call(n)})):"Number"!=o(n))?s(new p(y(t)),n,f):y(t)};for(var _,b=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;b.length>x;x++)i(p,_=b[x])&&!i(f,_)&&d(f,_,u(p,_));f.prototype=m,m.constructor=f,n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js")(r,"Number",f)}},"./node_modules/core-js/modules/es6.number.epsilon.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.epsilon.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},"./node_modules/core-js/modules/es6.number.is-finite.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.is-finite.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},"./node_modules/core-js/modules/es6.number.is-integer.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.is-integer.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Number",{isInteger:n(/*! ./_is-integer */"./node_modules/core-js/modules/_is-integer.js")})},"./node_modules/core-js/modules/es6.number.is-nan.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.is-nan.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Number",{isNaN:function(e){return e!=e}})},"./node_modules/core-js/modules/es6.number.is-safe-integer.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.is-safe-integer.js ***!
  \********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_is-integer */"./node_modules/core-js/modules/_is-integer.js"),o=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},"./node_modules/core-js/modules/es6.number.max-safe-integer.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.max-safe-integer.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},"./node_modules/core-js/modules/es6.number.min-safe-integer.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.min-safe-integer.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},"./node_modules/core-js/modules/es6.number.parse-float.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.parse-float.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_parse-float */"./node_modules/core-js/modules/_parse-float.js");r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},"./node_modules/core-js/modules/es6.number.parse-int.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.parse-int.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_parse-int */"./node_modules/core-js/modules/_parse-int.js");r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},"./node_modules/core-js/modules/es6.number.to-fixed.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.to-fixed.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),o=n(/*! ./_a-number-value */"./node_modules/core-js/modules/_a-number-value.js"),s=n(/*! ./_string-repeat */"./node_modules/core-js/modules/_string-repeat.js"),a=1..toFixed,l=Math.floor,c=[0,0,0,0,0,0],u="Number.toFixed: incorrect invocation!",d=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*c[n],c[n]=r%1e7,r=l(r/1e7)},h=function(e){for(var t=6,n=0;--t>=0;)n+=c[t],c[t]=l(n/e),n=n%e*1e7},f=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==c[e]){var n=String(c[e]);t=""===t?n:t+s.call("0",7-n.length)+n}return t},p=function(e,t,n){return 0===t?n:t%2==1?p(e,t-1,n*e):p(e*e,t/2,n)};r(r.P+r.F*(!!a&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){a.call({})}))),"Number",{toFixed:function(e){var t,n,r,a,l=o(this,u),c=i(e),m="",g="0";if(c<0||c>20)throw RangeError(u);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(m="-",l=-l),l>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(l*p(2,69,1))-69)<0?l*p(2,-t,1):l/p(2,t,1),n*=4503599627370496,(t=52-t)>0){for(d(0,n),r=c;r>=7;)d(1e7,0),r-=7;for(d(p(10,r,1),0),r=t-1;r>=23;)h(1<<23),r-=23;h(1<<r),d(1,1),h(2),g=f()}else d(0,n),d(1<<-t,0),g=f()+s.call("0",c);return g=c>0?m+((a=g.length)<=c?"0."+s.call("0",c-a)+g:g.slice(0,a-c)+"."+g.slice(a-c)):m+g}})},"./node_modules/core-js/modules/es6.number.to-precision.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.number.to-precision.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),o=n(/*! ./_a-number-value */"./node_modules/core-js/modules/_a-number-value.js"),s=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==s.call(1,void 0)}))||!i((function(){s.call({})}))),"Number",{toPrecision:function(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?s.call(t):s.call(t,e)}})},"./node_modules/core-js/modules/es6.object.assign.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.assign.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S+r.F,"Object",{assign:n(/*! ./_object-assign */"./node_modules/core-js/modules/_object-assign.js")})},"./node_modules/core-js/modules/es6.object.create.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.create.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Object",{create:n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js")})},"./node_modules/core-js/modules/es6.object.define-properties.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.define-properties.js ***!
  \**********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S+r.F*!n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),"Object",{defineProperties:n(/*! ./_object-dps */"./node_modules/core-js/modules/_object-dps.js")})},"./node_modules/core-js/modules/es6.object.define-property.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.define-property.js ***!
  \********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S+r.F*!n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),"Object",{defineProperty:n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f})},"./node_modules/core-js/modules/es6.object.freeze.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.freeze.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js").onFreeze;n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},"./node_modules/core-js/modules/es6.object.get-own-property-descriptor.js":
/*!********************************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.get-own-property-descriptor.js ***!
  \********************************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),i=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js").f;n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},"./node_modules/core-js/modules/es6.object.get-own-property-names.js":
/*!***************************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.get-own-property-names.js ***!
  \***************************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("getOwnPropertyNames",(function(){return n(/*! ./_object-gopn-ext */"./node_modules/core-js/modules/_object-gopn-ext.js").f}))},"./node_modules/core-js/modules/es6.object.get-prototype-of.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.get-prototype-of.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),i=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js");n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},"./node_modules/core-js/modules/es6.object.is-extensible.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.is-extensible.js ***!
  \******************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},"./node_modules/core-js/modules/es6.object.is-frozen.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.is-frozen.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},"./node_modules/core-js/modules/es6.object.is-sealed.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.is-sealed.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},"./node_modules/core-js/modules/es6.object.is.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.is.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Object",{is:n(/*! ./_same-value */"./node_modules/core-js/modules/_same-value.js")})},"./node_modules/core-js/modules/es6.object.keys.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.keys.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),i=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js");n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("keys",(function(){return function(e){return i(r(e))}}))},"./node_modules/core-js/modules/es6.object.prevent-extensions.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.prevent-extensions.js ***!
  \***********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js").onFreeze;n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},"./node_modules/core-js/modules/es6.object.seal.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.seal.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),i=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js").onFreeze;n(/*! ./_object-sap */"./node_modules/core-js/modules/_object-sap.js")("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},"./node_modules/core-js/modules/es6.object.set-prototype-of.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.set-prototype-of.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Object",{setPrototypeOf:n(/*! ./_set-proto */"./node_modules/core-js/modules/_set-proto.js").set})},"./node_modules/core-js/modules/es6.object.to-string.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.object.to-string.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_classof */"./node_modules/core-js/modules/_classof.js"),i={};i[n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("toStringTag")]="z",i+""!="[object z]"&&n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js")(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},"./node_modules/core-js/modules/es6.parse-float.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.parse-float.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_parse-float */"./node_modules/core-js/modules/_parse-float.js");r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},"./node_modules/core-js/modules/es6.parse-int.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.parse-int.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_parse-int */"./node_modules/core-js/modules/_parse-int.js");r(r.G+r.F*(parseInt!=i),{parseInt:i})},"./node_modules/core-js/modules/es6.promise.js":
/*!*****************************************************!*\
  !*** ./node_modules/core-js/modules/es6.promise.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r,i,o,s,a=n(/*! ./_library */"./node_modules/core-js/modules/_library.js"),l=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),c=n(/*! ./_ctx */"./node_modules/core-js/modules/_ctx.js"),u=n(/*! ./_classof */"./node_modules/core-js/modules/_classof.js"),d=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),h=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),f=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),p=n(/*! ./_an-instance */"./node_modules/core-js/modules/_an-instance.js"),m=n(/*! ./_for-of */"./node_modules/core-js/modules/_for-of.js"),g=n(/*! ./_species-constructor */"./node_modules/core-js/modules/_species-constructor.js"),v=n(/*! ./_task */"./node_modules/core-js/modules/_task.js").set,y=n(/*! ./_microtask */"./node_modules/core-js/modules/_microtask.js")(),_=n(/*! ./_new-promise-capability */"./node_modules/core-js/modules/_new-promise-capability.js"),b=n(/*! ./_perform */"./node_modules/core-js/modules/_perform.js"),x=n(/*! ./_user-agent */"./node_modules/core-js/modules/_user-agent.js"),w=n(/*! ./_promise-resolve */"./node_modules/core-js/modules/_promise-resolve.js"),E=l.TypeError,A=l.process,M=A&&A.versions,S=M&&M.v8||"",T=l.Promise,C="process"==u(A),P=function(){},L=i=_.f,D=!!function(){try{var e=T.resolve(1),t=(e.constructor={})[n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("species")]=function(e){e(P,P)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==S.indexOf("6.6")&&-1===x.indexOf("Chrome/66")}catch(e){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var n=e._c;y((function(){for(var r=e._v,i=1==e._s,o=0,s=function(t){var n,o,s,a=i?t.ok:t.fail,l=t.resolve,c=t.reject,u=t.domain;try{a?(i||(2==e._h&&N(e),e._h=1),!0===a?n=r:(u&&u.enter(),n=a(r),u&&(u.exit(),s=!0)),n===t.promise?c(E("Promise-chain cycle")):(o=R(n))?o.call(n,l,c):l(n)):c(r)}catch(e){u&&!s&&u.exit(),c(e)}};n.length>o;)s(n[o++]);e._c=[],e._n=!1,t&&!e._h&&j(e)}))}},j=function(e){v.call(l,(function(){var t,n,r,i=e._v,o=O(e);if(o&&(t=b((function(){C?A.emit("unhandledRejection",i,e):(n=l.onunhandledrejection)?n({promise:e,reason:i}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=C||O(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},O=function(e){return 1!==e._h&&0===(e._a||e._c).length},N=function(e){v.call(l,(function(){var t;C?A.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},k=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw E("Promise can't be resolved itself");(t=R(e))?y((function(){var r={_w:n,_d:!1};try{t.call(e,c(F,r,1),c(k,r,1))}catch(e){k.call(r,e)}})):(n._v=e,n._s=1,I(n,!1))}catch(e){k.call({_w:n,_d:!1},e)}}};D||(T=function(e){p(this,T,"Promise","_h"),f(e),r.call(this);try{e(c(F,this,1),c(k,this,1))}catch(e){k.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(/*! ./_redefine-all */"./node_modules/core-js/modules/_redefine-all.js")(T.prototype,{then:function(e,t){var n=L(g(this,T));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?A.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=c(F,e,1),this.reject=c(k,e,1)},_.f=L=function(e){return e===T||e===s?new o(e):i(e)}),d(d.G+d.W+d.F*!D,{Promise:T}),n(/*! ./_set-to-string-tag */"./node_modules/core-js/modules/_set-to-string-tag.js")(T,"Promise"),n(/*! ./_set-species */"./node_modules/core-js/modules/_set-species.js")("Promise"),s=n(/*! ./_core */"./node_modules/core-js/modules/_core.js").Promise,d(d.S+d.F*!D,"Promise",{reject:function(e){var t=L(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(a||!D),"Promise",{resolve:function(e){return w(a&&this===s?T:this,e)}}),d(d.S+d.F*!(D&&n(/*! ./_iter-detect */"./node_modules/core-js/modules/_iter-detect.js")((function(e){T.all(e).catch(P)}))),"Promise",{all:function(e){var t=this,n=L(t),r=n.resolve,i=n.reject,o=b((function(){var n=[],o=0,s=1;m(e,!1,(function(e){var a=o++,l=!1;n.push(void 0),s++,t.resolve(e).then((function(e){l||(l=!0,n[a]=e,--s||r(n))}),i)})),--s||r(n)}));return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=L(t),r=n.reject,i=b((function(){m(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},"./node_modules/core-js/modules/es6.reflect.apply.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.apply.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),s=(n(/*! ./_global */"./node_modules/core-js/modules/_global.js").Reflect||{}).apply,a=Function.apply;r(r.S+r.F*!n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){s((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),l=o(n);return s?s(r,t,l):a.call(r,t,l)}})},"./node_modules/core-js/modules/es6.reflect.construct.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.construct.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js"),o=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),s=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),a=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),l=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),c=n(/*! ./_bind */"./node_modules/core-js/modules/_bind.js"),u=(n(/*! ./_global */"./node_modules/core-js/modules/_global.js").Reflect||{}).construct,d=l((function(){function e(){}return!(u((function(){}),[],e)instanceof e)})),h=!l((function(){u((function(){}))}));r(r.S+r.F*(d||h),"Reflect",{construct:function(e,t){o(e),s(t);var n=arguments.length<3?e:o(arguments[2]);if(h&&!d)return u(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var l=n.prototype,f=i(a(l)?l:Object.prototype),p=Function.apply.call(e,f,t);return a(p)?p:f}})},"./node_modules/core-js/modules/es6.reflect.define-property.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.define-property.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),i=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),s=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js");i(i.S+i.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){o(e),t=s(t,!0),o(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},"./node_modules/core-js/modules/es6.reflect.delete-property.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.delete-property.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js").f,o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js");r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(o(e),t);return!(n&&!n.configurable)&&delete e[t]}})},"./node_modules/core-js/modules/es6.reflect.enumerate.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.enumerate.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),o=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(/*! ./_iter-create */"./node_modules/core-js/modules/_iter-create.js")(o,"Object",(function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new o(e)}})},"./node_modules/core-js/modules/es6.reflect.get-own-property-descriptor.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.get-own-property-descriptor.js ***!
  \*********************************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js"),i=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js");i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(o(e),t)}})},"./node_modules/core-js/modules/es6.reflect.get-prototype-of.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.get-prototype-of.js ***!
  \**********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js"),o=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js");r(r.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},"./node_modules/core-js/modules/es6.reflect.get.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.get.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js"),i=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js"),o=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),s=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),a=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),l=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js");s(s.S,"Reflect",{get:function e(t,n){var s,c,u=arguments.length<3?t:arguments[2];return l(t)===u?t[n]:(s=r.f(t,n))?o(s,"value")?s.value:void 0!==s.get?s.get.call(u):void 0:a(c=i(t))?e(c,n,u):void 0}})},"./node_modules/core-js/modules/es6.reflect.has.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.has.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Reflect",{has:function(e,t){return t in e}})},"./node_modules/core-js/modules/es6.reflect.is-extensible.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.is-extensible.js ***!
  \*******************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),o=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!o||o(e)}})},"./node_modules/core-js/modules/es6.reflect.own-keys.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.own-keys.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.S,"Reflect",{ownKeys:n(/*! ./_own-keys */"./node_modules/core-js/modules/_own-keys.js")})},"./node_modules/core-js/modules/es6.reflect.prevent-extensions.js":
/*!************************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.prevent-extensions.js ***!
  \************************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),o=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},"./node_modules/core-js/modules/es6.reflect.set-prototype-of.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.set-prototype-of.js ***!
  \**********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_set-proto */"./node_modules/core-js/modules/_set-proto.js");i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},"./node_modules/core-js/modules/es6.reflect.set.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.reflect.set.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),i=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js"),o=n(/*! ./_object-gpo */"./node_modules/core-js/modules/_object-gpo.js"),s=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),a=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),l=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js"),c=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),u=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js");a(a.S,"Reflect",{set:function e(t,n,a){var d,h,f=arguments.length<4?t:arguments[3],p=i.f(c(t),n);if(!p){if(u(h=o(t)))return e(h,n,a,f);p=l(0)}if(s(p,"value")){if(!1===p.writable||!u(f))return!1;if(d=i.f(f,n)){if(d.get||d.set||!1===d.writable)return!1;d.value=a,r.f(f,n,d)}else r.f(f,n,l(0,a));return!0}return void 0!==p.set&&(p.set.call(f,a),!0)}})},"./node_modules/core-js/modules/es6.regexp.constructor.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.constructor.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_inherit-if-required */"./node_modules/core-js/modules/_inherit-if-required.js"),o=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f,s=n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js").f,a=n(/*! ./_is-regexp */"./node_modules/core-js/modules/_is-regexp.js"),l=n(/*! ./_flags */"./node_modules/core-js/modules/_flags.js"),c=r.RegExp,u=c,d=c.prototype,h=/a/g,f=/a/g,p=new c(h)!==h;if(n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")&&(!p||n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return f[n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js")("match")]=!1,c(h)!=h||c(f)==f||"/a/i"!=c(h,"i")})))){c=function(e,t){var n=this instanceof c,r=a(e),o=void 0===t;return!n&&r&&e.constructor===c&&o?e:i(p?new u(r&&!o?e.source:e,t):u((r=e instanceof c)?e.source:e,r&&o?l.call(e):t),n?this:d,c)};for(var m=function(e){e in c||o(c,e,{configurable:!0,get:function(){return u[e]},set:function(t){u[e]=t}})},g=s(u),v=0;g.length>v;)m(g[v++]);d.constructor=c,c.prototype=d,n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js")(r,"RegExp",c)}n(/*! ./_set-species */"./node_modules/core-js/modules/_set-species.js")("RegExp")},"./node_modules/core-js/modules/es6.regexp.exec.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.exec.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_regexp-exec */"./node_modules/core-js/modules/_regexp-exec.js");n(/*! ./_export */"./node_modules/core-js/modules/_export.js")({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},"./node_modules/core-js/modules/es6.regexp.flags.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.flags.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js")&&"g"!=/./g.flags&&n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js").f(RegExp.prototype,"flags",{configurable:!0,get:n(/*! ./_flags */"./node_modules/core-js/modules/_flags.js")})},"./node_modules/core-js/modules/es6.regexp.match.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.match.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),o=n(/*! ./_advance-string-index */"./node_modules/core-js/modules/_advance-string-index.js"),s=n(/*! ./_regexp-exec-abstract */"./node_modules/core-js/modules/_regexp-exec-abstract.js");n(/*! ./_fix-re-wks */"./node_modules/core-js/modules/_fix-re-wks.js")("match",1,(function(e,t,n,a){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=a(n,e,this);if(t.done)return t.value;var l=r(e),c=String(this);if(!l.global)return s(l,c);var u=l.unicode;l.lastIndex=0;for(var d,h=[],f=0;null!==(d=s(l,c));){var p=String(d[0]);h[f]=p,""===p&&(l.lastIndex=o(c,i(l.lastIndex),u)),f++}return 0===f?null:h}]}))},"./node_modules/core-js/modules/es6.regexp.replace.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.replace.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),o=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),s=n(/*! ./_to-integer */"./node_modules/core-js/modules/_to-integer.js"),a=n(/*! ./_advance-string-index */"./node_modules/core-js/modules/_advance-string-index.js"),l=n(/*! ./_regexp-exec-abstract */"./node_modules/core-js/modules/_regexp-exec-abstract.js"),c=Math.max,u=Math.min,d=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,f=/\$([$&`']|\d\d?)/g;n(/*! ./_fix-re-wks */"./node_modules/core-js/modules/_fix-re-wks.js")("replace",2,(function(e,t,n,p){return[function(r,i){var o=e(this),s=null==r?void 0:r[t];return void 0!==s?s.call(r,o,i):n.call(String(o),r,i)},function(e,t){var i=p(n,e,this,t);if(i.done)return i.value;var d=r(e),h=String(this),f="function"==typeof t;f||(t=String(t));var g=d.global;if(g){var v=d.unicode;d.lastIndex=0}for(var y=[];;){var _=l(d,h);if(null===_)break;if(y.push(_),!g)break;""===String(_[0])&&(d.lastIndex=a(h,o(d.lastIndex),v))}for(var b,x="",w=0,E=0;E<y.length;E++){_=y[E];for(var A=String(_[0]),M=c(u(s(_.index),h.length),0),S=[],T=1;T<_.length;T++)S.push(void 0===(b=_[T])?b:String(b));var C=_.groups;if(f){var P=[A].concat(S,M,h);void 0!==C&&P.push(C);var L=String(t.apply(void 0,P))}else L=m(A,h,M,S,C,t);M>=w&&(x+=h.slice(w,M)+L,w=M+A.length)}return x+h.slice(w)}];function m(e,t,r,o,s,a){var l=r+e.length,c=o.length,u=f;return void 0!==s&&(s=i(s),u=h),n.call(a,u,(function(n,i){var a;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(l);case"<":a=s[i.slice(1,-1)];break;default:var u=+i;if(0===u)return n;if(u>c){var h=d(u/10);return 0===h?n:h<=c?void 0===o[h-1]?i.charAt(1):o[h-1]+i.charAt(1):n}a=o[u-1]}return void 0===a?"":a}))}}))},"./node_modules/core-js/modules/es6.regexp.search.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.search.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_same-value */"./node_modules/core-js/modules/_same-value.js"),o=n(/*! ./_regexp-exec-abstract */"./node_modules/core-js/modules/_regexp-exec-abstract.js");n(/*! ./_fix-re-wks */"./node_modules/core-js/modules/_fix-re-wks.js")("search",1,(function(e,t,n,s){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var a=r(e),l=String(this),c=a.lastIndex;i(c,0)||(a.lastIndex=0);var u=o(a,l);return i(a.lastIndex,c)||(a.lastIndex=c),null===u?-1:u.index}]}))},"./node_modules/core-js/modules/es6.regexp.split.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.split.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_is-regexp */"./node_modules/core-js/modules/_is-regexp.js"),i=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),o=n(/*! ./_species-constructor */"./node_modules/core-js/modules/_species-constructor.js"),s=n(/*! ./_advance-string-index */"./node_modules/core-js/modules/_advance-string-index.js"),a=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),l=n(/*! ./_regexp-exec-abstract */"./node_modules/core-js/modules/_regexp-exec-abstract.js"),c=n(/*! ./_regexp-exec */"./node_modules/core-js/modules/_regexp-exec.js"),u=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),d=Math.min,h=[].push,f="length",p=!u((function(){RegExp(4294967295,"y")}));n(/*! ./_fix-re-wks */"./node_modules/core-js/modules/_fix-re-wks.js")("split",2,(function(e,t,n,u){var m;return m="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[f]||2!="ab".split(/(?:ab)*/)[f]||4!=".".split(/(.?)(.?)/)[f]||".".split(/()()/)[f]>1||"".split(/.?/)[f]?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var o,s,a,l=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,p=void 0===t?4294967295:t>>>0,m=new RegExp(e.source,u+"g");(o=c.call(m,i))&&!((s=m.lastIndex)>d&&(l.push(i.slice(d,o.index)),o[f]>1&&o.index<i[f]&&h.apply(l,o.slice(1)),a=o[0][f],d=s,l[f]>=p));)m.lastIndex===o.index&&m.lastIndex++;return d===i[f]?!a&&m.test("")||l.push(""):l.push(i.slice(d)),l[f]>p?l.slice(0,p):l}:"0".split(void 0,0)[f]?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,i,r):m.call(String(i),n,r)},function(e,t){var r=u(m,e,this,t,m!==n);if(r.done)return r.value;var c=i(e),h=String(this),f=o(c,RegExp),g=c.unicode,v=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(p?"y":"g"),y=new f(p?c:"^(?:"+c.source+")",v),_=void 0===t?4294967295:t>>>0;if(0===_)return[];if(0===h.length)return null===l(y,h)?[h]:[];for(var b=0,x=0,w=[];x<h.length;){y.lastIndex=p?x:0;var E,A=l(y,p?h:h.slice(x));if(null===A||(E=d(a(y.lastIndex+(p?0:x)),h.length))===b)x=s(h,x,g);else{if(w.push(h.slice(b,x)),w.length===_)return w;for(var M=1;M<=A.length-1;M++)if(w.push(A[M]),w.length===_)return w;x=b=E}}return w.push(h.slice(b)),w}]}))},"./node_modules/core-js/modules/es6.regexp.to-string.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.regexp.to-string.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./es6.regexp.flags */"./node_modules/core-js/modules/es6.regexp.flags.js");var r=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),i=n(/*! ./_flags */"./node_modules/core-js/modules/_flags.js"),o=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),s=/./.toString,a=function(e){n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js")(RegExp.prototype,"toString",e,!0)};n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return"/a/b"!=s.call({source:"a",flags:"b"})}))?a((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):"toString"!=s.name&&a((function(){return s.call(this)}))},"./node_modules/core-js/modules/es6.set.js":
/*!*************************************************!*\
  !*** ./node_modules/core-js/modules/es6.set.js ***!
  \*************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_collection-strong */"./node_modules/core-js/modules/_collection-strong.js"),i=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js");e.exports=n(/*! ./_collection */"./node_modules/core-js/modules/_collection.js")("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},"./node_modules/core-js/modules/es6.string.anchor.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.anchor.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},"./node_modules/core-js/modules/es6.string.big.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.big.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("big",(function(e){return function(){return e(this,"big","","")}}))},"./node_modules/core-js/modules/es6.string.blink.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.blink.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("blink",(function(e){return function(){return e(this,"blink","","")}}))},"./node_modules/core-js/modules/es6.string.bold.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.bold.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("bold",(function(e){return function(){return e(this,"b","","")}}))},"./node_modules/core-js/modules/es6.string.code-point-at.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.code-point-at.js ***!
  \******************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_string-at */"./node_modules/core-js/modules/_string-at.js")(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},"./node_modules/core-js/modules/es6.string.ends-with.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.ends-with.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),o=n(/*! ./_string-context */"./node_modules/core-js/modules/_string-context.js"),s="".endsWith;r(r.P+r.F*n(/*! ./_fails-is-regexp */"./node_modules/core-js/modules/_fails-is-regexp.js")("endsWith"),"String",{endsWith:function(e){var t=o(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),a=void 0===n?r:Math.min(i(n),r),l=String(e);return s?s.call(t,l,a):t.slice(a-l.length,a)===l}})},"./node_modules/core-js/modules/es6.string.fixed.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.fixed.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("fixed",(function(e){return function(){return e(this,"tt","","")}}))},"./node_modules/core-js/modules/es6.string.fontcolor.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.fontcolor.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},"./node_modules/core-js/modules/es6.string.fontsize.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.fontsize.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},"./node_modules/core-js/modules/es6.string.from-code-point.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.from-code-point.js ***!
  \********************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js"),o=String.fromCharCode,s=String.fromCodePoint;r(r.S+r.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,s=0;r>s;){if(t=+arguments[s++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},"./node_modules/core-js/modules/es6.string.includes.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.includes.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_string-context */"./node_modules/core-js/modules/_string-context.js");r(r.P+r.F*n(/*! ./_fails-is-regexp */"./node_modules/core-js/modules/_fails-is-regexp.js")("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es6.string.italics.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.italics.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("italics",(function(e){return function(){return e(this,"i","","")}}))},"./node_modules/core-js/modules/es6.string.iterator.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.iterator.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_string-at */"./node_modules/core-js/modules/_string-at.js")(!0);n(/*! ./_iter-define */"./node_modules/core-js/modules/_iter-define.js")(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},"./node_modules/core-js/modules/es6.string.link.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.link.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("link",(function(e){return function(t){return e(this,"a","href",t)}}))},"./node_modules/core-js/modules/es6.string.raw.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.raw.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),o=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js");r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=o(t.length),r=arguments.length,s=[],a=0;n>a;)s.push(String(t[a++])),a<r&&s.push(String(arguments[a]));return s.join("")}})},"./node_modules/core-js/modules/es6.string.repeat.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.repeat.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.P,"String",{repeat:n(/*! ./_string-repeat */"./node_modules/core-js/modules/_string-repeat.js")})},"./node_modules/core-js/modules/es6.string.small.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.small.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("small",(function(e){return function(){return e(this,"small","","")}}))},"./node_modules/core-js/modules/es6.string.starts-with.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.starts-with.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),o=n(/*! ./_string-context */"./node_modules/core-js/modules/_string-context.js"),s="".startsWith;r(r.P+r.F*n(/*! ./_fails-is-regexp */"./node_modules/core-js/modules/_fails-is-regexp.js")("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return s?s.call(t,r,n):t.slice(n,n+r.length)===r}})},"./node_modules/core-js/modules/es6.string.strike.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.strike.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("strike",(function(e){return function(){return e(this,"strike","","")}}))},"./node_modules/core-js/modules/es6.string.sub.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.sub.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("sub",(function(e){return function(){return e(this,"sub","","")}}))},"./node_modules/core-js/modules/es6.string.sup.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.sup.js ***!
  \********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-html */"./node_modules/core-js/modules/_string-html.js")("sup",(function(e){return function(){return e(this,"sup","","")}}))},"./node_modules/core-js/modules/es6.string.trim.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/modules/es6.string.trim.js ***!
  \*********************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-trim */"./node_modules/core-js/modules/_string-trim.js")("trim",(function(e){return function(){return e(this,3)}}))},"./node_modules/core-js/modules/es6.symbol.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/es6.symbol.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_has */"./node_modules/core-js/modules/_has.js"),o=n(/*! ./_descriptors */"./node_modules/core-js/modules/_descriptors.js"),s=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),a=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),l=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js").KEY,c=n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js"),u=n(/*! ./_shared */"./node_modules/core-js/modules/_shared.js"),d=n(/*! ./_set-to-string-tag */"./node_modules/core-js/modules/_set-to-string-tag.js"),h=n(/*! ./_uid */"./node_modules/core-js/modules/_uid.js"),f=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js"),p=n(/*! ./_wks-ext */"./node_modules/core-js/modules/_wks-ext.js"),m=n(/*! ./_wks-define */"./node_modules/core-js/modules/_wks-define.js"),g=n(/*! ./_enum-keys */"./node_modules/core-js/modules/_enum-keys.js"),v=n(/*! ./_is-array */"./node_modules/core-js/modules/_is-array.js"),y=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),_=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),b=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),x=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),w=n(/*! ./_to-primitive */"./node_modules/core-js/modules/_to-primitive.js"),E=n(/*! ./_property-desc */"./node_modules/core-js/modules/_property-desc.js"),A=n(/*! ./_object-create */"./node_modules/core-js/modules/_object-create.js"),M=n(/*! ./_object-gopn-ext */"./node_modules/core-js/modules/_object-gopn-ext.js"),S=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js"),T=n(/*! ./_object-gops */"./node_modules/core-js/modules/_object-gops.js"),C=n(/*! ./_object-dp */"./node_modules/core-js/modules/_object-dp.js"),P=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js"),L=S.f,D=C.f,R=M.f,I=r.Symbol,j=r.JSON,O=j&&j.stringify,N=f("_hidden"),k=f("toPrimitive"),F={}.propertyIsEnumerable,V=u("symbol-registry"),B=u("symbols"),U=u("op-symbols"),z=Object.prototype,G="function"==typeof I&&!!T.f,H=r.QObject,W=!H||!H.prototype||!H.prototype.findChild,X=o&&c((function(){return 7!=A(D({},"a",{get:function(){return D(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=L(z,t);r&&delete z[t],D(e,t,n),r&&e!==z&&D(z,t,r)}:D,q=function(e){var t=B[e]=A(I.prototype);return t._k=e,t},Y=G&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},K=function(e,t,n){return e===z&&K(U,t,n),y(e),t=w(t,!0),y(n),i(B,t)?(n.enumerable?(i(e,N)&&e[N][t]&&(e[N][t]=!1),n=A(n,{enumerable:E(0,!1)})):(i(e,N)||D(e,N,E(1,{})),e[N][t]=!0),X(e,t,n)):D(e,t,n)},Q=function(e,t){y(e);for(var n,r=g(t=x(t)),i=0,o=r.length;o>i;)K(e,n=r[i++],t[n]);return e},Z=function(e){var t=F.call(this,e=w(e,!0));return!(this===z&&i(B,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,N)&&this[N][e])||t)},J=function(e,t){if(e=x(e),t=w(t,!0),e!==z||!i(B,t)||i(U,t)){var n=L(e,t);return!n||!i(B,t)||i(e,N)&&e[N][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=R(x(e)),r=[],o=0;n.length>o;)i(B,t=n[o++])||t==N||t==l||r.push(t);return r},ee=function(e){for(var t,n=e===z,r=R(n?U:x(e)),o=[],s=0;r.length>s;)!i(B,t=r[s++])||n&&!i(z,t)||o.push(B[t]);return o};G||(a((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===z&&t.call(U,n),i(this,N)&&i(this[N],e)&&(this[N][e]=!1),X(this,e,E(1,n))};return o&&W&&X(z,e,{configurable:!0,set:t}),q(e)}).prototype,"toString",(function(){return this._k})),S.f=J,C.f=K,n(/*! ./_object-gopn */"./node_modules/core-js/modules/_object-gopn.js").f=M.f=$,n(/*! ./_object-pie */"./node_modules/core-js/modules/_object-pie.js").f=Z,T.f=ee,o&&!n(/*! ./_library */"./node_modules/core-js/modules/_library.js")&&a(z,"propertyIsEnumerable",Z,!0),p.f=function(e){return q(f(e))}),s(s.G+s.W+s.F*!G,{Symbol:I});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)f(te[ne++]);for(var re=P(f.store),ie=0;re.length>ie;)m(re[ie++]);s(s.S+s.F*!G,"Symbol",{for:function(e){return i(V,e+="")?V[e]:V[e]=I(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in V)if(V[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),s(s.S+s.F*!G,"Object",{create:function(e,t){return void 0===t?A(e):Q(A(e),t)},defineProperty:K,defineProperties:Q,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var oe=c((function(){T.f(1)}));s(s.S+s.F*oe,"Object",{getOwnPropertySymbols:function(e){return T.f(b(e))}}),j&&s(s.S+s.F*(!G||c((function(){var e=I();return"[null]"!=O([e])||"{}"!=O({a:e})||"{}"!=O(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(_(t)||void 0!==e)&&!Y(e))return v(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!Y(t))return t}),r[1]=t,O.apply(j,r)}}),I.prototype[k]||n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js")(I.prototype,k,I.prototype.valueOf),d(I,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},"./node_modules/core-js/modules/es6.typed.array-buffer.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.array-buffer.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_typed */"./node_modules/core-js/modules/_typed.js"),o=n(/*! ./_typed-buffer */"./node_modules/core-js/modules/_typed-buffer.js"),s=n(/*! ./_an-object */"./node_modules/core-js/modules/_an-object.js"),a=n(/*! ./_to-absolute-index */"./node_modules/core-js/modules/_to-absolute-index.js"),l=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),c=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),u=n(/*! ./_global */"./node_modules/core-js/modules/_global.js").ArrayBuffer,d=n(/*! ./_species-constructor */"./node_modules/core-js/modules/_species-constructor.js"),h=o.ArrayBuffer,f=o.DataView,p=i.ABV&&u.isView,m=h.prototype.slice,g=i.VIEW;r(r.G+r.W+r.F*(u!==h),{ArrayBuffer:h}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return p&&p(e)||c(e)&&g in e}}),r(r.P+r.U+r.F*n(/*! ./_fails */"./node_modules/core-js/modules/_fails.js")((function(){return!new h(2).slice(1,void 0).byteLength})),"ArrayBuffer",{slice:function(e,t){if(void 0!==m&&void 0===t)return m.call(s(this),e);for(var n=s(this).byteLength,r=a(e,n),i=a(void 0===t?n:t,n),o=new(d(this,h))(l(i-r)),c=new f(this),u=new f(o),p=0;r<i;)u.setUint8(p++,c.getUint8(r++));return o}}),n(/*! ./_set-species */"./node_modules/core-js/modules/_set-species.js")("ArrayBuffer")},"./node_modules/core-js/modules/es6.typed.data-view.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.data-view.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js");r(r.G+r.W+r.F*!n(/*! ./_typed */"./node_modules/core-js/modules/_typed.js").ABV,{DataView:n(/*! ./_typed-buffer */"./node_modules/core-js/modules/_typed-buffer.js").DataView})},"./node_modules/core-js/modules/es6.typed.float32-array.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.float32-array.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.float64-array.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.float64-array.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.int16-array.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.int16-array.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.int32-array.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.int32-array.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.int8-array.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.int8-array.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.uint16-array.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.uint16-array.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.uint32-array.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.uint32-array.js ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.uint8-array.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.uint8-array.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"./node_modules/core-js/modules/es6.typed.uint8-clamped-array.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/modules/es6.typed.uint8-clamped-array.js ***!
  \***********************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_typed-array */"./node_modules/core-js/modules/_typed-array.js")("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},"./node_modules/core-js/modules/es6.weak-map.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.weak-map.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r,i=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),o=n(/*! ./_array-methods */"./node_modules/core-js/modules/_array-methods.js")(0),s=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),a=n(/*! ./_meta */"./node_modules/core-js/modules/_meta.js"),l=n(/*! ./_object-assign */"./node_modules/core-js/modules/_object-assign.js"),c=n(/*! ./_collection-weak */"./node_modules/core-js/modules/_collection-weak.js"),u=n(/*! ./_is-object */"./node_modules/core-js/modules/_is-object.js"),d=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js"),h=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js"),f=!i.ActiveXObject&&"ActiveXObject"in i,p=a.getWeak,m=Object.isExtensible,g=c.ufstore,v=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},y={get:function(e){if(u(e)){var t=p(e);return!0===t?g(d(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(d(this,"WeakMap"),e,t)}},_=e.exports=n(/*! ./_collection */"./node_modules/core-js/modules/_collection.js")("WeakMap",v,y,c,!0,!0);h&&f&&(l((r=c.getConstructor(v,"WeakMap")).prototype,y),a.NEED=!0,o(["delete","has","get","set"],(function(e){var t=_.prototype,n=t[e];s(t,e,(function(t,i){if(u(t)&&!m(t)){this._f||(this._f=new r);var o=this._f[e](t,i);return"set"==e?this:o}return n.call(this,t,i)}))})))},"./node_modules/core-js/modules/es6.weak-set.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/modules/es6.weak-set.js ***!
  \******************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_collection-weak */"./node_modules/core-js/modules/_collection-weak.js"),i=n(/*! ./_validate-collection */"./node_modules/core-js/modules/_validate-collection.js");n(/*! ./_collection */"./node_modules/core-js/modules/_collection.js")("WeakSet",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},"./node_modules/core-js/modules/es7.array.flat-map.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.array.flat-map.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_flatten-into-array */"./node_modules/core-js/modules/_flatten-into-array.js"),o=n(/*! ./_to-object */"./node_modules/core-js/modules/_to-object.js"),s=n(/*! ./_to-length */"./node_modules/core-js/modules/_to-length.js"),a=n(/*! ./_a-function */"./node_modules/core-js/modules/_a-function.js"),l=n(/*! ./_array-species-create */"./node_modules/core-js/modules/_array-species-create.js");r(r.P,"Array",{flatMap:function(e){var t,n,r=o(this);return a(e),t=s(r.length),n=l(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js")("flatMap")},"./node_modules/core-js/modules/es7.array.includes.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.array.includes.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_array-includes */"./node_modules/core-js/modules/_array-includes.js")(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(/*! ./_add-to-unscopables */"./node_modules/core-js/modules/_add-to-unscopables.js")("includes")},"./node_modules/core-js/modules/es7.object.entries.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.object.entries.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_object-to-array */"./node_modules/core-js/modules/_object-to-array.js")(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},"./node_modules/core-js/modules/es7.object.get-own-property-descriptors.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.object.get-own-property-descriptors.js ***!
  \*********************************************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_own-keys */"./node_modules/core-js/modules/_own-keys.js"),o=n(/*! ./_to-iobject */"./node_modules/core-js/modules/_to-iobject.js"),s=n(/*! ./_object-gopd */"./node_modules/core-js/modules/_object-gopd.js"),a=n(/*! ./_create-property */"./node_modules/core-js/modules/_create-property.js");r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),l=s.f,c=i(r),u={},d=0;c.length>d;)void 0!==(n=l(r,t=c[d++]))&&a(u,t,n);return u}})},"./node_modules/core-js/modules/es7.object.values.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/modules/es7.object.values.js ***!
  \***********************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_object-to-array */"./node_modules/core-js/modules/_object-to-array.js")(!1);r(r.S,"Object",{values:function(e){return i(e)}})},"./node_modules/core-js/modules/es7.promise.finally.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.promise.finally.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_core */"./node_modules/core-js/modules/_core.js"),o=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),s=n(/*! ./_species-constructor */"./node_modules/core-js/modules/_species-constructor.js"),a=n(/*! ./_promise-resolve */"./node_modules/core-js/modules/_promise-resolve.js");r(r.P+r.R,"Promise",{finally:function(e){var t=s(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then((function(){return n}))}:e,n?function(n){return a(t,e()).then((function(){throw n}))}:e)}})},"./node_modules/core-js/modules/es7.string.pad-end.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.string.pad-end.js ***!
  \************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_string-pad */"./node_modules/core-js/modules/_string-pad.js"),o=n(/*! ./_user-agent */"./node_modules/core-js/modules/_user-agent.js"),s=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*s,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},"./node_modules/core-js/modules/es7.string.pad-start.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.string.pad-start.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_string-pad */"./node_modules/core-js/modules/_string-pad.js"),o=n(/*! ./_user-agent */"./node_modules/core-js/modules/_user-agent.js"),s=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*s,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},"./node_modules/core-js/modules/es7.string.trim-left.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.string.trim-left.js ***!
  \**************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-trim */"./node_modules/core-js/modules/_string-trim.js")("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},"./node_modules/core-js/modules/es7.string.trim-right.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.string.trim-right.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n(/*! ./_string-trim */"./node_modules/core-js/modules/_string-trim.js")("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},"./node_modules/core-js/modules/es7.symbol.async-iterator.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/modules/es7.symbol.async-iterator.js ***!
  \*******************************************************************/
/*! no static exports found */function(e,t,n){n(/*! ./_wks-define */"./node_modules/core-js/modules/_wks-define.js")("asyncIterator")},"./node_modules/core-js/modules/web.dom.iterable.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/modules/web.dom.iterable.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){for(var r=n(/*! ./es6.array.iterator */"./node_modules/core-js/modules/es6.array.iterator.js"),i=n(/*! ./_object-keys */"./node_modules/core-js/modules/_object-keys.js"),o=n(/*! ./_redefine */"./node_modules/core-js/modules/_redefine.js"),s=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),a=n(/*! ./_hide */"./node_modules/core-js/modules/_hide.js"),l=n(/*! ./_iterators */"./node_modules/core-js/modules/_iterators.js"),c=n(/*! ./_wks */"./node_modules/core-js/modules/_wks.js"),u=c("iterator"),d=c("toStringTag"),h=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(f),m=0;m<p.length;m++){var g,v=p[m],y=f[v],_=s[v],b=_&&_.prototype;if(b&&(b[u]||a(b,u,h),b[d]||a(b,d,v),l[v]=h,y))for(g in r)b[g]||o(b,g,r[g],!0)}},"./node_modules/core-js/modules/web.immediate.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/modules/web.immediate.js ***!
  \*******************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),i=n(/*! ./_task */"./node_modules/core-js/modules/_task.js");r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},"./node_modules/core-js/modules/web.timers.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/modules/web.timers.js ***!
  \****************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ./_global */"./node_modules/core-js/modules/_global.js"),i=n(/*! ./_export */"./node_modules/core-js/modules/_export.js"),o=n(/*! ./_user-agent */"./node_modules/core-js/modules/_user-agent.js"),s=[].slice,a=/MSIE .\./.test(o),l=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&s.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*a,{setTimeout:l(r.setTimeout),setInterval:l(r.setInterval)})},"./node_modules/core-js/web/index.js":
/*!*******************************************!*\
  !*** ./node_modules/core-js/web/index.js ***!
  \*******************************************/
/*! no static exports found */function(e,t,n){n(/*! ../modules/web.timers */"./node_modules/core-js/modules/web.timers.js"),n(/*! ../modules/web.immediate */"./node_modules/core-js/modules/web.immediate.js"),n(/*! ../modules/web.dom.iterable */"./node_modules/core-js/modules/web.dom.iterable.js"),e.exports=n(/*! ../modules/_core */"./node_modules/core-js/modules/_core.js")},"./node_modules/node-libs-browser/mock/empty.js":
/*!******************************************************!*\
  !*** ./node_modules/node-libs-browser/mock/empty.js ***!
  \******************************************************/
/*! no static exports found */function(e,t){},"./node_modules/pako/index.js":
/*!************************************!*\
  !*** ./node_modules/pako/index.js ***!
  \************************************/
/*! no static exports found */function(e,t,n){"use strict";var r={};(0,n(/*! ./lib/utils/common */"./node_modules/pako/lib/utils/common.js").assign)(r,n(/*! ./lib/deflate */"./node_modules/pako/lib/deflate.js"),n(/*! ./lib/inflate */"./node_modules/pako/lib/inflate.js"),n(/*! ./lib/zlib/constants */"./node_modules/pako/lib/zlib/constants.js")),e.exports=r},"./node_modules/pako/lib/deflate.js":
/*!******************************************!*\
  !*** ./node_modules/pako/lib/deflate.js ***!
  \******************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./zlib/deflate */"./node_modules/pako/lib/zlib/deflate.js"),i=n(/*! ./utils/common */"./node_modules/pako/lib/utils/common.js"),o=n(/*! ./utils/strings */"./node_modules/pako/lib/utils/strings.js"),s=n(/*! ./zlib/messages */"./node_modules/pako/lib/zlib/messages.js"),a=n(/*! ./zlib/zstream */"./node_modules/pako/lib/zlib/zstream.js"),l=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(s[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var u;if(u="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,u)))throw new Error(s[n]);this._dict_set=!0}}function u(e,t){var n=new c(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}c.prototype.push=function(e,t){var n,s,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=o.string2buf(e):"[object ArrayBuffer]"===l.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(c),a.next_out=0,a.avail_out=c),1!==(n=r.deflate(a,s))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===s?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==s||(this.onEnd(0),a.avail_out=0,!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=c,t.deflate=u,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,u(e,t)}},"./node_modules/pako/lib/inflate.js":
/*!******************************************!*\
  !*** ./node_modules/pako/lib/inflate.js ***!
  \******************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./zlib/inflate */"./node_modules/pako/lib/zlib/inflate.js"),i=n(/*! ./utils/common */"./node_modules/pako/lib/utils/common.js"),o=n(/*! ./utils/strings */"./node_modules/pako/lib/utils/strings.js"),s=n(/*! ./zlib/constants */"./node_modules/pako/lib/zlib/constants.js"),a=n(/*! ./zlib/messages */"./node_modules/pako/lib/zlib/messages.js"),l=n(/*! ./zlib/zstream */"./node_modules/pako/lib/zlib/zstream.js"),c=n(/*! ./zlib/gzheader */"./node_modules/pako/lib/zlib/gzheader.js"),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==s.Z_OK)throw new Error(a[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==s.Z_OK))throw new Error(a[n])}function h(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}d.prototype.push=function(e,t){var n,a,l,c,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof e?h.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),(n=r.inflate(h,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===s.Z_BUF_ERROR&&!0===m&&(n=s.Z_OK,m=!1),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==s.Z_STREAM_END&&(0!==h.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(h.output,h.next_out),c=h.next_out-l,d=o.buf2string(h.output,l),h.next_out=c,h.avail_out=f-c,c&&i.arraySet(h.output,h.output,l,c,0),this.onData(d)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(m=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==s.Z_STREAM_END);return n===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},"./node_modules/pako/lib/utils/common.js":
/*!***********************************************!*\
  !*** ./node_modules/pako/lib/utils/common.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,s;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],s.set(o,i),i+=o.length;return s}},s={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(r)},"./node_modules/pako/lib/utils/strings.js":
/*!************************************************!*\
  !*** ./node_modules/pako/lib/utils/strings.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ./common */"./node_modules/pako/lib/utils/common.js"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new r.Buf8(256),a=0;a<256;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n}s[254]=s[254]=1,t.string2buf=function(e){var t,n,i,o,s,a=e.length,l=0;for(o=0;o<a;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(l),s=0,o=0;s<l;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,o,a=t||e.length,c=new Array(2*a);for(r=0,n=0;n<a;)if((i=e[n++])<128)c[r++]=i;else if((o=s[i])>4)c[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<a;)i=i<<6|63&e[n++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return l(c,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}},"./node_modules/pako/lib/zlib/adler32.js":
/*!***********************************************!*\
  !*** ./node_modules/pako/lib/zlib/adler32.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--s);i%=65521,o%=65521}return i|o<<16|0}},"./node_modules/pako/lib/zlib/constants.js":
/*!*************************************************!*\
  !*** ./node_modules/pako/lib/zlib/constants.js ***!
  \*************************************************/
/*! no static exports found */function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/pako/lib/zlib/crc32.js":
/*!*********************************************!*\
  !*** ./node_modules/pako/lib/zlib/crc32.js ***!
  \*********************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var o=r,s=i+n;e^=-1;for(var a=i;a<s;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}},"./node_modules/pako/lib/zlib/deflate.js":
/*!***********************************************!*\
  !*** ./node_modules/pako/lib/zlib/deflate.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";var r,i=n(/*! ../utils/common */"./node_modules/pako/lib/utils/common.js"),o=n(/*! ./trees */"./node_modules/pako/lib/zlib/trees.js"),s=n(/*! ./adler32 */"./node_modules/pako/lib/zlib/adler32.js"),a=n(/*! ./crc32 */"./node_modules/pako/lib/zlib/crc32.js"),l=n(/*! ./messages */"./node_modules/pako/lib/zlib/messages.js");function c(e,t){return e.msg=l[t],t}function u(e){return(e<<1)-(e>4?9:0)}function d(e){for(var t=e.length;--t>=0;)e[t]=0}function h(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,h(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function g(e,t){var n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+258,f=c[o+s-1],p=c[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(n=t)+s]===p&&c[n+s-1]===f&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<h);if(r=258-(h-o),o=h-258,r>s){if(e.match_start=t,s=r,r>=a)break;f=c[o+s-1],p=c[o+s]}}}while((t=d[t&u])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function v(e){var t,n,r,o,l,c,u,d,h,f,p=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);o+=p}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,d=e.strstart+e.lookahead,h=o,f=void 0,(f=c.avail_in)>h&&(f=h),n=0===f?0:(c.avail_in-=f,i.arraySet(u,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=s(c.adler,u,f,d):2===c.state.wrap&&(c.adler=a(c.adler,u,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function y(e,t){for(var n,r;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=g(e,n)),e.match_length>=3)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t){for(var n,r,i;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=g(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function b(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function x(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):c(e,-2)}function E(e){var t,n=w(e);return 0===n&&((t=e.state).window_size=2*t.w_size,d(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function A(e,t,n,r,o,s){if(!e)return-2;var a=1;if(-1===t&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),o<1||o>9||8!==n||r<8||r>15||t<0||t>9||s<0||s>4)return c(e,-2);8===r&&(r=9);var l=new x;return e.state=l,l.strm=e,l.wrap=a,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=n,E(e)}r=[new b(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(v(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)})),new b(4,4,8,4,y),new b(4,5,16,8,y),new b(4,6,32,32,y),new b(4,4,16,16,_),new b(8,16,32,32,_),new b(8,16,128,128,_),new b(8,32,128,256,_),new b(32,128,258,1024,_),new b(32,258,258,4096,_)],t.deflateInit=function(e,t){return A(e,t,8,15,8,0)},t.deflateInit2=A,t.deflateReset=E,t.deflateResetKeep=w,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,i,s,l;if(!e||!e.state||t>5||t<0)return e?c(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return c(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var g=8+(i.w_bits-8<<4)<<8;g|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=32),g+=31-g%31,i.status=113,m(i,g),0!==i.strstart&&(m(i,e.adler>>>16),m(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),h(e),s=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),h(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),h(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&h(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(h(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&u(t)<=u(n)&&4!==t)return c(e,-5);if(666===i.status&&0!==e.avail_in)return c(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var y=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(v(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,s,a=e.window;;){if(e.lookahead<=258){if(v(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){s=e.strstart+258;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);e.match_length=258-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==y&&4!==y||(i.status=666),1===y||3===y)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===y&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(d(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),h(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(m(i,e.adler>>>16),m(i,65535&e.adler)),h(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?c(e,-2):(e.state=null,113===t?c(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,r,o,a,l,c,u,h,f=t.length;if(!e||!e.state)return-2;if(2===(a=(n=e.state).wrap)||1===a&&42!==n.status||n.lookahead)return-2;for(1===a&&(e.adler=s(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===a&&(d(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,v(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,n.wrap=a,0},t.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/pako/lib/zlib/gzheader.js":
/*!************************************************!*\
  !*** ./node_modules/pako/lib/zlib/gzheader.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},"./node_modules/pako/lib/zlib/inffast.js":
/*!***********************************************!*\
  !*** ./node_modules/pako/lib/zlib/inffast.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S;n=e.state,r=e.next_in,M=e.input,i=r+(e.avail_in-5),o=e.next_out,S=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=M[r++]<<p,p+=8,f+=M[r++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))S[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&_,(b&=15)&&(p<b&&(f+=M[r++]<<p,p+=8),x+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=M[r++]<<p,p+=8,f+=M[r++]<<p,p+=8),_=g[f&y];n:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=M[r++]<<p,(p+=8)<b&&(f+=M[r++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,p-=b,w>(b=o-s)){if((b=w-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(E=0,A=h,0===d){if(E+=c-b,b<x){x-=b;do{S[o++]=h[E++]}while(--b);E=o-w,A=S}}else if(d<b){if(E+=c+d-b,(b-=d)<x){x-=b;do{S[o++]=h[E++]}while(--b);if(E=0,d<x){x-=b=d;do{S[o++]=h[E++]}while(--b);E=o-w,A=S}}}else if(E+=d-b,b<x){x-=b;do{S[o++]=h[E++]}while(--b);E=o-w,A=S}for(;x>2;)S[o++]=A[E++],S[o++]=A[E++],S[o++]=A[E++],x-=3;x&&(S[o++]=A[E++],x>1&&(S[o++]=A[E++]))}else{E=o-w;do{S[o++]=S[E++],S[o++]=S[E++],S[o++]=S[E++],x-=3}while(x>2);x&&(S[o++]=S[E++],x>1&&(S[o++]=S[E++]))}break}}break}}while(r<i&&o<a);r-=x=p>>3,f&=(1<<(p-=x<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<a?a-o+257:257-(o-a),n.hold=f,n.bits=p}},"./node_modules/pako/lib/zlib/inflate.js":
/*!***********************************************!*\
  !*** ./node_modules/pako/lib/zlib/inflate.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ../utils/common */"./node_modules/pako/lib/utils/common.js"),i=n(/*! ./adler32 */"./node_modules/pako/lib/zlib/adler32.js"),o=n(/*! ./crc32 */"./node_modules/pako/lib/zlib/crc32.js"),s=n(/*! ./inffast */"./node_modules/pako/lib/zlib/inffast.js"),a=n(/*! ./inftrees */"./node_modules/pako/lib/zlib/inftrees.js");function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):-2}function h(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,d(e))):-2}function f(e,t){var n,r;return e?(r=new c,e.state=r,r.window=null,0!==(n=h(e,t))&&(e.state=null),n):-2}var p,m,g=!0;function v(e){if(g){var t;for(p=new r.Buf32(512),m=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,m,0,e.work,{bits:5}),g=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}function y(e,t,n,i){var o,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new r.Buf8(s.wsize)),i>=s.wsize?(r.arraySet(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((o=s.wsize-s.wnext)>i&&(o=i),r.arraySet(s.window,t,n-i,o,s.wnext),(i-=o)?(r.arraySet(s.window,t,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0}t.inflateReset=d,t.inflateReset2=h,t.inflateResetKeep=u,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,c,u,d,h,f,p,m,g,_,b,x,w,E,A,M,S,T,C,P,L,D,R,I,j=0,O=new r.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),h=e.next_out,u=e.output,p=e.avail_out,d=e.next_in,c=e.input,f=e.avail_in,m=n.hold,g=n.bits,_=f,b=p,D=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;g<16;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(2&n.wrap&&35615===m){n.check=0,O[0]=255&m,O[1]=m>>>8&255,n.check=o(n.check,O,2,0),m=0,g=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",n.mode=30;break}if(g-=4,L=8+(15&(m>>>=4)),0===n.wbits)n.wbits=L;else if(L>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<L,e.adler=n.check=1,n.mode=512&m?10:12,m=0,g=0;break;case 2:for(;g<16;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(n.flags=m,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,n.check=o(n.check,O,2,0)),m=0,g=0,n.mode=3;case 3:for(;g<32;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}n.head&&(n.head.time=m),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,O[2]=m>>>16&255,O[3]=m>>>24&255,n.check=o(n.check,O,4,0)),m=0,g=0,n.mode=4;case 4:for(;g<16;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,n.check=o(n.check,O,2,0)),m=0,g=0,n.mode=5;case 5:if(1024&n.flags){for(;g<16;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,n.check=o(n.check,O,2,0)),m=0,g=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((x=n.length)>f&&(x=f),x&&(n.head&&(L=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,c,d,x,L)),512&n.flags&&(n.check=o(n.check,c,x,d)),f-=x,d+=x,n.length-=x),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;x=0;do{L=c[d+x++],n.head&&L&&n.length<65536&&(n.head.name+=String.fromCharCode(L))}while(L&&x<f);if(512&n.flags&&(n.check=o(n.check,c,x,d)),f-=x,d+=x,L)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;x=0;do{L=c[d+x++],n.head&&L&&n.length<65536&&(n.head.comment+=String.fromCharCode(L))}while(L&&x<f);if(512&n.flags&&(n.check=o(n.check,c,x,d)),f-=x,d+=x,L)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;g<16;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(m!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}m=0,g=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;g<32;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}e.adler=n.check=l(m),m=0,g=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,n.hold=m,n.bits=g,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){m>>>=7&g,g-=7&g,n.mode=27;break}for(;g<3;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}switch(n.last=1&m,g-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(v(n),n.mode=20,6===t){m>>>=2,g-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}m>>>=2,g-=2;break;case 14:for(m>>>=7&g,g-=7&g;g<32;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&m,m=0,g=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(x=n.length){if(x>f&&(x=f),x>p&&(x=p),0===x)break e;r.arraySet(u,c,d,x,h),f-=x,d+=x,p-=x,h+=x,n.length-=x;break}n.mode=12;break;case 17:for(;g<14;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(n.nlen=257+(31&m),m>>>=5,g-=5,n.ndist=1+(31&m),m>>>=5,g-=5,n.ncode=4+(15&m),m>>>=4,g-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;g<3;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}n.lens[N[n.have++]]=7&m,m>>>=3,g-=3}for(;n.have<19;)n.lens[N[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,R={bits:n.lenbits},D=a(0,n.lens,0,19,n.lencode,0,n.work,R),n.lenbits=R.bits,D){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(j=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,S=65535&j,!((A=j>>>24)<=g);){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(S<16)m>>>=A,g-=A,n.lens[n.have++]=S;else{if(16===S){for(I=A+2;g<I;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(m>>>=A,g-=A,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}L=n.lens[n.have-1],x=3+(3&m),m>>>=2,g-=2}else if(17===S){for(I=A+3;g<I;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}g-=A,L=0,x=3+(7&(m>>>=A)),m>>>=3,g-=3}else{for(I=A+7;g<I;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}g-=A,L=0,x=11+(127&(m>>>=A)),m>>>=7,g-=7}if(n.have+x>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;x--;)n.lens[n.have++]=L}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,R={bits:n.lenbits},D=a(1,n.lens,0,n.nlen,n.lencode,0,n.work,R),n.lenbits=R.bits,D){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,R={bits:n.distbits},D=a(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,R),n.distbits=R.bits,D){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&p>=258){e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,n.hold=m,n.bits=g,s(e,b),h=e.next_out,u=e.output,p=e.avail_out,d=e.next_in,c=e.input,f=e.avail_in,m=n.hold,g=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;M=(j=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,S=65535&j,!((A=j>>>24)<=g);){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(M&&0==(240&M)){for(T=A,C=M,P=S;M=(j=n.lencode[P+((m&(1<<T+C)-1)>>T)])>>>16&255,S=65535&j,!(T+(A=j>>>24)<=g);){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}m>>>=T,g-=T,n.back+=T}if(m>>>=A,g-=A,n.back+=A,n.length=S,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=12;break}if(64&M){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(I=n.extra;g<I;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(j=n.distcode[m&(1<<n.distbits)-1])>>>16&255,S=65535&j,!((A=j>>>24)<=g);){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(0==(240&M)){for(T=A,C=M,P=S;M=(j=n.distcode[P+((m&(1<<T+C)-1)>>T)])>>>16&255,S=65535&j,!(T+(A=j>>>24)<=g);){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}m>>>=T,g-=T,n.back+=T}if(m>>>=A,g-=A,n.back+=A,64&M){e.msg="invalid distance code",n.mode=30;break}n.offset=S,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(I=n.extra;g<I;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===p)break e;if(x=b-p,n.offset>x){if((x=n.offset-x)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}x>n.wnext?(x-=n.wnext,w=n.wsize-x):w=n.wnext-x,x>n.length&&(x=n.length),E=n.window}else E=u,w=h-n.offset,x=n.length;x>p&&(x=p),p-=x,n.length-=x;do{u[h++]=E[w++]}while(--x);0===n.length&&(n.mode=21);break;case 26:if(0===p)break e;u[h++]=n.length,p--,n.mode=21;break;case 27:if(n.wrap){for(;g<32;){if(0===f)break e;f--,m|=c[d++]<<g,g+=8}if(b-=p,e.total_out+=b,n.total+=b,b&&(e.adler=n.check=n.flags?o(n.check,u,b,h-b):i(n.check,u,b,h-b)),b=p,(n.flags?m:l(m))!==n.check){e.msg="incorrect data check",n.mode=30;break}m=0,g=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;g<32;){if(0===f)break e;f--,m+=c[d++]<<g,g+=8}if(m!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}m=0,g=0}n.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,n.hold=m,n.bits=g,(n.wsize||b!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&y(e,e.output,e.next_out,b-e.avail_out)?(n.mode=31,-4):(_-=e.avail_in,b-=e.avail_out,e.total_in+=_,e.total_out+=b,n.total+=b,n.wrap&&b&&(e.adler=n.check=n.flags?o(n.check,u,b,e.next_out-b):i(n.check,u,b,e.next_out-b)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===_&&0===b||4===t)&&0===D&&(D=-5),D)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:y(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/pako/lib/zlib/inftrees.js":
/*!************************************************!*\
  !*** ./node_modules/pako/lib/zlib/inftrees.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ../utils/common */"./node_modules/pako/lib/utils/common.js"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,c,u,d,h){var f,p,m,g,v,y,_,b,x,w=h.bits,E=0,A=0,M=0,S=0,T=0,C=0,P=0,L=0,D=0,R=0,I=null,j=0,O=new r.Buf16(16),N=new r.Buf16(16),k=null,F=0;for(E=0;E<=15;E++)O[E]=0;for(A=0;A<l;A++)O[t[n+A]]++;for(T=w,S=15;S>=1&&0===O[S];S--);if(T>S&&(T=S),0===S)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(M=1;M<S&&0===O[M];M++);for(T<M&&(T=M),L=1,E=1;E<=15;E++)if(L<<=1,(L-=O[E])<0)return-1;if(L>0&&(0===e||1!==S))return-1;for(N[1]=0,E=1;E<15;E++)N[E+1]=N[E]+O[E];for(A=0;A<l;A++)0!==t[n+A]&&(d[N[t[n+A]]++]=A);if(0===e?(I=k=d,y=19):1===e?(I=i,j-=257,k=o,F-=257,y=256):(I=s,k=a,y=-1),R=0,A=0,E=M,v=u,C=T,P=0,m=-1,g=(D=1<<T)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){_=E-P,d[A]<y?(b=0,x=d[A]):d[A]>y?(b=k[F+d[A]],x=I[j+d[A]]):(b=96,x=0),f=1<<E-P,M=p=1<<C;do{c[v+(R>>P)+(p-=f)]=_<<24|b<<16|x|0}while(0!==p);for(f=1<<E-1;R&f;)f>>=1;if(0!==f?(R&=f-1,R+=f):R=0,A++,0==--O[E]){if(E===S)break;E=t[n+d[A]]}if(E>T&&(R&g)!==m){for(0===P&&(P=T),v+=M,L=1<<(C=E-P);C+P<S&&!((L-=O[C+P])<=0);)C++,L<<=1;if(D+=1<<C,1===e&&D>852||2===e&&D>592)return 1;c[m=R&g]=T<<24|C<<16|v-u|0}}return 0!==R&&(c[v+R]=E-P<<24|64<<16|0),h.bits=T,0}},"./node_modules/pako/lib/zlib/messages.js":
/*!************************************************!*\
  !*** ./node_modules/pako/lib/zlib/messages.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/pako/lib/zlib/trees.js":
/*!*********************************************!*\
  !*** ./node_modules/pako/lib/zlib/trees.js ***!
  \*********************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=n(/*! ../utils/common */"./node_modules/pako/lib/utils/common.js");function i(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],s=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);i(c);var u=new Array(60);i(u);var d=new Array(512);i(d);var h=new Array(256);i(h);var f=new Array(29);i(f);var p,m,g,v=new Array(30);function y(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function b(e){return e<256?d[e]:d[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function w(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function E(e,t,n){w(e,n[2*t],n[2*t+1])}function A(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function M(e,t,n){var r,i,o=new Array(16),s=0;for(r=1;r<=15;r++)o[r]=s=s+n[r-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=A(o[a]++,a))}}function S(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function T(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function C(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function P(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&C(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!C(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function L(e,t,n){var r,i,a,l,c=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===r?E(e,i,t):(E(e,(a=h[i])+256+1,t),0!==(l=o[a])&&w(e,i-=f[a],l),E(e,a=b(--r),n),0!==(l=s[a])&&w(e,r-=v[a],l))}while(c<e.last_lit);E(e,256,t)}function D(e,t){var n,r,i,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)P(e,o,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,P(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,s,a,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(o=p,m++),l[2*r+1]=o,r>c||(e.bl_count[o]++,s=0,r>=f&&(s=h[r-f]),a=l[2*r],e.opt_len+=a*(o+s),d&&(e.static_len+=a*(u[2*r+1]+s)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>c||(l[2*i+1]!==o&&(e.opt_len+=(o-l[2*i+1])*l[2*i],l[2*i+1]=o),r--)}}(e,t),M(o,c,e.bl_count)}function R(e,t,n){var r,i,o=-1,s=t[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<l&&i===s||(a<c?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4))}function I(e,t,n){var r,i,o=-1,s=t[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<l&&i===s)){if(a<c)do{E(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(E(e,i,e.bl_tree),a--),E(e,16,e.bl_tree),w(e,a-3,2)):a<=10?(E(e,17,e.bl_tree),w(e,a-3,3)):(E(e,18,e.bl_tree),w(e,a-11,7));a=0,o=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4)}}i(v);var j=!1;function O(e,t,n,i){w(e,0+(i?1:0),3),function(e,t,n,i){T(e),i&&(x(e,n),x(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){j||(!function(){var e,t,n,r,i,l=new Array(16);for(n=0,r=0;r<28;r++)for(f[r]=n,e=0;e<1<<o[r];e++)h[n++]=r;for(h[n-1]=r,i=0,r=0;r<16;r++)for(v[r]=i,e=0;e<1<<s[r];e++)d[i++]=r;for(i>>=7;r<30;r++)for(v[r]=i<<7,e=0;e<1<<s[r]-7;e++)d[256+i++]=r;for(t=0;t<=15;t++)l[t]=0;for(e=0;e<=143;)c[2*e+1]=8,e++,l[8]++;for(;e<=255;)c[2*e+1]=9,e++,l[9]++;for(;e<=279;)c[2*e+1]=7,e++,l[7]++;for(;e<=287;)c[2*e+1]=8,e++,l[8]++;for(M(c,287,l),e=0;e<30;e++)u[2*e+1]=5,u[2*e]=A(e,5);p=new y(c,o,257,286,15),m=new y(u,s,0,30,15),g=new y(new Array(0),a,0,19,7)}(),j=!0),e.l_desc=new _(e.dyn_ltree,p),e.d_desc=new _(e.dyn_dtree,m),e.bl_desc=new _(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,S(e)},t._tr_stored_block=O,t._tr_flush_block=function(e,t,n,r){var i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),s=function(e){var t;for(R(e,e.dyn_ltree,e.l_desc.max_code),R(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?O(e,t,n,r):4===e.strategy||o===i?(w(e,2+(r?1:0),3),L(e,c,u)):(w(e,4+(r?1:0),3),function(e,t,n,r){var i;for(w(e,t-257,5),w(e,n-1,5),w(e,r-4,4),i=0;i<r;i++)w(e,e.bl_tree[2*l[i]+1],3);I(e,e.dyn_ltree,t-1),I(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),L(e,e.dyn_ltree,e.dyn_dtree)),S(e),r&&T(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(h[n]+256+1)]++,e.dyn_dtree[2*b(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){w(e,2,3),E(e,256,c),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},"./node_modules/pako/lib/zlib/zstream.js":
/*!***********************************************!*\
  !*** ./node_modules/pako/lib/zlib/zstream.js ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},"./node_modules/pend/index.js":
/*!************************************!*\
  !*** ./node_modules/pend/index.js ***!
  \************************************/
/*! no static exports found */function(e,t){function n(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}function r(e){e.pending+=1;var t=!1;return function(r){if(t)throw new Error("callback called twice");if(t=!0,e.error=e.error||r,e.pending-=1,e.waiting.length>0&&e.pending<e.max)i(e,e.waiting.shift());else if(0===e.pending){var o=e.listeners;e.listeners=[],o.forEach(n)}};function n(t){t(e.error)}}function i(e,t){t(r(e))}e.exports=n,n.prototype.go=function(e){this.pending<this.max?i(this,e):this.waiting.push(e)},n.prototype.wait=function(e){0===this.pending?e(this.error):this.listeners.push(e)},n.prototype.hold=function(){return r(this)}},"./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&f())}function f(){if(!u){var e=a(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},"./node_modules/regenerator-runtime/runtime.js":
/*!*****************************************************!*\
  !*** ./node_modules/regenerator-runtime/runtime.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n,r){var i=t&&t.prototype instanceof u?t:u,o=Object.create(i.prototype),s=new w(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=_(s,n);if(a){if(a===c)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,s),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=a;var c={};function u(){}function d(){}function h(){}var f={};f[i]=function(){return this};var p=Object.getPrototypeOf,m=p&&p(p(E([])));m&&m!==t&&n.call(m,i)&&(f=m);var g=h.prototype=u.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,s){var a=l(e[r],e,i);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return t("throw",e,o,s)}))}s(a.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=g.constructor=h,h.constructor=d,h[s]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(y.prototype),y.prototype[o]=function(){return this},e.AsyncIterator=y,e.async=function(t,n,r,i){var o=new y(a(t,n,r,i));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(g),g[s]="Generator",g[i]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},"./node_modules/setimmediate/setImmediate.js":
/*!***************************************************!*\
  !*** ./node_modules/setimmediate/setImmediate.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,s,a,l=1,c={},u=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,r=function(e){var t=d.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&p(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),r=function(t){e.postMessage(s+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[l]=i,r(l),l++},h.clearImmediate=f}function f(e){delete c[e]}function p(e){if(u)setTimeout(p,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{f(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(/*! ./../webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"),n(/*! ./../process/browser.js */"./node_modules/process/browser.js"))},"./node_modules/timers-browserify/main.js":
/*!************************************************!*\
  !*** ./node_modules/timers-browserify/main.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(/*! setimmediate */"./node_modules/setimmediate/setImmediate.js"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(/*! ./../webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./src/animation/Animation.js":
/*!************************************!*\
  !*** ./src/animation/Animation.js ***!
  \************************************/
/*! exports provided: Animation, interpolateCatmullRom */function(e,t,n){"use strict";n.r(t),n.d(t,"Animation",(function(){return i})),n.d(t,"interpolateCatmullRom",(function(){return o}));var r=n(/*! ./InterpolationType */"./src/animation/InterpolationType.js");function i(e,t,n){this.root=e,this.handler=n.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=n.viewer,this.animator=n,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=r.INTERPOLATION_TYPE.LINEAR,this.setStartAndEndKeyTime()}function o(e,t){function n(e,t,n,r,i,o,s){var a=.5*(n-e),l=.5*(r-t);return(2*(t-n)+a+l)*s+(-3*(t-n)-2*a-l)*o+a*i+t}var r,i,o,s,a,l,c,u,d,h=[],f=[];return o=(r=(e.length-1)*t)-(i=Math.floor(r)),h[0]=0===i?i:i-1,h[1]=i,h[2]=i>e.length-2?i:i+1,h[3]=i>e.length-3?i:i+2,l=e[h[0]],c=e[h[1]],u=e[h[2]],d=e[h[3]],a=o*(s=o*o),f[0]=n(l[0],c[0],u[0],d[0],o,s,a),f[1]=n(l[1],c[1],u[1],d[1],o,s,a),f[2]=n(l[2],c[2],u[2],d[2],o,s,a),f}n(/*! ../../src/application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(i.prototype),i.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys;this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},i.prototype.keyTypes=[],i.prototype.defaultKey={},i.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},i.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},i.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},i.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause();var t=e-this.currentTime;this.update(t)},i.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];void 0===n.animationCache&&(n.animationCache={}),void 0===n.animationCache[this.data.name]&&(n.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:n.matrix});for(var r=n.animationCache[this.data.name],i=0;i<this.keyTypes.length;i++){for(var o=this.keyTypes[i],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(o,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(o,e,a.index+1);r.prevKey[o]=s,r.nextKey[o]=a}}this.setStartAndEndKeyTime()},i.prototype.getNextKeyWith=function(e,t,n){var i=this.data.hierarchy[t].keys;for(this.interpolationType===r.INTERPOLATION_TYPE.CATMULLROM||this.interpolationType===r.INTERPOLATION_TYPE.CATMULLROM_FORWARD?n=n<i.length-1?n:i.length-1:n%=i.length;n<i.length;n++)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[0]},i.prototype.getPrevKeyWith=function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=this.interpolationType===r.INTERPOLATION_TYPE.CATMULLROM||this.interpolationType===r.INTERPOLATION_TYPE.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+i.length;n>=0;n--)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[i.length-1]},i.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},i.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())}},"./src/animation/AnimationHandler.js":
/*!*******************************************!*\
  !*** ./src/animation/AnimationHandler.js ***!
  \*******************************************/
/*! exports provided: AnimationHandler */function(e,t,n){"use strict";function r(){this.animations=[]}n.r(t),n.d(t,"AnimationHandler",(function(){return r})),r.prototype.init=function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[n].rot;Array.isArray(r)||(r=[r._x,r._y,r._z,r._w]),e.hierarchy[t].keys[n].rot=(new THREE.Quaternion).fromArray(r)}for(n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},r.prototype.parse=function(e){var t=[];return function e(t,n){if(n.push(t),t.children&&!(t instanceof THREE.Camera))for(var r=0;r<t.children.length;r++)e(t.children[r],n)}(e,t),t},r.prototype.play=function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},r.prototype.stop=function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},r.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},"./src/animation/InterpolationType.js":
/*!********************************************!*\
  !*** ./src/animation/InterpolationType.js ***!
  \********************************************/
/*! exports provided: INTERPOLATION_TYPE */function(e,t,n){"use strict";n.r(t),n.d(t,"INTERPOLATION_TYPE",(function(){return r}));var r={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2}},"./src/animation/KeyFrameAnimator.js":
/*!*******************************************!*\
  !*** ./src/animation/KeyFrameAnimator.js ***!
  \*******************************************/
/*! exports provided: KeyFrameAnimator */function(e,t,n){"use strict";n.r(t),n.d(t,"KeyFrameAnimator",(function(){return c}));var r=n(/*! ./AnimationHandler */"./src/animation/AnimationHandler.js"),i=n(/*! ./type/MeshAnimation */"./src/animation/type/MeshAnimation.js"),o=n(/*! ./type/CameraAnimation */"./src/animation/type/CameraAnimation.js"),s=n(/*! ./type/VisibilityAnimation */"./src/animation/type/VisibilityAnimation.js"),a=n(/*! ./type/AnnotationAnimation */"./src/animation/type/AnnotationAnimation.js"),l=n(/*! ./type/PolylineAnimation */"./src/animation/type/PolylineAnimation.js");function c(e,t){this.animations=[],this.viewer=e,this.setGlobalManager(e.globalManager),this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new r.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2,this.followCam=!0,this._speedMod=1,this._loops=!1}n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(c.prototype),c.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},c.prototype.add=function(e){var t=this;if(!(!e.hierarchy||e.hierarchy.length<1||!e.hierarchy[0].keys||e.hierarchy[0].keys.length<2)){var n=null,r=this;if("camera"===e.type?(n=new o.CameraAnimation(r.viewer.camera,e,r),r.animations.push(n)):"annotation"===e.type?(n=new a.AnnotationAnimation(null,e,r),r.animations.push(n)):"polyline"===e.type?(n=new l.PolylineAnimation(null,e,r),r.animations.push(n)):"mesh"===e.type?r.viewer.model.getData().instanceTree.enumNodeFragments(e.id,(function(t){var o=r.viewer.getFragmentProxy(r.viewer.model,t);o&&(n=new i.MeshAnimation(o,e,r),r.animations.push(n))}),!0):"visibility"===e.type&&(n=new s.VisibilityAnimation(e,e.id,r),r.animations.push(n)),r.animations.forEach((function(e){return e.setGlobalManager(t.globalManager)})),n){for(var c=0,u=e.hierarchy.length;c<u;c++)for(var d=e.hierarchy[c].keys,h=0;h<d.length;h++)void 0===d[h].xk&&r.keys.push(d[h].time);!function(e){e.sort((function(e,t){return e-t})),function(e,t,n){for(t=e.length;n=--t;)for(;n--;)e[t]!==e[n]||e.splice(n,1)}(e)}(r.keys)}this.updateFlag|=this.UPDATE_SCENE}},c.prototype.update=function(e){e*=this._speedMod,this.animationHandler.update(e);var t=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&(this._loops?this.play(0,this.onPlayCallback):this.pause()),t|=this.UPDATE_SCENE),this.updateFlag=0,t},c.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)this.pause();else{for(var n=0;n<this.animations.length;n++){this.animations[n].play(e)}this.isPlaying=!0,this.isPaused=!1}},c.prototype.setFollowCamera=function(e){this.followCam=e;for(var t=0;t<this.animations.length;t++){var n=this.animations[t];n.setFollowCamera&&n.setFollowCamera(e)}},c.prototype.isFollowingCamera=function(){return this.followCam},c.prototype.setSpeedModifier=function(e){this._speedMod=e},c.prototype.getSpeedModifier=function(){return this._speedMod},c.prototype.setLooping=function(e){this._loops=e},c.prototype.isLooping=function(){return this._loops},c.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},c.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t instanceof o.CameraAnimation&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},c.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){this.animations[e].stop()}this.isPlaying=!1,this.isPaused=!1},c.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++){this.animations[t].goto(e)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},c.prototype.next=function(){var e=function(e,t){for(var n=-1,r=0;r<t.length;r++)if(t[r]>e){n=t[r];break}return n<0?t[t.length-1]:n}(this.currentTime,this.keys);this.goto(e)},c.prototype.prev=function(){var e=function(e,t){for(var n=-1,r=t.length-1;r>-1;r--)if(t[r]<e){n=t[r];break}return n<0?t[0]:n}(this.currentTime,this.keys);this.goto(e)}},"./src/animation/type/AnnotationAnimation.js":
/*!***************************************************!*\
  !*** ./src/animation/type/AnnotationAnimation.js ***!
  \***************************************************/
/*! exports provided: AnnotationAnimation */function(e,t,n){"use strict";n.r(t),n.d(t,"AnnotationAnimation",(function(){return c}));var r,i,o,s=n(/*! three */"./thirdparty/three.js/three.js"),a=n(/*! ../InterpolationType */"./src/animation/InterpolationType.js"),l=n(/*! ../Animation */"./src/animation/Animation.js");function c(e,t,n){var r=this;null===e&&(e=function(e,t,n){var i=this.getDocument(),o=r.container=i.createElement("div"),a=e.name;o.id=a,o.style.cursor="pointer",o.style.visibility=n;var l=i.createElement("div");l.id=a+"-txt",l.style.cssText="display: none;position: absolute;z-index: 1;",o.appendChild(l);var c=i.createElement("img"),u=e.custom&&e.custom.att&&1===e.custom.att;c.src=u?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",c.id=a+"-img",c.style.cssText="display: block;position: absolute;z-index: 1;",o.appendChild(c),t.api.container.appendChild(o),o.addEventListener("click",(function(){l.style.display="none"===l.style.display?"block":"none"}));var d=new s.SphereGeometry(.01),h=new s.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),f=new s.Mesh(d,h);return f.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",f),f}.call(this,t,n.viewer,"hidden")),l.Animation.call(this,e,t,n),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Bimfish.Viewing.CAMERA_CHANGE_EVENT,(function(t){r.updateText(e.position,r.text)}))}c.prototype=Object.create(l.Animation.prototype),c.prototype.constructor=c,c.prototype.keyTypes=["pos","text","vis"],c.prototype.defaultKey={pos:0,text:"",vis:1},c.prototype.stop=function(){l.Animation.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},c.prototype.updateText=function(e,t){var n=function(e,t,n){var r=e.clone(),i=new s.Matrix4;return t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),r.applyProjection(i),{x:(r.x+1)*n.width/2+n.offsetLeft-12,y:(1-r.y)*n.height/2+n.offsetTop+12}}(e,this.viewer.camera,this.viewer.canvas),r=this.getDocument(),i=r.getElementById(this.id+"-txt");i&&(i.innerHTML=t,i.style.left=n.x+"px",i.style.top=n.y+"px",this.text=t),(i=r.getElementById(this.id+"-img"))&&(i.style.left=n.x+"px",i.style.top=n.y-24+"px")},c.prototype.update=(r=[],i=new s.Vector3,o=new s.Vector3,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){var t=this.getDocument();if(this.isPaused&&this.currentTime<this.startKeyTime)(w=t.getElementById(this.id))&&(w.style.visibility=this.state);else for(var n=0,s=this.hierarchy.length;n<s;n++){for(var c=this.hierarchy[n],u=c.animationCache[this.data.name],d=0;d<this.keyTypes.length;d++){var h=this.keyTypes[d],f=u.prevKey[h],p=u.nextKey[h];if(p.time<=this.currentTime||f.time>=this.currentTime){for(f=this.data.hierarchy[n].keys[0],p=this.getNextKeyWith(h,n,1);p.time<this.currentTime&&p.index>f.index;)f=p,p=this.getNextKeyWith(h,n,p.index+1);u.prevKey[h]=f,u.nextKey[h]=p}var m=f[h],g=p[h];if(p.time!==f.time&&void 0!==m&&void 0!==g){var v=(this.currentTime-f.time)/(p.time-f.time);if(v<0&&(v=0),v>1&&(v=1),"pos"===h){if(this.interpolationType===a.INTERPOLATION_TYPE.LINEAR)o.x=m[0]+(g[0]-m[0])*v,o.y=m[1]+(g[1]-m[1])*v,o.z=m[2]+(g[2]-m[2])*v,c.position.copy(o);else if(this.interpolationType===a.INTERPOLATION_TYPE.CATMULLROM||this.interpolationType===a.INTERPOLATION_TYPE.CATMULLROM_FORWARD){r[0]=this.getPrevKeyWith("pos",n,f.index-1).pos,r[1]=m,r[2]=g,r[3]=this.getNextKeyWith("pos",n,p.index+1).pos,v=.33*v+.33;var y=Object(l.interpolateCatmullRom)(r,v);if(o.x=y[0],o.y=y[1],o.z=y[2],c.position.copy(o),this.interpolationType===a.INTERPOLATION_TYPE.CATMULLROM_FORWARD){var _=Object(l.interpolateCatmullRom)(r,1.01*v);i.set(_[0],_[1],_[2]),i.sub(vector),i.y=0,i.normalize();var b=Math.atan2(i.x,i.z);c.rotation.set(0,b,0)}}}else if("text"===h){var x=Math.abs(this.currentTime-p.time)<this.epsilon?g:m;this.updateText(c.position,x)}else if("vis"===h){var w;if(w=t.getElementById(this.id)){var E=Math.abs(this.currentTime-p.time)<this.epsilon?g:m;w.style.visibility=E?"visible":"hidden"}}}}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0}}})},"./src/animation/type/CameraAnimation.js":
/*!***********************************************!*\
  !*** ./src/animation/type/CameraAnimation.js ***!
  \***********************************************/
/*! exports provided: CameraAnimation */function(e,t,n){"use strict";n.r(t),n.d(t,"CameraAnimation",(function(){return c}));var r,i,o,s=n(/*! three */"./thirdparty/three.js/three.js"),a=n(/*! ../InterpolationType */"./src/animation/InterpolationType.js"),l=n(/*! ../Animation */"./src/animation/Animation.js");function c(e,t,n){l.Animation.call(this,e,t,n),this.followCam=!0}c.prototype=Object.create(l.Animation.prototype),c.prototype.constructor=c,c.prototype.keyTypes=["pos","up","target","fov","perspective"],c.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},c.prototype.setFollowCamera=function(e){this.followCam=e},c.prototype.update=(r=[],i=new s.Vector3,o=new s.Vector3,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),this.followCam&&!this.isPlayingOutOfRange())){for(var t=0,n=this.hierarchy.length;t<n;t++){for(var s=this.hierarchy[t],c=s.animationCache[this.data.name],u=0;u<this.keyTypes.length;u++){var d=this.keyTypes[u],h=c.prevKey[d],f=c.nextKey[d];if(f.time<=this.currentTime||h.time>=this.currentTime){for(h=this.data.hierarchy[t].keys[0],f=this.getNextKeyWith(d,t,1);f.time<this.currentTime&&f.index>h.index;)h=f,f=this.getNextKeyWith(d,t,f.index+1);c.prevKey[d]=h,c.nextKey[d]=f}var p=h[d],m=f[d];if(f.time!==h.time&&void 0!==p&&void 0!==m){var g,v=(this.currentTime-h.time)/(f.time-h.time);if(v<0&&(v=0),v>1&&(v=1),"pos"===d)g=s.position;else if("up"===d)g=s.up;else if("target"===d)g=s.target;else{if("fov"===d){s.setFov(p+(m-p)*v);continue}if("perspective"===d){(v>.5?m:p)?s.toPerspective():s.toOrthographic();continue}}if(this.interpolationType===a.INTERPOLATION_TYPE.LINEAR)o.x=p[0]+(m[0]-p[0])*v,o.y=p[1]+(m[1]-p[1])*v,o.z=p[2]+(m[2]-p[2])*v,g.copy(o);else{r[0]=this.getPrevKeyWith(d,t,h.index-1)[d],r[1]=p,r[2]=m,r[3]=this.getNextKeyWith(d,t,f.index+1)[d],v=.33*v+.33;var y=Object(l.interpolateCatmullRom)(r,v);if(o.x=y[0],o.y=y[1],o.z=y[2],g.copy(o),this.interpolationType===a.INTERPOLATION_TYPE.CATMULLROM_FORWARD){var _=Object(l.interpolateCatmullRom)(r,1.01*v);i.set(_[0],_[1],_[2]),i.sub(g),i.y=0,i.normalize();var b=Math.atan2(i.x,i.z);s.rotation.set(0,b,0)}}}}s.matrixAutoUpdate=!0,s.matrixWorldNeedsUpdate=!0}s.lookAt(s.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}})},"./src/animation/type/MeshAnimation.js":
/*!*********************************************!*\
  !*** ./src/animation/type/MeshAnimation.js ***!
  \*********************************************/
/*! exports provided: MeshAnimation */function(e,t,n){"use strict";n.r(t),n.d(t,"MeshAnimation",(function(){return h}));var r,i,o,s,a,l,c=n(/*! three */"./thirdparty/three.js/three.js"),u=n(/*! ../InterpolationType */"./src/animation/InterpolationType.js"),d=n(/*! ../Animation */"./src/animation/Animation.js");function h(e,t,n){d.Animation.call(this,e,t,n),this.localMatrix=new c.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform}h.prototype=Object.create(d.Animation.prototype),h.prototype.constructor=h,h.prototype.keyTypes=["pos","rot","scl"],h.prototype.defaultKey={pos:0,rot:0,scl:0},h.prototype.update=(r=[],i=new c.Vector3,o=new c.Vector3,s=new c.Quaternion,a=new c.Matrix4,l=new c.Matrix4,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,n=this.hierarchy.length;t<n;t++){for(var h=this.hierarchy[t],f=h.animationCache[this.data.name],p=0;p<this.keyTypes.length;p++){var m=this.keyTypes[p],g=f.prevKey[m],v=f.nextKey[m];if(v.time<=this.currentTime||g.time>=this.currentTime){for(g=this.data.hierarchy[t].keys[0],v=this.getNextKeyWith(m,t,1);v.time<this.currentTime&&v.index>g.index;)g=v,v=this.getNextKeyWith(m,t,v.index+1);f.prevKey[m]=g,f.nextKey[m]=v}var y=g[m],_=v[m];if(v.time!==g.time&&void 0!==y&&void 0!==_){var b=(this.currentTime-g.time)/(v.time-g.time);if(b<0&&(b=0),b>1&&(b=1),"pos"===m)if(this.interpolationType===u.INTERPOLATION_TYPE.LINEAR)o.x=y[0]+(_[0]-y[0])*b,o.y=y[1]+(_[1]-y[1])*b,o.z=y[2]+(_[2]-y[2])*b,h.position.copy(o);else{r[0]=this.getPrevKeyWith("pos",t,g.index-1).pos,r[1]=y,r[2]=_,r[3]=this.getNextKeyWith("pos",t,v.index+1).pos,b=.33*b+.33;var x=Object(d.interpolateCatmullRom)(r,b);if(o.x=x[0],o.y=x[1],o.z=x[2],h.position.copy(o),this.interpolationType===u.INTERPOLATION_TYPE.CATMULLROM_FORWARD){var w=Object(d.interpolateCatmullRom)(r,1.01*b);i.set(w[0],w[1],w[2]),i.sub(vector),i.y=0,i.normalize();var E=Math.atan2(i.x,i.z);h.rotation.set(0,E,0)}}else"rot"===m?(c.Quaternion.slerp(y,_,s,b),h.quaternion.copy(s)):"scl"===m&&(o.x=y[0]+(_[0]-y[0])*b,o.y=y[1]+(_[1]-y[1])*b,o.z=y[2]+(_[2]-y[2])*b,h.scale.copy(o))}}if(!this.relativeTransform){var A=a.compose(h.position,h.quaternion,h.scale),M=l;h.getOriginalWorldMatrix(M),M.getInverse(M),a.multiplyMatrices(A,M).decompose(h.position,h.quaternion,h.scale)}h.updateAnimTransform()}})},"./src/animation/type/PolylineAnimation.js":
/*!*************************************************!*\
  !*** ./src/animation/type/PolylineAnimation.js ***!
  \*************************************************/
/*! exports provided: PolylineAnimation */function(e,t,n){"use strict";n.r(t),n.d(t,"PolylineAnimation",(function(){return o}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ../Animation */"./src/animation/Animation.js");function o(e,t,n){this.viewer=n.viewer,null===e&&(e=this.createPolyline([])),i.Animation.call(this,e,t,n),this.epsilon=.1}o.prototype=Object.create(i.Animation.prototype),o.prototype.constructor=o,o.prototype.keyTypes=["points","vis"],o.prototype.defaultKey={points:[],vis:1},o.prototype.stop=function(){i.Animation.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},o.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(!1!==this.isPlaying&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)e(this);else for(var n=0,i=this.hierarchy.length;n<i;n++)for(var o=this.hierarchy[n].animationCache[this.data.name],s=0;s<this.keyTypes.length;s++){var a=this.keyTypes[s],l=o.prevKey[a],c=o.nextKey[a];if(c.time<=this.currentTime||l.time>=this.currentTime){for(l=this.data.hierarchy[n].keys[0],c=this.getNextKeyWith(a,n,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(a,n,c.index+1);o.prevKey[a]=l,o.nextKey[a]=c}var u=l[a],d=c[a];if(c.time!==l.time&&void 0!==u&&void 0!==d){var h=(this.currentTime-l.time)/(c.time-l.time);if(h<0&&(h=0),h>1&&(h=1),"points"===a){var f=h<.5?u:d;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var p=[],m=0;m<f.length;m++){var g=f[m].slice();if(0===m)g[0]=u[m][0]+(d[m][0]-u[m][0])*h,g[1]=u[m][1]+(d[m][1]-u[m][1])*h,g[2]=u[m][2]+(d[m][2]-u[m][2])*h;else if(m===f.length-1){var v=u.length-1,y=d.length-1;g[0]=u[v][0]+(d[y][0]-u[v][0])*h,g[1]=u[v][1]+(d[y][1]-u[v][1])*h,g[2]=u[v][2]+(d[y][2]-u[v][2])*h}var _=new r.Vector3(g[0],g[1],g[2]);p.push(_)}this.root=this.createPolyline(p)}else if("vis"===a){var b=Math.abs(this.currentTime-c.time)<this.epsilon?d:u;this.root.visible=b,b||e(this)}}}}}(),o.prototype.createPolyline=function(e){for(var t=new r.Geometry,n=0;n<e.length;n++)t.vertices.push(e[n]);t.computeLineDistances();var i=new r.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),o=new r.Line(t,i,r.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",o),o}},"./src/animation/type/VisibilityAnimation.js":
/*!***************************************************!*\
  !*** ./src/animation/type/VisibilityAnimation.js ***!
  \***************************************************/
/*! exports provided: VisibilityAnimation */function(e,t,n){"use strict";n.r(t),n.d(t,"VisibilityAnimation",(function(){return i}));var r=n(/*! ../Animation */"./src/animation/Animation.js");function i(e,t,n){var i,o=this;r.Animation.call(this,{},e,n),this.fragPointers=[],this.nodeChildren=[],this.nodeFragments=[];var s=this.viewer.model.getData().instanceTree;s.enumNodeChildren(t,(function(e){o.nodeChildren.push(e)}),!0),s.enumNodeFragments(e.id,(function(e){o.nodeFragments.push(e),(i=o.viewer.getFragmentProxy(o.viewer.model,e))&&(o.fragPointers.push(i),i.setMaterial(o.viewer.matman().cloneMaterial(i.getMaterial(),o.viewer.model)))}),!0),this.nodeId=t,this.epsilon=.1}i.prototype=Object.create(r.Animation.prototype),i.prototype.constructor=i,i.prototype.keyTypes=["vis","opa"],i.prototype.defaultKey={viz:1,opa:1},i.prototype.getPrevAndNextKeys=function(e,t){for(var n=this.data.hierarchy[e].keys[0],r=this.getNextKeyWith(t,e,1);r.time<this.currentTime&&r.index>n.index;)n=r,r=this.getNextKeyWith(t,e,r.index+1);return{prevKey:n,nextKey:r}},i.prototype.update=function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,n=this.hierarchy.length;t<n;t++){var r=this.hierarchy[t].animationCache[this.data.name],i=r.prevKey.vis,o=r.prevKey.vis,s=r.prevKey.opa,a=r.prevKey.opa;if(o.time<=this.currentTime||i.time>=this.currentTime){var l=this.getPrevAndNextKeys(t,"vis");i=l.prevKey,o=l.nextKey,r.prevKey.vis=i,r.nextKey.vis=o}if(a.time<=this.currentTime||s.time>=this.currentTime){var c=this.getPrevAndNextKeys(t,"opa");s=c.prevKey,a=c.nextKey,r.prevKey.opa=s,r.nextKey.opa=a}var u=i.vis,d=o.vis;if(void 0!==u&&void 0!==d&&i.time!==o.time){var h=Math.abs(this.currentTime-o.time)<this.epsilon?d:u;this.viewer.visibilityManager.setNodeOff(this.nodeId,!h,this.viewer.model,this.nodeChildren,this.nodeFragments)}if(u=s.opa,d=a.opa,void 0===u&&1===i.vis&&(u=1),void 0!==u&&void 0!==d&&s.time!==a.time){var f=(this.currentTime-s.time)/(a.time-s.time);f<0&&(f=0),f>1&&(f=1);for(var p=u+(d-u)*f,m=0;m<this.fragPointers.length;++m){var g=this.fragPointers[m].getMaterial();g.transparent=1!==p,g.opacity=p}p>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1,this.viewer.model,this.nodeChildren,this.nodeFragments)}}}},"./src/application/AggregatedView.js":
/*!*******************************************!*\
  !*** ./src/application/AggregatedView.js ***!
  \*******************************************/
/*! exports provided: AggregatedView */function(e,t,n){"use strict";n.r(t),n.d(t,"AggregatedView",(function(){return _}));var r=n(/*! ../globals */"./src/globals.js"),i=n(/*! ../compat */"./src/compat.js");function o(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){o(s,r,i,a,l,"next",e)}function l(e){o(s,r,i,a,l,"throw",e)}a(void 0)}))}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=Bimfish.Viewing,c=l.Private,u={BimWalk:"Bimfish.BimWalk",Bookmarks:"Bimfish.AEC.CanvasBookmarkExtension",Levels:"Bimfish.AEC.LevelsExtension",CrossFade:"Bimfish.CrossFadeEffects",Hyperlinks:"Bimfish.AEC.HyperlinkExtension",Minimap:"Bimfish.AEC.Minimap3DExtension",DropMe:"Bimfish.AEC.DropMeExtension",ZoomWindow:"Bimfish.Viewing.ZoomWindow",FusionOrbit:"Bimfish.Viewing.FusionOrbit",DiffTool:"Bimfish.DiffTool",ModelStructure:"Bimfish.ModelStructure"},d=function(e){var t="".concat(e.getViewableRootPath()).concat(e.originModel).concat(e.guid());return decodeURIComponent(t)},h=function(e){return e instanceof l.BubbleNode?d(e):e instanceof l.Model?d(e.getDocumentNode()):"string"==typeof e?e:void console.error("makeKey: Input must be key, model, or BubbleNode")},f=function(e){return{model:null,node:e,visible:!1,url:null,loading:!1,error:!1}},p=function(e){return isFinite(e.x)&&isFinite(e.y)&&isFinite(e.z)},m=function(e){var t=e.getUpVector();return t&&(new THREE.Vector3).fromArray(t)},g=function(e){return p(e.position)&&p(e.target)&&p(e.up)&&isFinite(e.orthoScale)},v=function(e,t,n){for(var r=0,i=0;i<e.length;i++){var o=e[i].getBoundingBox();if(n.intersectsBox(o)!==Bimfish.Viewing.Private.FrustumIntersector.OUTSIDE){var s=o.size().length;o.distanceToPoint(t)>50*s||r++}}return r},y=function(e){var t=e.getVisibleModels();t=t.filter((function(e){return t=e.getBoundingBox(),p(t.min)&&p(t.max);var t}));for(var n=e.impl.camera.clone(),r=new Bimfish.Viewing.Private.FrustumIntersector,i=void 0,o=void 0,s=void 0,a=0;a<t.length;a++){var l=t[a];i||(i=m(l));var c=l.getDefaultCamera();if(c&&g(c)){var u=l.getBoundingBox();n.position.copy(c.position),n.target.copy(c.target),n.up.copy(c.up),n.isPerspective=c.isPerspective,n.near=u.distanceToPoint(n.position),n.far=n.near+u.size().length,n.updateMatrixWorld(),n.updateProjectionMatrix(),n.matrixWorldInverse.getInverse(n.matrixWorld),r.reset(n);var d=v(t,c.position,r);(!o||d>=s)&&(o=c,s=d)}}o&&(o.pivot=o.target,o.worlup=i,o.fov=45,e.autocam.setHomeViewFrom(o))},_=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.globalOffset=void 0,this.refPoint=void 0,this.modelItems={},this.resetOnNextModelAdd=!0,this.memTracker=null,this.cameraInitialized=!1,this.is3D=void 0,this.pendingCamera=null,this.extensionLoaded={},this.loadersInProgress={},this.diff={enabled:!1,diffBubble:void 0,primaryBubble:void 0,diffBubbleLabel:void 0,primaryBubbleLabel:void 0,progressCallback:void 0,refNames:void 0},this.modelIsGhosted={},this.diffCache=[],this.onDiffDone=void 0,this.waitForFirstModel=!1,this.onUnload=[]}var t,n,o,p,m,g;return t=e,(n=[{key:"init",value:(g=s(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.headlessViewer?l.Viewer3D:l.GuiViewer3D,this.viewer=new r(t,n.viewerConfig),this.viewer.start(),this.memTracker=new l.ModelMemoryTracker(this.viewer,n.memoryLimit),this.viewer.impl.showTransparencyWhenMoving(),this.options=n,this._registerLmvEventListeners(),e.next=10,this._loadExtensions();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"_onError",value:function(){var e;(e=console).error.apply(e,arguments)}},{key:"reset",value:function(){this.hideAll(),this.pendingCamera=null,this.cameraInitialized=!1,this.resetOnNextModelAdd=!0,this._stopActiveTools(),this._unloadDiffTool(!0),this.refPoint=void 0,this.loadersInProgress={}}},{key:"getModel",value:function(e){var t=this._getItem(e);return t&&t.model}},{key:"isEmpty",value:function(){return!this.getVisibleNodes().length}},{key:"show",value:function(e){this.isEmpty()&&this._initForFirstViewable(e);var t=d(e),n=this.getModel(t);n?this._showModel(n):this.load(e),this.modelItems[t].visible=!0,this._updateModelTimestamps(),this._consolidateVisibleModels()}},{key:"hide",value:function(e){var t=this._getItem(e);t&&(t.model&&(this.options.unloadUnfinishedModels&&!t.model.isLoadDone()?(this.unload(t.node),t.model&&this.viewer.unloadModel(t.model)):this.viewer.hideModel(t.model.id),y(this.viewer)),t.visible=!1,this._cleanupModels())}},{key:"isVisible",value:function(e){var t=this._getItem(e);return t&&t.visible}},{key:"hideAll",value:function(){for(var e in this.modelItems)this.hide(e)}},{key:"getVisibleNodes",value:function(){var e=[];for(var t in this.modelItems){var n=this.modelItems[t];n.visible&&e.push(n.node)}return e}},{key:"isOtgManifestMissing",value:function(e){if(e.is2D())return!1;var t=e.getOtgGraphicsNode();return!(t&&!t.error||(t?this._onError("Otg translation failed for viewable '".concat(e.name(),"'. Error:"),t.error):this._onError("Otg node missing for viewable '".concat(e.name(),"'.")),this.onViewerNotification&&this.onViewerNotification("error","Model Translation failed for viewable: '".concat(e.name(),"'.")),0))}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!n&&this.options.getCustomLoadOptions&&(n=this.options.getCustomLoadOptions(e));var r=h(e),i=this.modelItems[r];if(i||(i=f(e),this.modelItems[r]=i),!(i.model||i.loading||i.error)){if(e.is3D()){if(this.waitForFirstModel)return;this.options.ignoreGlobalOffset||this.globalOffset||(this.waitForFirstModel=!0)}if(i.loading=!0,!this.options.disableSvf||!this.isOtgManifestMissing(e)){var o=e.getRootNode(),s=o.getDocument(),a={globalOffset:this.globalOffset,applyRefPoint:!0,isAEC:!0,bvhOptions:c.Consolidation.getDefaultBVHOptions(),useConsolidation:!1,loadAsHidden:!0,bubbleNode:e,disablePrecomputedNodeBoxes:!0,preserveView:!0,onFragmentListLoadProgress:function(){return t._updateDiffLoadProgress()},disable3DModelLayers:!0,keepCurrentModels:!0,headlessViewer:this.options.headlessViewer},l=this._onModelLoaded.bind(this),u=function(n){return t._onModelLoadFailed(e,n)};return n&&Object.assign(a,n),new Promise((function(n,r){t.viewer.loadDocumentNode(s,e,a).then((function(e){l(e),n(e)})).catch((function(e){u(e),r(e)}))}))}}}},{key:"unload",value:function(e){this.viewer.unloadDocumentNode(e);var t=this._getItem(e);t&&(t.loading&&this._onModelLoadEnded(e),t.model&&delete this.loadersInProgress[t.model.id]);var n=h(e);delete this.modelItems[n],this.onUnload.forEach((function(t){return t(e)}))}},{key:"unloadAll",value:function(){for(var e=Object.keys(this.modelItems).slice(),t=0;t<e.length;t++){var n=e[t],r=this.modelItems[n];this.unload(r.node)}}},{key:"setCameraGlobal",value:function(e){this.pendingCamera={position:e.position&&(new THREE.Vector3).copy(e.position),target:e.target&&(new THREE.Vector3).copy(e.target),up:e.up&&(new THREE.Vector3).copy(e.up),fov:e.fov,isPerspective:e.isPerspective},this._applyPendingCameraWhenReady()}},{key:"setCamera",value:function(e){this.viewer.impl.setViewFromCamera(e,!0),this.cameraInitialized=!0}},{key:"startBimWalk",value:function(){this.bimWalkStartPending=!0,this._startBimWalkWhenReady()}},{key:"stopBimWalk",value:function(){var e=this.viewer.getExtension(u.BimWalk);e&&e.isActive()&&e.deactivate(),this.bimWalkStartPending=!1}},{key:"isBimWalkActive",value:function(){var e=this.viewer.getExtension("Bimfish.BimWalk");return e&&e.activeStatus||this.bimWalkStartPending}},{key:"switchView",value:function(e,t){this.reset(),this.setNodes(e,t)}},{key:"setNodes",value:function(e,t){var n=this,r=(e=(e=e||[])instanceof l.BubbleNode?[e]:e).filter((function(e){return!n.isVisible(e)})),i={};e.forEach((function(e){i[n._getModelKey(e)]=!0})),this.getVisibleNodes().filter((function(e){return void 0===i[n._getModelKey(e)]})).forEach((function(e){n.hide(e)})),r.forEach((function(e){n.show(e)})),this._setDiff(t)}},{key:"getFloorSelector",value:function(){return this.levelsExtension&&this.levelsExtension.floorSelector}},{key:"setBookmarks",value:function(e){this.bookmarks=e,this._updateBookmarks()}},{key:"isLoadDone",value:function(){for(var e in this.modelItems){var t=this.modelItems[e],n=t&&t.model,r=!n&&!t.error,i=n&&!n.isLoadDone(),o=n&&n.getPropertyDb()&&!n.getPropertyDb().isLoadDone(),s=c.TextureLoader.requestsInProgress()>0;if(r||i||o||s)return!1}return!0}},{key:"waitForLoadDone",value:function(){var e=this;return new Promise((function(t){e.isLoadDone()&&t();var n=function n(){e.isLoadDone()&&(e.viewer.removeEventListener(l.GEOMETRY_LOADED_EVENT,n),e.viewer.removeEventListener(l.OBJECT_TREE_CREATED_EVENT,n),e.viewer.removeEventListener(l.TEXTURES_LOADED_EVENT,n),e.onUnload.splice(e.onUnload.indexOf(n),1),t())};e.viewer.addEventListener(l.GEOMETRY_LOADED_EVENT,n),e.viewer.addEventListener(l.OBJECT_TREE_CREATED_EVENT,n),e.viewer.addEventListener(l.TEXTURES_LOADED_EVENT,n),e.onUnload.push(n)}))}},{key:"_setDiff",value:function(e){e?(this.diff.diffBubbles=e.diffBubbles,this.diff.primaryBubbles=e.primaryBubbles,this.diff.diffBubbleLabel=e.diffBubbleLabel,this.diff.primaryBubbleLabel=e.primaryBubbleLabel,this.diff.progressCallback=e.progressCallback,this.diff.supportBubbles=e.supportBubbles,this.diff.empty=e.empty,this.diff.refNames=e.refNames,e.supportBubbles&&(this.load(e.supportBubbles.primary),this.load(e.supportBubbles.diff)),!e.empty&&e.progressCallback&&this._signalDiffLoadProgress(0,!0),this.diffStartTime=performance.now()):(this.diff.diffBubbles=void 0,this.diff.primaryBubbles=void 0,this.diff.diffBubbleLabel=void 0,this.diff.primaryBubbleLabel=void 0,this.diff.progressCallback=void 0,this.diff.supportBubbles=void 0,this.diff.refNames=void 0),this.diff.enabled=Boolean(e),this.diffNeedsUpdate=!0,this._updateDiff()}},{key:"_showModel",value:function(e){this.viewer.showModel(e.id,!0),y(this.viewer)}},{key:"_onModelAdded",value:function(e){var t=this,n=e.model;if(this.cameraInitialized||this._initCamera(n),!n.getData().underlayRaster){this.resetOnNextModelAdd&&(this.viewer.getExtension(u.ZoomWindow)&&this.viewer.unloadExtension(u.ZoomWindow),this.resetOnNextModelAdd=!1,this.options.headlessViewer||this.viewer.createUI(n),this.viewer.activateDefaultNavigationTools(!this.is3D),this._loadExtension(u.ZoomWindow).catch((function(e){return t._onError(e)})),this._startBimWalkWhenReady()),function(e){var t=e.getData(),n=t.loadOptions.bubbleNode;if(e.is3d()&&t.metadata.stats&&!t.metadata.stats.num_fragments){var r=n.name(),i=n.getRootNode().children[0].name();console.warn('Empty View "'.concat(r,'" in model "').concat(i,'".'))}}(n);var r=e.model.getDocumentNode();if(r){var i=this._getModelKey(r);delete this.modelIsGhosted[i],this._updateGhosting()}}}},{key:"_onGeometryLoaded",value:function(e){this._consolidateVisibleModels(),this._updateDiff(),this.loadersInProgress[e.model.id]=100}},{key:"_onExtensionLoaded",value:function(e){var t=e.extensionId;this._startBimWalkWhenReady(),t===u.Levels&&(this.levelsExtension=this.viewer.getExtension(u.Levels)),t===u.Bookmarks&&this._updateBookmarks()}},{key:"_registerLmvEventListeners",value:function(){this.viewer.addEventListener(l.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded.bind(this)),this.viewer.addEventListener(l.MODEL_ADDED_EVENT,this._onModelAdded.bind(this)),this.viewer.addEventListener(l.EXTENSION_LOADED_EVENT,this._onExtensionLoaded.bind(this)),this.viewer.addEventListener(l.PROGRESS_UPDATE_EVENT,this._onProgressUpdate.bind(this)),this.viewer.addEventListener(l.MODEL_ROOT_LOADED_EVENT,this._updateDiff.bind(this))}},{key:"_consolidateVisibleModels",value:function(){if(this._cleanupModels(),!Object(i.isMobileDevice)()&&"false"!==Object(r.getParameterByName)("useConsolidation"))for(var e=this.viewer.getVisibleModels(),t=0;t<e.length;t++){var n=e[t];if(this.memTracker.memoryExceeded())return;if(!n||!n.isLoadDone())return;if(n.is2d())return;if(!n.isConsolidated()){var o=this.viewer.impl.glrenderer(),s=this.viewer.impl.getMaterials();n.consolidate(s,void 0,o,!0),this._cleanupModels()}}}},{key:"_cleanupModels",value:function(){var e=this;this._updateModelTimestamps(),this.memTracker.cleanup((function(t){var n=t.getDocumentNode(),r=e._getItem(n);r&&r.visible||e.unload(n)}))}},{key:"_updateModelTimestamps",value:function(){var e=this.viewer.getVisibleModels().slice(),t=this._getDiffSupportModels();this.diff.enabled&&t&&(t.diff&&e.push(t.diff),t.primary&&e.push(t.primary)),this.memTracker.updateModelTimestamps(e)}},{key:"_stopActiveTools",value:function(){var e=this.viewer.getExtension("Bimfish.Section");e&&e.isActive()&&e.enableSectionTool(!1),this.stopBimWalk();var t=!this.options.headlessViewer&&this.viewer.getPropertyPanel(!1);t&&t.isVisible()&&t.setVisible(!1)}},{key:"_onModelLoaded",value:function(e){var t=this._getItem(e);t&&(e.is3d()&&this.waitForFirstModel&&!this.options.ignoreGlobalOffset&&(this.globalOffset=(new THREE.Vector3).copy(e.myData.globalOffset),this._onGlobalOffsetChanged()),t.model=e,t.visible&&this._showModel(t.model),this._updateModelTimestamps(),this._updateDiffLoadProgress(),this._onModelLoadEnded(t.node))}},{key:"_onModelLoadFailed",value:function(e,t){this._onError("Failed to load model: ".concat(e.name(),". Error code: ").concat(t)),this._onModelLoadEnded(e)}},{key:"_onModelLoadEnded",value:function(e){if(this._getItem(e).loading=!1,e.is3D()&&this.waitForFirstModel)for(var t in this.waitForFirstModel=!1,this.modelItems){var n=this.modelItems[t].node;this.load(n)}}},{key:"_initCamera",value:function(e,t){this.viewer.impl.setViewFromFile(e,!t),this.viewer.impl.controls.recordHomeView(),this.cameraInitialized=!0,this.pendingCamera&&this._applyPendingCameraWhenReady()}},{key:"_getItem",value:function(e){var t=h(e);return this.modelItems[t]}},{key:"_getModelKey",value:function(e){return d(e)}},{key:"_updateRefPoint",value:function(e){if(this.isEmpty()&&e.is3D()&&!this.options.ignoreGlobalOffset){var t=e.getAecModelData();if(t){var n=t&&t.refPointTransformation;this.refPoint=n?{x:n[9],y:n[10],z:0}:{x:0,y:0,z:0};var r=this.globalOffset&&THREE.Vector3.prototype.distanceToSquared.call(this.refPoint,this.globalOffset);(!this.globalOffset||r>4e6)&&(this.globalOffset=(new THREE.Vector3).copy(this.refPoint),this.unloadAll(),this._onGlobalOffsetChanged())}}}},{key:"_onGlobalOffsetChanged",value:function(){var e=this.viewer.getExtension(u.Bookmarks);e&&e.resetGlobalOffset(this.globalOffset)}},{key:"_loadExtensions",value:(m=s(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],!l.isMobileDevice()&&t.push(this._loadExtension(u.CrossFade)),t.push(this._loadExtension(u.Levels,this.viewer.config)),t.push(this._loadExtension(u.ModelStructure,this.viewer.config)),(n=this.viewer.config).disabledExtensions=this.viewer.config.disabledExtensions||{},n.disabledExtensions.hyperlink=!0,t.push(this._loadExtension(u.Hyperlinks,{loadViewableCb:function(e,t){r.onHyperlink?r.onHyperlink(e,t):r.switchView([e])}})),this.options.disableMinimap||t.push(this._loadExtension(u.Minimap,{trackUsage:this._trackMinimapUsage?this._trackMinimapUsage.bind(this):void 0})),e.abrupt("return",Promise.all(t));case 11:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"_loadExtension",value:(p=s(regeneratorRuntime.mark((function e(t,n){var r,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.options.extensionOptions,i=r&&r[t],o=Object.assign({},n,i),e.abrupt("return",this.viewer.loadExtension(t,o));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"_updateExtensions",value:function(){var e=this,t={globalOffset:this.globalOffset,onBookmark:function(t,n){e.onBookmark?e.onBookmark(t,n):e.switchView([t]),n.isPerspective&&e.startBimWalk()},clusterfck:this.options.clusterfck,clusteringThreshold:110},n={enableGuidance:!0,onDrop:this._handleDropMe.bind(this)},r=function(t,n,r){var i=e.extensionLoaded[t];!i&&r?e._loadExtension(t,n).catch((function(t){return e._onError(t)})):i&&!r&&e.viewer.unloadExtension(t),e.extensionLoaded[t]=r};r(u.Bookmarks,t,this.is3D),r(u.DropMe,n,!this.is3D)}},{key:"_initForFirstViewable",value:function(e){this.is3D!==e.is3D()&&(this.resetOnNextModelAdd||this.reset(),this.is3D=e.is3D()),this._updateExtensions(),this._updateRefPoint(e)}},{key:"_updateBookmarks",value:function(){var e=this.viewer.getExtension(u.Bookmarks);e&&e.resetBookmarks(this.bookmarks)}},{key:"_applyPendingCameraWhenReady",value:function(){if(this.cameraInitialized){var e=this.pendingCamera;this.pendingCamera=null;var t=this.viewer.impl.camera;e.position&&t.position.copy(e.position),e.target&&t.target.copy(e.target),e.up&&t.up.copy(e.up),e.fov&&(t.fov=e.fov),void 0!==e.isPerspective&&(t.isPerspective=e.isPerspective);var n=this.globalOffset||this.viewer.model.getData().globalOffset;this.is3D&&!this.options.ignoreGlobalOffset&&(t.position.sub(n),t.target.sub(n)),this.viewer.impl.syncCamera()}}},{key:"_handleDropMe",value:function(e,t,n){if(this.onDrop)this.onDrop(e,t,n);else{var r=function(e){var t=e.impl.model,n=t&&t.getDocumentNode(),r=n&&n.getRootNode();if(r){var i=r&&r.search(l.BubbleNode.MODEL_NODE),o=i.filter((function(e){return e.parent&&"08f99ae5-b8be-4f8d-881b-128675723c10"===e.parent.name()}));if(o[0])return o[0];var s=i.filter((function(e){return"{3D}"==e.name}))[0];return s||i[0]}}(this.viewer);if(r){var i={position:e,target:e.clone().add(t),isPerspective:!0};this.switchView(r),this.setCameraGlobal(i)}else console.warn("DropMe handler: Document does not contain a 3D view to switch to")}}},{key:"_startBimWalkWhenReady",value:function(){if(this.bimWalkStartPending){var e=!this.resetOnNextModelAdd,t=this.viewer.getExtension(u.BimWalk),n=this.viewer.getExtension(u.FusionOrbit);e&&t&&n&&(t.activate(),this.bimWalkStartPending=!1)}}},{key:"_unloadDiffTool",value:function(e){this.viewer.getExtension(u.DiffTool)&&(e&&(this.diffCache.length=0),this.viewer.unloadExtension(u.DiffTool))}},{key:"_onProgressUpdate",value:function(e){e.model&&e.state===l.ProgressState.LOADING&&(this.loadersInProgress[e.model.id]=e.percent,this._updateDiffLoadProgress())}},{key:"_getDiffSupportModels",value:function(){if(this.diff.supportBubbles)return{diff:this.getModel(this.diff.supportBubbles.diff),primary:this.getModel(this.diff.supportBubbles.primary)}}},{key:"_diffSupportModelsReady",value:function(){var e=this._getDiffSupportModels(),t=e.diff&&e.diff.isLoadDone(),n=e.primary&&e.primary.isLoadDone();return t&&n}},{key:"_updateGhosting",value:function(){var e=this,t={};for(var n in this.diff.enabled&&this.diffBubbles&&(t=this.diffBubbles.forEach((function(n){return t[e._getModelKey(n)]}))),this.modelItems){var r=this.getModel(n);if(r){var i=this.diff.enabled&&!t[n];i!=!!this.modelIsGhosted[n]&&(r.setAllVisibility(!i),i?this.modelIsGhosted[n]=!0:delete this.modelIsGhosted[n])}}}},{key:"getModels",value:function(e){var t=this;return e.map((function(e){return t.getModel(e)}))}},{key:"_signalDiffLoadProgress",value:function(e,t){if(t||e!==this._lastDiffLoadPercent){var n=l.i18n.t("Loading Model for Change Visualization");this.diff.progressCallback(e,n),this._lastDiffLoadPercent=e}}},{key:"_updateDiffLoadProgress",value:function(){var e=this;if(this.diffNeedsUpdate&&this.diff.enabled&&!this.diff.empty&&this.diff.progressCallback){var t=this.getModels(this.diff.diffBubbles),n=this.getModels(this.diff.primaryBubbles),r=t.concat(n),i=this._getDiffSupportModels();i&&r.push(i.diff,i.primary);var o=r.filter(Boolean).length;if(o<r.length){var s=Math.floor(10*o/r.length);this._signalDiffLoadProgress(s)}else if(this.is3D){var a=r.reduce((function(e,t){return e+t.getData().fragsLoadedNoGeom}),0),l=r.reduce((function(e,t){return e+t.getData().metadata.stats.num_fragments}),0),c=10+Math.floor(90*a/l);this._signalDiffLoadProgress(c)}else{var u=r.reduce((function(t,n){return t+(0|e.loadersInProgress[n.id])}),0),d=100*r.length,h=10+Math.floor(90*u/d);this._signalDiffLoadProgress(h)}}}},{key:"_updateDiff",value:function(){if(this.diffNeedsUpdate)if(this._updateGhosting(),this._updateDiffLoadProgress(),this.diff.enabled){for(var e=this.getModels(this.diff.diffBubbles),t=this.getModels(this.diff.primaryBubbles),n=0;n<e.length;n++){var r=e[n],i=t[n],o=r instanceof l.Model&&(r.isOTG()||r.isLoadDone()),s=i instanceof l.Model&&(i.isOTG()||i.isLoadDone());if(!o||!s)return;if(!r.getPropertyDb()||!i.getPropertyDb())return}var a=void 0;if(this.diff.supportBubbles){if(!this._diffSupportModelsReady())return;a=this._getDiffSupportModels()}var c=performance.now()-this.diffStartTime;console.log("Time for loading diff models: ",c),this._setDiffModels(e,t,a)}else this._unloadDiffTool()}},{key:"_setDiffModels",value:function(e,t,n){var r=this;if(this.diffNeedsUpdate=!1,t.length){var i=this.viewer.getExtension(u.DiffTool);if(i)i.replaceModels(e,t,n);else{var o={diffModels:e,primaryModels:t,supportModels:n,diffadp:!1,availableDiffModes:["overlay","sidebyside"],diffMode:"overlay",versionA:this.diff.primaryBubbleLabel,versionB:this.diff.diffBubbleLabel,refNames:this.diff.refNames,mimeType:"application/vnd.Bimfish.revit",hotReload:!0,diffCache:this.diffCache,useSplitScreenExtension:!0,showDetailsSection:!0,progress:function(e,t){r.diff.progressCallback&&(t!==Bimfish.DiffTool.DIFFTOOL_PROGRESS_STATES.LoadingPropDb?(100===e&&r.onDiffDone&&r.onDiffDone(),r.diff.progressCallback(e,l.i18n.t("Computing change visualization"))):r.diff.progressCallback(e,l.i18n.t("Loading element properties")))},excludeFromDiff:function(e,t){return r.levelsExtension&&!r.levelsExtension.floorSelector.isVisible(e,t)},setNodesOff:function(e){var t=r.levelsExtension;t&&t.floorSelector._floorSelectorFilter.reApplyFilter(e)},hideModeSwitchButton:!0};this._loadExtension(u.DiffTool,o).catch((function(e){return r._onError(e)}))}}else this._unloadDiffTool()}}])&&a(t.prototype,n),o&&a(t,o),e}();_.ExtNames=u},"./src/application/CameraLS.js":
/*!*************************************!*\
  !*** ./src/application/CameraLS.js ***!
  \*************************************/
/*! exports provided: CameraLS */function(e,t,n){"use strict";n.r(t),n.d(t,"CameraLS",(function(){return u}));var r=n(/*! ./GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var a=function(e){return isFinite(e.x)&&isFinite(e.y)&&isFinite(e.z)},l=function(e){var t=e.isPerspective||isFinite(e.orthoScale);return a(e.position)&&a(e.target)&&a(e.up)&&t},c=function(){function e(){i(this,e),this.cacheObj={}}return s(e,[{key:"setItem",value:function(e,t){this.cacheObj[e]=t}},{key:"getItem",value:function(e){return this.cacheObj[e]}}]),e}(),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{useLocalStorage:!0};i(this,e),this.aggregatedView=t,this.options=n,this.key=void 0,this.options.useLocalStorage?this.cache=Bimfish.Viewing.Private.LocalStorage:this.cache=new c,this.unloadCb=this.saveCamera.bind(this),this.addWindowEventListener("beforeunload",this.unloadCb)}return s(e,[{key:"destroy",value:function(){this.unsetKey(),this.removeWindowEventListener("beforeunload",this.unloadCb)}},{key:"setKey",value:function(e){this.key=e}},{key:"unsetKey",value:function(){this.key=void 0}},{key:"saveCamera",value:function(){if(this.aggregatedView.cameraInitialized&&this.key){var e=this.aggregatedView.viewer.impl.camera;if(l(e)){var t=this.aggregatedView.isBimWalkActive(),n=this.aggregatedView.is3D?this.aggregatedView.globalOffset:void 0;this.saveStartCamera(this.key,this.aggregatedView.viewer.impl.camera,t,n)}}}},{key:"saveStartCamera",value:function(e,t,n,r){var i=JSON.stringify({offset:r,position:t.position,target:t.target,up:t.up,orthoScale:t.orthoScale,isPerspective:t.isPerspective,fov:t.fov,startBimWalk:n});this.cache.setItem(e,i)}},{key:"loadCamera",value:function(){if(!this.key)return!1;var e=void 0;try{var t=this.cache.getItem(this.key);e=JSON.parse(t)}catch(e){}if(!(e&&e.position&&e.target&&e.up))return!1;var n=function(e){return new THREE.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z))},r={position:n(e.position),target:n(e.target),up:n(e.up),isPerspective:Boolean(e.isPerspective),fov:parseFloat(e.fov)};if(e.orthoScale&&(r.orthoScale=parseFloat(e.orthoScale)),!l(r))return!1;var i=e.offset?n(e.offset):void 0;if(i){if(!a(i))return;r.position.add(i),r.target.add(i)}this.aggregatedView.setCameraGlobal(r),e.startBimWalk&&this.aggregatedView.startBimWalk()}}]),e}();r.GlobalManagerMixin.call(u.prototype)},"./src/application/Document.js":
/*!*************************************!*\
  !*** ./src/application/Document.js ***!
  \*************************************/
/*! exports provided: Document */function(e,t,n){"use strict";n.r(t),n.d(t,"Document",(function(){return p}));var r=n(/*! ./bubble */"./src/application/bubble.js"),i=n(/*! ../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),o=n(/*! ../file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),s=n(/*! ../file-loaders/net/Xhr */"./src/file-loaders/net/Xhr.js"),a=n(/*! ../compat */"./src/compat.js"),l=n(/*! ../file-loaders/main/LeafletLoader */"./src/file-loaders/main/LeafletLoader.js"),c=n(/*! ../logger/Logger */"./src/logger/Logger.js"),u=n(/*! ../envinit */"./src/envinit.js"),d=n(/*! ../globals */"./src/globals.js"),h=Object(a.getGlobal)(),f=h;function p(e,t,n){this.myPath=t,this.myData=e,e&&(this.docRoot=new r.BubbleNode(e),this.docRoot.setDocument(this)),this.myNumViews={},this.acmSessionId=n;var i=this;this.docRoot.traverse((function(e){if(e.isViewPreset()){var t=e.findParentGeom2Dor3D(),n=i.myNumViews[t.guid()]||0;i.myNumViews[t.guid()]=n+1}})),0===this.docRoot.findAllViewables().length&&c.logger.error("Document contains no viewables.")}p.load=function(e,t,n,r,a){var l,c,d=p.getDocumentPath(e),f=o.endpoint.getApiFlavor()===o.endpoint.ENDPOINT_API_FLUENT;function m(e){f&&(l=l?e.urn+","+l:e.urn);var r=new p(e,d,l);if(r.getRoot().search({type:"geometry"}).length>0)c=r.getGlobalMessages(),t&&t(r,c);else if(n){c=r.getGlobalMessages();var o=i.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT;n(o,"No viewable content",c)}}function g(e,t,r){if(401===e&&void 0===h.LMV_THIRD_PARTY_COOKIE)h.LMV_THIRD_PARTY_COOKIE=!1,Object(u.refreshRequestHeader)(u.token.accessToken),v();else if(n){var o="Error: "+e+" ("+t+")",s=Object(i.getErrorCode)(e);n(s,o,e,t,r)}}function v(){var e=!r||f&&!r["x-ads-acm-scopes"],t=a?"&bypassds=1":"";l||e?s.ViewingService.getManifest(o.endpoint.initLoadContext({queryParams:t.substring(1)}),d,m,g):(r.oauth2AccessToken||(r.oauth2AccessToken=u.token.accessToken),s.ViewingService.getACMSession(o.endpoint.getApiEndpoint(),r,(function(e){var n={queryParams:(l=e)?"acmsession="+l:""+t};o.endpoint.setAcmSession(l),s.ViewingService.getManifest(o.endpoint.initLoadContext(n),d,m,g)}),n))}v()},p.getDocumentPath=function(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),f.location.protocol+"//"+f.location.host+t):t}return e},p.requestThumbnailWithSecurity=function(e,t){var n={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},r="urn:"+e.urn;s.ViewingService.getThumbnail(o.endpoint.initLoadContext(),r,(function(e){t(null,e)}),(function(){t("error",null)}),n)},p.prototype.getFullPath=function(e){if(!e)return e;var t=e;if(Object(o.isOffline)())-1==t.indexOf(Object(o.getOfflineResourcePrefix)())&&(t=decodeURIComponent(Object(o.getOfflineResourcePrefix)())+t.substr(t.indexOf("/")));else if(0===e.indexOf("urn")){0===e.indexOf("urn:adsk.fluent")||o.endpoint.getApiFlavor()!==o.endpoint.ENDPOINT_API_FLUENT?(t=o.endpoint.getItemApi(null,e),o.endpoint.ENDPOINT_API_MODEL_DERIVATIVE_V2===o.endpoint.getApiFlavor()&&(t=decodeURIComponent(t))):t=o.endpoint.getItemApi(o.endpoint.getApiEndpoint(),e,"derivativeV2")}else 0===e.indexOf("$file$")&&(t=this.myPath.replace("/bubble.json","")+e.replace("$file$",""));return t},p.prototype.getThumbnailOptions=function(e,t,n){var r=t||200,i=n||200;return{urn:this.myData.urn,width:r,height:i,guid:e.guid,acmsession:this.acmSessionId}},p.prototype.getThumbnailPath=function(e,t,n){var r=this.getThumbnailOptions(e,t,n),i=o.endpoint.getThumbnailApi(null,r.urn)+"?guid="+r.guid+"&width="+r.width+"&height="+r.height;r.acmsession&&(i+="&acmsession="+r.acmsession);var s=o.endpoint.getDomainParam();return s&&(i+="&"+s),i},p.prototype.getLeafletZipParams=function(e,t){for(var n,r,i=t.search({role:"leaflet-zip"},!1),o=0;o<i.length;o++){r={};var s=(n=i[o]._raw()).urn;r.urnZip=this.getFullPath(s),r.centralDirOffset=n.central_dir_offset,r.centralDirLength=n.central_dir_length,r.centralDirEntries=n.central_dir_entries,r.zipMaxLevel=n.max_level-e.levelOffset,r.loadFromZip=!!(r.urnZip&&r.centralDirOffset&&r.centralDirLength&&r.centralDirEntries),r.fileTable={},e.zips||(e.zips=[]),e.zips.push(r)}e.zips.sort((function(e,t){return e.zipMaxLevel-t.zipMaxLevel}))},p.prototype.getLeafletParams=function(e,t,n){e.tileSize=n.tileSize?n.tileSize:512,e.texWidth=n.resolution[0],e.texHeight=n.resolution[1],e.paperWidth=n.paperWidth,e.paperHeight=n.paperHeight,e.paperUnits=n.paperUnits,e.urlPattern=n.urn,e.mime=n.mime,e.isLeaflet=!0,e.levelOffset=l.LeafletLoader.computeLevelOffset(e.tileSize),this.getLeafletZipParams(e,t),e.loadFromZip=e.zips&&e.zips[0].loadFromZip,e.zips&&Object(o.isOffline)()&&Object(a.isMobileDevice)()&&(e.zips=e.zips.slice(0,1),e.maxLevel=e.zips[0].zipMaxLevel)},p.prototype.derivePdfUrnHack=function(e,t){var n=e.parent.children.slice();n.sort((function(e,t){return e._raw().order-t._raw().order}));var i=(n.length<=75?n[n.length-1]:n[74]).search(r.BubbleNode.GEOMETRY_F2D_NODE)[0];if(i){var o=i.urn().indexOf("/"),s=i.urn().slice(0,o),a=e._raw().order,l=0|a%75,c=1+(0|a/75),u=s+"/output/".concat(l,"/").concat(l,".pdf");return t.page=c,t.isPdf=!0,console.log("pdf path",u),u}return null},p.prototype.getViewableUrn=function(e,t){var n;if(e instanceof r.BubbleNode)n=e;else{var i=this.docRoot.search(e);n=i.length>0?i[0]:new r.BubbleNode(e)}if(n.isGeometry()){if(n.is3D())return n.getViewableRootPath();if(n.is2D()){var o=n.data.totalRasterPixels;"number"!=typeof o&&(o=1/0);var s=o<1<<20,l="true"===Object(d.getParameterByName)("vectorPdf")||Object(a.getGlobal)().LMV_VECTOR_PDF||this.myData&&this.myData.isVectorPDF,c="false"===Object(d.getParameterByName)("vectorPdf")||Object(a.getGlobal)().LMV_RASTER_PDF;l?s=!0:c&&(s=!1);var u=n.search(r.BubbleNode.PDF_PAGE_NODE),h=n.search(r.BubbleNode.LEAFLET_NODE);if(s&&h.length>0&&t&&(this.getLeafletParams(t,n,h[0]._raw()),t.tempRasterPath=h[0].urn()),s&&u.length)return t.isPdf=!0,t.page=u[0].data.page||1,u[0].urn();if(h.length>0&&t){if(l){var f=this.derivePdfUrnHack(n,t);if(f)return f}return this.getLeafletParams(t,n,h[0]._raw()),h[0].urn()}var p=n.search(r.BubbleNode.IMAGE_NODE);if(p.length)return p[0].urn();var m=n.search(r.BubbleNode.GEOMETRY_F2D_NODE);if(m.length)return m[0].urn()}}else if(n.isViewPreset()){var g=this.getViewGeometry(n,!0);if(g)return this.getViewableUrn(g,t)}return""},p.prototype.getViewablePath=function(e,t){var n=this.getViewableUrn(e,t);return n?this.getFullPath(n):""},p.prototype.downloadAecModelData=function(e){var t=this.docRoot.findViewableParent(),n=t&&t.data.aec_model_data;if(n)return e&&e(n),Promise.resolve(n);var r=this.docRoot.search({role:"Bimfish.AEC.ModelData"})[0];if(!r)return e&&e(),Promise.resolve(null);var i={};this.acmSessionId&&(i.queryParams="acmsession="+this.acmSessionId);var a=r.getViewableRootPath(),l=this.getFullPath(a);return new Promise((function(t){var n=function(n){r.findViewableParent().data.aec_model_data=n,e&&e(n),t(n)};s.ViewingService.getItem(o.endpoint.initLoadContext(i),l,(function(e){return n(e)}),(function(){return n()}),{responseType:"json"})}))},p.getAecModelData=function(e){if(Array.isArray(e)){var t=new Map,n=e.map((function(e){var n=e.getDocument(),r=t.get(n);if(r)return r;var i=n.downloadAecModelData();return t[n]=i,i}));return Promise.all(n)}return e.getDocument().downloadAecModelData()},p.prototype.getRoot=function(){return this.docRoot},p.prototype.getPath=function(){return this.myPath},p.prototype.getViewGeometry=function(e){return e.findParentGeom2Dor3D()},p.prototype.getNumViews=function(e){var t=e.guid;return e instanceof r.BubbleNode&&(t=e.guid()),this.myNumViews[t]||0},p.prototype.getMessages=function(e,t){var n=[];if(!e)return n;for(var r=e;r&&(!t||r.parent);)r._raw().messages&&(n=n.concat(r._raw().messages)),r=r.parent;return n},p.prototype.getGlobalMessages=function(){var e=[],t=0,n=0;this.getRoot().traverse((function(r){var i=r._raw().messages||[];i.filter((function(e){return"error"===e.type})).length>0&&(t+=1),"inprogress"===r._raw().status&&(n+=1),e=e.concat(i)}));var r="translated";r=t>0?"failed":r,r=n>0?"processing":r;for(var i=e.length;i--;e[i].$translation=r);return e}},"./src/application/EventDispatcher.js":
/*!********************************************!*\
  !*** ./src/application/EventDispatcher.js ***!
  \********************************************/
/*! exports provided: EventDispatcher */function(e,t,n){"use strict";n.r(t),n.d(t,"EventDispatcher",(function(){return r}));var r=function(){};r.prototype={constructor:r,apply:function(e){e.addEventListener=r.prototype.addEventListener,e.hasEventListener=r.prototype.hasEventListener,e.removeEventListener=r.prototype.removeEventListener,e.clearListeners=r.prototype.clearListeners,e.fireEvent=r.prototype.fireEvent,e.dispatchEvent=r.prototype.fireEvent,e.debugEvents=r.prototype.debugEvents},addEventListener:function(e,t,n){e&&(void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push({callbackFn:t,once:!!n&&!!n.once}))},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var n=this.listeners[e];if(!n||0===n.length)return!1;for(var r=0,i=n.length;r<i;++r)if(n[r].callbackFn===t)return!0;return!1},removeEventListener:function(e,t){if(e)if(void 0!==this.listeners){var n=this.listeners[e];if(n)for(var r=0,i=n.length;r<i;++r)if(n[r].callbackFn===t){n.splice(r,1);break}}else this.listeners={}},clearListeners:function(){this.listeners=null},dispatchEvent:function(e){if(void 0!==this.listeners){if("string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.");if(this._doDebug&&console.log("Event: "+e.type),Array.isArray(this.listeners[e.type])){for(var t=this.listeners[e.type].slice(),n=[],r=0,i=t.length;r<i;++r)t[r].callbackFn.call(this,e),t[r].once&&n.push(t[r].callbackFn);for(var o=0;o<n.length;++o)this.removeEventListener(e.type,n[o])}}else this.listeners={}},debugEvents:function(e){this._doDebug=e}},r.prototype.fireEvent=r.prototype.dispatchEvent,"undefined"!=typeof Bimfish&&(Bimfish.Viewing.EventDispatcher=r)},"./src/application/EventTypes.js":
/*!***************************************!*\
  !*** ./src/application/EventTypes.js ***!
  \***************************************/
/*! no static exports found */function(e,t,n){"use strict";var r=e.exports;r.ESCAPE_EVENT="escape",r.PROGRESS_UPDATE_EVENT="progress",r.FULLSCREEN_MODE_EVENT="fullScreenMode",r.NAVIGATION_MODE_CHANGED_EVENT="navmode",r.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",r.VIEWER_RESIZE_EVENT="viewerResize",r.VIEWER_INITIALIZED="viewerInitialized",r.VIEWER_UNINITIALIZED="viewerUninitialized",r.LOADER_LOAD_FILE_EVENT="loaderLoadFile",r.MODEL_ROOT_LOADED_EVENT="svfLoaded",r.GEOMETRY_LOADED_EVENT="geometryLoaded",r.TEXTURES_LOADED_EVENT="texturesLoaded",r.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",r.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",r.OBJECT_TREE_LOAD_PROGRESS_EVENT="propertyDbLoadProgress",r.MODEL_UNLOADED_EVENT="modelUnloaded",r.MODEL_ADDED_EVENT="modelAdded",r.MODEL_REMOVED_EVENT="modelRemoved",r.MODEL_LAYERS_LOADED_EVENT="modelLayersLoaded",r.EXTENSION_LOADED_EVENT="extensionLoaded",r.EXTENSION_UNLOADED_EVENT="extensionUnloaded",r.SELECTION_CHANGED_EVENT="selection",r.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",r.ISOLATE_EVENT="isolate",r.AGGREGATE_ISOLATION_CHANGED_EVENT="aggregateIsolation",r.HIDE_EVENT="hide",r.AGGREGATE_HIDDEN_CHANGED_EVENT="aggregateHidden",r.SHOW_EVENT="show",r.SHOW_PROPERTIES_EVENT="showProperties",r.SHOW_ALL_EVENT="showAll",r.CAMERA_CHANGE_EVENT="cameraChanged",r.EXPLODE_CHANGE_EVENT="explodeChanged",r.FIT_TO_VIEW_EVENT="fitToView",r.AGGREGATE_FIT_TO_VIEW_EVENT="aggregateFitToView",r.CUTPLANES_CHANGE_EVENT="cutplanesChanged",r.TOOL_CHANGE_EVENT="toolChanged",r.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",r.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",r.RENDER_PRESENTED_EVENT="renderPresented",r.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",r.PREF_CHANGED_EVENT="PrefChanged",r.PREF_RESET_EVENT="PrefReset",r.RESTORE_DEFAULT_SETTINGS_EVENT="restoreDefaultSettings",r.ANIMATION_READY_EVENT="animationReady",r.CAMERA_TRANSITION_COMPLETED="cameraTransitionCompleted",r.HYPERLINK_EVENT="hyperlink",r.HYPERLINK_NAVIGATE="hyperlink_navigate",r.LOAD_GEOMETRY_EVENT="load_geometry",r.LOAD_MISSING_GEOMETRY="loadMissingGeometry",r.WEBGL_CONTEXT_LOST_EVENT="webglcontextlost",r.CANCEL_LEAFLET_SCREENSHOT="cancelLeafletScreenshot",r.SET_VIEW_EVENT="setView",r.RENDER_FIRST_PIXEL="renderFirstPixel",r.PROFILE_CHANGE_EVENT="profileChanged"},"./src/application/EventUtils.js":
/*!***************************************!*\
  !*** ./src/application/EventUtils.js ***!
  \***************************************/
/*! exports provided: EventUtils */function(e,t,n){"use strict";n.r(t),n.d(t,"EventUtils",(function(){return a}));var r=n(/*! ../compat */"./src/compat.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=!1,s=!1,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"isRightClick",value:function(e){if(!(e instanceof l(e).MouseEvent))return!1;var t=e.button;return"buttons"in e&&(!s||1&e.buttons?2===t&&1&e.buttons&&(t=0,s=!0):(s=!1,t=0)),t===(o?0:2)}},{key:"isMiddleClick",value:function(e){return e instanceof l(e).MouseEvent&&1===e.button}},{key:"setUseLeftHandedInput",value:function(e){o=e}}],(n=null)&&i(t.prototype,n),r&&i(t,r),e}();function l(e){var t=e.target&&e.target.ownerDocument;return t?t.defaultView||t.parentWindow:Object(r.getGlobal)()}Bimfish.Viewing.isRightClick=a.isRightClick,Bimfish.Viewing.isMiddleClick=a.isMiddleClick},"./src/application/Extension.js":
/*!**************************************!*\
  !*** ./src/application/Extension.js ***!
  \**************************************/
/*! exports provided: Extension */function(e,t,n){"use strict";n.r(t),n.d(t,"Extension",(function(){return o}));var r=n(/*! ../globalization/i18init */"./src/globalization/i18init.js"),i=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),o=function(e,t){this.viewer=e,i.GlobalManagerMixin.call(this),this.setGlobalManager(e.globalManager),this.options=t||{},this.id="",this.modes=[],this.mode="",this.name="",this.activeStatus=!1};o.prototype.load=function(){return!0},o.prototype.unload=function(){return!0},o.prototype.activate=function(e){return!0},o.prototype.deactivate=function(){return!0},o.prototype.getName=function(){return this.name},o.prototype.getModes=function(){return this.modes},o.prototype.isActive=function(e){return e?this.activeStatus&&this.mode===e:this.activeStatus},o.prototype.getState=function(e){},o.prototype.restoreState=function(e,t){return!0},o.prototype.extendLocalization=function(e){return Object(r.extendLocalization)(e)},o.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={});var e=this.viewer.extensionCache[this.id];return e||(e=this.viewer.extensionCache[this.id]={}),e},o.prototype.onToolbarCreated=function(e){},"undefined"!=typeof Bimfish&&(Bimfish.Viewing.Extension=o)},"./src/application/ExtensionManager.js":
/*!*********************************************!*\
  !*** ./src/application/ExtensionManager.js ***!
  \*********************************************/
/*! exports provided: theExtensionManager, ExtensionMixin */function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"theExtensionManager",(function(){return l})),n.d(t,"ExtensionMixin",(function(){return c}));var r=n(/*! ../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ../resource-loader */"./src/resource-loader.js"),o=n(/*! ./EventTypes */"./src/application/EventTypes.js");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registeredExtensions=new Map}var t,n,r;return t=e,(n=[{key:"registerExtension",value:function(e,t){if(this.registeredExtensions.has(e)){var n=this.registeredExtensions.get(e);if(n.EXTENSION_CLASS)return!1;n.EXTENSION_CLASS=t}else this.registeredExtensions.set(e,{EXTENSION_CLASS:t});return!0}},{key:"getExtensionClass",value:function(e){return this.registeredExtensions.has(e)?this.registeredExtensions.get(e).EXTENSION_CLASS:null}},{key:"unregisterExtension",value:function(e){return!!this.registeredExtensions.has(e)&&(this.registeredExtensions.delete(e),!0)}},{key:"registerExternalExtension",value:function(e,t){return!this.registeredExtensions.has(e)&&(this.registeredExtensions.set(e,{EXTENSION_CLASS:null,externalPath:t}),!0)}},{key:"getExternalPath",value:function(e){return this.registeredExtensions.has(e)?this.registeredExtensions.get(e).externalPath:null}},{key:"getRegisteredExtensions",value:function(){return Array.from(this.registeredExtensions).map((function(e){var t=s(e,2),n=t[0],r=t[1];return{id:n,inMemory:!!r.EXTENSION_CLASS,isAsync:!!r.externalPath}}))}},{key:"downloadExtension",value:function(e){if(!this.registeredExtensions.has(e))return Promise.reject("Extension not found: "+e+". Has it been registered(1)?");var t=this.registeredExtensions.get(e);return t.externalPath?(t.downloadPromise||(t.downloadPromise=i.theResourceLoader.loadScript(t.externalPath,e).then((function(){if(delete t.downloadPromise,!t.EXTENSION_CLASS)throw new Error("Extension not found: "+e+". Has it been registered(3)?");return t.EXTENSION_CLASS}))),t.downloadPromise):Promise.reject("Extension not found: "+e+". Has it been registered(2)?")}},{key:"popuplateOptions",value:function(e){this.registeredExtensions.forEach((function(t){t.EXTENSION_CLASS.populateDefaultOptions(e)}))}},{key:"isDownloading",value:function(e){return!!this.registeredExtensions.has(e)&&!!this.registeredExtensions.get(e).downloadPromise}},{key:"isAvailable",value:function(e){return!!this.getExtensionClass(e)}}])&&a(t.prototype,n),r&&a(t,r),e}()),c=function(){};c.prototype={loadExtension:function(e,t){var n=this;return this.loadedExtensions=this.loadedExtensions||{},l.isAvailable(e)?this.loadExtensionLocal(e,t):(this.loadExtensionPromises=this.loadExtensionPromises||{},e in this.loadExtensionPromises||(this.loadExtensionPromises[e]=l.downloadExtension(e).then((function(){if(delete n.loadExtensionPromises[e],n.loadedExtensions){if(n.cancelledExtensions&&e in n.cancelledExtensions)throw delete n.cancelledExtensions[e],new Error("Abort loadExtension('".concat(e,"') - extension has been unloaded"));return n.loadExtensionLocal(e,t)}r.logger.info("Abort loadExtension('".concat(e,"') - teardown in progress"))}))),this.loadExtensionPromises[e])},getExtension:function(e,t){var n=this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null;return n&&t&&t(n),n},unloadExtension:function(e){if(this.cancelledExtensions=this.cancelledExtensions||{},l.isDownloading(e))return this.cancelledExtensions[e]=!0,!1;var t=!1,n=this.getExtension(e);return n?(t=n.unload(),r.logger.info("Extension unloaded: "+e),delete this.loadedExtensions[e],this.dispatchEvent({type:o.EXTENSION_UNLOADED_EVENT,extensionId:e})):r.logger.warn("Extension not found: "+e),t},loadExtensionLocal:function(t,n){var i=this,s=l.getExtensionClass(t);if(!s)return Promise.reject("Extension not found : "+t);var a=this.getExtension(t);if(a)return Promise.resolve(a);if(this.loadingExtensions&&t in this.loadingExtensions)return Promise.resolve(this.loadingExtensions[t]);(a=new s(this,n)).id=t;var c=a.load();if(!c)return Promise.reject("Extension failed to .load() : "+t);var u=function(){i.loadedExtensions[t]=a,i.onPostExtensionLoad(a),r.logger.info("Extension loaded: "+t),e((function(){i.getExtension(t)&&i.dispatchEvent({type:o.EXTENSION_LOADED_EVENT,extensionId:t})}))};return c instanceof Promise?(this.loadingExtensions=this.loadingExtensions||{},this.loadingExtensions[t]=a,c.then((function(){return u(),a})).finally((function(){delete i.loadingExtensions[t]}))):(u(),Promise.resolve(a))},onPostExtensionLoad:function(e){},forEachExtension:function(e){var t=this.loadedExtensions||{};for(var n in t)t.hasOwnProperty(n)&&e(t[n])},apply:function(e){var t=c.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.unloadExtension=t.unloadExtension,e.loadExtensionLocal=t.loadExtensionLocal,e.forEachExtension=t.forEachExtension,e.onPostExtensionLoad=t.onPostExtensionLoad}}}.call(this,n(/*! ./../../node_modules/timers-browserify/main.js */"./node_modules/timers-browserify/main.js").setImmediate)},"./src/application/FileLoader.js":
/*!***************************************!*\
  !*** ./src/application/FileLoader.js ***!
  \***************************************/
/*! exports provided: FileLoader */function(e,t,n){"use strict";function r(e){this.viewer=e}n.r(t),n.d(t,"FileLoader",(function(){return r})),r.prototype.constructor=r,r.prototype.loadFile=function(e,t,n,r){return!1},r.prototype.is3d=function(){return!1}},"./src/application/FileLoaderManager.js":
/*!**********************************************!*\
  !*** ./src/application/FileLoaderManager.js ***!
  \**********************************************/
/*! exports provided: FileLoaderManager */function(e,t,n){"use strict";n.r(t),n.d(t,"FileLoaderManager",(function(){return i}));var r={};var i={registerFileLoader:function(e,t,n){return!r[e]&&(r[e]={loader:n,extensions:t},!0)},getFileLoader:function(e){return r[e]?r[e].loader:null},getFileLoaderForExtension:function(e){for(var t in e=e?e.toLowerCase():"",r){var n=r[t];if(n)for(var i=0;i<n.extensions.length;i++)if(n.extensions[i].toLowerCase()===e)return n.loader}return null},unregisterFileLoader:function(e){return!!r[e]&&(delete r[e],!0)}}},"./src/application/GlobalManager.js":
/*!******************************************!*\
  !*** ./src/application/GlobalManager.js ***!
  \******************************************/
/*! exports provided: GlobalManager */function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"GlobalManager",(function(){return a}));var s=Bimfish.Viewing,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._window={inner:null,registeredEventListeners:new Map},this._document={inner:null,registeredEventListeners:new Map},this._window.inner=s.getGlobal(),this._document.inner=this._window.inner.document,this.addWindowEventListener=c.bind(this._window),this.removeWindowEventListener=u.bind(this._window),this.addDocumentEventListener=c.bind(this._document),this.removeDocumentEventListener=u.bind(this._document)}var t,n,a;return t=e,(n=[{key:"getWindow",value:function(){return this._window.inner}},{key:"getDocument",value:function(){return this._document.inner}},{key:"setWindow",value:function(e){if(e&&e!==this._window.inner){var t=!0,n=!1,o=void 0;try{for(var s,a=this._window.registeredEventListeners.entries()[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var l=i(s.value,2),c=l[0],u=l[1],d=!0,h=!1,f=void 0;try{for(var p,m=u.entries()[Symbol.iterator]();!(d=(p=m.next()).done);d=!0){var g,v=i(p.value,2),y=v[0],_=v[1];e.addEventListener.apply(e,[c,y].concat(r(_))),(g=this._window.inner).removeEventListener.apply(g,[c,y].concat(r(_)))}}catch(e){h=!0,f=e}finally{try{d||null==m.return||m.return()}finally{if(h)throw f}}}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}var b=!0,x=!1,w=void 0;try{for(var E,A=this._document.registeredEventListeners.entries()[Symbol.iterator]();!(b=(E=A.next()).done);b=!0){var M=i(E.value,2),S=(c=M[0],u=M[1],!0),T=!1,C=void 0;try{for(var P,L=u.entries()[Symbol.iterator]();!(S=(P=L.next()).done);S=!0){var D,R,I=i(P.value,2);y=I[0],_=I[1],(D=e.document).addEventListener.apply(D,[c,y].concat(r(_))),(R=this._document.inner).removeEventListener.apply(R,[c,y].concat(r(_)))}}catch(e){T=!0,C=e}finally{try{S||null==L.return||L.return()}finally{if(T)throw C}}}}catch(e){x=!0,w=e}finally{try{b||null==A.return||A.return()}finally{if(x)throw w}}this._window.inner=e,this._document.inner=e.document}}}])&&o(t.prototype,n),a&&o(t,a),e}();function l(e){return!!e.opener}function c(e,t){for(var n,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];l(this.inner)||(this.registeredEventListeners.has(e)?this.registeredEventListeners.get(e).set(t,i):this.registeredEventListeners.set(e,new Map([[t,i]]))),(n=this.inner).addEventListener.apply(n,[e,t].concat(i))}function u(e,t){var n;l(this.inner)||this.registeredEventListeners.has(e)&&this.registeredEventListeners.get(e).has(t)&&this.registeredEventListeners.get(e).delete(t);for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];(n=this.inner).removeEventListener.apply(n,[e,t].concat(i))}},"./src/application/GlobalManagerMixin.js":
/*!***********************************************!*\
  !*** ./src/application/GlobalManagerMixin.js ***!
  \***********************************************/
/*! exports provided: GlobalManagerMixin */function(e,t,n){"use strict";n.r(t),n.d(t,"GlobalManagerMixin",(function(){return o}));var r=n(/*! ./GlobalManager */"./src/application/GlobalManager.js"),i=new r.GlobalManager;function o(){this.globalManager=i,this.setGlobalManager=function(e){this.globalManager=e,this.onSetGlobalManager(this.globalManager)},this.onSetGlobalManager=function(e){},this.getWindow=function(){return this.globalManager.getWindow()},this.getDocument=function(){return this.globalManager.getDocument()},this.setWindow=function(e){return this.globalManager.setWindow(e)},this.addWindowEventListener=function(e,t){for(var n,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];(n=this.globalManager).addWindowEventListener.apply(n,[e,t].concat(i))},this.removeWindowEventListener=function(e,t){for(var n,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];(n=this.globalManager).removeWindowEventListener.apply(n,[e,t].concat(i))},this.addDocumentEventListener=function(e,t){for(var n,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];(n=this.globalManager).addDocumentEventListener.apply(n,[e,t].concat(i))},this.removeDocumentEventListener=function(e,t){for(var n,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];(n=this.globalManager).removeDocumentEventListener.apply(n,[e,t].concat(i))}}Bimfish.Viewing.GlobalManager=r.GlobalManager,Bimfish.Viewing.GlobalManagerMixin=o},"./src/application/LightPresets.js":
/*!*****************************************!*\
  !*** ./src/application/LightPresets.js ***!
  \*****************************************/
/*! exports provided: DefaultLightPreset, DefaultLightPreset2d, BackgroundPresets, LightPresets, copyLightPreset */function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultLightPreset",(function(){return i})),n.d(t,"DefaultLightPreset2d",(function(){return o})),n.d(t,"BackgroundPresets",(function(){return s})),n.d(t,"LightPresets",(function(){return l})),n.d(t,"copyLightPreset",(function(){return u}));var r=n(/*! ../compat */"./src/compat.js"),i=1,o=0,s={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Field:[202,226,252,202,201,190],Boardwalk:[216,230,248,230,228,220],Custom:[230,230,230,150,150,150]},a=s,l=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:a["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:a["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:a["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:a.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:a["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:a.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:a.Snow,darkerFade:!1,rotation:0},{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Field,useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Boardwalk,useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Flat Shading",path:null,tonemap:0,E_bias:0,directLightColor:[0,0,0],ambientColor:[0,0,0],lightMultiplier:0,bgColorGradient:a["Fusion Grey"],darkerFade:!1,rotation:0}],c=[{name:"Harbor",path:"Harbor",type:"logluv",tonemap:1,E_bias:1.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],useIrradianceAsBackground:!0,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"Night",path:"Night",type:"logluv",tonemap:1,E_bias:4,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0},{name:"Parking",path:"Parking",type:"logluv",tonemap:1,E_bias:2.8,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],useIrradianceAsBackground:!1,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"River Road",path:"RiverRoad",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Fusion Grey"],useIrradianceAsBackground:!1,saoIntensity:.7,darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Midnight,darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["RaaS SBS"],darkerFade:!1,rotation:0},{name:"City Night",path:"CityNight",type:"logluv",tonemap:1,E_bias:1.6,directLightColor:[1,1,1],lightMultiplier:.2,bgColorGradient:a.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0}];function u(e,t){Object(r.ObjectAssign)(t,e),t.name=e.name+" (copy)"}Object(r.getGlobal)().ENABLE_DEBUG&&Array.prototype.push.apply(l,c)},"./src/application/LoadingSpinner.js":
/*!*******************************************!*\
  !*** ./src/application/LoadingSpinner.js ***!
  \*******************************************/
/*! exports provided: LoadingSpinner */function(e,t,n){"use strict";n.r(t),n.d(t,"LoadingSpinner",(function(){return o}));var r=n(/*! ./GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.domElement=null}var t,n,r;return t=e,(n=[{key:"createDom",value:function(e){var t=this.getDocument(),n=t.createElement("div");n.className="spinner",e&&e.appendChild(n);for(var r=1;r<=3;r++){var i=t.createElement("div");i.className="bounce"+r,n.appendChild(i)}return this.domElement=n,this.hide(),n}},{key:"show",value:function(){this.domElement&&(this.domElement.style.display="block")}},{key:"hide",value:function(){this.domElement&&(this.domElement.style.display="None")}},{key:"destroy",value:function(){this.domElement=null}}])&&i(t.prototype,n),r&&i(t,r),e}();r.GlobalManagerMixin.call(o.prototype)},"./src/application/LocalStorage.js":
/*!*****************************************!*\
  !*** ./src/application/LocalStorage.js ***!
  \*****************************************/
/*! exports provided: LocalStorage */function(e,t,n){"use strict";n.r(t),n.d(t,"LocalStorage",(function(){return l}));var r=n(/*! ../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ../compat */"./src/compat.js"),o=Object(i.getGlobal)(),s=function(){if("undefined"==typeof window)return!1;try{var e="lmv_viewer_test_localStorage",t=o.localStorage;return!!t&&(t.setItem(e,"1"),t.removeItem(e),!0)}catch(e){return!1}}();function a(){s||(this._data={})}a.prototype.getItem=function(e){return s?o.localStorage.getItem(e):this._data.hasOwnProperty(e)?this._data[e]:null},a.prototype.setItem=function(e,t){if(s)try{o.localStorage.setItem(e,t)}catch(e){r.logger.debug("avp.LocalStorage: Failed to setItem()")}else this._data[e]=String(t)},a.prototype.removeItem=function(e){s?o.localStorage.removeItem(e):delete this._data[id]},a.prototype.clear=function(){s?o.localStorage.clear():this._data={}},a.prototype.isSupported=function(){return s};var l=new a},"./src/application/Model.js":
/*!**********************************!*\
  !*** ./src/application/Model.js ***!
  \**********************************/
/*! exports provided: ModelUnits, Model */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelUnits",(function(){return c})),n.d(t,"Model",(function(){return u}));var r=n(/*! ../wgs/scene/RenderModel */"./src/wgs/scene/RenderModel.js"),i=(n(/*! ./LocalStorage */"./src/application/LocalStorage.js"),n(/*! ./EventDispatcher */"./src/application/EventDispatcher.js")),o=n(/*! ../file-loaders/net/Xhr */"./src/file-loaders/net/Xhr.js"),s=(n(/*! ../logger/Logger */"./src/logger/Logger.js"),n(/*! ../wgs/scene/LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js")),a=n(/*! ../compat */"./src/compat.js"),l=n(/*! ../wgs/scene/FragmentList */"./src/wgs/scene/FragmentList.js"),c={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in",POINT:"pt"};function u(e){r.RenderModel.call(this,e),this.myData=e,this.topology=null,this.topologyPromise=null,this.svfUUID=null,this.defaultCameraHash=null,this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)},this.is3d=function(){return!this.is2d()},this.isOTG=function(){return this.myData&&!!this.myData.isOTG},this.isPdf=function(){return!(!this.myData||!this.myData.isPdf)},this.isLeaflet=function(){return!(!this.myData||!this.myData.isLeaflet)}}i.EventDispatcher.prototype.apply(u.prototype),u.prototype.constructor=u,u.prototype.getData=function(){return this.myData},u.prototype.setUUID=function(e){this.svfUUID=btoa(Object(o.pathToURL)(e))},u.prototype.getDocumentNode=function(){var e=this.getData();return e.loadOptions&&e.loadOptions.bubbleNode||null},u.prototype.getRoot=function(){var e=this.getData();return e&&e.instanceTree?e.instanceTree.root:null},u.prototype.getRootId=function(){var e=this.getData();return e&&e.instanceTree&&e.instanceTree.getRootId()||0},u.prototype.getUnitData=function(e){var t={unitString:null,unitScale:1};switch(e){case"meter":case"meters":case"m":return t.unitString=c.METER,t.unitScale=1,t;case"foot":case"feet":case"ft":return t.unitString=c.FOOT,t.unitScale=.3048,t;case"feet and inches":case"inch":case"inches":case"in":return t.unitString=c.INCH,t.unitScale=.0254,t;case"centimeter":case"centimeters":case"cm":return t.unitString=c.CENTIMETER,t.unitScale=.01,t;case"millimeter":case"millimeters":case"mm":return t.unitString=c.MILLIMETER,t.unitScale=.001,t;case"point":case"points":case"pt":return t.unitString=c.POINT,t.unitScale=.0254/72,t;default:return t}},u.prototype.getUnitScale=function(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.overriddenUnits?t.overriddenUnits:t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance unit","value",null)}return e&&(e=e.toLowerCase()),this.getUnitData(e).unitScale},u.prototype.getUnitString=function(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.overriddenUnits?t.overriddenUnits:t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance unit","value",null)}return e&&(e=e.toLowerCase()),this.getUnitData(e).unitString},u.prototype.getDisplayUnit=function(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance unit","value",null)}return e&&(e=e.toLowerCase()),this.getUnitData(e).unitString},u.prototype.getMetadata=function(e,t,n){var r=this.getData();if(r){var i=r.metadata;if(i){var o=i[e];if(void 0!==o){if(!t)return o;var s=o[t];if(void 0!==s)return s}}}return n},u.prototype.getDefaultCamera=function(){var e=this.getData();if(!e)return null;var t=null,n=e.cameras?e.cameras.length:0;if(0<n){var r=this.getMetadata("default camera","index",null);if(null!==r&&e.cameras[r])t=e.cameras[r];else{for(var i=0;i<n;i++){var o=e.cameras[i];if(o.isPerspective){t=o;break}}t||(t=e.cameras[0])}}return t},u.prototype.isAEC=function(){return!!this.getData().loadOptions.isAEC},u.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},u.prototype.geomPolyCount=function(){var e=this.getGeometryList();return e?e.geomPolyCount:null},u.prototype.instancePolyCount=function(){var e=this.getGeometryList();return e?e.instancePolyCount:null},u.prototype.isLoadDone=function(){var e=this.getData();return!(!e||!e.loadDone)},u.prototype.isObjectTreeCreated=function(){return!!this.getData().instanceTree},u.prototype.getPropertyDb=function(){var e=this.getData();return e&&e.propDbLoader},u.prototype.getProperties=function(e,t,n){var r=this.getPropertyDb();!r||e<=0?n&&n():r.getProperties(e,t,n)},u.prototype.getProperties2=function(e,t,n,r){var i=this.getPropertyDb();!i||e<=0?n&&n():i.getProperties2(e,t,n,r)},u.prototype.getBulkProperties=function(e,t,n,r){Array.isArray(t)&&(t={propFilter:t});var i=(t=t||{}).propFilter||null,o=t.ignoreHidden||!1,s=this.getPropertyDb();s?s.getBulkProperties(e,i,n,r,o):r&&r()},u.prototype.getBulkProperties2=function(e,t,n,r){var i=this.getPropertyDb();i?i.getBulkProperties2(e,t,n,r):r&&r()},u.prototype.getExternalIdMapping=function(e,t){var n=this.getPropertyDb();n?n.getExternalIdMapping(e,t):t&&t()},u.prototype.getLayerToNodeIdMapping=function(e,t){var n=this.getPropertyDb();n?n.getLayerToNodeIdMapping(e,t):t&&t()},u.prototype.getObjectTree=function(e,t){var n=this.getPropertyDb();n?n.getObjectTree(e,t):t&&t()},u.prototype.isObjectTreeLoaded=function(){var e=this.getPropertyDb();return!!e&&e.isObjectTreeLoaded()},u.prototype.search=function(e,t,n,r){var i=this.getPropertyDb();i?i.searchProperties(e,r,t,n):n&&n()},u.prototype.findProperty=function(e){var t=this.getPropertyDb();return t?t.findProperty(e):Promise.reject("Model doesn't have any properties.")};var d=function(e,t,n,r){var i,o,s,a,l,c,u=!1;s=r[n[n.length-1]].x,i=(a=r[n[n.length-1]].y)>=t;for(var d=0,h=n.length;d<h;++d)l=r[n[d]].x,i!=(o=(c=r[n[d]].y)>=t)&&(c-t)*(s-l)>=(l-e)*(a-c)==o&&(u=!u),i=o,s=l,a=c;return u};u.prototype.pointInPolygon=function(e,t,n,r){for(var i=!1,o=0;o<n.length;o++)d(e,t,n[o],r)&&(i=!i);return i},u.prototype.getPageToModelTransform=function(e){var t=this.getData();if(t.pageToModelTransform)return t.pageToModelTransform;var n=t,r=n.metadata.page_dimensions,i=n.viewports[e];if(!i)return new THREE.Matrix4;n.viewportTransforms||(n.viewportTransforms=new Array(n.viewports.length));var o=n.viewportTransforms[e];if(o)return o;var a=new s.LmvMatrix4(!0).set(r.logical_width/r.page_width,0,0,r.logical_offset_x,0,r.logical_height/r.page_height,0,r.logical_offset_y,0,0,1,0,0,0,0,1),l=i.transform.slice();!function(e){var t=e;if(Math.abs(t[0])<.001)if(Math.abs(t[4])>.001)for(var n=0;n<4;n++){var r=t[n];t[n]=t[n+4],t[n+4]=r}else for(n=0;n<4;n++){r=t[n];t[n]=t[n+8],t[n+8]=r}if(Math.abs(t[5])<.001)for(n=4;n<8;n++){r=t[n];t[n]=t[n+4],t[n+4]=r}}(l);var c=new s.LmvMatrix4(!0);c.elements.set(l);var u=new s.LmvMatrix4(!0);return u.getInverse(c),u.multiply(a),n.viewportTransforms[e]=u,u},u.prototype.pageToModel=function(e,t,n){var r=this.getPageToModelTransform(n);function i(e){if(e){var t=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(r);e.x=t.x,e.y=t.y}}i(e),i(t)},u.prototype.pointInClip=function(e,t){for(var n=this.getData().clips,r=[],i=1;i<n.length;i++)if(i!==t){for(var o=[],s=[],a=n[i].contourCounts,l=n[i].points,c=0,u=[],d=0;d<a.length;d++){for(var h=0;h<a[d];h++)o.push(c),c++;s.push(o),o=[]}for(d=0;d<l.length;d+=2){var f={x:l[d],y:l[d+1]};u.push(f)}this.pointInPolygon(e.x,e.y,s,u)&&r.push(i)}return r},u.prototype.getClip=function(e){for(var t=this.getData().clips,n=[],r=[],i=t[e].contourCounts,o=t[e].points,s=0,a=[],l=0;l<i.length;l++){for(var c=0;c<i[l];c++)n.push(s),s++;r.push(n),n=[]}for(l=0;l<o.length;l+=2){var u={x:o[l],y:o[l+1]};a.push(u)}return{contours:r,points:a}},u.prototype.getTopoIndex=function(e){var t=this.getData();if(t&&t.fragments){var n=t.fragments.topoIndexes;if(n)return n[e]}},u.prototype.getTopology=function(e){return this.topology?this.topology[e]:null},u.prototype.hasTopology=function(){return!!this.topology},u.prototype.fetchTopology=function(e){if(this.topology)return Promise.resolve(this.topology);var t=this.getData();if(!t.topologyPath)return Promise.reject({error:"no-topology"});var n=e||(Object(a.isMobileDevice)()?20:100);if(t.topologySizeMB>n)return Promise.reject({error:"topology-too-big",limitMB:n,topologyMB:t.topologySizeMB});if(!this.topologyPromise){var r=this;this.topologyPromise=new Promise((function(e,t){r.loader.fetchTopologyFile(r.getData().topologyPath,(function(n){n&&n.topology?(r.topology=n.topology,e(n.topology)):t(n)}))}))}return this.topologyPromise},u.prototype.hasGeometry=function(){var e=this.getData();return!!e&&(!!e.isLeaflet||e.fragments.length>0)},u.prototype.getFragmentPointer=function(e){return e?new l.FragmentPointer(this.getFragmentList(),e):null}},"./src/application/ModelLayers.js":
/*!****************************************!*\
  !*** ./src/application/ModelLayers.js ***!
  \****************************************/
/*! exports provided: ModelLayers */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelLayers",(function(){return s}));var r=n(/*! ../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ./EventTypes */"./src/application/EventTypes.js"),o={name:"root",id:"root",isLayer:!1,children:[],childCount:0};function s(e){this.viewer=e,this.matman=e.matman(),this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[]}var a=s.prototype;function l(e){var t=e.getData(),n=o;return t&&t.layersRoot&&(n=t.layersRoot),Promise.resolve(n)}function c(e){if(e.getData().loadOptions.skipPropertyDb)return Promise.resolve(null);var t=e.getPropertyDb();return!t||e.getData().loadOptions.disable3DModelLayers?Promise.resolve(o):t.findLayers()}function u(e,t){var n=e.model,r=e.indexToLayer;if(n.is2d()){if(!n.getData().layerCount)return;var i=[];for(var o in e.layerToIndex)i.push(e.layerToIndex[o]);e.matman.setLayerVisible(i,t,n.id),e.viewer.invalidate(!0)}else{var s=[],a=t?e.viewer.visibilityManager.show:e.viewer.visibilityManager.hide;d(e,(function(e,i){r[i].visible!==t&&(s.push(e),1024===s.length&&(a(s,n),s.length=0))})),s.length>0&&a(s,n)}for(var l=r.length,c=1;c<l;++c){var u=r[c];u&&(u.visible=t)}}function d(e,t){var n=e.nodeToLayer;if(n&&n.length){var r=e.model.getData().instanceTree.nodeAccess;for(var i in r.dbIdToIndex){var o=n[r.dbIdToIndex[i]]||0;0!==o&&t(0|i,o)}}}function h(e,t){return"number"==typeof t?t:e.layerToIndex[t.name||t]||0}function f(e){return!e.layer.isLayer}function p(e){if(!e)return[];var t=[],n=0;!function e(t,n){for(var r=0;r<t.length;++r){var i=t[r];n(i),i.children&&e(i.children,n)}}(e,(function(e){t.push(e),e.isLayer&&(n=Math.max(n,0|e.index))}));for(var r=0;r<t.length;++r)t[r].isLayer||(t[r].index=++n);return t}a.addModel=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.initialized&&(e.is2d()||!t)){var n=function(t){var n=this.model.getData().instanceTree;if(t){t.children=t.children||[];var i=p(t.children);t.childCount=i.length,this.indexToLayer=new Array(t.childCount+1),this.indexToLayer[0]=null;for(var o=0;o<t.childCount;++o){var s=i[o],a=null==s.visible||s.visible;this.layerToIndex[s.name]=s.index,this.indexToLayer[s.index]={layer:s,visible:a}}if(!this.model.is2d()&&0!==t.childCount){this.nodeToLayer=t.childCount<=256?new Uint8Array(n.nodeAccess.getNumNodes()):new Uint16Array(n.nodeAccess.getNumNodes());var l=function(e){if(this.model){var t=this.model.getData().instanceTree;for(var n in e)if(e.hasOwnProperty(n))for(var r=this.layerToIndex[n],i=e[n],o=0,s=i.length;o<s;++o){var a=t.nodeAccess.getIndex(i[o]);this.nodeToLayer[a]=r}}}.bind(this),c=function(){r.logger.warn("ModelLayers error: coudn't get layers from property database.")}.bind(this);e.getLayerToNodeIdMapping(l,c)}}}.bind(this),s=function(t){this.root=t,this.initialized=!0,this.activateLayerState("Initial"),this.viewer.api.dispatchEvent({type:i.MODEL_LAYERS_LOADED_EVENT,model:e,root:t})}.bind(this);this.model=e,(e.is2d()?l(e):c(e)).then((function(e){n(e),s(e)})).catch((function(e){r.logger.warn(e),s(o)}))}},a.removeModel=function(e){this.model===e&&(this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[])},a.getRoot=function(){return this.initialized||r.logger.warn("Bimfish.Viewing.ModelLayers.getRoot couldn't peform action, layers are still being loaded"),this.root},a.showAllLayers=function(){this.initialized?u(this,!0):r.logger.warn("Bimfish.Viewing.ModelLayers.showAllLayers couldn't peform action, layers are still being loaded")},a.hideAllLayers=function(){this.initialized?u(this,!1):r.logger.warn("Bimfish.Viewing.ModelLayers.hideAllLayers couldn't peform action, layers are still being loaded")},a.isLayerVisible=function(e){if(!this.initialized)return r.logger.warn("Bimfish.Viewing.ModelLayers.isLayerVisible couldn't peform action, layers are still being loaded"),!1;var t=h(this,e),n=this.indexToLayer[t];if(f(n)){for(var i=n.layer.children,o=0;o<i.length;++o){var s=i[o].index;if(this.indexToLayer[s].visible)return!0}return!1}return n.visible},a.setLayerVisible=function(e,t){if(this.initialized){for(var n=Array.isArray(e)?e:[e],i=(n=e.map(function(e){return h(this,e)}.bind(this))).length,o=0;o<i;++o){var s=n[o],a=this.indexToLayer[s];if(f(a))a.layer.children.forEach((function(e){n.push(e.index)}))}var l=this.model,c=this.indexToLayer;if(l.is2d())this.matman.setLayerVisible(n,t,l.id),this.viewer.invalidate(!0);else{var u=c.map((function(e){return!(null!==e&&-1!==n.indexOf(e.layer.index)&&e.visible!==t)})),p=[],m=t?this.viewer.visibilityManager.show:this.viewer.visibilityManager.hide;d(this,(function(e,t){u[t]||(p.push(e),1024===p.length&&(m(p,l),p.length=0))})),p.length>0&&m(p,l)}var g=n.length;for(o=0;o<g;++o){var v=this.indexToLayer[n[o]];v&&(v.visible=t)}}else r.logger.warn("Bimfish.Viewing.ModelLayers.setLayersVisible couldn't peform action, layers are still being loaded")},a.getVisibleLayerIndices=function(){if(!this.initialized)return r.logger.warn("Bimfish.Viewing.ModelLayers.getVisibleLayerIndices couldn't peform action, layers are still being loaded"),[];for(var e=[],t=this.indexToLayer,n=t.length,i=1;i<n;++i){var o=t[i];o&&o.visible&&!f(o)&&e.push(o.layer.index)}return e},a.allLayersVisible=function(){if(!this.initialized)return!0;for(var e=this.indexToLayer,t=e.length,n=1;n<t;++n){var r=e[n];if(r&&!r.visible)return!1}return!0},a.activateLayerState=function(e){if(this.initialized&&this.model){var t=this.model.getData().metadata,n=t?t.layer_states:null;if(!this.model.is3d()&&n&&e){var i;for(i=0;i<n.length&&n[i].name!==e;i++);if(i<n.length){var o=n[i].visible_layers,s={};if(o&&0<o.length)for(var a=0;a<o.length;a++)s[o[a]]=1;var l=[],c=[];for(var u in t.layers){var d=t.layers[u].name;u|=0,1===s[d]?l.push(u):c.push(u)}this.setLayerVisible(l,!0),this.setLayerVisible(c,!1)}}}else r.logger.warn("Bimfish.Viewing.ModelLayers.activateLayerState couldn't peform action, layers are still being loaded")},a.getLayerStates=function(){function e(e,t){var n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;++i){var o=n[i];if(e[o]!==t[o])return!1}return!0}if(!this.initialized)return r.logger.warn("Bimfish.Viewing.ModelLayers.getLayerStates couldn't peform action, layers are still being loaded"),null;var t,n=this.model,i=n?n.getData().metadata:null,o=i?i.layers:null,s=i?i.layer_states:null;if(this.model.is3d()||!o||!s)return null;var a={},l={};for(var c in o)if(o.hasOwnProperty(c)){var u=parseInt(c),d=o[c];a[t="string"==typeof d?d:d.name]=!0,this.isLayerVisible(u)&&(l[t]=!0)}for(var h=[],f=0;f<s.length;++f){var p=s[f],m=p.visible_layers,g={};if(!p.hidden){if(m&&0<m.length)for(var v=0;v<m.length;++v)t=m[v],a.hasOwnProperty(t)&&(g[t]=!0);h.push({name:p.name,description:p.description,active:e(l,g)})}}return 0<h.length?h:null}},"./src/application/ModelMemoryTracker.js":
/*!***********************************************!*\
  !*** ./src/application/ModelMemoryTracker.js ***!
  \***********************************************/
/*! exports provided: estimateMemUsage, ModelMemoryTracker */function(e,t,n){"use strict";n.r(t),n.d(t,"estimateMemUsage",(function(){return c})),n.d(t,"ModelMemoryTracker",(function(){return u}));function r(e){return e&&e.byteLength||0}function i(e){return r(e.boxes)+r(e.transforms)+r(e.fragId2dbId)+r(e.geomDataIndexes)+r(e.materials)}function o(e){return r(e.geomids)+r(e.materialids)+r(e.vizflags)+(e.boxes!==e.fragments.boxes?r(e.boxes):0)+(e.transforms!==e.fragments.transforms?r(e.transforms):0)}function s(e){return r(e.nodes.nodesRaw?e.nodes.nodesRaw:e.nodes)+r(e.primitives)}var a=!1;function l(e){for(var t,n=Bimfish.Viewing.Private,l=0,c=0;c<e.length;c++){var u=e[c],d=u.getData(),h=u.getConsolidation();if(h&&(l+=h.byteSize),d.isLeaflet)a||(console.warn("Memory tracking not implemented for leaflets."),a=!0);else{if(!d.isOTG)l+=u.getGeometryList().geomMemory;var f=d.fragments;f&&(l+=i(f));var p=u.getFragmentList();p&&(l+=o(p));var m=d.bvh;m&&(l+=s(m));var g=d.instanceTree;g&&(l+=(t=void 0,r((t=g.nodeAccess).children)+r(t.nameSuffixes)+r(t.names)+r(t.nodeBoxes)+r(t.nodes)))}}return isFinite(l)||n.logger.warn("Memory estimate result was not a number"),l}function c(e){var t=e.impl.geomCache(),n=t?t.byteSize:0,r=e.impl.modelQueue(),i=r.getModels(),o=r.getHiddenModels();return n+l(i)+l(o)}function u(e,t){var n=e,r=0,i=t||1048576e3;function o(e){return e.lruTimestamp===r}this.updateModelTimestamps=function(e){r++;for(var t=0;t<e.length;t++){e[t].lruTimestamp=r}},this.memoryExceeded=function(){return c(n)>=i},this.getMemLimit=function(){return i},this.cleanup=function(e){var t=e||n.impl.unloadModel.bind(n.impl);if(this.memoryExceeded()){for(var r=function(){for(var e=n.impl.modelQueue().getHiddenModels(),t=[],r=0;r<e.length;r++){var i=e[r];o(i)||t.push(i)}return t.sort((function(e,t){return e.lurTimestamp-t.lruTimestamp})),t}(),i=0;i<r.length;i++){var s=r[i];if(s.isConsolidated&&(s.unconsolidate(),!this.memoryExceeded()))return}var a=n.impl.geomCache();for(i=0;i<r.length;i++)if(t(s=r[i]),a&&a.cleanup(),!this.memoryExceeded())return}}}},"./src/application/OverlayManager.js":
/*!*******************************************!*\
  !*** ./src/application/OverlayManager.js ***!
  \*******************************************/
/*! exports provided: OverlayManager */function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"OverlayManager",(function(){return i}));var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.impl=t}var t,n,i;return t=e,(n=[{key:"dtor",value:function(){this.impl=null}},{key:"addScene",value:function(e){return!!e&&(this.impl.overlayScenes.hasOwnProperty(e)||this.impl.createOverlayScene(e),!0)}},{key:"removeScene",value:function(e){return!!e&&(this.impl.removeOverlayScene(e),!0)}},{key:"clearScene",value:function(e){this.impl.clearOverlay(e)}},{key:"hasScene",value:function(e){return!!e&&this.impl.overlayScenes.hasOwnProperty(e)}},{key:"addMesh",value:function(e,t){return!!(e&&t&&this.impl.overlayScenes.hasOwnProperty(t))&&(e=Array.isArray(e)?e:[e],this.impl.addMultipleOverlays(t,e),!0)}},{key:"removeMesh",value:function(e,t){return!!(e&&t&&this.impl.overlayScenes.hasOwnProperty(t))&&(e=Array.isArray(e)?e:[e],this.impl.removeMultipleOverlays(t,e),!0)}},{key:"hasMesh",value:function(e,t){var n=this.impl.overlayScenes[t];if(!n)return!1;for(var r=n.scene.children,i=0,o=r.length;i<o;++i)if(r[i]===e)return!0;return!1}}])&&r(t.prototype,n),i&&r(t,i),e}()},"./src/application/PreferenceNames.js":
/*!********************************************!*\
  !*** ./src/application/PreferenceNames.js ***!
  \********************************************/
/*! exports provided: Prefs3D, Prefs2D, Prefs */function(e,t,n){"use strict";n.r(t),n.d(t,"Prefs3D",(function(){return r})),n.d(t,"Prefs2D",(function(){return i})),n.d(t,"Prefs",(function(){return o}));var r={VIEW_CUBE:"viewCube",VIEW_CUBE_COMPASS:"viewCubeCompass",ALWAYS_USE_PIVOT:"alwaysUsePivot",ZOOM_TOWARDS_PIVOT:"zoomTowardsPivot",REVERSE_HORIZONTAL_LOOK_DIRECTION:"reverseHorizontalLookDirection",REVERSE_VERTICAL_LOOK_DIRECTION:"reverseVerticalLookDirection",ORBIT_PAST_WORLD_POLES:"orbitPastWorldPoles",CLICK_TO_SET_COI:"clickToSetCOI",GHOSTING:"ghosting",OPTIMIZE_NAVIGATION:"optimizeNavigation",AMBIENT_SHADOWS:"ambientShadows",ANTIALIASING:"antialiasing",GROUND_SHADOW:"groundShadow",GROUND_REFLECTION:"groundReflection",LINE_RENDERING:"lineRendering",EDGE_RENDERING:"edgeRendering",LIGHT_PRESET:"lightPreset",ENV_MAP_BACKGROUND:"envMapBackground",FIRST_PERSON_TOOL_POPUP:"firstPersonToolPopup",BIM_WALK_TOOL_POPUP:"bimWalkToolPopup",BIM_WALK_NAVIGATOR_TYPE:"bimWalkNavigatorType",DEFAULT_NAVIGATION_TOOL_3D:"defaultNavigationTool3D",SELECTION_MODE:"selectionMode",ENABLE_CUSTOM_ORBIT_TOOL_CURSOR:"enableCustomOrbitToolCursor"},i={GRAYSCALE:"grayscale",SWAP_BLACK_AND_WHITE:"swapBlackAndWhite"},o={PROGRESSIVE_RENDERING:"progressiveRendering",OPEN_PROPERTIES_ON_SELECT:"openPropertiesOnSelect",POINT_RENDERING:"pointRendering",BACKGROUND_COLOR_PRESET:"backgroundColorPreset",REVERSE_MOUSE_ZOOM_DIR:"reverseMouseZoomDir",LEFT_HANDED_MOUSE_SETUP:"leftHandedMouseSetup",FUSION_ORBIT:"fusionOrbit",FUSION_ORBIT_CONSTRAINED:"fusionOrbitConstrained",WHEEL_SETS_PIVOT:"wheelSetsPivot"}},"./src/application/Preferences.js":
/*!****************************************!*\
  !*** ./src/application/Preferences.js ***!
  \****************************************/
/*! exports provided: Preferences */function(e,t,n){"use strict";n.r(t),n.d(t,"Preferences",(function(){return o}));var r=n(/*! ./EventTypes */"./src/application/EventTypes.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js");function o(e,t){this.setGlobalManager(e.globalManager);var n=this.getWindow();"string"==typeof t&&(t={prefix:t}),t||(t={}),t.prefix||(t.prefix="Bimfish.Viewing.Preferences."),t.hasOwnProperty("localStorage")||(t.localStorage=!0);var o={},s={},a={},l=t.localStorage&&function(){var e=t.prefix+"test";try{var r=n.localStorage;return r.setItem(e,"1"),r.removeItem(e),!0}catch(e){return!1}}(),c=this;function u(e,r){if(l){if(c.hasTag(e,"no-storage"))return;var i=t.prefix+e;return void 0!==r?n.localStorage[i]=r:r=n.localStorage[i],r}}function d(e,t){if("string"==typeof e&&"function"!=typeof c[e]){var n=u(e),r=!1;if(void 0!==n)try{n=JSON.parse(n),r=!0}catch(e){}c[e]=r?n:t,a[e]={}}else i.logger.log("Preferences: invalid name="+e)}function h(e){l&&(e=t.prefix+e,delete localStorage[e])}e.addEventListener(r.PREF_CHANGED_EVENT,(function(e){var t=s[e.name];t&&t.forEach((function(t){var n=t.changed;n&&"function"==typeof n&&n(e.value)}))})),e.addEventListener(r.PREF_RESET_EVENT,(function(e){var t=s[e.name];t&&t.forEach((function(t){var n=t.reset;n&&"function"==typeof n&&n(e.value)}))})),this.load=function(e){for(var t in o=e)o.hasOwnProperty(t)&&d(t,o[t])},this.addTags=function(e,t){if(!t||!e)return!1;t=Array.isArray(t)?t:[t];for(var n=0;n<t.length;++n)this.tag(t[n],e);return!0},this.tag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(o);for(var n=0;n<t.length;++n)a[t[n]]&&(a[t[n]][e]=!0)}},this.untag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(o);for(var n=0;n<t.length;++n)a[t[n]]&&(a[t[n]][e]=!1)}},this.hasTag=function(e,t){var n=a[e];return!!n&&!0===n[t]},this.add=function(t,n,s,a){return!o.hasOwnProperty(t)||a?(o[t]=n,d(t,n),this.addTags(t,s),a&&e.dispatchEvent({type:r.PREF_CHANGED_EVENT,name:t,value:this.get(t)}),!0):(i.logger.log("Preferences: "+t+" already exists"),!1)},this.remove=function(e,t){return!!o.hasOwnProperty(e)&&(delete o[e],delete a[e],delete this[e],t&&h(e),!0)},this.clearWebStorage=function(){if(l){var e=n.localStorage;for(var r in e)e.hasOwnProperty(r)&&-1!==r.indexOf(t.prefix)&&delete localStorage[r]}},this.reset=function(t,n){for(var i in t&&void 0===n&&(n=!0),o)if(o.hasOwnProperty(i)){if(t){var s=!!a[i][t];if(n&&!s||!n&&s)continue}this.set(i,o[i],!1)&&e.dispatchEvent({type:r.PREF_RESET_EVENT,name:i,value:this[i]}),h(i)}},this.get=function(e){return this[e]},this.set=function(t,n,i){return this[t]!==n&&(this[t]=n,u(t,n),(void 0===i||i)&&e.dispatchEvent({type:r.PREF_CHANGED_EVENT,name:t,value:n}),!0)},this.addListeners=function(e,t,n){s[e]||(s[e]=[]),n||(n=t),s[e].push({changed:t,reset:n})},this.removeListeners=function(e,t,n){if(void 0!==s[e])if(t||n){n||(n=t);for(var r=0;r<s[e].length;++r)if(s[e][r].changed===t&&s[e][r].reset===n){s[e].splice(r,1);break}}else delete s[e]},this.clearListeners=function(){s={}},this.setUseLocalStorage=function(e){l=!!e}}n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(o.prototype)},"./src/application/Profile.js":
/*!************************************!*\
  !*** ./src/application/Profile.js ***!
  \************************************/
/*! exports provided: Profile */function(e,t,n){"use strict";n.r(t),n.d(t,"Profile",(function(){return a}));var r=n(/*! ./PreferenceNames */"./src/application/PreferenceNames.js"),i=n(/*! ./LocalStorage */"./src/application/LocalStorage.js"),o=n(/*! ../compat */"./src/compat.js"),s=Object(o.getGlobal)();function a(e){if(e){var t=Bimfish.Viewing,n=t.ProfileSettings.Default,o=[];if(this.name=e.hasOwnProperty("name")?e.name:"Custom",this.label=e.label,this.description=e.description,this.persistent=Array.isArray(e.persistent)?e.persistent:n.persistent,this.settings=Object.assign({},n.settings),e.hasOwnProperty("settings")){var a=e.settings;o=Object.keys(a),this.settings=Object.assign(this.settings,a)}var l=[],c=[];if(e.hasOwnProperty("extensions")){var u=e.extensions.load,d=e.extensions.unload;l=u?u.slice():l,c=d?d.slice():c}this.extensions={load:l,unload:c},this.apply=function(e){if(!e)return!1;!function(e,t){if(i.LocalStorage.isSupported()){s.localStorage.getItem("Bimfish.Viewing.ProfileName")!==e&&(i.LocalStorage.setItem("Bimfish.Viewing.ProfileName",e),t.clearWebStorage())}}(this.name,e);var n=this.settings,a=[t.ProfileSettings.Default.name,t.ProfileSettings.AEC.name],l=Object.values(r.Prefs3D),c=Object.values(r.Prefs2D);for(var u in n)if(n.hasOwnProperty(u)){var d=n[u],h=-1!==o.indexOf(u)&&-1===a.indexOf(this.name)?["ignore-producer"]:[];-1!==l.indexOf(u)?h.push("3d"):-1!==c.indexOf(u)?h.push("2d"):(h.push("2d"),h.push("3d")),-1===this.persistent.indexOf(u)&&h.push("no-storage");var f=e.get(u);void 0!==f?(e.addTags(u,h),f!==d&&e.set(u,d)):e.add(u,d,h,!0)}return!0}}}},"./src/application/ProfileManager.js":
/*!*******************************************!*\
  !*** ./src/application/ProfileManager.js ***!
  \*******************************************/
/*! exports provided: ProfileManager */function(e,t,n){"use strict";n.r(t),n.d(t,"ProfileManager",(function(){return s}));var r=n(/*! ../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ./Profile */"./src/application/Profile.js");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registered={};var t=Bimfish.Viewing.ProfileSettings;this.PROFILE_DEFAULT=new i.Profile(t.Default),this.registerProfile("default",this.PROFILE_DEFAULT),this.PROFILE_AEC=new i.Profile(t.AEC),this.registerProfile("rvt",this.PROFILE_AEC),this.registerProfile("ifc",this.PROFILE_AEC),this.PROFILE_NAVIS=new i.Profile(t.Navis),this.registerProfile("nwc",this.PROFILE_NAVIS),this.registerProfile("nwd",this.PROFILE_NAVIS),this.PROFILE_FLUENT=new i.Profile(t.Fluent),this.registerProfile("fluent",this.PROFILE_FLUENT)}var t,n,s;return t=e,(n=[{key:"registerProfile",value:function(e,t){t?(e=e||"default",this.registered[e]=t instanceof i.Profile?t:new i.Profile(t)):r.logger.log("ProfileManager: missing profileSettings when registering a profile.")}},{key:"unregisterProfile",value:function(e){e?delete this.registered[e]:r.logger.log("ProfileManager: missing fileExt when unregistering a profile.")}},{key:"getProfiles",value:function(){return Object.assign({},this.registered)}},{key:"getProfileOrDefault",value:function(e){if(!e)return r.logger.log("ProfileManager: missing fileExt for getProfile. Returning the default Profile."),this.registered.default;var t=this.registered[e];return t||(r.logger.log("ProfileManager: No profile registered for ".concat(e,". Returning the default Profile.")),this.registered.default)}}])&&o(t.prototype,n),s&&o(t,s),e}()},"./src/application/ProfileSettings.js":
/*!********************************************!*\
  !*** ./src/application/ProfileSettings.js ***!
  \********************************************/
/*! exports provided: DefaultSettings, ProfileSettings */function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultSettings",(function(){return c})),n.d(t,"ProfileSettings",(function(){return m}));var r=n(/*! ./PreferenceNames */"./src/application/PreferenceNames.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../wgs/scene/SelectionMode */"./src/wgs/scene/SelectionMode.js"),s=n(/*! ../compat */"./src/compat.js"),a=n(/*! ./LightPresets */"./src/application/LightPresets.js"),l={};l[r.Prefs3D.AMBIENT_SHADOWS]=!0,l[r.Prefs3D.ANTIALIASING]=!Object(s.isMobileDevice)(),l[r.Prefs3D.GROUND_SHADOW]=!0,l[r.Prefs3D.GROUND_REFLECTION]=!1,l[r.Prefs3D.GHOSTING]=!0,l[r.Prefs3D.VIEW_CUBE]=!Object(s.isMobileDevice)(),l[r.Prefs3D.VIEW_CUBE_COMPASS]=!1,l[r.Prefs3D.LINE_RENDERING]=!0,l[r.Prefs3D.LIGHT_PRESET]=a.DefaultLightPreset,l[r.Prefs3D.EDGE_RENDERING]=!1,l[r.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION]=!1,l[r.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION]=!1,l[r.Prefs3D.ALWAYS_USE_PIVOT]=!1,l[r.Prefs3D.ZOOM_TOWARDS_PIVOT]=!1,l[r.Prefs3D.ORBIT_PAST_WORLD_POLES]=!0,l[r.Prefs3D.CLICK_TO_SET_COI]=!1,l[r.Prefs3D.OPTIMIZE_NAVIGATION]=Object(s.isMobileDevice)(),l[r.Prefs3D.ENV_MAP_BACKGROUND]=!1,l[r.Prefs3D.FIRST_PERSON_TOOL_POPUP]=!0,l[r.Prefs3D.BIM_WALK_TOOL_POPUP]=!0,l[r.Prefs3D.BIM_WALK_NAVIGATOR_TYPE]="default",l[r.Prefs3D.DEFAULT_NAVIGATION_TOOL_3D]="default",l[r.Prefs3D.SELECTION_MODE]=o.SelectionMode.LEAF_OBJECT,l[r.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR]=!0,l[r.Prefs2D.GRAYSCALE]=!1,l[r.Prefs2D.SWAP_BLACK_AND_WHITE]=!1,l[r.Prefs.PROGRESSIVE_RENDERING]=!0,l[r.Prefs.OPEN_PROPERTIES_ON_SELECT]=!1,l[r.Prefs.POINT_RENDERING]=!0,l[r.Prefs.BACKGROUND_COLOR_PRESET]=null,l[r.Prefs.REVERSE_MOUSE_ZOOM_DIR]=!1,l[r.Prefs.LEFT_HANDED_MOUSE_SETUP]=!1,l[r.Prefs.FUSION_ORBIT]=!0,l[r.Prefs.FUSION_ORBIT_CONSTRAINED]=!0,l[r.Prefs.WHEEL_SETS_PIVOT]=!1;var c=l,u={name:"Default",label:"Manufacturing (Default)",description:"Default Viewer settings."};u.settings=l,u.persistent=[r.Prefs3D.ALWAYS_USE_PIVOT,r.Prefs3D.ZOOM_TOWARDS_PIVOT,r.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION,r.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION,r.Prefs3D.ORBIT_PAST_WORLD_POLES,r.Prefs3D.CLICK_TO_SET_COI,r.Prefs3D.GHOSTING,r.Prefs3D.OPTIMIZE_NAVIGATION,r.Prefs3D.AMBIENT_SHADOWS,r.Prefs3D.ANTIALIASING,r.Prefs3D.GROUND_SHADOW,r.Prefs3D.GROUND_REFLECTION,r.Prefs3D.FIRST_PERSON_TOOL_POPUP,r.Prefs3D.BIM_WALK_TOOL_POPUP,r.Prefs2D.SWAP_BLACK_AND_WHITE,r.Prefs.OPEN_PROPERTIES_ON_SELECT,r.Prefs.REVERSE_MOUSE_ZOOM_DIR,r.Prefs.LEFT_HANDED_MOUSE_SETUP,r.Prefs.WHEEL_SETS_PIVOT],u.extensions={load:[],unload:[]};var d=p(u);d.name="AEC",d.label="Construction (AEC)",d.description="A common set of preferences designed for the Construction industry.",d.settings[r.Prefs3D.EDGE_RENDERING]=!Object(s.isMobileDevice)(),d.settings[r.Prefs3D.LIGHT_PRESET]=Object(s.getGlobal)().DefaultLightPresetAec||"Boardwalk",d.settings[r.Prefs3D.ENV_MAP_BACKGROUND]=!0,d.settings[r.Prefs3D.VIEW_CUBE_COMPASS]=!0,d.extensions={load:[],unload:[]};var h=p(d);h.name="Fluent",h.label="Design Collaboration",h.description="User experience that matches Design Collaboration.",h.settings[r.Prefs.REVERSE_MOUSE_ZOOM_DIR]=!0,h.settings[r.Prefs.WHEEL_SETS_PIVOT]=!0,h.settings[r.Prefs3D.ALWAYS_USE_PIVOT]=!0,h.settings[r.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR]=!1,h.extensions={load:[],unload:[]};var f=p(d);function p(e){e||(i.logger.log("ProfileSettings.clone: missing profileSettings, using DefaultProfileSettings..."),e=u);var t={};return t.settings=Object.assign({},e.settings),t.extensions={},e.hasOwnProperty("extensions")?(t.extensions.load=e.extensions.hasOwnProperty("load")?e.extensions.load.slice():[],t.extensions.unload=e.extensions.hasOwnProperty("unload")?e.extensions.unload.slice():[]):t.extensions={load:[],unload:[]},t.persistent=e.persistent.slice(),t}f.name="Navis",f.label="Navisworks",f.description="Provides a user experience similar to Bimfish Navisworks desktop application.",f.settings[r.Prefs3D.BIM_WALK_TOOL_POPUP]=!1,f.settings[r.Prefs3D.BIM_WALK_NAVIGATOR_TYPE]="aec",f.settings[r.Prefs3D.DEFAULT_NAVIGATION_TOOL_3D]="extractor_defined";var m={Default:u,AEC:d,Fluent:h,Navis:f,clone:p}},"./src/application/ProgressState.js":
/*!******************************************!*\
  !*** ./src/application/ProgressState.js ***!
  \******************************************/
/*! exports provided: ProgressState */function(e,t,n){"use strict";n.r(t),n.d(t,"ProgressState",(function(){return r}));var r={ROOT_LOADED:0,LOADING:1,RENDERING:2}},"./src/application/ScreenModeDelegate.js":
/*!***********************************************!*\
  !*** ./src/application/ScreenModeDelegate.js ***!
  \***********************************************/
/*! exports provided: ScreenMode, ScreenModeDelegate, AppScreenModeDelegate, ApplicationScreenModeDelegate, NullScreenModeDelegate, ScreenModeMixin */function(e,t,n){"use strict";n.r(t),n.d(t,"ScreenMode",(function(){return c})),n.d(t,"ScreenModeDelegate",(function(){return u})),n.d(t,"AppScreenModeDelegate",(function(){return d})),n.d(t,"ApplicationScreenModeDelegate",(function(){return h})),n.d(t,"NullScreenModeDelegate",(function(){return f})),n.d(t,"ScreenModeMixin",(function(){return p}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ./EventTypes */"./src/application/EventTypes.js"),o=n(/*! ../logger/Logger */"./src/logger/Logger.js"),s=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];function a(e,t){for(var n=0;n<s.length;++n)t.addDocumentEventListener(s[n],e,!1)}function l(e,t){for(var n=0;n<s.length;++n)t.removeDocumentEventListener(s[n],e,!1)}var c={kNormal:0,kFullBrowser:1,kFullScreen:2};function u(e){this.viewer=e,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===c.kFullScreen&&a(this.bindFullscreenEventListener,this.viewer.globalManager)}function d(e){u.call(this,e)}u.prototype.uninitialize=function(){l(this.bindFullscreenEventListener,this.viewer.globalManager),this.viewer=null},u.prototype.isModeSupported=function(e){return!0},u.prototype.setMode=function(e){var t=this.getMode();return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},u.prototype.getMode=function(){throw"Implement getMode() in derived class"},u.prototype.getNextMode=function(){var e,t=this.getMode(),n=c;return t===n.kNormal&&this.isModeSupported(n.kFullBrowser)?e=n.kFullBrowser:t===n.kNormal&&this.isModeSupported(n.kFullScreen)||t===n.kFullBrowser&&this.isModeSupported(n.kFullScreen)?e=n.kFullScreen:t===n.kFullBrowser&&this.isModeSupported(n.kNormal)||t===n.kFullScreen&&this.isModeSupported(n.kNormal)?e=n.kNormal:t===n.kFullScreen&&this.isModeSupported(n.kFullBrowser)&&(e=n.kFullBrowser),e},u.prototype.getEscapeMode=function(){return this.getMode()!==c.kNormal?c.kNormal:void 0},u.prototype.fullscreenEventListener=function(){var e=this.viewer.globalManager.getDocument();Object(r.inFullscreen)(e)?this.viewer.resize():(this.doScreenModeChange(c.kFullScreen,c.kNormal),this.onScreenModeChanged(c.kFullScreen,c.kNormal))},u.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},u.prototype.onScreenModeChanged=function(e,t){e===c.kFullScreen?l(this.bindFullscreenEventListener,this.viewer.globalManager):t===c.kFullScreen&&a(this.bindFullscreenEventListener,this.viewer.globalManager),this.viewer.resize(),this.viewer.dispatchEvent({type:i.FULLSCREEN_MODE_EVENT,mode:t})},d.prototype=Object.create(u.prototype),d.prototype.constructor=d,d.prototype.isModeSupported=function(e){return e!==c.kFullBrowser},d.prototype.getMode=function(){var e=this.viewer.globalManager.getDocument();return Object(r.inFullscreen)(e)?c.kFullScreen:c.kNormal},d.prototype.doScreenModeChange=function(e,t){var n=this.viewer.container;if(t===c.kNormal){n.classList.remove("viewer-fill-browser");var i=this.viewer.globalManager.getDocument();Object(r.exitFullscreen)(i)}else t===c.kFullScreen&&(n.classList.add("viewer-fill-browser"),Object(r.launchFullscreen)(n))};var h=d;function f(e){u.call(this,e)}function p(){}f.prototype=Object.create(u.prototype),f.prototype.constructor=u,f.prototype.isModeSupported=function(e){return!1},f.prototype.getMode=function(){return c.kNormal},p.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e||(null===e?f:d)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Bimfish.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return o.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=p.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}},"./src/application/ScreenShot.js":
/*!***************************************!*\
  !*** ./src/application/ScreenShot.js ***!
  \***************************************/
/*! exports provided: ScreenShot */function(e,t,n){"use strict";n.r(t),n.d(t,"ScreenShot",(function(){return b}));var r=n(/*! ../wgs/globals.js */"./src/wgs/globals.js"),i=n(/*! ../wgs/scene/FrustumIntersector */"./src/wgs/scene/FrustumIntersector.js"),o=n(/*! ../wgs/render/RenderContext */"./src/wgs/render/RenderContext.js"),s=n(/*! ../compat */"./src/compat.js"),a=n(/*! ../wgs/scene/RenderBatch */"./src/wgs/scene/RenderBatch.js"),l=n(/*! ../wgs/scene/MeshFlags */"./src/wgs/scene/MeshFlags.js"),c=n(/*! ../wgs/scene/SceneMath */"./src/wgs/scene/SceneMath.js"),u=n(/*! ../wgs/scene/RenderFlags */"./src/wgs/scene/RenderFlags.js"),d=n(/*! three */"./thirdparty/three.js/three.js"),h=n(/*! ./EventTypes */"./src/application/EventTypes.js");var f=function(e,t,n,h,f){for(var p=f.getMaterials(),m=f.glrenderer(),g=f.renderer(),v=f.modelQueue(),y=[],_=(h=h||{}).models||v.getModels(),b=0;b<_.length;b++){var x=_[b].getIterator();if(x&&x.getGeomScenes)for(var w=x.getGeomScenes(),E=0;E<w.length;E++){var A=w[E];A&&y.push(A)}}var M=h.camera||f.camera;M===f.camera&&(M=M.clone()),M.clientWidth=e,M.clientHeight=t;var S=new i.FrustumIntersector,T=h.excludeCutPlanes?[]:p.getCutPlanes();S.reset(M,T),S.areaCullThreshold=r.PIXEL_CULLING_THRESHOLD,m.pushViewport();var C,P=m.getPixelRatio();m.setPixelRatio(1),h.renderContext?C=h.renderContext:(C=new o.RenderContext).init(m,e,t,!0),p.addOverrideMaterial("normalsMaterial_screenshot",C.getDepthMaterial()),p.addOverrideMaterial("edgeMaterial_screenshot",C.getEdgeMaterial());var L=h.renderConfig||g.getConfig();C.applyConfig(L),C.beginScene(f.scene,M,f.noLights,!0),m.popViewport(),m.setPixelRatio(P);for(var D=0,R=void 0,I={stop:function(){R&&(Object(s.getGlobal)().clearTimeout(R),V())},finished:function(){return!!R}},j=-1,O=[],N=0;N<_.length;N++){var k=_[N];if(k.getData().isLeaflet){var F=k.getIterator();O.push({iter:F,viewId:F.registerView(),ready:!1})}}var V=function(){O.forEach((function(e){return e.iter.unregisterView(e.viewId)})),O.length=0},B=h.fragOptions,U=B?[]:void 0,z=function(e){if(!!B&&e instanceof a.RenderBatch){var t=e.frags;e.forEachNoMesh((function(e,n){U[n]=t.vizflags[e];var r=B.isFragOff&&B.isFragOff(e);void 0!==r&&t.setFlagFragment(e,l.MeshFlags.MESH_HIDE,r);var i=B.isFragVisible&&B.isFragVisible(e);void 0!==i&&t.setFlagFragment(e,l.MeshFlags.MESH_VISIBLE,i)}))}},G=function(e){if(!!B&&e instanceof a.RenderBatch){var t=e.frags;e.forEachNoMesh((function(e,n){var r=U[n],i=!!(r&l.MeshFlags.MESH_HIDE),o=!!(r&l.MeshFlags.MESH_VISIBLE);t.setFlagFragment(e,l.MeshFlags.MESH_HIDE,i),t.setFlagFragment(e,l.MeshFlags.MESH_VISIBLE,o)}))}},H=function(){var e=void 0;if(h.models){e=new d.Box3;for(var t=0;t<_.length;t++){var n=_[t];e.union(n.getBoundingBox())}}else e=f.getVisibleBounds();var r=h.hasOwnProperty("is2d")?h.is2d:f.is2d,i=C.settings.deviceHeight,o=h.excludeCutPlanes?void 0:p.getCutPlanesRaw(),s=o&&o[0],a=_[0]&&_[0].getBoundingBox();return c.SceneMath.getPixelsPerUnit(M,r,e,i,s,a)}(),W=[],X=null,q=function(e){h.excludeThemingColors&&e instanceof a.RenderBatch&&(e.frags.is2d||(X=e.frags.db2ThemingColor,e.frags.db2ThemingColor=W))},Y=function(e){X&&(e.frags.db2ThemingColor=X,X=null)},K=new d.Vector4(0,0,-1,-1e20),Q=[],Z=null;return function r(){if(!function(){for(var e=!0,t=0;t<O.length;t++){var n=O[t];n.ready||(n.ready=n.iter.reset(S,M,n.viewId)),e=e&&n.ready}if(e=e||h.dontWaitForLeafletTiles)for(var r=0;r<O.length;r++){var i=O[r],o=i.iter.getScene(i.viewId);y.push(o)}return e}())R=Object(s.getGlobal)().setTimeout(r,0);else{var i=performance.now();m.pushViewport();var o=m.getPixelRatio();m.setPixelRatio(1),m.setViewport(0,0,e,t);var l=f.getPixelsPerUnit(f.camera,f.getVisibleBounds());for(p.updatePixelScale(H,e,t),h.excludeCutPlanes&&function(){var e=(Z=p.getCutPlanes()).length;if(Q.length!==e){Q.length=e;for(var t=0;t<e;t++)Q[t]=K}g.toggleTwoSided(p.setCutPlanes(Q))}(),h.beforeRender&&h.beforeRender();D<y.length;){var c=y[D];if(z(c),q(c),c instanceof a.RenderBatch&&c.applyVisibility(u.RenderFlags.RENDER_NORMAL,S),C.renderScenePart(c,!0,!0,!1,!1),(c.frags&&!c.frags.areAllVisible()||B)&&(c instanceof a.RenderBatch&&c.applyVisibility(u.RenderFlags.RENDER_HIDDEN,S),g.setEdgeColor(f.edgeColorGhosted),c.overrideMaterial=f.fadeMaterial,C.renderScenePart(c,!0,!0,!1,!1),g.setEdgeColor(f.edgeColorMain),c.overrideMaterial=null),Y(c),G(c),D++,performance.now()-i>20)break}if(m.popViewport(),m.setPixelRatio(o),p.updatePixelScale(l,g.settings.deviceWidth,g.settings.deviceHeight),h.excludeCutPlanes&&g.toggleTwoSided(p.setCutPlanes(Z)),h.afterRender&&h.afterRender(),D===y.length?function(){V();var e=C.getColorTarget();((L.aoEnabled||L.antialias)&&(L.aoEnabled&&C.computeSSAO(),e=C.getNamedTarget("overlay"),C.getBlendPass().uniforms.tOverlay.value=null,C.setOffscreenTarget(e),C.presentBuffer()),h.returnAsTarget)?n(C,e,M):C.targetToCanvas(e).canvas.toBlob((function(e){var t=Object(s.getGlobal)().URL.createObjectURL(e);n&&n(t)}))}():R=Object(s.getGlobal)().setTimeout(r,0),h.onProgress){var d=Math.floor(100*D/y.length);d!==j&&(j=d,h.onProgress(d))}}}(),I},p=function(e,t,n,r,i){var o=i.fullPage,a=i.bounds,l=i.getCropBounds,c=i.margin,u=i.overlayRenderer,d=i.overlayRendererExtraOptions;o&&(a=e.impl.getVisibleBounds());var h=e.impl.getCanvasBoundingClientRect().width,p=e.navigation.getCamera();a&&(p=_(e,a,c));var m=g(e,p);try{if(o){var y=m.size(),b=h/Math.max(y.x,y.y);t=Math.floor(t*b),n=Math.floor(n*b)}var x=function(i){if(o){var c=t/h;m.min.x*=c,m.min.y*=c,m.max.x*=c,m.max.y*=c,v(i,m,r)}else if(l){var u=l(e,p,a);v(i,u,r)}else i.toBlob((function(e){var i=Object(s.getGlobal)().URL.createObjectURL(e);r(i,t,n)}))},w=e.impl.selector.getSelection();return e.clearSelection(),f(t,n,(function(r,i,o){if(e.impl.selector.setSelection(w),u){u(e,{width:t,height:n,ctx:r,target:i,screenshotCamera:o,onRenderDone:x},d)}else{var s=r.targetToCanvas(i).canvas;x(s)}}),{returnAsTarget:!0,camera:p},e.impl)}catch(e){console.error("getScreenShot error: "+e),r(null)}},m=function(e){var t=e.impl.getVisibleBounds(),n=e.model.getMetadata("page_dimensions","hide_paper");if(e.model.is2d()&&!e.model.getData().isLeaflet&&!e.model.getData().isPdf&&!n){t=t.clone();var r=e.model.getMetadata("page_dimensions","page_width");t.max.x-=.0075*r,t.min.y+=.0075*r}return t},g=function(e,t){var n=m(e),r=e.worldToClient(n.min,t),i=e.worldToClient(n.max,t);return(new d.Box3).setFromPoints([r,i])},v=function(e,t,n){var r=Object(s.getGlobal)().document.createElement("canvas"),i=r.getContext("2d"),o=t.size(),a=Math.min(Math.floor(o.x),e.width),l=Math.min(Math.floor(o.y),e.height);r.width=a,r.height=l;var c=Math.max(Math.floor(t.min.x),0),u=Math.max(Math.floor(t.min.y),0),d=a,h=l;i.drawImage(e,c,u,d,h,0,0,a,l),r.toBlob((function(e){var t=Object(s.getGlobal)().URL.createObjectURL(e);n(t,a,l)}),"image/png")},y=function(e,t,n,r){var i=Object(s.getGlobal)().document.createElement("canvas"),o=i.getContext("2d"),a=new Image;i.width=t,i.height=n,a.src=e,a.onload=function(){o.drawImage(a,0,0,t,n);var e=i.toDataURL("image/png");r(e)}},_=function(e,t,n){n=n||e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN;var r={horizontal:e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,vertical:e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN};e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=n,e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=n;var i=e.getState({viewport:!0});e.navigation.fitBounds(!0,t,!1);var o=e.navigation.getCamera().clone();return e.restoreState(i,void 0,!0),e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=r.horizontal,e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=r.vertical,e.impl.updateNearFarValues(o,t),o},b={getScreenShotLegacy:function(e,t,n,r,i){var o=e.impl,a=o.renderer(),l=a.settings.logicalWidth,c=a.settings.logicalHeight,u=o.progressiveRender,f=o.glrenderer().getPixelRatio();t&&n||(t=l,n=c),o.progressiveRender=!1,o.resize(t/f,n/f,!0),o.tick(performance.now());var p=new d.WebGLRenderTarget(t,n,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBFormat,type:d.UnsignedByteType});function m(){var e=a.targetToCanvas(p||a.getColorTarget());function t(){o.progressiveRender=u,o.resize(l,c,!0),e.canvas.toBlob((function(e){var t=Object(s.getGlobal)().URL.createObjectURL(e);r?r(t):Object(s.getGlobal)().open(t)}),"image/png")}p&&(p.dispose(),p=void 0,o.glrenderer().setRenderTarget(null)),i?i(e.ctx,t):t()}if(a.setOffscreenTarget(p),a.presentBuffer(),a.setOffscreenTarget(null),e.model.getData().isLeaflet){var g=function(){v=!0,o.progressiveRender=u,o.resize(l,c,!0)},v=!1;e.addEventListener(h.CANCEL_LEAFLET_SCREENSHOT,g,{once:!0}),o.invalidate(!0),e.model.getIterator().callWhenRefined((function(){v||(e.removeEventListener(h.CANCEL_LEAFLET_SCREENSHOT,g),m())}))}else m();p&&p.dispose()},getScreenShot:f,getScreenShotWithBounds:p,getScreenShotAtScreenSize:function(e,t,n){var r=e.impl.getCanvasBoundingClientRect(),i=Math.floor(r.width),o=Math.floor(r.height);p(e,i,o,(function(e,n,r){e?y(e,n,r,(function(e){t(e,n,r)})):t(null)}),n)},getSceneWorldBounds:m,getSceneClientBounds:g,cropImage:v,blobToImage:y,makeBoundsSquare:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.size(),r=Math.max(n.x,n.y,t);e.expandByVector(new d.Vector3((r-n.x)/2,(r-n.y)/2,0))},getCameraWithFitBounds:_}},"./src/application/Thumbnails.js":
/*!***************************************!*\
  !*** ./src/application/Thumbnails.js ***!
  \***************************************/
/*! exports provided: Thumbnails */function(e,t,n){"use strict";n.r(t),n.d(t,"Thumbnails",(function(){return a}));var r=n(/*! ./LocalStorage */"./src/application/LocalStorage.js"),i=n(/*! ../file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),o=n(/*! ../file-loaders/net/Xhr */"./src/file-loaders/net/Xhr.js"),s=n(/*! ../compat */"./src/compat.js");var a={getUrlForBubbleNode:function(e,t){if(!e)return Promise.reject(new Error("Missing instance of BubbleNode"));if(!e.findParentGeom2Dor3D())return Promise.reject(new Error("No thumbnail available."));var n=(t=t||{}).size||200;return e.getRootNode().data.isVectorPDF?new Promise((function(t){var i=e.data,o=e.getRootNode().data.getPDF(),a=n,l=n,c="".concat(i.guid,"/thumbnail/").concat(a,"x").concat(l);!function(e,t,n,i,o,a){var l=r.LocalStorage.getItem(o);l?a(l):e.getPage(t).then((function(e){var t=Object(s.getGlobal)().document.createElement("canvas");t.width=n,t.height=i;var l=t.getContext("2d"),c=e.getViewport(1),u=Math.min(t.width/c.width,t.height/c.height);e.render({canvasContext:l,viewport:e.getViewport(u)}).then((function(){t.toBlob((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){r.LocalStorage.setItem(o,t.result),a(t.result)}}),"image/png")}))}))}(o,i.page,a,l,c,t)})):new Promise((function(t,r){var s=e.getRootNode(),a={urn:s.urn(),width:n,height:n,guid:encodeURIComponent(e.guid()),acmsession:i.endpoint.getAcmSession()},l={responseType:"blob",skipAssetCallback:!0,size:n,guid:a.guid,acmsession:a.acmSession},c="urn:"+a.urn;e.data.thumbnailUrn&&(c=s.getDocument().getFullPath(e.data.thumbnailUrn)),o.ViewingService.getThumbnail(Object(i.initLoadContext)(),c,(function(e){var n=new FileReader;n.onload=function(e){var n=e.target.result;t(n)},n.readAsDataURL(e)}),(function(e){r(new Error("Thumbnail is unavailable."))}),l)}))}}},"./src/application/Viewer3D.css":
/*!**************************************!*\
  !*** ./src/application/Viewer3D.css ***!
  \**************************************/
/*! no static exports found */function(e,t,n){},"./src/application/Viewer3D.js":
/*!*************************************!*\
  !*** ./src/application/Viewer3D.js ***!
  \*************************************/
/*! exports provided: Viewer3D, waitForCompleteLoad */function(e,t,n){"use strict";n.r(t),n.d(t,"Viewer3D",(function(){return q})),n.d(t,"waitForCompleteLoad",(function(){return Y}));n(/*! @babel/polyfill */"./node_modules/@babel/polyfill/lib/index.js");var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ../compat */"./src/compat.js"),o=n(/*! ../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ./Profile */"./src/application/Profile.js"),a=n(/*! ./PreferenceNames */"./src/application/PreferenceNames.js"),l=n(/*! ./Preferences */"./src/application/Preferences.js"),c=n(/*! ./ProfileManager */"./src/application/ProfileManager.js"),u=n(/*! ../globals */"./src/globals.js"),d=n(/*! ../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),h=n(/*! ./EventDispatcher */"./src/application/EventDispatcher.js"),f=n(/*! ./EventUtils */"./src/application/EventUtils.js"),p=n(/*! ./ScreenModeDelegate */"./src/application/ScreenModeDelegate.js"),m=n(/*! ./ExtensionManager */"./src/application/ExtensionManager.js"),g=n(/*! ../tools/HotkeyManager */"./src/tools/HotkeyManager.js"),v=n(/*! ../tools/Navigation */"./src/tools/Navigation.js"),y=n(/*! ../tools/ToolController */"./src/tools/ToolController.js"),_=n(/*! ../tools/ViewingUtilities */"./src/tools/ViewingUtilities.js"),b=n(/*! ../tools/DefaultHandler */"./src/tools/DefaultHandler.js"),x=n(/*! ../tools/GestureHandler */"./src/tools/GestureHandler.js"),w=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),E=(n(/*! ../file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),n(/*! ./EventTypes */"./src/application/EventTypes.js")),A=n(/*! ./FileLoaderManager */"./src/application/FileLoaderManager.js"),M=n(/*! ../file-loaders/main/PropDbLoader */"./src/file-loaders/main/PropDbLoader.js"),S=n(/*! ../resource-loader */"./src/resource-loader.js"),T=n(/*! ./ViewerState */"./src/application/ViewerState.js"),C=n(/*! ../net/LiveReviewClient */"./src/net/LiveReviewClient.js"),P=n(/*! ../tools/OrbitDollyPanTool */"./src/tools/OrbitDollyPanTool.js"),L=n(/*! ../tools/autocam/Autocam */"./src/tools/autocam/Autocam.js"),D=n(/*! ./Viewer3DImpl */"./src/application/Viewer3DImpl.js"),R=n(/*! ./bubble */"./src/application/bubble.js"),I=n(/*! ../wgs/scene/Consolidation */"./src/wgs/scene/Consolidation.js"),j=n(/*! ../tools/KeyCode */"./src/tools/KeyCode.js"),O=n(/*! ./LoadingSpinner */"./src/application/LoadingSpinner.js"),N=n(/*! ../wgs/scene/SceneMath */"./src/wgs/scene/SceneMath.js"),k=n(/*! ./ScreenShot */"./src/application/ScreenShot.js"),F=n(/*! ../file-loaders/loader-extensions */"./src/file-loaders/loader-extensions.js"),V=n(/*! ./OverlayManager */"./src/application/OverlayManager.js"),B=n(/*! ./GlobalManager */"./src/application/GlobalManager.js"),U=n(/*! ./GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),z=n(/*! ./LightPresets */"./src/application/LightPresets.js");function G(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}var H=Bimfish.Viewing;var W=0,X=["markups-svg","pushpin-container"];function q(e,t){if(this.setGlobalManager(new B.GlobalManager),e){if(this.clientContainer=e,this.container=this.getDocument().createElement("div"),this.container.classList.add("adsk-viewing-viewer"),this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(Object(i.isTouchDevice)()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=t||{},this.contextMenu=null,this.contextMenuCallbacks={},this.started=!1,this.theme=this.config.theme||"dark-theme",this.container.classList.add(this.theme),this.containerLayerOrder=this.config.containerLayerOrder||X,Object(i.isChrome)()&&this.container.classList.add("quality-text"),"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=this.getDocument().createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=this.getDocument().createElement("canvas"),this.canvas.tabIndex=0,this.canvas.setAttribute("data-viewer-canvas","true"),this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this}var n={prefix:"Bimfish.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!Object(i.isNodeJS)()};this.prefs=new l.Preferences(this,n),this.profile=null,this.profileManager=new c.ProfileManager,this._hotkeyManager=new g.HotkeyManager,this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=W++,this.impl=new D.Viewer3DImpl(this.canvas,this),this.overlays=new V.OverlayManager(this.impl),this._loadingSpinner=new O.LoadingSpinner,this._loadingSpinner.setGlobalManager(this.globalManager),this.trackADPTimer=[]}function Y(e,t){return new Promise((function(n,r){var i=0;function o(t){2===i&&n({viewer:e,model:t})}e.addEventListener(E.GEOMETRY_LOADED_EVENT,(function n(s){s.model.getData().loadOptions.bubbleNode===t.bubbleNode&&(e.removeEventListener(E.GEOMETRY_LOADED_EVENT,n),i++,t.skipPropertyDb?o(s.model):s.model.getProperties(1,(function(e){return o(s.model)}),(function(e){return r(e)})))})),e.addEventListener(E.TEXTURES_LOADED_EVENT,(function n(r){r.model.getData().loadOptions.bubbleNode===t.bubbleNode&&(e.removeEventListener(E.TEXTURES_LOADED_EVENT,n),i++,o(r.model))}))}))}h.EventDispatcher.prototype.apply(q.prototype),p.ScreenModeMixin.prototype.apply(q.prototype),m.ExtensionMixin.prototype.apply(q.prototype),U.GlobalManagerMixin.call(q.prototype),q.prototype.constructor=q,Object.defineProperty(q.prototype,"model",{get:function(){return this.impl.model},set:function(){throw"Do not set viewer.model"}}),q.ViewerCount=0,q.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},q.createHeadlessViewer=function(){var e=new q;return e.impl.initialize(),e.impl.setLightPreset(0),e},q.prototype.start=function(e,t,n,r){if(this.started)return 0;this.started=!0;var i=this,o=i.initialize();return 0!==o?(r&&setTimeout((function(){r(o)}),1),o):(setTimeout((function(){i.setUp(i.config)}),1),e&&this.loadModel(e,t,n,r),0)},q.prototype.startWithDocumentNode=function(e,t,n){var r=this;return new Promise((function(i,o){if(r.started)return 0;r.started=!0;var s=r.initialize();0===s?(setTimeout((function(){r.setUp(r.config)}),1),r.loadDocumentNode(e,t,n).then(i).catch(o)):setTimeout((function(){o(s)}),1)}))},q.prototype.registerUniversalHotkeys=function(){var e,t,n,r=this;e=function(){return r.navigation.setRequestFitToView(!0),!0},r._hotkeyManager.pushHotkeys("Bimfish.FitToView",[{keycodes:[j.KeyCode.f],onPress:e}]),e=function(){return r.navigation.setRequestHomeView(!0),!0},r._hotkeyManager.pushHotkeys("Bimfish.Home",[{keycodes:[j.KeyCode.h],onPress:e},{keycodes:[j.KeyCode.HOME],onPress:e}]),t=function(){return r.objectContextMenu&&r.objectContextMenu.hide()||r.dispatchEvent({type:E.ESCAPE_EVENT}),!0},r._hotkeyManager.pushHotkeys("Bimfish.Escape",[{keycodes:[j.KeyCode.ESCAPE],onRelease:t}]),e=function(){return n=r.getActiveNavigationTool(),r.setActiveNavigationTool("pan")},t=function(){return r.setActiveNavigationTool(n)};var i=[{keycodes:[j.KeyCode.SHIFT],onPress:e,onRelease:t},{keycodes:[j.KeyCode.SPACE],onPress:e,onRelease:t}];r._hotkeyManager.pushHotkeys("Bimfish.Pan",i,{tryUntilSuccess:!0})},q.prototype.createControls=function(){var e=this.impl;return this.navigation=new v.Navigation(e.camera),this.__initAutoCam(e),this.utilities=new _.ViewingUtilities(e,this.autocam,this.navigation),this.clickHandler=new b.DefaultHandler(e,this.navigation,this.utilities),this.toolController=new y.ToolController(e,this,this.autocam,this.utilities,this.clickHandler),this.toolController.registerTool(new x.GestureHandler(this)),this.toolController.registerTool(this._hotkeyManager),this.toolController.activateTool(this._hotkeyManager.getName()),this.registerUniversalHotkeys(),this.toolController.registerTool(new P.OrbitDollyPanTool(e,this,this.config.navToolsConfig)),this.toolController},q.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var e=this.getDimensions();if(this.canvas.width=e.width,this.canvas.height=e.height,Object(i.isIOSDevice)()&&this.getWindow().devicePixelRatio&&(this.canvas.width/=this.getWindow().devicePixelRatio,this.canvas.height/=this.getWindow().devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var t=function(){if(H.getGlobal().WebGLRenderingContext){for(var e=H.getGlobal().document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,r=0;r<4;r++)try{if((n=e.getContext(t[r]))&&"function"==typeof n.getParameter)return 1}catch(e){}return 0}return-1}();if(t<=0)return-1===t?d.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:d.ErrorCodes.BROWSER_WEBGL_DISABLED}var n,r=this;Object(i.isIOSDevice)()?this.onResizeCallback=function(e){clearTimeout(n),n=setTimeout(r.resize.bind(r),500)}:this.onResizeCallback=function(e){var t=r.impl.camera.clientWidth,n=r.impl.camera.clientHeight,i=r.container.clientWidth,o=r.container.clientHeight;t===i&&n===o||r.resize()};this.addWindowEventListener("resize",this.onResizeCallback,!1),this.onScrollCallback=function(e){r.impl.canvasBoundingclientRectDirty=!0},this.addWindowEventListener("scroll",this.onScrollCallback),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.initializePrefListeners(),this.setDefaultNavigationTool("orbit"),this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var o=this.config&&this.config.canvasConfig?this.config.canvasConfig:q.kDefaultCanvasConfig;return this.setCanvasClickBehavior(o),o.disableSpinner||(this.loadSpinner=this._loadingSpinner.createDom(this.container)),this.viewerState=new T.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),this.getWindow().NOP_VIEWER=this,this.addEventListener(E.MODEL_ADDED_EVENT,(function(e){r.onModelAdded(e.model,e.preserveTools)})),this.dispatchEvent(E.VIEWER_INITIALIZED),this.trackADPSettingsOptions(),this.trackADPExtensionsLoaded(),q.ViewerCount++,0},q.prototype.setUp=function(e){if(this.config=e||{},Array.isArray(this.config.extensions))for(var t=this.config.extensions,n=0;n<t.length;++n)this.loadExtension(t[n],this.config);"true"===Object(u.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Bimfish.Debug",this.config);var r=this.config.canvasConfig||q.kDefaultCanvasConfig;this.setCanvasClickBehavior(r)},q.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var e in this.loadedExtensions)try{this.unloadExtension(e)}catch(t){o.logger.error("Failed to unload extension: "+e,t,Object(d.errorCodeString)(d.ErrorCodes.VIEWER_INTERNAL_ERROR)),o.logger.track({category:"error_unload_extension",extensionId:e,error_message:t.message,call_stack:t.stack})}this.loadedExtensions=null}for(this.toolController&&(this.toolController.enableMouseButtons(!1),this.toolController.deactivateTool("gestures")),o.logger.reportRuntimeStats(!0),this._loadingSpinner.show(),this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null);this.trackADPTimer.length>0;)clearTimeout(this.trackADPTimer.pop());this.impl.unloadCurrentModel(),this.impl.setCutPlaneSet("__set_view",void 0)},q.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},q.prototype.localize=function(){w.i18n.localize()},q.prototype.__initAutoCam=function(e){var t=this,n=e.camera;n.pivot||(n.pivot=new r.Vector3(0,0,0)),n.target||(n.target=new r.Vector3(0,0,0)),n.worldup||(n.worldup=n.up.clone()),t.autocamCamera=n.clone(),t.autocamCamera.target=n.target.clone(),t.autocamCamera.pivot=n.pivot.clone(),t.autocamCamera.worldup=n.worldup.clone(),t.autocam=new L.Autocam(t.autocamCamera,t.navigation,t.canvas),t.autocam.setGlobalManager(this.globalManager),t.autocam.registerCallbackCameraChanged((function(e){t.autocamCamera.isPerspective!==n.isPerspective&&(t.autocamCamera.isPerspective?t.navigation.toPerspective():t.navigation.toOrthographic()),t.navigation.setVerticalFov(t.autocamCamera.fov,!1),t.navigation.setView(t.autocamCamera.position,t.autocamCamera.target),t.navigation.setPivotPoint(t.autocamCamera.pivot),t.navigation.setCameraUpVector(t.autocamCamera.up),e&&t.navigation.setWorldUpVector(t.autocamCamera.worldup),t.impl.syncCamera(e)})),t.autocam.registerCallbackPivotDisplay((function(e){t.utilities?t.utilities.pivotActive(e,!1):t.impl.controls.pivotActive(e,!1)})),t.autocam.registerCallbackTransitionCompleted((function(){t.fireEvent({type:E.CAMERA_TRANSITION_COMPLETED})})),t.addEventListener("cameraChanged",(function(e){var n=e.camera;t.autocam.sync(n)})),t.autocam.sync(n)},q.prototype.uninitialize=function(){this.removeWindowEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.removeWindowEventListener("scroll",this.onScrollCallback),this.onScrollCallback=null,this.canvas?this.canvas.removeEventListener("mousedown",this.onMouseDown):this.container&&this.container.removeEventListener("mousedown",this.onMouseDown),this.onMouseDown=null,this.canvas?this.canvas.removeEventListener("mouseup",this.onMouseUp):this.container&&this.container.removeEventListener("mouseup",this.onMouseUp),this.onMouseUp=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,o.logger.reportRuntimeStats(),o.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.overlays&&(this.overlays.dtor(),this.overlays=null),this.loadSpinner=null,this._loadingSpinner.destroy(),this.prefs&&this.prefs.clearListeners(),this.prefs=null,this.profile=null,this.profileManager=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,this._hotkeyManager.popHotkeys("Bimfish.FitToView"),this._hotkeyManager.popHotkeys("Bimfish.Home"),this._hotkeyManager.popHotkeys("Bimfish.Escape"),this._hotkeyManager.popHotkeys("Bimfish.Pan"),this._hotkeyManager.popHotkeys("Bimfish.Orbit"),q.ViewerCount--,0===q.ViewerCount&&Object(M.clearPropertyWorkerCache)(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.contextMenu=null,this.contextMenuCallbacks=null,this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.dispatchEvent(E.VIEWER_UNINITIALIZED),this.listeners={},o.logger.log("viewer destroy")},q.prototype.finish=function(){this.tearDown(),this.uninitialize()},q.prototype.setLoadHeuristics=function(e){var t=e.bubbleNode;if(t){var n=t.findViewableParent();if(n){var r=n.name();e.fileExt=r.slice(r.length-3).toLowerCase();void 0===e.isAEC&&-1!==["rvt","nwd","nwc","ifc"].indexOf(e.fileExt)&&(e.isAEC=!0)}}if(e.isAEC){var o=Object(u.getParameterByName)("useConsolidation")||"";e.useConsolidation="true"===o||"false"!==o&&void 0,void 0===e.useConsolidation&&(e.useConsolidation=!Object(i.isMobileDevice)()&&!Object(i.isNodeJS)()),void 0===e.createWireframe&&(e.createWireframe=!Object(i.isMobileDevice)()),void 0===e.disablePrecomputedNodeBoxes&&(e.disablePrecomputedNodeBoxes=!0)}else void 0===e.createWireframe&&(e.createWireframe=!Object(i.isMobileDevice)()&&this.prefs.edgeRendering);e.useConsolidation&&!e.bvhOptions&&(e.bvhOptions={},I.Consolidation.applyBVHDefaults(e.bvhOptions))},q.prototype.trackADPSettingsOptions=function(){var e=this;this.trackADPTimer.push(setTimeout((function(){if(e.prefs){var t={category:"settingOptionsStatus",switchSheetColorWhiteToBlack:e.prefs.swapBlackAndWhite,leftHandedMouseSetup:e.prefs.leftHandedMouseSetup,openPropertiesOnSelect:e.prefs.openPropertiesOnSelect,orbitPastWorldPoles:e.prefs.orbitPastWorldPoles,reverseMouseZoomDirection:e.prefs.reverseMouseZoomDir,fusionStyleOrbit:e.prefs.fusionOrbit,setPivotWithLeftMouseButton:e.prefs.clickToSetCOI,zoomTowardPivot:e.prefs.zoomTowardsPivot,viewCubeActsOnPivot:e.prefs.alwaysUsePivot,showViewCube:e.prefs.viewCube,environmentImageVisible:e.prefs.envMapBackground,displayEdges:e.prefs.edgeRendering,displayPoints:e.prefs.pointRendering,displayLines:e.prefs.lineRendering,ghostHiddenObjects:e.prefs.ghosting,groundReflection:e.prefs.groundReflection,groundShadow:e.prefs.groundShadow,ambientShadows:e.prefs.ambientShadows,antiAliasing:e.prefs.antialiasing,progressiveModelDisplay:e.prefs.progressiveRendering,smoothNavigation:e.prefs.optimizeNavigation};o.logger.track(t)}}),3e4))},q.prototype.trackADPExtensionsLoaded=function(){var e=this,t={category:"loaded_extensions"};this.trackADPTimer.push(setTimeout((function(){if(e.loadedExtensions)for(var n in e.loadedExtensions)t[n]=n;o.logger.track(t)}),3e4))},q.prototype.activateDefaultNavigationTools=function(e){if(!Object(i.isNodeJS)()){var t=e?"pan":"orbit";this.setDefaultNavigationTool(t),this.setActiveNavigationTool(t),this.toolController&&(this.toolController.enableMouseButtons(!0),this.toolController.activateTool("gestures"))}},q.prototype.registerDimensionSpecificHotkeys=function(e){if(this._hotkeyManager)if(e)this._hotkeyManager.popHotkeys("Bimfish.Orbit");else{var t,n=this,r=[{keycodes:[j.KeyCode.ALT],onPress:function(){return t=n.getActiveNavigationTool(),n.setActiveNavigationTool("orbit")},onRelease:function(){return n.setActiveNavigationTool(t)}}];this._hotkeyManager.pushHotkeys("Bimfish.Orbit",r,{tryUntilSuccess:!0})}},q.prototype.onModelAdded=function(e,t){1===this.impl.modelQueue().getModels().length&&this.initializeFirstModelPresets(e,t)},q.prototype.initializeFirstModelPresets=function(e,t,n){e.is2d()&&this.activateLayerState("Initial"),n||e.getData().loadOptions.preserveView||(this.setActiveNavigationTool(),this.impl.setViewFromFile(e,!0),this.toolController.recordHomeView()),this.registerDimensionSpecificHotkeys(e.is2d()),t||this.activateDefaultNavigationTools(e.is2d()),this.navigation.setIs2D(this.impl.modelQueue().areAll2D());var r=e.getData();r.isLeaflet?this.navigation.setConstraints2D(r.bbox,r.maxPixelPerUnit):this.navigation.setConstraints2D()},q.prototype.loadModel=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n,r,s,a){var l,c,h,f,p,m,g,v,y,_,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=function(e,t,n){l._loadingSpinner.hide(),s&&s(e,t,n)},f=function(e,t){l.impl._removeLoadingFile(h),e?p(e.code,e.msg,e.args):(t.getData().underlayRaster=n.underlayRaster&&t.getLeaflet(),n.loadAsHidden?l.impl.modelQueue().addHiddenModel(t):l.impl.addModel(t),t.loader&&t.loader.notifiesFirstPixel?l.addEventListener(E.RENDER_FIRST_PIXEL,(function(){l._loadingSpinner.hide()}),{once:!0}):l._loadingSpinner.hide(),r&&r(t))},l=this,void 0===(n=n||{}).skipPropertyDb&&(c=Object(u.getParameterByName)("skipPropertyDb")||"",n.skipPropertyDb="true"===c||"false"!==c&&void 0),m=t.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),g=m?m[1]:null,!(v=this.config&&this.config.loaderExtensions&&this.config.loaderExtensions[g]||g in F.default&&F.default[g])||this.isExtensionLoaded(v)){e.next=17;break}return e.prev=8,e.next=11,this.loadExtension(v);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(8),s&&s(d.ErrorCodes.VIEWER_INTERNAL_ERROR,e.t0.toString()),e.abrupt("return",!1);case 17:if(y=n&&n.fileLoader?n.fileLoader:A.FileLoaderManager.getFileLoaderForExtension(g)){e.next=22;break}return o.logger.error("File extension not supported:"+g,Object(d.errorCodeString)(d.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),p(d.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0,g),e.abrupt("return",!1);case 22:return this.setLoadHeuristics(n),this.impl.hasModels()||this._loadingSpinner.show(),h=new y(this.impl,this.config),_=h.loadFile(t,n,f,a),this.fireEvent({type:E.LOADER_LOAD_FILE_EVENT,loader:h}),Object(i.isNodeJS)()||this.profile||(b=this.chooseProfile(n),this.setProfile(b)),this.impl.setRenderingPrefsFor2D(!h.is3d()),e.abrupt("return",_);case 30:case"end":return e.stop()}}),e,this,[[8,13]])})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){G(o,r,i,s,a,"next",e)}function a(e){G(o,r,i,s,a,"throw",e)}s(void 0)}))});return function(e,n,r,i,o){return t.apply(this,arguments)}}(),q.prototype.unloadModel=function(e){e||(e=this.model),this.impl.unloadModel(e)},q.prototype.loadDocumentNode=function(e,t,n){var r=this,i=t,o={},s=e.getViewableUrn(i,o),a=i.findPropertyDbPath();s=e.getFullPath(s);var l={sharedPropertyDbPath:a=e.getFullPath(a),acmSessionId:e.acmSessionId,bubbleNode:i,applyRefPoint:!1,loadOptions:o,page:o.page||1};for(var c in n=n||{},l)n.hasOwnProperty(c)||(n[c]=l[c]);if(!n.keepCurrentModels&&this.impl.hasModels()){var u=this.config;this.tearDown(),this.setUp(u)}var d=i.findParentGeom2Dor3D().extensions();Array.isArray(d)&&d.forEach((function(e){r.loadExtension(e,r.config)}));var h=this,f=o.isPdf?this.loadExtension("Bimfish.PDF",this.config):Promise.resolve(),p=!n.disableUnderlayRaster&&o.tempRasterPath?this._loadTempRasterModel(e,n,i):Promise.resolve();return f.then(p).then((function(){return new Promise((function(e,t){h.loadModel(s,n,(function(t){n.loadAsHidden||n.preserveView||"view"!==i.type()||h.setView(i,{skipTransition:!0}),e(t)}),(function(e){t(e)}))}))}))},q.prototype.unloadDocumentNode=function(e){var t=this.impl.findModel(e,!0);if(t)return this.impl.unloadModel(t),!0;if(!this.impl.loaders)return!1;for(var n=0;n<this.impl.loaders.length;n++){var r=this.impl.loaders[n];if((r.options&&r.options.bubbleNode)===e)return r.dtor(),this.impl.loaders.splice(n,1),!0}return!1},q.prototype._loadTempRasterModel=function(e,t,n){var r=this;return new Promise((function(i,o){if(t.loadAsHidden)return i();t.underlayRaster=!0,t.loadOptions.fitPaperSize=!0;var s=function(e){return e.getDocumentNode().getDocument().getPath()===n.getDocument().getPath()&&e.getDocumentNode().guid()===n.guid()&&!e.getData().isLeaflet},a=function e(t){var n=t.model;s(n)&&(r.initializeFirstModelPresets(n,!1,!0),r.removeEventListener(E.MODEL_ADDED_EVENT,e))};r.addEventListener(E.MODEL_ADDED_EVENT,a);var l,c=function e(t){var n=t.model;s(n)&&(n.getFragmentList().setObject2DVisible(-1,!0),r.removeEventListener(E.MODEL_REMOVED_EVENT,e),r.removeEventListener(E.MODEL_ADDED_EVENT,a),r.removeEventListener(E.GEOMETRY_LOADED_EVENT,u))};r.addEventListener(E.MODEL_REMOVED_EVENT,c);var u=function e(t){var n=t.model;s(n)&&(n.getFragmentList().setObject2DVisible(-1,!0),r.removeEventListener(E.MODEL_REMOVED_EVENT,c),l&&(r.unloadModel(l),l=null),r.removeEventListener(E.GEOMETRY_LOADED_EVENT,e))};r.addEventListener(E.GEOMETRY_LOADED_EVENT,u);var d=e.getFullPath(t.loadOptions.tempRasterPath);r.loadModel(d,t,(function(e){l=e,t.loadOptions.fitPaperSize=void 0,t.underlayRaster=void 0,t.hideBackground=!0,i()}),(function(){t.loadOptions.fitPaperSize=void 0,t.underlayRaster=void 0,i()}))}))},q.prototype.getDimensions=function(){if(this.container){var e={};return this.getScreenMode()===p.ScreenMode.kFullScreen?(e.width=screen.width,e.height=screen.height):e=this.container.getBoundingClientRect(),{width:e.width,height:e.height}}return null},q.prototype.resize=function(){this.container.clientWidth>0&&this.container.clientHeight>0&&(console.log(this.container),this.impl.resize(this.container.clientWidth,this.container.clientHeight))},q.prototype.getHotkeyManager=function(){return this._hotkeyManager},q.prototype.getCamera=function(){return this.impl.camera},q.prototype.getState=function(e){return this.viewerState.getState(e)},q.prototype.restoreState=function(e,t,n){var r=this.viewerState.restoreState(e,t,n);return r&&this.dispatchEvent({type:E.VIEWER_STATE_RESTORED_EVENT,value:r}),r},q.prototype.setView=function(e,t){if(!this.model)return!1;if(!(e&&e instanceof R.BubbleNode))return!1;var n=!!t&&t.skipTransition,i=!t||t.useExactCamera;if(e.getViewBox())return this.setViewFromViewBox(e.getViewBox(),e.name(),n),this.dispatchEvent({type:E.SET_VIEW_EVENT,view:e}),!0;var o=this.getCameraFromViewArray(e.data.camera);if(!o)return!1;this.impl.setViewFromCamera(o,n,i);var s=e.data.sectionPlane,a=e.data.sectionBox,l=e.data.sectionBoxTransform,c=this.model.getData().globalOffset;if(s){for(var u=[],d=0;d<s.length;d+=4){var h=new r.Vector4(s[d+0],s[d+1],s[d+2],s[d+3]);c&&(h.w+=r.Vector3.prototype.dot.call(c,new r.Vector3(s[d+0],s[d+1],s[d+2]))),u.push(h)}this.impl.setCutPlaneSet("__set_view",u)}else if(a&&l){var f=(new r.Matrix4).fromArray([l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[15]]);if(c){var p=(new r.Matrix4).makeTranslation(-c.x,-c.y,-c.z);f.multiply(p)}var m=new r.Vector3(a[0],a[1],a[2]),g=new r.Vector3(a[3],a[4],a[5]),v=new r.Box3(m,g);v.applyMatrix4(f);var y=N.SceneMath.box2CutPlanes(v);this.impl.setCutPlaneSet("__set_view",y)}else this.impl.setCutPlaneSet("__set_view",void 0);return this.dispatchEvent({type:E.SET_VIEW_EVENT,view:e}),!0},q.prototype.setViewFromArray=function(e){var t=this.getCameraFromViewArray(e);this.impl.setViewFromCamera(t,!1,!0)},q.prototype.getCameraFromViewArray=function(e,t){t=t||this.model;var n=this.model&&this.model.getData().placementWithOffset;return R.BubbleNode.readCameraFromArray(e,n)},q.prototype.getViewArrayFromCamera=function(){var e=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0};return this.impl.getViewArrayFromCamera(e)},q.prototype.setViewFromViewBox=function(e,t,n){var r=this.model;if(!r||r.is2d()){if(t&&t.length){var i,s=r.getData().metadata.views;for(i=0;i<s.length&&s[i].name!=t;i++);if(i<s.length){var a=s[i].layer_state;a&&this.activateLayerState(a)}}this.impl.setViewFromViewBox(this.model,e,t,n)}else o.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D")},q.prototype.activateLayerState=function(e){this.impl.layers.activateLayerState(e),this.dispatchEvent({type:E.LAYER_VISIBILITY_CHANGED_EVENT})},q.prototype.getLayerStates=function(){return this.impl.layers.getLayerStates()},q.prototype.setViewFromFile=function(e){this.setActiveNavigationTool(),this.impl.setViewFromFile(e||this.model)},q.prototype.getProperties=function(e,t,n){this.model?this.model.getProperties(e,t,n):n&&n(d.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},q.prototype.getObjectTree=function(e,t){this.model?this.model.getObjectTree(e,t):t&&t(d.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},q.prototype.setCanvasClickBehavior=function(e){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},q.prototype.search=function(e,t,n,r){this.searchText=e,this.model?this.model.search(e,t,n,r):n&&n(d.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},q.prototype.getHiddenNodes=function(e){return e=e||this.model,this.impl.visibilityManager.getHiddenNodes(e)},q.prototype.getIsolatedNodes=function(e){return(e=e||this.model)&&e.is2d()?(o.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes(e)},q.prototype.isolate=function(e,t){if(t=t||this.model){t.getData();this.impl.visibilityManager.isolate(e,t)}},q.prototype.setBackgroundColor=function(e,t,n,r,i,o){this.impl.setClearColors(e,t,n,r,i,o)},q.prototype.setBackgroundOpacity=function(e){this.impl.setClearAlpha(e)},q.prototype.toggleSelect=function(e,t,n){(t=t||this.model)&&t.is2d()?o.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(e,t,n)},q.prototype.select=function(e,t,n){"number"==typeof e&&(e=[e]),t=t||this.model,this.impl.selector.setSelection(e,t,n)},q.prototype.clearSelection=function(){this.impl.selector.clearSelection()},q.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},q.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},q.prototype.setSelectionMode=function(e){this.prefs.set(a.Prefs3D.SELECTION_MODE,e)},q.prototype.getSelection=function(){return this.impl.selector.getSelection()},q.prototype.lockSelection=function(e,t,n){n=n||this.model,this.impl.selector.lockSelection(e,t,n)},q.prototype.unlockSelection=function(e,t){this.impl.selector.unlockSelection(e,t)},q.prototype.isSelectionLocked=function(e,t){return this.impl.selector.isNodeSelectionLocked(e,t)},q.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var n=0;n<t.length;n++)for(var r=0;r<t[n].selection.length;r++)e(t[n].model,t[n].selection[r]);return t},q.prototype.getAggregateIsolation=function(){return this.impl.visibilityManager.getAggregateIsolatedNodes()},q.prototype.getAggregateHiddenNodes=function(){return this.impl.visibilityManager.getAggregateHiddenNodes()},q.prototype.hide=function(e,t){t=t||this.model,this.impl.visibilityManager.hide(e,t)},q.prototype.show=function(e,t){t=t||this.model,this.impl.visibilityManager.show(e,t)},q.prototype.showAll=function(){this.impl.visibilityManager.aggregateIsolate([]),this.impl.layers.showAllLayers(),this.fireEvent({type:E.SHOW_ALL_EVENT})},q.prototype.toggleVisibility=function(e,t){this.impl.visibilityManager.toggleVisibility(e,t)},q.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},q.prototype.isNodeVisible=function(e,t){return t=t||this.model,this.impl.isNodeVisible(e,t)},q.prototype.lockVisible=function(e,t,n){n=n||this.model,this.impl.visibilityManager.lockNodeVisible(e,t,n)},q.prototype.toggleLockVisible=function(e,t){this.impl.visibilityManager.toggleVisibleLocked(e,t)},q.prototype.isVisibleLocked=function(e,t){return this.impl.visibilityManager.isNodeVisibleLocked(e,t)},q.prototype.explode=function(e){this.model&&(this.model.is2d()?o.logger.warn("Viewer3D.explode is not applicable to 2D"):this.impl.explode(e)&&o.logger.track({name:"explode_count",aggregate:"count"}))},q.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(o.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},q.prototype.lockExplode=function(e,t,n){return(n=n||this.model)&&n.is2d()?(o.logger.warn("Viewer3D.lockExplode is not applicable to 2D"),0):this.impl.lockExplode(e,t,n)},q.prototype.isExplodeLocked=function(e,t){return(t=t||this.model)&&t.is2d()?(o.logger.warn("Viewer3D.isExplodeLocked is not applicable to 2D"),0):this.impl.isExplodeLocked(e,t)},q.prototype.toggleLockExplode=function(e,t){return(t=t||this.model)&&t.is2d()?(o.logger.warn("Viewer3D.toggleLockExplode is not applicable to 2D"),0):this.impl.lockExplode(e,!this.isExplodeLocked(e,t),t)},q.prototype.setQualityLevel=function(e,t){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set(a.Prefs3D.AMBIENT_SHADOWS,e),this.prefs.set(a.Prefs3D.ANTIALIASING,t))},q.prototype.setGhosting=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGhosting is not applicable to 2D"):this.prefs.set(a.Prefs3D.GHOSTING,e)},q.prototype.setGroundShadow=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):this.prefs.set(a.Prefs3D.GROUND_SHADOW,e)},q.prototype.setGroundReflection=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):this.prefs.set(a.Prefs3D.GROUND_REFLECTION,e)},q.prototype.setEnvMapBackground=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):this.prefs.set(a.Prefs3D.ENV_MAP_BACKGROUND,e)},q.prototype.setFirstPersonToolPopup=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"):this.prefs.set(a.Prefs3D.FIRST_PERSON_TOOL_POPUP,e)},q.prototype.getFirstPersonToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.firstPersonToolPopup;o.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D")},q.prototype.setBimWalkToolPopup=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setBimWalkToolPopup is not applicable to 2D"):this.prefs.set(a.Prefs3D.BIM_WALK_TOOL_POPUP,e)},q.prototype.getBimWalkToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.bimWalkToolPopup;o.logger.warn("Viewer3D.getBimWalkToolPopup is not applicable to 2D")},q.prototype.setProgressiveRendering=function(e){this.prefs.set(a.Prefs.PROGRESSIVE_RENDERING,e)},q.prototype.setGrayscale=function(e){this.model&&this.model.is3d()?o.logger.warn("Viewer3D.setGrayscale is not applicable to 3D"):this.prefs.set(a.Prefs2D.GRAYSCALE,e)},q.prototype.setSwapBlackAndWhite=function(e){this.model&&this.model.is3d()?o.logger.warn("Viewer3D.setSwapBlackAndWhite is not applicable to 3D"):this.prefs.set(a.Prefs2D.SWAP_BLACK_AND_WHITE,e)},q.prototype.setOptimizeNavigation=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):this.prefs.set(a.Prefs3D.OPTIMIZE_NAVIGATION,e)},q.prototype.initializePrefListeners=function(){var e=this;this.prefs.addListeners(a.Prefs3D.ANTIALIASING,(function(t){var n=e.prefs.get(a.Prefs3D.AMBIENT_SHADOWS);e.impl.togglePostProcess(n,t)})),this.prefs.addListeners(a.Prefs3D.AMBIENT_SHADOWS,(function(t){var n=e.prefs.get(a.Prefs3D.ANTIALIASING);e.impl.togglePostProcess(t,n)})),this.prefs.addListeners(a.Prefs3D.GROUND_SHADOW,(function(t){e.impl.toggleGroundShadow(t)})),this.prefs.addListeners(a.Prefs3D.GROUND_REFLECTION,(function(t){e.impl.toggleGroundReflection(t)})),this.prefs.addListeners(a.Prefs3D.ENV_MAP_BACKGROUND,(function(t){e.impl.toggleEnvMapBackground(t)})),this.prefs.addListeners(a.Prefs.PROGRESSIVE_RENDERING,(function(t){e.impl.toggleProgressive(t)})),this.prefs.addListeners(a.Prefs2D.GRAYSCALE,(function(t){e.impl.toggleGrayscale(t)})),this.prefs.addListeners(a.Prefs2D.SWAP_BLACK_AND_WHITE,(function(t){e.impl.toggleSwapBlackAndWhite(t)})),this.prefs.addListeners(a.Prefs3D.OPTIMIZE_NAVIGATION,(function(t){e.impl.setOptimizeNavigation(t)})),this.prefs.addListeners(a.Prefs3D.GHOSTING,(function(t){e.impl.toggleGhosting(t)})),this.prefs.addListeners(a.Prefs3D.LINE_RENDERING,(function(t){e.impl.hideLines(!t)})),this.prefs.addListeners(a.Prefs.POINT_RENDERING,(function(t){e.impl.hidePoints(!t)})),this.prefs.addListeners(a.Prefs3D.EDGE_RENDERING,(function(t){e.impl.setDisplayEdges(t)})),this.prefs.addListeners(a.Prefs3D.LIGHT_PRESET,(function(t){if("string"==typeof t){for(var n=t,r=-1,i=0;i<z.LightPresets.length;i++)if(z.LightPresets[i].name===n){r=i;break}if(!(r>=0))return void o.logger.warn("Invalid Prefs3D.LIGHT_PRESET: "+t);t=r}e.impl.setLightPreset(t)})),this.prefs.addListeners(a.Prefs3D.ALWAYS_USE_PIVOT,(function(t){e.navigation.setUsePivotAlways(t)})),this.prefs.addListeners(a.Prefs.REVERSE_MOUSE_ZOOM_DIR,(function(t){e.navigation.setReverseZoomDirection(t)})),this.prefs.addListeners(a.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION,(function(t){e.navigation.setReverseHorizontalLookDirection(t)})),this.prefs.addListeners(a.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION,(function(t){e.navigation.setReverseVerticalLookDirection(t)})),this.prefs.addListeners(a.Prefs3D.ZOOM_TOWARDS_PIVOT,(function(t){e.navigation.setZoomTowardsPivot(t)})),this.prefs.addListeners(a.Prefs3D.ORBIT_PAST_WORLD_POLES,(function(t){e.navigation.setOrbitPastWorldPoles(t)})),this.prefs.addListeners(a.Prefs.LEFT_HANDED_MOUSE_SETUP,(function(t){e.navigation.setUseLeftHandedInput(t),f.EventUtils.setUseLeftHandedInput(t)})),this.prefs.addListeners(a.Prefs.WHEEL_SETS_PIVOT,(function(t){e.navigation.setWheelSetsPivot(t)})),this.prefs.addListeners(a.Prefs3D.SELECTION_MODE,(function(t){e.impl.selector.setSelectionMode(t)})),this.prefs.addListeners(a.Prefs.BACKGROUND_COLOR_PRESET,(function(t){if(t)try{var n=JSON.parse(t);e.impl.setClearColors(n[0],n[1],n[2],n[3],n[4],n[5])}catch(e){o.logger.warn("Invalid Prefs.BACKGROUND_COLOR_PRESET: "+n)}}))},q.prototype.setNavigationLock=function(e){this.navigation.getIsLocked()!==e&&(this.navigation.setIsLocked(e),this.dispatchEvent({type:E.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},q.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},q.prototype.setNavigationLockSettings=function(e){this.navigation.setLockSettings(e),this.dispatchEvent({type:E.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},q.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},q.prototype.setActiveNavigationTool=function(e){if(e===this._pushedTool||!e&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return(!e||e===this.getDefaultNavigationToolName())&&null===this._pushedTool?(this.dispatchEvent({type:E.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):!!this.impl.controls.activateTool(e)&&(this._pushedTool=e,this.dispatchEvent({type:E.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0)},q.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},q.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool);var t=this._pushedTool;this._pushedTool=null,t&&this.impl.controls.deactivateTool(t),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,t&&(this.impl.controls.activateTool(t),this._pushedTool=t)},q.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},q.prototype.getFOV=function(){return this.navigation.getVerticalFov()},q.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},q.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},q.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},q.prototype.hideLines=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.hideLines is not applicable to 2D"):this.prefs.set(a.Prefs3D.LINE_RENDERING,!e)},q.prototype.hidePoints=function(e){this.prefs.set(a.Prefs.POINT_RENDERING,!e)},q.prototype.setDisplayEdges=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setDisplayEdges is not applicable to 2D"):this.prefs.set(a.Prefs3D.EDGE_RENDERING,e)},q.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},q.prototype.fitToView=function(e,t,n){var r=[];e&&(e.length>0&&e[0].model?r=e:e.length>0&&r.push({model:t||this.model,selection:e})),this.impl.fitToView(r,n)},q.prototype.setClickConfig=function(e,t,n){var r=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in r){var i=r[e];if(t in i)return i[t]=n,!0}return!1},q.prototype.getClickConfig=function(e,t){var n=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in n){var r=n[e];if(t in r)return r[t]}return null},q.prototype.setClickToSetCOI=function(e,t){!1!==t&&this.prefs.set(a.Prefs3D.CLICK_TO_SET_COI,e);var n=this.getClickConfig("click","onObject");e?-1===n.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):n.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},q.prototype.setProfile=function(e){var t=this;if(!e)return!1;this.profile=e,this.profile.apply(this.prefs);var n=this.profile.extensions&&this.profile.extensions.unload||[],r=this.profile.extensions&&this.profile.extensions.load||[];n.forEach((function(e){t.isExtensionLoaded(e)&&t.unloadExtension(e)})),r.forEach((function(e){t.isExtensionLoaded(e)||t.loadExtension(e,t.config)})),this.dispatchEvent({type:Bimfish.Viewing.PROFILE_CHANGE_EVENT,profile:e})},q.prototype.initSettings=function(e){if(!this.profile){var t=new s.Profile(e);this.setProfile(t)}},q.prototype.setLightPreset=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setLightPreset is not applicable to 2D"):this.prefs.set(a.Prefs3D.LIGHT_PRESET,e)},q.prototype.setUsePivotAlways=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setUsePivotAlways is not applicable to 2D"):this.prefs.set(a.Prefs3D.ALWAYS_USE_PIVOT,e)},q.prototype.setReverseZoomDirection=function(e){this.prefs.set(a.Prefs.REVERSE_MOUSE_ZOOM_DIR,e)},q.prototype.setReverseHorizontalLookDirection=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):this.prefs.set(a.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION,e)},q.prototype.setReverseVerticalLookDirection=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):this.prefs.set(a.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION,e)},q.prototype.setZoomTowardsPivot=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setZoomTowardsPivot is not applicable to 2D"):this.prefs.set(a.Prefs3D.ZOOM_TOWARDS_PIVOT,e)},q.prototype.setOrbitPastWorldPoles=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):this.prefs.set(a.Prefs3D.ORBIT_PAST_WORLD_POLES,e)},q.prototype.setUseLeftHandedInput=function(e){this.prefs.set(a.Prefs.LEFT_HANDED_MOUSE_SETUP,e)},q.prototype.setLayerVisible=function(e,t,n){var r=this.impl.layers;null===e?t?r.showAllLayers():r.hideAllLayers():(Array.isArray(e)||(e=[e]),n&&r.hideAllLayers(),this.impl.setLayerVisible(e,t)),this.dispatchEvent({type:E.LAYER_VISIBILITY_CHANGED_EVENT})},q.prototype.isLayerVisible=function(e){return!!(e&&e.isLayer&&this.impl.isLayerVisible(e))},q.prototype.anyLayerHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,n=t?t.length:0,r=0;r<n;++r)if(!this.impl.layers.isLayerVisible(t[r]))return!0;return!1},q.prototype.allLayersHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,n=t?t.length:0,r=0;r<n;++r)if(this.impl.layers.isLayerVisible(t[r]))return!1;return!0},q.prototype.setGroundShadowColor=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(e)},q.prototype.setGroundShadowAlpha=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(e)},q.prototype.setGroundReflectionColor=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(e)},q.prototype.setGroundReflectionAlpha=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(e)},q.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(o.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},q.prototype.setCutPlanes=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlaneSet("__set_view",e)},q.prototype.getScreenShot=function(e,t,n,r){return k.ScreenShot.getScreenShotLegacy(this,e,t,n,r)},q.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},q.prototype.setDefaultContextMenu=function(){var e=Bimfish.Viewing.Extensions;return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},q.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},q.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},q.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},q.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},q.prototype.triggerSwipeCallback=function(e){this.config&&this.config.onTriggerSwipeCallback&&this.config.onTriggerSwipeCallback(e)},q.prototype.initContextMenu=function(){(!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var e=this,t=this.canvas||this.container;this.onMouseDown=function(t){f.EventUtils.isRightClick(t)&&(e.startX=t.clientX,e.startY=t.clientY)},t.addEventListener("mousedown",this.onMouseDown),this.onMouseUp=function(t){return f.EventUtils.isRightClick(t)&&t.clientX===e.startX&&t.clientY===e.startY&&e.triggerContextMenu(t),!0},t.addEventListener("mouseup",this.onMouseUp,!1)},q.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},q.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},q.prototype.runContextMenuCallbacks=function(e,t){for(var n in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(n)&&this.contextMenuCallbacks[n](e,t)},q.prototype.joinLiveReview=function(e){var t=this;this.liveReviewClient||(this.liveReviewClient=new C.LiveReviewClient(this)),S.theResourceLoader.loadScript("socket.io-1.3.5.js","lmv_io").then((function(){t.liveReviewClient.joinLiveReviewSession(e)}))},q.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},q.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},q.prototype.worldToClient=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.impl.camera;return this.impl.worldToClient(e,t)},q.prototype.clientToWorld=function(e,t,n){return this.impl.clientToWorld(e,t,n)},q.prototype.modelHasTopology=function(){return!(!this.model||!this.model.hasTopology())},q.prototype.setSelectionColor=function(e,t){this.impl.setSelectionColor(e,t)},q.prototype.set2dSelectionColor=function(e,t){this.impl.set2dSelectionColor(e,t)},q.prototype.setTheme=function(e){for(var t=this.container.classList,n=0;n<t.length;++n){-1!==t[n].indexOf("-theme")&&t.remove(t[n--])}t.add(e)},q.prototype.setThemingColor=function(e,t,n,r){(n=n||this.model).setThemingColor(e,t,r),this.impl.invalidate(!0)},q.prototype.setThemingColorArray=function(e,t,n){n=n||this.model;for(var r=0;r<e.length;++r)n.setThemingColor(e[r],t);this.impl.invalidate(!1,!0)},q.prototype.clearThemingColors=function(e){(e=e||this.model).clearThemingColors(),this.impl.invalidate(!1,!0)},q.prototype.clearThemingColorsByids=function(e,t){(e=e||this.model).clearThemingColorsByids(t),this.impl.invalidate(!1,!0)},q.prototype.transferModel=function(e,t){var n=this.impl.findModel(e);if(n){var r=[];this.getAggregateSelection((function(t,n){t.id==e&&r.push(n)}));var i=this.impl.visibilityManager.getIsolatedNodes(n),o=this.impl.visibilityManager.getHiddenNodes(n),s=this.impl.matman().exportModelMaterials(n),a=n.loader;n.loader=null,this.impl.unloadModel(n),n.loader=a,n.isAEC()&&n.is3d()&&t.impl.setLightPresetForAec(),t.impl.setRenderingPrefsFor2D(n.is2d()),t.impl.addModel(n),t.impl.matman().importModelMaterials(s,e),t._loadingSpinner.hide(),n.loader&&n.loader.viewer3DImpl===this.impl&&(n.loader.viewer3DImpl=t.impl),n.getData().loadDone&&t.impl.onLoadComplete(n),t.impl.selector.setSelection(r,n),0!=i.length?t.impl.visibilityManager.isolate(i,n):0!=o.length&&t.impl.visibilityManager.hide(o,n)}},q.prototype.hideModel=function(e){var t=this.impl.modelQueue();return!!(e="number"==typeof e?t.findModel(e):e)&&(this.impl.removeModel(e),t.addHiddenModel(e),!0)},q.prototype.showModel=function(e,t){var n=this.impl.modelQueue();return!!(e="number"==typeof e?n.findHiddenModel(e):e)&&(n.removeHiddenModel(e),this.impl.addModel(e,t),!0)},q.prototype.getVisibleModels=function(){return this.impl.modelQueue().getModels().slice()},q.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels().slice()},q.prototype.restoreDefaultSettings=function(){var e=this.model,t=e.is2d()?"2d":"3d";this.prefs.reset(t),this.impl.setupLighting(e),e.isAEC()&&e.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!e.is3d()),this.fireEvent({type:E.RESTORE_DEFAULT_SETTINGS_EVENT})},q.prototype.disableHighlight=function(e){this.impl.disableHighlight(e)},q.prototype.disableSelection=function(e){e&&this.clearSelection(),this.impl.disableSelection(e)},q.prototype.isHighlightDisabled=function(){return this.impl.selector.highlightDisabled},q.prototype.isHighlightPaused=function(){return this.impl.selector.highlightPaused},q.prototype.isHighlightActive=function(){return!(this.impl.selector.highlightDisabled||this.impl.selector.highlightPaused)},q.prototype.isSelectionDisabled=function(){return this.impl.selector.selectionDisabled},q.prototype.activateExtension=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].activate(t):(o.logger.warn("Extension is not loaded or doesn't exist"),!1)},q.prototype.deactivateExtension=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].deactivate():(o.logger.warn("Extension is not loaded or doesn't exist"),!1)},q.prototype.isExtensionActive=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].isActive(t):(o.logger.warn("Extension is not loaded or doesn't exist"),!1)},q.prototype.isExtensionLoaded=function(e){return this.loadedExtensions&&e in this.loadedExtensions},q.prototype.getLoadedExtensions=function(){return this.loadedExtensions||[]},q.prototype.getExtensionModes=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].getModes():(console.warn("Extension is not loaded or doesn't exist"),[])},q.prototype.reorderElements=function(e){var t=e.getAttribute("layer-order-id"),n=this.containerLayerOrder.indexOf(t),r=null;if(-1!==n)for(var i=n+1;i<this.containerLayerOrder.length&&!r;i++)r=this.container.querySelector('[layer-order-id="'+this.containerLayerOrder[i]+'"]');r?this.container.insertBefore(e,r):this.container.appendChild(e)},q.prototype.appendOrderedElementToViewer=function(e){var t=this.container.querySelector('[layer-order-id="'+e+'"]');if(t)return t;var n=this.getDocument().createElement("div");return n.setAttribute("layer-order-id",e),this.reorderElements(n),n},q.prototype.hitTest=function(e,t,n){return this.impl.hitTest(e,t,n)},q.prototype.refresh=function(e){this.impl.invalidate(e,!1,!e)},q.prototype.chooseProfile=function(e){var t=this.profileManager.PROFILE_DEFAULT;return this.config&&this.config.profileSettings?t=new s.Profile(this.config.profileSettings):e&&e.useFileProfile?t=this.profileManager.getProfileOrDefault(e.fileExt):e.isAEC&&(t=this.profileManager.PROFILE_AEC),t}},"./src/application/Viewer3DImpl.js":
/*!*****************************************!*\
  !*** ./src/application/Viewer3DImpl.js ***!
  \*****************************************/
/*! exports provided: InitParametersSetting, Viewer3DImpl */function(e,t,n){"use strict";n.r(t),n.d(t,"InitParametersSetting",(function(){return B})),n.d(t,"Viewer3DImpl",(function(){return U}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ./ScreenShot */"./src/application/ScreenShot.js"),o=n(/*! ./ProgressState */"./src/application/ProgressState.js"),s=n(/*! ../wgs/scene/RenderScene */"./src/wgs/scene/RenderScene.js"),a=n(/*! ../wgs/render/RenderContext */"./src/wgs/render/RenderContext.js"),l=n(/*! ../wgs/render/MaterialManager */"./src/wgs/render/MaterialManager.js"),c=n(/*! ../tools/Selector */"./src/tools/Selector.js"),u=n(/*! ../tools/VisibilityManager */"./src/tools/VisibilityManager.js"),d=n(/*! ./LightPresets */"./src/application/LightPresets.js"),h=n(/*! ../wgs/render/GroundShadow */"./src/wgs/render/GroundShadow.js"),f=n(/*! ../file-loaders/main/OtgResourceCache */"./src/file-loaders/main/OtgResourceCache.js"),p=n(/*! ../logger/Logger */"./src/logger/Logger.js"),m=n(/*! ../file-loaders/main/TextureLoader */"./src/file-loaders/main/TextureLoader.js"),g=n(/*! ../wgs/render/WebGLRenderer */"./src/wgs/render/WebGLRenderer.js"),v=n(/*! ../wgs/scene/RenderFlags */"./src/wgs/scene/RenderFlags.js"),y=n(/*! ../wgs/render/ShadowMap */"./src/wgs/render/ShadowMap.js"),_=n(/*! ../wgs/render/GroundFlags */"./src/wgs/render/GroundFlags.js"),b=n(/*! ../wgs/scene/ResetFlags */"./src/wgs/scene/ResetFlags.js"),x=n(/*! ../wgs/render/GroundReflection */"./src/wgs/render/GroundReflection.js"),w=n(/*! ./ModelLayers */"./src/application/ModelLayers.js"),E=n(/*! ../wgs/scene/FragmentList */"./src/wgs/scene/FragmentList.js"),A=n(/*! ../wgs/render/DecodeEnvMap */"./src/wgs/render/DecodeEnvMap.js"),M=n(/*! ../globals */"./src/globals.js"),S=n(/*! ../wgs/render/SAOShader */"./src/wgs/render/SAOShader.js"),T=n(/*! ../wgs/scene/VBIntersector */"./src/wgs/scene/VBIntersector.js"),C=n(/*! ../wgs/scene/VertexBufferReader */"./src/wgs/scene/VertexBufferReader.js"),P=n(/*! three */"./thirdparty/three.js/three.js"),L=n(/*! ../tools/UnifiedCamera */"./src/tools/UnifiedCamera.js"),D=n(/*! ./EventTypes */"./src/application/EventTypes.js"),R=n(/*! ../tools/Navigation */"./src/tools/Navigation.js"),I=n(/*! ./bubble */"./src/application/bubble.js"),j=n(/*! ../wgs/scene/SceneMath */"./src/wgs/scene/SceneMath.js"),O=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),N=n(/*! ./PreferenceNames */"./src/application/PreferenceNames.js"),k=null,F=Object(r.getGlobal)().ENABLE_DEBUG,V=Object(r.getGlobal)().ENABLE_DEBUG_RCS,B={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,devicePixelRatio:null};function U(e,t){var n=this;this.setGlobalManager(t.globalManager);var O,U,z,G,H,W,X,q,Y,K,Q,Z,J,$=1e3/15,ee=1e3/30,te=1,ne=-1,re=-1,ie=null,oe="y",se=null,ae=null,le=null,ce=!1,ue=!1,de=!1,he={type:D.PROGRESS_UPDATE_EVENT,state:o.ProgressState.LOADING,percent:0},fe=!1,pe=!1,me=!1,ge=0,ve=0,ye=1e3/60,_e=0,be=!0,xe=!1,we=!1,Ee=null,Ae=null;this.edgeColorMain=new P.Vector4(0,0,0,.3),this.edgeColorGhosted=new P.Vector4(0,0,0,.1);var Me,Se,Te,Ce=Object(r.getGlobal)(),Pe={},Le="",De=!0;function Re(e){var t=Me.phase,r=t==v.RenderFlags.RENDER_NORMAL,i=q.settings.idbuffer&&t!=v.RenderFlags.RENDER_HIDDEN,o=t==v.RenderFlags.RENDER_HIDDEN?n.edgeColorGhosted:n.edgeColorMain;q.setEdgeColor(o),t==v.RenderFlags.RENDER_HIDDEN?e.overrideMaterial=n.fadeMaterial:t==v.RenderFlags.RENDER_HIGHLIGHTED&&(e.overrideMaterial=n.highlightMaterial),q.renderScenePart(e,!0,r,i),e.overrideMaterial=null}function Ie(e){z&&(n.canvasBoundingclientRectDirty=!0,n.camera.aspect=G/H,n.camera.clientWidth=G,n.camera.clientHeight=H,q.setSize(G,H),n.controls.handleResize(),Z&&Z.setSize(G,H),n.invalidate(!0,!0,!0),z=!1,e||n.api.dispatchEvent({type:D.VIEWER_RESIZE_EVENT,width:G,height:H}))}function je(){var e;if((Q.enabled||Z)&&!n.is2d&&(e=n.model&&!n.model.isLoadDone()?n.model.getData().bbox:n.getVisibleBounds(!0,!1))){var t=n.camera,r=e.clone(),i=new P.Vector3(1,0,0),o=ae.clone();t.worldUpTransform&&(r.applyMatrix4(t.worldUpTransform),i.applyMatrix4(t.worldUpTransform),o.applyMatrix4(t.worldUpTransform)),r.min.y-=.005*(r.max.y-r.min.y),Y&&Y.expandByGroundShadow(r,o);var s=r.size(),a=r.center();if(Y||(s.x*=1.25,s.z*=1.25,s.x=s.z=Math.max(s.x,s.z)),t.worldUpTransform){var l=(new P.Matrix4).getInverse(t.worldUpTransform);a.applyMatrix4(l)}if(Q.setTransform(a,s,t.worldup,i),Z){var c=(new P.Vector3).subVectors(a,t.worldup.clone().multiplyScalar(s.y/2));Z.setTransform(c,t.worldup,s)}Y&&Y.setGroundShadowTransform(a,s,t.worldup,i)}}function Oe(){Y&&(Y.state=y.SHADOWMAP_NEEDS_UPDATE)}e&&(this.interval=setInterval((function(){be||_e<60||n.track({name:"fps",value:Number(n.fps().toFixed(2)),aggregate:"last"})}),3e4)),this.api=t,this.canvas=e,this.loader=null,this.canvasBoundingclientRectDirty=!0,this.nearRadius=0,this.initialize=function(){if(O=new P.Vector3(0,1,0),J=new s.RenderScene,(X=function(e){if(!e)return null;var t=n.getWindow().devicePixelRatio;t||(t=1);var r=B;r.canvas=e,r.devicePixelRatio=t;var i=new g.WebGLRenderer(r);return i.context?(i.autoClear=!1,i.sortObjects=!1,i):null}(e))||Object(r.isNodeJS)()){X&&(this.onWebGLcontextLost=this.onWebGLcontextLost.bind(this),X.webglcontextlost=this.onWebGLcontextLost),(q=new a.RenderContext).init(X,e?e.clientWidth:0,e?e.clientHeight:0),this.use2dInstancing=Object(r.isMobileDevice)()&&this.glrenderer().supportsInstancedArrays(),W=new l.MaterialManager(X),this.camera=new L.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],Ee=(new P.Color).setRGB(1,1,1),Ae=(new P.Color).setRGB(1,1,1),this.cameraChangedEvent={type:D.CAMERA_CHANGE_EVENT,camera:this.camera},se=new P.Vector3(1,1,1),ae=(new P.Vector3).copy(se),le=new P.Vector3(-1,0,1),this.scene=new P.Scene,this.sceneAfter=new P.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},ht(),this.createOverlayScene("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new P.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,W.addInstancingSupport(this.fadeMaterial),W.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.setSelectionColor(6724095),W.togglePolygonOffset(!0),q.setDepthMaterialOffset(W.getPolygonOffsetOn(),W.getPolygonOffsetFactor(),W.getPolygonOffsetUnits()),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=ee,this.frameDisplayRate=5,Object(r.isMobileDevice)()&&($*=2,ee*=2,this.targetFrameBudget/=2,this.frameDisplayRate/=2),this.interruptBudget=1e10,this.controls={update:function(e){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new c.MultiModelSelector(this),this.visibilityManager=new u.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var t=d.LightPresets[d.DefaultLightPreset].bgColorGradient;this.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5]),(Q=new h.GroundShadow(X)).enabled=!0,Me=new We,W.addMaterialNonHDR("groundShadowDepthMaterial",Q.getDepthMaterial()),W.addOverrideMaterial("normalsMaterial",q.getDepthMaterial()),W.addOverrideMaterial("edgeMaterial",q.getEdgeMaterial()),q.beginScene(this.scene,this.camera,this.noLights,!0),q.composeFinalFrame(!0,r.isIE11)}},this.renderGroundShadow=function(e){Y?Y.state==y.SHADOWMAP_VALID&&Y.renderGroundShadow(n.camera,e||q.getColorTarget()):(Q.renderShadow(n.camera,e||q.getColorTarget()),Q.rendered=!0)};var Ne,ke,Fe,Ve=0,Be=1,Ue=2,ze=4,Ge=8,He=15;function We(){this.highResTimeStamp=-1,this.screenDrawn=Ve,this.screenHasChanged=!1,this.frameBudget=0,this.frameRemaining=0,this.phase=v.RenderFlags.RENDER_NORMAL,this.signalProgressByRendering=!1,this.tickCount=0,this.beginFrameAvg=0,this.lastBeginFrameTimeStamp=0,this.RENDERMODE_FULL=0,this.RENDERMODE_PROGRESSIVE=1,this.RENDERMODE_SILENT=2,this.renderType=this.RENDERMODE_FULL,this.INITIAL_GROUND_SHADOW=.2,this.cmdListActive=!1,this.cmdIndex=0,this.continueExecution=!0,this.encounteredAlwaysDo=!1,this.finishedFullRender=!0,this.groundShadowInPost=!1,this.drawOverlay=!1,this.cmdIsOpen=!1,this.allocArraySize=0,this.cmdListLength=0,this.cmdList=[],this.paramList=[],this.CMD_NORMAL_SEQUENCE=0,this.CMD_DO_AFTER=1,this.CMD_ALWAYS_DO=2,this.isActive=function(){return this.cmdListActive},this.setFrame=function(e){this.frameBudget=e},this.beginCommandSet=function(){this.cmdListActive=!0,this.cmdIndex=0,this.cmdListLength=0,this.encounteredAlwaysDo=!1,this.tickCount=0,this.screenDrawn=Ve,this.screenHasChanged=!1},this.endCommandSet=function(){this.cmdIsOpen&&(this.cmdIsOpen=!1,this.cmdListLength++)},this._internalSetParam=function(e,t){this.paramList[this.cmdIndex][e]=t},this.addCommand=function(e,t){for(this.cmdIsOpen&&this.cmdListLength++,this.cmdIsOpen=!0;this.allocArraySize<=this.cmdListLength;)this.cmdList[this.cmdListLength]={},this.paramList[this.cmdListLength]={},this.allocArraySize++;return this.cmdList[this.cmdListLength]=e,this.paramList[this.cmdListLength].executionLevel=t||this.CMD_NORMAL_SEQUENCE,this.encounteredAlwaysDo=this.encounteredAlwaysDo||t===this.CMD_ALWAYS_DO,this.cmdListLength},this.setParam=function(e,t){this.cmdIsOpen?this.paramList[this.cmdListLength][e]=t:F&&p.logger.error("ERROR: cannot set param when no command is open!")},this.getParam=function(e){return F&&void 0===this.paramList[this.cmdIndex][e]&&p.logger.error("ERROR: parameter "+e+" was never set for this command! Go fix it."),this.paramList[this.cmdIndex][e]},this.executeCommandList=function(){if(Me.cmdListActive){var e;if(this.tickCount>0&&(Me.lastBeginFrameTimeStamp=0),this.frameRemaining=this.frameBudget,F&&this.cmdIsOpen&&p.logger.error("ERROR: should call endCommandSet before executing"),this.continueExecution=!0,V&&(0===this.tickCount&&console.log("==================="),console.log("Running commands for "+(Me.renderType===Me.RENDERMODE_PROGRESSIVE?"progressive":Me.renderType===Me.RENDERMODE_FULL?"full":"silent")+" render, for tick count "+this.tickCount)),this.encounteredAlwaysDo)for(var t=0;t<this.cmdIndex;)this.paramList[t].executionLevel>=Me.CMD_ALWAYS_DO&&(V&&console.log("  ALWAYS DO command "+t+": "+this.cmdList[t].name),this.cmdList[t]()),t++;for(;this.cmdIndex<this.cmdListLength;)(this.continueExecution||this.paramList[this.cmdIndex].executionLevel>=Me.CMD_DO_AFTER)&&(V&&console.log("  command "+this.cmdIndex+": "+this.cmdList[this.cmdIndex].name+" and "+Me.frameRemaining+" frame budget remaining"),this.cmdList[this.cmdIndex]()&&(V&&console.log("  >>> out of tick time with "+Me.frameRemaining),e=this.cmdIndex,this.continueExecution=!1)),this.cmdIndex++;return this.continueExecution?this.cmdListActive=!1:this.cmdIndex=e,this.tickCount++,!this.continueExecution}return Me.lastBeginFrameTimeStamp=0,!0}}function Xe(){if(Me.renderType===Me.RENDERMODE_PROGRESSIVE)if(Me.getParam("GenerateGroundShadow.afterBeauty")){if(Me.frameRemaining=Q.prepareGroundShadow(n.modelQueue(),0,Me.frameRemaining),Q.getStatus()==_.GroundFlags.GROUND_RENDERED){if(Me.getParam("GenerateGroundShadow.signalRedraw"))return n.requestSilentRender(),V&&console.log(" $$$$ SIGNAL FULL GROUND SHADOW REDRAW"),!0;Me.groundShadowInPost=!0}}else 0===Me.tickCount&&Q.prepareGroundShadow(n.modelQueue(),10);else Me.frameRemaining=Q.prepareGroundShadow(n.modelQueue(),0,Me.frameRemaining);return Me.frameRemaining<0&&Q.getStatus()===_.GroundFlags.GROUND_UNFINISHED}function qe(){return Q.getStatus()!==_.GroundFlags.GROUND_UNFINISHED&&n.renderGroundShadow(),!1}function Ye(){return Me.renderType===Me.RENDERMODE_PROGRESSIVE?Me.getParam("GenerateGroundReflection.afterBeauty")?(Me.frameRemaining=Z.prepareGroundReflection(Q,n,!1,0,Me.frameRemaining),Z.getStatus()==_.GroundFlags.GROUND_RENDERED&&(Me.screenDrawn|=Ge,Me.groundShadowInPost&&W.hasTransparentMaterial()&&n.requestDeferredSilentRender())):0===Me.tickCount&&Z.prepareGroundReflection(Q,n,!0,10):Me.frameRemaining=Z.prepareGroundReflection(Q,n,!1,0,Me.frameRemaining),Me.frameRemaining<0&&Z.getStatus()===_.GroundFlags.GROUND_UNFINISHED}function Ke(){if(Y.state===y.SHADOWMAP_NEEDS_UPDATE)Me.frameRemaining=Y.startUpdate(J,Me.frameRemaining,n.camera,ae,W);else if(Y.state==y.SHADOWMAP_INCOMPLETE&&(Me.frameRemaining=Y.continueUpdate(J,Me.frameRemaining,W),Y.state==y.SHADOWMAP_VALID))return n.requestSilentRender(),V&&console.log(" $$$$ SIGNAL FULL SHADOW MAP REDRAW"),!0;return Me.frameRemaining<0&&Y.state!==y.SHADOWMAP_VALID}function Qe(){Y.state=y.SHADOWMAP_NEEDS_UPDATE}function Ze(){if(Me.signalProgressByRendering&&n.signalProgress(0,o.ProgressState.RENDERING),Me.renderType===Me.RENDERMODE_PROGRESSIVE){if(Me.lastBeginFrameTimeStamp>0){var e=Me.highResTimeStamp-Me.lastBeginFrameTimeStamp;Me.beginFrameAvg=.75*Me.beginFrameAvg+.25*e}Me.lastBeginFrameTimeStamp=Me.highResTimeStamp,Me.beginFrameAvg<ee&&Me.frameBudget<$?(n.targetFrameBudget+=1,n.targetFrameBudget>$&&(n.targetFrameBudget=$)):Me.beginFrameAvg>ee&&Me.frameBudget>te&&(n.targetFrameBudget*=.75+.25*ee/Me.beginFrameAvg,n.targetFrameBudget<te&&(n.targetFrameBudget=te))}n.updateCameraMatrices();var t=Me.getParam("BeginScene.clear");return q.beginScene(n.scene,n.camera,n.lightsOn?n.lights:n.no_lights,t),t&&(Me.screenDrawn|=Ue),Me.getParam("BeginScene.signalCameraChanged")&&n.api.dispatchEvent(n.cameraChangedEvent),!1}function Je(){return Me.phase=Me.getParam("BeginPhase.phase"),V&&console.log("     render phase is now "+Me.phase),J.reset(n.camera,Me.phase,Me.getParam("BeginPhase.moved"),W.getCutPlanes()),!1}function $e(){return J.isEmpty()||J.isDone()||(Me.screenDrawn|=Be,Me.frameRemaining=J.renderSome(Re,Me.frameRemaining),Me.signalProgressByRendering&&(n.signalProgress(100*J.getRenderProgress(),o.ProgressState.RENDERING),V&&console.log("  %%% percent done "+100*J.getRenderProgress()))),!J.isDone()}function et(){return Me.phase=v.RenderFlags.RENDER_FINISHED,q.renderScenePart(n.sceneAfter,!0,!0,!0),!1}function tt(){return Me.phase=v.RenderFlags.RENDER_FINISHED,!1}function nt(){n.signalProgress(100,o.ProgressState.RENDERING)}function rt(){return n.isOverlayDirty()&&(n.clearOverlayDirtyFlag(),Me.drawOverlay=!0),Me.drawOverlay&&(!J.isEmpty()&&J.isDone()||n.showOverlaysWhileMoving?(n.renderOverlays(),Me.screenDrawn|=ze):(q.clearAllOverlays(),Me.drawOverlay=!1)),!1}function it(){Me.screenDrawn|=He}function ot(){if(Me.screenDrawn&&(Me.phase===v.RenderFlags.RENDER_FINISHED||Me.tickCount%n.frameDisplayRate==0)){var e=!Me.getParam("PostAndPresent.performAO")||(Me.screenDrawn&(Ue|Be))==Ue;q.composeFinalFrame(e),Me.screenHasChanged=!0,Me.screenDrawn=Ve,t=Me.highResTimeStamp,_e++,ve<=t&&ve>0&&(ye=.8*ye+.2*(t-ve)),n.fpsCallback&&n.fpsCallback(n.fps()),n.api.dispatchEvent({type:D.RENDER_PRESENTED_EVENT})}var t;return!1}function st(){return F&&!1===q.getAOEnabled()&&p.logger.error("AO should be on at this point!"),q.setAOEnabled(!1),!1}function at(){return F&&!0===q.getAOEnabled()&&p.logger.error("AO should be off at this point!"),q.setAOEnabled(!0),!1}function lt(){return n.requestSilentRender(),!1}function ct(){return Me.finishedFullRender=!0,!1}this.tick=function(e){Me.highResTimeStamp=e=e||0;var t=W.updateMaterials();n.invalidate(t.needsClear,t.needsRender,t.overlayDirty);var r=function(e){if(n.keyFrameAnimator){var t=ve>0?(e-ve)/1e3:0,r=n.keyFrameAnimator.update(t);if(r&&(n.sceneUpdated(!0),r&n.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}(e),i=n.controls.update(e),o=J&&J.update(e),s=i||r||K||o;K=!1;var a=z;Ie(),ce=ce||s;var l=!1;(de=de||s)?function(e){for(var t in n.selectionMeshes){var r=n.selectionMeshes[t];if(r.model){var i=r.model.getFragmentList();r.geometry===i.getGeometry(r.fragId)&&i.getWorldMatrix(r.fragId,r.matrix)}}}():q.overlayUpdate()&&!de&&(de=l=!0);var c=n.model&&n.model.loader&&n.model.loader.pagingProxy&&n.model.loader.pagingProxy.getMemoryInfo();Me.signalProgressByRendering=n.model&&n.model.isLoadDone()&&!n.model.getData().isLeaflet&&!c,fe&&(je(),Q.setDirty(),fe=!1,1)&&(ce=!0);var u=ce,d=J.frameResumePossible();if(ce=ce||!d,me=me||pe&&!Me.cmdListActive,ce||ue||de||me)if(Me.drawOverlay=de,ce||ue||me){var h,f=u?b.ResetFlags.RESET_RELOAD:b.ResetFlags.RESET_NORMAL;ce||ue?(n.progressiveRender?(Me.renderType=Me.RENDERMODE_PROGRESSIVE,h=n.targetFrameBudget):(Me.renderType=Me.RENDERMODE_FULL,h=n.interruptBudget),ce&&(pe=me=!1)):(Me.renderType=Me.RENDERMODE_SILENT,h=n.targetFrameBudget,ce=!0,f=b.ResetFlags.RESET_REDRAW,pe=me=!1),Me.setFrame(h),Me.finishedFullRender=!1,Me.beginCommandSet();var p=Q.enabled&&!n.is2d&&!be,m=!!Z&&!n.is2d&&!be,g=s||a,_=s&&n.skipAOWhenMoving&&q.getAOEnabled();Me.addCommand(Ze),Me.setParam("BeginScene.signalCameraChanged",g),Me.setParam("BeginScene.clear",ce),_&&Me.addCommand(st,Me.CMD_ALWAYS_DO),J&&(Y&&Y.state!==y.SHADOWMAP_VALID&&Me.addCommand(Ke),p&&(Me.addCommand(Xe),Me.setParam("GenerateGroundShadow.afterBeauty",!1),Me.setParam("GenerateGroundShadow.signalRedraw",!1)),m?(Z.setDirty(),Me.addCommand(Ye),Me.setParam("GenerateGroundReflection.afterBeauty",!1)):p&&ce&&Me.addCommand(qe),J.hasHighlighted()&&(Me.addCommand(Je),Me.setParam("BeginPhase.phase",v.RenderFlags.RENDER_HIGHLIGHTED),Me.setParam("BeginPhase.moved",f),f=!1,Me.addCommand($e)),Me.addCommand(Je),Me.setParam("BeginPhase.phase",v.RenderFlags.RENDER_NORMAL),Me.setParam("BeginPhase.moved",f),f=!1,Me.addCommand($e),!J.areAllVisible()&&n.showGhosting?(m&&Me.renderType===Me.RENDERMODE_PROGRESSIVE||(Me.addCommand(Je),Me.setParam("BeginPhase.phase",v.RenderFlags.RENDER_HIDDEN),Me.setParam("BeginPhase.moved",f),Me.addCommand($e)),Me.addCommand(et)):Me.addCommand(et),Me.signalProgressByRendering&&Me.addCommand(nt)),Me.addCommand(rt,Me.renderType===Me.RENDERMODE_PROGRESSIVE?Me.CMD_DO_AFTER:Me.CMD_NORMAL_SEQUENCE),Me.addCommand(ot,Me.renderType===Me.RENDERMODE_PROGRESSIVE?Me.CMD_DO_AFTER:Me.CMD_NORMAL_SEQUENCE),Me.setParam("PostAndPresent.performAO",q.getAOEnabled()&&!_),Me.renderType===Me.RENDERMODE_PROGRESSIVE&&J&&(Y&&Y.state!==y.SHADOWMAP_VALID&&(Me.addCommand(Qe),Me.addCommand(Ke)),p&&(Me.addCommand(Xe),Me.setParam("GenerateGroundShadow.afterBeauty",!0),Me.setParam("GenerateGroundShadow.signalRedraw",!m),Me.signalProgressByRendering&&Me.addCommand(nt)),m&&(Me.groundShadowInPost=!1,Me.addCommand(Ye),Me.setParam("GenerateGroundReflection.afterBeauty",!0),!J.areAllVisible()&&n.showGhosting&&(Me.addCommand(Je),Me.setParam("BeginPhase.phase",v.RenderFlags.RENDER_HIDDEN),Me.setParam("BeginPhase.moved",f),Me.addCommand($e)),Me.addCommand(tt),Me.addCommand(ot),Me.setParam("PostAndPresent.performAO",q.getAOEnabled()&&!_),Me.signalProgressByRendering&&Me.addCommand(nt))),_&&(Me.addCommand(at,Me.CMD_ALWAYS_DO),Me.addCommand(lt)),Me.addCommand(ct),Me.endCommandSet(),ce=!1,ue=!1,de=!1}else Me.finishedFullRender&&(Me.beginCommandSet(),V&&console.log("=====\nOVERLAY DIRTY"),l?Me.addCommand(it):Me.addCommand(rt,!0),Me.addCommand(ot,!0),Me.setParam("PostAndPresent.performAO",q.getAOEnabled()),Me.endCommandSet(),de=!1);Te=Me.cmdListActive,Me.executeCommandList(),Te!==De&&(n.api.dispatchEvent({type:D.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!Te}}),De=Te),ve=Me.highResTimeStamp},this.setLmvDisplay=function(e){Ce=e},this.run=function(){U=0,setTimeout((function(){!function e(t){U=Ce.requestAnimationFrame(e),n.tick(t)}()}),1)},this.stop=function(){n.getWindow().cancelAnimationFrame(U)},this.toggleProgressive=function(e){this.progressiveRender=e,ce=!0},this.updateClearColors=function(){var e=this.clearColorTop;if(this.is2d&&this.swapBlackAndWhite){var t=1===e.x&&1===e.y&&1===e.z,n=0===e.x&&0===e.y&&0===e.z;t?e=new P.Color(0,0,0):n&&(e=new P.Color(1,1,1))}q.setClearColors(e,this.clearColorBottom)},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,this.updateClearColors(),ce=!0},this.toggleGrayscale=function(e){W.setGrayscale(e),ce=!0},this.toggleGhosting=function(e){this.showGhosting=e,ce=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){q.initPostPipeline(e,t),this.fireRenderOptionChanged(),ce=!0},this.toggleGroundShadow=function(e){Q.enabled!==e&&(Q.enabled=e,Q.clear(),e&&Q.setDirty(),je(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.isGroundShadowEnabled=function(){return Q&&Q.enabled},this.setGroundShadowColor=function(e){Q.enabled&&(Q.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){Q.enabled&&(Q.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(e){e&&Z||!e&&!Z||(e?((Z=new x.GroundReflection(X,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:q.getClearPass()})).setClearColors(this.clearColorTop,this.clearColorBottom,Object(r.isMobileDevice)()),Z.toggleEnvMapBackground(xe),Z.setEnvRotation(q.getEnvRotation()),je()):(Z.cleanup(),Z=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){Z&&(Z.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){Z&&(Z.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){xe=e,q.toggleEnvMapBackground(e),Z&&Z.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return xe},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.renderOverlays=function(){!function(){for(var e in n.selectionMeshes){var t=n.selectionMeshes[e];t.model&&t.model.isConsolidated()&&t.model.updateRenderProxy(t,t.fragId)}}();var e,t=this.lightsOn;t||this.toggleLights(!0,!0),this.dir_light1&&(e=this.dir_light1.intensity,this.dir_light1.intensity=1),q.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),t||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=e)},this.setLayerVisible=function(e,t){this.layers.setLayerVisible(e,t)},this.isLayerVisible=function(e){return this.layers.isLayerVisible(e)},this.getVisibleLayerIndices=function(){return this.layers.getVisibleLayerIndices()},this.setNearRadius=function(e,t){this.nearRadius!==e&&(this.nearRadius=e,t&&this.invalidate(!0))},this.getNearRadius=function(){return this.nearRadius},this.updateNearFarValues=function(e,t){if(Fe||(Ne=new P.Matrix4,ke=new P.Matrix4,Fe=new P.Box3),Ne.compose(e.position,e.quaternion,e.scale),ke.getInverse(Ne),Fe.copy(t),Z){var n=new P.Vector3;n.multiplyVectors(Fe.max,e.worldup);var r=new P.Vector3;r.multiplyVectors(Fe.min,e.worldup),n.sub(r),n.x>=0?Fe.min.x-=n.x:Fe.max.x-=n.x,n.y>=0?Fe.min.y-=n.y:Fe.max.y-=n.y,n.z>=0?Fe.min.z-=n.z:Fe.max.z-=n.z}Y&&Y.groundShapeBox&&Fe.union(Y.groundShapeBox),Fe.applyMatrix4(ke);var i=1e-5*(Fe.max.z-Fe.min.z),o=.5*(Fe.max.y-Fe.min.y),s=-(Fe.max.z+i)-o,a=-(Fe.min.z-i)+o;e.isPerspective&&(this.nearRadius>0?(s=Math.max(s,Math.min(this.nearRadius,1e-4*Math.abs(a-s))),a=Math.min(a,1e4*s)):(s=Math.max(s,Math.min(1,1e-4*Math.abs(a-s))),a<0&&(a=1e-4),s=Math.max(s,1e-5*a))),a=Math.max(a,s),e.near=s,e.far=a,e.updateProjectionMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld)},this.getPixelsPerUnit=function(e,t){var n=q.settings.deviceHeight,r=this.model.is2d(),i=W.getCutPlanesRaw()[0],o=this.model.getBoundingBox();return j.SceneMath.getPixelsPerUnit(e,r,t,n,i,o)},this.updateCameraMatrices=function(){var e=this.camera;if(e.worldup&&this.setWorldUp(e.worldup),this.model){var t=this.getVisibleBounds(!0,de);this.updateNearFarValues(e,t);var n=this.getPixelsPerUnit(e,t);this.model.is2d()?(W.updatePixelScale(n,q.settings.deviceWidth,q.settings.deviceHeight),W.updateSwapBlackAndWhite(this.swapBlackAndWhite)):W.updatePixelScale(n,q.settings.deviceWidth,q.settings.deviceHeight)}},this.initLights=function(){this.dir_light1=new P.DirectionalLight(Ee,1),this.dir_light1.position.copy(le),this.amb_light=new P.AmbientLight(Ae),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),we=!0};function ut(e){return W._getMaterialHash(e,"selection2d")}function dt(){if(!Object(r.isMobileDevice)()){var e=J.getModels().length;q.setIdTargetCount(e)&&W.toggleMRTSetting(q.mrtFlags())}}this.toggleLights=function(e,t){this.amb_light&&(this.lightsOn=e,function(e,t,n,r){var i=d.LightPresets[ne],o=i&&i.ambientColor,s=i&&i.directLightColor;o=o||Ae.toArray(),s=s||Ee.toArray(),n?(r&&e?e.color.setRGB(.5*s[0],.5*s[1],.5*s[2]):e&&e.color.setRGB(o[0],o[1],o[2]),t&&t.color.setRGB(s[0],s[1],s[2])):e&&r&&e.color.setRGB(o[0],o[1],o[2])}(this.amb_light,this.dir_light1,e,t))},this.syncCamera=function(e){this.camera.updateCameraMatrices(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),K=!0},this.setViewFromFile=function(e,t){if(e){var n,r=e.getDefaultCamera();n=r||L.UnifiedCamera.getViewParamsFromBox(e.getBoundingBox(),e.is2d(),this.camera.aspect,this.camera.up,this.camera.fov);var i=e.getMetadata("navigation hint","value",null),o=this.controls.isToolActivated("freeorbit")||t&&"Freeorbit"===i;this.setViewFromCamera(n,t,o)}},this.adjustOrthoCamera=function(e){if(!e.isPerspective&&this.model){var t=this.model.getBoundingBox(),n=t.size(),r=e.target.clone().sub(e.position),i=r.length();if(i>1e3*n.length()){var o=e.position.distanceTo(t.center());e.target.copy(e.position).add(r.normalize().multiplyScalar(o))}else{if(Math.abs(i-e.orthoScale)/i>1e-5)p.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?"),!(0===e.fov&&1===e.orthoScale)&&e.position.copy(e.target).add(r.normalize().multiplyScalar(-e.orthoScale))}}},this.setViewFromCamera=function(e,t,n){this.adjustOrthoCamera(e);var r,i=this.model?this.model.getUpVector():null;r=i?(new P.Vector3).fromArray(i):n?e.up.clone():R.Navigation.snapToAxis(e.up.clone()),n?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",r.equals(e.up)):e.up=r;var o=this.api.navigation;if(o){var s=this.camera;if(t)s.up.copy(e.up),s.position.copy(e.position),s.target.copy(e.target),e.isPerspective?s.fov=e.fov:(s.saveFov=e.fov,s.fov=L.UnifiedCamera.ORTHO_FOV),s.isPerspective=e.isPerspective,s.orthoScale=e.orthoScale,s.dirty=!0,o.setWorldUpVector(n?r:s.up),o.setView(s.position,s.target),o.setPivotPoint(s.target),this.syncCamera(!0);else if(s.isPerspective=e.isPerspective,e.isPerspective||(s.saveFov=e.fov,e.fov=L.UnifiedCamera.ORTHO_FOV),n)o.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,r);else{var a=this.model.getData().bbox;if(!a.containsPoint(e.target)){var l=a.center().distanceTo(e.position),c=e.target.clone().sub(e.position).normalize().multiplyScalar(l);e.target.copy(e.position.clone().add(c))}var u=o.computeOrthogonalUp(e.position,e.target);o.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,u,r)}}K=!0},this.getViewArrayFromCamera=function(e){var t,n=e||{x:0,y:0,z:0},r=this.camera,i=this.model.getUpVector();t=i?(new P.Vector3).fromArray(i):R.Navigation.snapToAxis(r.up.clone());var o=this.api.navigation.getPivotPoint();return[r.position.x+n.x,r.position.y+n.y,r.position.z+n.z,o.x+n.x,o.y+n.y,o.z+n.z,t.x,t.y,t.z,r.aspect,P.Math.degToRad(r.fov),r.orthoScale,r.isPerspective?0:1]},this.setViewFromViewBox=function(e,t,n,r){if(e.is2d()){var i={},o=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]};s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2;var a=this.camera.aspect;a>s.aspect?i.orthoScale=s.height:i.orthoScale=s.width/a,i.isPerspective=!1,i.position=new P.Vector3(s.centerX,s.centerY,o.center().z+i.orthoScale),i.target=new P.Vector3(s.centerX,s.centerY,o.center().z),i.target.y+=1e-6*s.height,i.up=new P.Vector3(0,0,1),this.setViewFromCamera(i,r,!1)}},this.setWorldUp=function(e){if(!O.equals(e)){O.copy(e);var t=Math.abs(e.x);oe="x",Math.abs(e.y)>t&&(oe="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(oe="z");var r,i,o,s,a=new P.Vector3(0,1,0);n.camera.worldUpTransform=(r=a,i=e,o=(new P.Vector3).crossVectors(i,r).normalize(),s=Math.acos(r.dot(i)),(new P.Matrix4).makeRotationAxis(o,s)),this.sceneUpdated(!1)}},this.addModel=function(e,t){if(e){var r=!!this.model,i=e.is2d();if(this.model||e.getData().underlayRaster||(this.model=e,q.setUnitScale(e.getUnitScale())),this.layers||(this.layers=new w.ModelLayers(this)),e.getData().underlayRaster||this.layers.addModel(e,!0),J.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),this.api.fireEvent({type:D.MODEL_ADDED_EVENT,model:e,preserveTools:t}),this._setModelPreferences(e),i){var o=e.getData();o.layerCount&&W.initLayersTexture(o.layerCount,o.layersMap,e.id);var s=W.create2DMaterial(null,{},!0,!1,(function(){n.invalidate(!1,!0,!1)})),a=W.findMaterial(null,s);if(r||(this.is2d&&q.exit2DMode(),q.enter2DMode(a,!e.getData().isLeaflet,this.matman().get2dSelectionColor())),!r){this.is2d||this.saveLightPreset(),this.is2d=!0,this.setLightPreset(d.DefaultLightPreset2d);var l=e.getData();if(l.hidePaper){var c=l.bgColor,u=c>>16&255,h=c>>8&255,f=255&c;this.setClearColors(u,h,f,u,h,f)}}}else!r&&this.is2d&&(this.is2d=void 0,q.exit2DMode());this.updateClearColors(),this.setupLighting(e),dt(),this.fireRenderOptionChanged(),this.invalidate(!0)}},this._setModelPreferences=function(e){e.hideLines(!this.api.prefs.lineRendering),e.hidePoints(!this.api.prefs.pointRendering),e.selector.setSelectionMode(this.api.prefs.get(N.Prefs3D.SELECTION_MODE))},this.setupLighting=function(e){e=e||this.model,Object(r.isNodeJS)()||!e||e.is2d()||(this.setLightPresetFromFile(e)||(re>=0?(this.setLightPreset(re,!0,ie),re=-1,ie=null):this.setLightPreset(ne,!1)),this.setAOHeuristics(e))},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return W},this.setupMesh=function(e,t,n,r){var i={geometry:t,matrix:r,isLine:t.isLines,isWideLine:t.isWideLines,isPoint:t.isPoints,is2d:t.is2d};return n&&(i.material=this.matman().setupMaterial(e,t,n)),i},this.init2dSelection=function(e){var t=ut(e);if(!this.overlayScenes[t]){var r=W.initSelectionTexture(e.getData().maxObjectNumber,e.id),i=W.create2DMaterial(e,{},!1,r,(function(){n.invalidate(!1,!0,!1)})),o=W.findMaterial(e,i);this.createOverlayScene(t,o)}},this.onLoadComplete=function(e){be=!1,this.signalProgress(100,o.ProgressState.LOADING),this.modelVisible(e.id)&&((Q&&Q.enabled||Z)&&this.sceneUpdated(!1,!0),this.invalidate(!!Z,!0,!1)),this.is2d&&e.is2d()&&this.init2dSelection(e);var t=e.getGeometryList();t&&t.printStats(),e.hasGeometry()?W.hasTransparentMaterial()&&this.requestSilentRender():p.logger.warn("Loaded model has no geometry."),this.handleInitialVisibility(e),this.api.dispatchEvent({type:D.GEOMETRY_LOADED_EVENT,model:e})},this.onTextureLoadComplete=function(e){this.api.dispatchEvent({type:D.TEXTURES_LOADED_EVENT,model:e}),this.requestSilentRender()},this.signalProgress=function(e,t,n){he.percent===e&&he.state===t&&n&&he.model&&he.model.id===n.id||(he.percent=e,he.state=t,n&&(he.model=n),this.api.dispatchEvent(he))},this.resize=function(e,t,n){z=!0,G=e,H=t,n&&Ie(!0)},this.unloadModel=function(e){(this.removeModel(e)||J.removeHiddenModel(e))&&(e.dtor(this.glrenderer()),W.cleanup(e),e.loader&&(e.loader.dtor(),e.loader=null),e.is2d()&&this.overlayScenes[e.id]&&this.removeOverlayScene(ut(e)),this.api.dispatchEvent({type:D.MODEL_UNLOADED_EVENT,model:e}))},this._addLoadingFile=function(e){this.loaders||(this.loaders=[]),this.loaders.push(e)},this._removeLoadingFile=function(e){if(this.loaders){var t=this.loaders.indexOf(e);t>=0&&this.loaders.splice(t,1)}},this.removeModel=function(e){return!!J.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),this.selector.removeModel(e),this.visibilityManager.removeModel(e),this.layers.removeModel(e),e===this.model&&(this.model=null,J.isEmpty()||(this.model=J.getModels()[0])),dt(),this.invalidate(!0,!0,!0),this.api.fireEvent({type:D.MODEL_REMOVED_EVENT,model:e}),!0)},this.cancelLoad=function(e){if(this.loaders)for(var t=0;t<this.loaders.length;t++){var n=this.loaders[t];if(n.currentLoadPath===e){n.dtor(),this.loaders.splice(t,1);break}}},this.unloadCurrentModel=function(){this.model&&(this.is2d?(this.is2d=void 0,this.removeOverlayScene(ut(this.model)),q.exit2DMode()):re=ne,q.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),q.composeFinalFrame(!0)),this.loaders&&(this.loaders.forEach((function(e){e.dtor()})),this.loaders=[]);for(var e=J.getModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t]);this.model=null};var ht=function(){var e,t,r;n.selectionMaterialBase=new P.MeshPhongMaterial({specular:526344,ambient:0,opacity:1,transparent:!1}),n.selectionMaterialTop=new P.MeshPhongMaterial({specular:526344,ambient:0,opacity:.15,transparent:!0}),n.selectionMaterialTop.packedNormals=!0,n.selectionMaterialBase.packedNormals=!0,e="selection",t=n.selectionMaterialBase,r=n.selectionMaterialTop,t.depthWrite=!1,t.depthTest=!0,t.side=P.DoubleSide,r.depthWrite=!1,r.depthTest=!0,r.side=P.DoubleSide,W.addInstancingSupport(t),W.addInstancingSupport(r),n.createOverlayScene(e,t,r),n.highlightMaterial=new P.MeshPhongMaterial({specular:526344,ambient:0,opacity:1,transparent:!1}),n.highlightMaterial.packedNormals=!0,W.addInstancingSupport(n.highlightMaterial),W.addMaterial("__highlightMaterial__",n.highlightMaterial,!0)};this.createOverlayScene=function(e,t,n,r){t&&W.addOverrideMaterial(e+"_pre",t),n&&W.addOverrideMaterial(e+"_post",n);var i=new P.Scene;i.__lights=this.scene.__lights,this.overlayScenes[e]={scene:i,camera:r,materialName:e,materialPre:t,materialPost:n}},this.removeOverlayScene=function(e){if(this.overlayScenes[e]){var t=this.overlayScenes[e];t.materialPre&&W.removeMaterial(t.materialName+"_pre"),t.materialPost&&W.removeMaterial(t.materialName+"_post"),delete this.overlayScenes[e],this.invalidate(!1,!1,!0)}},this.addOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0))},this.addMultipleOverlays=function(e,t){for(var n in t)t.hasOwnProperty(n)&&this.addOverlay(e,t[n])},this.removeOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.remove(t),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){for(var n in t)t.hasOwnProperty(n)&&this.removeOverlay(e,t[n])},this.clearOverlay=function(e){if(this.overlayScenes[e]){var t,n,r=this.overlayScenes[e].scene;for(n=r.children.length-1;n>=0;--n)(t=r.children[n])&&r.remove(t);this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,n,i,o,s){this.clearColorTop=new P.Vector3(e/255,t/255,n/255),this.clearColorBottom=new P.Vector3(i/255,o/255,s/255),this.updateClearColors(),Z&&Z.setClearColors(this.clearColorTop,this.clearColorBottom,Object(r.isMobileDevice)()),ce=!0,this.fireRenderOptionChanged()},this.setClearAlpha=function(e){q.setClearAlpha(e)};var ft=new P.Box3;function pt(e,t){t.updateMatrixWorld(!0),t.traverse((function(t){var n=t.geometry;void 0!==n&&t.visible&&(n.boundingBox||n.computeBoundingBox(),ft.copy(n.boundingBox),ft.applyMatrix4(t.matrixWorld),e.union(ft))}))}var mt,gt=new P.Box3;function vt(e,t,n,r){var i=e.getFragmentList().getVizmesh(t);new C.VertexBufferReader(i.geometry).enumGeomsForVisibleLayer(n,r)}function yt(e,t,n,r){var i=e.getFragmentList().getVizmesh(t);new C.VertexBufferReader(i.geometry).enumGeomsForObject(n,r)}this.getVisibleBounds=function(e,t){var r=new P.Box3;return J.isEmpty()||(pt(r,this.scene),r=J.getVisibleBounds(e).union(r),t&&(r=function(){var e=n.overlayScenes;for(var t in e)e.hasOwnProperty(t)&&pt(gt,e[t].scene);return pt(gt,n.scene),pt(gt,n.sceneAfter),gt}().union(r))),r},this.getFitBounds=function(e){var t;return e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.empty()||(t=this.getVisibleBounds()),t},this.getRenderProxy=function(e,t){return e.getFragmentList().getVizmesh(t)},this.getLayersRoot=function(){return this.layers.getRoot()},this.getFragmentProxy=function(e,t){return new E.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(e){return!J||J.areAllVisible()},this.isNodeVisible=function(e,t){return this.visibilityManager.isNodeVisible(t,e)},this.highlightObjectNode=function(e,t,n,r){t=e.reverseMapDbId(t),e.is2d()&&(W.highlightObject2D(t,n,e.id),this.invalidate(!1,!1,!0)),this.renderer().setDbIdForEdgeDetection(n&&!r?t:0,n?e.id:0);var i=this,o=e.getData().instanceTree;if(o&&!e.is2d())o.enumNodeFragments(t,(function(t){i.highlightFragment(e,t,n,r)}),!1);else{var s=t;if(e.is2d()&&(s=e.getData().fragments.dbId2fragId[t]),Array.isArray(s))for(var a=0;a<s.length;a++)i.highlightFragment(e,s[a],n,r);else i.highlightFragment(e,s,n,r)}},this.highlightFragment=function(e,t,n,r){var i=this.getRenderProxy(e,t);if(i){var o=!r||i.is2d||i.isPoint||i.themingColor,s=e.id+":"+t;if(o){var a="selection";if(e.is2d()&&(a=ut(e)),i.isPoint&&(a+="_points"),n)if(i.is2d&&this.selectionMeshes.hasOwnProperty(s))++this.selectionMeshes[s]._lmv_highlightCount;else{var l;if(!i||!i.geometry)return;if(i.isPoint){var c=i.material.clone();c.color=this.selectionMaterialBase.color,c.needsUpdate=!0,l=new P.Mesh(i.geometry,c)}else l=new P.Mesh(i.geometry,i.material);l.matrix.copy(i.matrixWorld),l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!0,l.frustumCulled=!1,l.model=e,l.fragId=t,l._lmv_highlightCount=1,this.addOverlay(a,l),this.selectionMeshes[s]=l}else if(this.selectionMeshes.hasOwnProperty(s)){var u=this.selectionMeshes[s];--u._lmv_highlightCount<=0&&(this.removeOverlay(a,u),delete this.selectionMeshes[s])}}o&&n||e.setHighlighted(t,n)&&this.invalidate(!0)}},this.explode=function(e){return(e=Number(e))!=ge&&(ge=e,J.explode(e),this.sceneUpdated(!0),this.api.dispatchEvent({type:D.EXPLODE_CHANGE_EVENT,scale:e}),!0)},this.getExplodeScale=function(){return ge},this.lockExplode=function(e,t,n){var r=(n=n||this.model).getData().instanceTree;if(!r)return!1;var i,o=function(e,n){return r.enumNodeChildren(n,(function(n){e=r.lockNodeExplode(n,t)||e}),!0),e};return(i=Array.isArray(e)?e.reduce(o,!1):o(!1,e))&&ge>0&&(J.explode(ge),this.sceneUpdated(!0)),i},this.isExplodeLocked=function(e,t){var n=(t=t||this.model).getData().instanceTree;return n&&n.isNodeExplodeLocked(e)},this.setGhostingBrightness=function(e){var t=new P.Color(e?1052688:16777215);function n(e){e.color=t}n(this.fadeMaterial),this.fadeMaterial.variants&&this.fadeMaterial.variants.forEach(n)},this.loadCubeMapFromColors=function(e,t){var n=Object(A.CreateCubeMapFromColors)(e,t);return n.isBgColor=!0,W.setReflectionMap(n),n},this.loadCubeMap=function(e,t){this._reflectionMapPath=e;return m.TextureLoader.loadCubeMap(e,t,(function(t){e===n._reflectionMapPath&&W&&(W.setReflectionMap(t),n.invalidate(!0),t?d.LightPresets[ne].useIrradianceAsBackground||q.setCubeMap(t):n.loadCubeMapFromColors(n.clearColorTop,n.clearColorBottom))}))},this.loadIrradianceMap=function(e,t){this._irradianceMapPath=e;return m.TextureLoader.loadCubeMap(e,t,(function(t){e===n._irradianceMapPath&&W&&(W.setIrradianceMap(t),n.invalidate(!0),d.LightPresets[ne].useIrradianceAsBackground&&q.setCubeMap(t))}))},this.setLightPreset=function(e,t,n){if(Object(r.isNodeJS)()&&(e=0),we||this.initLights(),ne!==e||t){if((e<0||d.LightPresets.length<=e)&&(e=d.DefaultLightPreset),ne=e,J.isEmpty())return re=ne,void(ie=n);var i=d.LightPresets[e],o=i.bgColorGradient;if(o||(o=d.BackgroundPresets.Custom),this.setClearColors(o[0],o[1],o[2],o[3],o[4],o[5]),void 0!==i.useIrradianceAsBackground&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?p.logger.debug("setLightPreset(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(i.useIrradianceAsBackground))),i.path){var s="res/environments/"+i.path,a=Object(M.getResourceUrl)(s+"_mipdrop."+(i.type||"")+".dds"),l=Object(M.getResourceUrl)(s+"_irr."+(i.type||"")+".dds");this.loadIrradianceMap(l,i.E_bias),this.loadCubeMap(a,i.E_bias),W.setEnvExposure(-i.E_bias),q.setEnvExposure(-i.E_bias),this.setTonemapExposureBias(i.E_bias),this.setTonemapMethod(i.tonemap),this.setGhostingBrightness(i.darkerFade)}else{var c=this.loadCubeMapFromColors(this.clearColorTop,this.clearColorBottom);q.setCubeMap(c),W.setIrradianceMap(null),W.setEnvExposure(-i.E_bias||0),q.setEnvExposure(-i.E_bias||0),this.setTonemapExposureBias(i.E_bias||0),this.setTonemapMethod(i.tonemap||0),this.setGhostingBrightness(i.darkerFade),q.toggleEnvMapBackground(xe),this.invalidate(!0)}var u=S.SAOShader.uniforms.radius.value,h=S.SAOShader.uniforms.intensity.value;i.hasOwnProperty("saoRadius")&&(u=i.saoRadius),i.hasOwnProperty("saoIntensity")&&(h=i.saoIntensity),q.setAOOptions(u,h);var f=1;null!==i.lightMultiplier&&void 0!==i.lightMultiplier&&(f=i.lightMultiplier),ae.copy(se),i.lightDirection&&ae.fromArray(i.lightDirection).negate(),Y&&Oe(),this.dir_light1&&(this.dir_light1.intensity=f,i.lightDirection?this.dir_light1.position.set(-i.lightDirection[0],-i.lightDirection[1],-i.lightDirection[2]):this.dir_light1.position.copy(le)),W.setEnvRotation(i.rotation||0),q.setEnvRotation(i.rotation||0),Z&&Z.setEnvRotation(i.rotation||0),this.toggleLights(0!==f),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged(),n&&n()}else n&&n()},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;var t,n=e.getMetadata("renderEnvironmentGroundReflection","value",null);t=this.api.prefs.hasTag(N.Prefs3D.GROUND_REFLECTION,"ignore-producer"),null===n||t||(this.api.prefs.tag("no-storage",N.Prefs3D.GROUND_REFLECTION),this.api.setGroundReflection(n));var i=e.getMetadata("renderEnvironmentGroundShadow","value",null);t=this.api.prefs.hasTag(N.Prefs3D.GROUND_SHADOW,"ignore-producer"),null===i||t||(this.api.prefs.tag("no-storage",N.Prefs3D.GROUND_SHADOW),this.api.setGroundShadow(i));var o=e.getMetadata("renderEnvironmentAmbientShadows","value",null);t=this.api.prefs.hasTag(N.Prefs3D.AMBIENT_SHADOWS,"ignore-producer"),null===o||t||(this.api.prefs.tag("no-storage",N.Prefs3D.AMBIENT_SHADOWS),this.api.setQualityLevel(o,q.getAntialiasing()));var s=e.getMetadata("renderEnvironmentDisplayLines","value",null);t=this.api.prefs.hasTag(N.Prefs3D.LINE_RENDERING,"ignore-producer"),null===s||t||(this.api.prefs.tag("no-storage",N.Prefs3D.LINE_RENDERING),this.api.hideLines(!s));var a=e.getMetadata("renderEnvironmentDisplayPoints","value",null);t=this.api.prefs.hasTag(N.Prefs.POINT_RENDERING,"ignore-producer"),null===a||t||(this.api.prefs.tag("no-storage",N.Prefs.POINT_RENDERING),this.api.hidePoints(!a));var l=e.getMetadata("renderEnvironmentDisplayEdges","value",null);t=this.api.prefs.hasTag(N.Prefs3D.EDGE_RENDERING,"ignore-producer"),null===l||t||(this.api.prefs.tag("no-storage",N.Prefs3D.EDGE_RENDERING),this.api.setDisplayEdges(!Object(r.isMobileDevice)()&&!!l));var c=e.getMetadata("renderEnvironmentStyle","value",null),u=d.LightPresets.filter((function(e){return e.name===c}))[0];if(t=this.api.prefs.hasTag(N.Prefs3D.LIGHT_PRESET,"ignore-producer"),u&&!t){this.api.prefs.tag("no-storage",N.Prefs3D.LIGHT_PRESET);var h=k;h||(h=k={},d.LightPresets.push(h)),Object(d.copyLightPreset)(u,h),h.name="(Custom: Model defined)";var f=e.getMetadata("renderEnvironmentExposureBias","value",null),p=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==f&&null!==p&&(h.E_bias=f+p);var m=e.getMetadata("renderEnvironmentBackgroundColor","value",null);t=this.api.prefs.hasTag(N.Prefs.BACKGROUND_COLOR_PRESET,"ignore-producer"),m&&!t&&(h.bgColorGradient=[255*m[0],255*m[1],255*m[2],255*m[0],255*m[1],255*m[2]]);var g=e.getMetadata("renderEnvironmentRotation","value",null);null!==g&&(h.rotation=g);var v=d.LightPresets.indexOf(h);this.setLightPreset(v,!0)}var y=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return t=this.api.prefs.hasTag(N.Prefs3D.ENV_MAP_BACKGROUND,"ignore-producer"),null===y||t||(this.api.prefs.tag("no-storage",N.Prefs3D.ENV_MAP_BACKGROUND),this.api.setEnvMapBackground(y)),u},this.setLightPresetForAec=function(){for(var e=Object(r.getGlobal)().DefaultLightPresetAec||"Boardwalk",t=-1,n=0;n<d.LightPresets.length;n++)if(d.LightPresets[n].name===e){t=n;break}return t>=0&&(this.api.prefs.hasTag("lightPreset","ignore-producer")?p.logger.debug("setLightPresetForAec(): lightPreset is locked. No changes."):(this.api.prefs.tag("no-storage","lightPreset"),this.setLightPreset(t,!0,function(){this.api.prefs.tag("ignore-producer","envMapBackground")}.bind(this)),this.saveLightPreset())),this.api.prefs.hasTag("edgeRendering","ignore-producer")?p.logger.debug("setLightPresetForAec(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!Object(r.isMobileDevice)())),!0},this.setAOHeuristics=function(e){var t=e.getUnitScale(),n=e.getMetadata("renderEnvironmentAmbientShadows","radius",void 0),r=e.getMetadata("renderEnvironmentAmbientShadows","intensity",void 0),i=e.getMetadata("renderEnvironmentAmbientShadows","opacity",void 0);if(void 0!==n||void 0!==r||void 0!==i)q.setAOOptions(n/t,r,i);else if(e.isAEC()){t>.3?q.setAOOptions(4/t,1,.625):q.setAOOptions(.25/t,1,.625)}else{var o=e.getData().bbox.size().length();q.setAOOptions(Math.min(10,.05*o))}},this.setTonemapMethod=function(e){e!=q.getToneMapMethod()&&(q.setTonemapMethod(e),W.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=q.getExposureBias()&&(q.setTonemapExposureBias(e),W.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setRenderingPrefsFor2D=function(e){if(!Object(r.isNodeJS)()){var t=!e&&!!this.api.prefs.envMapBackground;this.toggleEnvMapBackground(t)}},this.dtor=function(){n.getWindow().cancelAnimationFrame(U),this.api.removeEventListener(D.MODEL_ROOT_LOADED_EVENT,void 0),this.api.removeEventListener(D.MODEL_UNLOADED_EVENT,void 0),this.unloadCurrentModel(),this.controls=null,this.canvas=null,clearInterval(this.interval),this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.layers=null,this.visibilityManager=null,Se&&(Se.dtor(),Se=null),J=null,q=null,W.dtor(),W=null,X&&(X.webglcontextlost=null)},this.hideLines=function(e){J&&!J.isEmpty()&&(J.hideLines(e),this.sceneUpdated(!0))},this.hidePoints=function(e){J&&!J.isEmpty()&&(J.hidePoints(e),this.sceneUpdated(!0))},this.setDisplayEdges=function(e){q.toggleEdges(e);var t=e;e||(t=!(!this.model||!this.model.getData().hasLines)),W.togglePolygonOffset(t),q.setDepthMaterialOffset(W.getPolygonOffsetOn(),W.getPolygonOffsetFactor(),W.getPolygonOffsetUnits()),this.invalidate(!0)},this.getAllCutPlanes=function(){var e=void 0;for(var t in Pe){var n=Pe[t];n&&n.length&&(e=e?t===Le?n.concat(e):e.concat(n):n)}return e},this.updateCutPlanes=function(){var e=this.getAllCutPlanes();this.setCutPlanes(e)},this.setCutPlaneSet=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Pe[e]=t?t.slice():void 0,n)this.updateCutPlanes();else{var r=this.getAllCutPlanes();this.setCutPlanesInScene(r)}},this.setCutPlaneSetFor2DRendering=function(e){Le=e,this.updateCutPlanes()},this.getCutPlaneSet=function(e){return Pe[e]||[]},this.getCutPlaneSets=function(){var e=[];for(var t in Pe){var n=Pe[t];n&&n.length&&e.push(t)}return e},this.getCutPlanes=function(){return W.getCutPlanes()},this.setCutPlanesInScene=function(e){q.toggleTwoSided(W.setCutPlanes(e)),this.sceneUpdated()},this.setCutPlanes=function(e){this.setCutPlanesInScene(e),this.api.dispatchEvent({type:D.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){W.toggleMRTSetting(q.mrtFlags()),this.api.dispatchEvent({type:D.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(e,t){var n=this.camera;e.z=-1;var r=new P.Vector3(e.x,e.y,1);return e=e.unproject(n),(r=r.unproject(n)).sub(e).normalize(),t||(t=new P.Ray),t.set(n.isPerspective?n.position:e,r),t},this.rayIntersect=function(e,t,n,r,i){for(var o=J.rayIntersect(e.origin,e.direction,t,n,r,i),s=[this.scene,this.sceneAfter],a=0;a<s.length;a++){var l=s[a];if(l.children.length){var c=new P.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far);pt(gt,l),c.linePrecision=Math.min(1,.5*gt.size().length()*.001);var u=i||[];T.VBIntersector.intersectObject(l,c,u,!0),u.length&&(!o||u[0].distance<o.distance)&&(o=u[0])}}return o?(void 0===o.dbId&&void 0!==o.fragId&&(o.dbId=o.model.getFragmentList().getDbIds(o.fragId),o.model.getData().instanceTree||(o.dbId=o.fragId)),o.intersectPoint=o.point,o):null},this.castRayViewport=function(e,t,n,r,i){return mt=mt||new P.Ray,J?(this.viewportToRay(e,mt),this.rayIntersect(mt,t,n,r,i)):{}},this.getCanvasBoundingClientRect=function(){return this.canvasBoundingclientRectDirty&&(this.canvasBoundingclientRectDirty=!1,this.boundingClientRect=this.canvas.getBoundingClientRect()),this.boundingClientRect},this.clientToViewport=function(e,t){var n=this.getCanvasBoundingClientRect();return new P.Vector3((e+.5)/n.width*2-1,-(t+.5)/n.height*2+1,1)},this.viewportToClient=function(e,t){var n=this.getCanvasBoundingClientRect();return new P.Vector3(.5*(e+1)*n.width-.5,-.5*(t-1)*n.height-.5,0)},this.castRay=function(e,t,n){return this.castRayViewport(this.clientToViewport(e,t),n)},this.intersectGroundViewport=function(e){var t="z";this.is2d||(t=oe);var n=this.model&&this.model.getBoundingBox();return j.SceneMath.intersectGroundViewport(e,this.camera,t,n)},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this._2dHitTestViewport=function(e,t,n){var r=[0,0],i=q.idAtPixels(e.x,e.y,t,r);if(i<n)return null;var o=J.findModel(r[1])||this.model;if(!o)return null;var s=this.intersectGroundViewport(e),a=o.getData().fragments,l=a?a.dbId2fragId[i]:-1;return{intersectPoint:s,dbId:o.remapDbId(i),fragId:l,model:o}},this.hitTestViewport=function(e,t,i,o,s){var a;if(n.is2d){var l=Object(r.isMobileDevice)()?45:5;a=this._2dHitTestViewport(e,l,1)}else a=this.castRayViewport(e,t,i,o,s);return a},this.hitTest=function(e,t,r,i){return n.hitTestViewport(this.clientToViewport(e,t),r,i)},this.snappingHitTestViewport=function(e,t){var i;if(this.model&&this.model.getData().isLeaflet)i={intersectPoint:this.intersectGroundViewport(e)};else if(n.is2d){var o=Object(r.isMobileDevice)()?45:17;i=this._2dHitTestViewport(e,o,0)}else{var s=q.idAtPixel(e.x,e.y);i=this.castRayViewport(e,t,s>0?[s]:null)}return i},this.snappingHitTest=function(e,t,n){return this.snappingHitTestViewport(this.clientToViewport(e,t),n)},this.clearHighlight=function(){q.rolloverObjectId(-1),this.invalidate(!1,!1,!0)},this.rolloverObjectViewport=function(e){if(!this.model||!this.model.getData().isLeaflet){var t=q.idAtPixel(e.x,e.y);this.selector&&this.selector.isNodeSelectionLocked(t,this.model)?this.clearHighlight():q.rolloverObjectViewport(e.x,e.y)&&this.invalidate(!1,!1,!0)}},this.rolloverObject=function(e,t){this.selector.highlightPaused||this.selector.highlightDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.pauseHighlight=function(e){this.selector.highlightPaused=e,e&&this.clearHighlight()},this.disableHighlight=function(e){this.selector.highlightDisabled=e,e&&this.clearHighlight()},this.disableSelection=function(e){this.selector.selectionDisabled=e},this.cancelLeafletScreenshot=function(){n.api.dispatchEvent({type:D.CANCEL_LEAFLET_SCREENSHOT})},this.getScreenShotProgressive=function(e,t,n,r){return i.ScreenShot.getScreenShot(e,t,n,r,this)},this.modelQueue=function(){return J},this.glrenderer=function(){return X},this.renderer=function(){return q},this.geomCache=function(){return Se||(Se=new f.OtgResourceCache(n.api)),Se},this.shadowMaps=function(){return Y},this.worldUp=function(){return O},this.worldUpName=function(){return oe},this.setUserRenderContext=function(e,t){q=e||new a.RenderContext,t||(q.init(X,this.canvas.clientWidth,this.canvas.clientHeight),q.setClearColors(this.clearColorTop,this.clearColorBottom)),this.invalidate(!0),this.sceneUpdated(!1)},this.setUserGroundShadow=function(e){var t=Q;return Q=e,t},this.invalidate=function(e,t,n){ce=e||ce,ue=t||ue,de=n||de},this.isOverlayDirty=function(){return de},this.clearOverlayDirtyFlag=function(){de=!1},this.sceneUpdated=function(e,t){this.invalidate(!t,!1,!t),J&&e&&(J.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),fe=!0,Oe()},this.requestSilentRender=function(){pe=me=!0},this.requestDeferredSilentRender=function(){pe=!0},this.currentLightPreset=function(){return ne},this.saveLightPreset=function(){re=ne},this.matman=function(){return W},this.fps=function(){return 1e3/ye},this.setFPSTargets=function(e,t,n){$=1e3/n,te=1,ee=1e3/t,this.targetFrameBudget=Object(r.isMobileDevice)()?ee/4:ee},this.track=function(e){p.logger.track(e)},this.worldToClient=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.camera,n=new P.Vector4(e.x,e.y,e.z,1);return n.applyMatrix4(t.matrixWorldInverse),n.applyMatrix4(t.projectionMatrix),n.w>0&&(n.x/=n.w,n.y/=n.w,n.z/=n.w),this.viewportToClient(n.x,n.y)},this.clientToWorld=function(e,t,n){var r=null,i=this.model,o=i.getData();if(i.is2d()){var s=this.intersectGround(e,t);if(s){s.z=0;var a=o.bbox;(o.hidePaper||a.containsPoint(s))&&(r={point:s,model:i})}}else(r=this.hitTest(e,t,n))&&(r.point=r.intersectPoint);return r},this.set2dSelectionColor=function(e,t){this.matman().set2dSelectionColor(e,t),this.invalidate(!1,!1,!0)},this.setSelectionColor=function(e,t){t=t||c.SelectionType.MIXED;var n=new P.Color(e);n.multiplyScalar(.5);var r=function t(r){r.color.set(e),r.emissive.set(n),r.variants&&r.variants.forEach(t)};switch(t){default:case c.SelectionType.MIXED:r(this.selectionMaterialBase),r(this.selectionMaterialTop),q.setSelectionColor(e),r(this.highlightMaterial),this.invalidate(!0);break;case c.SelectionType.REGULAR:r(this.highlightMaterial),this.invalidate(!0);break;case c.SelectionType.OVERLAYED:r(this.selectionMaterialBase),r(this.selectionMaterialTop),q.setSelectionColor(e),this.invalidate(!1,!1,!0)}},this.updateViewportId=function(e){W.updateViewportId(e),this.invalidate(!0)},this.findModel=function(e,t){var n;n="number"==typeof e?function(t){return t.id==e}:e instanceof I.BubbleNode?function(t){return t.getDocumentNode()==e}:e;var r=J.getModels().find(n);return t&&!r&&(r=J.getHiddenModels().find(n)),r},this.getFrameRate=function(){return this.frameDisplayRate},this.setFrameRate=function(e){this.frameDisplayRate=e<1?1:e},this.setShadowLightDirection=function(e){ae.copy(e),Oe(),this.invalidate(!0,!1,!1),je()},this.getShadowLightDirection=function(e){var t=e||new P.Vector3;return t.copy(ae),t},this.toggleShadows=function(e){!!Y!=!!e&&(e?Y=new y.ShadowMaps(X):(Y.cleanup(W),Y=null),je(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(e){J.enableNonResumableFrames=e},this.fitToView=function(e,t){(t=!!t,0===e.length)&&(e=J.getModels().map((function(e){return{model:e,selection:[]}})));for(var n=0,r=0,i=0;i<e.length;++i){var o=e[i].model;if(!o)return!1;o.is2d()?n++:r++}var s=!1;if(r===e.length)s=this._fitToView3d(e,t);else{if(n!==e.length)return p.logger.warn("Hybrid 2d/3d fitToView() not supported."),!1;s=this._fitToView2d(e,t)}return!!s&&(1===J.getModels().length&&this.api.dispatchEvent({type:D.FIT_TO_VIEW_EVENT,nodeIdArray:e[0].selection,immediate:t,model:e[0].model}),this.api.dispatchEvent({type:D.AGGREGATE_FIT_TO_VIEW_EVENT,selection:e,immediate:t}),!0)},this._fitToView2d=function(e,t){e.length>1&&p.logger.warn("fitToView() doesn't support multiple 2D models. Using the first one...");var n=e[0].model,r=e[0].selection,i=new P.Box3,o=new C.BoundsCallback(i);if(r&&0!==r.length)for(var s=n.getData().fragments.dbId2fragId,a=0;a<r.length;a++){var l=n.reverseMapDbId(r[a]),c=s[l];if(Array.isArray(c))for(var u=0;u<c.length;u++)yt(n,c[u],l,o);else"number"==typeof c&&yt(n,c,l,o)}else if(this.api.anyLayerHidden()){var d=n.getData().fragments,h=this.getVisibleLayerIndices();for(a=0;a<d.length;a++)vt(n,a,h,o)}else i=this.getFitBounds(!0);return!i.empty()&&(this.api.navigation.fitBounds(t,i),!0)},this._fitToView3d=function(e,t){for(var n=!1,r=0;r<e.length;++r)if(e[r].selection.length>0){n=!0;break}var i=new P.Box3,o=new P.Box3;if(n)for(var s=0;s<e.length;++s){var a=e[s].selection;if(0!==a.length){var l=e[s].model,c=l.getInstanceTree(),u=l.getFragmentList();if(c)for(var d=0;d<a.length;++d){var h=parseInt(a[d]);c.enumNodeFragments(h,(function(e){u.getWorldBounds(e,o),i.union(o)}),!0)}}}else i.union(this.getVisibleBounds(!1,!1));return!i.empty()&&(this.api.navigation.fitBounds(t,i),!0)},this.onWebGLcontextLost=function(e){this.api.fireEvent({type:D.WEBGL_CONTEXT_LOST_EVENT})},this.modelVisible=function(e){return!!J.findModel(e)},this.handleInitialVisibility=function(e){var t=this.api;e.getObjectTree((function(n){var r=e.getFragmentList();if(!r.areAllVisible()){var i=[];n&&(n.enumNodeChildren(e.getRootId(),(function(e){n.enumNodeFragments(e,(function(e){return r.isFragVisible(e)}),!0)||i.push(e)}),!0),i.length&&t.hide(i,e))}}))},this._signalNoMeshes=function(){J.isEmpty()&&(this._geometryAvailable=0)},this._signalMeshAvailable=function(){0===this._geometryAvailable&&(this._geometryAvailable=1,this.api.fireEvent({type:D.RENDER_FIRST_PIXEL}))},this.hasModels=function(){return!J.isEmpty()}}U.prototype.constructor=U,O.GlobalManagerMixin.call(U.prototype)},"./src/application/ViewerState.js":
/*!****************************************!*\
  !*** ./src/application/ViewerState.js ***!
  \****************************************/
/*! exports provided: ViewerState */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerState",(function(){return a}));var r=n(/*! ../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ./LightPresets */"./src/application/LightPresets.js"),o=n(/*! ../wgs/scene/SceneMath */"./src/wgs/scene/SceneMath.js");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){this.getVisibleModel=function(t){for(var n=e.getVisibleModels(),r=0;r<n.length;++r){var i=n[r];if(this.getSeedUrn(i)===t)return i}},this.createObjectSets=function(t){var n=t.objectSet;Array.isArray(n)||(t.objectSet=n=[]);for(var r=e.getVisibleModels(),i=0;i<r.length;i++){var o=r[i],s=this.getSeedUrn(o),a=this.getSelectedNodes(o);n[i]={id:a,idType:"lmv"},r.length>1&&(n[i].seedUrn=s),o.is2d()?(n[i].isolated=this.getVisibleLayers2d(o),n[i].allLayers=this.areAllLayersVisible(o),n[i].hidden=[]):(n[i].isolated=e.getIsolatedNodes(o),n[i].hidden=e.getHiddenNodes(o),n[i].explodeScale=e.getExplodeScale())}},this.getState=function(t){var n=e.navigation,r={};r.seedURN=this.getSeedUrn(),this.createObjectSets(r);var i=r.viewport;i||(i=r.viewport={});var o=n.getCamera().isPerspective;i.name="",i.eye=n.getPosition().toArray(),i.target=n.getTarget().toArray(),i.up=n.getCameraUpVector().toArray(),i.worldUpVector=n.getWorldUpVector().toArray(),i.pivotPoint=n.getPivotPoint().toArray(),i.distanceToOrbit=n.getPivotPlaneDistance(),i.aspectRatio=this.getAspectRatio(),i.projection=o?"perspective":"orthographic",i.isOrthographic=!o,o?i.fieldOfView=n.getVerticalFov():i.orthographicHeight=this.getOrthographicHeight();var s=r.renderOptions;if(s||(s=r.renderOptions={}),s.environment=this.getEnvironmentName(),s.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},s.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},s.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.ambientShadows,antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.progressiveRendering,swapBlackAndWhite:e.prefs.swapBlackAndWhite,displayLines:e.prefs.lineRendering,displayPoints:e.prefs.pointRendering},e.model&&!e.model.is2d())for(var a=r.cutplanes=[],l=e.impl.getCutPlaneSet("__set_view"),c=0;c<l.length;c++)a.push(l[c].toArray());for(var u in e.loadedExtensions){var d=e.loadedExtensions[u];d.getState&&d.getState(r)}return t&&!0!==t&&this.applyFilter(r,t),r},this.restoreObjectSet=function(t){var n=t.objectSet;if(Array.isArray(n)&&0!==n.length){for(var r=[],i=[],o=[],s=e.model,a=0;a<n.length;++a){var l=n[a];if("lmv"===l.idType){var c=l.seedUrn;if(!c||(s=this.getVisibleModel(c))){var u=l.id;if(u&&(u=this.toIntArray(u),o.push({model:s,ids:u})),s.is2d()){var d=l.isolated;if(Array.isArray(d)&&d.length>0){e.setLayerVisible(null,!1);for(var h=0;h<d.length;++h)d[h]=parseInt(d[h]);e.impl.setLayerVisible(d,!0)}else l.allLayers||e.setLayerVisible(null,!1)}else{var f=l.isolated||[],p=l.hidden||[];f=this.toIntArray(f),r.push({model:s,ids:f}),0===f.length&&p.length>0&&(p=this.toIntArray(p),i.push({model:s,ids:p}))}if("explodeScale"in l){var m=parseFloat(l.explodeScale);e.explode&&e.explode(m)}}}}o.length>0&&e.impl.selector.setAggregateSelection(o),r.length>0&&e.impl.visibilityManager.aggregateIsolate(r,{hideLoadedModels:!1}),i.length>0&&e.impl.visibilityManager.aggregateHide(i)}},this.restoreState=function(t,n,i){if(!t)return r.logger.warn("restoreState has no viewer state to restore from."),!1;if(!e||!e.model)return r.logger.warn("restoreState has no viewer or model to restore."),!1;n&&!0!==n&&(t=JSON.parse(JSON.stringify(t)),this.applyFilter(t,n));var o=e.navigation,s=!e.model.is2d();this.restoreObjectSet(t);var a=t.viewport;if(a){var l=this.getVector3FromArray(a.eye,o.getPosition()),c=this.getVector3FromArray(a.up,o.getCameraUpVector()),u=this.getVector3FromArray(a.target,o.getTarget()),d="fieldOfView"in a?parseFloat(a.fieldOfView):o.getVerticalFov(),h=this.getVector3FromArray(a.worldUpVector,null);if(!h){var f=e.model?e.model.getUpVector():null;h=f?(new THREE.Vector3).fromArray(f):new THREE.Vector3(0,1,0)}var p=this.getVector3FromArray(a.pivotPoint,o.getPivotPoint()),m=o.getCamera().isPerspective;"isOrthographic"in a&&(m=!a.isOrthographic);var g=this.getOrthographicHeight();"orthographicHeight"in a&&(g=Number(a.orthographicHeight));var v={position:l,target:u,up:c,worldup:h,aspect:e.impl.camera.aspect,fov:d,orthoScale:g,isPerspective:m,pivot:p};this.restoreCameraState(v,i)}var y=t.renderOptions;if(y){var _=e.impl.renderer(),b=e.prefs,x=b.ambientShadows,w=b.antialiasing,E=y.ambientOcclusion;if(E){"enabled"in E&&(x=E.enabled);var A="radius"in E?E.radius:null,M="intensity"in E?E.intensity:null;null!==A&&null!==M&&(A===_.getAORadius()&&M===_.getAOIntensity()||(_.setAOOptions(A,M),_.composeFinalFrame()))}if("environment"in y){var S=this.getLightPresetIndex(y.environment);-1!==S&&S!==b.get("lightPreset")&&s&&e.setLightPreset(S)}var T=y.toneMap;if(T){var C=!1,P="exposure"in T?T.exposure:null,L="lightMultiplier"in T?T.lightMultiplier:null;null!==P&&P!==_.getExposureBias()&&(_.setTonemapExposureBias(P),C=!0),null!==L&&e.impl.dir_light1&&L!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,L),C=!0),C&&e.impl.invalidate(!0)}var D=y.appearance;D&&("antiAliasing"in D&&(w=D.antiAliasing),"progressiveDisplay"in D&&D.progressiveDisplay!==b.get("progressiveRendering")&&e.setProgressiveRendering(D.progressiveDisplay),"swapBlackAndWhite"in D&&D.swapBlackAndWhite!==b.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(D.swapBlackAndWhite),"ghostHidden"in D&&D.ghostHidden!==b.get("ghosting")&&s&&e.setGhosting(D.ghostHidden),"displayLines"in D&&D.displayLines!==b.get("lineRendering")&&e.hideLines(!D.displayLines),"displayPoints"in D&&D.displayPoints!==b.get("pointRendering")&&e.hidePoints(!D.displayPoints)),s&&x!==b.ambientShadows&&w!==b.antialiasing&&e.setQualityLevel(x,w)}if(Array.isArray(t.cutplanes)&&e.model&&s){for(var R=[],I=0;I<t.cutplanes.length;I++){var j=t.cutplanes[I];Array.isArray(j)&&j.length>=4&&R.push(new THREE.Vector4(j[0],j[1],j[2],j[3]))}!function(t,n){if(!!e.getExtension("Bimfish.AEC.LevelsExtension")&&void 0===t.floorGuid){var r=n.length;if(3===r||8===r){var i=n[r-2],o=n[r-1];0===i.x&&0===i.y&&-1===i.z&&0===o.x&&0===o.y&&1===o.z&&n.splice(-2,2)}}}(t,R),e.impl.setCutPlaneSet("__set_view",R)}for(var O in e.loadedExtensions){var N=e.loadedExtensions[O];N.restoreState&&N.restoreState(t,i)}return!0},this.getEnvironmentName=function(){var t=i.LightPresets[e.impl.currentLightPreset()];return t?t.name:"none"},this.restoreCameraState=function(t,n){e.impl.adjustOrthoCamera(t);var r=e.navigation;n?(t.isPerspective?r.toPerspective():r.toOrthographic(),r.setCameraUpVector(t.up),r.setWorldUpVector(t.worldup),r.setView(t.position,t.target),r.setPivotPoint(t.pivot),r.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,r.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,n){function r(e,t){if(t=t||[],(e=e||[]).length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}function i(e,t,n){return t=t||[],(e=e||[]).length===t.length&&(0!==e.length&&(o(e[0],t[0],n)||o(e[1],t[1],n)||o(e[2],t[2],n)))}function o(e,t,n){var r=e?parseFloat(e):null,i=e?parseFloat(t):null,o=s(r),a=s(i);return"number"===o&&"number"===a?Math.abs(e-t)<n:(e=e||null)===(t=t||null)}var a=e,l=t;if(n&&!0!==n&&(a=this.applyFilter(a,n),l=this.applyFilter(l,n)),a.seedURN!==l.seedURN)return!1;var c=a.objectSet||[],u=l.objectSet||[];if(c.length!==u.length)return!1;var d=c[0]||{},h=u[0]||{};if(!(d.idType===h.idType&&o(d.explodeScale,h.explodeScale,1e-9)&&r(d.id,h.id)&&r(d.isolated,h.isolated)&&r(d.hidden,h.hidden)))return!1;var f=a.viewport||{},p=l.viewport||{};return!!(f.name===p.name&&f.projection===p.projection&&f.isOrthographic===p.isOrthographic&&o(f.distanceToOrbit,p.distanceToOrbit,1e-9)&&o(f.fieldOfView,p.fieldOfView,1e-9)&&o(f.orthographicHeight,p.orthographicHeight,1e-9)&&i(f.eye,p.eye,1e-9)&&i(f.target,p.target,1e-9)&&i(f.up,p.up,1e-9)&&i(f.worldUpVector,p.worldUpVector,1e-9)&&i(f.pivotPoint,p.pivotPoint,1e-9))},this.toIntArray=function(e){var t=[];if(Array.isArray(e))for(var n=0,r=e.length;n<r;++n)t.push(parseInt(e[n]));return t},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(t){return(t=t||e.model).selector?t.selector.getSelection():[]},this.getVisibleLayers2d=function(t){return t&&t!==e.model?(r.logger.warn("[getVisibleLayers2d] multiple models not yet supported."),[]):e.impl.getVisibleLayerIndices()},this.areAllLayersVisible=function(t){return t&&t!==e.model?(r.logger.warn("[areAllLayersVisible] multiple models not yet supported."),!0):e.impl.layers.allLayersVisible()},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport();return t.width/t.height},this.getOrthographicHeight=function(){var t=e.navigation.getCamera();return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(t){return(t=t||e.model)&&t.loader&&t.loader.svfUrn||""},this.getToneMapIntensity=function(){var t=0;return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var t=0;t<i.LightPresets.length;t++)if(i.LightPresets[t].name===e)return t;return-1},this.applyFilter=function(e,t){if(!0!==t)for(var n in e)if(e.hasOwnProperty(n)){var i=t[n];void 0===i?delete e[n]:"boolean"==typeof i?!1===i&&delete e[n]:i instanceof Object?e[n]instanceof Object?this.applyFilter(e[n],t[n]):r.logger.warn("[applyFilter] A - Invalid filter Object for key ["+n+"]"):r.logger.warn("[applyFilter] B - Invalid filter value for key ["+n+"]")}},this.normalizeCoordinates=function(t){var n=t.viewport;if(n){if(n.normalized)return void r.logger.warn("invalid normalization of state.viewport. Ignoring command.");if(n.normalized=!0,l(n,o.SceneMath.getNormalizingMatrix(e.model)),"orthographicHeight"in n){var i=e.model.myData.bbox,s=i.max.y-i.min.y,a=n.orthographicHeight/s;n.orthographicHeight=a}}},this.denormalizeCoordinates=function(t){var n=t.viewport;if(n){if(!n.normalized)return void r.logger.warn("invalid denormalization of state.viewport. Ignoring command.");delete n.normalized;var i=o.SceneMath.getNormalizingMatrix(e.model);if(l(n,(new THREE.Matrix4).getInverse(i)),"orthographicHeight"in n){var s=e.model.myData.bbox,a=s.max.y-s.min.y,c=n.orthographicHeight*a;n.orthographicHeight=c}}}}function l(e,t){var n=new THREE.Vector3(e.eye[0],e.eye[1],e.eye[2]),r=new THREE.Vector3(e.pivotPoint[0],e.pivotPoint[1],e.pivotPoint[2]),i=new THREE.Vector3(e.target[0],e.target[1],e.target[2]);n.applyMatrix4(t),r.applyMatrix4(t),i.applyMatrix4(t),e.eye[0]=n.x,e.eye[1]=n.y,e.eye[2]=n.z,e.pivotPoint[0]=r.x,e.pivotPoint[1]=r.y,e.pivotPoint[2]=r.z,e.target[0]=i.x,e.target[1]=i.y,e.target[2]=i.z}a.prototype.constructor=a},"./src/application/bubble.js":
/*!***********************************!*\
  !*** ./src/application/bubble.js ***!
  \***********************************/
/*! exports provided: BubbleNode */function(e,t,n){"use strict";n.r(t),n.d(t,"BubbleNode",(function(){return i}));var r=1;var i=function e(t,n){if(this.parent=n,this.id=r++,this.data=t,this.isLeaf="geometry"===t.type&&("3d"===t.role||"2d"===t.role||"lod"===t.role),Array.isArray(t.children)||Array.isArray(t.derivatives)){this.children=[];for(var i=t.children||t.derivatives,o=i.length,s=0;s<o;s++)this.children[s]=new e(i[s],this);this.children.length>1&&this.children.sort((function(e,t){return e.data.hasOwnProperty("order")&&t.data.hasOwnProperty("order")?e.data.order-t.data.order:0}));for(s=0;s<o;s++){var a="application/Bimfish-db"==(l=i[s]).mime&&l.urn?0===l.urn.indexOf("urn:adsk.objects:os.object")?l.urn.substr(0,l.urn.lastIndexOf("%2F")+3):l.urn.substr(0,l.urn.lastIndexOf("/")+1):null;a&&(this.sharedPropertyDbPath=a),"lod"===i[s].role&&(this.lodNode=this.children[s])}}var l};i.prototype.constructor=i,i.prototype.setDocument=function(e){this.lmvDocument=e},i.prototype.getDocument=function(){for(var e=this;e.parent;)e=e.parent;return e.lmvDocument},i.prototype.isOtg=function(){return!!this._getOtgManifest()},i.prototype._getOtgManifest=function(){if("undefined"!=typeof DISABLE_OTG&&DISABLE_OTG)return null;var e=this.findViewableParent();return e?e.data.otg_manifest:null},i.prototype.getOtgGraphicsNode=function(){if(this.isViewPreset())return this.findParentGeom2Dor3D().getOtgGraphicsNode();var e=this._getOtgManifest();return e&&e.views&&e.views[this.guid()]},i.prototype.getPropertyDbManifest=function(){var e,t=this._getOtgManifest();if(t&&t.pdb_manifest){var n=t.pdb_manifest;e={propertydb:{},isOtg:!0};for(var r=0;r<n.assets.length;r++){var i=n.assets[r];o=i.isShared?t.paths.shared_root+n.pdb_shared_rel_path:t.paths.version_root+n.pdb_version_rel_path,e.propertydb[i.tag]=[{path:o+i.uri,isShared:i.isShared}]}this.getOtgGraphicsNode()||(e.needsDbIdRemap=!0)}else{var o;null===(o=this.findPropertyDbPath())&&(console.warn("Missing property database entry in manifest."),o=""),0===o.indexOf("$file$")&&(console.warn("Bubble local path given for shared property DB files. Assuming that sharedPropertyDbPath is specified correctly by loadDocumentNode()."),o=""),e={propertydb:{attrs:[{path:o+"objects_attrs.json.gz"}],values:[{path:o+"objects_vals.json.gz"}],avs:[{path:o+"objects_avs.json.gz"}],offsets:[{path:o+"objects_offs.json.gz"}],ids:[{path:o+"objects_ids.json.gz"}]}}}return e},i.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},i.prototype.isForgeManifest=function(){return"manifest"===this.getRootNode().data.type},i.prototype.findPropertyDbPath=function(){var e=this._getOtgManifest(),t=e&&e.pdb_manifest;return t&&t.assets&&t.assets.length?e.paths.version_root+e.pdb_manifest.pdb_version_rel_path:(e&&console.warn("Unexpected: OTG manifest exists, but it has no property database manifest."),this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null)},i.prototype._raw=function(){return this.data},i.prototype.name=function(){return this.data.name||""},i.prototype.guid=function(){return this.data.guid},i.prototype.type=function(){return this.data.type},i.prototype.extensions=function(){if(this.data.extensions)return Array.isArray(this.data.extensions)?this.data.extensions:[this.data.extensions]},i.prototype.urn=function(e){var t=this.data.urn;if(!e)return t;for(var n=this.parent;!t&&n;)t=n.data.urn,n=n.parent;return t},i.prototype.isGeomLeaf=function(){return this.isLeaf},i.prototype.isViewable=function(){return"viewable"===this.data.role||"svf"===this.data.outputType},i.prototype.getLodNode=function(){return this.lodNode},i.prototype.isGeometry=function(){return"geometry"===this.data.type},i.prototype.isViewPreset=function(){return"view"===this.data.type},i.prototype.is2D=function(){return"2d"===this.data.role},i.prototype.is3D=function(){return"3d"===this.data.role},i.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},i.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},i.prototype.useAsDefault=function(){return!0===this.data.useAsDefault},i.prototype.getDefaultGeometry=function(){for(var e=this.search({type:"geometry"}),t=0;t<e.length;++t)if(e[t].useAsDefault())return e[t];return e[0]},i.prototype.getPlacementTransform=function(){return console.warn("BubbleNode.getPlacementTransform is deprecated. Sheet placement information is stored in AECModelData.json"),null},i.prototype.getHash=function(){return console.warn("BubbleNode.getHash is deprecated and will be removed in a future release."),null},i.prototype.getViewBox=function(){return this.data.viewbox},i.prototype.isMetadata=function(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},i.prototype.findViewableParent=function(){for(var e=null,t=this;t;)t.isViewable()&&(e=t),t=t.parent;if(!e&&!this.parent&&this.children)for(var n=0;n<this.children.length;n++){var r=this.children[n];if(r.isViewable()){e=r;break}}return e},i.prototype.findParentGeom2Dor3D=function(e){for(var t=this;t&&!t.is2DGeom()&&!t.is3DGeom();)t=t.parent;!t&&this.isViewPreset()&&(t=this.findGeometryFromSiblings()[0],e&&e.fallbackParent&&(t=e.fallbackParent));return t},i.prototype.findGeometryFromSiblings=function(){var e=this.parent;if(!e)return[];for(var t=[],n=0,r=e.children.length;n<r;++n){var i,o=e.children[n];if(o!==this)o.traverse((function(e){if(e.isGeometry()&&(e.is2D()||e.is3D()))return i=e,!0})),i&&t.push(i)}return t},i.prototype.findAllViewables=function(){var e=[];this.isForgeManifest()&&(e=this.search({outputType:"svf"}));var t=this.search({role:"viewable"});return e.concat(t)},i.prototype.getViewableRootPath=function(e){var t=this.getOtgGraphicsNode();if(t&&!t.error)return this._getOtgManifest().paths.version_root+t.urn;if(!this.isGeomLeaf())return this.urn();if(!e&&this.is2D()){var n=this.search({role:"leaflet"});if(n&&n.length)return n[0].urn()}var r=this.is2D()?"application/Bimfish-f2d":"application/Bimfish-svf",i=this.search({mime:r});return i&&i.length?i[0].urn():null},i.prototype.getNamedViews=function(){var e=this.search({type:"view"});return e=e.filter((function(e){return!!e.data.name&&!!Array.isArray(e.data.camera)}))},i.prototype.findByGuid=function(e){var t=null;return this.traverse((function(n){if(n.data.guid===e)return t=n,!0})),t},i.prototype.search=function(e){var t=[];return this.traverse((function(n){var r=!0;for(var i in e)if(!n.data.hasOwnProperty(i)||n.data[i]!==e[i]){r=!1;break}r&&t.push(n)})),t},i.prototype.traverse=function(e){if(e(this))return!0;if(this.children)for(var t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0;return!1},i.prototype.getShallowCopySource=function(e){if(!this.isViewable())return console.error("getShallowCopySource must be called with a viewable node."),null;e||(e=this.parent.urn());var t=this.urn();return t!==e&&(t?(console.log("Redirecting shallow copied URN ".concat(e," to ").concat(t)),e=t):console.warn("Unexpected: manifest viewable node does not have a urn property.\n".concat(JSON.stringify(this._raw())))),e},i.prototype.getAecModelData=function(){var e=this.findViewableParent();return e?(e.data.aec_model_data||console.warn("Use Document.getAecModelData(bubbleNode) instead of BubbleNode.getAecModelData(), or make sure Document.downloadAecModelData is loaded before using this API"),e.data.aec_model_data):null},i.prototype.extractRefPointTransform=function(){var e=this.getAecModelData();return e&&e.refPointTransformation&&i.readMatrixFromArray12(e.refPointTransformation)},i.prototype.extractCamera=function(){if(this.data.camera)return i.readCameraFromArray(this.data.camera);var e=this.isGeometry()&&this.search({type:"view"})[0];return e?e.extractCamera():null},i.prototype.getLevel=function(){var e=this.data.levelNumber;return Array.isArray(e)?e[0]:e},i.prototype.getLevelName=function(){return this.data.levelName||this.getLevel()},i.prototype.isSheet=function(){for(var e=this.parent;e;){if("Sheets"===e.name())return!0;e=e.parent}return!1},i.prototype.isMasterView=function(){for(var e=i.MASTER_VIEW_NODE.name,t=this;t;){if(t.name()===e)return!0;t=t.parent}return!1},i.readCameraFromArray=function(e,t){if(!Array.isArray(e))return null;if(t&&!t.elements){var n=new THREE.Matrix4;n.setPosition(t),t=n}var r={position:new THREE.Vector3(e[0],e[1],e[2]),target:new THREE.Vector3(e[3],e[4],e[5]),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};return t&&(r.position.applyMatrix4(t),r.target.applyMatrix4(t),r.up.transformDirection(t)),0===e[10]&&1===e[11]&&1===e[12]&&(r.orthoScale=r.position.distanceTo(r.target)),r},i.readMatrixFromArray12=function(e){return(new THREE.Matrix4).fromArray([e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,e[9],e[10],e[11],1])},i.MODEL_NODE={role:"3d",type:"geometry"},i.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/Bimfish-svf"},i.SHEET_NODE={role:"2d",type:"geometry"},i.LEAFLET_NODE={role:"leaflet"},i.PDF_PAGE_NODE={role:"pdf-page"},i.IMAGE_NODE={role:"image"},i.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/Bimfish-f2d"},i.VIEWABLE_NODE={role:"viewable"},i.AEC_MODEL_DATA={role:"Bimfish.AEC.ModelData"},i.MASTER_VIEW_NODE={name:"08f99ae5-b8be-4f8d-881b-128675723c10"}},"./src/compat.js":
/*!***********************!*\
  !*** ./src/compat.js ***!
  \***********************/
/*! exports provided: getGlobal, isBrowser, isNodeJS, isIE11, launchFullscreen, exitFullscreen, inFullscreen, fullscreenElement, isFullscreenAvailable, getAndroidVersion, isTouchDevice, isIOSDevice, isAndroidDevice, isMobileDevice, isSafari, isFirefox, isChrome, isMac, isWindows, ObjectAssign, disableDocumentTouchSafari, enableDocumentTouchSafari, touchStartToClick */function(e,t,n){"use strict";n.r(t),function(e){function r(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:e}n.d(t,"getGlobal",(function(){return r})),n.d(t,"isBrowser",(function(){return s})),n.d(t,"isNodeJS",(function(){return a})),n.d(t,"isIE11",(function(){return l})),n.d(t,"launchFullscreen",(function(){return c})),n.d(t,"exitFullscreen",(function(){return u})),n.d(t,"inFullscreen",(function(){return d})),n.d(t,"fullscreenElement",(function(){return h})),n.d(t,"isFullscreenAvailable",(function(){return f})),n.d(t,"getAndroidVersion",(function(){return p})),n.d(t,"isTouchDevice",(function(){return m})),n.d(t,"isIOSDevice",(function(){return v})),n.d(t,"isAndroidDevice",(function(){return _})),n.d(t,"isMobileDevice",(function(){return b})),n.d(t,"isSafari",(function(){return x})),n.d(t,"isFirefox",(function(){return w})),n.d(t,"isChrome",(function(){return E})),n.d(t,"isMac",(function(){return A})),n.d(t,"isWindows",(function(){return M})),n.d(t,"ObjectAssign",(function(){return S})),n.d(t,"disableDocumentTouchSafari",(function(){return C})),n.d(t,"enableDocumentTouchSafari",(function(){return P})),n.d(t,"touchStartToClick",(function(){return L}));var i=r(),o=i&&i.document,s="undefined"!=typeof navigator,a=function(){return!s},l=s&&!!navigator.userAgent.match(/Edge|Trident\/7\./);function c(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)}function u(e){d(e)&&(e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen&&e.msExitFullscreen())}function d(e){return"webkitIsFullScreen"in e?!!e.webkitIsFullScreen:"fullscreenElement"in e?!!e.fullscreenElement:"mozFullScreenElement"in e?!!e.mozFullScreenElement:"msFullscreenElement"in e?!!e.msFullscreenElement:!!e.querySelector(".viewer-fill-browser")}function h(e){return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement}function f(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen}function p(e){var t=(e=e||navigator.userAgent).match(/Android\s([0-9\.]*)/);return!!t&&t[1]}function m(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}"undefined"!=typeof window&&l&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=o.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=i.CustomEvent.prototype,i.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t)<0&&(t=0),e<0&&(e=this.byteLength+e)<0&&(e=0),t<=e)return new ArrayBuffer;for(var n=t-e,r=new Uint8Array(this,e,n),i=new Uint8Array(n),o=0;o<n;o++)i[o]=r[o];return i.buffer}),Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},"undefined"!=typeof window&&(i.BlobBuilder=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder);var g=s&&(/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1);function v(){return g}var y=s&&-1!==navigator.userAgent.toLowerCase().indexOf("android");function _(){return y}function b(){return!!s&&(v()||_())}function x(){if(!s)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")}function w(){return!!s&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")}function E(){return!!s&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")}function A(){return!!s&&-1!==navigator.userAgent.toLowerCase().indexOf("mac os")}function M(){if(!s)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")}function S(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function T(e){var t=i.hasOwnProperty("pageXOffset")?i.pageXOffset:o.documentElement.scrollLeft,n=i.hasOwnProperty("pageYOffset")?i.pageYOffset:o.documentElement.scrollTop,r=void 0===e.pageX?e.changedTouches[0].pageX:e.pageX,s=void 0===e.pageY?e.changedTouches[0].pageY:e.pageY,a=o.elementFromPoint(r-t,s-n);return!a||"CANVAS"!==a.nodeName||(!!a.getAttribute(!0)||(e.preventDefault(),!1))}function C(){b()&&x()&&(o.documentElement.addEventListener("touchstart",T,!0),o.documentElement.addEventListener("touchmove",T,!0),o.documentElement.addEventListener("touchcanceled",T,!0),o.documentElement.addEventListener("touchend",T,!0))}function P(){b()&&x()&&(o.documentElement.removeEventListener("touchstart",T,!0),o.documentElement.removeEventListener("touchmove",T,!0),o.documentElement.removeEventListener("touchcanceled",T,!0),o.documentElement.removeEventListener("touchend",T,!0))}function L(e){e.target.className.indexOf("fullscreen")>-1||e.target.className.indexOf("webvr")>-1||(e.preventDefault(),e.stopPropagation(),e.target.click())}!function(){var e=r();e.performance||(e.performance=Date)}(),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},String.prototype.repeat=String.prototype.repeat||function(e){if(e<1)return"";for(var t="",n=this.valueOf();e>1;)1&e&&(t+=n),e>>=1,n+=n;return t+n},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{enumerable:!1,value:function(e,t,n){t=void 0===t?0:t,n=void 0===n?this.length:n;for(var r=t;r<n;++r)this[r]=e}}),Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(e,t){return Array.prototype.lastIndexOf.call(this,e,t)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(e,t){for(var n=this.length,r=0;r<n;++r){var i=this[r];if(e.call(t,i,r,this))return i}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0}),"undefined"==typeof window||!l&&!v()||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){var r=this;setTimeout((function(){for(var i=atob(r.toDataURL(t,n).split(",")[1]),o=i.length,s=new Uint8Array(o),a=0;a<o;a++)s[a]=i.charCodeAt(a);e(new Blob([s],{type:t||"image/png"}))}))}}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){if(t=void 0!==t?t:this.length,"[object Array]"===Object.prototype.toString.call(this))return _slice.call(this,e,t);var n,r,i=[],o=this.length,s=e||0;s=s>=0?s:Math.max(0,o+s);var a="number"==typeof t?Math.min(t,o):o;if(t<0&&(a=o+t),(r=a-s)>0)if(i=new Array(r),this.charAt)for(n=0;n<r;n++)i[n]=this.charAt(s+n);else for(n=0;n<r;n++)i[n]=this[s+n];return i})}.call(this,n(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./src/envinit.js":
/*!************************!*\
  !*** ./src/envinit.js ***!
  \************************/
/*! exports provided: token, getWebGLHelpLink, EnvironmentConfigurations, initializeEnvironmentVariable, initializeResourceRoot, initializeServiceEndPoints, refreshCookie, refreshRequestHeader, refreshToken, initializeAuth, initializeLogger, Initializer, shutdown */function(e,t,n){"use strict";n.r(t),n.d(t,"token",(function(){return p})),n.d(t,"getWebGLHelpLink",(function(){return g})),n.d(t,"EnvironmentConfigurations",(function(){return _})),n.d(t,"initializeEnvironmentVariable",(function(){return b})),n.d(t,"initializeResourceRoot",(function(){return x})),n.d(t,"initializeServiceEndPoints",(function(){return w})),n.d(t,"refreshCookie",(function(){return E})),n.d(t,"refreshRequestHeader",(function(){return A})),n.d(t,"refreshToken",(function(){return M})),n.d(t,"initializeAuth",(function(){return S})),n.d(t,"initializeLogger",(function(){return T})),n.d(t,"Initializer",(function(){return P})),n.d(t,"shutdown",(function(){return L}));var r=n(/*! ./globals */"./src/globals.js"),i=n(/*! ./resource-loader */"./src/resource-loader.js"),o=n(/*! ./logger/Logger */"./src/logger/Logger.js"),s=n(/*! ./file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),a=n(/*! ./compat */"./src/compat.js"),l=n(/*! ./file-loaders/main/WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),c=n(/*! ./file-loaders/net/Xhr */"./src/file-loaders/net/Xhr.js"),u=n(/*! ./globalization/i18init */"./src/globalization/i18init.js"),d=(n(/*! ./application/ExtensionManager */"./src/application/ExtensionManager.js"),Object(a.getGlobal)()),h=d,f={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},p=f,m=null;function g(){return m}var v={local:{RTC:["https://rtc-dev.api.Bimfish.com:443","https://lmv.Bimfish.com:443"]},dev:{RTC:["https://rtc-dev.api.Bimfish.com:443","https://lmv.Bimfish.com:443"]},stg:{RTC:["https://rtc-stg.api.Bimfish.com:443","https://lmv.Bimfish.com:443"]},prod:{RTC:["https://rtc.api.Bimfish.com:443","https://lmv.Bimfish.com:443"]}},y={local:"",dev:"https://developer-dev.api.Bimfish.com",stg:"https://developer-stg.api.Bimfish.com",prod:"https://developer.api.Bimfish.com"},_={Local:{ROOT:"",LMV:v.local},Development:{ROOT:y.dev,LMV:v.dev,bubbleManifest:!0},Staging:{ROOT:y.stg,LMV:v.stg,bubbleManifest:!0},Production:{ROOT:y.prod,LMV:v.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:y.dev,LMV:v.dev},AutodeskStaging:{ROOT:y.stg,LMV:v.stg},AutodeskProduction:{ROOT:y.prod,LMV:v.prod},FluentDev:{ROOT:"https://us.otgs-dev.Bimfish.com",LMV:v.dev},FluentStaging:{ROOT:"https://us.otgs-stg.Bimfish.com",LMV:v.stg},FluentProduction:{ROOT:"https://us.otgs.Bimfish.com",LMV:v.prod},FluentStagingEU:{ROOT:"https://eu.otgs-stg.Bimfish.com",LMV:v.stg},FluentProductionEU:{ROOT:"https://eu.otgs.Bimfish.com",LMV:v.prod}};function b(e){var t;if(e&&e.env&&(t=e.env),t||(t=Object(r.getParameterByName)("env")),Object(s.setOfflineResourcePrefix)(e&&e.offlineResourcePrefix||""),Object(s.setOffline)(e&&"true"===e.offline),!t)switch(h.location.hostname){case"developer-dev.api.Bimfish.com":t="AutodeskDevelopment";break;case"developer-stg.api.Bimfish.com":t="AutodeskStaging";break;case"developer.api.Bimfish.com":t="AutodeskProduction";break;case"localhost.Bimfish.com":case"":case"127.0.0.1":t="Local";break;default:t="AutodeskProduction"}Object(s.setEnv)(t),"undefined"!=typeof window&&o.logger.info("Host name : "+window.location.hostname),o.logger.info("Environment initialized as : "+t)}function x(e){var t,n,i=["viewer3D.js","viewer3D.min.js","viewerCE.js","viewerCE.min.js"];e&&e.hasOwnProperty("libraryName")&&i.push(e.libraryName);for(var o=!1,s=0;s<i.length;s++){var a=Object(r.getScript)(i[s]),l=(n=a?a.src:"").indexOf(i[s]);if(l>=0){t=n.substr(0,l),(n.indexOf("&v=",l)>0||n.indexOf("?v=",l)>0)&&(o=!0);break}}if(d.LMV_RESOURCE_ROOT=t||d.LMV_RESOURCE_ROOT,o){var c=!1,u=["dev","stg","prod"];for(s=0;s<u.length;++s){var h=y[u[s]];if(-1!==d.LMV_RESOURCE_ROOT.indexOf(h)){c=!0;break}}c&&(d.LMV_RESOURCE_ROOT+=d.LMV_VIEWER_VERSION+"/")}}function w(e){var t=e.endpoint;t||(t=_[Object(s.getEnv)()].ROOT);var n=e.api||t.ENDPOINT_API_DERIVATIVE_SERVICE_V2;if(s.endpoint.setEndpointAndApi(t,n),!Object(a.isNodeJS)())return x(e),Promise.resolve()}function E(e,t,n){t=t||function(){},c.ViewingService.rawGet(s.endpoint.getApiEndpoint(),null,"/auth/settoken",t,n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,postData:"access-token="+e})}function A(e){s.endpoint.HTTP_REQUEST_HEADERS.Authorization="Bearer "+e}function M(e,t,n){if(f.accessToken=e,s.endpoint.getUseCookie()){E(e,t,(function(t){o.logger.warn("Failed to set token in cookie. Will use header instead."),s.endpoint.setUseCookie(!1),A(e),n&&n(t)}))}else A(e),t&&t()}function S(e,t){var n,i=t?t.shouldInitializeAuth:void 0;void 0===i&&(i="false"!==Object(r.getParameterByName)("auth").toLowerCase());if("Local"==Object(s.getEnv)()||!i)return setTimeout(e,0),void s.endpoint.setUseCredentials(void 0!==t.useCredentials&&t.useCredentials);s.endpoint.setUseCredentials(void 0===t.useCredentials||t.useCredentials),s.endpoint.setUseCookie(t.useCookie),f.tokenRefreshInterval&&(clearTimeout(f.tokenRefreshInterval),f.tokenRefreshInterval=null),t&&t.getAccessToken?(f.getAccessToken=t.getAccessToken,"string"==typeof(n=t.getAccessToken((function r(i,o){n=i,!f.tokenRefreshInterval?M(n,e,e):M(n),"number"!=typeof o&&(o=3599);var s=o-5;s<=0&&(s=o),f.tokenRefreshInterval=setTimeout((function(){t.getAccessToken(r)}),1e3*s)})))&&n&&M(n,e)):t&&t.accessToken?M(n=t.accessToken,e):((n=Object(r.getParameterByName)("accessToken"))||o.logger.error("No access token is provided, but authorization requested. This is a problem."),M(n,e))}function T(e){o.logger.initialize(e);var t=Object(r.getParameterByName)("logLevel");t&&o.logger.setLevel(parseInt(t))}function C(e){e&&"Local"===e.env||s.endpoint.getCdnRedirectUrl()&&c.ViewingService.rawGet(s.endpoint.getCdnRedirectUrl(),null,null,(function(e){e&&e.length&&(s.endpoint.setCdnUrl(e),o.logger.info("CDN_ROOT is: "+e))}),(function(){}),{withCredentials:!1,responseType:"text"})}function P(e,t){if(Object(a.isNodeJS)())return b(e),w(e),T(e),C(e),void S(t,e);e.webGLHelpLink&&(m=e.webGLHelpLink),i.theResourceLoader.loadPromiseLibrary((function(){b(e);var n=w(e);T(e),C(e),Object(u.initializeLocalization)(e),Object(a.disableDocumentTouchSafari)(),Object(l.initWorkerScript)();var r=function(e){return new Promise((function(t){S(t,e)}))}(e);Promise.all([n,r]).then(t)}))}function L(){o.logger.shutdown(),Bimfish.Viewing.Private.shutdownPropWorker()}},"./src/file-loaders/lmvtk/common/InputStream.js":
/*!******************************************************!*\
  !*** ./src/file-loaders/lmvtk/common/InputStream.js ***!
  \******************************************************/
/*! exports provided: InputStream */function(e,t,n){"use strict";n.r(t),n.d(t,"InputStream",(function(){return d}));var r=n(/*! ./StringUtils */"./src/file-loaders/lmvtk/common/StringUtils.js"),i=new ArrayBuffer(8),o=new Uint8Array(i),s=new Uint16Array(i),a=new Int32Array(i),l=new Uint32Array(i),c=new Float32Array(i),u=new Float64Array(i);function d(e){this.buffer=e,this.offset=0,this.byteLength=e.length}d.prototype.seek=function(e){this.offset=e},d.prototype.getBytes=function(e){var t=new Uint8Array(this.buffer.buffer,this.offset,e);return this.offset+=e,t},d.prototype.getVarints=function(){var e,t=0,n=0;do{t|=(127&(e=this.buffer[this.offset++]))<<n,n+=7}while(128&e);return t},d.prototype.getUint8=function(){return this.buffer[this.offset++]},d.prototype.getUint16=function(){return o[0]=this.buffer[this.offset++],o[1]=this.buffer[this.offset++],s[0]},d.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e|=4294901760),e},d.prototype.getInt32=function(){var e=this.buffer,t=o,n=this.offset;return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],this.offset+=4,a[0]},d.prototype.getUint32=function(){var e=this.buffer,t=o,n=this.offset;return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],this.offset+=4,l[0]},d.prototype.getFloat32=function(){var e=this.buffer,t=o,n=this.offset;return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],this.offset+=4,c[0]},d.prototype.getIndicesArray=function(e,t,n){for(var r=this.buffer,i=new Uint8Array(e,t,2*n),o=this.offset,s=0,a=2*n;s<a;s+=2)i[s]=r[o],i[s+1]=r[o+1],o+=4;this.offset=o},d.prototype.getVector3Array=function(e,t,n,r){var i=this.buffer,o=this.offset,s=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(3===r&&0===n){var a=12*t;s.set(i.subarray(o,o+a)),this.offset+=a}else{r*=4;for(var l=4*n,c=0;c<t;c++){for(var u=0;u<12;u++)s[l+u]=i[o++];l+=r}this.offset=o}},d.prototype.getVector2Array=function(e,t,n,r){var i=this.buffer,o=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s=this.offset;r*=4;for(var a=4*n,l=0;l<t;l++){for(var c=0;c<8;c++)o[a+c]=i[s++];a+=r}this.offset=s},d.prototype.getVector4=function(e,t){for(var n=this.buffer,r=o,i=this.offset,s=c,a=0;a<4;a++)r[0]=n[i],r[1]=n[i+1],r[2]=n[i+2],r[3]=n[i+3],e[t+a]=s[0],i+=4;this.offset=i},d.prototype.getFloat64=function(){for(var e=this.buffer,t=o,n=this.offset,r=0;r<8;r++)t[r]=e[n+r];return this.offset+=8,u[0]},d.prototype.getString=function(e){var t=Object(r.utf8ArrayToString)(this.buffer,this.offset,e);return this.offset+=e,t},d.prototype.reset=function(e){this.buffer=e,this.offset=0,this.byteLength=e.length}},"./src/file-loaders/lmvtk/common/StringUtils.js":
/*!******************************************************!*\
  !*** ./src/file-loaders/lmvtk/common/StringUtils.js ***!
  \******************************************************/
/*! exports provided: utf8BlobToStr, safeUtf8BlobToStr, utf16to8, utf8ArrayToString, blobToJson, subBlobToJson, subBlobToJsonInt, parseIntArray, findValueOffsets */function(e,t,n){"use strict";function r(e,t,n){var r,i,o,s,a,l;for(r="",o=n,i=0;i<o;)switch((s=e[t+i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(s);break;case 12:case 13:a=e[t+i++],r+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=e[t+i++],l=e[t+i++],r+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&l)<<0)}return r}function i(e,t,n){var r,i,o,s,a,l,c,u;for(r="",a=[],o=n,l=0,i=0;i<o;){switch((s=e[t+i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a.push(String.fromCharCode(s));break;case 12:case 13:c=e[t+i++],a.push(String.fromCharCode((31&s)<<6|63&c));break;case 14:c=e[t+i++],u=e[t+i++],a.push(String.fromCharCode((15&s)<<12|(63&c)<<6|(63&u)<<0))}(++l>=32768||i>=o)&&(r+=a.join(""),a.length=0,l=0)}return r}function o(e,t,n){var r,i,o,s=n||0;if(i=e.length,t)for(r=0;r<i;r++)(o=e.charCodeAt(r))>=1&&o<=127?t[s++]=o:o>2047?(t[s++]=224|o>>12&15,t[s++]=128|o>>6&63,t[s++]=128|o>>0&63):(t[s++]=192|o>>6&31,t[s++]=128|o>>0&63);else for(r=0;r<i;r++)(o=e.charCodeAt(r))>=1&&o<=127?s++:s+=o>2047?3:2;return s-(n||0)}n.r(t),n.d(t,"utf8BlobToStr",(function(){return r})),n.d(t,"safeUtf8BlobToStr",(function(){return i})),n.d(t,"utf16to8",(function(){return o})),n.d(t,"utf8ArrayToString",(function(){return s})),n.d(t,"blobToJson",(function(){return a})),n.d(t,"subBlobToJson",(function(){return l})),n.d(t,"subBlobToJsonInt",(function(){return c})),n.d(t,"parseIntArray",(function(){return u})),n.d(t,"findValueOffsets",(function(){return d}));function s(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.length),n>1048576?i(e,t,n):r(e,t,n)}function a(e){var t=s(e,0,e.length);return JSON.parse(t)}function l(e,t){if(void 0===t)return"";for(var n=t;n<e.length-1;){var r=e[n];if(44==r&&(10==e[n+1]||13==e[n+1]))break;if(10==r||13==r)break;n++}var i=s(e,t,n-t);try{return JSON.parse(i)}catch(e){return console.error("Error parsing property blob to JSON : "+i),i}}function c(e,t){var n=0,r=t;for(34==e[r]&&r++;r<e.length-1;){var i=e[r];if(44==i&&(10==e[r+1]||13==e[r+1]))break;if(10==i||13==i||34==i)break;i>=48&&i<=57&&(n=10*n+(i-48)),r++}return n}function u(e,t){for(var n=0,r=0,i=e.length;r<i;r++)44==e[r]&&n++;n++;var o=new Uint32Array(n+(t?1:0));r=0;for(var s=e.length;91!=e[r]&&r<s;)r++;if(r==e.length)return null;r++;var a=!1;n=0;for(var l=0;r<s;){var c=e[r];c>=48&&c<=57?(l=10*l+(c-48),a=!0):44==c||93==c?a&&(o[n++]=l,a=!1,l=0):(a=!1,l=0),r++}return o}function d(e){for(var t=0,n=e.length-1,r=0;r<n;r++)44!=e[r]||10!=e[r+1]&&13!=e[r+1]||t++;if(!t)return null;t++;var i=new Uint32Array(t);for(r=0,t=0;91!=e[r]&&r<n;)r++;r++,i[t++]=r;for(var o=!1;r<n;)10==e[r]||13==e[r]?o=!0:o&&(o=!1,i[t++]=r),r++;return i}},"./src/file-loaders/lmvtk/common/SvfPlacementUtils.js":
/*!************************************************************!*\
  !*** ./src/file-loaders/lmvtk/common/SvfPlacementUtils.js ***!
  \************************************************************/
/*! exports provided: derivePlacementTransform, calculatePlacementWithOffset, initPlacement, transformAnimations */function(e,t,n){"use strict";n.r(t),n.d(t,"derivePlacementTransform",(function(){return l})),n.d(t,"calculatePlacementWithOffset",(function(){return c})),n.d(t,"initPlacement",(function(){return u})),n.d(t,"transformAnimations",(function(){return h}));var r=n(/*! ../../../wgs/scene/LmvVector3 */"./src/wgs/scene/LmvVector3.js"),i=n(/*! ../../../wgs/scene/LmvBox3 */"./src/wgs/scene/LmvBox3.js"),o=n(/*! ../../../wgs/scene/LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){switch(e){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}}function l(e,t){if(e.placementTransform=t.placementTransform,t.applyScaling){var n="m";e.metadata["distance unit"]&&(n=e.metadata["distance unit"].value),e.scalingUnit=n,"object"===s(t.applyScaling)?(t.applyScaling.from&&(n=t.applyScaling.from),t.applyScaling.to&&(e.scalingUnit=t.applyScaling.to)):e.scalingUnit=t.applyScaling;var r=a(n)/a(e.scalingUnit);if(1!=r){var i=new o.LmvMatrix4(!0),l=new o.LmvMatrix4(!0);l.elements[0]=r,l.elements[5]=r,l.elements[10]=r,t.placementTransform&&i.copy(t.placementTransform),e.placementTransform=t.placementTransform=i.multiply(l)}}var c=e.metadata["custom values"];if(c&&c.refPointTransform){e.refPointTransform=new o.LmvMatrix4(!0);var u=e.refPointTransform.elements,d=c.refPointTransform;u[0]=d[0],u[1]=d[1],u[2]=d[2],u[4]=d[3],u[5]=d[4],u[6]=d[5],u[8]=d[6],u[9]=d[7],u[10]=d[8],u[12]=d[9],u[13]=d[10],u[14]=d[11]}else{var h=e.metadata.georeference,f=h&&h.refPointLMV,p=0;if(c&&c.hasOwnProperty("angleToTrueNorth")&&(p=Math.PI/180*c.angleToTrueNorth),f||p){var m=new o.LmvMatrix4(!0),g=m.elements;g[0]=g[5]=Math.cos(p),g[1]=-Math.sin(p),g[4]=Math.sin(p);var v=new o.LmvMatrix4(!0);g=v.elements,f&&(g[12]=-f[0],g[13]=-f[1],g[14]=-f[2]),e.refPointTransform=m.multiply(v)}}if(t.applyRefPoint&&e.refPointTransform){var y=new o.LmvMatrix4(!0);t.placementTransform&&y.copy(t.placementTransform),y.multiply(e.refPointTransform),e.placementTransform=t.placementTransform=y}else!t.applyRefPoint&&t.placementTransform&&(e.placementTransform=new o.LmvMatrix4(!0).copy(t.placementTransform));return e.placementTransform&&function(e){for(var t=e.elements,n=0;n<4;n++)for(var r=0;r<4;r++)if(n===r){if(1!==t[4*n+r])return!1}else if(0!==t[4*n+r])return!1;return!0}(e.placementTransform)&&(e.placementTransform=null),e.placementTransform}function c(e,t){var n=e.globalOffset;if(n.x||n.y||n.z){if(t){var r=new o.LmvMatrix4(!0);r.copy(t),(t=r).elements[12]-=n.x,t.elements[13]-=n.y,t.elements[14]-=n.z}else(t=new o.LmvMatrix4(!0)).makeTranslation(-n.x,-n.y,-n.z);e.placementWithOffset=t}else e.placementWithOffset=t}function u(e,t){if(e.metadata){var n=e.metadata["world bounding box"],o=new r.LmvVector3(n.minXYZ[0],n.minXYZ[1],n.minXYZ[2]),s=new r.LmvVector3(n.maxXYZ[0],n.maxXYZ[1],n.maxXYZ[2]);e.bbox=new i.LmvBox3(o,s);var a=l(e,t);a&&!e.bbox.empty()&&e.bbox.applyMatrix4(a),t.globalOffset?e.globalOffset=t.globalOffset:e.globalOffset=e.bbox.center(),c(e,a),e.bbox.empty()||(e.bbox.min.sub(e.globalOffset),e.bbox.max.sub(e.globalOffset)),e.metadata.hasOwnProperty("double sided geometry")&&e.metadata["double sided geometry"].value&&(e.doubleSided=!0)}}function d(e,t){e[0]-=t.x,e[1]-=t.y,e[2]-=t.z}function h(e){if(e.animations){var t=e.animations.animations;if(t)for(var n=e.globalOffset,r=(new o.LmvMatrix4).makeTranslation(n.x,n.y,n.z),i=(new o.LmvMatrix4).makeTranslation(-n.x,-n.y,-n.z),s=new o.LmvMatrix4,a=new o.LmvMatrix4,l=0;l<t.length;l++){var c=t[l];if(c.hierarchy)for(var u=0;u<c.hierarchy.length;u++){var h=c.hierarchy[u].keys;if(h)for(var f=0;f<h.length;f++){var p=h[f].pos;if(p){var m=n,g=h[f].rot;g&&(s.makeRotationFromQuaternion({x:g[0],y:g[1],z:g[2],w:g[3]}),a.multiplyMatrices(r,s).multiply(i),m={x:a.elements[12],y:a.elements[13],z:a.elements[14]}),d(p,m)}var v=h[f].target;v&&d(v,n);var y=h[f].points;if(y)for(var _=0;_<y.length;_++)d(y[_],n)}}}}}},"./src/file-loaders/lmvtk/common/VertexBufferBuilder.js":
/*!**************************************************************!*\
  !*** ./src/file-loaders/lmvtk/common/VertexBufferBuilder.js ***!
  \**************************************************************/
/*! exports provided: VertexBufferBuilder */function(e,t,n){"use strict";n.r(t),n.d(t,"VertexBufferBuilder",(function(){return o}));var r=2*Math.PI,i=[0,1,3,0,3,2];function o(e,t,n,r){var i=t||65536;this.FULL_COUNT=0|(n||32767),this.useInstancing=e,this.useCompactBuffers=r,this.stride=10,this.allocVcount=4*(this.useInstancing?i/4:i),this.vb=new ArrayBuffer(this.stride*this.allocVcount),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(i),this.reset(0)}o.prototype.reset=function(e){this.vcount=e,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.lastDbId=null,this.colors={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0,this.hasLineStyles=!1,this.changeTracking={},this.stride=10},o.prototype.expandStride=function(){var e=this.stride;if(!(e>=12)){for(var t=this.stride+2,n=new ArrayBuffer(t*this.allocVcount),r=new Uint8Array(this.vb),i=new Uint8Array(n),o=0,s=this.vcount;o<s;o++)for(var a=o*e*4,l=o*t*4,c=0;c<4*e;c++)i[l+c]=r[a+c];this.vb=n,this.vbf=new Float32Array(n),this.vbi=new Int32Array(n),this.stride=t}},o.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)};var s=new Int32Array(1);function a(e){return s[0]=e,s[0]}o.prototype.trackChanges=function(e,t,n,r,i,o){if(n!==this.lastDbId&&(this.dbIds[a(n)]=1,this.lastDbId=n),o&&(this.hasLineStyles=!0),this.useCompactBuffers){var s=this.changeTracking;l("geomType",e),l("color",t),l("dbId",n),l("layerId",r),l("viewportId",i),l("linePattern",o),this.colors[a(t)]=1}function l(t,n){void 0===s[t]?s[t]=e:s[t]===n&&(s[t+"Varies"]=!0)}},o.prototype.setCommonVertexAttribs=function(e,t,n,r,i,o,s,a){this.trackChanges(n,r,i,o,s,a),t&=255,n&=255,a&=255,o&=65535,s&=65535,this.vbi[e+8]=t|n<<8|a<<16,this.vbi[e+6]=r,this.vbi[e+7]=i,this.vbi[e+9]=o|s<<16},o.prototype.addVertexTriangleGeom=function(e,t,n,r,i,o,s,a,l,c){for(var u=this.vcount,d=this.vbf,h=this.useInstancing?1:4,f=0;f<h;f++){var p=(u+f)*this.stride;d[p]=e,d[p+1]=t,d[p+2]=n,d[p+3]=r,d[p+4]=i,d[p+5]=o,this.setCommonVertexAttribs(p,0+f,5,s,a,l,c,0),this.vcount++}return u},o.prototype.addVertexLine=function(e,t,n,i,o,s,a,l,c,u,d){for(var h=this.vcount,f=this.vbf,p=this.useInstancing?1:4,m=0;m<p;m++){var g=(h+m)*this.stride;f[g]=e,f[g+1]=t,f[g+2]=(n+Math.PI)/r,f[g+3]=i,f[g+4]=.5*s,f[g+5]=o,this.setCommonVertexAttribs(g,0+m,1,a,l,c,u,d),this.vcount++}return h},o.prototype.addVertexTexQuad=function(e,t,n,i,o,s,a,l,c){for(var u=this.vcount,d=this.vbf,h=this.useInstancing?1:4,f=0;f<h;f++){var p=(u+f)*this.stride;d[p]=e,d[p+1]=t,d[p+2]=o/r,d[p+3]=n,d[p+4]=i,this.setCommonVertexAttribs(p,0+f,4,s,a,l,c,0),this.vcount++}return u},o.prototype.addVertexArc=function(e,t,n,i,o,s,a,l,c,u,d,h){for(var f=this.vcount,p=this.vbf,m=o==s?2:3,g=this.useInstancing?1:4,v=0;v<g;v++){var y=(f+v)*this.stride;p[y]=e,p[y+1]=t,p[y+2]=n/r,p[y+3]=i/r,p[y+4]=.5*l,p[y+5]=o,3===m&&(p[y+10]=s,p[y+11]=a),this.setCommonVertexAttribs(y,0+v,m,c,u,d,h,0),this.vcount++}return f},o.prototype.addVertex=function(e,t,n,r,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(!this.useInstancing){var a=this.vcount,l=this.stride*a,c=this.vbf;return c[l]=e,c[l+1]=t,this.setCommonVertexAttribs(l,0,s,n,r,i,o,0),this.vcount++,a}},o.prototype.addVertexPolytriangle=function(e,t,n,r,i,o){this.useInstancing||(this.addVertex(e,t,n,r,i,o),this.addToBounds(e,t))},o.prototype.addVertexMSDFPolytriangle=function(e,t,n,r,i,o,s,a){if(!this.useInstancing){var l=this.vcount,c=this.vbf;this.addVertex(e,t,i,o,s,a,6),c[l*this.stride+2]=n,c[l*this.stride+3]=r,this.addToBounds(e,t)}},o.prototype.addIndices=function(e,t){if(!this.useInstancing){var n=this.ib,r=this.icount;if(r+e.length>=n.length){for(var i=new Uint16Array(2*Math.max(e.length,n.length)),o=0;o<r;++o)i[o]=n[o];this.ib=n=i}for(o=0;o<e.length;++o)n[r+o]=t+e[o];this.icount+=e.length}},o.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(i,e)},o.prototype.addSegment=function(e,t,n,r,i,o,s,a,l,c,u){var d=n-e,h=r-t,f=d||h?Math.atan2(h,d):0,p=d||h?Math.sqrt(d*d+h*h):0,m=this.addVertexLine(e,t,f,p,i,o,s,a,l,c,u);this.finalizeQuad(m),this.addToBounds(e,t),this.addToBounds(n,r)},o.prototype.addTriangleGeom=function(e,t,n,r,i,o,s,a,l,c){this.numTriangleGeoms++;var u=this.addVertexTriangleGeom(e,t,n,r,i,o,s,a,l,c);this.finalizeQuad(u),this.addToBounds(e,t),this.addToBounds(n,r),this.addToBounds(i,o)},o.prototype.addArc=function(e,t,n,i,o,s,a,c,u,d,h,f){o==s?this.numCirculars++:(this.numEllipticals++,this.expandStride());var p=l(n,i);if(n=p.start,i=p.end,0==n&&0==i&&(i=r),(b=Math.abs(n-i))>1e-4&&Math.abs(b-r)>1e-4){var m=e+o*Math.cos(n),g=t+s*Math.sin(n);this.addSegment(m,g,m,g,0,c,u,d,h,f);var v=e+o*Math.cos(i),y=t+s*Math.sin(i);this.addSegment(v,y,v,y,0,c,u,d,h,f)}else this.addToBounds(e-o,t-s),this.addToBounds(e+o,t+s);var _=this.addVertexLine(e,t,0,1e-4,0,0,1,d,h,f);this.finalizeQuad(_);var b,x=this.addVertexArc(e,t,n,i,o,s,a,c,u,d,h,f);this.finalizeQuad(x)},o.prototype.addTexturedQuad=function(e,t,n,r,i,o,s,a,l){var c=this.addVertexTexQuad(e,t,n,r,i,o,s,a,l);this.finalizeQuad(c);var u=.5*Math.cos(i),d=.5*Math.sin(i),h=Math.abs(n*u)+Math.abs(r*d),f=Math.abs(n*d)+Math.abs(r*u);this.addToBounds(e-h,t-f),this.addToBounds(e+h,t+f)},o.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>this.FULL_COUNT},o.prototype.makeCompactVertexLayout=function(){var e=Object.keys(this.colors),t=Object.keys(this.dbIds);if(10!==this.stride)return null;var n=e.length+t.length;if(e.length+t.length>65536)return null;var r=new Int32Array(n+1);r[0]=0;for(var i=1,o=0;o<e.length;o++,i++)r[i]=parseInt(e[o]),this.colors[e[o]]=i;for(o=0;o<t.length;o++,i++)r[i]=parseInt(t[o]),this.dbIds[t[o]]=i;var s=new ArrayBuffer(24*this.vcount),a=new Int32Array(s),l=new Uint16Array(s),c=this.maxx-this.minx||1,u=this.maxy-this.miny||1,d=this.minx,h=this.miny,f=Math.max(c,u);function p(e){return 0|Math.round((e-d)/c*65535)}function m(e){return 0|Math.round((e-h)/u*65535)}function g(e){return 0|Math.round(e/f*65535)}function v(e){return 0|65535*e}function y(e){return e<0?32768+32767*Math.min(1,-e/1024):e?0|Math.round(e/f*32767)||1:e}for(o=0;o<this.vcount;o++){var _=this.stride*o,b=6*o,x=2*b;switch(this.vbi[_+8]>>8&255){case 0:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]);break;case 1:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=v(this.vbf[_+2]),l[x+3]=g(this.vbf[_+3]),l[x+4]=y(this.vbf[_+4]);break;case 2:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=v(this.vbf[_+2]),l[x+3]=v(this.vbf[_+3]),l[x+4]=y(this.vbf[_+4]),l[x+5]=g(this.vbf[_+5]);break;case 3:break;case 4:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=v(this.vbf[_+2]),l[x+3]=g(this.vbf[_+3]),l[x+4]=g(this.vbf[_+4]);break;case 5:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=p(this.vbf[_+2]),l[x+3]=m(this.vbf[_+3]),l[x+4]=p(this.vbf[_+4]),l[x+5]=m(this.vbf[_+5]);break;default:console.error("Unknown geometry type")}l[x+6]=this.colors[this.vbi[_+6]]||0,l[x+7]=this.dbIds[this.vbi[_+7]]||0,a[b+4]=this.vbi[_+8],a[b+5]=this.vbi[_+9]}var w={};w.vb=new Float32Array(s),w.vbstride=6;var E=this.useInstancing?1:0;return w.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:2,divisor:E,normalize:!0},fields2:{offset:1,itemSize:4,bytesPerItem:2,divisor:E,normalize:!0},uvIdColor:{offset:3,itemSize:2,bytesPerItem:2,divisor:E,normalize:!1},flags4b:{offset:4,itemSize:4,bytesPerItem:1,divisor:E,normalize:!1},layerVp4b:{offset:5,itemSize:4,bytesPerItem:1,divisor:E,normalize:!1}},w.unpackXform={x:c,y:u,z:d,w:h},w.texData=r,w},o.prototype.makeWideVertexLayout=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride;var t=this.useInstancing?1:0;return e.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1},fields2:{offset:2,itemSize:4,bytesPerItem:4,divisor:t,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:t,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1}},e.vblayout.extraParams={offset:this.stride-2,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1},e},o.prototype.toMesh=function(){var e=null;if(this.useCompactBuffers&&(e=this.makeCompactVertexLayout()),e||(e=this.makeWideVertexLayout()),this.useInstancing){e.numInstances=this.vcount;var t=new Int32Array([0,1,2,3]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},e.vblayout.instFlags4b.array=t.buffer;e.indices=new Uint16Array(i)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var n=this.maxx-this.minx,r=this.maxy-this.miny,o=Math.max(n,r);e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-o},max:{x:this.maxx,y:this.maxy,z:.001*o}};e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(n*n+r*r)};return e};var l=function(e,t){function n(){function n(e,t){return Math.abs(e-t)<.001}n(e,0)&&(e=0),n(t,0)&&(t=0),n(e,r)&&(e=r),n(t,r)&&(t=r)}if(n(),e>t)for(;e>r;)e-=r,t-=r;else for(;t>r;)e-=r,t-=r;return n(),e<0&&t>0&&(e+=r),{start:e,end:t}}},"./src/file-loaders/lmvtk/otg/HashStrings.js":
/*!***************************************************!*\
  !*** ./src/file-loaders/lmvtk/otg/HashStrings.js ***!
  \***************************************************/
/*! no static exports found */function(e,t){for(var n=new Array(256),r=0;r<256;r++){var i=r.toString(16);1===i.length&&(i="0"+i),n[r]=i}var o=new Array(20);var s=new Array(10);function a(e){for(var t=10===e.length?o:[],r=0;r<e.length;r++){var i=e.charCodeAt(r);t[2*r]=n[255&i],t[2*r+1]=n[i>>8&255]}return t.join("")}function l(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:0}e.exports={getHexStringPacked:function(e,t,n){for(var r=20===n?s:[],i=0;i<n;i+=2){var o=e[t+i],a=e[t+i+1];r[i/2]=a<<8|o}return String.fromCharCode.apply(null,r)},unpackHexString:a,hexToBin:function(e,t,n){for(var r=10===e.length?a(e):e,i=n,o=0;o<r.length;o+=2){var s=l(r.charCodeAt(o)),c=l(r.charCodeAt(o+1));t[i++]=s<<4|c}}}},"./src/file-loaders/lmvtk/otg/Otg.js":
/*!*******************************************!*\
  !*** ./src/file-loaders/lmvtk/otg/Otg.js ***!
  \*******************************************/
/*! exports provided: FLUENT_URN_PREFIX, DS_OTG_CDN_PREFIX, OtgPackage */function(e,t,n){"use strict";n.r(t),n.d(t,"FLUENT_URN_PREFIX",(function(){return f})),n.d(t,"DS_OTG_CDN_PREFIX",(function(){return p})),n.d(t,"OtgPackage",(function(){return m}));var r=n(/*! ../../net/Xhr */"./src/file-loaders/net/Xhr.js"),i=n(/*! ../../../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../common/SvfPlacementUtils */"./src/file-loaders/lmvtk/common/SvfPlacementUtils.js"),s=n(/*! ./HashStrings */"./src/file-loaders/lmvtk/otg/HashStrings.js"),a=n(/*! ../../../wgs/scene/LmvVector3 */"./src/wgs/scene/LmvVector3.js"),l=n(/*! ../../../wgs/scene/MeshFlags */"./src/wgs/scene/MeshFlags.js"),c=n(/*! ../../../wgs/scene/LmvBox3 */"./src/wgs/scene/LmvBox3.js"),u=n(/*! ../../../wgs/scene/LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js"),d=n(/*! ../../../wgs/scene/IntArray */"./src/wgs/scene/IntArray.js"),h=n(/*! ./ProgressiveReadContext */"./src/file-loaders/lmvtk/otg/ProgressiveReadContext.js"),f="urn:adsk.fluent:",p="$otg_cdn$";function m(){this.materials=null,this.fragments=null,this.geompacks=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],dbid:[]},this.bbox=null,this.animations=null,this.pendingRequests=0,this.globalOffset={x:0,y:0,z:0},this.pendingRequests=0,this.initialLoadProgress=0,this.materialIdToHash=[],this.aborted=!1}m.prototype.getMaterialHash=function(e){var t=this.materialIdToHash[e];if(t)return t;var n=this.materialHashes.byteStride,r=Object(s.getHexStringPacked)(this.materialHashes.hashes,e*n,n);return this.materialIdToHash[e]=r,r},m.prototype.getGeometryHash=function(e){var t=this.geomMetadata.byteStride;return Object(s.getHexStringPacked)(this.geomMetadata.hashes,e*t,t)},m.prototype.initEmptyLists=function(e){var t=this.fragments={};t.length=this.metadata.stats.num_fragments,t.numLoaded=0,t.boxes=e.fragmentTransformsDouble?new Float64Array(6*t.length):new Float32Array(6*t.length),t.transforms=e.fragmentTransformsDouble?new Float64Array(12*t.length):new Float32Array(12*t.length),t.materials=Object(d.allocateUintArray)(t.length,this.metadata.stats.num_materials),t.geomDataIndexes=Object(d.allocateUintArray)(t.length,this.metadata.stats.num_geoms),t.fragId2dbId=new Int32Array(t.length),t.visibilityFlags=new Uint8Array(t.length),t.mesh2frag={},t.topoIndexes=null,this.geomMetadata={hashes:null,byteStride:0,version:0,numLoaded:0,hashToIndex:{}},this.materialHashes={hashes:null,byteStride:0,version:0,numLoaded:0},this.materials={name:"LMVTK Simple Materials",version:"1.0",scene:{SceneUnit:8215,YIsUp:0},materials:{}}},m.prototype.loadAsyncResource=function(e,t,n,i){var o=this;this.pendingRequests++,t=Object(r.pathToURL)(t,e.basePath),r.ViewingService.getItem(e,t,(function(e){o.pendingRequests--,i(e)}),e.onFailureCallback,{responseType:n||"arraybuffer"})},m.prototype.loadAsyncProgressive=function(e,t,n,i,o){var s=this;t=Object(r.pathToURL)(t,e.basePath),r.ViewingService.getItem(e,t,(function(t,r){n.onEnd(t,r),s.postLoad(e,i,n,t)}),o||e.onFailureCallback,{responseType:"text",onprogress:function(e,t){if(s.aborted)return!0;n.onData(e,t,!1)}})},m.prototype.loadMetadata=function(e,t){var n=this;this.loadAsyncResource(e,t,"json",(function(r){n.metadata=r,n.manifest=n.metadata.manifest,n.numGeoms=n.metadata.stats.num_geoms,n.processMetadata(e),n.initEmptyLists(e);var i=n.metadata.manifest,s=i.shared_assets.pdb;for(var a in s)n.propertydb[a]&&n.propertydb[a].push({path:s[a],isShared:!0});var l=i.assets.pdb;for(var a in l)n.propertydb[a]&&n.propertydb[a].push({path:l[a],isShared:!1});i.assets.animations&&n.loadAsyncResource(e,i.assets.animations,"json",(function(e){n.animations=e,Object(o.transformAnimations)(n)})),i.assets.topology&&n.loadAsyncResource(e,t,"json",(function(e){n.topology=e})),e.onLoaderEvent("otg_root"),n.postLoad(e,"metadata")}))},m.prototype.loadFragmentList=function(e,t){var n=this,r=new a.LmvVector3,i=new a.LmvVector3,o={x:0,y:0,z:0,w:1},s=new u.LmvMatrix4(!0),d=new c.LmvBox3,f={x:0,y:0,z:0};var p=new h.ProgressiveReadContext((function(t,a){if(a-=1,!n.metadata)return!1;var c=t.idata(),u=t.fdata(),h=n.fragments,p=h.geomDataIndexes[a]=c[0],m=h.materials[a]=c[1],g=h.fragId2dbId[a]=c[2],v=c[3];if(p>n.geomMetadata.numLoaded||m>n.materialHashes.numLoaded)return!1;var y=h.mesh2frag[p];void 0===y?h.mesh2frag[p]=a:Array.isArray(y)?y.push(a):h.mesh2frag[p]=[y,a];var _=!(!n.dbIdFilter||n.dbIdFilter[g])||1&v?l.MeshFlags.MESH_NOTLOADED:0;h.visibilityFlags[a]=_;var b=n.metadata.fragmentTransformsOffset||f;r.set(u[4]+b.x,u[5]+b.y,u[6]+b.z),o.x=u[7],o.y=u[8],o.z=u[9],o.w=u[10],i.set(u[11],u[12],u[13]),s.compose(r,o,i),n.placementWithOffset&&s.multiplyMatrices(n.placementWithOffset,s);var x=s.elements,w=h.transforms,E=12*a;return w[E+0]=x[0],w[E+1]=x[1],w[E+2]=x[2],w[E+3]=x[4],w[E+4]=x[5],w[E+5]=x[6],w[E+6]=x[8],w[E+7]=x[9],w[E+8]=x[10],w[E+9]=x[12],w[E+10]=x[13],w[E+11]=x[14],d.min.x=-.5,d.min.y=-.5,d.min.z=-.5,d.max.x=.5,d.max.y=.5,d.max.z=.5,d.applyMatrix4(s),h.boxesLoaded||((w=h.boxes)[(E=6*a)+0]=d.min.x,w[E+1]=d.min.y,w[E+2]=d.min.z,w[E+3]=d.max.x,w[E+4]=d.max.y,w[E+5]=d.max.z),h.numLoaded=a+1,e.onLoaderEvent("fragment",a),!0}),52);return this.loadAsyncProgressive(e,t,p,"all_fragments"),p},m.prototype.handleHashListRequestFailures=function(e){this.metadata&&(this.geomHashListFailure&&this.metadata.stats.num_geoms>0&&e.onFailureCallback.apply(e,this.geomHashListFailure),this.matHashListFailure&&this.metadata.stats.num_materials>0&&e.onFailureCallback.apply(e,this.matHashListFailure),this.geomHashListFailure=null,this.matHashListFailure=null)},m.prototype.loadGeometryHashList=function(e,t){var n=this;var r=new h.ProgressiveReadContext((function(e,t){return!!n.metadata&&(n.geomMetadata.hashes||(n.geomMetadata.hashes=new Uint8Array(e.byteStride()*(n.numGeoms+1)),n.geomMetadata.byteStride=e.byteStride(),n.geomMetadata.version=e.version()),n.geomMetadata.hashes.set(e.bdata(),t*e.byteStride()),n.geomMetadata.numLoaded=t,!0)}),20);return this.loadAsyncProgressive(e,t,r,"geometry_ptrs",(function(){n.geomHashListFailure=arguments,n.handleHashListRequestFailures(e),n.postLoad(e,"geometry_ptrs",r)})),r},m.prototype.loadMaterialHashList=function(e,t){var n=this;var r=new h.ProgressiveReadContext((function(e,t){return!!n.metadata&&(n.materialHashes.hashes||(n.numMaterials=n.metadata.stats.num_materials,n.materialHashes.hashes=new Uint8Array(e.byteStride()*(n.numMaterials+1)),n.materialHashes.byteStride=e.byteStride(),n.materialHashes.version=e.version()),n.materialHashes.hashes.set(e.bdata(),t*e.byteStride()),n.materialHashes.numLoaded=t,!0)}),20);return this.loadAsyncProgressive(e,t,r,"material_ptrs",(function(){n.matHashListFailure=arguments,n.handleHashListRequestFailures(e),n.postLoad(e,"material_ptrs",r)})),r},m.prototype.processMetadata=function(e){var t=this.metadata;Object(o.initPlacement)(this,e);var n=this.placementWithOffset;if(t.cameras&&(this.cameras=t.cameras,n))for(var r=0;r<this.cameras.length;r++){var i=this.cameras[r];i.position=new a.LmvVector3(i.position.x,i.position.y,i.position.z),i.position.applyMatrix4(n),i.target=new a.LmvVector3(i.target.x,i.target.y,i.target.z),i.target.applyMatrix4(n),i.up=new a.LmvVector3(i.up.x,i.up.y,i.up.z),i.up.transformDirection(n)}},m.prototype.beginLoad=function(e,t){this.loadMetadata(e,t);var n=e.objectIds;if(n){this.dbIdFilter={};for(var r=0,i=n.length;r<i;r++)this.dbIdFilter[n[r]]=1}this.materialsCtx=this.loadMaterialHashList(e,"materials_ptrs.hl"),this.geometryCtx=this.loadGeometryHashList(e,"geometry_ptrs.hl"),this.fragmentsCtx=this.loadFragmentList(e,"fragments.fl")},m.prototype.makeSharedResourcePath=function(e,t,n){if(10===n.length&&(n=Object(s.unpackHexString)(n)),e){var i=n,o="";(c=this.manifest.shared_assets.global_sharding||0)&&(o="/"+n.slice(0,c),i=n.slice(c));var a=this.manifest.shared_assets[t];if(0===a.indexOf(f)||0===a.indexOf(p))a=a.slice(a.indexOf("/"));else{var l=a.split("/");a="/"+(l[l.length-1]||l[l.length-2])+"/"}return e+o+a+i}var c;i=n,o="";return(c=this.manifest.shared_assets.global_sharding||2)&&(o="/"+n.slice(0,c)+"/",i=n.slice(c)),Object(r.pathToURL)(this.basePath)+this.manifest.shared_assets[t]+o+i},m.prototype.postLoad=function(e,t,n,r){t&&this.initialLoadProgress++,4===this.initialLoadProgress?(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush(),this.materialsCtx=null,this.geometryCtx=null,this.fragmentsCtx=null,this.fragments.numLoaded<this.metadata.stats.num_fragments&&i.logger.warn("Fragments actually loaded fewer than expected."),e.onLoaderEvent("all_fragments")):"metadata"===t&&(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush())},m.prototype.abort=function(){this.aborted=!0}},"./src/file-loaders/lmvtk/otg/OtgGeomCodec.js":
/*!****************************************************!*\
  !*** ./src/file-loaders/lmvtk/otg/OtgGeomCodec.js ***!
  \****************************************************/
/*! exports provided: serializeLmvBufferGeom, readLmvBufferGeom */function(e,t,n){"use strict";n.r(t),n.d(t,"serializeLmvBufferGeom",(function(){return O})),n.d(t,"readLmvBufferGeom",(function(){return F}));var r=n(/*! ../../../compat */"./src/compat.js"),i=n(/*! ../common/InputStream */"./src/file-loaders/lmvtk/common/InputStream.js"),o=n(/*! ../../../wgs/scene/LmvBox3 */"./src/wgs/scene/LmvBox3.js"),s=0,a=1,l=2,c=3,u=4,d=5,h=0,f=1,p=2,m=3,g=4,v=5,y=6,_=7,b=8,x=9,w=10,E=1,A=2,M=3,S={position:l,normal:c,index:s,indexlines:a,color:d},T={};T[l]="position",T[c]="normal",T[s]="index",T[a]="indexlines",T[d]="color",T[u]="uv";var C={};function P(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);for(n=0;n<t.length;n++){if((i=t[n])[0]>i[1]){var r=i[0];i[0]=i[1],i[1]=r}}t.sort((function(e,t){return e[0]-t[0]}));var i=t[0],o=0;e[o]=i[0],e[o+1]=i[1]-i[0],o+=2;for(n=1;n<t.length;n++,o+=2)i=t[n],e[o]=i[0]-t[n-1][0],e[o+1]=i[1]-i[0]}function L(e){if(e.length){e[1]+=e[0],e[2]+=e[0];for(var t=3;t<e.length;t+=3)e[t]+=e[t-3],e[t+1]+=e[t],e[t+2]+=e[t]}}function D(e){if(e.length){e[1]+=e[0];for(var t=2;t<e.length;t+=2)e[t]+=e[t-2],e[t+1]+=e[t]}}function R(e){var t=T[e];return t||(console.error("Unknown vertex attribute"),u)}function I(){}function j(e){this.buffer=e,this.readOffset=0,this.meshFlag=0,this.numBuffers=0,this.numAttributes=0,this.bufferOffsets=[],this.attributes=[],this.buffers=[]}function O(e){var t=new I,n=[];if(!e.vb)return console.error("Unexpected non-interleaved vertex buffer"),null;n=[e.vb.byteLength,e.ib.byteLength],e.iblines&&n.push(e.iblines.byteLength);var r,i,o=Object.keys(e.attributes),s=0;e.isLines&&(s|=E),e.isWideLines&&(s|=M),e.isPoints&&(s|=A),t.beginHeader(s,o.length,n);for(var a=0;a<o.length;a++){var l=e.attributes[o[a]],c=(r=o[a],i=void 0,void 0!==(i=S[r])?i:(0===r.indexOf("uv")||console.warn("Unknown attribute name"),u));"index"===o[a]?t.addAttribute(c,l,0,1):"indexlines"===o[a]?t.addAttribute(c,l,0,2):t.addAttribute(c,l,e.vbstride,0)}t.endHeader();var d=Buffer.from(e.vb.buffer,e.vb.byteOffset,e.vb.byteLength);return t.addBuffer(d),e.isLines?P(e.ib):function(e){for(var t,n,r=[],i=0;i<e.length;i+=3)r.push([e[i],e[i+1],e[i+2]]);for(i=0;i<r.length;i++)for(var o=r[i];o[0]>o[1]||o[0]>o[2];)n=void 0,n=(t=o)[0],t[0]=t[1],t[1]=t[2],t[2]=n;r.sort((function(e,t){return e[0]-t[0]})),o=r[0];var s=0;for(e[s]=o[0],e[s+1]=o[1]-o[0],e[s+2]=o[2]-o[0],s+=3,i=1;i<r.length;i++,s+=3)o=r[i],e[s]=o[0]-r[i-1][0],e[s+1]=o[1]-o[0],e[s+2]=o[2]-o[0]}(e.ib),d=Buffer.from(e.ib.buffer,e.ib.byteOffset,e.ib.byteLength),t.addBuffer(d),e.iblines&&(P(e.iblines),d=Buffer.from(e.iblines.buffer,e.iblines.byteOffset,e.iblines.byteLength),t.addBuffer(d)),t.end()}C[h]=1,C[f]=2,C[p]=1,C[m]=2,C[g]=1,C[v]=2,C[y]=1,C[_]=2,C[b]=4,C[x]=4,C[w]=4,I.prototype.beginHeader=function(e,t,n){var r=8,i=n.length;for(r+=4*(i-1),r+=5*t;r%4!=0;)r++;for(var o=0,s=0;s<n.length;s++)o+=n[s];this.buffer=Buffer.alloc(r+o),this.writeOffset=0;for(s=0;s<4;s++)this.writeOffset=this.buffer.writeUInt8("OTG0".charCodeAt(s),this.writeOffset);this.writeOffset=this.buffer.writeUInt16LE(e,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(i,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(t,this.writeOffset);var a=n[0];for(s=1;s<n.length;s++)this.writeOffset=this.buffer.writeUInt32LE(a,this.writeOffset),a+=n[s]},I.prototype.addAttribute=function(e,t,n,r){this.writeOffset=this.buffer.writeUInt8(e,this.writeOffset),e===s||e===a?(this.writeOffset=this.buffer.writeUInt8(function(e){var t=m,n=e.bytesPerItem||2;return 1===n?t=p:2===n?t=m:4===n&&(t=w),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(n||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(r,this.writeOffset)):(this.writeOffset=this.buffer.writeUInt8(function(e){var t=b,n=e.bytesPerItem||4;return 1===n?t=e.normalize?y:p:2===n&&(t=e.normalize?_:m),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(n||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(r,this.writeOffset))},I.prototype.endHeader=function(){for(;this.writeOffset%4!=0;)this.writeOffset=this.buffer.writeUInt8(0,this.writeOffset)},I.prototype.addBuffer=function(e){e.copy(this.buffer,this.writeOffset),this.writeOffset+=e.length},I.prototype.end=function(){return this.writeOffset!==this.buffer.length&&console.error("Incorrect encoding buffer size"),this.buffer},j.prototype.readNodeJS=function(){if("OTG0"!==this.buffer.toString("ascii",0,4))return console.error("Invalid OTG header"),!1;if(this.readOffset=4,this.meshFlag=this.buffer.readUInt16LE(this.readOffset),this.readOffset+=2,this.numBuffers=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numAttributes=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numBuffers){this.bufferOffsets.push(0);for(var e=1;e<this.numBuffers;e++){var t=this.buffer.readUInt32LE(this.readOffset);this.readOffset+=4,this.bufferOffsets.push(t)}}for(e=0;e<this.numAttributes;e++){var n={};n.name=this.buffer.readUInt8(this.readOffset),this.readOffset++;var r=this.buffer.readUInt8(this.readOffset);this.readOffset++,n.itemSize=15&r,n.type=r>>4,n.bytesPerItem=C[n.type],n.normalize=n.type===g||n.type===v||n.type===y||n.type===_,n.itemOffset=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,n.itemStride=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,n.bufferIndex=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.attributes.push(n)}for(;this.readOffset%4!=0;)this.readOffset++;for(e=0;e<this.bufferOffsets.length;e++){var i,o=this.readOffset+this.bufferOffsets[e];i=e<this.bufferOffsets.length-1?this.readOffset+this.bufferOffsets[e+1]:this.buffer.length,this.buffers.push(this.buffer.slice(o,i))}return!0},j.prototype.readWeb=function(){var e=new i.InputStream(this.buffer);if("OTG0"!==e.getString(4))return console.error("Invalid OTG header"),!1;if(this.meshFlag=e.getUint16(),this.numBuffers=e.getUint8(),this.numAttributes=e.getUint8(),this.numBuffers){this.bufferOffsets.push(0);for(var t=1;t<this.numBuffers;t++){var n=e.getUint32();this.bufferOffsets.push(n)}}for(t=0;t<this.numAttributes;t++){var r={};r.name=e.getUint8();var o=e.getUint8();r.itemSize=15&o,r.type=o>>4,r.bytesPerItem=C[r.type],r.normalize=r.type===g||r.type===v||r.type===y||r.type===_,r.itemOffset=e.getUint8()/4,r.itemStride=e.getUint8()/4,r.bufferIndex=e.getUint8(),this.attributes.push(r)}for(;e.offset%4!=0;)e.offset++;for(t=0;t<this.bufferOffsets.length;t++){var s,a=e.offset+this.bufferOffsets[t];s=t<this.bufferOffsets.length-1?e.offset+this.bufferOffsets[t+1]:e.byteLength,this.buffers.push(this.buffer.subarray(a,s))}return!0},j.prototype.read=function(){return Object(r.isNodeJS)()&&this.buffer instanceof Buffer?this.readNodeJS():this.readWeb()};var N=new o.LmvBox3;N.min.x=-.5,N.min.y=-.5,N.min.z=-.5,N.max.x=.5,N.max.y=.5,N.max.z=.5;var k={center:{x:0,y:0,z:0},radius:Math.sqrt(.75)};function F(e,t){var n=new j(e);if(!n.read())return console.error("Failed to parse OTG geometry"),null;for(var r={vblayout:{},vb:new Float32Array(n.buffers[0].buffer,n.buffers[0].byteOffset,n.buffers[0].byteLength/4),isLines:(3&n.meshFlag)===E,isWideLines:(3&n.meshFlag)===M,isPoints:(3&n.meshFlag)===A,boundingBox:N,boundingSphere:k},i=0;i<n.attributes.length;i++){var o=n.attributes[i];if(o.name===s){var l=n.buffers[1];1===o.bytesPerItem?r.indices=l:2===o.bytesPerItem?r.indices=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/o.bytesPerItem):4===o.bytesPerItem&&(r.indices=new Uint32Array(l.buffer,l.byteOffset,l.byteLength/o.bytesPerItem)),r.isLines?D(r.indices):L(r.indices)}else if(o.name===a){if(!t){var c=n.buffers[2];1===o.bytesPerItem?r.iblines=c:2===o.bytesPerItem?r.iblines=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/o.bytesPerItem):4===o.bytesPerItem&&(r.iblines=new Uint32Array(c.buffer,c.byteOffset,c.byteLength/o.bytesPerItem)),D(r.iblines)}}else{var u=R(o.name);r.vbstride?r.vbstride!==o.itemStride&&console.error("Unexpected vertex buffer stride mismatch."):r.vbstride=o.itemStride,r.vblayout[u]={bytesPerItem:o.bytesPerItem,offset:o.itemOffset,normalize:o.normalize,itemSize:o.itemSize}}}return{mesh:r,packId:0,meshIndex:0}}},"./src/file-loaders/lmvtk/otg/OtgPriorityQueue.js":
/*!********************************************************!*\
  !*** ./src/file-loaders/lmvtk/otg/OtgPriorityQueue.js ***!
  \********************************************************/
/*! exports provided: computeFragImportance, updateGeomImportance, OtgPriorityQueue */function(e,t,n){"use strict";n.r(t),n.d(t,"computeFragImportance",(function(){return h})),n.d(t,"updateGeomImportance",(function(){return f})),n.d(t,"OtgPriorityQueue",(function(){return p}));var r=n(/*! ../../../wgs/scene/LmvVector3 */"./src/wgs/scene/LmvVector3.js"),i=n(/*! ../../../wgs/scene/LmvBox3 */"./src/wgs/scene/LmvBox3.js"),o=n(/*! ../../../wgs/scene/FrustumIntersector */"./src/wgs/scene/FrustumIntersector.js");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,l=(a=null,function(e,t,n){return a||(a=new r.LmvVector3),a.copy(e),a.max(t),a.min(n),a.distanceToSquared(e)});function c(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n}function u(e,t){return t.importance-e.importance}var d=new i.LmvBox3;function h(e,t,n){var r=function(e,t,n){var r=6*t;return n.min.y=e[r+1],n.min.z=e[r+2],n.min.x=e[r+0],n.max.x=e[r+3],n.max.y=e[r+4],n.max.z=e[r+5],n}(t,e,d),i=n.intersectsBox(r);if(i===o.OUTSIDE)return 0;var s=i===o.CONTAINS,a=n.projectedBoxArea(r,s),c=l(n.eye,r.min,r.max);return a/(c=Math.max(c,.01))}function f(e,t){var n=e.getFragmentList(),r=n.getGeometry(t);if(n.getWorldBounds(t,d),r){var i,o,s,a,l=r.importance||0,c=(o=(i=d).max.x-i.min.x,s=i.max.y-i.min.y,a=i.max.z-i.min.z,2*(o*s+s*a+a*o));r.importance=Math.max(l,c)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.waitingTasks=[],this.urgentHashes={},this.prevNumTasks=0,this.fullSortDone=!1,this.lastCamPos=new r.LmvVector3,this.lastCamTarget=new r.LmvVector3,this.lastVisibleModelIds=[]}var t,n,i;return t=e,(n=[{key:"checkCameraChanged",value:function(e,t){return!(c(this.lastCamPos,e,.01)&&c(this.lastCamTarget,t,.01)||(this.lastCamPos.copy(e),this.lastCamTarget.copy(t),0))}},{key:"checkModelsChanged",value:function(){var e=this.viewer.impl.modelQueue().getModels(),t=!1;e.length!==this.lastVisibleModelIds.length&&(this.lastVisibleModelIds.length=e.length,t=!0);for(var n=0;n<e.length;n++){var r=this.lastVisibleModelIds[n],i=e[n].id;r!==i&&(this.lastVisibleModelIds[n]=i,t=!0)}return t}},{key:"validateRequestPriorities",value:function(){var e=this.viewer.impl.camera,t=e.position,n=e.target,r=this.checkCameraChanged(t,n),i=this.checkModelsChanged();if(r||i)for(var o=0;o<this.waitingTasks.length;o++)this.waitingTasks[o].importanceNeedsUpdate=!0}},{key:"updateRequestPriorities",value:function(){var e=performance.now();this.validateRequestPriorities();var t=this.viewer.impl.modelQueue(),n=t.frustum(),r=t.getModels();n.reset(this.viewer.impl.camera);var i=!1,o=0===this.prevNumTasks||this.waitingTasks.length-this.prevNumTasks>3e3||!this.fullSortDone;this.fullSortDone=!o,this.prevNumTasks=this.waitingTasks.length;for(var s=0;s<this.waitingTasks.length;s++){var a=this.waitingTasks[s];if(a.importanceNeedsUpdate)if(this.urgentHashes[a.hash])a.importance=1/0;else{if(s%10==0&&performance.now()-e>10){i=!0;break}a.importanceNeedsUpdate=!1,a.importance=0;for(var l=0,c=a.hash,d=0;d<r.length;d++){var f=r[d];if(f.isOTG()){var p=f.myData,m=p.fragments,g=m.boxes,v=p.geomMetadata.hashToIndex[c];if(v&&m.mesh2frag){var y=m.mesh2frag[v];if("number"==typeof y)l+=h(y,g,n);else if(Array.isArray(y))for(var _=0;_<y.length;_++)l+=h(y[_],g,n)}}}if(a.importance=l,!o){for(d=s;d>0&&l>this.waitingTasks[d-1].importance;)this.waitingTasks[d]=this.waitingTasks[d-1],d--;this.waitingTasks[d]=a}}}return o&&!i&&(this.waitingTasks.sort(u),this.fullSortDone=!0),!i}},{key:"makeUrgent",value:function(e){var t=0;for(var n in e)!0===e[n]&&(this.urgentHashes[n]=!0,t++);if(0===t)return 0;for(var r=0;r<this.waitingTasks.length;r++){var i=this.waitingTasks[r];this.urgentHashes[i.hash]&&(i.importance=1/0)}return this.waitingTasks.sort(u),t}},{key:"removeUrgent",value:function(e){delete this.urgentHashes[e]}},{key:"addTask",value:function(e){this.waitingTasks.push(e)}},{key:"takeTask",value:function(){return this.waitingTasks.shift()}},{key:"isEmpty",value:function(){return 0===this.waitingTasks.length}}])&&s(t.prototype,n),i&&s(t,i),e}()},"./src/file-loaders/lmvtk/otg/ProgressiveReadContext.js":
/*!**************************************************************!*\
  !*** ./src/file-loaders/lmvtk/otg/ProgressiveReadContext.js ***!
  \**************************************************************/
/*! exports provided: ProgressiveReadContext */function(e,t,n){"use strict";n.r(t),n.d(t,"ProgressiveReadContext",(function(){return i}));var r=n(/*! ../../../logger/Logger */"./src/logger/Logger.js");function i(e,t){var n,i,o,s,a,l=0;function c(e){var l=new Uint8Array(4);if("string"==typeof e)for(var c=0;c<4;c++)l[c]=e.charCodeAt(c);else for(var u=0;u<4;u++)l[u]=e[u];(n=l[1]<<8|l[0])||(n=t||0),n||r.logger.error("Unknwon byte stride."),n%4&&r.logger.error("Expected byte size to be multiple of 4, but got "+n),i=l[3]<<8|l[2],n/4,o=new Uint8Array(n),s=new Float32Array(o.buffer),a=new Uint32Array(o.buffer)}this.onData=function(t,r,i){void 0===r&&(r=t.length);for(var s="string"==typeof t;;){if(!l&&r>=4)c(t),l++;else if(r<4)return!1;var a=l*n;if(r<a+n)return i;if(s)for(var u=0;u<n;u++)o[u]=255&t.charCodeAt(u+a);else for(var d=0;d<n;d++)o[d]=t[d+a];if(!e(this,l))return!1;l++}},this.onEnd=function(e,t){this.onData(e,t,!0)||(this.rawData=e,this.rawLength=t)},this.flush=function(){this.rawData&&(this.onData(this.rawData,this.rawLength,!0)&&(this.rawData=null))},this.idata=function(){return a},this.fdata=function(){return s},this.bdata=function(){return o},this.version=function(){return i},this.byteStride=function(){return n}}},"./src/file-loaders/loader-extensions.js":
/*!***********************************************!*\
  !*** ./src/file-loaders/loader-extensions.js ***!
  \***********************************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),t.default=Object.freeze({pdf:"Bimfish.PDF",scalaris:"Bimfish.Scalaris"})},"./src/file-loaders/main/F2DLoader.js":
/*!********************************************!*\
  !*** ./src/file-loaders/main/F2DLoader.js ***!
  \********************************************/
/*! exports provided: OUTPUT_TYPE, F2DLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"OUTPUT_TYPE",(function(){return v})),n.d(t,"F2DLoader",(function(){return y}));var r=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ../../wgs/scene/BufferGeometry */"./src/wgs/scene/BufferGeometry.js"),o=n(/*! ../net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),s=n(/*! ../../application/ProgressState */"./src/application/ProgressState.js"),a=n(/*! ../../application/FileLoaderManager */"./src/application/FileLoaderManager.js"),l=n(/*! ../net/Xhr */"./src/file-loaders/net/Xhr.js"),c=n(/*! ./WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),u=n(/*! ./PropDbLoader */"./src/file-loaders/main/PropDbLoader.js"),d=n(/*! ../../compat */"./src/compat.js"),h=n(/*! ../../application/EventTypes */"./src/application/EventTypes.js"),f=n(/*! ./TextureLoader */"./src/file-loaders/main/TextureLoader.js"),p=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),m=n(/*! ../../application/Model */"./src/application/Model.js"),g=n(/*! three */"./thirdparty/three.js/three.js"),v={GEOMETRY:"geometry",VERTEX_BUFFER:"vertexBuffer"};function y(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new g.Matrix4,this.logger=r.logger,this.loadTime=0,this.useInstancing=this.viewer3DImpl.use2dInstancing}y.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,r.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,r.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,r.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.loadTime=0,this.svf=null,this.model=null,this.options=null},y.prototype.isValid=function(){return!!this.viewer3DImpl},y.prototype.loadFile=function(e,t,n,i){if(!this.viewer3DImpl)return r.logger.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return r.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var o=e.indexOf("urn:");if(-1!=o){var s=(e=decodeURIComponent(e)).substr(o,e.substr(o).indexOf("/"));r.logger.log("Extracted URN: "+s);var a=s.lastIndexOf(":");this.svfUrn=s.substr(a+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var l=this;return this.initWorkerScriptToken=Object(c.initWorkerScript)((function(){l.loadFydoCB(e,t,n,i)})),!0},y.prototype.loadFydoCB=function(e,t,n,i){this.t0=Date.now();var a=Object(l.pathToURL)(e);this.streamingWorker=Object(c.createWorker)(),this.parsingWorker=Object(c.createWorker)();var u=this,f=!0,m=function(){u.parsingWorker.terminate(),u.parsingWorker=null};this.streamingWorker.addEventListener("message",(function(e){var l;u.isValid()&&(f&&i&&(f=!1,i()),e.data&&"F2DBLOB"==e.data.type?(l={operation:"PARSE_F2D",data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,isMobile:Object(d.isMobileDevice)(),useInstancing:u.useInstancing,excludeTextGeometry:t.excludeTextGeometry,outputType:t.outputType||v.VERTEX_BUFFER},url:a},u.parsingWorker.doOperation(l,[l.data]),u.streamingWorker.terminate(),u.streamingWorker=null):e.data&&"F2DSTREAM"==e.data.type?(l={operation:"PARSE_F2D_FRAME",data:e.data.frames,url:a,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,isMobile:Object(d.isMobileDevice)(),useInstancing:u.useInstancing,excludeTextGeometry:t.excludeTextGeometry,outputType:t.outputType||v.VERTEX_BUFFER}},e.data.metadata&&(l.metadata=e.data.metadata,l.manifest=e.data.manifest),e.data.finalFrame&&(l.finalFrame=!0,u.streamingWorker.terminate(),u.streamingWorker=null,u.fileMemorySize/=2),e.data.progress&&u.viewer3DImpl.signalProgress(100*e.data.progress,s.ProgressState.LOADING),u.parsingWorker.doOperation(l,l.data?[l.data]:void 0)):e.data&&"F2DAssetURL"==e.data.type||e.data&&e.data.assetRequest||e.data&&e.data.progress||(e.data&&e.data.debug?r.logger.debug(e.data.message):e.data&&e.data.error?(u.loading=!1,u.streamingWorker.terminate(),u.streamingWorker=null,n&&n(e.data.error)):(r.logger.error("F2D download failed.",Object(o.errorCodeString)(o.ErrorCodes.NETWORK_FAILURE)),u.loading=!1,u.streamingWorker.terminate(),u.streamingWorker=null)))}),!1);var y=t.outputType===v.GEOMETRY?function(e){if(u.isValid()&&(f&&i&&(f=!1,i()),e.data&&e.data.f2d)){u.svf=e.data.f2d;var t=e.data.f2d.geometry;m(),r.logger.info("Num polylines: "+t.numPolylines),r.logger.info("Line segments: "+t.numLineSegs),r.logger.info("Circular arcs: "+t.numCircles),r.logger.info("Ellipitcal arcs:"+t.numEllipses),u.onModelRootLoadDone(u.svf),n&&n(null,u.model),u.viewer3DImpl.api.dispatchEvent({type:h.MODEL_ROOT_LOADED_EVENT,svf:u.svf,model:u.model}),u.onGeomLoadDone()}}:function(e){var t,s;if(u.isValid())if(f&&i&&(f=!1,i()),e.data&&e.data.f2d){for(t=u.svf=e.data.f2d,m(),r.logger.info("Num polylines: "+t.numPolylines),r.logger.info("Line segments: "+t.numLineSegs),r.logger.info("Circular arcs: "+t.numCircles),r.logger.info("Ellipitcal arcs:"+t.numEllipses),r.logger.info("Plain triangles:"+t.numTriangles),r.logger.info("Total # of op codes generated by fydo.parse: "+t.opCount),u.onModelRootLoadDone(u.svf),n&&n(null,u.model),u.viewer3DImpl.api.dispatchEvent({type:h.MODEL_ROOT_LOADED_EVENT,svf:u.svf,model:u.model}),s=0;s<t.meshes.length;s++)u.processReceivedMesh2D(t.meshes[s],s);t.meshes=null,u.onGeomLoadDone(),u.loading=!1}else if(e.data&&e.data.f2dframe){var a=0;if(e.data.meshes){var l=e.data.bbox;u.svf.bbox=new g.Box3(l.min,l.max),a=e.data.baseIndex}else u.svf=e.data.f2dframe,a=e.data.baseIndex;if((t=u.svf).fragments&&t.fragments.initialized||(u.onModelRootLoadDone(t),n&&n(null,u.model),u.viewer3DImpl.api.dispatchEvent({type:h.MODEL_ROOT_LOADED_EVENT,svf:t,model:u.model})),e.data.meshes&&e.data.meshes.length)for(s=0;s<e.data.meshes.length;s++)u.processReceivedMesh2D(e.data.meshes[s],a+s);if(e.data.finalFrame){var c=e.data.cumulativeProps;for(var d in c)t[d]=c[d];m(),u.onGeomLoadDone(),u.loading=!1}}else e.data&&e.data.progress||(e.data&&e.data.debug?r.logger.debug(e.data.message):e.data&&e.data.error?(u.loading=!1,m(),r.logger.error("Error while processing F2d: "+JSON.stringify(e.data.error.args)),n&&n(e.data.error)):(r.logger.error("F2D download failed.",Object(o.errorCodeString)(o.ErrorCodes.NETWORK_FAILURE)),u.loading=!1,m()))};this.parsingWorker.addEventListener("message",y,!1);var _={operation:"STREAM_F2D",url:a,objectIds:t.ids,queryParams:this.queryParams};return this.streamingWorker.doOperation(p.endpoint.initLoadContext(_)),!0},y.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf,o=n.fragments,s=o.mesh2frag[t];if(void 0!==s){Array.isArray(s)||(s=[s]);var a=e.mesh;if(i.BufferGeometryUtils.meshToGeometry(e),e.geometry.unpackXform=a.unpackXform,a.texData){var l=new g.DataTexture(new Uint8Array(a.texData.buffer),a.texData.length,1,g.RGBAFormat,g.UnsignedByteType,g.UVMapping,g.ClampToEdgeWrapping,g.ClampToEdgeWrapping,g.NearestFilter,g.NearestFilter,0);l.generateMipmaps=!1,l.flipY=!1,l.needsUpdate=!0,e.geometry.tIdColor=l,e.geometry.vIdColorTexSize=new g.Vector2(a.texData.length,1)}var c=s.length,u=this.model;u.getGeometryList().addGeometry(e.geometry,c,e.meshIndex+1);for(var d=(e.geometry.attributes.index.array||e.geometry.ib).length/3,h=0;h<s.length;h++){var f=0|s[h];u.getFragmentList().getOriginalWorldMatrix(f,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new g.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var p=o.materials[f].toString();o.polygonCounts&&(o.polygonCounts[f]=d);var m=this.viewer3DImpl.setupMesh(this.model,e.geometry,p,this.tmpMatrix);u.activateFragment(f,m)}o.mesh2frag[t]=null,o.numLoaded+=s.length;var v=o.numLoaded;n.geomPolyCount>n.nextRepaintPolys&&(n.numRepaints++,n.nextRepaintPolys+=1e4*Math.pow(1.5,n.numRepaints),this.viewer3DImpl.invalidate(!1,!0)),v%20==0&&this.viewer3DImpl.invalidate(!1,!0)}else r.logger.warn("Mesh "+t+" was not referenced by any fragments.")},y.prototype.processReceivedMesh2D=function(e,t){t>=this.bufferCount&&(this.bufferCount=t+1);var n={mesh:e,is2d:!0,packId:"0",meshIndex:t},r="0:"+t,i=this.svf.fragments;if(!i.fragId2dbId[t]){var o=Object.keys(n.mesh.dbIds).map((function(e){return parseInt(e)}));i.fragId2dbId[t]=o;for(var s=0;s<o.length;s++){var a=o[s],l=i.dbId2fragId[a];Array.isArray(l)?l.push(t):i.dbId2fragId[a]=void 0!==l?[l,t]:t}e.material.modelScale=this.modelScale;var c=this.viewer3DImpl;i.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.model,e.material,!1,!1,(function(e,t){var n=t.getData();f.TextureLoader.requestsInProgress()||!n.loadDone||n.texLoadDone||(n.texLoadDone=!0,c.onTextureLoadComplete(t)),Object(d.isMobileDevice)()&&f.TextureLoader.requestsInProgress()||c.invalidate(!1,!0,!1)})),i.length++}i.mesh2frag[r]=t,this.processReceivedMesh(n)},y.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId={},e.fragments.length=0,e.fragments.initialized=!0,e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var t=this.currentLoadPath.lastIndexOf("/");-1!=t&&(e.basePath=this.currentLoadPath.substr(0,t+1)),e.loadOptions=this.options;var n=Date.now();this.loadTime+=n-this.t0,r.logger.log("SVF load: "+(n-this.t0)),this.t0=n,e.bbox=(new g.Box3).copy(e.bbox);var i=this.model=new m.Model(e);i.loader=this,i.initialize(),this.options.skipPropertyDb||(this.svf.propDbLoader=new u.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),r.logger.log("scene bounds: "+JSON.stringify(e.bbox));var o={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};r.logger.track(o),this.viewer3DImpl.signalProgress(5,s.ProgressState.ROOT_LOADED,this.model),this.viewer3DImpl.invalidate(!1,!1)},y.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var e=Date.now(),t="Fragments load time: "+(e-this.t0);this.loadTime+=e-this.t0,f.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipPropertyDb||this.loadPropertyDb(),r.logger.log(t);var n={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};r.logger.track(n,!0),this.currentLoadPath=null,this.isf2d=void 0,this.viewer3DImpl.onLoadComplete(this.model)},y.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},y.prototype.is3d=function(){return!1},a.FileLoaderManager.registerFileLoader("f2d",["f2d"],y)},"./src/file-loaders/main/LeafletLoader.js":
/*!************************************************!*\
  !*** ./src/file-loaders/main/LeafletLoader.js ***!
  \************************************************/
/*! exports provided: LeafletLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"LeafletLoader",(function(){return p}));var r=n(/*! ../../application/ProgressState */"./src/application/ProgressState.js"),i=n(/*! ../net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),o=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ../net/Xhr */"./src/file-loaders/net/Xhr.js"),a=n(/*! ../../wgs/scene/ModelIteratorTexQuad */"./src/wgs/scene/ModelIteratorTexQuad.js"),l=n(/*! ./TextureLoader */"./src/file-loaders/main/TextureLoader.js"),c=n(/*! ../../application/FileLoaderManager */"./src/application/FileLoaderManager.js"),u=n(/*! ../../application/Model */"./src/application/Model.js"),d=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),h=n(/*! ../../application/EventTypes */"./src/application/EventTypes.js"),f=n(/*! three */"./thirdparty/three.js/three.js");function p(e){var t=e;this.isLeafletLoader=!0;var n=function(e,t){var n=[80,75,1,2],r=t;if(e[r++]!==n[0]||e[r++]!==n[1]||e[r++]!==n[2]||e[r++]!==n[3])return o.logger.error("invalid file header signature"),null;var i={};return i.version=e[r++],i.os=e[r++],i.needVersion=e[r++]|e[r++]<<8,i.flags=e[r++]|e[r++]<<8,i.compression=e[r++]|e[r++]<<8,i.time=e[r++]|e[r++]<<8,i.date=e[r++]|e[r++]<<8,i.crc32=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,i.compressedSize=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,i.plainSize=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,i.fileNameLength=e[r++]|e[r++]<<8,i.extraFieldLength=e[r++]|e[r++]<<8,i.fileCommentLength=e[r++]|e[r++]<<8,i.diskNumberStart=e[r++]|e[r++]<<8,i.internalFileAttributes=e[r++]|e[r++]<<8,i.externalFileAttributes=e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24,i.relativeOffset=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,i.filename=String.fromCharCode.apply(null,e.slice(r,r+=i.fileNameLength)),i.extraField=e.slice(r,r+=i.extraFieldLength),i.comment=e.slice(r,r+i.fileCommentLength),i.length=r-t,i},c=function(e){var t=function(e){var t=[80,75,3,4],n=0;if(e[n++]!==t[0]||e[n++]!==t[1]||e[n++]!==t[2]||e[n++]!==t[3])return o.logger.error("invalid local file header signature"),null;var r={};return r.needVersion=e[n++]|e[n++]<<8,r.flags=e[n++]|e[n++]<<8,r.compression=e[n++]|e[n++]<<8,r.time=e[n++]|e[n++]<<8,r.date=e[n++]|e[n++]<<8,r.crc32=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.compressedSize=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.plainSize=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.fileNameLength=e[n++]|e[n++]<<8,r.extraFieldLength=e[n++]|e[n++]<<8,r.filename=String.fromCharCode.apply(null,e.slice(n,n+=r.fileNameLength)),r.extraField=e.slice(n,n+=r.extraFieldLength),r.length=n,r}(e),n=t.length,r=t.compressedSize;return e.slice(n,n+r)};this.continueLoadFile=function(e,n,i,s,l,c){var d,p=this;n.loadOptions&&n.loadOptions.loadFromZip?d="{z}/{x}_{y}."+n.loadOptions.mime.split("/")[1]:d=e;l.initFromLoadOptions(d,n.loadOptions,c);var m=null;s&&s(),!l.valid()&&l.initForSimpleImage(e),l.onRootLoaded=function(){var s=new function(n){this.bbox=new f.Box3,this.basePath=e,this.is2d=!0;var i=n&&n.paperWidth>=0?n.paperWidth:l.texWidth,o=n&&n.paperHeight>=0?n.paperHeight:l.texHeight;this.pageToModelTransform=l.getPageToModelTransform(i,o),this.metadata={},this.metadata.page_dimensions={};var s=this.metadata.page_dimensions;s.page_width=i,s.page_height=o,s.page_units=n.paperUnits,this.loadDone=!0,this.isLeaflet=!0,t.signalProgress(100,r.ProgressState.LOADING),l.texWidth>0&&(this.maxPixelPerUnit=l.texWidth/l.getQuadWidth(),l.isSimpleImage&&(this.maxPixelPerUnit*=10))}(n.loadOptions);s.loadOptions=n,m.getVisibleBounds(s.bbox);var a=new u.Model(s);a.initFromCustomIterator(m),a.loader=p,t.api.dispatchEvent({type:h.MODEL_ROOT_LOADED_EVENT,svf:s,model:a}),m.callWhenRefined((function(){var e=Date.now();s.loadTime=e-p.t0,o.logger.log("SVF load: "+s.loadTime)})),i(null,a)},l.onDone=i,l.pixelRatio=t.glrenderer().getPixelRatio(),(m=new a.ModelIteratorTexQuad(l,t.getMaterials())).requestRootTile()},this.loadFile=function(e,t,r,u){var h=this;this.t0=Date.now();var p=new a.TexQuadConfig,m=null,g=t.acmSessionId;if(t.loadOptions&&t.loadOptions.loadFromZip){m=function(e,t,n){for(var r,i=e.split("/")[0]-p.levelOffset,o=0;o<p.zips.length;o++)if(i<=p.zips[o].zipMaxLevel){r=p.zips[o];break}if(!r)return n("Failed loading texture - tile's level doesn't exists."),!1;var s=r.fileTable[e];if(!s)return n("Failed loading texture - entry does not exist inside fileTable."),!1;var a={extractImage:c},u=s.relativeOffset,d=s.relativeOffset+s.contentSize;r.rawData?a.rawData=r.rawData.slice(u,d):a.range={min:u,max:d},l.TextureLoader.loadTextureWithSecurity(r.urnZip,f.UVMapping,t,n,g,!0,a)};t.loadOptions.zips.forEach((function(a){var l=a.centralDirOffset,c=a.centralDirLength,f=a.centralDirEntries;!function(e,t,n,r,i,o){var a=null,l={};Object(d.isOffline)()||(t&&(a="acmsession="+t),l.range={min:n,max:r+n});var c=Object(d.initLoadContext)({queryParams:a});s.ViewingService.getItem(c,e,i,o,l)}(a.urnZip,g,l,c,(function(i){Object(d.isOffline)()&&(a.rawData=i,i=i.slice(l,l+c));var o=function(e,t,r){for(var i,o=0,s={},a=null,l=0;l<r;++l){if(!(i=n(e,o)))return null;a&&(a.contentSize=i.relativeOffset-a.relativeOffset),o+=i.length,s[i.filename]=i,a=i}return a.contentSize=t-a.relativeOffset,s}(i,l,f);if(!o)return r("Failed parsing central directory of the zip.",null),!1;a.fileTable=o,t.loadOptions.zips.every((function(e){return Object.keys(e.fileTable).length>0}))&&h.continueLoadFile(e,t,r,u,p,m)}),(function(e){o.logger.error("Zip download failed: "+e.statusText,Object(i.errorCodeString)(i.ErrorCodes.NETWORK_FAILURE)),r("Zip download failed: "+e.statusText,null)}))}))}else m=function(e,t,n){l.TextureLoader.loadTextureWithSecurity(e,f.UVMapping,t,n,g,!0)},this.continueLoadFile(e,t,r,u,p,m)},this.dtor=function(){}}p.computeLevelOffset=function(e){for(var t=1,n=0,r=0;r<20;r++){if((t*=2)>e)return n;n++}return o.logger.log("unexpected leaflet tileSize"),0},p.prototype.is3d=function(){return!1},c.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],p)},"./src/file-loaders/main/OtgLoader.js":
/*!********************************************!*\
  !*** ./src/file-loaders/main/OtgLoader.js ***!
  \********************************************/
/*! exports provided: OtgLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"OtgLoader",(function(){return w}));var r=n(/*! ../../wgs/scene/LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js"),i=n(/*! ../../wgs/scene/LmvBox3 */"./src/wgs/scene/LmvBox3.js"),o=n(/*! ../../wgs/scene/LmvVector3 */"./src/wgs/scene/LmvVector3.js"),s=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),a=n(/*! ./TextureLoader */"./src/file-loaders/main/TextureLoader.js"),l=n(/*! ../../wgs/scene/BVHBuilder */"./src/wgs/scene/BVHBuilder.js"),c=n(/*! ../../wgs/scene/MeshFlags */"./src/wgs/scene/MeshFlags.js"),u=n(/*! ./PropDbLoader */"./src/file-loaders/main/PropDbLoader.js"),d=n(/*! ./WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),h=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),f=n(/*! ../net/Xhr */"./src/file-loaders/net/Xhr.js"),p=n(/*! ../lmvtk/otg/Otg */"./src/file-loaders/lmvtk/otg/Otg.js"),m=n(/*! ../../application/FileLoaderManager */"./src/application/FileLoaderManager.js"),g=n(/*! ../../application/Model */"./src/application/Model.js"),v=n(/*! ../../application/EventTypes */"./src/application/EventTypes.js"),y=n(/*! ../../application/ProgressState */"./src/application/ProgressState.js"),_=n(/*! ../../compat */"./src/compat.js"),b=n(/*! ./OtgResourceCache */"./src/file-loaders/main/OtgResourceCache.js"),x=n(/*! ../lmvtk/common/StringUtils */"./src/file-loaders/lmvtk/common/StringUtils.js");function w(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new r.LmvMatrix4,this.tmpBox=new i.LmvBox3,this.logger=s.logger,this.loadTime=0,this.pendingMaterials={},this.pendingMaterialsCount=0,this.pendingMeshes={},this.pendingMeshesCount=0,this.operationsDone=0}function E(e){return Math.floor(100*e.fragsLoaded/e.metadata.stats.num_fragments)}w.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,s.logger.debug("SVF loader dtor: on init worker script.")),this.bvhWorker&&(this.bvhWorker.clearAllEventListenerWithIntercept(),this.bvhWorker.terminate(),this.bvhWorker=null,s.logger.debug("SVF loader dtor: on svf worker.")),this.svf&&(this.svf.loadDone||console.log("stopping load before it was complete"),this.svf.abort(),this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null)),this.viewer3DImpl.geomCache()&&this.model&&(this.loading&&this.viewer3DImpl.geomCache().cancelRequests(this.svf.geomMetadata.hashToIndex),this.removeMeshReceiveListener()),this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.tmpMatrix=null,this.loading=!1,this.loadTime=0},w.prototype.isValid=function(){return null!=this.viewer3DImpl},w.prototype.removeMeshReceiveListener=function(){this.meshReceiveListener&&(this.viewer3DImpl.geomCache().updateMruTimestamps(),this.viewer3DImpl.geomCache().removeEventListener(b.MESH_RECEIVE_EVENT,this.meshReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(b.MESH_FAILED_EVENT,this.meshReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(b.MATERIAL_RECEIVE_EVENT,this.materialReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(b.MATERIAL_FAILED_EVENT,this.materialReceiveListener),this.meshReceiveListener=null)},w.prototype.loadFile=function(e,t,n,r){if(!this.viewer3DImpl)return s.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return s.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;if(this.loading=!0,this.viewer3DImpl._addLoadingFile(this),t.acmSessionId)this.svfUrn=t.acmSessionId.split(",")[0];else{console.warn("DEPRECATED: Automatic derivation of URN will be removed in a future release. Please set the acmSessionId parameter when loading OTG data.");var i=e.indexOf(p.FLUENT_URN_PREFIX);if(-1===i&&(i=e.indexOf(p.DS_OTG_CDN_PREFIX)),-1!==i){var o=e.split("/"),a=o[1],l=o[2],c=btoa(a+"?version="+l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");this.svfUrn=c}}this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e;var u="",d=this.currentLoadPath.lastIndexOf("/");-1!=d&&(u=this.currentLoadPath.substr(0,d+1)),this.basePath=u,this.acmSessionId=t.acmSessionId,this.options=t,this.queryParams=t.acmSessionId?"acmsession="+t.acmSessionId:"",t.bypassds&&(this.queryParams=this.queryParams.length?"".concat(this.queryParams,"&bypassds=1"):"bypassds=1");var m={basePath:u,objectIds:t.ids,globalOffset:t.globalOffset,fragmentTransformsDouble:t.fragmentTransformsDouble,placementTransform:t.placementTransform,applyRefPoint:t.applyRefPoint,queryParams:this.queryParams,bvhOptions:t.bvhOptions||{isWeakDevice:Object(_.isMobileDevice)()},applyScaling:t.applyScaling,loadInstanceTree:t.loadInstanceTree};return this.loadContext=Object(h.initLoadContext)(m),m.raiseError=function(e,t,r){n&&n({code:e,msg:t,args:r})},m.onFailureCallback=f.ViewingService.defaultFailureCallback.bind(m),this.loadModelRoot(m,n),r&&r(),!0},w.prototype.loadModelRoot=function(e,t){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null;var n=this,r=!1,i={};this.initWorkerScriptToken=Object(d.initWorkerScript)((function(){for(var t in r=!0,i)i.hasOwnProperty(t)&&i[t].forEach((function(n){e.onLoaderEvent(t,n)}));i={}}));var o=this.svf=new p.OtgPackage;return o.basePath=e.basePath,e.onLoaderEvent=function(e,a){if(n.svf){if(!r)return i.hasOwnProperty(e)||(i[e]=[]),void i[e].push(a);if("otg_root"===e){n.onModelRootLoadDone(o),t&&t(null,n.model),n.makeBVHInWorker();var l=n.viewer3DImpl.geomCache();l||s.logger.error("geomCache is required for loading OTG models."),l.initWorker(n.options.acmSessionId),n.meshReceiveListener=function(e){e.error&&e.error.args?n.onMeshError(e):n.onMeshReceived(e.geom)},l.addEventListener(b.MESH_RECEIVE_EVENT,n.meshReceiveListener),l.addEventListener(b.MESH_FAILED_EVENT,n.meshReceiveListener),n.materialReceiveListener=function(e){!e.error&&e.material&&e.material.length?n.onMaterialLoaded(Object(x.blobToJson)(e.material),e.hash):n.onMaterialLoaded(null,e.hash)},l.addEventListener(b.MATERIAL_RECEIVE_EVENT,n.materialReceiveListener),l.addEventListener(b.MATERIAL_FAILED_EVENT,n.materialReceiveListener),n.svf.loadDone=!1}else if("fragment"===e)n.options.skipMeshLoad||n.tryToActivateFragment(a,"fragment"),n.options.onFragmentListLoadProgress&&n.trackFragmentListLoadProgress();else if("all_fragments"===e)n.options.skipPropertyDb||n.loadPropertyDb(),n.viewer3DImpl.api.fireEvent({type:v.MODEL_ROOT_LOADED_EVENT,svf:o,model:n.model}),n.options.skipMeshLoad||!n.svf.fragments.length?n.onGeomLoadDone():n.onOperationComplete();else if("bvh"===e){var c=a;n.model&&(n.model.setBVH(c.nodes,c.primitives,n.options.bvhOptions),n.viewer3DImpl&&n.viewer3DImpl.modelVisible(n.model.id)&&n.viewer3DImpl.invalidate(!1,!0)),n.onOperationComplete()}}else console.error("load callback called after load was aborted")},o.beginLoad(e,Object(f.pathToURL)(n.currentLoadPath)),!0},w.prototype.makeBVHInWorker=function(){var e=this;e.bvhWorker=Object(d.createWorkerWithIntercept)();e.bvhWorker.addEventListenerWithIntercept((function(t){if(t.data.bvh){console.log("Received BVH from worker");var n=t.data.bvh;e.model&&(e.svf.bvh=n,e.model.setBVH(new l.NodeArray(n.nodes,n.useLeanNodes),n.primitives,e.options.bvhOptions),e.viewer3DImpl&&e.viewer3DImpl.modelVisible(e.model.id)&&e.viewer3DImpl.invalidate(!1,!0)),e.bvhWorker.clearAllEventListenerWithIntercept(),e.bvhWorker.terminate(),e.bvhWorker=null,e.onOperationComplete()}if(t.data.boxes&&e.model){var r=e.model.myData.fragments;!function(e,t){for(var n=t.data.boxes,r=t.data.boxStride,i=n.length/r,o=0,s=0,a=0;o<i;o++,s+=r,a+=6)e[a+0]=n[s+0],e[a+1]=n[s+1],e[a+2]=n[s+2],e[a+3]=n[s+3],e[a+4]=n[s+4],e[a+5]=n[s+5]}(r.boxes,t),r.boxesLoaded=!0,e.model.visibleBoundsDirty=!0}}));var t=Object.assign({},e.loadContext);t.operation="LOAD_OTG_BVH",t.raiseError=null,t.onFailureCallback=null,t.onLoaderEvent=null,t.fragments_extra=Object(f.pathToURL)(e.basePath)+e.svf.manifest.assets.fragments_extra,t.placementTransform=e.svf.placementTransform,t.placementWithOffset=e.svf.placementWithOffset,t.fragmentTransformsOffset=e.svf.metadata.fragmentTransformsOffset,t.globalOffset=e.svf.globalOffset,t.fragments_extra?e.bvhWorker.doOperation(t):e.onOperationComplete()},w.prototype.tryToActivateFragment=function(e,t){var n=this.svf,r=this.model;if(r){if(n.fragments.visibilityFlags[e]&c.MeshFlags.MESH_NOTLOADED)return r.getFragmentList().setFlagFragment(e,c.MeshFlags.MESH_NOTLOADED,!0),void this.trackGeomLoadProgress(n,e,!1);var i=!1,o=n.fragments.materials[e],s=n.getMaterialHash(o),a=this.findOrLoadMaterial(r,s,o);a||("fragment"===t&&this.pendingMaterials[s].push(e),"material"!==t&&(i=!0));var l=n.fragments.geomDataIndexes[e];if(0!==l){r.getFragmentList().getOriginalWorldMatrix(e,this.tmpMatrix);var u=r.getGeometryList().getGeometry(l);if(u||("fragment"===t&&this.loadGeometry(l,e),i=!0),!i){var d=this.viewer3DImpl.setupMesh(r,u,s,this.tmpMatrix);d.geomId=l,r.activateFragment(e,d,!!n.placementTransform),this.viewer3DImpl.geomCache().updateGeomImportance(r,e),this.trackGeomLoadProgress(n,e,!1)}}else(a||"material"===t)&&this.trackGeomLoadProgress(n,e,!1)}},w.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.isOTG=!0,e.geomMetadata.hashToIndex={},e.failedFrags={},e.failedMeshes={},e.failedMaterials={},e.geomMemory=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.fragsLoaded=0,e.fragsLoadedNoGeom=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options;var t=Date.now();this.loadTime+=t-this.t0,s.logger.log("SVF load: "+(t-this.t0));var n=this.model=new g.Model(e);if(n.loader=this,n.initialize(),this.t0=t,e.bbox=(new i.LmvBox3).copy(e.bbox),e.refPointTransform&&(e.refPointTransform=new r.LmvMatrix4(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new r.LmvMatrix4(!0).copy(e.placementTransform)),e.cameras)for(var a=0;a<e.cameras.length;a++){var l=e.cameras[a];l.position=(new o.LmvVector3).copy(l.position),l.target=(new o.LmvVector3).copy(l.target),l.up=(new o.LmvVector3).copy(l.up)}s.logger.log("scene bounds: "+JSON.stringify(e.bbox));var c={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topology,has_animations:!!e.animations,materials:e.metadata.stats.num_materials,is_mobile:Object(_.isMobileDevice)()};s.logger.track(c),this.viewer3DImpl.signalProgress(5,y.ProgressState.ROOT_LOADED,this.model),e.handleHashListRequestFailures(this.loadContext),e.propDbLoader=new u.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)},w.prototype.trackGeomLoadProgress=function(e,t,n){if(n){if(e.failedFrags[t])return void console.log("Double fail",t);e.failedFrags[t]=1}var r=E(e);e.fragsLoaded++;var i=E(e);i>r&&this.viewer3DImpl.signalProgress(i,y.ProgressState.LOADING,this.model),this.model.getGeometryList().geomPolyCount>e.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),e.numRepaints++,e.nextRepaintPolys+=1e5*Math.pow(1.5,e.numRepaints),this.viewer3DImpl.modelVisible(this.model.id)&&this.viewer3DImpl.invalidate(!1,!0)),e.fragsLoaded===e.metadata.stats.num_fragments&&this.onOperationComplete()},w.prototype.trackFragmentListLoadProgress=function(){var e=this.svf;function t(e){return Math.floor(100*e.fragsLoadedNoGeom/e.metadata.stats.num_fragments)}var n=t(e);e.fragsLoadedNoGeom++;var r=t(e);r>n&&this.options.onFragmentListLoadProgress(this.model,r)},w.prototype.onOperationComplete=function(){this.operationsDone++,3===this.operationsDone&&this.onGeomLoadDone()},w.prototype.onMaterialLoaded=function(e,t,n){if(this.loading){var r=this.pendingMaterials[t];if(r){var i=this.viewer3DImpl.matman();if(e){e.hash=t;var o=i.convertSharedMaterial(this.model,e,t);a.TextureLoader.loadMaterialTextures(this.model,o,this.viewer3DImpl),i.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0)}else this.svf.failedMaterials[t]=1;for(var s=0;s<r.length;s++)this.tryToActivateFragment(r[s],"material");this.pendingMaterialsCount--,delete this.pendingMaterials[t]}}},w.prototype.findOrLoadMaterial=function(e,t,n){if(this.pendingMaterials[t])return!1;var r=this.svf;if(this.viewer3DImpl.matman().findMaterial(e,t))return!0;this.pendingMaterialsCount++,this.pendingMaterials[t]=[];var i=!!this.loadContext.otg_cdn,o=r.makeSharedResourcePath(this.loadContext.otg_cdn,"materials",t);return this.viewer3DImpl.geomCache().requestMaterial(o,i,t,n,this.queryParams),!1},w.prototype.loadGeometry=function(e,t){var n=this.svf,r=n.getGeometryHash(e);if(this.pendingMeshes[r])return this.pendingMeshes[r].push(t),!1;this.pendingMeshesCount++,this.pendingMeshes[r]=[t];var i=!!this.loadContext.otg_cdn;n.geomMetadata.hashToIndex[r]=e;var o=n.makeSharedResourcePath(this.loadContext.otg_cdn,"geometry",r);this.viewer3DImpl.geomCache().requestGeometry(o,i,r,e,this.queryParams)},w.prototype.onMeshError=function(e){var t=e.error.args.hash;this.svf.failedMeshes[t]=1;var n=this.pendingMeshes[t];if(n){for(var r=0;r<n.length;r++)this.trackGeomLoadProgress(this.svf,n[r],!0);delete this.svf.geomMetadata.hashToIndex[t],delete this.pendingMeshes[t],this.pendingMeshesCount--}},w.prototype.onMeshReceived=function(e){var t=this.model;if(t){var n=t.getGeometryList(),r=this.svf.geomMetadata.hashToIndex[e.hash];if(void 0!==r){var i=n.getGeometry(r),o=this.pendingMeshes[e.hash];if(!i){n.addGeometry(e,o&&o.length||1,r),this.svf.loadDone&&console.error("Geometry received after load was done");for(var s=0;s<o.length;s++)this.tryToActivateFragment(o[s],"geom");delete this.svf.geomMetadata.hashToIndex[e.hash],delete this.pendingMeshes[e.hash],this.pendingMeshesCount--}}}else console.warn("Received geometry after loader was done. Possibly leaked event listener?",e.hash)},w.prototype.onGeomLoadDone=function(){if(this.svf.loadDone=!0,this.removeMeshReceiveListener(),a.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipMeshLoad)return this.currentLoadPath=null,void this.viewer3DImpl.onLoadComplete(this.model);this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.svf.geomMetadata.hashes=null;var e=Date.now(),t="Fragments load time: "+(e-this.t0);this.loadTime+=e-this.t0;var n=this.firstPixelTimestamp-this.t0;if(t+=" (first pixel time: "+n+")",s.logger.log(t),this.options.useConsolidation){var r=this.viewer3DImpl.glrenderer();this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,r)}var i={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.svf.metadata.stats.num_geoms,fragments_count:this.svf.metadata.stats.num_fragments,urn:this.svfUrn};n>0&&(i.first_pixel_time=n),s.logger.track(i,!0),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},w.prototype.loadPropertyDb=function(){this.svf.propDbLoader.load()},w.prototype.is3d=function(){return!0},m.FileLoaderManager.registerFileLoader("json",["json"],w)},"./src/file-loaders/main/OtgResourceCache.js":
/*!***************************************************!*\
  !*** ./src/file-loaders/main/OtgResourceCache.js ***!
  \***************************************************/
/*! exports provided: MESH_RECEIVE_EVENT, MESH_FAILED_EVENT, MATERIAL_RECEIVE_EVENT, MATERIAL_FAILED_EVENT, OtgResourceCache */function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"MESH_RECEIVE_EVENT",(function(){return d})),n.d(t,"MESH_FAILED_EVENT",(function(){return h})),n.d(t,"MATERIAL_RECEIVE_EVENT",(function(){return f})),n.d(t,"MATERIAL_FAILED_EVENT",(function(){return p})),n.d(t,"OtgResourceCache",(function(){return _}));var r=n(/*! ../../compat */"./src/compat.js"),i=n(/*! ../../wgs/scene/BufferGeometry */"./src/wgs/scene/BufferGeometry.js"),o=n(/*! ./WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),s=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),a=n(/*! ../../application/EventDispatcher */"./src/application/EventDispatcher.js"),l=n(/*! ../../application/EventTypes */"./src/application/EventTypes.js"),c=n(/*! ../../globals */"./src/globals.js"),u=n(/*! ../lmvtk/otg/OtgPriorityQueue */"./src/file-loaders/lmvtk/otg/OtgPriorityQueue.js"),d="meshReceived",h="meshFailed",f="materialReceived",p="materialFailed",m="true"===Object(c.getParameterByName)("disableIndexedDb").toLowerCase()||Object(r.getGlobal)().DISABLE_INDEXED_DB,g="true"===Object(c.getParameterByName)("disableWebSocket").toLowerCase()||Object(r.getGlobal)().DISABLE_WEBSOCKET;function v(e){var t=Object(s.initLoadContext)(e);return t.disableIndexedDb=m,t.disableWebSocket=g,t}function y(e,t){return e.importance-t.importance}function _(t){for(var n=new Map,s=new Map,a={},c=Object(r.isMobileDevice)()?2:8,m=[],g=0;g<c;g++)m.push(Object(o.createWorkerWithIntercept)());this.byteSize=0;var _=0,b=void 0,x=new u.OtgPriorityQueue(t),w=this,E=0,A=t,M=!1;function S(){M=!1}function T(e){if(e.data)if(x.waitingTasks.length&&!b&&(b=setTimeout(P,0)),e.data.error){var t=e.data.error,r=t.args?t.args.hash:void 0,o=t.args?t.args.type:"g";r&&("m"===o?(s.set(r,t),w.fireEvent({type:p,error:t}),console.warn("Error loading material",r)):(n.set(r,t),w.fireEvent({type:h,error:t}),console.warn("Error loading mesh",r)),delete a[t.hash],_--)}else if(e.data.material){r=(m=e.data).hash;var l=m.material;s.set(r,l),w.fireEvent({type:f,material:l,hash:r}),delete a[m.hash],_--}else for(var c=e.data,u=0;u<c.length;u++){var m;if((m=c[u]).hash&&m.mesh){i.BufferGeometryUtils.meshToGeometry(m);r=m.hash;var g=m.geometry;n.set(r,g),w.byteSize+=g.byteSize,w.cleanup(),w.fireEvent({type:d,geom:g}),delete a[m.hash]}_--}}A.addEventListener(l.MODEL_UNLOADED_EVENT,S),this.dtor=function(){A.removeEventListener(l.MODEL_UNLOADED_EVENT,S),A=null;for(var e=0;e<c;e++)m[e].clearAllEventListenerWithIntercept(),m[e].terminate()};for(g=0;g<c;g++)m[g].addEventListenerWithIntercept(T);function C(e){return"number"==typeof e?e%c:0|Math.random()*c}function P(){var e=100*c-_;if(0!==e){x.updateRequestPriorities()||(e=Math.min(e,10*c));for(var t=[],n=0;!x.isEmpty()&&n<e;){var r=x.takeTask(),i=C(r.geomIdx);(s=t[i])?(s.urls.push(r.url),s.hashes.push(r.hash)):(s={operation:"LOAD_CDN_RESOURCE_OTG",type:"g",urls:[r.url],hashes:[r.hash],isCDN:r.isCDN,queryParams:r.queryParams},t[i]=s),n++}for(var o=0;o<t.length;o++){var s;(s=t[o])&&(m[o].doOperation(v(s)),_+=s.urls.length)}b=void 0}else b=setTimeout(P,30)}this.initWorker=function(e){for(var t=0;t<c;t++){var n={operation:"INIT_WORKER_OTG",authorizeUrns:[e]};m[t].doOperation(v(n))}},this.updateMruTimestamps=function(){for(var e=0;e<c;e++){var t={operation:"UPDATE_MRU_TIMESTAMPS_OTG",endSession:x.isEmpty()};m[e].doOperation(v(t))}},this.requestGeometry=function(t,r,i,o,s){var l=this,c=n.get(i);if(c&&c.args)e((function(){return l.fireEvent({type:h,error:c,hash:i,repeated:!0})}));else if(c)e((function(){return l.fireEvent({type:d,geom:c})}));else{var u=a[i];if(u&&u.refcount)return u.importanceNeedsUpdate=!0,void u.refcount++;var f={operation:"LOAD_CDN_RESOURCE_OTG",type:"g",url:t,isCDN:r,hash:i,queryParams:s,importance:0,geomIdx:o,importanceNeedsUpdate:!0,refcount:1};x.addTask(f),a[i]=f,b||(b=setTimeout(P,0))}},this.requestMaterial=function(t,n,r,i,o){var l=this,c=s.get(r);if(c&&c.args)e((function(){return l.fireEvent({type:p,error:c,hash:r,repeated:!0})}));else if(c)e((function(){return l.fireEvent({type:f,material:c,hash:r})}));else{var u=a[r];if(u&&u.refcount)u.refcount++;else{var d={operation:"LOAD_CDN_RESOURCE_OTG",type:"m",urls:[t],hashes:[r],isCDN:n,queryParams:o,refcount:1};a[r]=d;var h=C(i);m[h].doOperation(v(d)),_++}}},this.cancelRequests=function(e){for(var t in e){var n=a[t];n&&n.refcount--}for(var r=[],i=0;i<x.waitingTasks.length;i++){var o=x.waitingTasks[i];a[o.hash].refcount?r.push(o):delete a[o.hash]}x.waitingTasks=r},this.updateGeomImportance=function(e,t){return Object(u.updateGeomImportance)(e,t)},this.cleanup=function(){var e=[];if(!(this.byteSize<104857600)){var t=A.impl.modelQueue().getModels().concat(A.getHiddenModels());if(!M){E++;for(var r=0;r<t.length;r++){var i=t[r],o=i.getData();if(i.isOTG()){var s=o.geomMetadata.hashes;if(s)for(var a=s.length/o.geomMetadata.byteStride,l=1;l<a;l++){var c=o.getGeometryHash(l);(u=n.get(c))&&(u.timeStamp=E)}}}for(var c in e.length>0&&console.warn("OtgResourceCache.cleanup(): array must be empty"),n){(u=n.get(c)).timeStamp!==E&&e.push(u)}e.sort(y);for(r=0;r<e.length&&this.byteSize>=52428800;r++){var u=e[r];n.delete(u.hash),this.byteSize-=u.byteSize,u.dispose()}r===e.length&&(M=!0),e.length=0}}},this.waitForGeometry=function(e,t){var r=0,i=x.makeUrgent(e);if(0===i&&e)t(e);else for(var o in P(),this.addEventListener(d,l),this.addEventListener(h,c),e){var s=n.get(o);s&&a(o,s)}function a(n,o){x.removeUrgent(n),!0!=!e[n]&&(e[n]=o,++r<i||(w.removeEventListener(d,l),w.removeEventListener(h,c),t(e)))}function l(e){a(e.geom.hash,e.geom)}function c(e){a(e.error.args.hash,void 0)}},this.getGeometry=function(e){return n.get(e)}}a.EventDispatcher.prototype.apply(_.prototype)}.call(this,n(/*! ./../../../node_modules/timers-browserify/main.js */"./node_modules/timers-browserify/main.js").setImmediate)},"./src/file-loaders/main/PropDbLoader.js":
/*!***********************************************!*\
  !*** ./src/file-loaders/main/PropDbLoader.js ***!
  \***********************************************/
/*! exports provided: getPropWorker, shutdownPropWorker, clearPropertyWorkerCache, PropDbLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"getPropWorker",(function(){return _})),n.d(t,"shutdownPropWorker",(function(){return b})),n.d(t,"clearPropertyWorkerCache",(function(){return x})),n.d(t,"PropDbLoader",(function(){return S}));var r=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ../net/Xhr */"./src/file-loaders/net/Xhr.js"),o=n(/*! ../net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),s=n(/*! ../../application/EventTypes */"./src/application/EventTypes.js"),a=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),l=n(/*! ../../wgs/scene/InstanceTree */"./src/wgs/scene/InstanceTree.js"),c=n(/*! ../../wgs/scene/InstanceTreeStorage */"./src/wgs/scene/InstanceTreeStorage.js"),u=n(/*! ./WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),d=n(/*! ../../application/EventDispatcher */"./src/application/EventDispatcher.js");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p,m=1,g={};function v(e){var t=e.data;if(t&&t.debug)r.logger.debug(t.message);else{var n=t&&t.cbId&&g[t.cbId];n&&(t.progress?n[2]&&n[2](t.progress):(t.error?n[1]&&n[1](t.error):n[0]&&n[0](t.result),delete g[t.cbId]))}}function y(e,t,n){var r=m++;return g[r]=[e,t,n],r}function _(){return p}function b(){p&&(p.clearAllEventListenerWithIntercept(),p.terminate(),p=void 0)}function x(){p&&p.doOperation({operation:"UNLOAD_PROPERTYDB",clearCaches:!0})}var w=0,E=1,A=2,M=3,S=function(e,t,n){this.eventTarget=n||new d.EventDispatcher,this.model=t,this.svf=t&&t.getData(),this.dbPath="",this.sharedDbPath=!1;var o=this.svf&&this.svf.is2d&&this.svf.loadOptions.bubbleNode&&this.svf.loadOptions.bubbleNode.findViewableParent()._getOtgManifest();if(this.svf&&!o&&this.svf.propertydb&&this.svf.propertydb.avs.length){for(var s in this.dbFiles=this.svf.propertydb,this.dbFiles)this.dbFiles[s][0]&&(this.dbFiles[s][0].path=this.dbFiles[s][0].path.replace(/\\/g,"/"));var a=Object(i.pathToURL)(this.svf.basePath);if(e){var l=i.ViewingService.simplifyPath(a+this.svf.propertydb.avs[0].path);if((l=l.slice(0,l.lastIndexOf("/")+1))===e){var c={};for(var s in this.dbFiles){var u=this.dbFiles[s][0],h=u.path;0===(h=i.ViewingService.simplifyPath(a+h)).indexOf(e)&&(h=h.slice(e.length)),c[s]=[{path:h,isShared:u.isShared}]}this.dbFiles=c,this.dbPath=e,this.sharedDbPath=!0}else this.dbPath=a,this.sharedDbPath=!1}else this.dbPath=a,this.sharedDbPath=!1}else{if(this.sharedDbPath=!0,this.svf&&this.svf.loadOptions.bubbleNode){this.dbPath=e;var f=this.svf.loadOptions.bubbleNode.getPropertyDbManifest();this.dbFiles=f.propertydb,this.needsDbIdRemap=f.needsDbIdRemap}else r.logger.warn("Deprecated shared property database initialization without bubbleNode in Model load options."),this.dbPath=e,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]};r.logger.log("Using shared db path "+e)}this.queryParams="",this.svf&&this.svf.acmSessionId&&(this.queryParams="acmsession="+this.svf.acmSessionId),this.loadProgress=0,this.cbId=void 0,this.idLoadState=w,this.waitingForExternalIds=[]};S.prototype.dtor=function(){this.asyncPropertyOperation({operation:"UNLOAD_PROPERTYDB"},(function(){}),(function(){}));var e,t=Boolean(this.cbId),n=this.instanceTree||this.propertyDbError;t&&!n&&(e=this.cbId,delete g[e],this.propertyDbError={propDbWasUnloaded:!0},this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_UNAVAILABLE_EVENT,svf:this.svf,model:this.model,target:this})),this.model=null,this.svf=null},S.prototype.processLoadResult=function(e){if(e.instanceTreeStorage){var t=new c.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes);this.instanceTree=new l.InstanceTree(t,e.objectCount,e.maxTreeDepth),this.svf&&(this.svf.instanceTree=this.instanceTree,this.instanceTree.setFragmentList(this.model.getFragmentList()))}e.objectCount&&(this.hasObjectProperties=e.objectCount,this.svf&&(this.svf.hasObjectProperties=e.objectCount)),e.dbidOldToNew&&this.model.setDbIdRemap(e.dbidOldToNew),this.onLoadProgress(100),this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_CREATED_EVENT,svf:this.svf,model:this.model,target:this})},S.prototype.processLoadError=function(e){this.propertyDbError=e,this.onLoadProgress(100),this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_UNAVAILABLE_EVENT,svf:this.svf,model:this.model,target:this})},S.prototype.load=function(e){var t=this;if(e=e||{},this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)setTimeout((function(){t.processLoadResult(t.svf)}),0);else{p||(p=Object(u.createWorkerWithIntercept)()).addEventListenerWithIntercept(v);this.cbId=y((function(e){t.processLoadResult(e)}),(function(e){t.processLoadError(e)}),(function(e){t.onLoadProgress(e.percent)}));var n=this.svf&&this.svf.loadOptions,r=!(n&&n.disablePrecomputedNodeBoxes),i=!(!n||!n.skipExternalIds);i||(this.idLoadState=E);var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:r&&this.svf&&this.svf.fragments.boxes,needsDbIdRemap:this.needsDbIdRemap,cbId:this.cbId,queryParams:this.queryParams,skipExternalIds:i},e);p.doOperation(Object(a.initLoadContext)(o))}},S.prototype.asyncPropertyOperation=function(e,t,n,r){var i=this;if(e.dbPath=this.dbPath,i.instanceTree||i.hasObjectProperties)e.cbId=y(t,n,r),p.doOperation(e);else if(i.propertyDbError)n&&n(i.propertyDbError);else{var a=function a(l){i.eventTarget.removeEventListener(s.OBJECT_TREE_CREATED_EVENT,a),i.eventTarget.removeEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,a),i.instanceTree||i.hasObjectProperties||i.propertyDbError?i.asyncPropertyOperation(e,t,n,r):n&&n({code:o.ErrorCodes.UNKNOWN_FAILURE,msg:"Failed to load properties"})};i.eventTarget.addEventListener(s.OBJECT_TREE_CREATED_EVENT,a),i.eventTarget.addEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,a)}},S.prototype.getProperties=function(e,t,n){this.idLoadState===w&&r.logger.warn("Calling getProperties() will cause loading of the potentially large externalIDs file. Use getProperties2() to avoid this warning."),this.getProperties2(e,t,n,{needsExternalId:!0})},S.prototype.getProperties2=function(e,t,n,r){var i=this,o=function(){i.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:e},t,n)};r&&r.needsExternalId?this.loadExternalIds().then(o).catch(n):o()},S.prototype.getBulkProperties=function(e,t,n,i,o){var s={ignoreHidden:o,propFilter:t,needsExternalId:!t||t.includes("externalId")};s.needsExternalId&&this.idLoadState===w&&r.logger.warn("Calling getProperties() will cause loading of the potentially large externalIDs file. Use getProperties2() to avoid this warning."),this.getBulkProperties2(e,s,n,i)},S.prototype.getBulkProperties2=function(e,t,n,r){var i=this,o=function(){i.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:e,propFilter:t.propFilter,ignoreHidden:t.ignoreHidden},n,r)};(t=t||{})&&t.needsExternalId?this.loadExternalIds().then(o).catch(r):o()},S.prototype.searchProperties=function(e,t,n,r){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:e,attributeNames:t},n,r)},S.prototype.findProperty=function(e){var t=this;return new Promise((function(n,r){t.asyncPropertyOperation({operation:"FIND_PROPERTY",propertyName:e},n,r)}))},S.prototype.diffProperties=function(e,t,n,r,i){this.asyncPropertyOperation({operation:"DIFF_PROPERTIES",dbPath2:e,diffOptions:r},t,n,i)},S.prototype.findLayers=function(){var e=this;return new Promise((function(t,n){e.asyncPropertyOperation({operation:"FIND_LAYERS"},t,n)}))},S.prototype.getExternalIdMapping=function(e,t,n){var r=this;return this.loadExternalIds().then((function(){r.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING",extIdFilter:n},e,t)}))},S.prototype.getLayerToNodeIdMapping=function(e,t){this.asyncPropertyOperation({operation:"BUILD_LAYER_TO_NODE_ID_MAPPING"},e,t)},S.prototype.executeUserFunction=function(e,t){var n,r=this;if("function"==typeof e)e=e.toString();else if("string"!=typeof e)return Promise.reject("Expected Function or string.");try{n=new Blob([e],{type:"application/javascript"})}catch(t){var i=new BlobBuilder;i.append(e),n=i.getBlob()}var o=URL.createObjectURL(n);return new Promise((function(e,n){r.asyncPropertyOperation({operation:"USER_FUNCTION",userFunction:o,userData:t},e,n)}))},S.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},S.prototype.getObjectTree=function(e,t){var n=this;if(n.instanceTree)e(n.instanceTree);else if(n.propertyDbError)t&&t(n.propertyDbError);else if("hasObjectProperties"in n)n.svf&&n.svf.is2d&&t?t("F2D files do not have an InstanceTree."):e(null);else{var r=function r(){n.eventTarget.removeEventListener(s.OBJECT_TREE_CREATED_EVENT,r),n.eventTarget.removeEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,r),n.getObjectTree(e,t)};n.eventTarget.addEventListener(s.OBJECT_TREE_CREATED_EVENT,r),n.eventTarget.addEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,r)}},S.prototype.onLoadProgress=function(e){this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_LOAD_PROGRESS_EVENT,percent:e,svf:this.svf,model:this.model,target:this}),this.loadProgress=e},S.prototype.getLoadProgress=function(){return this.loadProgress},S.prototype.isLoadDone=function(){return 100==this.loadProgress},S.prototype.loadExternalIds=function(){var e=this;switch(this.idLoadState){case E:return Promise.resolve();case M:return Promise.reject();case w:this.idLoadState=A;var t={operation:"LOAD_EXTERNAL_IDS",idsFile:this.dbFiles.ids[0],queryParams:this.queryParams};Object(a.initLoadContext)(t),this.asyncPropertyOperation(t,(function(){e.idLoadState=E,e.waitingForExternalIds.forEach((function(e){return e.resolve()}))}),(function(){e.idLoadState=M,e.waitingForExternalIds.forEach((function(e){return e.reject()}))}))}return new Promise((function(t,n){e.waitingForExternalIds.push({resolve:t,reject:n})}))}},"./src/file-loaders/main/SvfLoader.js":
/*!********************************************!*\
  !*** ./src/file-loaders/main/SvfLoader.js ***!
  \********************************************/
/*! exports provided: SvfLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"SvfLoader",(function(){return E}));var r=n(/*! ../../compat */"./src/compat.js"),i=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../../wgs/scene/LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js"),s=n(/*! ../net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),a=n(/*! ../../wgs/scene/BVHBuilder */"./src/wgs/scene/BVHBuilder.js"),l=n(/*! ../../wgs/scene/MeshFlags */"./src/wgs/scene/MeshFlags.js"),c=n(/*! ../../wgs/scene/BufferGeometry */"./src/wgs/scene/BufferGeometry.js"),u=n(/*! ../../wgs/render/MaterialConverter */"./src/wgs/render/MaterialConverter.js"),d=n(/*! ../net/Xhr */"./src/file-loaders/net/Xhr.js"),h=n(/*! ./PropDbLoader */"./src/file-loaders/main/PropDbLoader.js"),f=n(/*! ./TextureLoader */"./src/file-loaders/main/TextureLoader.js"),p=n(/*! ./WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),m=n(/*! ../../application/EventTypes */"./src/application/EventTypes.js"),g=n(/*! ../../application/Model */"./src/application/Model.js"),v=n(/*! three */"./thirdparty/three.js/three.js"),y=n(/*! ../../application/FileLoaderManager */"./src/application/FileLoaderManager.js"),_=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),b=n(/*! ../../application/ProgressState */"./src/application/ProgressState.js"),x=Bimfish.Viewing,w=Object(r.isNodeJS)()?10:Object(r.isMobileDevice)()?2:6,E=function(e){this.viewer3DImpl=e,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.tmpMatrix=new v.Matrix4,this.tmpBox=new v.Box3,this.fetchingTopology=!1,this.loadTime=0,this.notifiesFirstPixel=!0};E.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,i.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,i.logger.debug("SVF loader dtor: on svf worker.")),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate();this.pack_workers=null,i.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.tmpMatrix=null,this.tmpBox=null,this.svf=null,this.model=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0,this.viewer3DImpl=null},E.prototype.initWorkerScript=p.initWorkerScript,E.prototype.createWorkerWithIntercept=p.createWorkerWithIntercept,E.prototype.startWorkers=function(){for(var e=this,t=this.svf,n=Math.min(t.geompacks.length,x.NUM_WORKER_THREADS||w),i=0;i<n;i++){var o=t.geompacks[this.next_pack++];o.loading=!0,Object(r.isNodeJS)()?this.loadGeometryPack(o.id,o.uri):function(t){setTimeout((function(){e.loadGeometryPack(t.id,t.uri)}),200*i)}(o)}},E.prototype.createModel=function(e){var t=this.model=new g.Model(e);return t.loader=this,t.initialize(),t},E.prototype.isValid=function(){return this.viewer3DImpl},E.prototype.loadFile=function(e,t,n,r){if(!this.viewer3DImpl)return i.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return i.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var o=e.indexOf("urn:");if(-1!=o){var s=(e=decodeURIComponent(e)).substr(o,e.substr(o).indexOf("/"));i.logger.log("Extracted URN: "+s);var a=s.lastIndexOf(":");this.svfUrn=s.substr(a+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e;var l=this.currentLoadPath.lastIndexOf("/");-1!=l&&(this.basePath=this.currentLoadPath.substr(0,l+1)),this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t;var c=this;return this.initWorkerScriptToken=this.initWorkerScript((function(){c.loadSvfCB(e,t,n,r)})),!0},E.prototype.loadSvfCB=function(e,t,n,o){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var l=!0,c=this,u={url:Object(d.pathToURL)(e),basePath:this.currentLoadPath,objectIds:t.ids,globalOffset:t.globalOffset,fragmentTransformsDouble:t.fragmentTransformsDouble,placementTransform:t.placementTransform,applyRefPoint:t.applyRefPoint,queryParams:this.queryParams,bvhOptions:t.bvhOptions||{isWeakDevice:Object(r.isMobileDevice)()},applyScaling:t.applyScaling,loadInstanceTree:t.loadInstanceTree};this.viewer3DImpl._signalNoMeshes();var h=this.svfWorker=this.createWorkerWithIntercept();return h.addEventListenerWithIntercept((function(e){var t=function(){h.clearAllEventListenerWithIntercept(),h.terminate(),c.svfWorker=null,h=null};if(l&&o&&(l=!1,o()),e.data&&e.data.manifest)c.interceptManifest(e.data.manifest),u.operation="LOAD_SVF_CONTD",u.manifest=e.data.manifest,h.doOperation(u);else if(e.data&&e.data.svf){var r=c.svf=e.data.svf;c.failedToLoadSomeGeometryPacks&&(n&&n(c.failedToLoadSomeGeometryPacks),c.failedToLoadSomeGeometryPacks=null),c.onModelRootLoadDone(r),n&&n(null,c.model),c.viewer3DImpl.api.dispatchEvent({type:m.MODEL_ROOT_LOADED_EVENT,svf:r,model:c.model}),r.loadDone=!1;var d=!1;r.metadata&&r.metadata.gltf&&(d=!0),d||(0==r.geompacks.length?c.onGeomLoadDone():c.startWorkers()),1==e.data.progress&&(c.loading=!1,t()),r.fragments.polygonCounts||(r.fragments.polygonCounts=new Int32Array(r.fragments.length)),e.data.bvh&&(r.bvh=e.data.bvh,c.model.setBVH(new a.NodeArray(r.bvh.nodes,r.bvh.useLeanNodes),r.bvh.primitives,c.options.bvhOptions),c.viewer3DImpl.invalidate(!1,!0))}else e.data&&e.data.bvh?(c.svf&&!c.svf.bvh&&(c.svf.bvh=e.data.bvh,c.model.setBVH(new a.NodeArray(c.svf.bvh.nodes,c.svf.bvh.useLeanNodes),c.svf.bvh.primitives,c.options.bvhOptions),c.viewer3DImpl.invalidate(!1,!0)),c.loading=!1,t()):e.data&&e.data.mesh?(c.processReceivedMesh(e.data),1===e.data.progress&&(c.onGeomLoadDone(),c.loading=!1,t())):e.data&&e.data.progress?1==e.data.progress&&(c.loading=!1,t()):e.data&&e.data.error?(c.loading=!1,t(),i.logger.error("Error while processing SVF: "+JSON.stringify(e.data.error.args)),n&&n(e.data.error,null)):e.data&&e.data.debug?i.logger.debug(e.data.message):(i.logger.error("SVF download failed.",Object(s.errorCodeString)(s.ErrorCodes.NETWORK_FAILURE)),c.loading=!1,t())})),u.operation="LOAD_SVF",u.interceptManifest=!!this.interceptManifest,h.doOperation(Object(_.initLoadContext)(u)),!0},E.prototype.loadGeometryPack=function(e,t){var n,r,o,s,a=this;if(this.svf&&this.isValid()){var l=this.pack_workers;if(l||(l=this.pack_workers=[]),l.length<(x.NUM_WORKER_THREADS||w)){var c=!0;for(o=0;o<l.length;o++)if(0===l[o].queued){c=!1;break}if(c){var u=this.createWorkerWithIntercept();u.addEventListenerWithIntercept((function(e){if(e.data&&e.data.meshes){for(var t=e.data.meshes,n={packId:e.data.packId,meshIndex:0,mesh:null},r=0;r<t.length;r++){var o=t[r];o&&(n.meshIndex=r,n.mesh=o,a.processReceivedMesh(n))}if(e.data.progress>=1){a.pack_workers[e.data.workerId].queued-=1,a.loadedPacksCount++,a.viewer3DImpl.signalProgress(100*a.loadedPacksCount/a.svf.geompacks.length,b.ProgressState.LOADING,a.model);var l=!0;for(s=0;s<a.pack_workers.length;s++)if(0!=a.pack_workers[s].queued){l=!1;break}if(l){for(s=0;s<a.pack_workers.length;s++)a.pack_workers[s].clearAllEventListenerWithIntercept(),a.pack_workers[s].terminate();a.pack_workers=null}a.loadedPacksCount+a.failedToLoadPacksCount==a.svf.geompacks.length&&a.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(a.pack_workers[e.data.workerId].queued-=1,a.next_pack<a.svf.geompacks.length){var c=null;if(!c||c.loading)for(;a.next_pack<a.svf.geompacks.length&&(c=a.svf.geompacks[a.next_pack++]).loading;);c&&!c.loading?(c.loading=!0,a.loadGeometryPack(c.id,c.uri)):(a.viewer3DImpl.modelQueue().enforceBvh=!1,a.svf.fragments.packIds=null)}}else e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(++a.failedToLoadPacksCount,a.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}):a.pack_workers[e.data.workerId].queued-=2})),u.queued=0,l.push(u)}}var h=0,f=l[0].queued;for(o=1;o<l.length;o++)l[o].queued<f&&(h=o,f=l[o].queued);(n=l[h]).queued+=2,r=h;var p={operation:"LOAD_GEOMETRY",url:Object(d.pathToURL)(this.svf.basePath+t),packId:parseInt(e),workerId:r,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),packNormals:this.options.packNormals,queryParams:this.queryParams};n.doOperation(Object(_.initLoadContext)(p))}},E.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf,r=n.fragments,o=this.model,s=r.mesh2frag[t];if(void 0!==s){Array.isArray(s)||(s=[s]),c.BufferGeometryUtils.meshToGeometry(e),e.geometry.packId=e.packId;for(var a=s.length,u=o.getFragmentList().getGeometryId(s[0]),d=o.getGeometryList().addGeometry(e.geometry,a,u),h=(e.geometry.attributes.index.array||e.geometry.ib).length/3,p=0;p<s.length;p++){var m=0|s[p];if(n.loadOptions.skipHiddenFragments)if(!(r.visibilityFlags[m]&l.MeshFlags.MESH_VISIBLE))continue;o.getFragmentList().getOriginalWorldMatrix(m,this.tmpMatrix);var g=r.materials[m].toString(),v=this.viewer3DImpl.matman().findMaterial(o,g);v&&!v.texturesLoaded&&f.TextureLoader.loadMaterialTextures(o,v,this.viewer3DImpl),r.polygonCounts&&(r.polygonCounts[m]=h);var y=this.viewer3DImpl.setupMesh(this.model,e.geometry,g,this.tmpMatrix);o.activateFragment(m,y,!!n.placementTransform)}this.options.onMeshReceived&&this.options.onMeshReceived(this.model,d,s),r.mesh2frag[t]=null,r.numLoaded+=s.length,this.viewer3DImpl._signalMeshAvailable(),o.getGeometryList().geomPolyCount>n.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),n.numRepaints++,n.nextRepaintPolys+=1e4*Math.pow(1.5,n.numRepaints),this.viewer3DImpl.invalidate(!1,!0))}else i.logger.warn("Mesh "+t+" was not referenced by any fragments.")},E.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options,e.verylargebbox&&this.viewer3DImpl.setNearRadius(this.options.nearRadius||1);var t=Date.now();this.loadTime+=t-this.t0,i.logger.log("SVF load: "+(t-this.t0));var n=this.createModel(e);this.options.skipPropertyDb||this.loadPropertyDb();var s=this.convertMaterials(n);if(this.viewer3DImpl.matman().hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0),this.t1=t,e.bbox=(new v.Box3).copy(e.bbox),e.refPointTransform&&(e.refPointTransform=new o.LmvMatrix4(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new o.LmvMatrix4(!0).copy(e.placementTransform)),e.cameras)for(var a=0;a<e.cameras.length;a++){var l=e.cameras[a];l.position=(new v.Vector3).copy(l.position),l.target=(new v.Vector3).copy(l.target),l.up=(new v.Vector3).copy(l.up),isFinite(l.position.x+l.position.y+l.position.z+l.target.x+l.target.y+l.target.z+l.up.x+l.up.y+l.up.z)||(l.target=e.bbox.center(),l.position.copy(l.target),l.position.z+=e.bbox.max.z-e.bbox.min.z,l.up={x:0,y:1,z:0}),isFinite(l.aspect)||(l.aspect=1),isFinite(l.fov)||(l.fov=90),isFinite(l.orthoScale)||(l.orthoScale=1)}i.logger.log("scene bounds: "+JSON.stringify(e.bbox));var c={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topologyPath,has_animations:!!e.animations,cameras:e.cameras?e.cameras.length:0,lights:e.lights?e.lights.length:0,materials:s,is_mobile:Object(r.isMobileDevice)()};i.logger.track(c),this.viewer3DImpl.signalProgress(5,b.ProgressState.ROOT_LOADED,this.model),this.viewer3DImpl.invalidate(!1,!1)},E.prototype.convertMaterials=function(e){var t,n=this.viewer3DImpl.matman(),r=e.getData(),i=0;if(!r.materials)return i;if(r.gltfMaterials){var o=r.materials.materials;for(t in o){var s=o[t],a=u.MaterialConverter.convertMaterialGltf(s,r),l=n._getMaterialHash(e,t);n.addMaterial(l,a,!1),i++}return i}var c=r.materials.materials,d=r.proteinMaterials?r.proteinMaterials.materials:null;for(t in c){var h=d&&d[t]&&u.MaterialConverter.isPrismMaterial(d[t])?d[t]:c[t];n.convertOneMaterial(e,h,n._getMaterialHash(e,t)),i++}return i},E.prototype.makeBVH=function(e){var t=performance.now(),n=e.materials?e.materials.materials:null;e.bvh=new a.BVHBuilder(e.fragments,n),e.bvh.build(this.options.bvhOptions||{isWeakDevice:Object(r.isMobileDevice)()});var o=performance.now();i.logger.log("BVH build time: "+(o-t))},E.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,f.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.svf.fragments.visibilityFlags=null;var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime+=e-this.t0;var n=this.firstPixelTimestamp-this.t0;t+=" (first pixel time: "+n+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),i.logger.log(t),this.options.useConsolidation&&this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,this.viewer3DImpl.glrenderer());var r={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};n>0&&(r.first_pixel_time=n),i.logger.track(r,!0),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},E.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new h.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},E.prototype.fetchTopologyFile=function(e,t){if(!this.fetchingTopology){this.fetchingTopology=!0;var n=this.createWorkerWithIntercept();n.addEventListenerWithIntercept((function(e){if(e.data["status-topology"])return r=(new Date).getTime(),s=Math.round((r-l)/1e3),void i.logger.log("Topology file downloaded. ("+s+" seconds). Processing...");var a=e.data["fetch-topology"];a&&(o=(new Date).getTime(),s=Math.round((o-r)/1e3),a.topology?i.logger.log("Topology file processed successfully! ("+s+" seconds)."):i.logger.log("Topology file processed, but an error ocurred. ("+s+" seconds)."),t(a),c.fetchingTopology=!1,n.clearAllEventListenerWithIntercept(),n.terminate(),n=null)}));var r,o,s,a={path:e,queryParams:this.queryParams},l=(new Date).getTime();i.logger.log("Fetching topology file..."),a.operation="FETCH_TOPOLOGY",n.doOperation(Object(_.initLoadContext)(a));var c=this}},E.prototype.is3d=function(){return!0},y.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],E)},"./src/file-loaders/main/TextureLoader.js":
/*!************************************************!*\
  !*** ./src/file-loaders/main/TextureLoader.js ***!
  \************************************************/
/*! exports provided: TextureLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"TextureLoader",(function(){return S}));var r=n(/*! ../net/Xhr */"./src/file-loaders/net/Xhr.js"),i=n(/*! ../../compat */"./src/compat.js"),o=n(/*! ../net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),s=n(/*! ../../wgs/render/MaterialConverter */"./src/wgs/render/MaterialConverter.js"),a=n(/*! ../../wgs/render/DecodeEnvMap */"./src/wgs/render/DecodeEnvMap.js"),l=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),c=n(/*! three */"./thirdparty/three.js/three.js"),u=n(/*! ../../../thirdparty/three.js/DDSLoader */"./thirdparty/three.js/DDSLoader.js"),d=n(/*! ../net/endpoints */"./src/file-loaders/net/endpoints.js"),h=n(/*! pend */"./node_modules/pend/index.js"),f=Object(i.getGlobal)(),p=f.document,m=new h;m.max=Object(i.isMobileDevice)()?4:6;var g=0,v=Object(i.isMobileDevice)()?32:1/0;v*=1048576;var y=0,_=1/0;function b(e){var t;!0===e.image.wasNPOT&&((t=e).format===c.AlphaFormat||t.format===c.RGBAFormat)&&function(e){return e.clampS||e.clampT}(e)&&function(e){return e.minFilter!==c.NearestFilter&&e.minFilter!==c.LinearFilter}(e)&&Object(i.isChrome)()&&Object(i.isWindows)()&&(e.minFilter=c.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0)}function x(e,t,n,s,a,h,v){var y=d.endpoint.getUseCredentials(),x=d.endpoint.getUseCookie();y&&x?c.ImageUtils.crossOrigin="use-credentials":d.endpoint.getUseCredentials()?c.ImageUtils.crossOrigin="anonymous":c.ImageUtils.crossOrigin="";var w="";y&&a&&(w="acmsession="+a),v&&v.queryParams&&(w=w?w+"&":"",w+=v.queryParams);var E=d.endpoint.initLoadContext({queryParams:w});g++,m.go((function(a){var d=function(e,t){g--,t&&s?s(t):n(e),a()},m=h?d:function(e){function t(t){e&&(e.image=t),g--,n(e),a()}e&&e.image?function(e,t){var n,r,i=e.width,s=e.height;if(0==(i&i-1)&&0==(s&s-1)){if(i*s<=_)return void t(e);n=i,r=s}else{for(n=1;1.5*n<i;)n*=2;for(r=1;1.5*r<s;)r*=2}for(;n*r>_;)n=Math.max(n/2,1),r=Math.max(r/2,1);var a=p.createElement("canvas"),c=a.getContext("2d");a.width=n,a.height=r,c.drawImage(e,0,0,n,r);var u=new Image;u.wasNPOT=!0,u.src=a.toDataURL(),u.onload=function(){t(u)},u.onerror=function(e){l.logger.error(e,Object(o.errorCodeString)(o.ErrorCodes.UNKNOWN_FAILURE)),t(null)}}(e.image,t):t()},w=function(e){g--,l.logger.error("Texture load error",e),n(null),a()};if(Object(i.isNodeJS)())!function(e,t,n,i,s){var a=new c.DataTexture(void 0,n);function u(e){s&&s.extractImage&&(e=s.extractImage(e)),a.image={data:e,width:void 0,height:void 0},a.needsUpdate=!0,i&&i(a)}function d(e,t){var n="Error: "+e+" ("+t+")";l.logger.error(n,Object(o.errorCodeString)(o.ErrorCodes.NETWORK_SERVER_ERROR)),i&&i(null,{msg:t,args:e})}r.ViewingService.getItem(t,e,u,d)}(e,E,t,d,v);else if(".dds"===e.slice(e.length-4).toLocaleLowerCase())if(Object(i.isIOSDevice)()){var A=e.slice(0,e.length-4)+".pvr";(new PVRLoader).load(A+"?"+E.queryParams,d,w)}else(new u.DDSLoader).load(e+"?"+E.queryParams,d,w);else y&&!x||v&&(v.rawData||v.extractImage)?function(e,t,n,i,s){var a=new c.Texture(void 0,n);function u(e){s&&s.extractImage&&(e=s.extractImage(e));var t,n,r=new Image;a.image=r,b(a),r.onload=function(){a.needsUpdate=!0,i&&i(a),f.URL.revokeObjectURL(r.src)},r.onerror=function(e){l.logger.error(e,Object(o.errorCodeString)(o.ErrorCodes.UNKNOWN_FAILURE)),i&&i(null)},r.src=(t=new Uint8Array(e),n=new Blob([t],{type:"image/jpeg"}),(f.URL||f.webkitURL).createObjectURL(n))}s&&s.rawData?u(s.rawData):r.ViewingService.getItem(t,e,u,(function(e,t){var n="Error: "+e+" ("+t+")";l.logger.error(n,Object(o.errorCodeString)(o.ErrorCodes.NETWORK_SERVER_ERROR)),i&&i(null,{msg:t,args:e})}),s)}(e,E,t,m,v):c.ImageUtils.loadTexture(E.queryParams?e+"?"+E.queryParams:e,t,m,w)}))}function w(e,t,n){var i=t.getData();return x(t.isOTG()?function(e){var t=d.endpoint.initLoadContext({});return i.makeSharedResourcePath(t.otg_cdn,"textures",e)}(e):function(e){for(var t=null,n=0;n<i.manifest.assets.length;++n){var o=i.manifest.assets[n];if(o.id.toLowerCase()==e.toLowerCase()){t=Object(r.pathToURL)(i.basePath+o.URI);break}}return t||(t=Object(r.pathToURL)(i.basePath+e)),t}(e),c.UVMapping,n,null,i.acmSessionId)}function E(e,t,n){if(t.textureMaps&&!t.texturesLoaded){t.texturesLoaded=!0;var r=e.getData(),i=t.textureMaps;for(var o in i){var a=i[o];if(!n.matman().loadTextureFromCache(e,t,a,o))w(a.uri,e,function(t){return function(i){if(i){var o=r.materials.scene.SceneUnit,a=n.renderer()?n.renderer().getMaxAnisotropy():0;s.MaterialConverter.convertTexture(t,i,o,a)}var l=n.matman();l&&(l.setTextureInCache(e,t,i),r.loadOptions.onTextureReceived&&r.loadOptions.onTextureReceived(l,t,i,!A()),!A()&&n&&r.loadDone&&!r.texLoadDone&&(r.texLoadDone=!0,n.onTextureLoadComplete(e)))}}(a))}}}function A(){return g}function M(e){e>=0&&(y=e,_=Math.max(16384,v/(4*y)))}var S={loadTextureWithSecurity:x,loadMaterialTextures:E,loadModelTextures:function(e,t){var n=t.matman(),r=n._getModelHash(e),i=0;if(e.isOTG())i=e.getData().metadata.stats.num_textures||0;else for(var o in n._materials){if(-1!==o.indexOf(r))(s=n._materials[o]).textureMaps&&(i+=Object.keys(s.textureMaps).length)}for(var o in M(i),n._materials){var s;if(-1!==o.indexOf(r))E(e,s=n._materials[o],t)}var a=e.getData();!A()&&t&&a.loadDone&&!a.texLoadDone&&(a.texLoadDone=!0,t.onTextureLoadComplete(e))},loadCubeMap:function(e,t,n){var r,i=function(r){r?(r.mapping=c.CubeReflectionMapping,r.LogLuv=-1!==e.indexOf("logluv"),r.RGBM=-1!==e.indexOf("rgbm"),Object(a.DecodeEnvMap)(r,t,!1,n)):n&&n(r)};return c.ImageUtils.crossOrigin="",Array.isArray(e)?(r=c.ImageUtils.loadTextureCube(e,c.CubeReflectionMapping,i)).format=c.RGBFormat:"string"==typeof e?-1!==e.toLowerCase().indexOf(".dds")?r=(new u.DDSLoader).load(e,i):(r=c.ImageUtils.loadTexture(e,c.SphericalReflectionMapping,n)).format=c.RGBFormat:e?n&&n(e):n&&n(null),r},requestsInProgress:A,calculateTextureSize:function(e){var t=4;switch(e.format){case c.AlphaFormat:t=1;break;case c.RGBFormat:t=3;break;case c.LuminanceFormat:t=1;break;case c.LuminanceAlphaFormat:t=2}switch(e.type){case c.ShortType:case c.UnsignedShortType:case c.HalfFloatType:t*=2;break;case c.IntType:case c.UnsignedIntType:case c.FloatType:t*=4;break;case c.UnsignedShort4444Type:case c.UnsignedShort5551Type:case c.UnsignedShort565Type:t=2}var n=t*e.image.width;return n+=e.unpackAlignment-1,n-=n%e.unpackAlignment,e.image.height*n},imageToCanvas:function(e){var t=e.width,n=e.height,r=p.createElement("canvas"),i=r.getContext("2d");return i.globalCompositeOperation="copy",r.width=t,r.height=n,i.drawImage(e,0,0,t,n),r}}},"./src/file-loaders/main/WorkerCreator.js":
/*!************************************************!*\
  !*** ./src/file-loaders/main/WorkerCreator.js ***!
  \************************************************/
/*! no static exports found */function(e,t,n){var r=n(/*! ../../compat */"./src/compat.js"),i=r.isNodeJS,o=r.getGlobal,s=n(/*! ../../globals */"./src/globals.js").getResourceUrl;i()?function(){var t=n(/*! ../workers/MainWorker-node */"../workers/MainWorker-node").MainWorker;function r(){return new t}e.exports={createWorker:r,initWorkerScript:function(e,t){e&&e()},createWorkerWithIntercept:function(){return r()}}}():function(){var t=Bimfish.Viewing.Private,n=t.LMV_WORKER_URL||"src/file-loaders/workers/MainWorker-web.js",r=null,i=!1,a=[];function l(){var e;return(e=t.ENABLE_INLINE_WORKER?new Worker(r):new Worker(s(n))).doOperation=e.postMessage,e}e.exports={createWorker:l,initWorkerScript:function(e,l){if(t.ENABLE_INLINE_WORKER&&!r){if(a.push({successCB:e}),!i){var c=new XMLHttpRequest,u=n,d=s(n);d&&(u=d),c.open("GET",u,!0),c.withCredentials=!1,c.onload=function(){var e,t=o();i=!1,t.URL=t.URL||t.webkitURL;try{e=new Blob([c.responseText],{type:"application/javascript"})}catch(t){var n=new BlobBuilder;n.append(c.responseText),e=n.getBlob()}r=URL.createObjectURL(e);var s=a.concat();a=[];for(var l=0;l<s.length;++l)s[l].successCB&&s[l].successCB()},i=!0,c.send()}var h={cancel:function(){var t=-1;return!!a.some((function(n,r){return n.successCB==e&&(t=r,!0)}))&&(a.splice(t,1),!0)}};return h}return e&&e(),null},createWorkerWithIntercept:function(){var e=l();e.checkEvent=function(e){return!(!e.data||!e.data.assetRequest)};var t=[];return e.addEventListenerWithIntercept=function(n){var r=function(t){e.checkEvent(t)||n(t)};return t||(t=[]),t.push({arg:n,callback:r}),e.addEventListener("message",r,!1),r},e.removeEventListenerWithIntercept=function(n){var r=function(e){if(!t)return null;for(var n=0;n<t.length;++n)if(t[n].arg===e){var r=t[n].callback;return t.splice(n,1),0===t.length&&(t=null),r}return null}(n);r&&e.removeEventListener("message",r,!1)},e.clearAllEventListenerWithIntercept=function(){if(t)for(var n=t.concat(),r=0;r<n.length;++r)e.removeEventListenerWithIntercept(n[r].arg)},e},clearWorkerDataURL:function(){r=null}}}()},"./src/file-loaders/main/WorkerCreatorWasm.js":
/*!****************************************************!*\
  !*** ./src/file-loaders/main/WorkerCreatorWasm.js ***!
  \****************************************************/
/*! exports provided: loadWasmWorker */function(e,t,n){"use strict";n.r(t),n.d(t,"loadWasmWorker",(function(){return o}));var r=n(/*! ../../globals */"./src/globals.js").getResourceUrl,i=n(/*! ../../compat */"./src/compat.js").getGlobal;function o(e){var t={},n=r("wasm.worker.js");return new Promise((function(t,s){var a,l;(a=n,l=Bimfish.Viewing.Private,new Promise((function(e){if(l.ENABLE_INLINE_WORKER){var t=new XMLHttpRequest;t.open("GET",a,!0),t.withCredentials=!1,t.onload=function(){var n,r=i();r.URL=r.URL||r.webkitURL;try{n=new Blob([t.responseText],{type:"application/javascript"})}catch(e){var o=new BlobBuilder;o.append(t.responseText),n=o.getBlob()}e(URL.createObjectURL(n))},t.send()}else e(a)}))).then((function(n){var i=new Worker(n),a={},l=r(e);i.postMessage({eventType:"INITIALIZE",eventData:l}),i.addEventListener("message",(function(e){if("INITIALIZED"===e.data.eventType){e.data.eventData.forEach((function(e){a[e]=function(){var t=arguments;return o(e,i,(function(n){n.postMessage({eventData:{method:e,arguments:Array.from(t)}})}))}}));return a.getBuffer=function(){return o("getBuffer",i,(function(e){e.postMessage({eventType:"GET_BUFFER"})}))},void t(a)}})),i.addEventListener("error",(function(e){s(e)}))}))}));function o(e,n,r){return new Promise((function(i,o){var s=function(e,n){var r,i;t&&t.hasOwnProperty(e)?(r=t[e][0],i=r.inUse):(t[e]=[],i=!0);i&&(r={channel:new MessageChannel,inUse:!1},t[e].push(r),n.postMessage({eventType:"SET_CHANNEL_PORT",eventData:{method:e,port:r.channel.port2}},[r.channel.port2]));return r}(e,n),a=s.channel;s.inUse=!0,r(a.port1),a.port1.onmessage=function(n){s.inUse=!1;var r=n.data.eventType,a=n.data.eventData;"ERROR"===r?o(a):i(a),function(e,t){for(var n=1;n<t.length;n++){var r=t[n].channel,i=e.channel;if(r===i)return t.splice(n,1),!0}}(s,t[e])}}))}}},"./src/file-loaders/net/ErrorCodes.js":
/*!********************************************!*\
  !*** ./src/file-loaders/net/ErrorCodes.js ***!
  \********************************************/
/*! exports provided: ErrorCodes, errorCodeString, getErrorCode */function(e,t,n){"use strict";n.r(t),n.d(t,"ErrorCodes",(function(){return r})),n.d(t,"errorCodeString",(function(){return i})),n.d(t,"getErrorCode",(function(){return o}));var r={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14,WEBGL_LOST_CONTEXT:15};function i(e){return"ErrorCode:"+e+"."}function o(e){return 403===e||401===e?r.NETWORK_ACCESS_DENIED:404===e?r.NETWORK_FILE_NOT_FOUND:e>=500?r.NETWORK_SERVER_ERROR:r.NETWORK_UNHANDLED_RESPONSE_CODE}},"./src/file-loaders/net/Xhr.js":
/*!*************************************!*\
  !*** ./src/file-loaders/net/Xhr.js ***!
  \*************************************/
/*! exports provided: ViewingService, pathToURL, textToArrayBuffer */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewingService",(function(){return v})),n.d(t,"pathToURL",(function(){return b})),n.d(t,"textToArrayBuffer",(function(){return x}));var r,i,o,s,a,l,c,u,d=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),h=n(/*! ./ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),f=n(/*! ../lmvtk/common/StringUtils */"./src/file-loaders/lmvtk/common/StringUtils.js"),p=n(/*! ./endpoints */"./src/file-loaders/net/endpoints.js"),m=n(/*! ../../compat */"./src/compat.js"),g=n(/*! pako */"./node_modules/pako/index.js"),v={},y=!1;function _(e){var t=e.split("/");if(0==t.length)return e;for(var n=[],r=0;r<t.length;++r){var i=t[r];"."!==i&&(".."===i&&n.length?n.pop():n.push(i))}return 0==n.length?"":n.join("/")}function b(e,t){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e;if(t)return t+e;if("undefined"==typeof window)return e;var n=Object(m.getGlobal)(),r=n.location.pathname,i=r.lastIndexOf("/");return r=r.substr(0,i+1),n.location.protocol+"//"+n.location.host+r+e}function x(e,t){for(var n=e.length-t,r=new ArrayBuffer(n),i=new Uint8Array(r,0),o=0,s=t;o<n;o++,s++)i[o]=255&e.charCodeAt(s);return i}function w(e,t){return-1===t.indexOf("file://")&&(-1!==t.indexOf("://")||(!!e||void 0))}if(v.simplifyPath=_,v.OSS_PREFIX="urn:adsk.objects:os.object:",v.generateUrl=function(e,t,n){if(n=n||"",Object(m.isNodeJS)()&&!w(e,n))return n;var r=(n=_(n)).indexOf("urn:"),i=n.indexOf("?");if(n=-1!=r?-1!==i?n.slice(0,r)+encodeURIComponent(n.slice(r,i))+n.slice(i):n.slice(0,r)+encodeURIComponent(n.slice(r)):encodeURI(n),!t||0!==decodeURIComponent(n).indexOf("urn:"))return w(null,n)?n:e+n;switch("items"!==t&&(n=n.substr(6)),t){case"items":return p.endpoint.getItemApi(e,n);case"bubbles":return p.endpoint.getManifestApi(e,n);case"thumbnails":return p.endpoint.getThumbnailApi(e,n)}},Object(m.isNodeJS)())r=n(/*! fs */"./node_modules/node-libs-browser/mock/empty.js"),i=n(/*! zlib */"./node_modules/node-libs-browser/mock/empty.js"),o=n(/*! https */"./node_modules/node-libs-browser/mock/empty.js"),s=n(/*! http */"./node_modules/node-libs-browser/mock/empty.js"),a=n(/*! url */"./node_modules/node-libs-browser/mock/empty.js"),l=new o.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),c=new s.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),u=new o.Agent({maxSockets:10}),v.rawGet=function(e,t,n,f,p,m){if(m=m||{},w(e,n=v.generateUrl(e,t,n))){if(m.queryParams){var g=-1===n.indexOf("?")?"?":"&";n=n+g+m.queryParams}var y=a.parse(n),_={host:y.hostname,port:y.port,method:m.method||"GET",path:y.path,headers:{},retryCount:0,agent:"https:"===y.protocol?l:c};if(_.host.endsWith(".api.Bimfish.com")&&(_.path.startsWith("/derivativeservice")||_.path.startsWith("/modelderivative"))&&(_.agent=u),m.headers)for(var b in m.headers)_.headers[b]=m.headers[b];_.headers["accept-encoding"]||(_.headers["accept-encoding"]="gzip, deflate"),m.range&&(_.headers.Range="bytes="+m.range.min+"-"+m.range.max),(m.ondata||m.onprogress)&&(m.responseType="arraybuffer");var x=("https:"===y.protocol?o:s).request(_,(function(e){var t=!(e.statusCode>=200&&e.statusCode<400),r=e;t||!function(e,t){return!!("gzip"===e.headers["content-encoding"]||t.endsWith(".json.gz")||t.endsWith("FragmentList.pack")||t.endsWith("LightList.bin")||t.endsWith("CameraList.bin")||t.endsWith("CameraDefinitions.bin")||t.endsWith("LightDefinitions.bin"))}(e,y.pathname)||m.skipDecompress||(r=e.pipe(i.createGunzip())),"json"!==m.responseType&&"text"!==m.responseType&&m.responseType||r.setEncoding("utf8");var o=[],s=Buffer.allocUnsafe(65536),a=0;r.on("data",(function(e){if(m.onprogress){if(e.length+a>s.length){var t=Buffer.allocUnsafe(0|Math.ceil(1.5*s.length));s.copy(t,0,0,a),s=t}return e.copy(s,a,0,e.length),a+=e.length,void(m.onprogress(s,a)&&x.abort())}o.push(e),m.ondata&&m.ondata(e)})),r.on("end",(function(){if(e.statusCode>=200&&e.statusCode<400){if("json"===m.responseType){var t=JSON.parse(o.join(""));return void f(t)}if("text"===m.responseType||""===m.responseType){var r=o.join("");return void f(r)}var l=m.onprogress?s:Buffer.concat(o);if(!m.skipDecompress&&31===l[0]&&139===l[1]){d.logger.warn("An LMV resource ("+n+") was double compressed, or Content-Encoding header missing");try{l=i.gunzipSync(l),a=l.length}catch(e){p(h.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:n,exception:e.toString(),stack:e.stack})}}200===x.status&&m.range&&(l=new Uint8Array(l,m.range.min,m.range.max-m.range.min)),f(l,a)}else p&&p(e.statusCode,e.statusMessage,{url:n})}))}));x.on("error",(function(e){p&&p(e.code,e.message,{url:n})})),m.postData&&x.write(m.postData),x.end()}else!function(e,t,n,o){function s(e){if("json"===o.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){n(e)}return e}0===e.indexOf("file://")&&(e=e.substr(7)),r.readFile(e,(function(r,a){r?n(0,0,{httpStatusText:r,url:e}):31===a[0]&&139===a[1]?i.gunzip(a,null,(function(r,i){r?n(0,0,{httpStatusText:r,url:e}):(i=s(i),o.ondata&&o.ondata(i),t(i))})):(a=s(a),o.ondata&&o.ondata(a),t(a))}))}(n,f,p,m)};else{var E=new(n(/*! pend */"./node_modules/pend/index.js"));E.max=25,v.rawGet=function(e,t,n,r,i,o){E.go((function(s){v._rawGet(e,t,n,(function(){s();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r&&r.apply(r,t)}),(function(){s();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i&&i.apply(i,t)}),o)}))},v._rawGet=function(e,t,n,r,i,o){if(o=o||{},n=v.generateUrl(e,t,n),o.queryParams){var s=-1===n.indexOf("?")?"?":"&";n=n+s+o.queryParams}var a=new XMLHttpRequest;function l(e){i&&i(a.status,a.statusText,{url:n})}function c(e){if("json"===o.responseType)try{if(e instanceof Uint8Array)return Object(f.blobToJson)(e);if("string"==typeof e)return JSON.parse(e)}catch(e){}return e}function u(e){if(200===a.status||206===a.status)if(a.response&&a.response instanceof ArrayBuffer){var t;if(t=200===a.status&&o.range?new Uint8Array(a.response,o.range.min,o.range.max-o.range.min):new Uint8Array(a.response),!o.skipDecompress&&31===t[0]&&139===t[1]){y||(y=!0,d.logger.warn("An LMV resource ("+n+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=g.ungzip(t)}catch(e){i(h.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:n,exception:e.toString(),stack:e.stack})}}r&&r(c(t))}else{var s=a.response;s||o.responseType&&"text"!==o.responseType||(s=a.responseText),r&&r(c(s))}else l()}try{var p=!o.hasOwnProperty("asynchronous")||o.asynchronous;if(a.open(o.method||(o.noBody?"HEAD":"GET"),n,p),o.hasOwnProperty("responseType")&&(a.responseType=o.responseType),a.withCredentials=!0,o.hasOwnProperty("withCredentials")&&(a.withCredentials=o.withCredentials),o.range&&a.setRequestHeader("Range","bytes="+o.range.min+"-"+o.range.max),o.headers)for(var m in o.headers)a.setRequestHeader(m,o.headers[m]),"authorization"===m.toLocaleLowerCase()&&(a.withCredentials=!1);p&&(a.onload=u,a.onerror=l,a.ontimeout=l,(o.ondata||o.onprogress)&&(a.overrideMimeType("text/plain; charset=x-user-defined"),o._dlProgress={streamOffset:0},a.onreadystatechange=function(){if(a.readyState>2&&200===a.status)if(o.ondata){var e=a.responseText;if(o._dlProgress.streamOffset>=e.length)return;var t=x(e,o._dlProgress.streamOffset);o._dlProgress.streamOffset=e.length,o.ondata(t)}else if(o.onprogress){o.onprogress(a.responseText)&&a.abort()}})),a.send(o.postData),p||u()}catch(e){i(a.status,a.statusText,{url:n,exception:e})}}}function A(e,t){t.hasOwnProperty("responseType")||(t.responseType="arraybuffer"),t.hasOwnProperty("withCredentials")||(t.withCredentials=!!e.auth),t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint}v.defaultFailureCallback=function(e,t,n){403==e?this.raiseError(h.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:n.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(h.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:n.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(h.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:n.url,httpStatus:e,httpStatusText:t}):n.exception?this.raiseError(h.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:n.url,exception:n.exception.toString(),stack:n.exception.stack}):this.raiseError(h.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:n.url,httpStatus:e,httpStatusText:t,data:n})},v.getItem=function(e,t,n,r,i){if(A(e,i=i||{}),i.range&&!e.supportsRangeRequests){var o="start="+i.range.min+"&end="+i.range.max;i.queryParams?i.queryParams+="&"+o:i.queryParams=o,i.range=void 0}v.rawGet(e.endpoint,"items",t,n,r,i)},v.getManifest=function(e,t,n,r,i){(i=i||{}).hasOwnProperty("responseType")||(i.responseType="json"),A(e,i),v.rawGet(e.endpoint,"bubbles",t,n,r,i)},v.getThumbnail=function(e,t,n,r,i){A(e,i=i||{});var o=i.queryParams||"",s=[];if(-1===o.indexOf("guid=")&&s.push("guid="+encodeURIComponent(i.guid)),-1===o.indexOf("role=")){var a=i.role||"rendered";s.push("role="+a)}if(-1===o.indexOf("width=")){var l=i.size||400;s.push("width="+l)}if(-1===o.indexOf("height=")){l=i.size||400;s.push("height="+l)}-1===o.indexOf("acmsession=")&&i.acmsession&&s.push("acmsession="+i.acmsession);var c=s.join("&");i.queryParams?i.queryParams=i.queryParams+"&"+c:i.queryParams=c,v.rawGet(e.endpoint,"thumbnails",t,n,r,i)},v.getACMSession=function(e,t,n,r){var i,o={};for(var s in t)"oauth2AccessToken"===s?i=t[s]:-1!==s.indexOf("x-ads-acm")&&(o[s]=t[s]);o.application="Bimfish";var a=new XMLHttpRequest;a.open("POST",e+"/oss-ext/v2/acmsessions",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+i),a.responseType="json",a.onload=function(){if(200===a.status&&a.response){var e="string"==typeof a.response?JSON.parse(a.response):a.response;e&&e.acmsession?n(e.acmsession):r(a.status,"Can't get acm session from response.")}else r(a.status)},a.onerror=r,a.ontimeout=r,a.send(JSON.stringify(o)),delete o.application}},"./src/file-loaders/net/endpoints.js":
/*!*******************************************!*\
  !*** ./src/file-loaders/net/endpoints.js ***!
  \*******************************************/
/*! exports provided: getEnv, setEnv, isOffline, setOffline, setOfflineResourcePrefix, getOfflineResourcePrefix, endpoint, initLoadContext */function(e,t,n){"use strict";n.r(t),n.d(t,"getEnv",(function(){return p})),n.d(t,"setEnv",(function(){return m})),n.d(t,"isOffline",(function(){return v})),n.d(t,"setOffline",(function(){return y})),n.d(t,"setOfflineResourcePrefix",(function(){return b})),n.d(t,"getOfflineResourcePrefix",(function(){return x})),n.d(t,"endpoint",(function(){return w})),n.d(t,"initLoadContext",(function(){return E}));var r=n(/*! ../../compat */"./src/compat.js"),i=Object(r.getGlobal)(),o={},s=null;o.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",o.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2",o.ENDPOINT_API_FLUENT="fluent";var a,l={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},derivativeV2_EU:{baseURL:"/derivativeservice/v2/regions/eu",itemURL:"/derivativeservice/v2/regions/eu/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/eu/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail"},fluent:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"}},c="",u=o.ENDPOINT_API_DERIVATIVE_SERVICE_V2,d=!1,h=!1,f="";function p(){return a}function m(e){a=e}o.HTTP_REQUEST_HEADERS={},o.setEndpointAndApi=function(e,t){c=e,t&&(u=t)},o.getEndpointAndApi=function(){return c+l[u].baseURL},o.getApiEndpoint=function(){return c},o.getApiFlavor=function(){return u},o.getCdnUrl=function(){return s||(c?c+l[u].cdnURL:void 0)},o.getCdnWebSocketEndpoint=function(){return c+(l[u].cdnWS||"")},o.setCdnUrl=function(e){s=e},o.getCdnRedirectUrl=function(){var e=l[u].cdnRedirectURL;return e?c+e:null},o.setAcmSession=function(e){f=e},o.getAcmSession=function(){return f},o.getManifestApi=function(e,t,n){var r=e||c;return t=t||"",r=(r+=l[n=n||u].manifestURL).replace(":urn",t)},o.getItemApi=function(e,t,n){var r=n||u,i=(e||c)+l[r].itemURL;t=t||"";var s=decodeURIComponent(t);if(-1!==i.indexOf(":urn")){var a=s.split("/")[0]||"";a=(a=a.split(":"))[a.length-1]||"",i=i.replace(":urn",a)}return r===o.ENDPOINT_API_MODEL_DERIVATIVE_V2&&(t=encodeURIComponent(s)),i=i.replace(":derivativeurn",t)},o.getThumbnailApi=function(e,t,n){return((e||c)+l[n||u].thumbnailsURL).replace(":urn",t||"")},o.getUseCredentials=function(){return d},o.getDomainParam=function(){return this.getUseCredentials()&&!Object(r.isNodeJS)()?"domain="+encodeURIComponent(i.location.origin):""},o.setUseCredentials=function(e){d=e},o.setUseCookie=function(e){h=e},o.getUseCookie=function(){return h},o.initLoadContext=function(e){for(var t in(e=e||{}).auth=this.getUseCredentials(),e.endpoint||(e.endpoint=this.getApiEndpoint()),e.api||(e.api=this.getApiFlavor()),e.headers||(e.headers={}),this.HTTP_REQUEST_HEADERS)e.headers[t]=this.HTTP_REQUEST_HEADERS[t];e.api===this.ENDPOINT_API_FLUENT&&(e.supportsRangeRequests=!0);var n=this.getDomainParam();return n&&(e.queryParams?e.queryParams+="&"+n:e.queryParams=n),e.otg_cdn=s||this.getCdnUrl(),e.otg_ws=this.getCdnWebSocketEndpoint(),e};var g=!1;function v(){return g}function y(e){g=e}var _="";function b(e){_=e}function x(){return _}var w=o,E=o.initLoadContext.bind(o)},"./src/globalization/i18init.js":
/*!**************************************!*\
  !*** ./src/globalization/i18init.js ***!
  \**************************************/
/*! exports provided: extendLocalization, setLanguage, initializeLocalization */function(e,t,n){"use strict";n.r(t),n.d(t,"extendLocalization",(function(){return a})),n.d(t,"setLanguage",(function(){return l})),n.d(t,"initializeLocalization",(function(){return c}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ./i18next */"./src/globalization/i18next.js"),o=n(/*! ./langs */"./src/globalization/langs.js");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function(e){return null!==e&&"object"===s(e)&&(Object.keys(e).forEach((function(t){i.i18n.addResourceBundle(t,"allstrings",e[t],!0,!0)})),!0)},l=function(e,t){var n={lng:e,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};Object(r.getGlobal)().LOCALIZATION_REL_PATH="res/locales/"+e+"/",i.i18n.init(n,(function(e){i.i18n.clearDebugLocString(),t&&t()}))},c=function(e){var t=e&&e.language||navigator.language,n=o.Lang.getSupported(t);l(n)}},"./src/globalization/i18next.js":
/*!**************************************!*\
  !*** ./src/globalization/i18next.js ***!
  \**************************************/
/*! exports provided: i18n */function(e,t,n){"use strict";n.r(t),n.d(t,"i18n",(function(){return F}));var r=n(/*! ../globals */"./src/globals.js"),i=n(/*! ../compat */"./src/compat.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=Object(i.getGlobal)(),a=s,l=a&&a.document,c=null;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>0&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=n;arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r))));for(var i=r>=0?Math.min(r,n-1):n-Math.abs(r);i>=0;i--)if(i in t&&t[i]===e)return i;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var u,d=s,h=d.jQuery||d.Zepto,f={},p=0,m=[],g=!1,v={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"};var y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};var _={create:function(e,t,n,r){var i;if(n){var o=new Date;o.setTime(o.getTime()+60*n*1e3),i="; expires="+o.toGMTString()}else i="";r=r?"domain="+r+";":"",l.cookie=e+"="+t+i+";"+r+"path=/"},read:function(e){for(var t=e+"=",n=l.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},remove:function(e){this.create(e,"",-1)}},b={extend:h?h.extend:function(e,t){if(!t||"function"==typeof t)return e;for(var n in t)e[n]=t[n];return e},each:h?h.each:function(e,t,n){var r,i=0,o=e.length,s=void 0===o||"[object Array]"!==Object.prototype.toString.apply(e)||"function"==typeof e;if(n)if(s){for(r in e)if(!1===t.apply(e[r],n))break}else for(;i<o&&!1!==t.apply(e[i++],n););else if(s){for(r in e)if(!1===t.call(e[r],r,e[r]))break}else for(;i<o&&!1!==t.call(e[i],i,e[i++]););return e},ajax:h?h.ajax:void 0!==l?function(e){var t=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e);var n,r,i,o,s,a,l,c="",u=0;do{o=(n=e.charCodeAt(u++))>>2,s=(3&n)<<4|(r=e.charCodeAt(u++))>>4,a=(15&r)<<2|(i=e.charCodeAt(u++))>>6,l=63&i,isNaN(r)?a=l=64:isNaN(i)&&(l=64),c+=t.charAt(o)+t.charAt(s)+t.charAt(a)+t.charAt(l),n=r=i="",o=s=a=l=""}while(u<e.length);return c},n=function e(t,n,r,i){"function"==typeof r&&(i=r,r={}),r.doNotCache=r.doNotCache||!1,r.data=r.data||{},r.headers=r.headers||{},r.jsonp=r.jsonp||!1,r.async=void 0===r.async||r.async;var o,s=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},e.headers,r.headers);if(o="application/json"===s["content-type"]?JSON.stringify(r.data):function(e){if("string"==typeof e)return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(r.data),"GET"===t){var c=[];if(o&&(c.push(o),o=null),r.doNotCache&&c.push("_="+(new Date).getTime()),r.jsonp&&(c.push("callback="+r.jsonp),c.push("jsonp="+r.jsonp)),(c=c.join("&")).length>1&&(n.indexOf("?")>-1?n+="&"+c:n+="?"+c),r.jsonp){var u=l.getElementsByTagName("head")[0],d=l.createElement("script");return d.type="text/javascript",d.src=n,void u.appendChild(d)}}!function(e){if(a.XMLHttpRequest)return e(null,new XMLHttpRequest);if(a.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}e(new Error)}((function(e,a){if(e)return i(e);for(var l in a.open(t,n,r.async),s)s.hasOwnProperty(l)&&a.setRequestHeader(l,s[l]);a.onreadystatechange=function(){if(4===a.readyState){var e=a.responseText||"";if(!i)return;i(a.status,e)}},a.send(o)}))};({authBasic:function(e,r){n.headers.Authorization="Basic "+t(e+":"+r)},connect:function(e,t,r){return n("CONNECT",e,t,r)},del:function(e,t,r){return n("DELETE",e,t,r)},get:function(e,t,r){return n("GET",e,t,r)},head:function(e,t,r){return n("HEAD",e,t,r)},headers:function(e){n.headers=e||{}},isAllowed:function(e,t,n){this.options(e,(function(e,r){n(-1!==r.text().indexOf(t))}))},options:function(e,t,r){return n("OPTIONS",e,t,r)},patch:function(e,t,r){return n("PATCH",e,t,r)},post:function(e,t,r){return n("POST",e,t,r)},put:function(e,t,r){return n("PUT",e,t,r)},trace:function(e,t,r){return n("TRACE",e,t,r)}})[e.type?e.type.toLowerCase():"get"](e.url,e,(function(t,n){200===t?e.success(n,t,null):e.error(n,t,null)}))}:function(){},cookie:void 0!==l?_:{create:function(e,t,n,r){},read:function(e){return null},remove:function(e){}},detectLanguage:function(){var e,t=[];"undefined"!=typeof window&&(!function(){for(var e=a.location.search.substring(1).split("&"),n=0;n<e.length;n++){var r=e[n].indexOf("=");if(r>0){var i=e[n].substring(0,r),o=e[n].substring(r+1);t[i]=o}}}(),t[v.detectLngQS]&&(e=t[v.detectLngQS]));if(!e&&void 0!==l&&v.useCookie){var n=b.cookie.read(v.cookieName);n&&(e=n)}e||"undefined"==typeof navigator||(e=navigator.language?navigator.language:navigator.userLanguage);return e},escape:function(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return y[e]})):e},log:function(e){v.debug&&"undefined"!=typeof console&&console.log(e)},toLanguages:function(e){var t=[];if("string"==typeof e&&e.indexOf("-")>-1){var n=e.split("-");e=v.lowerCaseLng?n[0].toLowerCase()+"-"+n[1].toLowerCase():n[0].toLowerCase()+"-"+n[1].toUpperCase(),"unspecific"!==v.load&&t.push(e),"current"!==v.load&&t.push(n[0])}else t.push(e);for(var r=0;r<v.fallbackLng.length;r++)-1===t.indexOf(v.fallbackLng[r])&&v.fallbackLng[r]&&t.push(v.fallbackLng[r]);return t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};function x(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},b.extend(v,e),delete v.fixLng,"string"==typeof v.ns&&(v.ns={namespaces:[v.ns],defaultNs:v.ns}),"string"==typeof v.fallbackNS&&(v.fallbackNS=[v.fallbackNS]),"string"!=typeof v.fallbackLng&&"boolean"!=typeof v.fallbackLng||(v.fallbackLng=[v.fallbackLng]),v.interpolationPrefixEscaped=b.regexEscape(v.interpolationPrefix),v.interpolationSuffixEscaped=b.regexEscape(v.interpolationSuffix),v.lng||(v.lng=b.detectLanguage()),v.lng?v.useCookie&&b.cookie.create(v.cookieName,v.lng,v.cookieExpirationTime,v.cookieDomain):(v.lng=v.fallbackLng[0],v.useCookie&&b.cookie.remove(v.cookieName)),m=b.toLanguages(v.lng),u=m[0],b.log("currentLng set to: "+u);var n=T;if(e.fixLng&&((n=function(e,t){return(t=t||{}).lng=t.lng||n.lng,T(e,t)}).lng=u),I.setCurrentLng(u),v.resStore)return b.each(v.resStore,(function(e,t){b.each(t,(function(t,n){w(e,t,n)}))})),g=!0,void(t&&t(n));var r=b.toLanguages(v.lng);"string"==typeof v.preload&&(v.preload=[v.preload]);for(var i=0,o=v.preload.length;i<o;i++)for(var s=b.toLanguages(v.preload[i]),a=0,l=s.length;a<l;a++)r.indexOf(s[a])<0&&r.push(s[a]);Bimfish.Viewing.i18n.sync.load(r,v,(function(e,r){b.each(r,(function(e,t){b.each(t,(function(t,n){w(e,t,n)}))})),g=!0,t&&t(n)}))}function w(e,t,n){"string"!=typeof t?(n=t,t=v.ns.defaultNs):v.ns.namespaces.indexOf(t)<0&&v.ns.namespaces.push(t),f[e]=f[e]||{},f[e][t]=f[e][t]||{},b.extend(f[e][t],n)}function E(e,t){var n={dynamicLoad:v.dynamicLoad,resGetPath:v.resGetPath,getAsync:v.getAsync,customLoad:v.customLoad,ns:{namespaces:e,defaultNs:""}},r=b.toLanguages(v.lng);"string"==typeof v.preload&&(v.preload=[v.preload]);for(var i=0,o=v.preload.length;i<o;i++)for(var s=b.toLanguages(v.preload[i]),a=0,l=s.length;a<l;a++)r.indexOf(s[a])<0&&r.push(s[a]);for(var c=[],u=0,d=r.length;u<d;u++){var h=!1,p=f[r[u]];if(p)for(var m=0,g=e.length;m<g;m++)p[e[m]]||(h=!0);else h=!0;h&&c.push(r[u])}c.length?R._fetch(c,n,(function(n,r){var i=e.length*c.length;b.each(e,(function(e,n){v.ns.namespaces.indexOf(n)<0&&v.ns.namespaces.push(n),b.each(c,(function(e,o){f[o]=f[o]||{},f[o][n]=r[o][n],0===--i&&t&&(v.useLocalStorage&&R._storeLocal(f),t())}))}))})):t&&t()}function A(e,t,n,r){if(!e)return e;if(r=r||t,e.indexOf(r.interpolationPrefix||v.interpolationPrefix)<0)return e;var i=r.interpolationPrefix?b.regexEscape(r.interpolationPrefix):v.interpolationPrefixEscaped,s=r.interpolationSuffix?b.regexEscape(r.interpolationSuffix):v.interpolationSuffixEscaped,a="HTML"+s;return b.each(t,(function(t,l){var c=n?n+v.keyseparator+t:t;e="object"===o(l)&&null!==l?A(e,l,c,r):r.escapeInterpolation||v.escapeInterpolation?(e=e.replace(new RegExp([i,c,a].join(""),"g"),l)).replace(new RegExp([i,c,s].join(""),"g"),b.escape(l)):e.replace(new RegExp([i,c,s].join(""),"g"),l)})),e}function M(e,t){var n=b.extend({},t);for(delete n.postProcess;-1!=e.indexOf(v.reusePrefix)&&!(++p>v.maxRecursion);){var r=e.lastIndexOf(v.reusePrefix),i=e.indexOf(v.reuseSuffix,r)+v.reuseSuffix.length,o=e.substring(r,i),s=o.replace(v.reusePrefix,"").replace(v.reuseSuffix,"");if(-1!=s.indexOf(",")){var a=s.indexOf(",");if(-1!=s.indexOf("{",a)&&-1!=s.indexOf("}",a)){var l=s.indexOf("{",a),c=s.indexOf("}",l)+"}".length;try{n=b.extend(n,JSON.parse(s.substring(l,c))),s=s.substring(0,a)}catch(e){}}}var u=L(s,n);e=e.replace(o,u)}return e}function S(e,t){var n=C(e,t=t||{}),r=D(e,t);return void 0!==r||r===n}function T(e,t){if(t=t||{},!g){b.log("i18next not finished initialization. you might have called t function before loading resources finished.");var n=e.indexOf(":");n<0?n=0:n++;var r=t.defaultValue||e.substr(n);return r&&(r=A(r,t)),r}return p=0,L.apply(null,arguments)}function C(e,t){return void 0!==t.defaultValue?t.defaultValue:e}function P(){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);return{postProcess:"sprintf",sprintf:e}}function L(e,t){if(t&&"object"!==o(t)?"sprintf"===v.shortcutFunction?t=P.apply(null,arguments):"defaultValue"===v.shortcutFunction&&(t={defaultValue:t}):t=t||{},null==e)return"";"string"==typeof e&&(e=[e]);var n=e[0];if(e.length>1)for(var r=0;r<e.length&&!S(n=e[r],t);r++);var i,s=C(n,t),a=D(n,t),l=t.lng?b.toLanguages(t.lng):m,u=t.ns||v.ns.defaultNs;n.indexOf(v.nsseparator)>-1&&(u=(i=n.split(v.nsseparator))[0],n=i[1]),void 0===a&&v.sendMissing&&(t.lng?R.postMissing(l[0],u,n,s,l):R.postMissing(v.lng,u,n,s,l));var d=t.postProcess||v.postProcess;if(void 0!==a&&d&&j[d]&&(a=j[d](a,n,t)),c&&void 0!==a)return c;var h=s;if(s.indexOf(v.nsseparator)>-1&&(h=(i=s.split(v.nsseparator))[1]),h===n&&v.parseMissingKey&&(s=v.parseMissingKey(s)),void 0===a&&(s=M(s=A(s,t),t),d&&j[d])){var f=C(n,t);a=j[d](f,n,t)}return void 0!==a?a:s}function D(e,t){var n,r,i=C(e,t=t||{}),o=m;if(!f)return i;if("cimode"===o[0].toLowerCase())return i;if(t.lng&&(o=b.toLanguages(t.lng),!f[o[0]])){var s=v.getAsync;v.getAsync=!1,R.load(o,v,(function(e,t){b.extend(f,t),v.getAsync=s}))}var a,l=t.ns||v.ns.defaultNs;if(e.indexOf(v.nsseparator)>-1){var c=e.split(v.nsseparator);l=c[0],e=c[1]}if(function(e){return e.context&&("string"==typeof e.context||"number"==typeof e.context)}(t)&&(delete(n=b.extend({},t)).context,n.defaultValue=v.contextNotFound,(r=T(l+v.nsseparator+e+"_"+t.context,n))!=v.contextNotFound))return A(r,{context:t.context});if(function(e){return void 0!==e.count&&"string"!=typeof e.count&&1!==e.count}(t)){delete(n=b.extend({},t)).count,n.defaultValue=v.pluralNotFound;var u=l+v.nsseparator+e+v.pluralSuffix,d=I.get(o[0],t.count);if(d>=0?u=u+"_"+d:1===d&&(u=l+v.nsseparator+e),(r=T(u,n))!=v.pluralNotFound)return A(r,{count:t.count,interpolationPrefix:t.interpolationPrefix,interpolationSuffix:t.interpolationSuffix})}for(var h=e.split(v.keyseparator),p=0,g=o.length;p<g&&void 0===a;p++){for(var y=o[p],_=0,x=f[y]&&f[y][l];h[_];)x=x&&x[h[_]],_++;if(void 0!==x){var w=Object.prototype.toString.apply(x);if("string"==typeof x)x=M(x=A(x,t),t);else if("[object Array]"!==w||v.returnObjectTrees||t.returnObjectTrees){if(null===x&&!0===v.fallbackOnNull)x=void 0;else if(null!==x)if(v.returnObjectTrees||t.returnObjectTrees){if("[object Number]"!==w&&"[object Function]"!==w&&"[object RegExp]"!==w){var E="[object Array]"===w?[]:{};b.each(x,(function(n){E[n]=L(l+v.nsseparator+e+v.keyseparator+n,t)})),x=E}}else v.objectTreeKeyHandler&&"function"==typeof v.objectTreeKeyHandler?x=v.objectTreeKeyHandler(e,x,y,l,t):(x="key '"+l+":"+e+" ("+y+")' returned an object instead of string.",b.log(x))}else x=M(x=A(x=x.join("\n"),t),t);"string"==typeof x&&""===x.trim()&&!0===v.fallbackOnEmpty&&(x=void 0),a=x}}if(void 0===a&&!t.isFallbackLookup&&(!0===v.fallbackToDefaultNS||v.fallbackNS&&v.fallbackNS.length>0))if(t.isFallbackLookup=!0,v.fallbackNS.length)for(var S=0,P=v.fallbackNS.length;S<P;S++){if(a=D(v.fallbackNS[S]+v.nsseparator+e,t))if((a.indexOf(v.nsseparator)>-1?a.split(v.nsseparator)[1]:a)!==(i.indexOf(v.nsseparator)>-1?i.split(v.nsseparator)[1]:i))break}else a=D(e,t);return a}b.applyReplacement=A;var R={load:function(e,t,n){t.useLocalStorage?R._loadLocal(e,t,(function(r,i){for(var o=[],s=0,a=e.length;s<a;s++)i[e[s]]||o.push(e[s]);o.length>0?R._fetch(o,t,(function(e,t){b.extend(i,t),R._storeLocal(t),n(null,i)})):n(null,i)})):R._fetch(e,t,(function(e,t){n(null,t)}))},_loadLocal:function(e,t,n){var r={},i=(new Date).getTime();if(a.localStorage){var o=e.length;b.each(e,(function(e,s){var l=a.localStorage.getItem("res_"+s);l&&(l=JSON.parse(l)).i18nStamp&&l.i18nStamp+t.localStorageExpirationTime>i&&(r[s]=l),0===--o&&n(null,r)}))}},_storeLocal:function(e){if(a.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),a.localStorage.setItem("res_"+t,JSON.stringify(e[t]))},_fetch:function(e,t,n){var i=t.ns,o={};if(t.dynamicLoad){var s=function(e,t){n(null,t)};if("function"==typeof t.customLoad)t.customLoad(e,i.namespaces,t,s);else{var a=A(t.resGetPath,{lng:e.join("+"),ns:i.namespaces.join("+")});a=Object(r.getResourceUrl)(a),b.ajax({url:a,success:function(e,t,n){b.log("loaded: "+a),s(0,e.json())},error:function(e,t,n){b.log("failed loading: "+a),s()},dataType:"text",async:t.getAsync})}}else{var l,c=i.namespaces.length*e.length;b.each(i.namespaces,(function(r,i){b.each(e,(function(e,r){var s=function(e,t){e&&(l=l||[]).push(e),o[r]=o[r]||{},o[r][i]=t,0===--c&&n(l,o)};"function"==typeof t.customLoad?t.customLoad(r,i,t,s):R._fetchOne(r,i,t,s)}))}))}},_fetchOne:function(e,t,n,i){var o=A(n.resGetPath,{lng:e,ns:t});o=Object(r.getResourceUrl)(o),b.ajax({url:o,success:function(e,t,n){b.log("loaded: "+o);var r=e;i(null,JSON.parse(r))},error:function(e,t,n){if(t&&200==t||e&&e.status&&200==e.status)b.log("There is a typo in: "+o);else if(t&&404==t||e&&e.status&&404==e.status)b.log("Does not exist: "+o);else{var r=t||(e&&e.status?e.status:null);b.log(r+" when loading "+o)}i(n,{})},dataType:"text",async:n.getAsync})},postMissing:function(e,t,n,r,i){var o={};o[n]=r;var s=[];if("fallback"===v.sendMissingTo&&!1!==v.fallbackLng[0])for(var a=0;a<v.fallbackLng.length;a++)s.push({lng:v.fallbackLng[a],url:A(v.resPostPath,{lng:v.fallbackLng[a],ns:t})});else if("current"===v.sendMissingTo||"fallback"===v.sendMissingTo&&!1===v.fallbackLng[0])s.push({lng:e,url:A(v.resPostPath,{lng:e,ns:t})});else if("all"===v.sendMissingTo){a=0;for(var l=i.length;a<l;a++)s.push({lng:i[a],url:A(v.resPostPath,{lng:i[a],ns:t})})}for(var c=0,u=s.length;c<u;c++){var d=s[c];b.ajax({url:d.url,type:v.sendType,data:o,success:function(e,i,o){b.log("posted missing key '"+n+"' to: "+d.url);for(var s=n.split("."),a=0,l=f[d.lng][t];s[a];)l=a===s.length-1?l[s[a]]=r:l[s[a]]=l[s[a]]||{},a++},error:function(e,t,r){b.log("failed posting missing key '"+n+"' to: "+d.url)},dataType:"json",async:v.postAsync})}}},I={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"Aymará",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){I.rules[e]=t},setCurrentLng:function(e){if(!I.currentRule||I.currentRule.lng!==e){var t=e.split("-");I.currentRule={lng:e,rule:I.rules[t[0]]}}},get:function(e,t){return function(t,n){var r;if(r=I.currentRule&&I.currentRule.lng===e?I.currentRule.rule:I.rules[t]){var i=r.plurals(n),o=r.numbers[i];return 2===r.numbers.length&&1===r.numbers[0]&&(2===o?o=-1:1===o&&(o=1)),o}return 1===n?"1":"-1"}(e.split("-")[0],t)}},j={},O=function(e,t){j[e]=t},N=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function e(){return e.cache.hasOwnProperty(arguments[0])||(e.cache[arguments[0]]=e.parse(arguments[0])),e.format.call(null,e.cache[arguments[0]],arguments)};return n.format=function(n,r){var i,o,s,a,l,c,u,d=1,h=n.length,f="",p=[];for(o=0;o<h;o++)if("string"===(f=e(n[o])))p.push(n[o]);else if("array"===f){if((a=n[o])[2])for(i=r[d],s=0;s<a[2].length;s++){if(!i.hasOwnProperty(a[2][s]))throw N('[sprintf] property "%s" does not exist',a[2][s]);i=i[a[2][s]]}else i=a[1]?r[a[1]]:r[d++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw N("[sprintf] expecting number but found %s",e(i));switch(a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,c=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(i).length,l=a[6]?t(c,u):"",p.push(a[5]?i+l:l+i)}return p.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var o=[],s=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw"[sprintf] huh?";for(o.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))o.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(s)))throw"[sprintf] huh?";o.push(a[1])}n[2]=o}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}();O("sprintf",(function(e,t,n){return n.sprintf?"[object Array]"===Object.prototype.toString.apply(n.sprintf)?(r=e,(i=n.sprintf).unshift(r),N.apply(null,i)):"object"===o(n.sprintf)?N(e,n.sprintf):e:e;var r,i}));var k=function(e){var t=e||l;Array.prototype.forEach.call(t.querySelectorAll("[data-i18n]"),(function(e){var t=e.getAttribute("data-i18n"),n=[null,t],r=n[0],i=n[1],o=T(i);o?r?e.setAttribute(r,o):e.placeholder?e.placeholder=o:e.textContent=o:r?e.setAttribute(r,i):e.textContent=i}))},F={init:x,setLng:function(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),t.lng=e,x(t,n)},preload:function(e,t){"string"==typeof e&&(e=[e]);for(var n=0,r=e.length;n<r;n++)v.preload.indexOf(e[n])<0&&v.preload.push(e[n]);return x(t)},addResourceBundle:w,removeResourceBundle:function(e,t){"string"!=typeof t&&(t=v.ns.defaultNs),f[e]=f[e]||{},f[e][t]={}},loadNamespace:function(e,t){E([e],t)},loadNamespaces:E,localize:k,setDefaultNamespace:function(e){v.ns.defaultNs=e},t:T,translate:T,exists:S,detectLanguage:b.detectLanguage,pluralExtensions:I,sync:R,functions:b,lng:function(){return u},addPostProcessor:O,options:v,setDebugLocString:function(){c="aaaa",k()},clearDebugLocString:function(){c=null,k()}}},"./src/globalization/langs.js":
/*!************************************!*\
  !*** ./src/globalization/langs.js ***!
  \************************************/
/*! exports provided: Lang */function(e,t,n){"use strict";n.r(t),n.d(t,"Lang",(function(){return r}));var r=new function(){this.names=[{symbol:"en",label:"English"},{symbol:"zh-HANS",label:"Chinese Simplified"},{symbol:"zh-HANT",label:"Chinese Traditional"},{symbol:"ja",label:"Japanese"},{symbol:"cs",label:"Czech"},{symbol:"ko",label:"Korean"},{symbol:"pl",label:"Polish"},{symbol:"ru",label:"Russian"},{symbol:"fr",label:"French"},{symbol:"fr-CA",label:"Canadian French"},{symbol:"de",label:"German"},{symbol:"it",label:"Italian"},{symbol:"nl",label:"Dutch"},{symbol:"es",label:"Spanish"},{symbol:"pt-BR",label:"Portuguese Brazil"},{symbol:"tr",label:"Turkish"},{symbol:"sv",label:"Swedish"},{symbol:"da",label:"Danish"}],this.isSupported=function(e){for(var t=0;t<this.names.length;++t)if(this.names[t].symbol===e)return!0;return!1},this.getSupported=function(e){var t=e.split("-");return e=t.length>1?t[0].toLowerCase()+"-"+t[1].toUpperCase():t[0].toLowerCase(),this.isSupported(e)||(e=e.indexOf("zh-CN")>-1?"zh-HANS":e.indexOf("zh-TW")>-1?"zh-HANT":t.length>1&&this.isSupported(t[0].toLowerCase())?t[0]:"en"),e},this.getLanguages=function(){return this.names.slice()}}},"./src/globals.js":
/*!************************!*\
  !*** ./src/globals.js ***!
  \************************/
/*! exports provided: getScript, injectCSS, getHtmlTemplate, isExperimentalFlagEnabled, getResourceUrl, getParameterByName, getParameterByNameFromPath, stringToDOM */function(e,t,n){"use strict";n.r(t),n.d(t,"getScript",(function(){return a})),n.d(t,"injectCSS",(function(){return l})),n.d(t,"getHtmlTemplate",(function(){return c})),n.d(t,"isExperimentalFlagEnabled",(function(){return u})),n.d(t,"getResourceUrl",(function(){return d})),n.d(t,"getParameterByName",(function(){return h})),n.d(t,"getParameterByNameFromPath",(function(){return f})),n.d(t,"stringToDOM",(function(){return p}));var r=n(/*! ./compat */"./src/compat.js"),i=Object(r.getGlobal)(),o=i,s=o&&o.document;function a(e){e=e.toLowerCase();var t=s.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var n=0;n<t.length;++n)if(t[n].src&&-1!==t[n].src.toLowerCase().indexOf(e))return t[n];return null}function l(e,t,n){for(var r=e.indexOf("://")>0?e:d(e),i=s.getElementsByTagName("link"),o=0,a=i.length;o<a;o++)if(i[o].href===r)return void(t&&t());var l=s.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",r),t&&(l.onload=t),n&&(l.onerror=n),s.head.appendChild(l)}function c(e,t){var n=e.indexOf("://")>0?e:d(e),r=new XMLHttpRequest;function i(e){t(e,null)}r.onload=function(e){var n=e.currentTarget.responseText;t(null,n)},r.onerror=i,r.ontimeout=i,r.open("GET",n,!0),r.send()}function u(e,t){return!(!t||!Array.isArray(t.experimental))&&-1!==t.experimental.indexOf(e)}function d(e){return i.LMV_RESOURCE_ROOT+e}function h(e){return"undefined"==typeof window?"":f(e,o.location.href)}function f(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function p(e){var t=s.createElement("div");return t.innerHTML=e,t.firstChild}i.LOCALIZATION_REL_PATH="",i.LMV_VIEWER_VERSION="7.9.0",i.LMV_BUILD_TYPE="Production",i.LMV_RESOURCE_ROOT="",i.LMV_THIRD_PARTY_COOKIE=!Object(r.isNodeJS)()&&void 0,"v"===i.LMV_VIEWER_VERSION.charAt(0)&&(i.LMV_VIEWER_VERSION=i.LMV_VIEWER_VERSION.substr(1)),i.LMV_VECTOR_PDF=!1,i.LMV_RASTER_PDF=!0},"./src/gui/AlertBox.css":
/*!******************************!*\
  !*** ./src/gui/AlertBox.css ***!
  \******************************/
/*! no static exports found */function(e,t,n){},"./src/gui/AlertBox.js":
/*!*****************************!*\
  !*** ./src/gui/AlertBox.js ***!
  \*****************************/
/*! exports provided: AlertBox */function(e,t,n){"use strict";n.r(t),n.d(t,"AlertBox",(function(){return i}));var r=n(/*! ../globalization/i18next */"./src/globalization/i18next.js");function i(){}i.instances=[],i.displayError=function(e,t,n,o,s){var a=e.ownerDocument,l=a.createElement("div");l.className="alert-box error",e.appendChild(l);var c=o;c||(c="img-item-not-found");var u=a.createElement("div");u.className="alert-box-image "+c,l.appendChild(u);var d=a.createElement("div");d.className="alert-box-msg",l.appendChild(d);var h=n;h||(h=r.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var f=a.createElement("div");f.className="alert-box-title",f.textContent=h,f.setAttribute("data-i18n",h),d.appendChild(f);var p=a.createElement("div");if(p.className="alert-box-text",p.textContent=t,p.setAttribute("data-i18n",t),d.appendChild(p),s){var m=a.createElement("div");m.className="alert-box-content",d.appendChild(m);var g=a.createElement("ul");g.className="alert-box-content";for(var v=0;v<s.length;v++){var y=s[v];if(y){var _=a.createElement("li"),b=this.extractList(y);if(b.list.length){var x=this.generateListElement(list,a);g.appendChild(x)}_.innerHTML=b.msg,_.setAttribute("data-i18n",b.msg),g.appendChild(_)}}m.appendChild(g)}var w=a.createElement("div");w.className="alert-box-ok",w.textContent=r.i18n.translate("OK",{defaultValue:"OK"});var E={alertBox:l,container:e};w.addEventListener("click",(function(t){l.style.visibility="hidden",e.removeChild(l),i.instances.splice(i.instances.indexOf(E),1)})),l.appendChild(w),l.style.visibility="visible",i.instances.push(E)},i.displayErrors=function(e,t,n){var o=e.ownerDocument,s=o.createElement("div");s.className="alert-box errors",e.appendChild(s);var a=t;a||(a="img-item-not-found");var l=o.createElement("div");l.className="alert-box-image "+a,s.appendChild(l);var c=o.createElement("div");c.className="alert-box-msg errors",s.appendChild(c);for(var u=0;u<n.length;u++){var d=n[u].header;d||(d=r.i18n.translate("Error",{defaultValue:"Error"}));var h=o.createElement("div");h.className="alert-box-title errors",h.textContent=d,c.appendChild(h);var f=o.createElement("div");f.className="alert-box-text errors";var p=n[u].msg;if((x=this.extractList(p)).list.length){var m=o.createElement("div"),g=this.generateListElement(x.list,o);m.appendChild(g),f.textContent=x.msg,f.appendChild(m)}else f.textContent=p;if(c.appendChild(f),n[u].hints){var v=o.createElement("ul");v.className="alert-box-content";for(var y=n[u].hints,_=0;_<y.length;_++){var b=y[_];if(b){var x,w=o.createElement("li");if(v.appendChild(w),(x=this.extractList(b)).list.length){g=this.generateListElement(x.list,o);v.appendChild(g)}w.innerHTML=x.msg}}c.appendChild(v)}}var E=o.createElement("div");E.className="alert-box-ok",E.textContent=r.i18n.translate("OK",{defaultValue:"OK"});var A={alertBox:s,container:e};E.addEventListener("click",(function(t){s.style.visibility="hidden",e.removeChild(s),i.instances.splice(i.instances.indexOf(A),1)})),s.appendChild(E),s.style.visibility="visible",i.instances.push(A)},i.extractList=function(e){var t={msg:e,list:[]};if(e&&-1!=e.indexOf("<ul>")){var n=e.split("<ul>");t.msg=n[0],n=n[1].split("</ul>"),t.list=n[0].split(", "),1===t.list.length&&(t.list=n[0].split(","))}return t},i.generateListElement=function(e,t){for(var n=t.createElement("ul"),r=0;r<e.length;r++){var i=t.createElement("li");i.textContent=e[r],i.setAttribute("data-i18n",e[r]),n.appendChild(i)}return n},i.dismiss=function(){if(i.instances.length>0){var e=i.instances.pop();return e.alertBox.style.visibility="hidden",e.container.removeChild(e.alertBox),!0}return!1}},"./src/gui/CommonWidgets.css":
/*!***********************************!*\
  !*** ./src/gui/CommonWidgets.css ***!
  \***********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/CommonWidgets.js":
/*!**********************************!*\
  !*** ./src/gui/CommonWidgets.js ***!
  \**********************************/
/*! exports provided: OptionSlider, OptionCheckbox, OptionLabel, OptionButton, OptionDropDown, ResizeFooter, OptionRow, SimpleList */function(e,t,n){"use strict";n.r(t),n.d(t,"OptionSlider",(function(){return c})),n.d(t,"OptionCheckbox",(function(){return u})),n.d(t,"OptionLabel",(function(){return d})),n.d(t,"OptionButton",(function(){return h})),n.d(t,"OptionDropDown",(function(){return f})),n.d(t,"ResizeFooter",(function(){return p})),n.d(t,"OptionRow",(function(){return m})),n.d(t,"SimpleList",(function(){return g}));var r=n(/*! ../application/EventDispatcher */"./src/application/EventDispatcher.js"),i=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),o=n(/*! ../compat */"./src/compat.js"),s=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=n(/*! ../../thirdparty/hammer/hammer.js */"./thirdparty/hammer/hammer.js");function c(e,t,n,r,o){var s=this;this.tbody=r;var a=o&&o.insertAtIndex?o.insertAtIndex:-1;this.hideStepper=o&&o.hideStepper;var l=o&&o.hideCaption;this.sliderRow=this.tbody.insertRow(a),this.sliderRow.classList.add("switch-slider-row");var c=this.getDocument(),u=this.sliderRow.insertCell(0);function d(e){e.target!=s.stepperElement&&(s.stepperElement.value=s.sliderElement.value),s.fireChangeEvent()}this.caption=c.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=i.i18n.translate(e),l&&(this.caption.style.display="none"),u.appendChild(this.caption),u=this.sliderRow.insertCell(1),this.sliderElement=c.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=e+"_slider",this.sliderElement.min=t,this.sliderElement.max=n,this.sliderElement.style.width="85%",u.appendChild(this.sliderElement),u=this.sliderRow.insertCell(2),this.stepperElement=c.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=e+"_stepper",this.stepperElement.min=t,this.stepperElement.max=n,this.stepperElement.step=1,this.stepperElement.style.width="64px",this.hideStepper&&(this.stepperElement.style.display="none"),u.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",(function(e){e.target!=s.sliderElement&&(s.sliderElement.value=s.stepperElement.value),s.fireChangeEvent()}),!1),this.sliderElement.addEventListener("change",d,!1),this.sliderElement.addEventListener("input",d,!1)}function u(e,t,n,r,s,a){var c=this;this.tbody=t;var u=a&&a.insertAtIndex?a.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(u),this.sliderRow.classList.add("switch-slider-row");var d=this.getDocument(),h=this.sliderRow.insertCell(0);this.caption=d.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=i.i18n.translate(e),h.appendChild(this.caption),h=this.sliderRow.insertCell(1),r&&(this.description=d.createElement("div"),this.description.setAttribute("data-i18n",r),this.description.textContent=i.i18n.translate(r),h.appendChild(this.description),h=this.sliderRow.insertCell(2));var f=d.createElement("label");f.classList.add("switch"),this.checkElement=d.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=e+"_check",this.checkElement.checked=n,f.appendChild(this.checkElement);var p=d.createElement("div");p.classList.add("slider"),f.appendChild(p),h.appendChild(f),this.blockEvent=!1,this.checked=n,this.checkElement.addEventListener("change",(function(e){c.fireChangeEvent()}),!1),Object(o.isTouchDevice)()&&(this.sliderRowHammer=new l.Manager(this.sliderRow,{recognizers:[[l.Tap]],handlePointerEventMouse:!1,inputClass:o.isIE11?l.PointerEventInput:l.TouchInput}),this.sliderRowHammer.on("tap",(function(e){e.preventDefault(),e.target.click()}))),this.checkElement.addEventListener("click",(function(e){e.stopPropagation()}),!1),this.sliderRow.addEventListener("click",(function(e){c.checkElement.disabled||(c.checkElement.checked=!c.checkElement.checked,c.fireChangeEvent())}),!1)}function d(e,t,n,r){this.tbody=t;var o=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o);var s=this.getDocument(),a=this.sliderRow.insertCell(0);this.caption=s.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=i.i18n.translate(e),a.appendChild(this.caption),a.colSpan="3",this.blockEvent=!1,this.removeFromParent=function(){this.tbody.removeChild(this.sliderRow),this.tbody=null,this.sliderRow=null,this.caption=null}}function h(e,t,n,r){this.tbody=t;var o=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o),this.sliderRow.insertCell();var s=this.sliderRow.insertCell();this.sliderRow.insertCell();var a=this.getDocument();this.caption=a.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=i.i18n.translate(e),this.caption.classList.add("adsk-button"),this.caption.classList.add("table-button"),s.appendChild(this.caption),this.removeFromParent=function(){this.tbody.removeChild(this.sliderRow),this._onClick&&(this.caption.removeEventListener("click",this._onClick),this._onClick=null),this.tbody=null,this.sliderRow=null,this.caption=null},this.setOnClick=function(e){this._onClick=e,this.caption.addEventListener("click",e,!1)}}function f(e,t,n,r,o,s,a){var l=this;this.tbody=t;var c=a&&a.insertAtIndex?a.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(c);var u=this.getDocument();this.dropdownElement=u.createElement("select"),this.dropdownElement.id=e+"_dropdown",this.dropdownElement.classList.add("option-drop-down");for(var d=0;d<n.length;d++){var h=u.createElement("option");h.value=d,h.setAttribute("data-i18n",n[d]),h.textContent=i.i18n.translate(n[d]),this.dropdownElement.add(h)}this.selectedIndex=this.dropdownElement.selectedIndex=r;var f=this.sliderRow.insertCell(0);(this.caption=u.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=i.i18n.translate(e),f.appendChild(this.caption),o)?(f.colSpan="2",this.sliderRow=this.tbody.insertRow(c),(f=this.sliderRow.insertCell(0)).appendChild(this.dropdownElement),f.colSpan="2",this.dropdownElement.classList.add("tabcell")):(f=this.sliderRow.insertCell(1)).appendChild(this.dropdownElement);f.style.paddingLeft=(a&&void 0!==a.paddingLeft?a.paddingLeft:5)+"px",f.style.paddingRight=(a&&void 0!==a.paddingRight?a.paddingRight:5)+"px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",(function(e){l.fireChangeEvent()}),!1)}function p(e,t,n){this.resizeCallback=t;var r=this.getDocument(),i=r.createElement("div");i.classList.add("docking-panel-footer");var o=r.createElement("div");o.classList.add("docking-panel-footer-resizer"),i.appendChild(o);var s=!1,a=e.getBoundingClientRect(),l={x:0,y:0},c=r.createElement("div");c.classList.add("adsk-viewing-viewer"),c.classList.add("docking-panel-resize-overlay");var u=function(t){s=!0,a=e.getBoundingClientRect(),this.getDocument().body.appendChild(c),this.addDocumentEventListener("touchmove",h),this.addDocumentEventListener("touchcancel",d),this.addDocumentEventListener("touchend",d),this.addDocumentEventListener("mousemove",h),this.addDocumentEventListener("mouseup",d),t.preventDefault(),t.stopPropagation()};u=u.bind(this);var d=function(e){var t=this.getDocument();t.body.contains(c)&&(t.body.removeChild(c),this.removeDocumentEventListener("touchmove",h),this.removeDocumentEventListener("touchcancel",d),this.removeDocumentEventListener("touchend",d),this.removeDocumentEventListener("mousemove",h),this.removeDocumentEventListener("mouseup",d),e.preventDefault(),e.stopPropagation())};d=d.bind(this);var h=function(t){"touchmove"===t.type&&(t.canvasX=t.touches[0].screenX,t.canvasY=t.touches[0].screenY),s&&(s=!1,l.x=t.canvasX||t.clientX,l.y=t.canvasY||t.clientY);var n=(t.canvasX||t.clientX)-l.x,r=(t.canvasY||t.clientY)-l.y,i=parseInt(a.width+n),o=parseInt(a.height+r);e.style.width=i+"px",e.style.height=o+"px",this.resizeCallback&&this.resizeCallback(i,o),t.preventDefault(),t.stopPropagation()};h=h.bind(this),o.addEventListener("touchstart",u),o.addEventListener("mousedown",u),e.style.resize="none",e.appendChild(i),this.footer=i,this.resizer=o}function m(e,t,n,r,o){this.tbody=t;var s=o&&o.insertAtIndex?o.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(s),this.sliderRow.classList.add("switch-slider-row");var a=this.getDocument(),l=this.sliderRow.insertCell(0);this.caption=a.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=i.i18n.translate(e),l.appendChild(this.caption),l=this.sliderRow.insertCell(1),n&&(this.description=a.createElement("div"),this.description.setAttribute("data-i18n",n),this.description.textContent=i.i18n.translate(n),l.appendChild(this.description),l=this.sliderRow.insertCell(2))}c.prototype.constructor=c,r.EventDispatcher.prototype.apply(c.prototype),c.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(e)}},c.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},c.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},s.GlobalManagerMixin.call(c.prototype),u.prototype.constructor=u,r.EventDispatcher.prototype.apply(u.prototype),s.GlobalManagerMixin.call(u.prototype),u.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(e)}},u.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},u.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},u.prototype.getValue=function(){return this.checkElement.checked},u.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},u.prototype.setVisibility=function(e){this.sliderRow.style.display=e?"table-row":"none"},s.GlobalManagerMixin.call(d.prototype),s.GlobalManagerMixin.call(h.prototype),f.prototype.constructor=f,r.EventDispatcher.prototype.apply(f.prototype),f.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},f.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},f.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(e)}},f.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e},s.GlobalManagerMixin.call(f.prototype),s.GlobalManagerMixin.call(p.prototype),s.GlobalManagerMixin.call(m.prototype);var g=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parentDiv=t,this._renderRowFn=n,this._onClickFn=r,this._onRowClick=this._onRowClick.bind(this);var i=this.getDocument(),o=i.createElement("div");o.classList.add("settings-container"),this._parentDiv.appendChild(o),this._myContainer=o,this._myContainer.addEventListener("click",this._onRowClick,{capture:!0});var s=i.createElement("div");s.classList.add("settings-table"),this._rowsContainer=s,o.appendChild(s)}var t,n,r;return t=e,(n=[{key:"setData",value:function(e,t){this._removeAllRows(),this._items=e;for(var n=0;n<e.length;++n)this._addRow(n);this._updateSelection(t)}},{key:"removeFromParent",value:function(){this._myContainer.removeEventListener("click",this._onRowClick,{capture:!0}),this._removeAllRows(),this._parentDiv.removeChild(this._myContainer),this._parentDiv=null,this._myContainer=null,this._rowsContainer=null,this._onClickFn=null,this._items=null}},{key:"_addRow",value:function(e){var t=this._items[e],n=this.getDocument(),r=n.createElement("div");this._renderRowFn(r,t,{domDocument:n}),r.setAttribute("data-index",e),this._rowsContainer.appendChild(r)}},{key:"_removeAllRows",value:function(){for(var e=this._rowsContainer.children;e.length;)this._rowsContainer.removeChild(e[0])}},{key:"_updateSelection",value:function(e){this._myContainer;for(var t=this._rowsContainer.children,n=0;n<t.length;n++){var r=t[n];n===e?r.classList.add("border-select"):r.classList.remove("border-select")}}},{key:"_onRowClick",value:function(e){for(var t,n=e.target;n!==this._myContainer&&!(t=n.getAttribute("data-index"));)n=n.parentNode;if(t){var r=parseInt(t);this._onClickFn(r)}}}])&&a(t.prototype,n),r&&a(t,r),e}();s.GlobalManagerMixin.call(g.prototype)},"./src/gui/ContextMenu.css":
/*!*********************************!*\
  !*** ./src/gui/ContextMenu.css ***!
  \*********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ContextMenu.js":
/*!********************************!*\
  !*** ./src/gui/ContextMenu.js ***!
  \********************************/
/*! exports provided: ContextMenu */function(e,t,n){"use strict";n.r(t),n.d(t,"ContextMenu",(function(){return l}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),s=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),a=n(/*! ../application/EventUtils */"./src/application/EventUtils.js");function l(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.menus=[],this.container=null,this.open=!1,this._onDOMevent=this._onDOMevent.bind(this)}l.prototype.constructor=l,s.GlobalManagerMixin.call(l.prototype),l.prototype.show=function(e,t){var n=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var r=e.clientX-n.left,i=e.clientY-n.top;this.open||(this.showMenu(t,r,i),this.open=!0)},l.prototype.showMenu=function(e,t,n){var o,s=[],a=this.getDocument(),l=a.createElement("div");l.style.left="0",l.style.top="0",l.style.width="100%",l.style.height="100%",l.style.position="absolute",l.style.zIndex="10";var c=a.createElement("div");c.classList.add("menu"),c.classList.add("docking-panel"),c.classList.add("docking-panel-container-solid-color-a"),l.appendChild(c),this.viewer.container.appendChild(l),this.container=l,this.menus.push(c);for(var u=0;u<e.length;++u){var d=e[u],h=d.title,f=d.target,p=d.icon,m=d.shortcut;o=this.createMenuItem(h,p,m),c.appendChild(o),"function"==typeof f?this.addCallbackToMenuItem(o,f):Array.isArray(f)?s.push({menuItem:o,target:f}):i.logger.warn("Invalid context menu option:",h,f)}var g=c.getBoundingClientRect(),v=g.width,y=g.height,_=this.viewer.container.getBoundingClientRect(),b=_.width,x=_.height,w=Object(r.isTouchDevice)()&&!this.viewer.navigation.getUseLeftHandedInput();for(w&&(t-=v),t<0&&(t=0),b<t+v&&(t=b-v)<0&&(t=0),n<0&&(n=0),x<n+y&&(n=x-y)<0&&(n=0),c.style.top=Math.round(n)+"px",c.style.left=Math.round(t)+"px",u=0;u<s.length;++u){var E=s[u];g=(o=E.menuItem).getBoundingClientRect(),t=Math.round((w?g.left:g.right)-_.left),n=Math.round(g.top-_.top),this.addSubmenuCallbackToMenuItem(o,E.target,t,n)}this.container.addEventListener("touchend",this._onDOMevent),this.container.addEventListener("mousedown",this._onDOMevent),this.container.addEventListener("mouseup",this._onDOMevent)},l.prototype._onDOMevent=function(e){switch(e.type){case"touchend":this._isContextMenu(e)||this.hide();break;case"mousedown":this._startX=e.clientX,this._startY=e.clientY;break;case"mouseup":this._isContextMenu(e)||(this.hide(),a.EventUtils.isRightClick(e)&&e.clientX===this._startX&&e.clientY===this._startY&&this.viewer.triggerContextMenu(e))}},l.prototype.createMenuItem=function(e,t,n){var r=this.getDocument().createElement("div");return r.className="menu-item",n=n||"",this.setMenuItemIcon(r,t),this.setMenuItemText(r,e),this.setMenuItemShortcut(r,n),r},l.prototype.setMenuItemIcon=function(e,t){var n=this.getDocument().createElement("div");n.classList.add("menu-item-icon"),t&&n.classList.add(t),e.appendChild(n)},l.prototype.setMenuItemText=function(e,t){var n=this.getDocument().createElement("div");n.classList.add("menu-item-text"),n.setAttribute("data-i18n",t),n.textContent=o.i18n.translate(t),e.appendChild(n)},l.prototype.setMenuItemShortcut=function(e,t){var n=this.getDocument().createElement("div");n.classList.add("menu-item-shortcut"),n.textContent=t,e.appendChild(n)},l.prototype.addCallbackToMenuItem=function(e,t){var n=this;e.addEventListener("click",(function(e){return n.hide(),t(),e.preventDefault(),!1}),!1)},l.prototype.addSubmenuCallbackToMenuItem=function(e,t,n,r){var i=this;e.addEventListener("click",(function(){i.showMenu(t,n,r)}),!1)},l.prototype.hide=function(){return!!this.open&&(this.menus=[],this.open=!1,this.container.removeEventListener("touchend",this._onDOMevent),this.container.removeEventListener("mousedown",this._onDOMevent),this.container.removeEventListener("mouseup",this._onDOMevent),this.container.parentNode.removeChild(this.container),this.container=null,!0)},l.prototype._isContextMenu=function(e){for(var t=this.menus[0],n=e.target;n!==this.container;){if(n===t)return!0;n=n.parentNode}return!1}},"./src/gui/DataTable.css":
/*!*******************************!*\
  !*** ./src/gui/DataTable.css ***!
  \*******************************/
/*! no static exports found */function(e,t,n){},"./src/gui/DataTable.js":
/*!******************************!*\
  !*** ./src/gui/DataTable.js ***!
  \******************************/
/*! exports provided: DataTable */function(e,t,n){"use strict";n.r(t),n.d(t,"DataTable",(function(){return o}));n(/*! ./DataTable.css */"./src/gui/DataTable.css");var r=n(/*! clusterize.js */"./node_modules/clusterize.js/clusterize.js"),i=Bimfish.Viewing.UI;function o(e){if(!(e instanceof i.DockingPanel))throw new Error("Invalid docking panel");this.dockingPanel=e;var t=this.dockingPanel.getDocument();this.datatableDiv=t.createElement("div"),this.datatableDiv.setAttribute("id","datatable"),this.datatableDiv.setAttribute("class","datatable"),e.container.appendChild(this.datatableDiv),e.footerInstance&&(e.footerInstance.resizeCallback=this._fitHeaderColumns.bind(this)),this.groupedByColumn=!1,this.aggregated=!1}o.prototype._createColumns=function(e){var t=this.dockingPanel.getDocument(),n=t.createElement("div");n.setAttribute("id","columnArea"),n.setAttribute("class","clusterize-headers");var r='<table id="headersArea"><thead><tr id ="columnRow"></tr></thead></table>';n.innerHTML=r,this.datatableDiv.appendChild(n);var i=n.querySelector("tr");e.forEach((function(e){var n=t.createElement("th");n.appendChild(t.createTextNode(e)),i.appendChild(n)})),r=this.datatableDiv.querySelector("table"),this._makeTableSortable(r)},o.prototype._createRows=function(){var e=this.dockingPanel.getDocument().createElement("div");e.innerHTML='<div id="scrollArea" class="clusterize-scroll"><table id="bodyArea" class="table-striped"><tbody id="contentArea" class="clusterize-content"><tr class="clusterize-no-data"><td>Loading data…</td></tr></tbody></table></div>',this.datatableDiv.appendChild(e)},o.prototype.setData=function(e,t){if(t.length!==e[0].length)throw new Error("Column length should be same as the row length");this._createColumns(t),this._createRows();var n=this;this.rowData=e,this.clusterize=new r({rows:this.rowData.map((function(e){return"<tr>"+e.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>"})),scrollId:"scrollArea",contentId:"contentArea",callbacks:{clusterChanged:function(){n._fitHeaderColumns(),n._syncHeaderWidth(),n.groupedByColumn&&n._updateClusterGroup()}}}),this.datatableDiv.querySelector(".clusterize-scroll").addEventListener("scroll",(function(){var e=this.scrollLeft;i(e)}));var i=function(e){n.datatableDiv.querySelector("#headersArea").style.setProperty("margin-left",-e+"px")}},o.prototype.destroyTable=function(){this.clusterize.destroy(!0),this.clusterize=null,this.rowData=null,this.groupedByColumn=!1},o.prototype._makeTableSortable=function(e){var t,n=this,r=e.tHead;if(r&&r.rows[0]&&(r=r.rows[0].cells),r)for(t=r.length;--t>=0;)!function(e){var t=1;r[e].addEventListener("click",(function(){n._sortTable(e,t=1-t)}))}(t)},o.prototype._sortTable=function(e,t){var n=this.rowData;this.sortFunction||this.restoreDefaultSortFunction();var r=this.sortFunction&&this.sortFunction.bind(this),i=(n=n.sort(r(e,t))).map((function(e){return"<tr>"+e.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>"}));this.clusterize.update(i);var o=this.datatableDiv.querySelector("#bodyArea");o.classList.contains("table-striped")||o.classList.add("table-striped")},o.prototype.setSortFunction=function(e){this.sortFunction=e},o.prototype.getSortFunction=function(){return this.sortFunction},o.prototype.restoreDefaultSortFunction=function(){this.sortFunction=function(e,t){return t=-(+t||-1),function(n,r){return t*n[e].localeCompare(r[e])}}},o.prototype.getGroupByColumn=function(e){for(var t=this.rowData,n={},r=0;r<t.length;r++){var i=t[r][e];n[i]||(n[i]=[]),n[i].push(r)}return n},o.prototype.groupByColumn=function(e){for(var t=this,n=this.rowData,r={},i=0;i<n.length;i++){var o=(u=n[i])[e];if(r[o]||(r[o]=[]),r[o].length>0)u="<tr class= 'subrow'>"+u.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>";else!function(){var e=u.length;'<span value="click"></span>',u="<tr class= 'parentrow'>"+u.map((function(t,n){return e===n+1?"<td>"+t+'<span value="click"></span></td>':"<td>"+t+"</td>"})).join(" ")+"</tr>"}();r[o].push(u)}var s=[];for(var a in r)for(var l=r[a],c=0;c<l.length;c++){var u=l[c];s.push(u)}this.clusterize.update(s);var d=this.datatableDiv.querySelector("#bodyArea");d.classList.contains("table-striped")&&d.classList.remove("table-striped"),this.datatableDiv.querySelectorAll(".subrow").forEach((function(e){t._slideDown(e),e.style.fontSize="14px"}));var h=this._fitHeaderColumns.bind(this),f=this._expandContent.bind(this);this.datatableDiv.querySelectorAll("span").forEach((function(e){e.addEventListener("click",(function(e){f(this,e),h()}))})),this._fitHeaderColumns(),this.groupedByColumn||(this.groupedByColumn=!0)},o.prototype._updateClusterGroup=function(){var e=this,t=this._fitHeaderColumns.bind(this),n=this._expandContent.bind(this);this.datatableDiv.querySelectorAll("span").forEach((function(e){e.addEventListener("click",(function(e){n(this,e),t()}))})),this.datatableDiv.querySelectorAll(".subrow").forEach((function(t){e._slideDown(t),t.style.fontSize="14px"}))},o.prototype._expandContent=function(e,t){var n=!1;"collapsed"===e.className&&(n=!0);for(var r=n?14:0,i=e.closest("tr"),o=this._nextUntil(i,":not(.subrow)"),s=0;s<o.length;s++)this._slideToggle(o[s],500),o[s].style.fontSize=r+"px";e.classList.toggle("collapsed")},o.prototype._nextUntil=function(e,t,n){var r=[];for(e=e.nextElementSibling;e&&!e.matches(t);)!n||e.matches(n)?(r.push(e),e=e.nextElementSibling):e=e.nextElementSibling;return r},o.prototype._slideToggle=function(e,t){return"none"===this.dockingPanel.getWindow().getComputedStyle(e).display?this._slideDown(e,t):this._slideUp(e,t)},o.prototype._slideUp=function(e,t){e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.boxSizing="border-box",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")},o.prototype._slideDown=function(e,t){var n=this.dockingPanel.getWindow();e.style.removeProperty("display");var r=n.getComputedStyle(e).display;"none"===r&&(r="block"),e.style.display=r;e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.offsetHeight,e.style.boxSizing="border-box",e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height="21pxpx",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),n.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)},o.prototype.getAggregate=function(e,t){var n,r=this.rowData,i=null;switch(e){case"MIN":i=function(){for(var e=r[0][t],n=1;n<r.length;n++)e>r[n][t]&&(e=r[n][t]);return e||0}();break;case"MAX":i=function(){for(var e=r[0][t],n=1;n<r.length;n++)e<r[n][t]&&(e=r[n][t]);return e||0}();break;case"SUM":i=o();break;case"AVG":n=o()/r.length,i=(n=parseFloat(n))||0;break;case"COUNT":i=r.length}return i;function o(){for(var e=0,n=0;n<r.length;n++)e+=parseFloat(r[n][t]);return e||0}},o.prototype.aggregate=function(e,t){var n=this.datatableDiv.querySelector(".clusterize-content").querySelector("tr:not(.clusterize-extra-row):not(.first)");if(n){for(var r=[],i=0;i<n.children.length;i++)r.push(n.children[i].clientWidth);var o=this.getAggregate(e,t);if(!this.aggregated){var s=this.dockingPanel.getDocument().createElement("div");s.setAttribute("id","aggregate"),s.setAttribute("class","aggregate-headers");s.innerHTML='<table id="aggregateArea"><tbody></tbody></table>',this.datatableDiv.appendChild(s)}for(var a=this.datatableDiv.querySelector("#aggregateArea"),l=0;l<a.rows.length;l++){if(a.rows[l].cells[t].innerText.indexOf(e)>-1)return}for(var c=0;c<a.rows.length;c++){var u=a.rows[c].cells[t];if(0===u.innerText.length)return u.appendChild(_document.createTextNode(e+": ")),void u.appendChild(_document.createTextNode(o))}for(var d=a.insertRow(a.rows.length),h=0;h<r.length;h++){var f=_document.createElement("td");d.appendChild(f),f.style.setProperty("min-width",r[h]+"px","important"),h===t&&(f.appendChild(_document.createTextNode(e+": ")),f.appendChild(_document.createTextNode(o)))}this.aggregated=!0}},o.prototype.clearAggregates=function(){for(var e=this.datatableDiv.querySelectorAll(".aggregate-headers"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},o.prototype._fitHeaderColumns=function(){var e=this.datatableDiv.querySelector(".clusterize-content"),t=this.datatableDiv.querySelector("#headersArea"),n=e.querySelector("tr:not(.clusterize-extra-row):not(.first)");if(n){for(var r=[],i=[],o=0;o<n.children.length;o++)i.push(n.children[o].clientWidth);if(i.toString()!=r.toString()){for(var s=t.querySelector("tr"),a=0;a<s.children.length;a++)s.children[a].style.setProperty("clientWidth",i[a]+"px","important"),s.children[a].style.setProperty("min-width",i[a]+"px","important");if(this.aggregated)for(var l=this.datatableDiv.querySelector("#aggregateArea"),c=0;c<l.rows.length;c++)for(var u=l.rows[c],d=0;d<u.children.length;d++)u.children[d].style.setProperty("clientWidth",i[d]+"px","important"),u.children[d].style.setProperty("min-width",i[d]+"px","important");r=i}}},o.prototype._syncHeaderWidth=function(){var e=this.datatableDiv.querySelector(".clusterize-content"),t=this.datatableDiv.querySelector("#headersArea");t.style.setProperty("clientWidth",e.width),t.style.setProperty("min-idth",e.width)}},"./src/gui/DockingPanel.css":
/*!**********************************!*\
  !*** ./src/gui/DockingPanel.css ***!
  \**********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/DockingPanel.js":
/*!*********************************!*\
  !*** ./src/gui/DockingPanel.js ***!
  \*********************************/
/*! exports provided: DockingPanel */function(e,t,n){"use strict";n.r(t),n.d(t,"DockingPanel",(function(){return o}));var r=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),i=n(/*! ./CommonWidgets */"./src/gui/CommonWidgets.js");function o(e,t,n,r){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.movedSinceCreate=!1,this.parentContainer=e;var i=this.getDocument();this.container=i.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=n,(r=r||{}).hasOwnProperty("localizeTitle")||(r.localizeTitle=!0),r.hasOwnProperty("addFooter")||(r.addFooter=!0),this.options=r,this.container.classList.add("docking-panel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)}n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(o.prototype),o.prototype.onSetGlobalManager=function(e){this.footerInstance&&this.footerInstance.setGlobalManager(e)},o.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer),this.options.addFooter&&(this.footer=this.createFooter(),this.container.appendChild(this.footer))},o.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},o.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},o.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect();if(this.container.dockRight){var n=t.width,r=300,i=this.container.lastWidth||this.container.style.width;i||(i=this.container.getBoundingClientRect().width),i&&(r=parseInt(i)),this.container.style.left=n-r+"px"}if(this.container.dockBottom){var o=t.height,s=300,a=this.container.lastHeight||this.container.style.height;a||(a=this.container.getBoundingClientRect().height),a&&(s=parseInt(a));var l=o-s;this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block",this.bringToFront()}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var c=0;c<this.visibilityCallbacks.length;c++)this.visibilityCallbacks[c](e)},o.prototype.isVisible=function(){return"block"===this.container.style.display},o.prototype.visibilityChanged=function(){},o.prototype.initializeMoveHandlers=function(e){var t,n,r,i,o,s,a,l,c=this.container,u=this;function d(e){var d=c.style.minWidth?parseInt(c.style.minWidth):u.kMinWdth,h=c.style.minHeight?parseInt(c.style.minHeight):u.kMinHeight,f=u.getContainerBoundingRect();c.style.maxWidth&&parseInt(c.style.width)>parseInt(c.style.maxWidth)&&(c.style.width=c.style.maxWidth),c.style.maxHeight&&parseInt(c.style.height)>parseInt(c.style.maxHeight)&&(c.style.height=c.style.maxHeight),parseInt(c.style.width)<d&&(c.style.width=d+"px"),parseInt(c.style.height)<h&&(c.style.height=h+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),a+=e.screenX-r,l+=e.screenY-i,t=o+a,n=s+l;var p=parseInt(c.style.width),m=parseInt(c.style.height);isNaN(p)&&(p=u.container.getBoundingClientRect().width),isNaN(m)&&(m=u.container.getBoundingClientRect().height),t<5&&(t=0),n<5&&(n=0),c.dockRight=!1,c.dockBottom=!1,f.width-5<t+p&&(t=f.width-p,c.dockRight=!0),f.height-5<n+m&&(n=f.height-m,c.dockBottom=!0),c.style.left=t+"px",c.style.top=n+"px",c.style.maxWidth=f.width-t+"px",c.style.maxHeight=f.height-n+"px",r=e.screenX,i=e.screenY,u.onMove(e,t,n)}function h(e){u.removeWindowEventListener("mousemove",d),u.removeWindowEventListener("mouseup",h),u.removeWindowEventListener("touchmove",d),u.removeWindowEventListener("touchend",h),u.onEndMove(e,t,n)}function f(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),r=e.screenX,i=e.screenY,a=0,l=0,o=u.container.offsetLeft,s=u.container.offsetTop,u.addWindowEventListener("mousemove",d,!1),u.addWindowEventListener("mouseup",h,!1),u.addWindowEventListener("touchmove",d,!1),u.addWindowEventListener("touchend",h,!1),e.preventDefault(),u.onStartMove(e,o,s)}u.addEventListener(e,"mousedown",f),u.addEventListener(e,"touchstart",f)},o.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",(function(e){t.setVisible(!1)}),!1)},o.prototype.createScrollContainer=function(e){var t=this.getDocument().createElement("div"),n=t.classList;return n.add("docking-panel-scroll"),n.add("docking-panel-container-solid-color-a"),n.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,this.scrollEaseCurve=e&&e.scrollEaseCurve||[0,0,.29,1],this.scrollEaseSpeed=e&&e.scrollEaseSpeed||.003,t},o.prototype.createTitleBar=function(e){var t=this.getDocument().createElement("div");t.classList.add("docking-panel-title"),t.textContent=e;var n=this;return n.addEventListener(t,"click",(function(e){n.movedSinceLastClick||n.onTitleClick(e),n.movedSinceLastClick=!1})),n.addEventListener(t,"mousedown",(function(e){n.bringToFront()})),n.addEventListener(t,"dblclick",(function(e){n.onTitleDoubleClick(e)})),t},o.prototype.createFooter=function(){var e=new i.ResizeFooter(this.container);return e.setGlobalManager(this.globalManager),this.footerInstance=e,this.container.style.resize="none",e.footer},o.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=r.i18n.translate(e)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},o.prototype.createCloseButton=function(){var e=this.getDocument().createElement("div");return e.className="docking-panel-close",this.initializeCloseHandler(e),e},o.prototype.onStartMove=function(e,t,n){},o.prototype.onEndMove=function(e,t,n){},o.prototype.onMove=function(e,t,n){this.movedSinceLastClick=!0,this.movedSinceCreate=!0},o.prototype.onTitleClick=function(e){},o.prototype.onTitleDoubleClick=function(e){},o.prototype.addEventListener=function(e,t,n){e.addEventListener(t,n),this.listeners.push({target:e,eventId:t,callback:n})},o.prototype.removeEventListener=function(e,t,n){for(var r=0;r<this.listeners.length;++r){var i=this.listeners[r];if(i.target===e&&i.eventId===t&&i.callback===n)return e.removeEventListener(t,n),this.listeners.splice(r,1),!0}return!1},o.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},o.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize().height,n=this.container.getBoundingClientRect(),r=this.getContainerBoundingRect(),i=this.container.querySelector(".docking-panel-footer");i&&(t+=i.getBoundingClientRect().height);var o=r.height;o-=n.top-r.top+75,e&&void 0!==e.maxHeight&&(o=Math.min(o,e.maxHeight)),t>o&&(t=o),this.container.style.maxHeight=o.toString()+"px",this.container.style.height=t.toString()+"px"}},o.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},o.prototype.animateScroll=function(e,t,n){var r=this.scrollEaseCurve,i=this.scrollEaseSpeed,o=this.scrollContainer;var s=performance.now();requestAnimationFrame((function a(l){var c=(l-s)*i;c=Math.min(c,1);var u=function(e,t){var n=3*e[1],r=3*(e[3]-e[1])-n;return(((1-n-r)*t+r)*t+n)*t}(r,c),d=e+(t-e)*u;o.scrollTop=d,n&&n(d),c<1&&requestAnimationFrame(a)}))},o.prototype.onViewerResize=function(e,t,n,r,i,o){var s=this.container,a=s.getBoundingClientRect(),l=a.width,c=a.height;if(!l||!c)return!1;var u=a.top,d=a.bottom,h=a.left,f=a.right;return i<l&&(l=Math.round(i),s.style.width=l+"px"),o<c&&(c=Math.round(o),s.style.height=c+"px"),(r<f||s.dockRight)&&(h=Math.round(r-l-n),s.style.left=h+"px"),(t<d||s.dockBottom)&&((u=Math.round(t-c-e))<0&&(u=0),s.style.top=u+"px"),s.style.maxWidth=Math.round(i)+"px",s.style.maxHeight=Math.round(o)+"px",!0},o.prototype.bringToFront=function(){var e=this.scrollContainer?this.scrollContainer.scrollTop:0;this.parentContainer.appendChild(this.container),this.scrollContainer&&(this.scrollContainer.scrollTop=e)}},"./src/gui/ErrorHandler.js":
/*!*********************************!*\
  !*** ./src/gui/ErrorHandler.js ***!
  \*********************************/
/*! exports provided: ErrorHandler */function(e,t,n){"use strict";n.r(t),n.d(t,"ErrorHandler",(function(){return c}));var r=n(/*! ./AlertBox */"./src/gui/AlertBox.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),s=n(/*! ../envinit */"./src/envinit.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You don’t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We can’t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.Bimfish.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>There’s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldn’t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":{title:"Sorry",message:"The file extension loaded into the Viewer is not supported",hints:["Try a different file"]}},15:{img:"img-unsupported","globalized-msg":"Viewer-WebGlContextLost","default-msg":{title:"WebGL context lost",message:"Unable to recover from software mode.  Please restart your browser and reload the Viewer",hints:["If you continue to encounter this issue when viewing this model, we recommend switching to a different browser."]}}};function c(){}c.prototype.constructor=c,c.reportError=function(e,t,n,a,u,d){if(c.currentError=null,c.currentErrors=null,t){var h={category:"error",code:t,message:n,httpStatusCode:a,httpStatusText:u};i.logger.track(h,!0),c.currentError=[e,t,n,d];var f=l[t];if(f){(_={defaultValue:""}).defaultValue=f["default-msg"];var p=f.img,m=f["globalized-msg"],g=this.parseErrorString(m,_);if(t===Bimfish.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||t===Bimfish.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var v=Object(s.getWebGLHelpLink)()||"http://www.Bimfish.com/a360-browsers",y=0;y<g.hints.length;y++){-1!==g.hints[y].indexOf('href="WEBGL_HELP"')&&(g.hints[y]=g.hints[y].replace('href="WEBGL_HELP"','href="'+v+'"'))}r.AlertBox.displayError(e,g.msg,g.header,p,g.hints)}else{p="img-unsupported";var _={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(n,_),(g=this.parseErrorString(t,_)).header||(g.header="warning"===d?o.i18n.translate("header-warning"):""),r.AlertBox.displayError(e,g.msg,g.header,p,g.hints)}}},c.reportErrors=function(e,t){if(c.currentError=null,c.currentErrors=null,t){c.currentErrors=[e,t];for(var n={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},s=[],a=0;a<t.length;a++)if(t[a].code){this.parseArguments(t[a].message,n);var l=this.parseErrorString(t[a].code,n);l.header||(l.header="warning"===t[0].type?o.i18n.translate("header-warning",{defaultValue:"Warning"}):""),s.push(l);var u={category:"error",code:t[a].code,message:t[a].message};i.logger.track(u,!0)}if(s.length){r.AlertBox.displayErrors(e,"img-unsupported",s)}}},c.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e;else{t.defaultValue=e[0];for(var n=1;n<e.length;n++){t[(n-1).toString()]=e[n]}}},c.parseErrorString=function(e,t){var n={msg:null,msgList:null,header:null,hints:null};if(!e)return n;if("object"===a(t.defaultValue)){var r=t.defaultValue;return n.header=r.title,n.msg=r.message,n.hints=r.hints.concat(),n}var i=o.i18n.translate(e,t);if(!i)return n;if(-1!=i.indexOf("<title>")){var s=i.split("<title>")[1].split("</title>");n.header=s[0],i=s[1]}if(i&&-1!=i.indexOf("<message>")){s=i.split("<message>")[1].split("</message>");n.msg=s[0],i=s[1]}else n.msg=i;if(i&&-1!=i.indexOf("<hint>")){n.hints=[];for(var l=i.split("<hint>"),c=0;c<l.length;c++){var u=l[c].split("</hint")[0];n.hints.push(u)}}return n},c.localize=function(){if(r.AlertBox.instances.length>0)if(r.AlertBox.dismiss(),c.currentError){var e=c.currentError.shift(),t=c.currentError;c.reportError(e,t[0],t[1],t[2])}else{e=c.currentErrors.shift();var n=c.currentErrors[0];c.reportErrors(e,n)}}},"./src/gui/GuiViewer3D.css":
/*!*********************************!*\
  !*** ./src/gui/GuiViewer3D.css ***!
  \*********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/GuiViewer3D.js":
/*!********************************!*\
  !*** ./src/gui/GuiViewer3D.js ***!
  \********************************/
/*! exports provided: GuiViewer3D */function(e,t,n){"use strict";n.r(t),n.d(t,"GuiViewer3D",(function(){return T}));var r=n(/*! ../application/Viewer3D */"./src/application/Viewer3D.js"),i=n(/*! ../tools/HotGestureTool */"./src/tools/HotGestureTool.js"),o=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),s=n(/*! ../compat */"./src/compat.js"),a=n(/*! ../application/ScreenModeDelegate */"./src/application/ScreenModeDelegate.js"),l=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),c=n(/*! ./controls/Button */"./src/gui/controls/Button.js"),u=n(/*! ./controls/ControlGroup */"./src/gui/controls/ControlGroup.js"),d=n(/*! ./toolbar/ToolBar */"./src/gui/toolbar/ToolBar.js"),h=n(/*! ./controls/RadioButtonGroup */"./src/gui/controls/RadioButtonGroup.js"),f=n(/*! ./ErrorHandler */"./src/gui/ErrorHandler.js"),p=n(/*! ./ProgressBar */"./src/gui/ProgressBar.js"),m=n(/*! ../logger/Logger */"./src/logger/Logger.js"),g=n(/*! ../globals */"./src/globals.js"),v=n(/*! ./RenderOptionsPanel */"./src/gui/RenderOptionsPanel.js"),y=n(/*! ../globalization/langs */"./src/globalization/langs.js"),_=n(/*! ../globalization/i18init */"./src/globalization/i18init.js"),b=n(/*! ./HudMessage */"./src/gui/HudMessage.js"),x=n(/*! ./AlertBox */"./src/gui/AlertBox.js"),w=n(/*! ./SettingsPanel */"./src/gui/SettingsPanel.js"),E=n(/*! ./ViewerSettingsPanel */"./src/gui/ViewerSettingsPanel.js"),A=n(/*! ../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),M=n(/*! ./GuiViewerToolbarConst */"./src/gui/GuiViewerToolbarConst.js"),S=(n(/*! ../tools/KeyCode */"./src/tools/KeyCode.js"),n(/*! ../application/PreferenceNames */"./src/application/PreferenceNames.js"));function T(e,t){t||(t={}),t.startOnInitialize=!1,r.Viewer3D.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.onFullScreenModeEvent=this.onFullScreenModeEvent.bind(this),this.onProgressBarUpdate=this.onProgressBarUpdate.bind(this)}T.prototype=Object.create(r.Viewer3D.prototype),T.prototype.constructor=T,T.prototype.initialize=function(){var e=r.Viewer3D.prototype.initialize.call(this);if(e>0)return f.ErrorHandler.reportError(this.container,e),e;var t=this;if(this.toolController){var n=new i.HotGestureTool(this);this.toolController.registerTool(n),this.toolController.activateTool(n.getName())}return this.addEventListener(o.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new p.ProgressBar(this.container),this.addEventListener(o.PROGRESS_UPDATE_EVENT,this.onProgressBarUpdate),this.addEventListener(o.VIEWER_RESIZE_EVENT,(function(e){t.resizePanels(),t.updateToolbarButtons(e.width,e.height)})),this.addEventListener(o.NAVIGATION_MODE_CHANGED_EVENT,(function(e){t.updateToolbarButtons(t.container.clientWidth,t.container.clientHeight)})),this.initEscapeHandlers(),this.localize(),this.addEventListener(o.WEBGL_CONTEXT_LOST_EVENT,function(e){this.impl.stop();for(var t=this.container,n=t.childElementCount,r=0;r<n;++r)t.children[r].style.display="none";f.ErrorHandler.reportError(this.container,A.ErrorCodes.WEBGL_LOST_CONTEXT)}.bind(this)),this.run(),0},T.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),this.removeEventListener(o.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.removeEventListener(o.PROGRESS_UPDATE_EVENT,this.onProgressBarUpdate),this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.toolbar=null,r.Viewer3D.prototype.uninitialize.call(this)},T.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,r.Viewer3D.prototype.setUp.call(this,e)},T.prototype.tearDown=function(){r.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.debugMenu=null,this.removeEventListener(o.GEOMETRY_LOADED_EVENT,this.checkGeometry),this.checkGeometry=null},T.prototype.onPostExtensionLoad=function(e){var t=this.getToolbar();t&&e.onToolbarCreated&&e.onToolbarCreated(t)},T.prototype.loadModel=function(e,t,n,i,o){var s=this;return r.Viewer3D.prototype.loadModel.call(this,e,t,(function(e){setTimeout((function(){t&&(t.loadAsHidden||t.headlessViewer)||function(e){s.running?s.createUI(e):m.logger.error("createUI expects the viewer to be running.",Object(A.errorCodeString)(A.ErrorCodes.VIEWER_INTERNAL_ERROR))}(e),n&&n.call(n,e)}),1)}),(function(e){f.ErrorHandler.reportError(s.container,e),i&&i.apply(i,arguments)}),o)},T.prototype.createUI=function(e){var t=this;if(this.model===e){var n=this,r=this._createToolbar();this.checkGeometry=function(){setTimeout((function(){if(!n.impl.is2d&&n.model&&!n.model.hasGeometry()){var e=A.ErrorCodes.BAD_DATA_MODEL_IS_EMPTY;f.ErrorHandler.reportError(n.container,e,"Model is empty"),n._loadingSpinner.hide()}}),1)};var i=this.config.disabledExtensions||{},a=function(e){return-1===(t.profile&&t.profile.extensions.unload?t.profile.extensions.unload:[]).indexOf(e)};this.initModelTools(e),Object(s.getGlobal)().ENABLE_DEBUG&&this.initDebugTools(),"true"===Object(g.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Bimfish.Debug",this.config);var l=function(e){n.getExtension(e)&&n.unloadExtension(e)};e.is2d()&&(l("Bimfish.BimWalk"),l("Bimfish.Section"),l("Bimfish.Viewing.FusionOrbit")),i.measure||l("Bimfish.Measure"),this.dispatchEvent({type:M.TOOLBAR_CREATED_EVENT}),r&&this.forEachExtension((function(e){e.onToolbarCreated&&e.onToolbarCreated(t.toolbar)}));var c=this.getExtension("Bimfish.DefaultTools.NavTools");c?c.updateUI(e.is3d()):this.loadExtension("Bimfish.DefaultTools.NavTools",n.config),this.initModality(),this.resize(),e.is2d()?(this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),setTimeout((function(){var e={viewcube:"Bimfish.ViewCubeUi",measure:"Bimfish.Measure",hyperlink:"Bimfish.Hyperlink",layerManager:"Bimfish.LayerManager",propertiesPanel:"Bimfish.PropertiesManager"};for(var t in e){var r=e[t];!i[t]&&a(r)&&n.loadExtension(r,n.config)}}),1)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout((function(){var e={viewcube:"Bimfish.ViewCubeUi",explode:"Bimfish.Explode",bimwalk:"Bimfish.BimWalk",fusionOrbit:"Bimfish.Viewing.FusionOrbit",measure:"Bimfish.Measure",section:"Bimfish.Section",layerManager:"Bimfish.LayerManager",modelBrowser:"Bimfish.ModelStructure",propertiesPanel:"Bimfish.PropertiesManager"};for(var t in e){var r=e[t];!i[t]&&a(r)&&n.loadExtension(r,n.config)}!i.scalarisSimulation&&a("Bimfish.Viewing.ScalarisSimulation")&&n.model&&n.model.isScalaris&&n.loadExtension("Bimfish.Viewing.ScalarisSimulation",n.config)}),1),e.isLoadDone()?this.checkGeometry():this.addEventListener(o.GEOMETRY_LOADED_EVENT,this.checkGeometry,{once:!0}))}},T.prototype.onFullScreenModeEvent=function(e){this.resizePanels(),this.updateFullscreenButton(e.mode)},T.prototype.onProgressBarUpdate=function(e){e.percent>=0&&this.progressbar.setPercent(e.percent)},T.prototype.addOptionToggle=function(e,t,n,r,i){var o=i?this.prefs[i]:null;n="boolean"==typeof o?o:n;var a=this.getDocument(),c=a.createElement("li");c.className="toolbar-submenu-listitem";var u=a.createElement("input");u.className="toolbar-submenu-checkbox",u.type="checkbox",u.id=t,c.appendChild(u);var d=a.createElement("label");return d.setAttribute("for",t),d.setAttribute("data-i18n",t),d.textContent=l.i18n.translate(t),c.appendChild(d),e.appendChild(c),u.checked=n,u.addEventListener("touchstart",s.touchStartToClick),d.addEventListener("touchstart",s.touchStartToClick),c.addEventListener("touchstart",s.touchStartToClick),u.addEventListener("click",(function(e){r(u.checked),e.stopPropagation()})),d.addEventListener("click",(function(e){e.stopPropagation()})),c.addEventListener("click",(function(e){r(!u.checked),e.stopPropagation()})),i&&this.prefs.addListeners(i,(function(e){u.checked=e}),(function(e){u.checked=e,r(e)})),u},T.prototype.addOptionList=function(e,t,n,r,i,o){var s=this.prefs[o];r="number"==typeof s?s:r;var a=this.getDocument(),c=a.createElement("select");c.className="option-drop-down",c.id="selectMenu_"+t;for(var u=0;u<n.length;u++){var d=a.createElement("option");d.value=u,d.setAttribute("data-i18n",n[u]),d.textContent=l.i18n.translate(n[u]),c.add(d)}var h=a.createElement("li");h.className="toolbar-submenu-select";var f=a.createElement("div");return f.className="toolbar-submenu-selectlabel",f.setAttribute("for",t),f.setAttribute("data-i18n",t),f.textContent=l.i18n.translate(t),h.appendChild(f),h.appendChild(c),e.appendChild(h),c.selectedIndex=r,c.onchange=function(e){var t=e.target.selectedIndex;i(t),e.stopPropagation()},c.addEventListener("touchstart",(function(e){e.stopPropagation()})),c.addEventListener("click",(function(e){e.stopPropagation()})),o&&this.prefs.addListeners(o,(function(e){c.selectedIndex=e}),(function(e){c.selectedIndex=e,i(e)})),c},T.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0);e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},T.prototype.showRenderingOptions=function(e){e&&this._createRenderingOptionsPanel(),this.renderoptions&&this.renderoptions.setVisible(e)},T.prototype._createRenderingOptionsPanel=function(){var e=this;if(!this.renderoptions&&!this.model.is2d()&&(this.renderoptions=new v.RenderOptionsPanel(this),this.addPanel(this.renderoptions),this.settingsTools&&!this.renderOptionsButton)){var t=new c.Button("toolbar-renderOptionsTool");t.setToolTip("Rendering options"),t.setIcon("adsk-icon-settings-render"),t.onClick=function(t){var n=e.renderoptions&&e.renderoptions.isVisible();e.renderoptions.setVisible(!n)},this.settingsTools.addControl(t)}},T.prototype.showLayerManager=function(e){m.logger.warn('viewer.showLayerManager() is now handled the extension "Bimfish.LayerManager" and will be removed in version 8.0.0.')},T.prototype.initHotkeys=function(){m.logger.warn("viewer.initHotkeys() has been deprecated and will be removed in version 8.0.0.")},T.prototype.setModelStructurePanel=function(e){m.logger.warn('viewer.setModelStructurePanel() is deprecated and will be removed in v8.0.0 - Use extension "Bimfish.ModelStructure".');var t=this.getExtension("Bimfish.ModelStructure");return!!t&&t.setModelStructurePanel(e)},T.prototype.setLayersPanel=function(e){m.logger.warn('viewer.setLayersPanel() is now handled the extension "Bimfish.LayerManager" and will be removed in version 8.0.0.')},T.prototype.setPropertyPanel=function(e){m.logger.warn('viewer.setPropertyPanel() is now handled by extension "Bimfish.PropertiesManager" and will be removed in version 8.0.0.');var t=this.getExtension("Bimfish.PropertiesManager");return!!t&&t.setPanel(e)},T.prototype.getPropertyPanel=function(e){m.logger.warn('viewer.getPropertyPanel() is now handled the extension "Bimfish.PropertiesManager" and will be removed in version 8.0.0.');var t=this.getExtension("Bimfish.PropertiesManager");return!t&&e&&(this.loadExtension("Bimfish.PropertiesManager"),t=this.getExtension("Bimfish.PropertiesManager")),t?t.getPanel():null},T.prototype.setSettingsPanel=function(e){var t=this;return(e instanceof w.SettingsPanel||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener((function(n){n&&t.onPanelVisible(e,t),t.viewerOptionButton.setState(n?c.Button.State.ACTIVE:c.Button.State.INACTIVE)}))),!0)},T.prototype.getSettingsPanel=function(e,t){return!this.viewerSettingsPanel&&e&&this.createSettingsPanel(t||this.model),this.viewerSettingsPanel},T.prototype.createSettingsPanel=function(e){var t=new E.ViewerSettingsPanel(this,e);this.setSettingsPanel(t),t.syncUI();var n=new c.Button("toolbar-settingsTool");this.viewerOptionButton=n,n.setIcon("adsk-icon-settings"),n.setToolTip("Settings"),this.settingsTools.addControl(n),this.createViewerOptionsMenu(e)},T.prototype.initModelTools=function(e){var t=this;if(this.createSettingsPanel(e),Object(s.getGlobal)().ENABLE_DEBUG&&this._createRenderingOptionsPanel(),this.canChangeScreenMode()&&!this.settingsTools.fullscreenbutton){var n=new c.Button("toolbar-fullscreenTool",{collapsible:!1});n.setToolTip("Full screen"),n.setIcon("adsk-icon-fullscreen"),n.onClick=function(e){t.nextScreenMode()},this.settingsTools.addControl(n),this.settingsTools.fullscreenbutton=n,this.updateFullscreenButton(this.getScreenMode())}},T.prototype.setPropertiesOnSelect=function(e){m.logger.warn('viewer.setPropertiesOnSelect() is now handled by viewer.prefs.set("openPropertiesOnSelect", <boolean>) and will be removed in version 8.0.0.'),this.prefs.set(S.Prefs.OPEN_PROPERTIES_ON_SELECT,e)},T.prototype.addDivider=function(e){var t=this.getDocument().createElement("li");return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},T.prototype.createViewerOptionsMenu=function(e){var t=this;this.viewerOptionButton.onClick=function(){t.getSettingsPanel(!0).isVisible()?t.showViewer3dOptions(!1):t.showViewer3dOptions(!0)}},T.prototype.initDebugTools=function(){if(this.debugMenu)return!1;var e=new u.ControlGroup("debugTools");this.debugMenu=e;var t=new c.Button("toolbar-debugTool");return t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e),!0},T.prototype.removeDebugTools=function(){this.debugMenu&&(this.debugMenu.removeFromParent(),this.debugMenu=null)},T.prototype.createDebugSubmenu=function(e){var t=this,n=this.getDocument().createElement("div");n.id="toolbar-debugToolSubmenu",n.classList.add("toolbar-submenu"),n.classList.add("toolbar-settings-sub-menu"),n.classList.add("adsk-hidden"),this.debugMenu.subMenu=n,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(n),this.initModelStats(),this.addDivider(n),this.addDivider(n);var r=y.Lang.getLanguages(),i=r.map((function(e){return e.label})),o=r.map((function(e){return e.symbol}));function a(){t.localize()}var l=t.selectedLanguage?t.selectedLanguage:0;this.addOptionList(n,"Language",i,l,(function(e){var n=o[e];t.selectedLanguage=e,Object(_.setLanguage)(n,a)}),null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);this.addOptionList(n,"Error",["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"],0,(function(e){var n=e+1;f.ErrorHandler.reportError(t.container,n,"")}),null).parentNode.style.paddingBottom="15px";var c=n.getBoundingClientRect();this.debugMenu.subMenu.style.width=c.width+"px",this.container.removeChild(n),e.container.appendChild(n);var u=c.left+c.width,d=this.container.getBoundingClientRect().right;if(u>d){var h=-(u-d+10)+"px";this.debugMenu.subMenu.style.left=h}e.onMouseOver=function(e){n.classList.remove("adsk-hidden")},e.onMouseOut=function(e){n.classList.add("adsk-hidden")},Object(s.isTouchDevice)()&&(e.onClick=function(e){n.classList.toggle("adsk-hidden")})},T.prototype.initModelStats=function(){var e=this;function t(t){var n=e.impl,r="";e.model&&(r+="Geom&nbsp;polys:&nbsp;"+n.modelQueue().getGeometryList().geomPolyCount+"<br>",r+="Instance&nbsp;polys:&nbsp;"+n.modelQueue().getGeometryList().instancePolyCount+"<br>",r+="Fragments:&nbsp;"+n.modelQueue().getFragmentList().getCount()+"<br>",r+="Geoms:&nbsp;"+n.modelQueue().getGeometryList().geoms.length+"<br>",r+="Loading&nbsp;time:&nbsp;"+(n.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),r+="# "+(t||""),e.modelStats.innerHTML=r}this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,(function(n){n&&!e.modelStats&&(!function(){var n=e.getDocument();e.modelStats=n.createElement("div"),e.modelStats.className="statspanel",e.container.appendChild(e.modelStats),e.addEventListener(o.PROGRESS_UPDATE_EVENT,(function(e){e.message&&t(e.message)})),e.fpsDisplay=n.createElement("div"),e.fpsDisplay.className="fps",e.container.appendChild(e.fpsDisplay)}(),t("")),e.modelStats.style.visibility=n?"visible":"hidden",e.fpsDisplay.style.visibility=n?"visible":"hidden",e.impl.fpsCallback=n?function(t){e.fpsDisplay.textContent=""+(0|t)}:null}))},T.prototype.initEscapeHandlers=function(){var e=this;this.addEventListener(o.ESCAPE_EVENT,(function(t){if(!e.contextMenu||!e.contextMenu.hide())if(e.renderoptions&&e.renderoptions.isVisible())e.renderoptions.setVisible(!1);else{if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void b.HudMessage.dismiss();if(e.impl.selector.hasSelection())e.clearSelection();else if(e.areAllVisible()){if(!x.AlertBox.dismiss()){for(var n=0;n<e.dockingPanels.length;++n){var r=e.dockingPanels[n];if("none"!==r.container.style.display&&""!==r.container.style.display)return void r.setVisible(!1)}e.escapeScreenMode()}}else e.showAll()}}))},T.prototype.getToolbar=function(){return this.toolbar},T.prototype._createToolbar=function(){return!this.toolbar&&(this.toolbar=new d.ToolBar("guiviewer3d-toolbar"),this.toolbar.setGlobalManager(this.globalManager),this.navTools=new h.RadioButtonGroup(M.TOOLBAR.NAVTOOLSID),this.modelTools=new u.ControlGroup(M.TOOLBAR.MODELTOOLSID),this.settingsTools=new u.ControlGroup(M.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container),!0)},T.prototype.showModelStructurePanel=function(e){m.logger.warn('viewer.showModelStructurePanel() is deprecated and will be removed in v8.0.0 - Use extension "Bimfish.ModelStructure".'),e?this.activateExtension("Bimfish.ModelStructure"):this.deactivateExtension("Bimfish.ModelStructure")},T.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},T.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen";switch(e){case a.ScreenMode.kNormal:this.isScreenModeSupported(a.ScreenMode.kFullBrowser)||(t="adsk-icon-fullscreen");break;case a.ScreenMode.kFullBrowser:t=this.isScreenModeSupported(a.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case a.ScreenMode.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},T.prototype.localize=function(){r.Viewer3D.prototype.localize.call(this),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),f.ErrorHandler.localize()},T.prototype.addPanel=function(e){return-1===this.dockingPanels.indexOf(e)&&(this.dockingPanels.push(e),!0)},T.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e);return t>-1&&(this.dockingPanels.splice(t,1),!0)},T.prototype.resizePanels=function(e){e=e||{};var t=this.toolbar?this.toolbar.getDimensions().height:0,n=this.getDimensions(),r=n.height;e.dimensions&&e.dimensions.height?r=e.dimensions.height:e.dimensions={height:n.height,width:n.width},e.dimensions.height=r-t;var i=e?e.dockingPanels:null;i||(i=this.dockingPanels);var o,s,a=this.container.getBoundingClientRect(),l=a.top,c=a.bottom,u=a.left,d=a.right;e&&e.dimensions?(o=e.dimensions.width,s=e.dimensions.height,c=e.dimensions.height):(o=a.width,s=a.height);for(var h=0;h<i.length;++h)i[h].onViewerResize(l,c,u,d,o,s)},T.prototype.initExplodeSlider=function(){m.logger.warn('viewer.initExplodeSlider() has been replaced by extension "Bimfish.Explode". initExplodeSlier() will be removed in version 7.0.0.')},T.prototype.initInspectTools=function(){var e=new c.Button("toolbar-inspectTools");e.setToolTip("Inspect"),e.setIcon("measure"),e.setVisible(!1),this.modelTools.addControl(e);var t=new h.RadioButtonGroup("toolbar-inspectSubMenu");t.addClass("toolbar-vertical-group"),t.setVisible(!1),this.modelTools.addControl(t),e.container.insertBefore(t.container,e.container.firstChild),e.onMouseOver=function(){t.setVisible(!0)},e.onMouseOut=function(){t.setVisible(!1)},Object(s.isTouchDevice)()&&(e.onClick=function(e){t.setVisible(!t.isVisible())})},T.prototype.initModality=function(){function e(e){return e.id.substring(8,e.id.length)}function t(e){var t=e.ownerDocument.createEvent("Event");t.initEvent("click",!0,!0),e.dispatchEvent(t)}var n={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{measureTool:0,calibrateTool:0},explodeTool:{measureTool:0,calibrateTool:0,firstPersonTool:1,bimWalkTool:1},measureTool:{sectionTool:0},firstPersonTool:{explodeTool:1},bimWalkTool:{explodeTool:1,sectionTool:1}},r={};function i(e,t,n){r[e]=n?t:void 0}this.toolbar.container.addEventListener("click",(function(o){var s=(o.target.getAttribute("class")||"").split(/\s+/);if(-1===s.indexOf("clickoff")){var a=function e(t){for(var n=0;n<2&&t.parentElement;){var r=t.id;if(0===r.indexOf("toolbar-")){if(r.indexOf("arrow")===r.length-5)return;return e(t.parentElement)||t}t=t.parentElement,n++}}(o.target);if(a){var l=e(a);if(n[l]&&("sectionTool"!==l||-1===s.indexOf("adsk-icon-section-analysis")&&!o.target.querySelector(".adsk-icon-section-analysis"))&&("measureTool"!==l||-1===s.indexOf("adsk-icon-measure-menu")&&!o.target.querySelector(".adsk-icon-measure-menu"))){for(var c in r[l]&&i(l,a,!1),r){var u=r[c];if(u){var d=e(u);u.classList.contains("active")?n[l][d]||t(u):i(d,u,!1)}}i(l,a,!0)}}}}),!0)},T.prototype.updateToolbarButtons=function(e,t){if(this.getToolbar()){var n,r;r=e>310?"block":"none",(n=this.modelTools.getControl("toolbar-explodeTool"))&&n.setDisplay(r),r=e>380?"block":"none",(n=this.modelTools.getControl("toolbar-collaborateTool"))&&n.setDisplay(r),r=e>515?"block":"none";var i=this.navTools.getControl("toolbar-cameraSubmenuTool");i&&(i.setDisplay(r),(n=i.subMenu.getControl("toolbar-homeTool"))&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(n=i.subMenu.getControl("toolbar-fitToViewTool"))&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(n=i.subMenu.getControl("toolbar-focalLengthTool"))&&n.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(n=i.subMenu.getControl("toolbar-rollTool"))&&n.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),r=e>700?"block":"none",(n=this.modelTools.getControl("toolbar-measureTool"))&&n.setDisplay(r),(n=this.modelTools.getControl("toolbar-sectionTool"))&&n.setDisplay(r),r=e>740?"block":"none",(n=this.navTools.getControl("toolbar-beelineTool"))&&n.setDisplay(this.navigation.isActionEnabled("walk")?r:"none"),(n=this.navTools.getControl("toolbar-firstPersonTool"))&&n.setDisplay(this.navigation.isActionEnabled("walk")?r:"none"),(n=this.navTools.getControl("toolbar-zoomTool"))&&n.setDisplay(this.navigation.isActionEnabled("zoom")?r:"none"),(n=this.navTools.getControl("toolbar-panTool"))&&n.setDisplay(this.navigation.isActionEnabled("pan")?r:"none"),(n=this.navTools.getControl("toolbar-orbitTools"))&&n.setDisplay(this.navigation.isActionEnabled("orbit")?r:"none")}},Bimfish.Viewing.Private.GuiViewer3D=T},"./src/gui/GuiViewerToolbarConst.js":
/*!******************************************!*\
  !*** ./src/gui/GuiViewerToolbarConst.js ***!
  \******************************************/
/*! exports provided: TOOLBAR_CREATED_EVENT, VIEW_CUBE_CREATED_EVENT, TOOLBAR */function(e,t,n){"use strict";n.r(t),n.d(t,"TOOLBAR_CREATED_EVENT",(function(){return r})),n.d(t,"VIEW_CUBE_CREATED_EVENT",(function(){return i})),n.d(t,"TOOLBAR",(function(){return o}));var r="toolbarCreated",i="viewCubeCreated",o={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools",MEASURETOOLSID:"measureTools"}},"./src/gui/HudMessage.css":
/*!********************************!*\
  !*** ./src/gui/HudMessage.css ***!
  \********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/HudMessage.js":
/*!*******************************!*\
  !*** ./src/gui/HudMessage.js ***!
  \*******************************/
/*! exports provided: HudMessage */function(e,t,n){"use strict";n.r(t),n.d(t,"HudMessage",(function(){return i}));var r=n(/*! ../globalization/i18next */"./src/globalization/i18next.js");function i(){}i.instances=[],i.displayMessage=function(e,t,n,o,s){var a=e.ownerDocument,l=a.defaultView||a.parentWindow;function c(e){var t=l.getComputedStyle(e),n=parseInt(t["margin-top"]),r=parseInt(t["margin-bottom"]);return e.getBoundingClientRect().height+n+r}function u(e,t,n){var r=l.getComputedStyle(e,null);if(!Array.isArray(t))return r[t];for(var i=n||{},o=0;o<t.length;o++){var s=t[o];i[s]=r[s]}return i}if(!(i.instances.length>0)){var d=t.msgTitleKey,h=t.msgTitleDefaultValue||d,f=t.messageKey,p=t.messageDefaultValue||f,m=t.buttonText,g=t.checkboxChecked||!1,v=a.createElement("div");v.classList.add("docking-panel"),v.classList.add("hud"),e.appendChild(v);var y,_=a.createElement("div");_.classList.add("docking-panel-title"),_.classList.add("docking-panel-delimiter-shadow"),_.textContent=r.i18n.translate(d,{defaultValue:h}),_.setAttribute("data-i18n",d),v.appendChild(_),n&&((y=a.createElement("div")).classList.add("docking-panel-close"),y.addEventListener("click",(function(e){i.dismiss(),n&&n(e)})),v.appendChild(y));var b=u(_,["width","font-size"]),x=function(e){var t=e.textContent,n=a.createElement("span");u(e,["font-size","font-weight","text-transform","padding","white-space","font-family"],n.style),n.textContent=t,n.style.position="absolute",n.style.top="10000px",n.style.left="-10000px",a.body.appendChild(n);var r=n.offsetWidth;return a.body.removeChild(n),r}(_),w=parseFloat(b["font-size"]),E=y?parseFloat(u(y,"width")):0,A=parseFloat(b.width)-E;_.style["font-size"]="".concat(x>A?A/x*w:w,"px");var M=a.createElement("div");M.classList.add("hud-client"),M.classList.add("docking-panel-container-solid-color-b"),v.appendChild(M);var S=a.createElement("div");S.className="hud-message",S.textContent=r.i18n.translate(f,{defaultValue:p}),S.setAttribute("data-i18n",p),M.appendChild(S);var T=c(S);if(o){var C=a.createElement("div");C.classList.add("docking-panel-primary-button"),C.classList.add("hud-button"),C.textContent=r.i18n.translate(m,{defaultValue:m}),C.setAttribute("data-i18n",m),C.addEventListener("click",o),M.appendChild(C),T+=c(C)}if(s){var P=a.createElement("div"),L=a.createElement("input");L.className="hud-checkbox",L.type="checkbox",L.checked=g,P.appendChild(L);var D="Do not show this message again",R=a.createElement("label");R.setAttribute("for",D),R.setAttribute("data-i18n",D),R.textContent=r.i18n.translate(D,{defaultValue:D}),P.appendChild(R),L.addEventListener("change",s),M.appendChild(P),T+=c(s)}M.style.height=T+"px",v.style.height=T+c(_)+"px";var I={hudMessage:v,container:e};i.instances.push(I)}},i.dismiss=function(){if(i.instances.length>0){var e=i.instances.pop();return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1}},"./src/gui/LightPresetThumbnails.js":
/*!******************************************!*\
  !*** ./src/gui/LightPresetThumbnails.js ***!
  \******************************************/
/*! exports provided: LightPresetThumbnails */function(e,t,n){"use strict";n.r(t),n.d(t,"LightPresetThumbnails",(function(){return o}));var r=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._width=t||60,this._height=n||60}var t,n,r;return t=e,(n=[{key:"createThumbnail",value:function(e,t){var n=this;return new Promise((function(t){var r=n.getDocument().createElement("canvas");r.width=n._width,r.height=n._height;var i=r.getContext("2d"),o=i.createLinearGradient(0,0,0,r.height),a=e.bgColorGradient,l=s(a[0],a[1],a[2]),c=s(a[3],a[4],a[5]);o.addColorStop(0,l),o.addColorStop(1,c),i.fillStyle=o,i.fillRect(0,0,r.width,r.height),r.toBlob((function(e){var n=URL.createObjectURL(e);t(n)}))}))}}])&&i(t.prototype,n),r&&i(t,r),e}();function s(e,t,n){return e=parseInt(e),t=parseInt(t),n=parseInt(n),"#"+a(e)+a(t)+a(n)}function a(e){if(0===e)return"00";for(var t="",n=e>255?255:e;0!==n;){var r=n%16;n=n/16|0,t=l[r.toString()]+t}return t.length>1?t:"0"+t}r.GlobalManagerMixin.call(o.prototype);var l={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"}},"./src/gui/LoadingSpinner.css":
/*!************************************!*\
  !*** ./src/gui/LoadingSpinner.css ***!
  \************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/LoadingSpinner.js":
/*!***********************************!*\
  !*** ./src/gui/LoadingSpinner.js ***!
  \***********************************/
/*! exports provided: LoadingSpinner */function(e,t,n){"use strict";n.r(t),n.d(t,"LoadingSpinner",(function(){return i}));var r=n(/*! ../globalization/i18next */"./src/globalization/i18next.js");function i(e){this.parentDiv=e;var t=this.getDocument();this.container=t.createElement("div"),this.container.innerHTML=['<div class="path">','<svg width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<path d="M2.5,50a47.5,47.5 0 1,0 95,0a47.5,47.5 0 1,0 -95,0" vector-effect="non-scaling-stroke"/>','<path d="M 2.5 50 A 47.5 47.5 0 0 1 47.5 2.5" vector-effect="non-scaling-stroke"/>',"</svg>","</div>",'<div class="message" data-i18n="Spinner Loading">LOADING</div>'].join(""),this.container.className="loading-spinner"}n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(i.prototype),i.prototype.addClass=function(e){this.container.classList.add(e)},i.prototype.attachToDom=function(){return!this.container.parentNode&&(r.i18n.localize(this.container),this.parentDiv.appendChild(this.container),!0)},i.prototype.removeFromDom=function(){return!!this.container.parentNode&&(this.container.parentNode.removeChild(this.container),!0)},i.prototype.setVisible=function(e){e?this.attachToDom():this.removeFromDom()}},"./src/gui/ModelStructurePanel.css":
/*!*****************************************!*\
  !*** ./src/gui/ModelStructurePanel.css ***!
  \*****************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ModelStructurePanel.js":
/*!****************************************!*\
  !*** ./src/gui/ModelStructurePanel.js ***!
  \****************************************/
/*! exports provided: ModelStructurePanel */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelStructurePanel",(function(){return s}));var r=n(/*! ./DockingPanel */"./src/gui/DockingPanel.js"),i=n(/*! ./TreeOnDemand */"./src/gui/TreeOnDemand.js"),o=n(/*! ./ModelStructureTreeDelegate */"./src/gui/ModelStructureTreeDelegate.js");function s(e,t,n,i){r.DockingPanel.call(this,e,t,n,i),this.container.classList.add("model-structure-panel"),(i=i||{}).heightAdjustment||(i.heightAdjustment=40),i.marginTop||(i.marginTop=0),i.left=!0,this.createScrollContainer(i),this.onScroll=this.onScroll.bind(this),this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.style["overflow-x"]="hidden",this.options=i,this.tree=null,this._pendingModels=[],this.uiCreated=!1;var o=this;this.addVisibilityListener((function(e){e&&(o.uiCreated||o.createUI(),o.resizeToContent())}))}s.prototype=Object.create(r.DockingPanel.prototype),s.prototype.constructor=s,s.prototype.uninitialize=function(e){this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.parentNode.removeChild(this.scrollContainer),r.DockingPanel.prototype.uninitialize.call(this)},s.prototype.addModel=function(e){if(e)if(this.uiCreated)this.createTreeUI(e);else{if(-1!==this._pendingModels.indexOf(e))return;this._pendingModels.push(e)}},s.prototype.unloadModel=function(e){if(e)if(this.uiCreated)this.removeTreeUI(e);else{var t=this._pendingModels.indexOf(e);if(-1===t)return;this._pendingModels.splice(t,1)}},s.prototype.createUI=function(){if(!this.uiCreated){var e,t="";if(this.options&&this.options.defaultTitle?(t=this.options.defaultTitle,e=void 0===this.options.localizeTitle||!!this.options.localizeTitle):(t=this.modelTitle,e=!1),t||(t="Browser",e=!0),this.setTitle(t,{localizeTitle:e}),this.uiCreated=!0,this.tree=new i.TreeOnDemand(this.scrollContainer,this.options),this.tree.setGlobalManager(this.globalManager),0!==this._pendingModels.length){for(var n=0;n<this._pendingModels.length;++n)this.createTreeUI(this._pendingModels[n]);this._pendingModels=[]}}},s.prototype.createTreeUI=function(e){if(this.tree.getDelegate(e.id))return!1;var t=new o.ModelStructureTreeDelegate(this,e);t.setGlobalManager(this.globalManager),this.tree.pushDelegate(t);var n=this;return e.getObjectTree((function(e){n.setInstanceTree(t,e)}),(function(){n.setInstanceTree(t,null)})),!0},s.prototype.setInstanceTree=function(e,t){this.tree.setInstanceTree(e,t)},s.prototype.removeTreeUI=function(e){this.tree.removeDelegate(e.id)&&(this.scrollContainer.scrollTop=0,this.onScroll())},s.prototype.onScroll=function(e){this.tree.setScroll(this.scrollContainer.scrollTop)},s.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},s.prototype.onTreeNodeClick=function(e,t,n,r){throw new Error("Method must be overriden.")},s.prototype.onTreeNodeRightClick=function(e,t,n,r){throw new Error("Method must be overriden.")},s.prototype.onTitleClick=function(e){},s.prototype.onTitleDoubleClick=function(e){}},"./src/gui/ModelStructureTreeDelegate.css":
/*!************************************************!*\
  !*** ./src/gui/ModelStructureTreeDelegate.css ***!
  \************************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ModelStructureTreeDelegate.js":
/*!***********************************************!*\
  !*** ./src/gui/ModelStructureTreeDelegate.js ***!
  \***********************************************/
/*! exports provided: ModelStructureTreeDelegate */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelStructureTreeDelegate",(function(){return l}));var r=n(/*! ./TreeDelegate */"./src/gui/TreeDelegate.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../globals */"./src/globals.js"),s=n(/*! ../globalization/i18next */"./src/globalization/i18next.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){r.TreeDelegate.call(this),this.panel=e,this.model=t;var n=this.getDocument();this.modelDiv=n.createElement("div"),this.modelDiv.classList.add("model-div"),this.modelDiv.setAttribute("lmv-modelId",t.id),this.instanceTree=null,this.rootId=-1,this.state=1}function c(e){var t=e.getData();if(!t)return"";var n=t.urn;try{n=atob(t.urn)}catch(e){}var r=n.lastIndexOf("/");return-1===r||-1!==(r=(n=n.substr(r+1)).indexOf("?"))&&(n=n.substr(0,r)),n}function u(e){var t=e.getData();return t&&t.loadOptions&&t.loadOptions.modelNameOverride?t.loadOptions.modelNameOverride:""}l.prototype=Object.create(r.TreeDelegate.prototype),l.prototype.constructor=l,l.prototype.isLoading=function(){return 1===this.state},l.prototype.isAvailable=function(){return 2===this.state},l.prototype.isNotAvailable=function(){return 3===this.state},l.prototype.isControlId=function(e){return-1===e||-2===e},l.prototype.getControlIdCss=function(e){return null},l.prototype.getRootId=function(){return this.rootId},l.prototype.getTreeNodeId=function(e){return"object"==a(e)?(i.logger.warn("Object used instead of dbId. Fix it."),e.dbId):e},l.prototype.getTreeNodeIndex=function(e){return this.instanceTree.nodeAccess.dbIdToIndex[e]},l.prototype.getTreeNodeLabel=function(e){var t;if(-1===e)return(t=u(this.model))||(t=c(this.model)),s.i18n.translate("Loading model",{name:t});if(-2===e)return(t=u(this.model))||(t=c(this.model)),t;if(e===this.getRootId()&&(t=u(this.model)))return t;return-1e10==e?"Object 0":this.instanceTree.getNodeName(e,!0)||"Object "+e},l.prototype.getTreeNodeClass=function(e){return-1===e||-2===e?"message-unexpected":""},l.prototype.getTreeNodeParentId=function(e){if(-1e10===e)return 0;var t=this.instanceTree.nodeAccess.getParentId(e);return 0===t?-1e10:t},l.prototype.getTreeNodeCount=function(){return this.instanceTree.nodeAccess.getNumNodes()},l.prototype.getTreeNodeClientHeight=function(e){return 36},l.prototype.getTreeNodeDepthOffset=function(e,t){return 13+25*t},l.prototype.isTreeNodeGroup=function(e){return!this.isControlId(e)&&this.instanceTree.getChildCount(e)>0},l.prototype.shouldCreateTreeNode=function(e){return!0},l.prototype.createTreeNode=function(e,t){var n=this,i=n.getDocument();if(t.addEventListener("mousedown",(function(){var e=function(){this.classList.remove("highlight"),n.removeDocumentEventListener("mouseup",e)}.bind(t);t.classList.add("highlight"),n.addDocumentEventListener("mouseup",e)})),!this.isControlId(e)){var s=i.createElement("div");s.dbId=e,s.classList.add("visibility"),s.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation()})),s.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(e.target.dbId);this.panel.onEyeIcon(t,this.model)}.bind(this)),t.appendChild(s)}if(-1===e){var a=i.createElement("img");a.src=Object(o.getResourceUrl)("res/ui/spinner.png"),a.style.animation="loading-spinner-perpetual-motion 1s infinite linear",a.style.float="right",a.style.marginRight="5px",a.style.width="20px",t.appendChild(a)}var l={localize:-1===e||-2===e};r.TreeDelegate.prototype.createTreeNode.call(this,e,t,l)},l.prototype.onTreeNodeRightClick=function(e,t,n){this.isControlId(t)||this.panel.onTreeNodeRightClick(e,t,this.model,n)},l.prototype.onTreeNodeClick=function(e,t,n){this.isControlId(t)||this.panel.onTreeNodeClick(e,t,this.model,n)},l.prototype.onTreeNodeDoubleClick=function(e,t,n){},l.prototype.onTreeNodeIconClick=function(e,t,n){if(this.isTreeNodeGroup(t)){var r=e.isCollapsed(this,t);e.setCollapsed(this,t,!r)}},l.prototype.onTreeNodeReized=function(e){},l.prototype.forEachChild=function(e,t,n){this.isControlId(e)||this.instanceTree.enumNodeChildren(e,t,n)},l.prototype.setInstanceTree=function(e){this.instanceTree=e,this.state=e?2:3,this.rootId=e?e.getRootId():-2,function(e){var t=e.instanceTree;if(!t)return;var n,r=e.rootId,i=t.getNodeName(r),o=0,s=0;t.enumNodeChildren(r,(function(e){s||(n=t.getNodeName(e),o=e),s++})),e.hasDoubleRoot=1===s&&i===n,e.rootId=e.hasDoubleRoot?o:r}(this)},l.prototype.clean=function(){for(var e,t=this.modelDiv;e=t.lastChild;)t.removeChild(e)}},"./src/gui/ObjectContextMenu.js":
/*!**************************************!*\
  !*** ./src/gui/ObjectContextMenu.js ***!
  \**************************************/
/*! exports provided: ObjectContextMenu */function(e,t,n){"use strict";n.r(t),n.d(t,"ObjectContextMenu",(function(){return o}));var r=n(/*! ./ContextMenu */"./src/gui/ContextMenu.js"),i=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function o(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.contextMenu=new r.ContextMenu(e)}o.prototype.constructor=o,i.GlobalManagerMixin.call(o.prototype),o.prototype.show=function(e){var t=this.viewer.getSelectionCount(),n=this.viewer.getSelectionVisibility(),r=this.viewer.impl.getCanvasBoundingClientRect(),i={event:e,numSelected:t,hasSelected:0<t,hasVisible:n.hasVisible,hasHidden:n.hasHidden,canvasX:e.clientX-r.left,canvasY:e.clientY-r.top},o=this.buildMenu(e,i);this.viewer.runContextMenuCallbacks(o,i),o&&0<o.length&&this.contextMenu.show(e,o)},o.prototype.hide=function(){return this.contextMenu.hide()},o.prototype.buildMenu=function(e,t){return null}},"./src/gui/Panel.css":
/*!***************************!*\
  !*** ./src/gui/Panel.css ***!
  \***************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ProgressBar.css":
/*!*********************************!*\
  !*** ./src/gui/ProgressBar.css ***!
  \*********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ProgressBar.js":
/*!********************************!*\
  !*** ./src/gui/ProgressBar.js ***!
  \********************************/
/*! exports provided: ProgressBar */function(e,t,n){"use strict";function r(e){var t=e.ownerDocument;this.bg=t.createElement("div"),this.bg.className="progressbg",this.fg=t.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),e.appendChild(this.bg),this.lastValue=-1,this.fg.style.width="0%"}n.r(t),n.d(t,"ProgressBar",(function(){return r})),r.prototype.setPercent=function(e){e!=this.lastValue&&(this.lastValue=e,e>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=e+"%"))},r.prototype.setStyle=function(e){!this.fg.classList.contains(e)&&this.fg.classList.add(e)},r.prototype.removeStyle=function(e){this.fg.classList.contains(e)&&this.fg.classList.remove(e)}},"./src/gui/PropertyPanel.css":
/*!***********************************!*\
  !*** ./src/gui/PropertyPanel.css ***!
  \***********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/PropertyPanel.js":
/*!**********************************!*\
  !*** ./src/gui/PropertyPanel.js ***!
  \**********************************/
/*! exports provided: PropertyPanel */function(e,t,n){"use strict";n.r(t),n.d(t,"PropertyPanel",(function(){return s}));var r=n(/*! ./DockingPanel */"./src/gui/DockingPanel.js"),i=n(/*! ./TreeDelegate */"./src/gui/TreeDelegate.js"),o=n(/*! ./Tree */"./src/gui/Tree.js");function s(e,t,n,s){r.DockingPanel.call(this,e,t,n,s),this.title.classList.add("docking-panel-delimiter-shadow"),this.container.classList.add("property-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:70,marginTop:0}),this.highlightableElements={};var a=this;var l=function(){var e=new i.TreeDelegate;function t(e){return"category"===e.type}return e.setGlobalManager(a.globalManager),e.getTreeNodeId=function(e){return e.name+(e.hasOwnProperty("value")?e.value:"")+(e.hasOwnProperty("category")?e.category:"")},e.getTreeNodeClass=function(e){return t(e)?a.getCategoryClass(e):a.getPropertyClass(e)},e.isTreeNodeGroup=function(e){return t(e)},e.onTreeNodeClick=function(e,n,r){t(n)?a.onCategoryClick(n,r):a.onPropertyClick(n,r)},e.onTreeNodeRightClick=function(e,n,r){t(n)?a.onCategoryRightClick(n,r):a.onPropertyRightClick(n,r)},e.onTreeNodeDoubleClick=function(e,n,r){t(n)?a.onCategoryDoubleClick(n,r):a.onPropertyDoubleClick(n,r)},e.onTreeNodeIconClick=function(e,n,r){t(n)?a.onCategoryIconClick(n,r):a.onPropertyIconClick(n,r)},e.createTreeNode=function(e,n,r){var i=null;(i=t(e)?a.displayCategory(e,n,r):a.displayProperty(e,n,r))&&(a.highlightableElements[this.getTreeNodeId(e)]=i)},e}();this.tree=new o.Tree(l,null,this.scrollContainer,{}),this.tree.setGlobalManager(this.globalManager)}s.prototype=Object.create(r.DockingPanel.prototype),s.prototype.constructor=s,s.prototype.setProperties=function(e,t){this.removeAllProperties();for(var n=[],r=[],i=0;i<e.length;i++){if(!(c=e[i]).hidden){var o=e[i].displayCategory;o&&"string"==typeof o&&""!==o?n.push(c):r.push(c)}}if(n.length+r.length!==0){r[0]&&"Name"===r[0].displayName&&(this.addProperty(r[0].displayName,r[0].displayValue),r.shift());for(i=0;i<n.length;i++){var s=(c=n[i]).precision||Bimfish.Viewing.Private.calculatePrecision(c.displayValue),a=Bimfish.Viewing.Private.formatValueWithUnits(c.displayValue,c.units,c.type,s);this.addProperty(c.displayName,a,c.displayCategory)}var l=n.length>0;for(i=0;i<r.length;i++){var c;s=(c=r[i]).precision||Bimfish.Viewing.Private.calculatePrecision(c.displayValue),a=Bimfish.Viewing.Private.formatValueWithUnits(c.displayValue,c.units,c.type,s);this.addProperty(c.displayName,a,l?"Other":"",l?{localizeCategory:!0}:{})}}else this.showNoProperties()},s.prototype.showNoProperties=function(){this.removeAllProperties();var e=this.tree.myRootContainer,t=this.getDocument().createElement("div");t.className="no-properties";var n="No properties to display";t.setAttribute("data-i18n",n),t.textContent=Bimfish.Viewing.i18n.translate(n),e.appendChild(t)},s.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},s.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},s.prototype.addProperty=function(e,t,n,r){if(this.tree.getElementForNode({name:e,value:t,category:n}))return!1;var i=null,o={name:e,value:t,type:"property"};return n?((i=this.tree.getElementForNode({name:n}))||(i=this.tree.createElement_({name:n,type:"category"},this.tree.myRootContainer,r&&r.localizeCategory?{localize:!0}:null)),o.category=n):i=this.tree.myRootContainer,this.tree.createElement_(o,i,r&&r.localizeProperty?{localize:!0}:null),!0},s.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0;return!1},s.prototype.removeProperty=function(e,t,n,r){var i={name:e,value:t,category:n},o=this.tree.getElementForNode(i);return!!o&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(i)],o.parentNode.removeChild(o),!0)},s.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},s.prototype.setCategoryCollapsed=function(e,t){var n=this.tree.delegate().getTreeNodeId(e);this.tree.setCollapsed(n,t)},s.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e);return this.tree.isCollapsed(t)},s.prototype.getContentSize=function(){var e=this.tree.myRootContainer;return{height:e.clientHeight+55,width:e.clientWidth}},s.prototype.highlight=function(e,t){function n(t){var n=t.innerHTML,r=n.replace(/(<highlight>|<\/highlight>)/gim,"");if(n!==r&&(t.innerHTML=r),e&&""!==e){var i=new RegExp("(\\b"+e+"\\b)","gim"),o=r.replace(i,"<highlight>$1</highlight>");t.innerHTML=o}}for(var r in this.highlightableElements)for(var i=this.highlightableElements[r],o=0;o<i.length;++o)n(i[o])},s.prototype.displayCategory=function(e,t,n){var r=this.getDocument().createElement("div"),i=e.name;return n&&n.localize&&(r.setAttribute("data-i18n",i),i=Bimfish.Viewing.i18n.translate(i)),r.textContent=i,r.title=i,r.className="category-name",t.appendChild(r),[r]},s.prototype.displayProperty=function(e,t,n){var r=this.getDocument(),i=r.createElement("div"),o=e.name;n&&n.localize&&(i.setAttribute("data-i18n",o),o=Bimfish.Viewing.i18n.translate(o)),i.textContent=o,i.title=o,i.className="property-name";var s=r.createElement("div");s.className="separator";var a=r.createElement("div");a.textContent=e.value;var l=e.value;return a.title=l,l=function(e){e=String(e);var t=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}].reduce((function(e,t){return e.replace(t.pattern,t.value)}),e)}(l),a.innerHTML=l,a.className="property-value",t.appendChild(i),t.appendChild(s),t.appendChild(a),[i,a]},s.prototype.getCategoryClass=function(e){return"category"},s.prototype.getPropertyClass=function(e){return"property"},s.prototype.onCategoryClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},s.prototype.onPropertyClick=function(e,t){},s.prototype.onCategoryIconClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},s.prototype.onPropertyIconClick=function(e,t){},s.prototype.onCategoryDoubleClick=function(e,t){},s.prototype.onPropertyDoubleClick=function(e,t){},s.prototype.onCategoryRightClick=function(e,t){},s.prototype.onPropertyRightClick=function(e,t){}},"./src/gui/RenderOptionsPanel.js":
/*!***************************************!*\
  !*** ./src/gui/RenderOptionsPanel.js ***!
  \***************************************/
/*! exports provided: RenderOptionsPanel */function(e,t,n){"use strict";n.r(t),n.d(t,"RenderOptionsPanel",(function(){return l}));var r=n(/*! ./DockingPanel */"./src/gui/DockingPanel.js"),i=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),o=n(/*! ../compat */"./src/compat.js"),s=n(/*! ./CommonWidgets */"./src/gui/CommonWidgets.js"),a=n(/*! ../application/LightPresets */"./src/application/LightPresets.js");function l(e){var t=this;this.viewer=e,this.setGlobalManager(e.globalManager),r.DockingPanel.call(this,e.container,"RenderOptionsPanel","Rendering Options");var n=this.getDocument();this.table=n.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=n.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.saoToggle=new s.OptionCheckbox("AO Enabled",this.tbody,!0),this.saoToggle.setGlobalManager(this.globalManager),this.addEventListener(this.saoToggle,"change",(function(n){var r=t.saoToggle.checked;e.prefs.set("ambientShadows",r),e.setQualityLevel(r,e.impl.renderer().settings.antialias)})),this.saoRadius=new s.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setGlobalManager(this.globalManager),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",(function(n){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()})),this.saoIntensity=new s.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setGlobalManager(this.globalManager),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",(function(n){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()})),this.groundShadowAlpha=new s.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setGlobalManager(this.globalManager),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",(function(n){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))})),this.groundShadowColor=new s.OptionCheckbox("Shadow Color",this.tbody),this.groundShadowColor.setGlobalManager(this.globalManager),o.isIE11||(this.groundShadowColor.checkElement.value="#000000",this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",(function(n){var r=t.groundShadowColor.checkElement.value;e.setGroundShadowColor(new THREE.Color(parseInt(r.substr(1,7),16)))})),this.groundReflectionAlpha=new s.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setGlobalManager(this.globalManager),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",(function(n){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))})),this.groundReflectionColor=new s.OptionCheckbox("Reflection Color",this.tbody),this.groundReflectionColor.setGlobalManager(this.globalManager),o.isIE11||(this.groundReflectionColor.checkElement.value="#000000",this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",(function(n){var r=t.groundReflectionColor.checkElement.value;e.setGroundReflectionColor(new THREE.Color(parseInt(r.substr(1,7),16)))}));for(var l=[],c=0;c<a.LightPresets.length;c++)l.push(a.LightPresets[c].name);this.envSelect=new s.OptionDropDown("Environment",this.tbody,l,e.impl.currentLightPreset()),this.envSelect.setGlobalManager(this.globalManager),this.addEventListener(this.envSelect,"change",(function(n){var r=t.envSelect.selectedIndex;e.setLightPreset(r)}));var u=e.impl.renderer().getToneMapMethod();this.toneMapMethod=new s.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],u),this.toneMapMethod.setGlobalManager(this.globalManager),this.addEventListener(this.toneMapMethod,"change",(function(){var n=t.toneMapMethod.selectedIndex;e.impl.setTonemapMethod(n)})),this.exposureBias=new s.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setGlobalManager(this.globalManager),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",(function(n){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)})),this.exposureBias.setDisabled(0==u),this.whiteScale=new s.OptionSlider("Light Intensity",-5,20,this.tbody),this.whiteScale.setGlobalManager(this.globalManager);var d=0;e.impl.dir_light1&&(d=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(d),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",(function(n){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)})),this.fovAngle=new s.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setGlobalManager(this.globalManager),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",(function(n){e.setFOV(parseFloat(t.fovAngle.value))})),this.frameRate=new s.OptionSlider("Frame rate:",1,100,this.tbody),this.frameRate.setGlobalManager(this.globalManager),this.frameRate.setValue(e.impl.getFrameRate()),this.frameRate.sliderElement.step=this.frameRate.stepperElement.step=1,this.addEventListener(this.frameRate,"change",(function(n){e.impl.setFrameRate(t.frameRate.value)})),this.addEventListener(this.viewer,i.CAMERA_CHANGE_EVENT,(function(n){var r=parseFloat(t.fovAngle.value),i=e.getFOV();r!=i&&t.fovAngle.setValue(i)})),this.addEventListener(this.viewer,i.RENDER_OPTION_CHANGED_EVENT,(function(e){t.syncUI()})),this.addEventListener(this.viewer,i.VIEWER_STATE_RESTORED_EVENT,(function(e){t.syncUI()})),this.addVisibilityListener((function(e){e&&t.resizeToContent()}))}l.prototype=Object.create(r.DockingPanel.prototype),l.prototype.constructor=l,l.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},l.prototype.syncUI=function(){var e=this.viewer.impl,t=0;e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias());var n=e.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(n),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==n),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV())},l.prototype.uninitialize=function(){r.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null}},"./src/gui/SettingsPanel.css":
/*!***********************************!*\
  !*** ./src/gui/SettingsPanel.css ***!
  \***********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/SettingsPanel.js":
/*!**********************************!*\
  !*** ./src/gui/SettingsPanel.js ***!
  \**********************************/
/*! exports provided: SettingsPanel */function(e,t,n){"use strict";n.r(t),n.d(t,"SettingsPanel",(function(){return l}));var r=n(/*! ./DockingPanel */"./src/gui/DockingPanel.js"),i=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),o=n(/*! ../compat */"./src/compat.js"),s=n(/*! ./CommonWidgets */"./src/gui/CommonWidgets.js");n(/*! ./controls/Button */"./src/gui/controls/Button.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n,i){r.DockingPanel.call(this,e,t,n,i),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0,this.shown=!1;var o=this,s=i&&void 0!==i.width?i.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=s+"px",this.container.style.top="10px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute";var a=this.getDocument();this.tabContainer=a.createElement("div"),this.tabContainer.classList.add("docking-panel-container-solid-color-b"),this.tabContainer.classList.add("settings-tabs"),this.tabContainer.classList.add("docking-panel-delimiter-shadow"),this.container.appendChild(this.tabContainer),this.tabs=a.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=i&&i.heightAdjustment?i.heightAdjustment:179,i&&i.hideTabBar&&(this.heightAdjustment-=40,this.tabContainer.style.display="none",this.tabContainer.style.height=0),this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.tablesContainer=a.createElement("div"),this.tablesContainer.classList.add("settings-tabs-tables-container"),i&&i.hideTabBar&&(this.scrollContainer.style.top="50px"),this.scrollContainer.appendChild(this.tablesContainer),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",(function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver)return!0;for(var n=0,r=o.getWindow();t&&t.parentNode&&t.parentNode!=r;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),o.mouseOver=!0;for(n=0;n<o.panelTabs.length;n++)o.panelTabs[n].classList.remove("selectedmouseout");return!0}t=t.parentNode}})),this.addEventListener(this.container,"mouseout",(function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver){for(var n=o.getWindow();t&&t.parentNode&&t.parentNode!=n;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}o.mouseOver=!1;for(var r=0;r<o.panelTabs.length;r++)o.panelTabs[r].classList.contains("tabselected")&&o.panelTabs[r].classList.add("selectedmouseout")}})),this.expandID=function(e){return t+"-"+e}}l.prototype=Object.create(r.DockingPanel.prototype),l.prototype.constructor=l,l.prototype.setVisible=function(e){e&&(this.container.style.display="block",this.shown||(this.resizeToContent(),this.container.style.left=this.parentContainer.offsetWidth/2-this.container.getBoundingClientRect().width/2+"px"),this.shown=!0),r.DockingPanel.prototype.setVisible.call(this,e)},l.prototype.addTab=function(e,t,n){var r=this;if(void 0!==this.tabIdToIndex[e])return!1;var s=n&&void 0!==n.className?n.className:null,a=n&&void 0!==n.width?n.width:200,l=n&&void 0!==n.index?n.index:this.panelTabs.length;var c=this.getDocument(),u=c.createElement("li");u._id=e,u.id=this.expandID(u._id),u.classList.add(s);var d=c.createElement("a"),h=c.createElement("span");h.setAttribute("data-i18n",t),h.textContent=i.i18n.translate(t),d.appendChild(h),u.appendChild(d),this.tabs.appendChild(u);var f=c.createElement("table");f._id=e+"-table",f.id=this.expandID(f._id),f.classList.add("settings-table"),f.classList.add("adsk-lmv-tftable"),f.classList.add(s);var p=c.createElement("tbody");return p.style.display="table",p.style.width="100%",f.appendChild(p),this.tablesContainer.appendChild(f),this.addEventListener(u,"touchstart",o.touchStartToClick),this.addEventListener(u,"click",(function(t){r.selectTab(e)})),this.panelTabs.push(u),this.tabIdToIndex[e]=l,a>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=a+"px"),!0},l.prototype.removeTab=function(e){var t=this.tabIdToIndex[e];if(!t)return!1;this.panelTabs.splice(t,1);var n=this.getDocument().getElementById(this.expandID(e));this.tabs.removeChild(n),this.tabIdToIndex={};for(var r=this.panelTabs.length,i=0;i<r;i++){var s=this.panelTabs[i];this.tabIdToIndex[s._id]=i,this.removeEventListener(s,"touchstart",o.touchStartToClick),this.removeEventListener(s,"click",select)}return!0},l.prototype.resizeTabs=function(){for(var e=this.tabs.getElementsByTagName("li"),t=100/e.length,n=0;n<e.length;n++)e[n].style.width=t+"%"},l.prototype.hasTab=function(e){var t=this.tabIdToIndex[e];return void 0!==this.panelTabs[t]},l.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1;for(var t=this.getDocument(),n=this.panelTabs.length,r=0;r<n;r++){var i=this.panelTabs[r],o=t.getElementById(this.expandID(i._id+"-table"));e===i._id?(i.classList.add("tabselected"),o.classList.add("settings-selected-table"),this.mouseOver||i.classList.add("selectedmouseout")):(i.classList.remove("tabselected"),o.classList.remove("settings-selected-table"),this.mouseOver||this.panelTabs[r].classList.remove("selectedmouseout"))}return this.scrollContainer.scrollTop=0,!0},l.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],n=this.panelTabs[t];return n&&n.classList.contains("tabselected")},l.prototype.getSelectedTabId=function(){for(var e in this.tabIdToIndex)if(this.isTabSelected(e))return e;return null},l.prototype.addLabel=function(e,t){var n,r=this.tabIdToIndex[e];if(-1===r)return!1;n=this.tablesContainer.childNodes[r];var i=new s.OptionLabel(t,n.tBodies[0]);return i.setGlobalManager(this.globalManager),i.sliderRow.classList.add("logical-group"),i},l.prototype.addButton=function(e,t){var n=this.tabIdToIndex[e];if(void 0===n)return null;var r=this.tablesContainer.childNodes[n],i=new s.OptionButton(t,r.tBodies[0]);return i.setGlobalManager(this.globalManager),this.addControl(e,i)},l.prototype.addCheckbox=function(e,t,n,r,i,o){if(void 0===this.tabIdToIndex[e])return null;var a=this.getDocument().getElementById(this.expandID(e+"-table")),l=new s.OptionCheckbox(t,a.tBodies[0],n,i,o);return l.setGlobalManager(this.globalManager),l.changeListener=function(e){var t=e.detail.target.checked;r(t)},this.addEventListener(l,"change",l.changeListener),this.addControl(e,l)},l.prototype.addRow=function(e,t,n,r){if(void 0===this.tabIdToIndex[e])return null;var i=this.getDocument().getElementById(this.expandID(e+"-table")),o=new s.OptionRow(t,i.tBodies[0],n,r);return o.setGlobalManager(this.globalManager),this.addControl(e,o)},l.prototype.addSlider=function(e,t,n,r,i,o,a){if(void 0===this.tabIdToIndex[e])return null;var l=this.getDocument().getElementById(this.expandID(e+"-table")),c=new s.OptionSlider(t,n,r,l.tBodies[0],a);c.setGlobalManager(this.globalManager),c.setValue(i);var u=1;return a&&a.step&&(u=a.step),c.sliderElement.step=c.stepperElement.step=u,this.addEventListener(c,"change",(function(e){o(e)})),this.addControl(e,c)},l.prototype.addSliderV2=function(e,t,n,r,i,o,s,a){(a=a||{}).hideStepper=!0,a.hideCaption=!0;var l=[];return l.push(this.addRow(e,t,n,a)),l.push(this.addSlider(e,t,r,i,o,s,a)),l},l.prototype.addDropDownMenu=function(e,t,n,r,i,o){if(void 0===this.tabIdToIndex[e])return null;var a=this.getDocument().getElementById(this.expandID(e+"-table")),l=new s.OptionDropDown(t,a.tBodies[0],n,r,null,this.globalManager,o);return l.setGlobalManager(this.globalManager),this.addEventListener(l,"change",(function(e){i(e)})),this.addControl(e,l)},l.prototype.addControl=function(e,t,n){if(void 0===this.tabIdToIndex[e])return null;if(!t.hasOwnProperty("sliderRow")){var r=n&&n.insertAtIndex?n.insertAtIndex:-1,o=n&&n.caption?n.caption:null,s=this.getDocument(),a=s.getElementById(this.expandID(e+"-table"));r>a.length&&(r=-1);var l=a.tBodies[0].insertRow(r),c=l.insertCell(0);if(o){var u=s.createElement("div");u.setAttribute("data-i18n",o),u.textContent=i.i18n.translate(o),c.appendChild(u),c=l.insertCell(1)}else c.colSpan=3;c.appendChild(t),t.sliderRow=l,t.tbody=a.tBodies[0]}var d=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[d]=t,t.parent=this,d},l.prototype.removeButton=function(e){return this.removeControl(e)},l.prototype.removeCheckbox=function(e){return this.removeControl(e)},l.prototype.removeSlider=function(e){return this.removeControl(e)},l.prototype.removeDropdownMenu=function(e){return this.removeControl(e)},l.prototype.removeControl=function(e){var t;if("object"===a(e)&&e.tbody){for(var n in t=e,this.controls)if(this.controls[n]===t){e=n;break}}else t=this.controls[e];if(void 0===t)return!1;if(t.removeFromParent)t.removeFromParent();else{var r=t.tbody,i=t.sliderRow.rowIndex;r.deleteRow(i)}return delete this.controls[e],t.parent=void 0,!0},l.prototype.getControl=function(e){return this.controls[e]||null},l.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=0,n=this.getDocument(),r=0;r<this.panelTabs.length;r++){var i=this.panelTabs[r],o=n.getElementById(this.expandID(i._id+"-table")),s=o?o.clientHeight:0;t=Math.max(t,s)}return{height:e+t,width:this.container.clientWidth}},l.prototype.sizeToContent=function(e){var t=this.getContentSize().height+this.heightAdjustment,n=e.clientHeight-this.heightAdjustment,r=Math.min(t,n);this.container.style.height=parseInt(r)+"px"},l.prototype.addSimpleList=function(e,t,n){var r=new s.SimpleList(e,t,n);return r.setGlobalManager(this.globalManager),r},l.prototype.removeSimpleList=function(e){return!!e&&(e.removeFromParent(),!0)}},"./src/gui/Tree.css":
/*!**************************!*\
  !*** ./src/gui/Tree.css ***!
  \**************************/
/*! no static exports found */function(e,t,n){},"./src/gui/Tree.js":
/*!*************************!*\
  !*** ./src/gui/Tree.js ***!
  \*************************/
/*! exports provided: Tree */function(e,t,n){"use strict";n.r(t),n.d(t,"Tree",(function(){return a}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ../tools/GestureHandler */"./src/tools/GestureHandler.js"),o=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),s=n(/*! ../../thirdparty/hammer/hammer.js */"./thirdparty/hammer/hammer.js");function a(e,t,n,r){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=r||{},this.parentContainer=n;this.groupClassName=this.myOptions.groupClassName||"expanded",this.leafClassName=this.myOptions.leafClassName||"expanded",this.selectedClassName=this.myOptions.selectedClassName||"selected",this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var i=this.myRootContainer=this.createHtmlElement_(n,"div","treeview"),o=this.rootElem=this.createElement_(t,i,r,0);this.setInputHandlers_(),r&&r.excludeRoot&&o.classList.add("exclude")}a.prototype.constructor=a,o.GlobalManagerMixin.call(a.prototype),a.prototype.destroy=function(){this.myDelegate=null,this.parentContainer&&(this.parentContainer.removeChild(this.myRootContainer),this.myRootContainer=null,this.parentContainer=null)},a.prototype.show=function(e){var t=this.myRootContainer;t.style.display=e?"block":"none"},a.prototype.getRootContainer=function(){return this.myRootContainer},a.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},a.prototype.delegate=function(){return this.myDelegate},a.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},a.prototype.setCollapsed=function(e,t,n){t?(this.addClass(e,"collapsed",n),this.removeClass(e,"expanded",n)):(this.addClass(e,"expanded",n),this.removeClass(e,"collapsed",n))},a.prototype.setAllCollapsed=function(e){var t,n;e?(t=function(e){return e.classList.contains("expanded")},n=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},n=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")});for(var r=0;r<this.myGroupNodes.length;++r){var i=this.myGroupNodes[r];t(i)&&n(i)}},a.prototype.addToSelection=function(e){var t=this;function n(e){return-1===t.mySelectedNodes.indexOf(e)&&(t.mySelectedNodes.push(e),!0)}for(var r=e.length,i=0;i<r;++i){var o=e[i];n(o)&&this.addClass(o,this.selectedClassName)}},a.prototype.removeFromSelection=function(e){var t=this;function n(e){var n=t.mySelectedNodes.indexOf(e);return-1!==n&&(t.mySelectedNodes.splice(n,1),!0)}for(var r=e.length-1;r>=0;--r){var i=e[r];n(i)&&this.removeClass(i,this.selectedClassName)}},a.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},a.prototype.getSelection=function(){return this.mySelectedNodes.concat()},a.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},a.prototype.isSelected=function(e){return this.hasClass(e,this.selectedClassName)},a.prototype.scrollTo=function(e){var t=this.getElementForNode(e);if(t){var n=t.offsetTop;for(t=t.parentNode;t&&t!=this.myRootContainer;)n+=t.offsetTop,t=t.parentNode;var r=this.myRootContainer.parentNode;this.myDelegate.getScrollContainer()&&(r=this.myDelegate.getScrollContainer()),r.scrollTop=n}},a.prototype.addClass=function(e,t,n){var r=this.getElementForNode(e);if(r){if(n){r=r.parentNode;for(var i=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;r&&r!==i;)r.classList.add(t),r=r.parentNode}else r.classList.add(t);return!0}return!1},a.prototype.removeClass=function(e,t,n){var r=this.getElementForNode(e);if(r){if(n){r=r.parentNode;for(var i=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;r&&r!==i;)r.classList.remove(t),r=r.parentNode}else r.classList.remove(t);return!0}return!1},a.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},a.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild);this.nodeToElement={},this.nodeIdToNode={}},a.prototype.createElement_=function(e,t,n,r){if(null==e)return null;if(!this.myDelegate.shouldCreateTreeNode(e))return null;var i,o=this;function s(t,i,s,a){var l=o.createHtmlElement_(t,i,s),c=o.myDelegate.getTreeNodeId(a);l.setAttribute("lmv-nodeId",c);var u=o.createHtmlElement_(l,"lmvheader"),d=o.createHtmlElement_(u,"icon");return d.addEventListener("mousedown",(function(e){e.stopPropagation(),e.preventDefault()}),!1),d.addEventListener("click",(function(t){o.myDelegate.onTreeNodeIconClick(o,e,t),t.stopPropagation(),t.preventDefault()}),!1),o.myDelegate.createTreeNode(e,u,n,i,r),l}var a=this.myDelegate.getTreeNodeId(e);if(o.myDelegate.isTreeNodeGroup(e)){i=s(t,"group",o.groupClassName,e),o.nodeToElement[a]=i,o.nodeIdToNode[a]=e;var l=o.myOptions.excludeRoot?1:0;r==l&&(i.style.left="0px"),o.myGroupNodes.push(i),o.myDelegate.forEachChild(e,(function(e){o.createElement_(e,i,n,r+1)}))}else{i=s(t,"leaf",o.leafClassName,e),o.nodeToElement[a]=i,o.nodeIdToNode[a]=e;l=o.myOptions.excludeRoot?1:0;r==l&&(i.style.marginLeft="0px")}var c=o.myDelegate.getTreeNodeClass(e);return c&&i.classList.add(c),i},a.prototype.setInputHandlers_=function(){var e=this,t=this.myRootContainer,n=function(n){var r=null,i=!1;do{n&&n!==t?n.hasAttribute("lmv-nodeId")?(r=n,i=!0):n=n.parentElement:(r=null,i=!0)}while(!i);if(r){var o=r.getAttribute("lmv-nodeId");return e.nodeIdToNode[o]||null}return null};Object(r.isTouchDevice)()&&(this.hammer=new s.Manager(t,{recognizers:[i.GestureRecognizers.doubletap,i.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:r.isIE11?s.PointerEventInput:s.TouchInput}),this.hammer.on("doubletap",(function(t){var r=n(t.target);null!==r&&e.myDelegate.onTreeNodeDoubleClick(e,r,t)})),this.hammer.on("press",(function(t){var r=n(t.target);null!==r&&e.myDelegate.onTreeNodeRightClick(e,r,t)}))),t.addEventListener("click",(function(t){var r=n(t.target);null!==r&&(e.myDelegate.onTreeNodeClick(e,r,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())}),!1),t.addEventListener("dblclick",(function(t){var r=n(t.target);null!==r&&(e.myDelegate.onTreeNodeDoubleClick(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("contextmenu",(function(t){var r=n(t.target);null!==r&&(e.myDelegate.onTreeNodeRightClick(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("mouseover",(function(t){var r=n(t.target);null!==r&&(e.myDelegate.onTreeNodeHover(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("mouseout",(function(t){var r=t.toElement||t.relatedTarget;if(n(t.target)!=n(r)){e.myDelegate.onTreeNodeHover(e,-1,t),t.stopPropagation(),t.preventDefault()}}),!1)},a.prototype.createHtmlElement_=function(e,t,n){var r=this.getDocument().createElement(t);return e.appendChild(r),n&&(r.className=n),r},a.prototype.iterate=function(e,t){if(null!=e&&this.myDelegate.shouldCreateTreeNode(e)){var n=this.getElementForNode(e);if(n){t(e,n);var r=this;this.myDelegate.forEachChild(e,(function(e){r.iterate(e,t)}))}}}},"./src/gui/TreeDelegate.js":
/*!*********************************!*\
  !*** ./src/gui/TreeDelegate.js ***!
  \*********************************/
/*! exports provided: TreeDelegate */function(e,t,n){"use strict";n.r(t),n.d(t,"TreeDelegate",(function(){return i}));var r=n(/*! ../globalization/i18next */"./src/globalization/i18next.js");function i(){}n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(i.prototype),i.prototype.constructor=i,i.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},i.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},i.prototype.getTreeNodeIndex=function(e){throw"getTreeNodeIndex is not implemented."},i.prototype.getTreeNodeParentId=function(e){throw"getTreeNodeParentId is not implemented."},i.prototype.getTreeNodeLabel=function(e){return e.name},i.prototype.getTreeNodeCount=function(){throw"getTreeNodeCount is not implemented."},i.prototype.shouldCreateTreeNode=function(e){return!0},i.prototype.forEachChild=function(e,t){for(var n=e.children?e.children.length:0,r=0;r<n;++r){t(e.children[r])}},i.prototype.createTreeNode=function(e,t,n,i,o){var s=this.getDocument().createElement("label");t.appendChild(s);var a=this.getTreeNodeLabel(e);return n&&n.localize&&(s.setAttribute("data-i18n",a),a=r.i18n.translate(a)),s.textContent=a,s},i.prototype.onTreeNodeClick=function(e,t,n){},i.prototype.onTreeNodeIconClick=function(e,t,n){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},i.prototype.onTreeNodeDoubleClick=function(e,t,n){},i.prototype.onTreeNodeRightClick=function(e,t,n){},i.prototype.onTreeNodeReized=function(e){},i.prototype.getTreeNodeClass=function(e){return""},i.prototype.getTreeNodeParentMaxSize=function(e){return{width:0,height:0}},i.prototype.getTreeNodeClientHeight=function(e){return 0},i.prototype.getTreeNodeDepthOffset=function(e,t){return 0},i.prototype.onTreeNodeHover=function(e,t,n){},i.prototype.getScrollContainer=function(){return null}},"./src/gui/TreeOnDemand.css":
/*!**********************************!*\
  !*** ./src/gui/TreeOnDemand.css ***!
  \**********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/TreeOnDemand.js":
/*!*********************************!*\
  !*** ./src/gui/TreeOnDemand.js ***!
  \*********************************/
/*! exports provided: TreeOnDemand */function(e,t,n){"use strict";n.r(t),n.d(t,"TreeOnDemand",(function(){return c}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ../tools/GestureHandler */"./src/tools/GestureHandler.js"),o=n(/*! ./LoadingSpinner */"./src/gui/LoadingSpinner.js"),s=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),a=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),l=n(/*! ../../thirdparty/hammer/hammer.js */"./thirdparty/hammer/hammer.js");function c(e,t){this.dirty=!1,this.nextFrameId=0,this.scrollY=0,this.delegates=[],this.idToDelegate={},this.options=t;var n=this.getDocument();this.rootContainer=n.createElement("div"),this.rootContainer.classList.add("docking-panel-container-gradient"),this.rootContainer.classList.add("treeview"),this.rootContainer.classList.add("on-demand"),e.appendChild(this.rootContainer),this.paddingDiv=n.createElement("div"),this.paddingDiv.style.border=0,this.paddingDiv.style.margin=0,this.paddingDiv.style.padding=0,this.sizedDiv=e.parentNode,this.nodeCssTable=[[],["group"],["leaf"]],this.cssStringToNodeCssTable={"":0,group:1,leaf:2},this.nodeIndexToNodeCssTables={};for(var s=[],a=0;a<150;++a){var c=_(n);s[a]=c}this.elementsPool=s,this.elementsUsed=0,this.spinner=new o.LoadingSpinner(e),this.spinner.setGlobalManager(this.globalManager),this.spinner.addClass("tree-loading-spinner");var u=Object(r.isTouchDevice)();u&&(this.hammer=new l.Manager(this.rootContainer,{recognizers:[i.GestureRecognizers.doubletap,i.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:r.isIE11?l.PointerEventInput:l.TouchInput}));for(a=0;a<150;++a){c=s[a];u&&(this.hammer.on("doubletap",b.bind(this)),this.hammer.on("press",x.bind(this))),c.addEventListener("click",w.bind(this)),c.addEventListener("dblclick",E.bind(this)),c.addEventListener("contextmenu",A.bind(this)),c.icon.addEventListener("click",M.bind(this)),c.icon.addEventListener("mousedown",S.bind(this))}f(this)}var u=c.prototype;function d(e){if(e.dirty=!1,function(e){for(var t=e.elementsUsed,n=e.elementsPool,r=0;r<t;++r){var i=n[r];i.setAttribute("lmv-nodeId",""),i.className="";for(var o=i.header,s=o.childNodes.length-1,a=0;a<s;++a)o.removeChild(o.lastChild)}e.clear()}(e),e.displayNoProperties(!1),0!==e.delegates.length)if(1===e.delegates.length&&e.delegates[0].isLoading())e.spinner.setVisible(!0);else{if(1===e.delegates.length&&e.delegates[0].isNotAvailable())return e.spinner.setVisible(!1),void e.displayNoProperties(!0);e.spinner.setVisible(!1),function(e){var t=e.rootContainer,n=function(e){return{width:0|e.sizedDiv.clientWidth,height:0|e.sizedDiv.clientHeight}}(e).height,r=0,i=0,o=!0;t.appendChild(e.paddingDiv);var s=e.delegates.slice(0),a=e.isExcludeRoot();for(;s.length;){var l=s.shift(),c=l.modelDiv;t.appendChild(c);for(var u=[l.getRootId()],d={curr:a?-1:0,popIds:[]};u.length&&o;){if(r>e.scrollY+n+300){o=!1;break}if(e.elementsUsed===e.elementsPool.length){o=!1;break}var f=u.shift(),p=-1===d.curr?0:l.getTreeNodeClientHeight(f),m=r+p;if(p>0&&m+300>=e.scrollY){var g=e.elementsPool[e.elementsUsed++];g.setAttribute("lmv-nodeId",f),l.createTreeNode(f,g.header);var y=l.getTreeNodeClass(f);y&&g.classList.add(y);var _=v(e,l,f);if(_)for(var b=_.length,x=0;x<b;++x)g.classList.add(_[x]);var w=l.getTreeNodeDepthOffset(f,d.curr);g.header.style.paddingLeft=w+"px",c.appendChild(g)}if(m+300<e.scrollY&&(i=m),r=m,(M=h(e,l,f,0===p))&&M.length>0){d.curr++;for(var E=M[M.length-1],A=d.popIds.length-1;A>=0&&d.popIds[A]===f;)d.popIds[A--]=E;d.popIds.push(E),u=M.concat(u)}for(;d.popIds.length>0&&f===d.popIds[d.popIds.length-1];)d.popIds.pop(),d.curr--}for(e.paddingDiv.style.height=i+"px";u.length;){var M;f=u.shift(),p=-1===d.curr?0:l.getTreeNodeClientHeight(f);r=m=r+p,(M=h(e,l,f))&&M.length&&(u=M.concat(u))}}t.style.height=r+"px"}(e)}else e.spinner.setVisible(!1)}function h(e,t,n,r){if(!t.isTreeNodeGroup(n))return null;if(!r&&e.isCollapsed(t,n))return null;var i=[];return t.forEachChild(n,(function(e){i.push(e)})),i}function f(e,t){e.dirty&&!t||(t?d(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame((function(){d(e)}))))}function p(e,t){return"number"!=typeof t&&"string"!=typeof t?e.threeDelegate.getTreeNodeId(0|t):t}function m(e,t){for(var n=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-nodeId")){n=t;break}t=t.parentElement}if(!n)return null;var r=n.getAttribute("lmv-nodeId");return parseFloat(r)}function g(e,t){for(var n=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-modelId")){n=t;break}t=t.parentElement}if(!n)return null;var r=n.getAttribute("lmv-modelId");return parseInt(r)}function v(e,t,n){if(t.isControlId(n))return t.getControlIdCss(n);var r=t.getTreeNodeIndex(n);return e.nodeCssTable[e.nodeIndexToNodeCssTables[t.model.id][r]]}function y(e,t,n,r){var i=r.join(" "),o=e.cssStringToNodeCssTable[i]||e.nodeCssTable.length;o===e.nodeCssTable.length&&(e.nodeCssTable.push(r),e.cssStringToNodeCssTable[i]=o);var s=t.getTreeNodeIndex(n);e.nodeIndexToNodeCssTables[t.model.id][s]=o}function _(e,t,n){var r=e.createElement("lmvheader"),i=e.createElement("icon");r.appendChild(i);var o=e.createElement("div");return o.header=r,o.icon=i,o.appendChild(r),o}function b(e){var t=m(this,e.target);if(t){var n=g(this,e.target),r=this.getDelegate(n);r&&r.onTreeNodeDoubleClick(this,t,e)}}function x(e){var t=m(this,e.target);if(t){var n=g(this,e.target),r=this.getDelegate(n);r&&r.onTreeNodeRightClick(this,t,e)}}function w(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=m(this,e.target);if(t){var n=g(this,e.target),r=this.getDelegate(n);r&&(r.onTreeNodeClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function E(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=m(this,e.target);if(t){var n=g(this,e.target),r=this.getDelegate(n);r&&(r.onTreeNodeDoubleClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function A(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=m(this,e.target);if(t){var n=g(this,e.target),r=this.getDelegate(n);r&&(r.onTreeNodeRightClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function M(e){var t=m(this,e.target);if(t){var n=g(this,e.target),r=this.getDelegate(n);r&&(r.onTreeNodeIconClick(this,t,e),e.stopPropagation(),e.preventDefault())}}function S(e){e.stopPropagation(),e.preventDefault()}u.constructor=c,a.GlobalManagerMixin.call(u),u.pushDelegate=function(e){this.delegates.push(e),this.idToDelegate[e.model.id]=e,f(this)},u.removeDelegate=function(e){for(var t=0;t<this.delegates.length;++t){if(this.delegates[t].model.id===e)return this.delegates.splice(t,1),delete this.idToDelegate[e],delete this.nodeIndexToNodeCssTables[e],f(this),!0}return!1},u.setInstanceTree=function(e,t){if(e.setInstanceTree(t),f(this),t){var n=new Uint8Array(e.getTreeNodeCount()),r=e.instanceTree.getRootId();e.forEachChild(r,(function(t){var r=e.getTreeNodeIndex(t);n[r]=e.isTreeNodeGroup(t)?1:2}),!0);var i=e.model.id;this.nodeIndexToNodeCssTables[i]=n;var o=0,s=0;t.enumNodeChildren(r,(function(e){s||(o=e),s++})),this.setAllCollapsed(e,!0);var a=this.options.excludeRoot,l=this.options.startCollapsed;a?(this.setCollapsed(e,r,!1),l||this.setCollapsed(e,o,!1)):l||this.setCollapsed(e,e.rootId,!1),f(this,!0)}},u.show=function(e){this.rootContainer.style.display=block},u.getRootContainer=function(){return this.rootContainer},u.getDelegate=function(e){return this.idToDelegate[parseInt(e)]},u.isCollapsed=function(e,t){var n=v(this,e,t);return n&&-1!==n.indexOf("collapsed")},u.setCollapsed=function(e,t,n,r){n?(this.addClass(e,t,"collapsed",r),this.removeClass(e,t,"expanded",r)):(this.addClass(e,t,"expanded",r),this.removeClass(e,t,"collapsed",r))},u.setAllCollapsed=function(e,t){var n=function(t){this.addClass(e,t,"collapsed",!1),this.removeClass(e,t,"expanded",!1)}.bind(this),r=e.instanceTree.getRootId();this.iterate(e,r,(function(t){return e.isTreeNodeGroup(t)&&n(t),!0}))},u.addToSelection=function(e,t){for(var n=t.length,r=0;r<n;++r)this.addClass(e,t[r],"selected",!1);f(this)},u.removeFromSelection=function(e,t){for(var n=t.length,r=0;r<n;++r)this.removeClass(e,t[r],"selected",!1);f(this)},u.setSelection=function(e,t){return this.clearSelection(e),this.addToSelection(e,t),this.selectedNodes},u.clearSelection=function(e){var t=[],n=function(n){var r=v(this,e,n);r&&-1!==r.indexOf("selected")&&(t[0]=n,this.removeFromSelection(e,t))}.bind(this),r=e.instanceTree.getRootId();e.forEachChild(r,n,!0)},u.isSelected=function(e){var t=v(this,delegate,e);return t&&-1!==t.indexOf("selected")},u.scrollTo=function(e,t){var n=this.getDelegate(t.id);if(!n||!n.isNotAvailable()){var r=!1,i=[],o=function(t,n){if(!(r=r||e===t)){i.push(n.getTreeNodeClientHeight(t));var s=i.length,a=n.isTreeNodeGroup(t)&&-1!==v(this,n,t).indexOf("expanded");n.forEachChild(t,(function(e){o(e,n)})),a||r||i.length>s&&i.splice(s)}}.bind(this);this.setCollapsed(n,e,!1,!0);var s=n.getRootId();if(o(s,n),!r)return-1;for(var a=0,l=i.length,c=this.isExcludeRoot()?1:0;c<l;++c)a+=i[c];if(1===this.delegates.length)return f(this,!0),a;for(c=0;c<this.delegates.length;++c){var u=this.delegates[c];if(u===n)break;i=[],e=-1,r=!1,s=u.getRootId(),o(s,u),l=i.length;for(var d=0,h=0;h<l;++h)d+=i[h];a+=d}return f(this,!0),a}},u.addClass=function(e,t,n,r){function i(t,n,r){var i=v(t,e,n);i&&(-1===i.indexOf(r)&&((i=i.slice(0)).push(r),i.sort(),y(t,e,n,i)))}if(r)for(var o=e.getTreeNodeParentId(p(this,t));o;)i(this,o,n),o=e.getTreeNodeParentId(o);else i(this,t,n);return f(this),!0},u.removeClass=function(e,t,n,r){function i(t,n,r){var i=v(t,e,n);if(i){var o=i.indexOf(r);-1!==o&&((i=i.slice(0)).splice(o,1),y(t,e,n,i))}}if(r)for(var o=e.getTreeNodeParentId(p(this,t));o;)i(this,o,n),o=e.getTreeNodeParentId(o);else i(this,t,n);return f(this),!0},u.hasClass=function(e,t){return 1!==v(this,delegate,e).indexOf(t)},u.clear=function(){for(var e,t=this.rootContainer;e=t.lastChild;)t.removeChild(e);for(var n=0;n<this.delegates.length;++n)this.delegates[n].clean();this.elementsUsed=0},u.iterate=function(e,t,n){null!=t&&e.shouldCreateTreeNode(t)&&n(t)&&e.forEachChild(t,function(t){this.iterate(e,t,n)}.bind(this))},u.forEachDelegate=function(e){for(var t=0;t<this.delegates.length;++t)e(this.delegates[t])},u.destroy=function(){this.clear(),cancelAnimationFrame(this.nextFrameId),this.rootContainer.parentNode.removeChild(this.rootContainer),this.rootContainer=null,this.rootId=-1,this.nodeCssTable=null,this.nodeIndexToNodeCssTables=null,this.cssStringToNodeCssTable=null,this.elementsPool=null,this.elementsUsed=-1,this.scrollY=-1,this.hammer&&(this.hammer.destroy(),this.hammer=null)},u.setScroll=function(e){Math.abs(this.scrollY-e)>300&&(this.scrollY=e,f(this))},u.displayNoProperties=function(e){var t=this.getDocument();if(e){if(!this.divNoProps){this.divNoProps=t.createElement("div");var n="Model Browser is not available";this.divNoProps.innerText=s.i18n.translate(n),this.divNoProps.setAttribute("data-i18n",n),this.divNoProps.classList.add("lmv-no-properties")}if(!this.divNoProps.parentNode)this.rootContainer.parentNode.appendChild(this.divNoProps)}else this.divNoProps&&this.divNoProps.parentNode&&this.divNoProps.parentNode.removeChild(this.divNoProps)},u.isExcludeRoot=function(){return 1===this.delegates.length&&this.options.excludeRoot},u.getDelegateCount=function(){return this.delegates.length}},"./src/gui/ViewerModelStructurePanel.css":
/*!***********************************************!*\
  !*** ./src/gui/ViewerModelStructurePanel.css ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ViewerModelStructurePanel.js":
/*!**********************************************!*\
  !*** ./src/gui/ViewerModelStructurePanel.js ***!
  \**********************************************/
/*! exports provided: ViewerModelStructurePanel */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerModelStructurePanel",(function(){return u}));var r=n(/*! ./ModelStructurePanel */"./src/gui/ModelStructurePanel.js"),i=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),o=n(/*! ./controls/SearchEvents */"./src/gui/controls/SearchEvents.js"),s=n(/*! ./controls/Searchbox */"./src/gui/controls/Searchbox.js"),a=n(/*! ../logger/Logger */"./src/logger/Logger.js"),l=n(/*! ./ViewerPanelMixin */"./src/gui/ViewerPanelMixin.js"),c={click:{onObject:["isolate"]},clickShift:{onObject:["toggleMultipleOverlayedSelection"]},clickCtrl:{onObject:["toggleVisibility"]}};function u(e,t,n){this.viewer=e,this.visible=!1,this._trackNodeClick=!0,(n=n||{}).defaultTitle="Model",n.excludeRoot=void 0===n.excludeRoot||n.excludeRoot,n.startCollapsed=void 0!==n.startCollapsed&&n.startCollapsed,n.scrollEaseCurve=n.scrollEaseCurve||[0,0,.29,1],n.scrollEaseSpeed=void 0!==n.scrollEaseSpeed?n.scrollEaseSpeed:.003,n.addFooter=void 0===n.addFooter||n.addFooter,this.clickConfig=n&&n.docStructureConfig?n.docStructureConfig:c,this.isMac=-1!==navigator.userAgent.search("Mac OS"),n.hideSearch?(n.heightAdjustment=70,r.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",t,n),this.scrollContainer.classList.add("no-search")):(n.heightAdjustment=104,r.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",t,n),this.searchbox=new s.Searchbox(e.container.id+"ViewerModelStructurePanel-Searchbox",e,{excludeRoot:n.excludeRoot,searchFunction:d.bind(this)}),this.searchbox.setGlobalManager(this.globalManager),this.searchbox.addEventListener(o.ON_SEARCH_SELECTED,function(e){var t=e.id,n=this.viewer.impl.findModel(e.modelId);this.viewer.isolate(t,n)}.bind(this)),this.container.appendChild(this.searchbox.container)),this.setGlobalManager(e.globalManager),this._ignoreScroll=!1,this.selectedNodes={},this.onViewerSelect=this.onViewerSelect.bind(this),this.onViewerIsolate=this.onViewerIsolate.bind(this),this.onViewerHide=this.onViewerHide.bind(this),this.onViewerShow=this.onViewerShow.bind(this)}function d(e){var t=this.tree,n=e.toLowerCase(),r=[];return t.forEachDelegate((function(e){var i=e.getRootId(),o=[];t.iterate(e,i,(function(t){var r=e.instanceTree&&e.instanceTree.getNodeName(t);return r&&-1!==r.toLowerCase().indexOf(n)&&o.push(t),!0})),r.push({ids:o,delegate:e})})),r}u.prototype=Object.create(r.ModelStructurePanel.prototype),u.prototype.constructor=u,l.ViewerPanelMixin.call(u.prototype),u.prototype.uninitialize=function(){this.viewer&&(this.viewer.removeEventListener(i.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),this.viewer.removeEventListener(i.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),this.viewer.removeEventListener(i.HIDE_EVENT,this.onViewerHide),this.viewer.removeEventListener(i.SHOW_EVENT,this.onViewerShow),this.viewer=null),this.searchResults&&(this.searchResults.uninitialize(),this.searchResults=null),r.ModelStructurePanel.prototype.uninitialize.call(this)},u.prototype.resizeToContent=function(){var e=this.scrollContainer,t=this.tree?this.tree.getRootContainer():null;if(e&&t){var n="calc(100% + "+e.scrollLeft+"px)";t.style.width=n}},u.prototype.createUI=function(){if(!this.uiCreated){var e=this.viewer;r.ModelStructurePanel.prototype.createUI.call(this);var t=this.scrollContainer;t.classList.remove("left");var n=function(){this.visible&&this.resizeToContent(),requestAnimationFrame(n)}.bind(this);n();var o=this.options,s=0,a=e.container.getBoundingClientRect(),l=e.getToolbar();o.maxHeight?o.maxHeight:a.height;if(l){var c=l.container.getBoundingClientRect();s=a.bottom-c.top}else s=0;this.container.style.top="10px",this.container.style.left="10px",this.container.style.height="calc(100% - "+(s+20)+"px)",this.container.style.maxHeight="calc(100% - "+(s+20)+"px)",t.addEventListener("contextmenu",function(e){this.viewer.contextMenu.show(e)}.bind(this)),this.viewer.addEventListener(i.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),this.viewer.addEventListener(i.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),this.viewer.addEventListener(i.HIDE_EVENT,this.onViewerHide),this.viewer.addEventListener(i.SHOW_EVENT,this.onViewerShow)}},u.prototype.onViewerSelect=function(e){this.setSelection(e.selections),this._ignoreScroll||this.scrollToSelection(e.selections),this._ignoreScroll=!1},u.prototype.onViewerIsolate=function(e){this.setIsolation(e.isolation)},u.prototype.onViewerHide=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!0)},u.prototype.onViewerShow=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!1)},u.prototype.setVisible=function(e){r.ModelStructurePanel.prototype.setVisible.call(this,e),this.visible!==e&&(this.visible=e,this.visible&&this.sync())},u.prototype.sync=function(){var e=this.viewer.getAggregateIsolation();if(this.setIsolation(e),0===e.length)for(var t=this.viewer.getAggregateHiddenNodes(),n=0;n<t.length;++n){var r=t[n].model,i=t[n].ids;this.setHidden(i,r,!0)}var o=this.viewer.getAggregateSelection();this.setSelection(o),this.scrollToSelection(o)},u.prototype.removeTreeUI=function(e){delete this.selectedNodes[e.id],r.ModelStructurePanel.prototype.removeTreeUI.call(this,e)},u.prototype.setHidden=function(e,t,n){for(var r=this.tree,i=r.getDelegate(t.id),o=n?function(e){return r.addClass(i,e,"dim",!1),r.removeClass(i,e,"visible",!1),!0}:function(e){return r.removeClass(i,e,"dim",!1),r.addClass(i,e,"visible",!1),!0},s=0;s<e.length;++s)r.iterate(i,e[s],o)},u.prototype.setIsolation=function(e){if(0!==e.length){var t=[];e.length&&this.tree.forEachDelegate(function(n){for(var r=-1,i=0;i<e.length;i++)if(e[i].model===n.model){r=i;break}-1===r&&t.push(n)}.bind(this));for(var n=0;n<e.length;++n){if(s=(a=e[n].model).getData().instanceTree){var r=s.getRootId(),i=(l=this.tree).getDelegate(a.id);l.iterate(i,r,(function(e){return l.removeClass(i,e,"dim",!1),l.removeClass(i,e,"visible",!1),!0}));var o=e[n].ids;if(0!==o.length){if(1===o.length&&o[0]===r)return;this.setHidden([r],a,!0),this.setHidden(o,a,!1)}}}for(n=0;n<t.length;++n){l=this.tree;var s,a=(i=t[n]).model;if(s=i.instanceTree){r=s.getRootId();l.iterate(i,r,(function(e){return l.removeClass(i,e,"dim",!1),l.removeClass(i,e,"visible",!1),!0})),this.setHidden([r],a,!0)}}}else{var l;(l=this.tree).forEachDelegate(function(e){var t=e.model,n=e.instanceTree;if(n){var r=n.getRootId();l.iterate(e,r,(function(t){return l.removeClass(e,t,"dim",!1),l.removeClass(e,t,"visible",!1),!0})),this.setHidden([r],t,!1)}}.bind(this))}},u.prototype.setSelection=function(e){var t,n,r,i,o,s,a,l=this.tree,c=this.viewer.impl.modelQueue();for(var u in this.selectedNodes)if(i=c.findModel(parseInt(u)),o=this.selectedNodes[u],(s=l.getDelegate(u))&&(a=s.instanceTree)){for(n=0;n<o.length;++n)for(r=a.getNodeParentId(o[t]);r;)l.removeClass(s,r,"ancestor-selected"),r=a.getNodeParentId(r);l.clearSelection(s)}for(this.selectedNodes={},t=0;t<e.length;++t)if(i=e[t].model,o=e[t].dbIdArray||e[t].selection,(s=l.getDelegate(i.id))&&(a=s.instanceTree)){for(n=0;n<o.length;++n)for(r=a.getNodeParentId(o[t]);r;)l.addClass(s,r,"ancestor-selected"),r=a.getNodeParentId(r);l.setSelection(s,o),this.selectedNodes[i.id]=o.concat()}},u.prototype.scrollToSelection=function(e){var t=e[0];if(t){var n=t.model,r=t.dbIdArray||t.selection,i=this.tree.scrollTo(r[0],n),o=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=i;var s=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=o,this.options.scrollEaseSpeed>0?this.animateScroll(o,s,function(e){this.tree.setScroll(e)}.bind(this)):(this.scrollContainer.scrollTop=s,this.tree.setScroll(s))}},u.prototype.onEyeIcon=function(e,t){this.viewer.toggleVisibility(e,t)},u.prototype.onTreeNodeClick=function(e,t,n,r){if(this._trackNodeClick&&(a.logger.track({category:"node_selected",name:"model_browser_tool"}),this._trackNodeClick=!1),!this.isMac||!r.ctrlKey){var i="click";this.ctrlDown(r)&&(i+="Ctrl"),r.shiftKey&&(i+="Shift"),r.altKey&&(i+="Alt");var o=["toggleOverlayedSelection"],s=this.clickConfig[i];s&&(o=s.onObject),this.handleAction(o,t,n)}},u.prototype.onTreeNodeRightClick=function(e,t,n,r){return this.isMac&&r.ctrlKey&&0===r.button?(this.clickConfig&&this.clickConfig.clickCtrl&&this.handleAction(this.clickConfig.clickCtrl.onObject,t,n),null):this.viewer.contextMenu.show(r)},u.prototype.handleAction=function(e,t,n){for(var r in e)switch(e[r]){case"toggleOverlayedSelection":this.toggleOverlayedSelection(t,n);break;case"toggleMultipleOverlayedSelection":this.toggleMultipleOverlayedSelection(t,n);break;case"selectOnly":this.viewer.select(t,n);break;case"deselectAll":this.viewer.clearSelection();break;case"selectToggle":this.viewer.toggleSelect(t,n);break;case"isolate":this.isolate(t,n);break;case"showAll":this.viewer.showAll();break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(t,n);break;case"show":this.viewer.show(t,n);break;case"toggleVisibility":this.viewer.toggleVisibility(t,n)}},u.prototype.toggleOverlayedSelection=function(e,t){var n=this.selectedNodes[t.id],r=n?n.indexOf(e):-1;this._ignoreScroll=!0,-1===r?(this.viewer.select(e,t),this.viewer.fitToView([e],t,!1)):this.viewer.select([],void 0,t)},u.prototype.toggleMultipleOverlayedSelection=function(e,t){var n=this.selectedNodes[t.id],r=n?n.indexOf(e):-1;-1===r?(n||(n=this.selectedNodes[t.id]=[]),n.push(e)):n.splice(r,1);var i=[];for(var o in this.selectedNodes)if(this.selectedNodes.hasOwnProperty(o)){t=this.viewer.impl.findModel(parseInt(o));var s=this.selectedNodes[o];i.push({model:t,ids:s})}this._ignoreScroll=!0,this.viewer.impl.selector.setAggregateSelection(i);var a=this.viewer.getAggregateSelection();this.viewer.fitToView(a)},u.prototype.isolate=function(e,t){if(this.viewer.isolate(e,t),this.viewer.fitToView([e],t,!1),t){var n={type:i.SHOW_PROPERTIES_EVENT,dbId:e,model:t};this.viewer.dispatchEvent(n)}},u.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey}},"./src/gui/ViewerObjectContextMenu.js":
/*!********************************************!*\
  !*** ./src/gui/ViewerObjectContextMenu.js ***!
  \********************************************/
/*! exports provided: ViewerObjectContextMenu */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerObjectContextMenu",(function(){return o}));var r=n(/*! ./ObjectContextMenu */"./src/gui/ObjectContextMenu.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js");function o(e){r.ObjectContextMenu.call(this,e)}o.prototype=Object.create(r.ObjectContextMenu.prototype),o.prototype.constructor=o,o.prototype.buildMenu=function(e,t){var n=this;if(this.viewer.model){var r=this,o=[],s=this.viewer.navigation,a=this.viewer.model.is2d();t.hasSelected&&(o.push({title:"Isolate",target:function(){var e=r.viewer.getAggregateSelection();r.viewer.impl.visibilityManager.aggregateIsolate(e),r.viewer.clearSelection(),i.logger.track({name:"isolate_count",aggregate:"count"})}}),t.hasVisible&&o.push({title:"Hide Selected",target:function(){var e=r.viewer.impl.visibilityManager;r.viewer.getAggregateSelection((function(t,n){e.hide(n,t)})),r.viewer.clearSelection()}}),t.hasHidden&&o.push({title:"Show Selected",target:function(){var e=r.viewer.getSelection();r.viewer.clearSelection(),r.viewer.show(e)}})),a&&o.push({title:"Show All Layers",target:function(){r.viewer.setLayerVisible(null,!0)}}),o.push({title:"Show All Objects",target:function(){r.viewer.showAll(),i.logger.track({name:"showall",aggregate:"count"})}});var l=r.viewer.getAggregateSelection();if(!a&&1===l.length&&s.isActionEnabled("gotoview")&&o.push({title:"Focus",target:function(){if((l=r.viewer.getAggregateSelection()).length>0){var e=l[0];r.viewer.fitToView(e.selection,e.model)}else 0===l.length&&r.viewer.fitToView();i.logger.track({name:"fittoview",aggregate:"count"})}}),!a){var c=this.viewer.impl.getCanvasBoundingClientRect(),u=e.clientX-c.left,d=e.clientY-c.top,h=this.viewer.clientToWorld(u,d,!1);h&&o.push({title:"Pivot",target:function(){n.viewer.navigation.setPivotPoint(h.point)}})}return t.hasSelected&&o.push({title:"Clear Selection",target:function(){r.viewer.clearSelection(),i.logger.track({name:"clearselection",aggregate:"count"})}}),o}}},"./src/gui/ViewerPanelMixin.js":
/*!*************************************!*\
  !*** ./src/gui/ViewerPanelMixin.js ***!
  \*************************************/
/*! exports provided: ViewerPanelMixin */function(e,t,n){"use strict";function r(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},n=this.getDocument().getElementsByClassName("toolbar-menu");return n&&n.length>0&&(t=n[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}}n.r(t),n.d(t,"ViewerPanelMixin",(function(){return r}))},"./src/gui/ViewerPropertyPanel.js":
/*!****************************************!*\
  !*** ./src/gui/ViewerPropertyPanel.js ***!
  \****************************************/
/*! exports provided: ViewerPropertyPanel */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerPropertyPanel",(function(){return a}));var r=n(/*! ./PropertyPanel */"./src/gui/PropertyPanel.js"),i=n(/*! ./ViewerPanelMixin */"./src/gui/ViewerPanelMixin.js"),o=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),s=n(/*! ./DockingPanel */"./src/gui/DockingPanel.js");function a(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.currentNodeIds=[],this.currentModel=null,this.isDirty=!0,this.propertyNodeId=null,this.normalTitle="Properties",this.loadingTitle="Object Properties Loading",this._viewDbId=null,this.onProperties=this.onProperties.bind(this),this.onPropError=this.onPropError.bind(this),this.setPropertiesIntoUI=this.setPropertiesIntoUI.bind(this),r.PropertyPanel.call(this,e.container,"ViewerPropertyPanel",this.loadingTitle)}a.prototype=Object.create(r.PropertyPanel.prototype),a.prototype.constructor=a,i.ViewerPanelMixin.call(a.prototype),a.prototype.initialize=function(){r.PropertyPanel.prototype.initialize.call(this);var e=this;e.addEventListener(e.viewer,o.AGGREGATE_SELECTION_CHANGED_EVENT,(function(t){t.selections&&t.selections.length?(e.currentNodeIds=t.selections[0].dbIdArray,e.currentModel=t.selections[0].model):e.resetCurrentModel(),e.isDirty=!0,e.requestProperties()})),e.addEventListener(e.viewer,o.SHOW_PROPERTIES_EVENT,(function(t){t&&t.dbId&&t.model===e.currentModel&&e.requestNodeProperties(t.dbId)})),e.addEventListener(e.viewer,o.HIDE_EVENT,(function(t){e.isDirty=!0,e.requestProperties()})),e.addEventListener(e.viewer,o.OBJECT_TREE_CREATED_EVENT,(function(t){e.currentModel===t.model&&(e.isDirty=!0,e.requestProperties())})),e.addEventListener(e.viewer,o.SHOW_EVENT,(function(t){e.isDirty=!0,e.requestProperties()}));var t=this.viewer.getAggregateSelection();t.length?(this.currentModel=t[0].model,this.currentNodeIds=t[0].selection):this.resetCurrentModel()},a.prototype.resetCurrentModel=function(){var e=this.viewer?this.viewer.getVisibleModels():[];1===e.length?(this.currentModel=e[0],this.currentNodeIds=[]):(this.currentModel=null,this.currentNodeIds=[])},a.prototype.setTitle=function(e,t){e||(e="Object Properties",(t=t||{}).localizeTitle=!0),r.PropertyPanel.prototype.setTitle.call(this,e,t)},a.prototype.setVisible=function(e){s.DockingPanel.prototype.setVisible.call(this,e),this.requestProperties()},a.prototype.visibilityChanged=function(){s.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties(),console.log("尝试执行隐藏事件")},a.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentModel&&this.currentNodeIds.length>0?this.requestNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},a.prototype.onProperties=function(e){var t=this;if(this.viewer&&this.currentModel&&e.dbId===this.propertyNodeId){for(var n=[],r=e.properties,i=0,o=r.length;i<o;++i){var s=r[i];"__internalref__"===s.displayCategory&&n.push(s.displayValue)}var a=this.currentModel;(a.is3d()&&function(e){var t=e.getDocumentNode(),n=t&&t.findViewableParent();return!(!n||-1===n.name().toLocaleLowerCase().indexOf(".sld"))}(a)&&n.length>0?function(e,t,n){return new Promise((function(r,i){e.getBulkProperties2(t,{ignoreHidden:!0},(function(e){for(var t=0,i=e.length;t<i;++t)for(var o=e[t],s=0,a=o.properties.length;s<a;++s){for(var l=o.properties[s],c=!0,u=0,d=n.properties.length;u<d;++u)n.properties[u].displayName===l.displayName&&(c=!1,u=d);c&&n.properties.push(l)}r(n)}))}))}(a,n,e):Promise.resolve(e)).then(this.setPropertiesIntoUI).catch((function(){t.setProperties([]),t.highlight(""),t.resizeToContent(),t.respositionPanel()}))}},a.prototype.setPropertiesIntoUI=function(e){var t=e.name||this.normalTitle,n=!e.name;this.setTitle(t,{localizeTitle:n}),"name"in e&&e.properties&&e.properties.splice(0,0,{displayName:"Name",displayValue:e.name,displayCategory:null,attributeName:"Name",type:20,units:null,hidden:!1,precision:0}),this.setProperties(e.properties),this.highlight(this.viewer.searchText),this.resizeToContent(),this.respositionPanel()},a.prototype.onPropError=function(){this.setTitle(this.normalTitle,{localizeTitle:!0}),this.showNoProperties()},a.prototype.requestNodeProperties=function(e){var t=this,n=this.currentModel;console.log("获取数据"),console.log(e),this.propertyNodeId=e,n.getProperties2(e,(function(e){t.viewer&&n===t.currentModel&&t.onProperties(e)}),this.onPropError)},a.prototype.setNodeProperties=a.prototype.requestNodeProperties,a.prototype.requestViewProperties=function(e){var t=this;if(null===this._viewDbId){var n=this.currentModel,r=n.getRootId();this.propertyNodeId=r,n.getProperties2(r,(function(i){if(console.log(i),t.viewer&&n===t.currentModel){t._viewDbId=r;for(var o=e.name(),s=e.isSheet(),a=i.properties,l=[],c=[],u=0;u<a.length;++u){var d=a[u];"View"===d.displayName&&l.push(d.displayValue),"Sheet"===d.displayName&&c.push(d.displayValue)}var h=s?c:l;if(0!==h.length){var f=t;n.getBulkProperties2(h,{propFilter:["name","dbId"],ignoreHidden:!0},(function(e){for(var t=[],a=0;a<e.length;++a)if(-1!==o.indexOf(e[a].name)){var l=e[a].dbId;if(!s)return f._viewDbId=l,void f.requestNodeProperties(l);t.push(l)}0!==t.length?function(e,t,n){return new Promise((function(r,i){n=n||e.myData.metadata.title,e.getBulkProperties2(t,{ignoreHidden:!0},(function(e){for(var t=0,i=e.length;t<i;++t){var o=e[t];if(o.name&&-1!==n.indexOf(o.name))for(var s=0,a=o.properties.length;s<a;++s){var l=o.properties[s];if("Sheet Number"===l.displayName&&-1!==n.indexOf(l.displayValue))return r(o)}}return r(null)}))}))}(n,t,o).then((function(e){e&&e.dbId&&e.dbId!==r?(f._viewDbId=e.dbId,f.requestNodeProperties(e.dbId)):f.onProperties(i)})):f.onProperties(i)}))}else t.onProperties(i)}}),this.onPropError)}else this.requestNodeProperties(this._viewDbId)},a.prototype.respositionPanel=function(){if(this.isVisible()){var e=this.viewer.toolController,t=e.lastClickX,n=e.lastClickY,r=this.container.getBoundingClientRect(),i=r.left,o=r.top,s=r.width,a=r.height,l=this.viewer.impl.getCanvasBoundingClientRect(),c=l.left,u=l.top,d=l.width,h=l.height;i<=t&&t<i+s&&o<=n&&n<o+a&&(t<i+s/2&&t+s<c+d?(this.container.style.left=Math.round(t-c)+"px",this.container.dockRight=!1):c<=t-s?(this.container.style.left=Math.round(t-c-s)+"px",this.container.dockRight=!1):t+s<c+d?(this.container.style.left=Math.round(t-c)+"px",this.container.dockRight=!1):n+a<u+h?(this.container.style.top=Math.round(n-u)+"px",this.container.dockBottom=!1):u<=n-a&&(this.container.style.top=Math.round(n-u-a)+"px",this.container.dockBottom=!1))}},a.prototype.showDefaultProperties=function(){var e=this.currentModel?this.currentModel.getRootId():null;if(e){var t=this.currentModel.getDocumentNode();t&&!t.isMasterView()?this.requestViewProperties(t):this.requestNodeProperties(e)}else this.propertyNodeId=null,this.setTitle(this.normalTitle,{localizeTitle:!0}),r.PropertyPanel.prototype.showDefaultProperties.call(this)},a.prototype.areDefaultPropertiesShown=function(){if(!this.currentModel)return!1;var e=this.currentModel.getRootId();return this.propertyNodeId===e},a.prototype.uninitialize=function(){r.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null,this._viewDbId=null,this.currentModel=null,this.propertyNodeId=null,this.currentNodeIds=null},a.prototype.onCategoryClick=function(e,t){r.PropertyPanel.prototype.onCategoryClick.call(this,e,t),this.resizeToContent()},a.prototype.onCategoryIconClick=function(e,t){r.PropertyPanel.prototype.onCategoryIconClick.call(this,e,t),this.resizeToContent()}},"./src/gui/ViewerSettingsPanel.css":
/*!*****************************************!*\
  !*** ./src/gui/ViewerSettingsPanel.css ***!
  \*****************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/ViewerSettingsPanel.js":
/*!****************************************!*\
  !*** ./src/gui/ViewerSettingsPanel.js ***!
  \****************************************/
/*! exports provided: ViewerSettingTab, ViewerSettingsPanel */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerSettingTab",(function(){return h})),n.d(t,"ViewerSettingsPanel",(function(){return p}));var r=n(/*! ./SettingsPanel */"./src/gui/SettingsPanel.js"),i=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),o=n(/*! ../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ../application/LightPresets */"./src/application/LightPresets.js"),a=n(/*! ../globalization/i18next */"./src/globalization/i18next.js"),l=n(/*! ../compat */"./src/compat.js"),c=n(/*! ./ViewerPanelMixin */"./src/gui/ViewerPanelMixin.js"),u=n(/*! ./LightPresetThumbnails */"./src/gui/LightPresetThumbnails.js"),d=(Bimfish.Viewing,Bimfish.Viewing.Private),h={Navigation:"navigationtab",Configuration:"performancetab",Appearance:"appearance",Environment:"environment"},f=0;function p(e,t){this.viewer=e,this.is3dMode=!t.is2d(),this.visible=!1,this._externalButtonIds=[],this._externalButtonsLabel=null,r.SettingsPanel.call(this,e.container,"ViewerSettingsPanel"+e.id+"-"+f++,"Settings",{width:400,addFooter:!1,heightAdjustment:110}),this.container.classList.add("viewer-settings-panel"),this.setGlobalManager(e.globalManager),this.addTab(h.Configuration,"Configuration",{className:"performance"}),this.addTab(h.Navigation,"Navigation",{className:"navigation"}),this.addTab(h.Appearance,"Appearance",{className:"appearance"}),this.is3dMode&&this.addTab(h.Environment,"Environment",{className:"environment"}),this.is3dMode||this.container.classList.add("for-2d-model"),this.createRestoreDefaultSettingsButton(),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createConfigurationPanel(),this.createAppearancePanel(),this.modelPreferenceCount&&o.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI."),this.selectTab(h.Configuration),this.footer=this.createFooter(),this.createVersionLabel(this.footer),this.syncUI=this.syncUI.bind(this),e.addEventListener(i.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),e.addEventListener(i.VIEWER_STATE_RESTORED_EVENT,this.syncUI)}function m(e,t,n){e.createThumbnail(n).then((function(e){t.src=e,t.onload=function(){URL.revokeObjectURL(e)}}))}p.prototype=Object.create(r.SettingsPanel.prototype),p.prototype.constructor=p,c.ViewerPanelMixin.call(p.prototype),p.prototype.uninitialize=function(){this.viewer&&(this._onBgEnvironmentChange&&this._onBgEnvironmentReset&&(this.viewer.prefs.removeListeners(d.Prefs3D.LIGHT_PRESET,this._onBgEnvironmentChange,this._onBgEnvironmentReset),this._onBgEnvironmentChange=null,this._onBgEnvironmentReset=null),this.viewer.removeEventListener(i.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),this.viewer.removeEventListener(i.VIEWER_STATE_RESTORED_EVENT,this.syncUI)),this.viewer=null,r.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},p.prototype.setVisible=function(e){this.visible=e,r.SettingsPanel.prototype.setVisible.call(this,e),e&&this.sizeToContent(),e&&this.createEnvironmentPanel()},p.prototype.addCheckbox=function(e,t,n,i,o,s){var a=this.viewer,l=a.prefs[s];i="boolean"==typeof l?l:i;var c=r.SettingsPanel.prototype.addCheckbox.call(this,e,t,i,(function(e){s&&a.prefs.set(s,e),o(e)}),n),u=this.getControl(c);return u.saveKey=s,s?a.prefs.addListeners(s,(function(e){u.setValue(e)}),(function(e){u.setValue(e),o(e)})):u.sliderRow.classList.add("logical-group"),a.prefs.hasTag(s,"no-storage")&&(u.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),c},p.prototype.addDropDownMenu=function(e,t,n,i,o,s,a,l){var c=this.viewer;a&&(o=i.indexOf(c.prefs[a]));var u=r.SettingsPanel.prototype.addDropDownMenu.call(this,e,t,n,o,(function(e){a&&c.prefs.set(a,i[e.detail.value]),s&&s(e)}),l),d=this.getControl(u);return a?c.prefs.addListeners(a,(function(e){d.setSelectedIndex(i.indexOf(e))}),(function(e){d.setSelectedIndex(i.indexOf(e)),s&&s(e)})):d.sliderRow.classList.add("logical-group"),c.prefs.hasTag(a,"no-storage")&&(d.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),u},p.prototype.addSliderV2=function(e,t,n,i,o,s,a,l,c){var u=this.viewer,d=u.prefs[c];s="number"==typeof d?d:s,c&&!u.prefs.hasOwnProperty(c)&&u.prefs.add(c,s,["2d","3d"]);var h=r.SettingsPanel.prototype.addSliderV2.call(this,e,t,n,i,o,s,(function(e){var t="number"==typeof e?e:Number(e.detail.value);c&&u.prefs.set(c,t),a(t)}),l),f=this.getControl(h[1]);return f.saveKey=c,c?u.prefs.addListeners(c,(function(e){f.setValue(e)}),(function(e){f.setValue(e),a(e)})):f.sliderRow.classList.add("logical-group"),u.prefs.hasTag(c,"no-storage")&&(f.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),h},p.prototype.addGrid=function(e,t,n,r,i,o){var s=this,l=t,c=this.getDocument(),d=c.createElement("div");d.classList.add("environments-container"),l.appendChild(d);var h=c.createElement("div");h.classList.add("environments-lighting-table"),d.appendChild(h);var f=new u.LightPresetThumbnails(42,26);f.setGlobalManager(this.viewer.globalManager);for(var p=0;p<n.length;p++){var g=n[p],v=c.createElement("div");v.classList.add("settings-environment-cell"),v.index=p;var y=c.createElement("img");y.classList.add("settings-environment-image"),m(f,y,g),v.appendChild(y);var _=c.createElement("span");_.textContent=a.i18n.translate(g.name),_.classList.add("settings-environment-name"),_.setAttribute("data-i18n",g.name),v.appendChild(_),v.addEventListener("click",(function(){i(this.index)})),h.appendChild(v)}return this._onBgEnvironmentChange=function(){s.updateEnvironmentSelection()},this._onBgEnvironmentReset=function(){i(s.viewer.prefs.lightPreset),s.updateEnvironmentSelection()},this.viewer.prefs.addListeners(o,this._onBgEnvironmentChange,this._onBgEnvironmentReset),this.updateEnvironmentSelection(),h},p.prototype.updateEnvironmentSelection=function(){if(this.is3dMode&&this.envTabCreated)for(var e=this.viewer.prefs.lightPreset,t=this.gridTable.querySelectorAll(".settings-environment-cell"),n=0;n<t.length;n++)t[n].index===e?t[n].classList.add("border-select"):t[n].classList.remove("border-select")},p.prototype.removeCheckbox=function(e){return this.viewer.prefs.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),r.SettingsPanel.prototype.removeCheckbox.call(this,e)},p.prototype.createNavigationPanel=function(){var e=this.viewer,t=h.Navigation,n=e.toolController.getTool("dolly");function r(){return this.addSliderV2(t,"Drag Speed","Changes sensitivity of mouse movement with the zoom tool",5,300,n.getDollyDragScale(),(function(e){n.setDollyDragScale(e)}),{step:5},"zoomDragSpeed")[1]}function i(){return this.addSliderV2(t,"Scroll Speed","Changes sensitivity of the mouse scroll wheel when zooming",.1,3,n.getDollyScrollScale(),(function(e){n.setDollyScrollScale(e)}),{step:.1},"zoomScrollSpeed")[1]}this.is3dMode&&(this.addLabel(t,"ViewCube"),this.addCheckbox(t,"Show ViewCube","Toggles availability of the ViewCube navigation control",!0,(function(t){e.getExtension("Bimfish.ViewCubeUi",(function(e){e.displayViewCube(t)}))}),"viewCube"),Object(l.isMobileDevice)()||this.addCheckbox(t,"ViewCube acts on pivot","When enabled, the ViewCube orbits the view around the active pivot point When disabled, it orbits around the center of the view",!1,(function(t){e.setUsePivotAlways(t)}),"alwaysUsePivot"),this.addLabel(t,"Orbit"),this.addCheckbox(t,"Fusion style orbit","Enables Fusion-style orbit overlay and gives the ability to lock orbit axis",!1,(function(t){t?e.loadExtension("Bimfish.Viewing.FusionOrbit",null):e.unloadExtension("Bimfish.Viewing.FusionOrbit",null)}),"fusionOrbit"),this.addCheckbox(t,"Orbit past world poles","Allows view rotation to continue past the model’s North Pole",!0,(function(t){e.setOrbitPastWorldPoles(t)}),"orbitPastWorldPoles"),this.addLabel(t,"Zoom"),Object(l.isMobileDevice)()||(this.addCheckbox(t,"Zoom towards pivot","When disabled, zooming operations are centered at the current cursor location",!1,(function(t){e.setZoomTowardsPivot(t)}),"zoomTowardsPivot"),this.addCheckbox(t,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,(function(t){e.setReverseZoomDirection(t)}),"reverseMouseZoomDir"),this.scrollSpeed=i.call(this)),this.dragSpeed=r.call(this),this.addLabel(t,"Mouse"),Object(l.isMobileDevice)()||(this.addCheckbox(t,"Left handed mouse setup","Swaps the buttons on the mouse",!1,(function(t){e.setUseLeftHandedInput(t)}),"leftHandedMouseSetup"),this.addCheckbox(t,"Set pivot with left mouse button","Change left-click behavior to set new pivot point (overrides select object)",!1,(function(t){e.setClickToSetCOI(t)}),"clickToSetCOI")),this.addCheckbox(t,"Open properties on select","Always show properties upon selecting object",!0,(function(t){e.prefs.set("openPropertiesOnSelect",t)}),"openPropertiesOnSelect")),this.is3dMode||(this.addLabel(t,"Zoom"),this.addCheckbox(t,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,(function(t){e.setReverseZoomDirection(t)}),"reverseMouseZoomDir"),Object(l.isMobileDevice)()||(this.scrollSpeed=i.call(this)),this.dragSpeed=r.call(this),this.addLabel(t,"Mouse"),this.addCheckbox(t,"Open properties on select","Always show properties upon selecting object",!0,(function(t){e.prefs.set("openPropertiesOnSelect",t)}),"openPropertiesOnSelect"),Object(l.isMobileDevice)()||this.addCheckbox(t,"Left handed mouse setup","Swaps the buttons on the mouse",!1,(function(t){e.setUseLeftHandedInput(t)}),"leftHandedMouseSetup"))},p.prototype.addConfigButton=function(e,t){var n=this;if(!t)throw new Error("Must register a function callback.");this._externalButtonsLabel||(this._externalButtonsLabel=this.addLabel(h.Configuration,"More"));var r=this.addButton(h.Configuration,e);return this.getControl(r).setOnClick((function(){n.setVisible(!1),t()})),this._externalButtonIds.push(r),r},p.prototype.removeConfigButton=function(e){var t=this._externalButtonIds.indexOf(e);if(-1===t)return!1;var n=this.getControl(e);return!!n&&(this.removeControl(n),this._externalButtonIds.splice(t,1),0===this._externalButtonIds.length&&null!==this._externalButtonsLabel&&(this._externalButtonsLabel.removeFromParent(),this._externalButtonsLabel=null),!0)},p.prototype.createConfigurationPanel=function(){var e=this.viewer,t=h.Configuration;this.tablesContainer.childNodes[0];this.is3dMode&&(this.addLabel(t,"Performance Optimization"),this.optimizeNavigationhkBoxId=this.addCheckbox(t,"Smooth navigation","Provides faster response(but degrades quality) while navigating",Object(l.isMobileDevice)(),(function(t){e.setOptimizeNavigation(t)}),"optimizeNavigation"),this.progressiveRenderChkBoxId=this.addCheckbox(t,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,(function(t){e.setProgressiveRendering(t)}),"progressiveRendering"),this.addLabel(t,"Display"),this.ghosthiddenChkBoxId=this.addCheckbox(t,"Ghost hidden objects","Leave hidden objects slightly visible",!0,(function(t){e.setGhosting(t)}),"ghosting"),this.displayLinesId=this.addCheckbox(t,"Display Lines","Toggles display of line objects",!0,(function(t){e.hideLines(!t)}),"lineRendering"),this.displayPointsId=this.addCheckbox(t,"Display Points","Toggles display of point objects",!0,(function(t){e.hidePoints(!t)}),"pointRendering"),this.displayEdgesId=this.addCheckbox(t,"Display edges","Shows outline of model surfaces",!1,(function(t){e.setDisplayEdges(t)}),"edgeRendering"),this._addSelectionModeOption()),this.is3dMode||(this.addLabel(t,"Performance Optimization"),this.progressiveRenderChkBoxId=this.addCheckbox(t,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,(function(t){e.setProgressiveRendering(t)}),"progressiveRendering"))},p.prototype._addSelectionModeOption=function(){var e=h.Configuration;this.addLabel(e,"Selection");var t=[],n=[],r=0;for(var i in Bimfish.Viewing.SelectionMode)t[r]=i,n[r]=Bimfish.Viewing.SelectionMode[i],r++;var o=t.map((function(e){return e.split("_").map((function(e){return e.charAt(0)+e.slice(1).toLowerCase()})).join(" ")}));this.selectionModeId=this.addDropDownMenu(e,"Selection Mode",o,n,null,null,d.Prefs3D.SELECTION_MODE)},p.prototype.createAppearancePanel=function(){var e=this.viewer,t=h.Appearance;this.tablesContainer.childNodes[2];this.is3dMode&&(this.addLabel(t,"Visual Quality Optimization"),this.antialiasingChkBoxId=this.addCheckbox(t,"Anti-aliasing","Remove jagged edges from lines",!0,(function(t){e.setQualityLevel(e.prefs.ambientShadows,t)}),"antialiasing"),this.ambientshadowsChkBoxId=this.addCheckbox(t,"Ambient shadows","Improve shading of occluded surfaces",!0,(function(t){e.setQualityLevel(t,e.prefs.antialiasing)}),"ambientShadows"),this.groundShadowChkBoxId=this.addCheckbox(t,"Ground shadow","Add simulated ground surface shadows",!0,(function(t){e.setGroundShadow(t)}),"groundShadow"),this.groundReflectionChkBoxId=this.addCheckbox(t,"Ground reflection","Add simulated ground surface reflections",!1,(function(t){e.setGroundReflection(t)}),"groundReflection")),this.is3dMode||(this.addLabel(t,"Existing behavior"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(t,"2D Sheet Color","Switch sheet color white to black",!0,(function(t){e.setSwapBlackAndWhite(t)}),"swapBlackAndWhite"))},p.prototype.createEnvironmentPanel=function(){if(this.is3dMode&&!this.envTabCreated){this.envTabCreated=!0;var e=this.viewer,t=h.Environment,n=this.tablesContainer.childNodes[3];this.gridTable=n,this.addLabel(t,"Environment"),this.envMapBackgroundChkBoxId=this.addCheckbox(t,"Environment Image Visible","Shows lighting environment as background",!0,function(t){e.setEnvMapBackground(t)}.bind(this),"envMapBackground");var r=n.tBodies[0].insertRow(-1).insertCell(0),i=this.getDocument();this.caption=i.createElement("div"),this.caption.setAttribute("data-i18n","Environments and Lighting Selection"),this.caption.textContent=a.i18n.translate("Environments and Lighting Selection"),this.caption.classList.add("settings-row-title"),r.appendChild(this.caption),r.colSpan="3",this.envSelect=this.addGrid("Environments and Lighting Selection",n,s.LightPresets,e.impl.currentLightPreset(),(function(t){e.setLightPreset(t)}),d.Prefs3D.LIGHT_PRESET),this.envSelect.classList.add("with-environment")}},p.prototype.createVersionLabel=function(e){if(e){var t=this.getDocument();this.versionDiv=t.createElement("div"),this.versionDiv.textContent=function(){var e=LMV_VIEWER_VERSION;"@"===LMV_VIEWER_VERSION.charAt(0)&&(e="0.0.0");return"v"+e}(),this.versionDiv.className="docking-panel-version-label",e.appendChild(this.versionDiv)}},p.prototype.createRestoreDefaultSettingsButton=function(){var e=this.viewer,t=this.getDocument();this.restoreDiv=t.createElement("div"),this.restoreDiv.classList.add("docking-panel-container-solid-color-b"),this.restoreDiv.classList.add("restore-defaults-container"),this.restoreButton=t.createElement("div"),this.restoreButton.className="docking-panel-tertiary-button",this.restoreButton.setAttribute("data-i18n","Restore all default settings"),this.restoreButton.textContent=Bimfish.Viewing.i18n.translate("Restore all default settings"),this.restoreDiv.appendChild(this.restoreButton),this.addEventListener(this.restoreDiv,"touchstart",l.touchStartToClick),this.addEventListener(this.restoreDiv,"click",(function(){e.restoreDefaultSettings()}),!1),this.scrollContainer.appendChild(this.restoreDiv)},p.prototype.selectTab=function(e){r.SettingsPanel.prototype.selectTab.call(this,e),this.sizeToContent()},p.prototype.sizeToContent=function(){r.SettingsPanel.prototype.sizeToContent.call(this,this.viewer.container)},p.prototype.onViewerResize=function(e,t,n,r,i,o){this.sizeToContent()},p.prototype.syncUI=function(){var e=this.viewer,t=this.viewer.prefs;this.setControlValue(this.antialiasingChkBoxId,t.antialiasing),this.setControlValue(this.ambientshadowsChkBoxId,t.ambientShadows),this.setControlValue(this.groundShadowChkBoxId,t.groundShadow),this.setControlValue(this.groundReflectionChkBoxId,t.groundReflection),this.setControlValue(this.envMapBackgroundChkBoxId,e.impl.isEnvMapBackground()),this.setControlValue(this.progressiveRenderChkBoxId,t.progressiveRendering),this.setControlValue(this.swapBlackAndWhiteChkBoxId,t.swapBlackAndWhite),this.setControlValue(this.ghosthiddenChkBoxId,t.ghosting),this.setControlValue(this.displayLinesId,t.lineRendering),this.setControlValue(this.displayPointsId,t.pointRendering),this.setControlValue(this.displayEdgesId,t.edgeRendering),this.setControlValue(this.scrollSpeed,t.zoomScrollSpeed),this.setControlValue(this.dragSpeed,t.zoomDragSpeed),this.updateEnvironmentSelection()},p.prototype.setControlValue=function(e,t){var n=this.getControl(e);n&&n.setValue(t)}},"./src/gui/browser/browser.css":
/*!*************************************!*\
  !*** ./src/gui/browser/browser.css ***!
  \*************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/browser/browser.js":
/*!************************************!*\
  !*** ./src/gui/browser/browser.js ***!
  \************************************/
/*! exports provided: BrowserDelegate, Browser */function(e,t,n){"use strict";n.r(t),n.d(t,"BrowserDelegate",(function(){return c})),n.d(t,"Browser",(function(){return u}));var r=n(/*! ../../application/Document */"./src/application/Document.js"),i=n(/*! ../../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),o=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ../../compat */"./src/compat.js"),a=Object(s.getGlobal)(),l=a.document;function c(){}function u(e,t,n){this.myDelegate=e,this.mySelectedIds=[];this.myRootContainerId=n+"-browserview",this.idToElement={},this.myRootContainer=l.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add("browserview"),l.getElementById(n).appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)}c.prototype.constructor=c,c.prototype.getNodeId=function(e){throw"getId is not implemented."},c.prototype.getNodeLabel=function(e){return e.name},c.prototype.getNodeClass=function(e){return""},c.prototype.hasThumbnail=function(e){return!1},c.prototype.getThumbnailOptions=function(e){return null},c.prototype.getThumbnail=function(e){return null},c.prototype.onNodeClick=function(e,t,n){},c.prototype.onNodeHover=function(e,t,n){},c.prototype.selectItem=function(e){},c.prototype.deselectItem=function(e){},c.prototype.hasContent=function(e){return!1},c.prototype.addContent=function(e,t){},u.prototype.constructor=u,u.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},u.prototype.getRootContainer=function(){return this.myRootContainer},u.prototype.delegate=function(){return this.myDelegate},u.prototype.addToSelection=function(e){var t=this;function n(e){return-1==t.mySelectedIds.indexOf(e)&&(t.mySelectedIds.push(e),!0)}for(var r=0,i=e.length;r<i;++r){var o=e[r];if(n(o)){var s=t.idToElement[o];void 0===s?t.myDelegate.selectItem(o):s.classList.add("selected")}}},u.prototype.removeFromSelection=function(e){var t=this;function n(e){var n=t.mySelectedIds.indexOf(e);return-1!=n&&(t.mySelectedIds.splice(n,1),!0)}for(var r=e.length-1;r>=0;--r){var i=e[r];if(n(i)){var o=this.idToElement[i];void 0===o?t.myDelegate.deselectItem(i):o.classList.remove("selected")}}},u.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},u.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},u.prototype.createElements=function(e,t){if(e)for(var n=0;n<e.length;n++){var r=e[n];this.createElement(r,t)}},u.prototype.createElement=function(e,t){var n=this,s=n.myDelegate.getNodeId(e),c=l.createElement("item");t.appendChild(c),this.idToElement[s]=c,c.onmouseover=function(){n.myDelegate.onNodeHover(n,e)},c.onclick=function(t){n.myRootContainer.querySelector(".flipped").removeClass("flipped"),n.myDelegate.onNodeClick(n,e,t)};var u=l.createElement("div");u.classList.add("card"),c.appendChild(u);var d=l.createElement("div");d.classList.add("browserElement"),u.appendChild(d);var h=n.myDelegate.getNodeLabel(e),f=l.createElement("label");f.innerHTML=h,d.appendChild(f),f.onclick=function(t){n.myDelegate.onNodeClick(n,e,t)};var p=n.myDelegate.getThumbnail(e);if(p){var m=l.createElement("img");m.classList.add("thumb");var g=n.myDelegate.getThumbnailOptions(e);r.Document.requestThumbnailWithSecurity(g,(function(e,t){e?o.logger.error("Failed to load thumbnail: "+p,Object(i.errorCodeString)(i.ErrorCodes.NETWORK_FAILURE)):(m.src=a.URL.createObjectURL(t),m.onload=function(){a.URL.revokeObjectURL(m.src)})})),d.appendChild(m),m.onclick=function(t){n.myDelegate.onNodeClick(n,e,t)}}n.myDelegate.hasContent(e)&&n.myDelegate.addContent(e,u),c.classList.add(n.myDelegate.getNodeClass(e))}},"./src/gui/controls/Button.css":
/*!*************************************!*\
  !*** ./src/gui/controls/Button.css ***!
  \*************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/Button.js":
/*!************************************!*\
  !*** ./src/gui/controls/Button.js ***!
  \************************************/
/*! exports provided: Button */function(e,t,n){"use strict";n.r(t),n.d(t,"Button",(function(){return a}));var r,i,o=n(/*! ./Control */"./src/gui/controls/Control.js"),s=n(/*! ../../compat */"./src/compat.js");function a(e,t){o.Control.call(this,e,t);var n=this;this._state=a.State.INACTIVE;var r=this.getDocument();this.icon=r.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",(function(e){n.getState()!==a.State.DISABLED&&(n.dispatchEvent(a.Event.CLICK),n.onClick&&n.onClick(e)),e.stopPropagation()})),Object(s.isTouchDevice)()?this.container.addEventListener("touchstart",s.touchStartToClick):(this.container.addEventListener("mouseover",(function(e){n.onMouseOver(e)})),this.container.addEventListener("mouseout",(function(e){n.onMouseOut(e)}))),this.addClass("adsk-button"),this.addClass(a.StateToClassMap[this._state])}a.Event={VISIBILITY_CHANGED:o.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:o.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},a.State={ACTIVE:0,INACTIVE:1,DISABLED:2},a.StateToClassMap=(r=a.State,(i={})[r.ACTIVE]="active",i[r.INACTIVE]="inactive",i[r.DISABLED]="disabled",i),a.prototype=Object.create(o.Control.prototype),a.prototype.constructor=a,a.prototype.setState=function(e){if(e===this._state)return!1;this.removeClass(a.StateToClassMap[this._state]),this.addClass(a.StateToClassMap[e]),this._state=e;var t={type:a.Event.STATE_CHANGED,state:e};return this.dispatchEvent(t),!0},a.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},a.prototype.getState=function(){return this._state},a.prototype.onClick=function(e){},a.prototype.onMouseOver=function(e){},a.prototype.onMouseOut=function(e){}},"./src/gui/controls/ComboButton.css":
/*!******************************************!*\
  !*** ./src/gui/controls/ComboButton.css ***!
  \******************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/ComboButton.js":
/*!*****************************************!*\
  !*** ./src/gui/controls/ComboButton.js ***!
  \*****************************************/
/*! exports provided: ComboButton */function(e,t,n){"use strict";n.r(t),n.d(t,"ComboButton",(function(){return s}));var r=n(/*! ./Button */"./src/gui/controls/Button.js"),i=n(/*! ./RadioButtonGroup */"./src/gui/controls/RadioButtonGroup.js"),o=n(/*! ../../globals */"./src/globals.js");function s(e,t){r.Button.call(this,e,t),this.arrowButton=new r.Button(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new i.RadioButtonGroup(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var n=this;this.arrowButton.onClick=function(e){n.subMenu.setVisible(!n.subMenu.isVisible())},this.toggleFlyoutVisible=function(){n.subMenu.setVisible(!n.subMenu.isVisible())},this.onClick=function(e){n.subMenu.setVisible(!n.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(n.setIcon(e.target.getActiveButton().iconClass),n.setToolTip(e.target.getActiveButton().getToolTip()),n.setState(r.Button.State.ACTIVE),n.onClick=e.button.onClick):n.setState(r.Button.State.INACTIVE)},this.subMenu.addEventListener(i.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var s=Object(o.stringToDOM)('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(s,this.subMenu.container.firstChild),s.addEventListener("click",(function(e){n.subMenu.setVisible(!1),e.stopPropagation()}))}s.prototype=Object.create(r.Button.prototype),s.prototype.constructor=s,s.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(r.Button.Event.CLICK,this.toggleFlyoutVisible)},s.prototype.removeControl=function(e){e.removeEventListener(r.Button.Event.CLICK,this.toggleFlyoutVisible)},s.prototype.setState=function(e){if(e===r.Button.State.INACTIVE){var t=this.subMenu.getActiveButton();t&&t.setState(r.Button.State.INACTIVE)}r.Button.prototype.setState.call(this,e)},s.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},s.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(r.Button.State.INACTIVE))}},"./src/gui/controls/Control.css":
/*!**************************************!*\
  !*** ./src/gui/controls/Control.css ***!
  \**************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/Control.js":
/*!*************************************!*\
  !*** ./src/gui/controls/Control.js ***!
  \*************************************/
/*! exports provided: Control */function(e,t,n){"use strict";n.r(t),n.d(t,"Control",(function(){return i}));var r=n(/*! ../../application/EventDispatcher */"./src/application/EventDispatcher.js");function i(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=this.getDocument().createElement("div"),this.container.id=e,this.addClass("adsk-control")}n(/*! ../../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(i.prototype),i.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},r.EventDispatcher.prototype.apply(i.prototype),i.prototype.constructor=i,i.prototype.container=null,i.prototype.getId=function(){return this._id},i.prototype.setVisible=function(e){if(!this.container.classList.contains("adsk-hidden")===e)return!1;e?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var t={type:i.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:e};return this.dispatchEvent(t),!0},i.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},i.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=this.getDocument().createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Bimfish.Viewing.i18n.translate(e,{defaultValue:e}),!0)},i.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},i.prototype.setCollapsed=function(e){if(!this._isCollapsible||this.isCollapsed()===e)return!1;e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var t={type:i.Event.COLLAPSED_CHANGED,isCollapsed:e};return this.dispatchEvent(t),!0},i.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},i.prototype.isCollapsible=function(){return this._isCollapsible},i.prototype.addClass=function(e){this.container.classList.add(e)},i.prototype.removeClass=function(e){this.container.classList.remove(e)},i.prototype.getPosition=function(){var e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}},i.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect();return{width:e.width,height:e.height}},i.prototype.setDisplay=function(e){this.container.style.display=e},i.prototype.removeFromParent=function(){return!!this.parent&&this.parent.removeControl(this)}},"./src/gui/controls/ControlGroup.css":
/*!*******************************************!*\
  !*** ./src/gui/controls/ControlGroup.css ***!
  \*******************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/ControlGroup.js":
/*!******************************************!*\
  !*** ./src/gui/controls/ControlGroup.js ***!
  \******************************************/
/*! exports provided: ControlGroup */function(e,t,n){"use strict";n.r(t),n.d(t,"ControlGroup",(function(){return i}));var r=n(/*! ./Control */"./src/gui/controls/Control.js");function i(e,t){r.Control.call(this,e,t);var n=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(e){var t={type:i.Event.SIZE_CHANGED,childEvent:e};n.dispatchEvent(t)}}i.Event={VISIBILITY_CHANGED:r.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:r.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},i.prototype=Object.create(r.Control.prototype),i.prototype.constructor=i,i.prototype.addControl=function(e,t){e.setGlobalManager(this.globalManager);var n=t&&void 0!==t.index?t.index:this._controls.length;if(null!==this.getControl(e.getId()))return!1;var o={type:i.Event.CONTROL_ADDED,control:e,index:n};return n<this._controls.length?(this.container.insertBefore(e.container,this._controls[n].container),this._controls.splice(n,0,e)):(this.container.appendChild(e.container),this._controls.push(e)),e.addEventListener(r.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),e.addEventListener(r.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),e instanceof i&&e.addEventListener(i.Event.SIZE_CHANGED,this.handleChildSizeChanged),e.parent=this,this.dispatchEvent(o),this.dispatchEvent(i.Event.SIZE_CHANGED),!0},i.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var n=this._controls[t];if(n===e||"string"==typeof e&&e===n.getId())return t}return-1},i.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;if(!t)return!1;var n=this._controls.indexOf(t);if(-1===n)return!1;this._controls.splice(n,1),this.container.removeChild(t.container);var o={type:i.Event.CONTROL_REMOVED,control:t,index:n};return t.removeEventListener(r.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),t.removeEventListener(r.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),t instanceof i&&t.removeEventListener(i.Event.SIZE_CHANGED,this.handleChildSizeChanged),t.parent=void 0,this.dispatchEvent(o),this.dispatchEvent(i.Event.SIZE_CHANGED),!0},i.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t];return null},i.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},i.prototype.getNumberOfControls=function(){return this._controls.length},i.prototype.setCollapsed=function(e){if(!this._isCollapsible)return!1;var t=!1;return this._controls.forEach((function(n){n.isCollapsible()&&n.setCollapsed(e)&&(t=!0)})),t&&(e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.dispatchEvent({type:i.Event.COLLAPSED_CHANGED,isCollapsed:e})),t}},"./src/gui/controls/Filterbox.css":
/*!****************************************!*\
  !*** ./src/gui/controls/Filterbox.css ***!
  \****************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/Filterbox.js":
/*!***************************************!*\
  !*** ./src/gui/controls/Filterbox.js ***!
  \***************************************/
/*! exports provided: Filterbox */function(e,t,n){"use strict";n.r(t),n.d(t,"Filterbox",(function(){return o}));var r=n(/*! ./Control */"./src/gui/controls/Control.js"),i=n(/*! ../../globalization/i18next */"./src/globalization/i18next.js");function o(e,t){this._id=e,this._listeners={},this._options=t||{},this._filterFunction=this._options.filterFunction||function(){};var n=this.getDocument();this.container=n.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-filterbox"),this.addClass("empty");var r=n.createElement("input");r.classList.add("filter-box"),r.classList.add("docking-panel-delimiter-shadow"),r.type="search",r.placeholder=i.i18n.translate("Enter filter term"),r.setAttribute("data-i18n","Enter filter term"),r.incremental="incremental",r.autosave=this.container.id+"filter",this.container.appendChild(r),this.filterbox=r;var o=this,s=function(e){0===(e=e.trim()).length?o.container.classList.add("empty"):o.container.classList.remove("empty"),o._filterFunction&&o._filterFunction(e)},a=n.createElement("div");a.className="filter-box-icon",this.container.insertBefore(a,r.nextSibling);var l=n.createElement("div");l.className="filter-box-close",l.addEventListener("click",(function(){o.filterbox.value="",o.addClass("empty")})),this.container.appendChild(l),r.addEventListener("keydown",(function(e){var t=o.getWindow();13===(e=e||t.event).keyCode&&o.filterbox.blur()})),r.addEventListener("input",(function(e){s(this.value)})),r.addEventListener("change",(function(e){s(this.value)})),r.addEventListener("focus",(function(){a.classList.add("focused")})),r.addEventListener("blur",(function(){a.classList.remove("focused")}))}o.prototype=Object.create(r.Control.prototype),o.prototype.constructor=o},"./src/gui/controls/RadioButtonGroup.js":
/*!**********************************************!*\
  !*** ./src/gui/controls/RadioButtonGroup.js ***!
  \**********************************************/
/*! exports provided: RadioButtonGroup */function(e,t,n){"use strict";n.r(t),n.d(t,"RadioButtonGroup",(function(){return s}));var r=n(/*! ./ControlGroup */"./src/gui/controls/ControlGroup.js"),i=n(/*! ./Button */"./src/gui/controls/Button.js"),o=n(/*! ./Control */"./src/gui/controls/Control.js");function s(e,t){r.ControlGroup.call(this,e,t);var n=this;this._activeButton=null,this._handleButtonStateChange=function(e){var t=i.Button.State;e.state===t.ACTIVE?(n._activeButton=e.target,n.dispatchEvent({type:s.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!0}),n._controls.forEach((function(n){n!==e.target&&n.getState()!==t.DISABLED&&n.setState(t.INACTIVE)}))):e.target===n._activeButton&&(n._activeButton=null,n.dispatchEvent({type:s.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!1}))}}s.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:o.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:o.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:r.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:r.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:r.ControlGroup.Event.SIZE_CHANGED},s.prototype=Object.create(r.ControlGroup.prototype),s.prototype.constructor=s,s.prototype.addControl=function(e,t){return e instanceof i.Button&&(!!r.ControlGroup.prototype.addControl.call(this,e,t)&&(e.addEventListener(i.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},s.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;return!(null===t||!r.ControlGroup.prototype.removeControl.call(this,t))&&(t.removeEventListener(i.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},s.prototype.getActiveButton=function(){return this._activeButton}},"./src/gui/controls/SearchEvents.js":
/*!******************************************!*\
  !*** ./src/gui/controls/SearchEvents.js ***!
  \******************************************/
/*! exports provided: ON_SEARCH_SELECTED */function(e,t,n){"use strict";n.r(t),n.d(t,"ON_SEARCH_SELECTED",(function(){return r}));var r="search-selected"},"./src/gui/controls/SearchResults.css":
/*!********************************************!*\
  !*** ./src/gui/controls/SearchResults.css ***!
  \********************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/SearchResults.js":
/*!*******************************************!*\
  !*** ./src/gui/controls/SearchResults.js ***!
  \*******************************************/
/*! exports provided: SearchResults */function(e,t,n){"use strict";n.r(t),n.d(t,"SearchResults",(function(){return a}));var r=n(/*! ../../application/EventDispatcher */"./src/application/EventDispatcher.js"),i=n(/*! ./SearchEvents */"./src/gui/controls/SearchEvents.js"),o=n(/*! ../CommonWidgets */"./src/gui/CommonWidgets.js"),s=n(/*! ../../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function a(e,t,n){this.excludeRoot=t,this.viewer=n,this.results=[],this.resultCount=0,this.selectedIndex=-1;var r=this.getDocument();this.container=r.createElement("div"),this.container.classList.add("docking-panel"),this.container.classList.add("adsk-search-results"),this.container.results=r.createElement("div"),this.container.results.classList.add("docking-panel-scroll"),this.container.results.classList.add("docking-panel-container-solid-color-b"),this.container.results.addEventListener("scroll",c.bind(this)),this.container.appendChild(this.container.results),e.insertBefore(this.container,e.firstChild),this.scrollingContainer=r.createElement("div"),this.scrollingContainer.classList.add("adsk-search-results-scrolling-panel"),this.scrollingContainer.addEventListener("click",l.bind(this)),this.container.results.appendChild(this.scrollingContainer),this.footer=new o.ResizeFooter(this.container,function(){var e=this.container.getBoundingClientRect(),t=this.viewer.container.getBoundingClientRect();t.right<e.right&&(this.container.style.width=t.right-e.left+"px"),t.bottom<e.bottom&&(this.container.style.height=t.bottom-e.top+"px")}.bind(this)),this.footer.setGlobalManager(this.globalManager),this.divNoResults=function(e){var t=e.createElement("div"),n=e.createElement("div"),r=e.createElement("div");t.classList.add("no-results-container"),t.style.display="none";n.setAttribute("data-i18n","No Results"),n.textContent=Bimfish.Viewing.i18n.translate("No Results"),n.classList.add("no-results-title");return r.setAttribute("data-i18n","Try another term"),r.textContent=Bimfish.Viewing.i18n.translate("Try another term"),r.classList.add("no-results-description"),t.appendChild(n),t.appendChild(r),t.domTitle=n,t.domMessage=r,t}(r),this.scrollingContainer.appendChild(this.divNoResults),this.scrollY=0,this.dirty=!1,this.nextFrameId=0,this.it={init:function(e){return this.isDone=!1,this.results=e,this.indexRs=0,this.indexId=-1,this},done:function(){return this.isDone},next:function(){if(this.isDone)return this;for(this.indexId++;this.results.length!==this.indexRs&&this.indexId===this.results[this.indexRs].ids.length;)this.indexId=0,this.indexRs++;return this.isDone=this.indexRs===this.results.length,this},id:function(){return this.results[this.indexRs].ids[this.indexId]},delegate:function(){return this.results[this.indexRs].delegate}},this.elementsPool=[],this.elementsUsed=0;for(var i=0;i<150;++i)this.elementsPool[i]=f(r);this.setVisible(!1)}function l(e){var t=e.target,n=this._getNodeAndModelIds(t);n&&(console.log(n),this.fireEvent({type:i.ON_SEARCH_SELECTED,id:n.nodeId,modelId:n.modelId}),e.preventDefault())}function c(e){var t=this.container.results.scrollTop;Math.abs(this.scrollY-t)>=100&&(this.scrollY=t,u(this))}function u(e,t){e.dirty&&!t||(t?d(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame((function(){d(e)}))))}function d(e){e.dirty=!1,function(e){for(var t=e.elementsUsed,n=e.elementsPool,r=0;r<t;++r){p(n[r])}e.elementsUsed=0}(e),0!==e.resultCount?(e.setDisplayNoResults(!1),function(e){var t=e.container.results,n=0,r=t.clientHeight,i=e.scrollY,o=e.it.init(e.results),s=Math.max(0,e.scrollY-100),a=0|Math.floor(s/50),l=0;n=50*a;for(;a;)a--,l++,o.next();var c=e.elementsPool[e.elementsUsed++];c.style.height=n+"px",e.scrollingContainer.appendChild(c);var u=!0;for(;u;){if(o.next(),o.done()){u=!1;break}if(n>i+r+100){u=!1;break}if(e.elementsUsed===e.elementsPool.length){u=!1;break}var d=o.id(),f=o.delegate(),p=n+50,m=e.elementsPool[e.elementsUsed++];h(d,f,m,e,l===e.selectedIndex),e.scrollingContainer.appendChild(m),n=p,l++}var g=50*e.resultCount;e.scrollingContainer.style.height=g+"px"}(e)):e.setDisplayNoResults(!0)}function h(e,t,n,r,i){n.classList.add("search-result"),i?n.classList.add("selected"):n.classList.remove("selected"),n.setAttribute("lmv-nodeId",e),n.setAttribute("lmv-modelId",t.model.id),n.style.height="50px";var o=t.instanceTree.getNodeName(e),s=r.searchString,a=o.toLowerCase().indexOf(s.toLowerCase()),l=o.substr(0,a),c=o.substr(a,s.length),u=o.substr(a+s.length);n.domPrefix.innerText=l,n.domMatch.innerText=c,n.domSufix.innerText=u;var d=function(e,t,n){var r=[],i=t.getRootId(),o=n.isRootExcluded(),s=t.instanceTree,a=e,l=!1;for(;a&&!l&&(a!==i||(l=!0,!o));){var c=s.getNodeName(a);r.unshift(c),a=s.getNodeParentId(a)}return r}(e,t,r);n.domPath.innerText=d.join(" > ")}function f(e){var t=e.createElement("div"),n=e.createElement("div"),r=e.createElement("span"),i=e.createElement("span"),o=e.createElement("span"),s=e.createElement("span");return n.classList.add("search-result-container"),i.classList.add("search-match"),s.classList.add("search-path"),n.appendChild(r),n.appendChild(i),n.appendChild(o),n.appendChild(s),t.appendChild(n),t.domPrefix=r,t.domMatch=i,t.domSufix=o,t.domPath=s,t.domContainer=n,t}function p(e){e.setAttribute("lmv-nodeId",""),e.setAttribute("lmv-modelId",""),e.domPrefix.innerText="",e.domMatch.innerText="",e.domSufix.innerText="",e.domPath.innerText="",e.style.height="0"}function m(e,t){e.scrollTop+e.clientHeight<50*(t+1)&&(e.scrollTop+=50*(t+1)-(e.scrollTop+e.clientHeight)),e.scrollTop/50>t&&(e.scrollTop=50*t)}a.prototype.constructor=a,r.EventDispatcher.prototype.apply(a.prototype),s.GlobalManagerMixin.call(a.prototype),a.prototype.setPosition=function(e,t){this.container.style.left=e+"px",this.container.style.top=t+"px"},a.prototype.setMinWidth=function(e){this.container.style.width=e+"px"},a.prototype.setMaxWidth=function(e){this.container.style.maxHeight=e+"px"},a.prototype.setVisible=function(e){this.container.style.display=e?"":"none"},a.prototype.setResults=function(e,t){this.searchString=e,this.results=t,this.resultCount=function(e){for(var t=0,n=0;n<e.length;++n){var r=e[n];t+=r.ids.length}return t}(t),this.selectedIndex=0==this.resultCount?-1:0,this.container.style.height=50*this.resultCount+20+"px",this.container.results.scrollTop=0,this.scrollY=0,0===this.resultCount?this.container.classList.add("no-content"):this.container.classList.remove("no-content"),u(this)},a.prototype.getSelection=function(){var e=this.scrollingContainer.querySelector(".selected");if(!e)return null;var t=this._getNodeAndModelIds(e);return t||null},a.prototype.isRootExcluded=function(){return!(this.results&&this.results.length>1)&&(!(this.modelCount>1)&&this.excludeRoot)},a.prototype.uninitialize=function(){this.setVisible(!1),this.container=null,this.container.parentNode&&this.container.parentNode.removeChild(this.container),cancelAnimationFrame(this.nextFrameId),this.clearListeners()},a.prototype.setDisplayNoResults=function(e){this.divNoResults.style.display=e?"":"none"},a.prototype.selectNext=function(){0!==this.resultCount&&(this.selectedIndex=Math.min(this.resultCount-1,this.selectedIndex+1),m(this.container.results,this.selectedIndex),u(this))},a.prototype.selectPrevious=function(){0!==this.resultCount&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),m(this.container.results,this.selectedIndex),u(this))},a.prototype._getNodeAndModelIds=function(e){for(;!e.hasAttribute("lmv-nodeId");)if(!(e=e.parentNode)||e===this.scrollingContainer)return;return{nodeId:parseInt(e.getAttribute("lmv-nodeId")),modelId:parseInt(e.getAttribute("lmv-modelId"))}}},"./src/gui/controls/Searchbox.css":
/*!****************************************!*\
  !*** ./src/gui/controls/Searchbox.css ***!
  \****************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/controls/Searchbox.js":
/*!***************************************!*\
  !*** ./src/gui/controls/Searchbox.js ***!
  \***************************************/
/*! exports provided: Searchbox */function(e,t,n){"use strict";n.r(t),n.d(t,"Searchbox",(function(){return l}));var r=n(/*! ./Control */"./src/gui/controls/Control.js"),i=n(/*! ./SearchEvents */"./src/gui/controls/SearchEvents.js"),o=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ./SearchResults */"./src/gui/controls/SearchResults.js"),a=n(/*! ../../globalization/i18next */"./src/globalization/i18next.js");function l(e,t,n){this._id=e,this._listeners={},this._options=n||{},this._searchFunction=this._options.searchFunction||function(){};var r=this.getDocument();this.container=r.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-searchbox"),this.addClass("empty");var c=r.createElement("input");c.classList.add("search-box"),c.classList.add("docking-panel-delimiter-shadow"),c.type="search",c.results=[],c.placeholder=a.i18n.translate("Search"),c.setAttribute("data-i18n","Search"),c.incremental="incremental",c.autosave=this.container.id+"search_autosave",this.container.insertBefore(c,this.scrollContainer),this.searchbox=c;var u=function(){p.searchbox.value="",p.addClass("empty")},d=function(){p.searchbox.classList.remove("searching"),p.searchResults.setVisible(!1)},h=r.createElement("div");h.className="search-box-icon",this.container.insertBefore(h,c.nextSibling);var f=r.createElement("div");f.className="search-box-close",f.addEventListener("click",(function(){u(),d()})),this.container.appendChild(f),this.searchResults=new s.SearchResults(this.container,n.excludeRoot,t),this.searchResults.addEventListener(i.ON_SEARCH_SELECTED,(function(e){u(),d(),console.log("点击执行这里"),console.log(e),p.fireEvent(e)}));var p=this,m=!0;function g(){var e=c.value.trim();if(0!==e.length){m&&(o.logger.track({category:"search_node",name:"model_browser_tool"}),m=!1),c.classList.add("searching");var t=p._searchFunction(e);p.searchResults.setResults(e,t),p.searchResults.setVisible(!0)}else d()}var v;c.addEventListener("keydown",(function(e){var t=p.getWindow();if(38===(e=e||t.event).keyCode&&(p.searchResults.selectPrevious(),e.preventDefault()),40===e.keyCode&&(p.searchResults.selectNext(),e.preventDefault()),13===e.keyCode){var n=p.searchResults.getSelection();if(!n)return!1;u(),d(),p.fireEvent({type:l.Events.ON_SEARCH_SELECTED,id:n.nodeId,modelId:n.modelId}),e.preventDefault()}})),c.addEventListener("input",(function(e){if(0===this.value.length)return p.container.classList.add("empty"),void d();p.container.classList.remove("empty"),this.value.length<3||(clearTimeout(v),v=setTimeout(g,800))})),c.addEventListener("change",(function(e){var t=p.getDocument();e.target===t.activeElement&&(clearTimeout(v),g())})),c.addEventListener("focus",(function(){h.classList.add("focused")})),c.addEventListener("blur",(function(){h.classList.remove("focused")}))}l.prototype=Object.create(r.Control.prototype),l.prototype.constructor=l,l.Events={ON_SEARCH_SELECTED:i.ON_SEARCH_SELECTED}},"./src/gui/icon-fonts/codes.css":
/*!**************************************!*\
  !*** ./src/gui/icon-fonts/codes.css ***!
  \**************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/icon-fonts/header.css":
/*!***************************************!*\
  !*** ./src/gui/icon-fonts/header.css ***!
  \***************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/themes/BimTheme.css":
/*!*************************************!*\
  !*** ./src/gui/themes/BimTheme.css ***!
  \*************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/themes/DarkTheme.css":
/*!**************************************!*\
  !*** ./src/gui/themes/DarkTheme.css ***!
  \**************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/themes/DarkThemeHyperlink.css":
/*!***********************************************!*\
  !*** ./src/gui/themes/DarkThemeHyperlink.css ***!
  \***********************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/themes/Fonts.css":
/*!**********************************!*\
  !*** ./src/gui/themes/Fonts.css ***!
  \**********************************/
/*! no static exports found */function(e,t,n){},"./src/gui/themes/LightTheme.css":
/*!***************************************!*\
  !*** ./src/gui/themes/LightTheme.css ***!
  \***************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/themes/LightThemeHyperlink.css":
/*!************************************************!*\
  !*** ./src/gui/themes/LightThemeHyperlink.css ***!
  \************************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/toolbar/ToolBar.css":
/*!*************************************!*\
  !*** ./src/gui/toolbar/ToolBar.css ***!
  \*************************************/
/*! no static exports found */function(e,t,n){},"./src/gui/toolbar/ToolBar.js":
/*!************************************!*\
  !*** ./src/gui/toolbar/ToolBar.js ***!
  \************************************/
/*! exports provided: ToolBar */function(e,t,n){"use strict";n.r(t),n.d(t,"ToolBar",(function(){return o}));var r=n(/*! ../controls/ControlGroup */"./src/gui/controls/ControlGroup.js"),i=n(/*! ../controls/Control */"./src/gui/controls/Control.js");function o(e,t){r.ControlGroup.call(this,e,t),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar"),t&&t.alignVertically&&this.addClass("adsk-toolbar-vertical")}o.Event={VISIBILITY_CHANGED:i.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:i.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:r.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:r.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:r.ControlGroup.Event.SIZE_CHANGED},o.prototype=Object.create(r.ControlGroup.prototype),o.prototype.constructor=o},"./src/index-css.js":
/*!**************************!*\
  !*** ./src/index-css.js ***!
  \**************************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);n(/*! ./gui/themes/DarkTheme.css */"./src/gui/themes/DarkTheme.css"),n(/*! ./gui/themes/DarkThemeHyperlink.css */"./src/gui/themes/DarkThemeHyperlink.css"),n(/*! ./gui/themes/Fonts.css */"./src/gui/themes/Fonts.css"),n(/*! ./gui/themes/LightTheme.css */"./src/gui/themes/LightTheme.css"),n(/*! ./gui/themes/LightThemeHyperlink.css */"./src/gui/themes/LightThemeHyperlink.css"),n(/*! ./gui/themes/BimTheme.css */"./src/gui/themes/BimTheme.css"),n(/*! ./gui/icon-fonts/header.css */"./src/gui/icon-fonts/header.css"),n(/*! ./gui/icon-fonts/codes.css */"./src/gui/icon-fonts/codes.css"),n(/*! ./gui/LoadingSpinner.css */"./src/gui/LoadingSpinner.css"),n(/*! ./gui/AlertBox.css */"./src/gui/AlertBox.css"),n(/*! ./gui/HudMessage.css */"./src/gui/HudMessage.css"),n(/*! ./gui/ContextMenu.css */"./src/gui/ContextMenu.css"),n(/*! ./gui/Panel.css */"./src/gui/Panel.css"),n(/*! ./gui/ProgressBar.css */"./src/gui/ProgressBar.css"),n(/*! ./gui/Tree.css */"./src/gui/Tree.css"),n(/*! ./gui/TreeOnDemand.css */"./src/gui/TreeOnDemand.css"),n(/*! ./gui/DockingPanel.css */"./src/gui/DockingPanel.css"),n(/*! ./gui/ModelStructurePanel.css */"./src/gui/ModelStructurePanel.css"),n(/*! ./gui/ModelStructureTreeDelegate.css */"./src/gui/ModelStructureTreeDelegate.css"),n(/*! ./gui/PropertyPanel.css */"./src/gui/PropertyPanel.css"),n(/*! ./gui/SettingsPanel.css */"./src/gui/SettingsPanel.css"),n(/*! ./gui/ViewerModelStructurePanel.css */"./src/gui/ViewerModelStructurePanel.css"),n(/*! ./gui/ViewerSettingsPanel.css */"./src/gui/ViewerSettingsPanel.css"),n(/*! ./gui/toolbar/ToolBar.css */"./src/gui/toolbar/ToolBar.css"),n(/*! ./gui/controls/Control.css */"./src/gui/controls/Control.css"),n(/*! ./gui/controls/ControlGroup.css */"./src/gui/controls/ControlGroup.css"),n(/*! ./gui/controls/Button.css */"./src/gui/controls/Button.css"),n(/*! ./gui/controls/ComboButton.css */"./src/gui/controls/ComboButton.css"),n(/*! ./gui/controls/Searchbox.css */"./src/gui/controls/Searchbox.css"),n(/*! ./gui/controls/Filterbox.css */"./src/gui/controls/Filterbox.css"),n(/*! ./gui/controls/SearchResults.css */"./src/gui/controls/SearchResults.css"),n(/*! ./gui/browser/browser.css */"./src/gui/browser/browser.css"),n(/*! ./application/Viewer3D.css */"./src/application/Viewer3D.css"),n(/*! ./gui/GuiViewer3D.css */"./src/gui/GuiViewer3D.css"),n(/*! ./gui/CommonWidgets.css */"./src/gui/CommonWidgets.css")},"./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no static exports found */function(e,t,n){function r(t,n){for(var r in t)t.hasOwnProperty(r)&&(e.exports[r]=t[r],n&&(e.exports[n][r]=t[r]))}e.exports.Bimfish=n(/*! ./module-prefix */"./src/module-prefix.js").Bimfish;var i=Object.assign||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};e.exports.THREE=n(/*! three */"./thirdparty/three.js/three.js"),e.exports.av={},e.exports.avp={},e.exports.avu={},e.exports.ave={},r({Hammer:n(/*! ../thirdparty/hammer/hammer.js */"./thirdparty/hammer/hammer.js")},"av"),r(n(/*! ./compat */"./src/compat.js"),"av"),r(n(/*! ./compat */"./src/compat.js"),"avp"),r(n(/*! ./globals */"./src/globals.js"),"avp"),r(n(/*! ./globals */"./src/globals.js"),"av"),r(n(/*! ./envinit */"./src/envinit.js"),"avp"),r(n(/*! ./envinit */"./src/envinit.js"),"av"),r(n(/*! ./resource-loader */"./src/resource-loader.js"),"avp"),r(n(/*! ./globalization/i18init */"./src/globalization/i18init.js"),"avp"),r(n(/*! ./globalization/i18next */"./src/globalization/i18next.js"),"av"),r(n(/*! ./globalization/langs */"./src/globalization/langs.js"),"avp"),r(n(/*! ./logger/Logger */"./src/logger/Logger.js"),"avp"),r(n(/*! ./wgs/globals */"./src/wgs/globals.js"),"avp"),r(n(/*! ./wgs/render/GroundReflection */"./src/wgs/render/GroundReflection.js"),"avp"),r(n(/*! ./wgs/render/GroundShadow */"./src/wgs/render/GroundShadow.js"),"avp"),r(n(/*! ./wgs/render/WebGLShader */"./src/wgs/render/WebGLShader.js"),"avp"),r(n(/*! ./wgs/render/PhongShader */"./src/wgs/render/PhongShader.js"),"avp"),r(n(/*! ./wgs/render/BasicShader */"./src/wgs/render/BasicShader.js"),"avp"),r(n(/*! ./wgs/render/DecodeEnvMap */"./src/wgs/render/DecodeEnvMap.js"),"avp"),r(n(/*! ./wgs/render/ShaderChunks */"./src/wgs/render/ShaderChunks.js"),"avp"),r(n(/*! ./wgs/render/SAOShader */"./src/wgs/render/SAOShader.js"),"avp"),r(n(/*! ./wgs/render/ShaderPass */"./src/wgs/render/ShaderPass.js"),"avp"),r(n(/*! ./wgs/render/CelShader */"./src/wgs/render/CelShader.js"),"avp"),r(n(/*! ./wgs/render/RenderContextPostProcess */"./src/wgs/render/RenderContextPostProcess.js"),"avp"),r(n(/*! ./wgs/render/LineStyleDef */"./src/wgs/render/LineStyleDef.js"),"avp"),r(n(/*! ./wgs/render/HalfFloat */"./src/wgs/render/HalfFloat.js"),"avp"),r(n(/*! ./wgs/render/ShaderUtils */"./src/wgs/render/ShaderUtils.js"),"avp"),r(n(/*! ./wgs/render/WebGLProgram */"./src/wgs/render/WebGLProgram.js"),"avp"),r(n(/*! ./wgs/render/PrismShader */"./src/wgs/render/PrismShader.js"),"avp"),r(n(/*! ./wgs/render/ShadowMap */"./src/wgs/render/ShadowMap.js"),"avp"),r(n(/*! ./wgs/render/MaterialConverter */"./src/wgs/render/MaterialConverter.js"),"avp"),r(n(/*! ./wgs/render/MaterialManager */"./src/wgs/render/MaterialManager.js"),"avp"),r(n(/*! ./wgs/render/RenderContext */"./src/wgs/render/RenderContext.js"),"avp"),r(n(/*! ./wgs/render/WebGLRenderer */"./src/wgs/render/WebGLRenderer.js"),"avp"),r(n(/*! ./wgs/render/GroundFlags */"./src/wgs/render/GroundFlags.js"),"avp"),r(n(/*! ./wgs/scene/MeshFlags */"./src/wgs/scene/MeshFlags.js"),"avp"),r(n(/*! ./wgs/scene/RenderFlags */"./src/wgs/scene/RenderFlags.js"),"avp"),r(n(/*! ./wgs/scene/ResetFlags */"./src/wgs/scene/ResetFlags.js"),"avp"),r(n(/*! ./wgs/scene/LmvVector3 */"./src/wgs/scene/LmvVector3.js"),"avp"),r(n(/*! ./wgs/scene/LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js"),"avp"),r(n(/*! ./wgs/scene/LmvBox3 */"./src/wgs/scene/LmvBox3.js"),"avp"),r(n(/*! ./wgs/scene/VertexEnumerator */"./src/wgs/scene/VertexEnumerator.js"),"avp"),r(n(/*! ./wgs/scene/VertexBufferReader */"./src/wgs/scene/VertexBufferReader.js"),"avp"),r(n(/*! ./wgs/scene/DeriveTopology */"./src/wgs/scene/DeriveTopology.js"),"avp"),r(n(/*! ./wgs/scene/VBIntersector */"./src/wgs/scene/VBIntersector.js"),"avp"),r(n(/*! ./wgs/scene/GeometryList */"./src/wgs/scene/GeometryList.js"),"avp"),r(n(/*! ./wgs/scene/RenderBatch */"./src/wgs/scene/RenderBatch.js"),"avp"),r(n(/*! ./wgs/scene/InstanceBufferBuilder */"./src/wgs/scene/InstanceBufferBuilder.js"),"avp"),r(n(/*! ./wgs/scene/ModelIteratorLinear */"./src/wgs/scene/ModelIteratorLinear.js"),"avp"),r(n(/*! ./wgs/scene/FragmentListConsolidation */"./src/wgs/scene/FragmentListConsolidation.js"),"avp"),r(n(/*! ./wgs/scene/ConsolidationIterator */"./src/wgs/scene/ConsolidationIterator.js"),"avp"),r(n(/*! ./wgs/scene/ModelIteratorBVH */"./src/wgs/scene/ModelIteratorBVH.js"),"avp"),r(n(/*! ./wgs/scene/BufferGeometry */"./src/wgs/scene/BufferGeometry.js"),"avp"),r(n(/*! ./wgs/scene/Consolidation */"./src/wgs/scene/Consolidation.js"),"avp"),r(n(/*! ./wgs/scene/RenderScene */"./src/wgs/scene/RenderScene.js"),"avp"),r(n(/*! ./wgs/scene/SortedList */"./src/wgs/scene/SortedList.js"),"avp"),r(n(/*! ./wgs/scene/RenderModel */"./src/wgs/scene/RenderModel.js"),"avp"),r(n(/*! ./wgs/scene/FrustumIntersector */"./src/wgs/scene/FrustumIntersector.js"),"avp"),r(n(/*! ./wgs/scene/FragmentList */"./src/wgs/scene/FragmentList.js"),"avp"),r(n(/*! ./wgs/scene/TileCoords */"./src/wgs/scene/TileCoords.js"),"avp"),r(n(/*! ./wgs/scene/ModelIteratorTexQuad */"./src/wgs/scene/ModelIteratorTexQuad.js"),"avp"),r(n(/*! ./wgs/scene/LeafletDiffIterator */"./src/wgs/scene/LeafletDiffIterator.js"),"avp"),r(n(/*! ./wgs/scene/SelectionMode */"./src/wgs/scene/SelectionMode.js"),"av"),r(n(/*! ./wgs/scene/InstanceTree */"./src/wgs/scene/InstanceTree.js"),"avp"),r(n(/*! ./wgs/scene/InstanceTreeStorage */"./src/wgs/scene/InstanceTreeStorage.js"),"avp"),r(n(/*! ./wgs/scene/BVHBuilder */"./src/wgs/scene/BVHBuilder.js"),"avp"),r(n(/*! ./wgs/scene/GeomMergeTask */"./src/wgs/scene/GeomMergeTask.js"),"avp"),r(n(/*! ./wgs/scene/SceneMath */"./src/wgs/scene/SceneMath.js"),"avp"),r(n(/*! ./file-loaders/lmvtk/common/VertexBufferBuilder */"./src/file-loaders/lmvtk/common/VertexBufferBuilder.js"),"avp"),r(n(/*! ./file-loaders/lmvtk/otg/OtgGeomCodec */"./src/file-loaders/lmvtk/otg/OtgGeomCodec.js"),"avp"),r(n(/*! ./file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),"av"),r(n(/*! ./file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),"av"),r(n(/*! ./file-loaders/net/Xhr */"./src/file-loaders/net/Xhr.js"),"avp"),r(n(/*! ./net/MessageClient */"./src/net/MessageClient.js"),"avp"),r(n(/*! ./net/LiveReviewClient */"./src/net/LiveReviewClient.js"),"avp"),r(n(/*! ../thirdparty/three.js/DDSLoader */"./thirdparty/three.js/DDSLoader.js"),"avp"),r(n(/*! ./application/FileLoaderManager */"./src/application/FileLoaderManager.js"),"av"),r(n(/*! ./application/bubble */"./src/application/bubble.js"),"av"),r(n(/*! ./application/EventDispatcher */"./src/application/EventDispatcher.js"),"av"),r(n(/*! ./application/Extension */"./src/application/Extension.js"),"av"),r(n(/*! ./application/ExtensionManager */"./src/application/ExtensionManager.js"),"av"),r(n(/*! ./application/FileLoader */"./src/application/FileLoader.js"),"av"),r(n(/*! ./application/EventTypes */"./src/application/EventTypes.js"),"av"),r(n(/*! ./application/EventUtils */"./src/application/EventUtils.js"),"av"),r(n(/*! ./application/ScreenModeDelegate */"./src/application/ScreenModeDelegate.js"),"av"),r(n(/*! ./application/LightPresets */"./src/application/LightPresets.js"),"avp"),r(n(/*! ./application/ModelLayers */"./src/application/ModelLayers.js"),"avp"),r(n(/*! ./application/LocalStorage */"./src/application/LocalStorage.js"),"avp"),r(n(/*! ./application/Model */"./src/application/Model.js"),"av"),r(n(/*! ./application/Document */"./src/application/Document.js"),"av"),r(n(/*! ./application/Preferences */"./src/application/Preferences.js"),"avp"),r(n(/*! ./application/PreferenceNames */"./src/application/PreferenceNames.js"),"avp"),r(n(/*! ./application/Profile */"./src/application/Profile.js"),"av"),r(n(/*! ./application/ProfileSettings */"./src/application/ProfileSettings.js"),"av"),r(n(/*! ./application/Viewer3D.js */"./src/application/Viewer3D.js"),"av"),r(n(/*! ./application/Viewer3DImpl */"./src/application/Viewer3DImpl.js"),"avp"),r(n(/*! ./application/ViewerState */"./src/application/ViewerState.js"),"avp"),r(n(/*! ./application/ModelMemoryTracker */"./src/application/ModelMemoryTracker.js"),"av"),r(n(/*! ./application/ScreenShot */"./src/application/ScreenShot.js"),"av"),r(n(/*! ./application/Thumbnails */"./src/application/Thumbnails.js"),"av"),r(n(/*! ./application/AggregatedView */"./src/application/AggregatedView.js"),"av"),r(n(/*! ./application/OverlayManager */"./src/application/OverlayManager.js"),"av"),r(n(/*! ./application/CameraLS */"./src/application/CameraLS.js"),"av"),r(n(/*! ./application/ProfileManager */"./src/application/ProfileManager.js"),"av"),r(n(/*! ./measurement/UnitFormatter */"./src/measurement/UnitFormatter.js"),"avp"),r(n(/*! ./measurement/UnitParser */"./src/measurement/UnitParser.js"),"avp"),r(n(/*! ./measurement/PDFUtils */"./src/measurement/PDFUtils.js"),"av");var o=e.exports.av.MeasureCommon={};i(o,n(/*! ./measurement/MeasureCommon */"./src/measurement/MeasureCommon.js")),o.MeasurementTypes=n(/*! ./measurement/MeasurementTypes */"./src/measurement/MeasurementTypes.js").MeasurementTypes,o.SnapType=n(/*! ./measurement/SnapTypes */"./src/measurement/SnapTypes.js").SnapType,o.Events=n(/*! ./measurement/MeasureEvents */"./src/measurement/MeasureEvents.js").MeasureEvents,o.Measurement=n(/*! ./measurement/Measurement */"./src/measurement/Measurement.js").Measurement,o.SnapResult=n(/*! ./measurement/SnapResult */"./src/measurement/SnapResult.js").SnapResult,r(n(/*! ./application/GlobalManager */"./src/application/GlobalManager.js"),"av"),r(n(/*! ./application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),"av"),r(n(/*! ./animation/Animation */"./src/animation/Animation.js"),"avp"),r(n(/*! ./animation/KeyFrameAnimator */"./src/animation/KeyFrameAnimator.js"),"avp"),r(n(/*! ./animation/type/MeshAnimation */"./src/animation/type/MeshAnimation.js"),"avp"),r(n(/*! ./tools/Navigation */"./src/tools/Navigation.js"),"av"),r(n(/*! ./tools/UnifiedCamera */"./src/tools/UnifiedCamera.js"),"av"),r(n(/*! ./tools/Selector */"./src/tools/Selector.js"),"avp"),r(n(/*! ./tools/VisibilityManager */"./src/tools/VisibilityManager.js"),"avp"),r(n(/*! ./tools/KeyCode */"./src/tools/KeyCode.js"),"av"),r(n(/*! ./tools/ToolController */"./src/tools/ToolController.js"),"av"),r(n(/*! ./tools/HotkeyManager */"./src/tools/HotkeyManager.js"),"av"),r(n(/*! ./tools/DefaultHandler */"./src/tools/DefaultHandler.js"),"av"),r(n(/*! ./tools/ViewingUtilities */"./src/tools/ViewingUtilities.js"),"av"),r(n(/*! ./tools/GestureHandler */"./src/tools/GestureHandler.js"),"av"),r(n(/*! ./tools/ToolInterface */"./src/tools/ToolInterface.js"),"av"),r(n(/*! ./tools/OrbitDollyPanTool */"./src/tools/OrbitDollyPanTool.js"),"av"),r(n(/*! ./tools/HotGestureTool */"./src/tools/HotGestureTool.js"),"av"),r(n(/*! ./tools/FovTool */"./src/tools/FovTool.js"),"av"),r(n(/*! ./tools/WorldUpTool */"./src/tools/WorldUpTool.js"),"av"),r(n(/*! ./tools/autocam/Autocam */"./src/tools/autocam/Autocam.js"),"av"),r(n(/*! ./tools/autocam/ViewCube */"./src/tools/autocam/ViewCube.js"),"avp"),r(n(/*! ./tools/viewtransitions/ViewTransition */"./src/tools/viewtransitions/ViewTransition.js"),"avp"),r(n(/*! ./file-loaders/main/SvfLoader */"./src/file-loaders/main/SvfLoader.js"),"avp"),r(n(/*! ./file-loaders/main/F2DLoader */"./src/file-loaders/main/F2DLoader.js"),"avp"),r(n(/*! ./file-loaders/main/LeafletLoader */"./src/file-loaders/main/LeafletLoader.js"),"avp"),r(n(/*! ./file-loaders/main/PropDbLoader */"./src/file-loaders/main/PropDbLoader.js"),"avp"),r(n(/*! ./file-loaders/main/TextureLoader */"./src/file-loaders/main/TextureLoader.js"),"avp"),r(n(/*! ./file-loaders/main/OtgLoader */"./src/file-loaders/main/OtgLoader.js"),"avp"),r(n(/*! ./file-loaders/main/OtgResourceCache */"./src/file-loaders/main/OtgResourceCache.js"),"avp"),r(n(/*! ./file-loaders/main/WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),"avp"),r(n(/*! ./application/ProgressState */"./src/application/ProgressState.js"),"av"),r(n(/*! ./mobile/MobileCallbacks */"./src/mobile/MobileCallbacks.js"),"av"),r(n(/*! ./file-loaders/main/WorkerCreatorWasm */"./src/file-loaders/main/WorkerCreatorWasm.js"),"avp"),r(n(/*! ./wasm/Wasm.js */"./src/wasm/Wasm.js"),"avp"),n(/*! ./index-css */"./src/index-css.js"),r(n(/*! ./gui/LoadingSpinner */"./src/gui/LoadingSpinner.js"),"avu"),r(n(/*! ./gui/Tree */"./src/gui/Tree.js"),"avu"),r(n(/*! ./gui/TreeDelegate */"./src/gui/TreeDelegate.js"),"avu"),r(n(/*! ./gui/TreeOnDemand */"./src/gui/TreeOnDemand.js"),"avu"),r(n(/*! ./gui/CommonWidgets */"./src/gui/CommonWidgets.js"),"avp"),r(n(/*! ./gui/DataTable */"./src/gui/DataTable.js"),"avu"),r(n(/*! ./gui/DockingPanel.js */"./src/gui/DockingPanel.js"),"avu"),r(n(/*! ./gui/ContextMenu */"./src/gui/ContextMenu.js"),"avp"),r(n(/*! ./gui/browser/browser */"./src/gui/browser/browser.js"),"avp"),r(n(/*! ./gui/AlertBox */"./src/gui/AlertBox.js"),"avp"),r(n(/*! ./gui/ErrorHandler */"./src/gui/ErrorHandler.js"),"avp"),r(n(/*! ./gui/ModelStructurePanel */"./src/gui/ModelStructurePanel.js"),"avu"),r(n(/*! ./gui/PropertyPanel */"./src/gui/PropertyPanel.js"),"avu"),r(n(/*! ./gui/ObjectContextMenu */"./src/gui/ObjectContextMenu.js"),"avu"),r(n(/*! ./gui/ProgressBar */"./src/gui/ProgressBar.js"),"avp"),r(n(/*! ./gui/ViewerPanelMixin */"./src/gui/ViewerPanelMixin.js"),"ave"),r(n(/*! ./gui/controls/Control */"./src/gui/controls/Control.js"),"avu"),r(n(/*! ./gui/controls/ControlGroup */"./src/gui/controls/ControlGroup.js"),"avu"),r(n(/*! ./gui/controls/Button */"./src/gui/controls/Button.js"),"avu"),r(n(/*! ./gui/controls/RadioButtonGroup */"./src/gui/controls/RadioButtonGroup.js"),"avu"),r(n(/*! ./gui/controls/ComboButton */"./src/gui/controls/ComboButton.js"),"avu"),r(n(/*! ./gui/toolbar/ToolBar */"./src/gui/toolbar/ToolBar.js"),"avu"),r(n(/*! ./gui/HudMessage */"./src/gui/HudMessage.js"),"avp"),r(n(/*! ./gui/SettingsPanel */"./src/gui/SettingsPanel.js"),"avu"),r(n(/*! ./gui/controls/Filterbox */"./src/gui/controls/Filterbox.js"),"avu"),r(n(/*! ./gui/controls/Searchbox */"./src/gui/controls/Searchbox.js"),"avu"),r(n(/*! ./gui/RenderOptionsPanel */"./src/gui/RenderOptionsPanel.js"),"avp"),r(n(/*! ./gui/ViewerModelStructurePanel */"./src/gui/ViewerModelStructurePanel.js"),"ave"),r(n(/*! ./gui/ViewerPropertyPanel */"./src/gui/ViewerPropertyPanel.js"),"ave"),r(n(/*! ./gui/ViewerSettingsPanel */"./src/gui/ViewerSettingsPanel.js"),"ave"),r(n(/*! ./gui/ViewerObjectContextMenu */"./src/gui/ViewerObjectContextMenu.js"),"ave"),r(n(/*! ./gui/GuiViewerToolbarConst */"./src/gui/GuiViewerToolbarConst.js"),"av"),r(n(/*! ./gui/GuiViewer3D */"./src/gui/GuiViewer3D.js"),"av"),r(n(/*! ../extensions/builtinExtensions */"./extensions/builtinExtensions.js"),"av"),r(n(/*! ../extensions/registerExternalExtensions */"./extensions/registerExternalExtensions.js"),"avp"),n(/*! ./module-suffix */"./src/module-suffix.js").initializeLegacyNamespaces(e.exports)},"./src/logger/Logger.js":
/*!******************************!*\
  !*** ./src/logger/Logger.js ***!
  \******************************/
/*! exports provided: LogLevels, Logger, logger, setLogger */function(e,t,n){"use strict";n.r(t),n.d(t,"LogLevels",(function(){return a})),n.d(t,"Logger",(function(){return l})),n.d(t,"logger",(function(){return d})),n.d(t,"setLogger",(function(){return h}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ../file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),o=Object(r.getGlobal)(),s=o,a={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0};function l(){this.runtimeStats={},this.level=-1,this.setLevel(a.ERROR),this._reportError=this._reportError.bind(this)}function c(){return"undefined"!=typeof window?encodeURI(s.location.href):""}function u(){}l.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var t=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+t.substring(4))}"number"==typeof e.logLevel&&this.setLevel(e.logLevel),this.environmentInfo={touch:Object(r.isTouchDevice)(),env:Object(i.getEnv)(),referer:c(),version:o.LMV_VIEWER_VERSION,build_type:o.LMV_BUILD_TYPE};var n={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,build_type:this.environmentInfo.build_type};this.track(n);var s=this;this.interval=setInterval((function(){s.reportRuntimeStats()}),6e4)},l.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},l.prototype.track=function(e){this.updateRuntimeStats(e),!Object(i.isOffline)()&&this.sessionId&&this.callback&&(e.timestamp=Date.now(),e.sessionId=this.sessionId,this.callback(e))},l.prototype.updateRuntimeStats=function(e){if(e.hasOwnProperty("aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},l.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},l.prototype.setLevel=function(e){this.level!==e&&(this.level=e,this.debug=e>=a.DEBUG?console.log:u,this.log=e>=a.LOG?console.log:u,this.info=e>=a.INFO?console.info:u,this.warn=e>=a.WARNING?console.warn:u,this.error=e>=a.ERROR?this._reportError:u)},l.prototype._reportError=function(){if(this.callback){var e=Array.prototype.slice.call(arguments).join(" ");this.callback({category:"error",message:e})}console.error.apply(console,arguments)};var d=new l;function h(e){d=e}},"./src/measurement/MeasureCommon.js":
/*!******************************************!*\
  !*** ./src/measurement/MeasureCommon.js ***!
  \******************************************/
/*! exports provided: EPSILON, getSnapResultPosition, correctPerpendicularPicks, calculateDistance, computeResult, getFaceArea, getCircularArcRadius, project, inverseProject, nearestPointInPointToLine, nearestPointInPointToSegment, isEqualVectors, getEndPointsInEdge, angleVectorToVector, isParallel, isPerpendicular, nearestVertexInVertexToEdge, createCommonOverlay, safeToggle */function(e,t,n){"use strict";n.r(t),n.d(t,"EPSILON",(function(){return a})),n.d(t,"getSnapResultPosition",(function(){return l})),n.d(t,"correctPerpendicularPicks",(function(){return c})),n.d(t,"calculateDistance",(function(){return u})),n.d(t,"computeResult",(function(){return f})),n.d(t,"getFaceArea",(function(){return p})),n.d(t,"getCircularArcRadius",(function(){return m})),n.d(t,"project",(function(){return g})),n.d(t,"inverseProject",(function(){return v})),n.d(t,"nearestPointInPointToLine",(function(){return y})),n.d(t,"nearestPointInPointToSegment",(function(){return _})),n.d(t,"isEqualVectors",(function(){return b})),n.d(t,"getEndPointsInEdge",(function(){return x})),n.d(t,"angleVectorToVector",(function(){return w})),n.d(t,"isParallel",(function(){return A})),n.d(t,"isPerpendicular",(function(){return M})),n.d(t,"nearestVertexInVertexToEdge",(function(){return S})),n.d(t,"createCommonOverlay",(function(){return T})),n.d(t,"safeToggle",(function(){return C}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./SnapTypes */"./src/measurement/SnapTypes.js"),o=n(/*! ./MeasurementTypes */"./src/measurement/MeasurementTypes.js"),s=n(/*! ./UnitFormatter */"./src/measurement/UnitFormatter.js"),a=1e-4;function l(e,t){if(!e)return null;if(e.isPerpendicular)return e.intersectPoint;switch(e.geomType){case i.SnapType.SNAP_VERTEX:case i.SnapType.RASTER_PIXEL:case i.SnapType.SNAP_MIDPOINT:case i.SnapType.SNAP_CIRCLE_CENTER:return e.getGeometry();case i.SnapType.SNAP_EDGE:var n=x(e.getGeometry()),r=n[0].clone(),o=n[1].clone();return y(e.intersectPoint,r,o);case i.SnapType.SNAP_FACE:return E(e.intersectPoint,e.getGeometry().vertices[0],e.faceNormal);case i.SnapType.SNAP_CIRCULARARC:if(t&&t.model&&t.model.is2d()){var s=e.snapPoint;return e.geomType=i.SnapType.SNAP_VERTEX,e.geomVertex=s,s}return e.circularArcCenter;case i.SnapType.SNAP_CURVEDEDGE:return S(e.intersectPoint,e.getGeometry());case i.SnapType.SNAP_CURVEDFACE:return e.intersectPoint;case i.SnapType.SNAP_INTERSECTION:return e.snapPoint;default:return null}}function c(e,t,n,o){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return!1;var s=l(e,n);if(o&&n)if(t.geomType===i.SnapType.SNAP_EDGE){var a=new r.Vector3,c=new r.Vector3,u=t.getGeometry();if(a.subVectors(t.intersectPoint,s).normalize(),c.subVectors(u.vertices[0],u.vertices[1]).normalize(),M(a,c,.05))if(f=_(s,u.vertices[0],u.vertices[1],!0))return o.onMouseMove(g(f,n))&&o.setPerpendicular(!0),t.geomVertex=f,t.intersectPoint=f,!0}else if(t.geomType===i.SnapType.SNAP_FACE){var d=new r.Vector3,h=t.getGeometry();if(d.subVectors(t.intersectPoint,s).normalize(),A(t.faceNormal,d,.05)){var f=E(s,h.vertices[0],t.faceNormal);return o.onMouseMove(g(f,n))&&o.setPerpendicular(!0),t.geomVertex=f,t.intersectPoint=f,!0}}}function u(e,t,n,r){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return null;var i,s,c=l(e,r),u=l(t,r);if(!c||!u)return null;if(b(c,u,a))return null;if(r.model.is2d()&&(c=c.clone(),u=u.clone(),r.model.pageToModel(c,u,e.viewportIndex2d)),n){var d=Math.log(2*n)/Math.log(10),h=Math.floor(d);1<2*n/Math.pow(10,h)&&h++,n=Math.pow(10,h);var f=c.distanceTo(u),p=f/n;return i=Math.floor(p+.5)*n,p=(f=Math.abs(c.x-u.x))/n,s=Math.floor(p+.5)*n,p=(f=Math.abs(c.y-u.y))/n,{distanceXYZ:i,distanceX:s,distanceY:Math.floor(p+.5)*n,distanceZ:0,type:o.MeasurementTypes.MEASUREMENT_DISTANCE}}return{distanceXYZ:i=c.distanceTo(u),distanceX:s=Math.abs(c.x-u.x),distanceY:Math.abs(c.y-u.y),distanceZ:Math.abs(c.z-u.z),type:o.MeasurementTypes.MEASUREMENT_DISTANCE}}function d(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=l(e[i],t);o&&n.push(o)}if(3!==n.length||function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)if(t!==n&&b(e[t],e[n],a))return!0;return!1}(n))return null;var s=new r.Vector3,c=new r.Vector3;return s.subVectors(n[0],n[1]),c.subVectors(n[2],n[1]),w(s,c)}function h(e,t){var n=[];for(var r in e)if(e.hasOwnProperty(r)){var i=l(e[r],t);i&&n.push(i.clone())}var o=l(e[1],t);o&&n.push(o.clone());for(var s=0;s<n.length;s+=2)t.model.pageToModel(n[s],n[s+1],e[1].viewportIndex2d);var a=0,c=0;for(s=0;s<n.length-1;s++)a+=n[s].x*n[s+1].y,c+=n[s].y*n[s+1].x;return Math.abs((a-c)/2)}function f(e,t,n){switch(t){case o.MeasurementTypes.MEASUREMENT_DISTANCE:var i=e[1];return u(i,e[2],function(e,t){if(e.is3d())return 0;if(e.getData().isPdf)return 0;var n=e.getMetadata("page_dimensions","page_width",null),i=e.getMetadata("page_dimensions","logical_width",null),o=e.getMetadata("page_dimensions","page_height",null),s=e.getMetadata("page_dimensions","logical_height",null);if(!(n&&i&&o&&s))return 0;var a=n/i,l=o/s,c=new r.Vector3(0,0,0),u=new r.Vector3(a,l,0);return e.pageToModel(c,u,t),c.distanceTo(u)}(n.model,i.viewportIndex2d),n);case o.MeasurementTypes.MEASUREMENT_ANGLE:var s=d(e,n);return s?{angle:s,type:t}:null;case o.MeasurementTypes.MEASUREMENT_AREA:return{area:h(e,n),type:t};default:return null}}function p(e,t,n,i,o,a){for(var l=0,c=n.vertices,u=new r.Vector3,d=new r.Vector3,h=0;h<c.length;h+=3)u.subVectors(c[h+1],c[h]),d.subVectors(c[h+2],c[h]),l+=u.length()*d.length()*Math.sin(u.angleTo(d))/2;return l=Object(s.convertUnits)(e.model.getUnitString(),i,a,l,"square"),i?Object(s.formatValueWithUnits)(l,i+"^2",3,o):Object(s.formatValueWithUnits)(l,null,3,o)}function m(e,t,n,r,i,o){var a=n.radius;if(a){if(e.model.is2d()){var l=n.center.clone(),c=n.vertices[0].clone();e.model.pageToModel(l,c,t.getPick(1).viewportIndex2d),a=l.distanceTo(c)}return a=Object(s.convertUnits)(e.model.getUnitString(),r,o,a),Object(s.formatValueWithUnits)(a,r,3,i)}}function g(e,t,n){var i=t.navigation.getCamera(),o=t.navigation.getScreenViewport(),s=new r.Vector3(e.x,e.y,e.z);return s=s.project(i),n=n||0,new r.Vector2(Math.round((s.x+1)/2*o.width)+n,Math.round((1-s.y)/2*o.height)+n)}function v(e,t){var n=t.navigation.getCamera(),i=t.navigation.getScreenViewport(),o=new r.Vector3;return o.x=e.x/i.width*2-1,o.y=-(e.y/i.height*2-1),o.z=0,o=o.unproject(n)}function y(e,t,n){var i,o=new r.Vector3,s=new r.Vector3;return o.subVectors(t,e),s.subVectors(n,t),i=o.dot(s),o.subVectors(n,t),i=-i/o.dot(o),o.subVectors(n,t),o.multiplyScalar(i),o.add(t)}function _(e,t,n,i){var o,s,a=new r.Vector3,l=new r.Vector3;return a.subVectors(t,e),l.subVectors(n,t),s=a.dot(l),a.subVectors(n,t),(s=-s/a.dot(a))<0?o=i?null:t:s>1?o=i?null:n:(a.subVectors(n,t),a.multiplyScalar(s),o=a.add(t)),o}function b(e,t,n){return!(!e||!t)&&(Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n&&Math.abs(e.z-t.z)<=n)}function x(e){for(var t=e.vertices,n=[],r=0;r<t.length;++r){for(var i=!1,o=0;o<t.length;++o)if(o!==r&&t[o].equals(t[r])){i=!0;break}i||n.push(t[r])}return n}function w(e,t){return 180*e.angleTo(t)/Math.PI}function E(e,t,n){var i=new r.Vector3,o=n.clone(),s=new r.Vector3;s.subVectors(e,t);var a=-o.dot(s)/o.dot(o);return i.addVectors(e,o.multiplyScalar(a)),i}function A(e,t,n){return n=n||a,1-Math.abs(e.dot(t))<n}function M(e,t,n){return n=n||a,Math.abs(e.dot(t))<n}function S(e,t){for(var n,r=Number.MAX_VALUE,i=0;i<t.vertices.length;i++){var o=e.distanceTo(t.vertices[i]);r>o&&(n=t.vertices[i],r=o)}return n}function T(e,t){e.impl.overlayScenes[t]||e.impl.createOverlayScene(t)}function C(e,t,n){(e.classList.contains(t)&&!n||!e.classList.contains(t)&&n)&&e.classList.toggle(t,n)}},"./src/measurement/MeasureEvents.js":
/*!******************************************!*\
  !*** ./src/measurement/MeasureEvents.js ***!
  \******************************************/
/*! exports provided: MeasureEvents */function(e,t,n){"use strict";n.r(t),n.d(t,"MeasureEvents",(function(){return r}));var r={MEASUREMENT_CHANGED_EVENT:"measurement-changed",UNITS_CALIBRATION_STARTS_EVENT:"units_calibration_starts_event",FINISHED_CALIBRATION_FOR_DIMENSION_EVENT:"finished_calibration_for_dimension_event",CALIBRATION_REQUIRED_EVENT:"calibration-required",OPEN_CALIBRATION_PANEL_EVENT:"open-calibration-panel",CLOSE_CALIBRATION_PANEL_EVENT:"close-calibration-panel",CLEAR_CALIBRATION_SIZE_EVENT:"clear-calibration-size",FINISHED_CALIBRATION:"finished-calibration",DISPLAY_UNITS_CHANGED:"display-units-changed",MEASUREMENT_MODE_ENTER:"measure-mode-enter",MEASUREMENT_MODE_LEAVE:"measure-mode-leave"}},"./src/measurement/Measurement.js":
/*!****************************************!*\
  !*** ./src/measurement/Measurement.js ***!
  \****************************************/
/*! exports provided: Measurement */function(e,t,n){"use strict";n.r(t),n.d(t,"Measurement",(function(){return s}));var r=n(/*! ./SnapResult */"./src/measurement/SnapResult.js"),i=n(/*! ./MeasurementTypes */"./src/measurement/MeasurementTypes.js"),o=n(/*! ./MeasureCommon */"./src/measurement/MeasureCommon.js");function s(e,t){this.measurementType=e,this.id=t,this.picks=[],this.closedArea=!1,this.resetMeasureValues()}s.prototype.resetMeasureValues=function(){this.angle=0,this.distanceX=0,this.distanceY=0,this.distanceZ=0,this.distanceXYZ=0,this.result=null},s.prototype.setPick=function(e,t){var n=this.picks[e]=t;return n.id=parseInt(e),n},s.prototype.getPick=function(e){var t=this.picks[e];return t||(t=this.setPick(e,new r.SnapResult)),t},s.prototype.clonePicks=function(e){var t=[];for(var n in this.picks)if(this.picks.hasOwnProperty(n)){var r=this.picks[n];t.push(r.clone())}return t},s.prototype.countPicks=function(){return Object.keys(this.picks).length},s.prototype.getMaxNumberOfPicks=function(){switch(this.measurementType){case i.MeasurementTypes.MEASUREMENT_DISTANCE:return 2;case i.MeasurementTypes.MEASUREMENT_ANGLE:return 3;case i.MeasurementTypes.MEASUREMENT_AREA:return this.closedArea?this.countPicks():Number.MAX_VALUE-1}},s.prototype.hasPick=function(e){return this.picks[e]&&!this.picks[e].isEmpty()},s.prototype.isComplete=function(){var e=this.countPicks()===this.getMaxNumberOfPicks();for(var t in this.picks)if(this.picks.hasOwnProperty(t)&&!(e=e&&this.hasPick(t)))break;return e},s.prototype.isEmpty=function(){var e=!0;for(var t in this.picks)if(this.picks.hasOwnProperty(t)&&!(e=e&&!this.hasPick(t)))break;return e},s.prototype.clearPick=function(e){this.picks[e]&&this.picks[e].clear(),this.resetMeasureValues()},s.prototype.clearAllPicks=function(){for(var e in this.picks)this.picks.hasOwnProperty(e)&&this.clearPick(e)},s.prototype.hasEqualPicks=function(e,t){if(!e||!t)return!1;if(e.geomType===t.geomType){var n=Object(o.getSnapResultPosition)(e),r=Object(o.getSnapResultPosition)(t);return Object(o.isEqualVectors)(n,r,o.EPSILON)}return!1},s.prototype.computeResult=function(e,t){if(this.resetMeasureValues(),!t.model)return this.result=null,!1;var n=this.result=Object(o.computeResult)(e,this.measurementType,t);if(null===n)return!this.isComplete();switch(n.type){case i.MeasurementTypes.MEASUREMENT_DISTANCE:return this.distanceXYZ=n.distanceXYZ,this.distanceX=n.distanceX,this.distanceY=n.distanceY,this.distanceZ=n.distanceZ,!0;case i.MeasurementTypes.MEASUREMENT_ANGLE:return this.angle=isNaN(n.angle)?0:n.angle,!0;case i.MeasurementTypes.MEASUREMENT_AREA:return this.area=n.area,!0;default:return!1}},s.prototype.getGeometry=function(e){return{type:this.picks[e].geomType,geometry:this.picks[e].getGeometry()}},s.prototype.attachIndicator=function(e,t,n){this.indicator=new n(e,this,t),this.indicator.init()}},"./src/measurement/MeasurementTypes.js":
/*!*********************************************!*\
  !*** ./src/measurement/MeasurementTypes.js ***!
  \*********************************************/
/*! exports provided: MeasurementTypes */function(e,t,n){"use strict";n.r(t),n.d(t,"MeasurementTypes",(function(){return r}));var r={MEASUREMENT_DISTANCE:1,MEASUREMENT_ANGLE:2,MEASUREMENT_AREA:3,CALIBRATION:4}},"./src/measurement/PDFUtils.js":
/*!*************************************!*\
  !*** ./src/measurement/PDFUtils.js ***!
  \*************************************/
/*! exports provided: PDFUtils */function(e,t,n){"use strict";n.r(t),n.d(t,"PDFUtils",(function(){return a}));var r=n(/*! ../wgs/scene/SceneMath */"./src/wgs/scene/SceneMath.js");function i(e){var t=e.impl.model.getDocumentNode(),n=t.search(Bimfish.Viewing.BubbleNode.LEAFLET_NODE)[0]._raw(),r={};return new Bimfish.Viewing.Document(t.getRootNode()._raw(),"").getLeafletParams(r,t,n),r}function o(e){var t=new Bimfish.Viewing.Private.TexQuadConfig,n=i(e);return t.initFromLoadOptions(null,n),t.getBBox()}function s(e){var t=o(e);return r.SceneMath.getNormalizingMatrix(null,t)}var a={leafletToPdfWorld:function(e,t){var n=s(e);t.applyMatrix4(n);var i=r.SceneMath.getNormalizingMatrix(e.model);return i=i.getInverse(i),t.applyMatrix4(i),t},pdfToLeafletWorld:function(e,t){var n=r.SceneMath.getNormalizingMatrix(e.model);t.applyMatrix4(n);var i=s(e);return i=i.getInverse(i),t.applyMatrix4(i),t},getLeafletLoadOptions:i,getLeafletBoundingBox:o,getLeafletNormalizingMatrix:s}},"./src/measurement/SnapResult.js":
/*!***************************************!*\
  !*** ./src/measurement/SnapResult.js ***!
  \***************************************/
/*! exports provided: SnapResult */function(e,t,n){"use strict";n.r(t),n.d(t,"SnapResult",(function(){return i}));var r=n(/*! ./SnapTypes */"./src/measurement/SnapTypes.js");function i(){this.clear()}i.prototype.clear=function(){this.geomType=null,this.modelId=null,this.snapNode=null,this.geomVertex=null,this.geomEdge=null,this.geomFace=null,this.radius=null,this.intersectPoint=null,this.faceNormal=null,this.viewportIndex2d=null,this.circularArcCenter=null,this.circularArcRadius=null,this.fromTopology=!1,this.isPerpendicular=!1,this.snapPoint=null},i.prototype.copyTo=function(e){e.modelId=this.modelId,e.snapNode=this.snapNode,e.geomVertex=this.geomVertex,e.geomFace=this.geomFace,e.geomEdge=this.geomEdge,e.radius=this.radius,e.geomType=this.geomType,e.intersectPoint=this.intersectPoint,e.faceNormal=this.faceNormal,e.viewportIndex2d=this.viewportIndex2d,e.circularArcCenter=this.circularArcCenter,e.circularArcRadius=this.circularArcRadius,e.fromTopology=this.fromTopology,e.isPerpendicular=this.isPerpendicular,e.snapPoint=this.snapPoint},i.prototype.clone=function(){var e=new i;return this.copyTo(e),e},i.prototype.isEmpty=function(){return!this.getGeometry()},i.prototype.getFace=function(){return this.geomFace},i.prototype.getEdge=function(){return this.geomEdge},i.prototype.getVertex=function(){return this.geomVertex},i.prototype.getGeometry=function(){switch(this.geomType){case r.SnapType.SNAP_VERTEX:case r.SnapType.SNAP_MIDPOINT:case r.SnapType.SNAP_INTERSECTION:case r.SnapType.SNAP_CIRCLE_CENTER:case r.SnapType.RASTER_PIXEL:return this.geomVertex;case r.SnapType.SNAP_EDGE:return this.geomEdge;case r.SnapType.SNAP_FACE:return this.geomFace;case r.SnapType.SNAP_CIRCULARARC:case r.SnapType.SNAP_CURVEDEDGE:return this.geomEdge;case r.SnapType.SNAP_CURVEDFACE:return this.geomFace}return null},i.prototype.setGeometry=function(e,t){switch(e){case r.SnapType.SNAP_VERTEX:case r.SnapType.SNAP_MIDPOINT:case r.SnapType.SNAP_INTERSECTION:case r.SnapType.SNAP_CIRCLE_CENTER:case r.SnapType.RASTER_PIXEL:this.geomVertex=t;break;case r.SnapType.SNAP_EDGE:this.geomEdge=t;break;case r.SnapType.SNAP_FACE:this.geomFace=t;break;case r.SnapType.SNAP_CIRCULARARC:case r.SnapType.SNAP_CURVEDEDGE:this.geomEdge=t;break;case r.SnapType.SNAP_CURVEDFACE:this.geomFace=t;break;default:return}this.geomType=e}},"./src/measurement/SnapTypes.js":
/*!**************************************!*\
  !*** ./src/measurement/SnapTypes.js ***!
  \**************************************/
/*! exports provided: SnapType */function(e,t,n){"use strict";n.r(t),n.d(t,"SnapType",(function(){return r}));var r={SNAP_VERTEX:0,SNAP_MIDPOINT:1,SNAP_CIRCLE_CENTER:2,SNAP_EDGE:3,SNAP_FACE:4,SNAP_CIRCULARARC:5,SNAP_CURVEDEDGE:6,SNAP_CURVEDFACE:7,RASTER_PIXEL:8,SNAP_INTERSECTION:9}},"./src/measurement/UnitFormatter.js":
/*!******************************************!*\
  !*** ./src/measurement/UnitFormatter.js ***!
  \******************************************/
/*! exports provided: formatValueWithUnits, convertUnits, calculatePrecision */function(e,t,n){"use strict";n.r(t),n.d(t,"formatValueWithUnits",(function(){return i})),n.d(t,"convertUnits",(function(){return o})),n.d(t,"calculatePrecision",(function(){return s}));var r=n(/*! ../globalization/i18next */"./src/globalization/i18next.js");function i(e,t,n,o){function s(e){var t=0<=e?Math.floor(e):Math.ceil(e);return{intPart:t,fracPart:e-t}}function a(e,t,n){var r="";return n&&0===e&&(r+="-"),r+=0<t?e.toFixed(t):e.toFixed(0)}function l(e,t,n){for(var r,i,o="",l=1,c=e<0,u=0;u<t;++u)l*=2;e>0?e+=.5/l:e-=.5/l,n?i=e:(o+=a(r=s(e/12).intPart,0,c)+"' ",(i=e-12*r)<0&&(i=-i));var d=s(i).intPart,h=s((i-d)*l).intPart;if(0!==h&&0===d||(o+=a(d,0)),0!==h){for(d<0&&h<0&&(h=-h);h%2==0;)h/=2,l/=2;0!==d&&(o+="-"),o+=a(h,0)+"/"+a(l,0)}return o+='"'}function c(e,t){var n="";e<0&&(n="-",e=Math.abs(e));var r=s(e),i=r.intPart,o=100*r.fracPart;return n+a(i,0)+" m "+a(o,t)+" cm"}function u(e,t){var n="";e<0&&(n="-",e=Math.abs(e));var r=s(e),i=r.intPart,o=12*r.fracPart;return n+a(i,0)+"' "+a(o,t)+'"'}var d;null==o&&(o=3);try{if(1===n)d=r.i18n.translate(e?"Yes":"No");else if(24===n){var h=e.split(" ");d=[];for(var f=0;f<h.length;++f)d.push(i(parseFloat(h[f]),t,3,o));d=d.join(", ")}else 2!==n&&3!==n||!isNaN(e)?"ft-and-fractional-in"===t?d=l(12*e,o):"ft-and-fractional-in^2"===t?d=l(12*e,o)+" "+String.fromCharCode(178):"ft-and-decimal-in"===t?d=u(e,o):"ft-and-decimal-in^2"===t?d=u(e,o)+" "+String.fromCharCode(178):"decimal-in"===t||"in"===t||"inch"===t?d=a(e,o)+'"':"decimal-in^2"===t||"in^2"===t||"inch^2"===t?d=a(e,o)+'" '+String.fromCharCode(178):"decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t?d=a(e,o)+"'":"decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t?d=a(e,o)+"' "+String.fromCharCode(178):"fractional-in"===t?d=l(e,o,!0):"fractional-in^2"===t?d=l(e,o,!0)+" "+String.fromCharCode(178):"m-and-cm"===t?d=c(e,o):"m-and-cm^2"===t?d=c(e,o)+" "+String.fromCharCode(178):3===n&&t?(t=(t=t.replace("^2",String.fromCharCode(178))).replace("^3",String.fromCharCode(179)),d=a(e,o)+" "+t):d=t?e+" "+t:3===n?a(e,o):e:d="NaN"}catch(n){d=t?e+" "+t:e}return d}function o(e,t,n,r,i,o){if(n=n||1,o=o||72,e===t&&1==n)return r;var s=1;switch(t){case"mm":s=1e3;break;case"cm":s=100;break;case"m":s=1;break;case"in":s=39.37007874;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":s=3.280839895;break;case"decimal-in":s=39.37007874;break;case"decimal-ft":s=3.280839895;break;case"fractional-in":s=39.37007874;break;case"m-and-cm":s=1;break;case"pt":s=39.37007874*o}var a=1;switch(e){case"mm":a=.001;break;case"cm":a=.01;break;case"m":a=1;break;case"in":a=.0254;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":a=.3048;break;case"decimal-in":a=.0254;break;case"decimal-ft":a=.3048;break;case"fractional-in":a=.0254;break;case"m-and-cm":a=1;break;case"pt":a=.0254/o}return"square"===i?r?r*Math.pow(s*a*n,2):0:r?r*s*a*n:0}function s(e){if(!e)return 0;var t=e.toString().split(".")[1];if(!t){var n=e.toString().split("/")[1],r=n&&n.match(/\d+/);if(r){var i=parseFloat(r);if(i&&!isNaN(i))return Math.floor(Math.log2(i))}return 0}return(t=t.match(/\d+/))&&t[0]&&t[0].length||0}},"./src/measurement/UnitParser.js":
/*!***************************************!*\
  !*** ./src/measurement/UnitParser.js ***!
  \***************************************/
/*! exports provided: UnitParser */function(e,t,n){"use strict";n.r(t),n.d(t,"UnitParser",(function(){return r}));var r={};function i(e,t,n,r){if(!e)return NaN;var i,o=(e=e.toString()).trim();if(0==o.length)return NaN;var s=n.join("| *"),a=r.join("| *");if(i=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+") *$")))return parseFloat(i[1])/parseFloat(i[2])/t;if(i=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+")? *$")))return parseFloat(i[1])/parseFloat(i[2]);var l;if(!(i=o.match(/^[+-]? *(?:\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?/i)))return NaN;if(l=parseFloat(i[0].replace(/ */g,"")),0==(o=(o=o.slice(i[0].length)).replace("-"," ")).length||isNaN(l))return l;var c=Math.sign(l);return 0===c&&(c=1),o.match(new RegExp("^(?: *)(?:"+a+") *$","i"))?l/t:(i=o.match(new RegExp("^ +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+") *$","i")))?(l+c*parseFloat(i[1])/parseFloat(i[2]))/t:(i=o.match(new RegExp("^(?: *)(?:"+s+"|-| +-?) *","i")))?0==(o=o.slice(i[0].length).trim()).length?i[0].match(/-/)?NaN:l:(i=o.match(new RegExp("^(\\d+(?:\\.\\d*)?)(?: *)(?:"+a+")? *$")))?l+c*parseFloat(i[1])/t:(i=o.match(new RegExp("^(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))?l+c*(parseFloat(i[1])/parseFloat(i[2]))/t:(i=o.match(new RegExp("^(\\d+) +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))?l+c*(parseFloat(i[1])+parseFloat(i[2])/parseFloat(i[3]))/t:NaN:NaN}r.parseFeet=function(e){return i(e,12,["ft","feet","'","`","‘","’"],["in","inch",'\\"',"''","``","‘‘","’’"])},r.parseMeter=function(e){return i(e,100,["m","meter"],["cm","centimeter"])},r.parseNumber=function(e,t){switch(t){case"ft":case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":case"decimal-in":case"fractional-in":return r.parseFeet(e);case"":case"m":case"cm":case"mm":case"m-and-cm":default:return r.parseMeter(e)}},r.parsePositiveNumber=function(e,t){var n=r.parseNumber(e,t);return n>=0?n:NaN}},"./src/mobile/MobileCallbacks.js":
/*!***************************************!*\
  !*** ./src/mobile/MobileCallbacks.js ***!
  \***************************************/
/*! exports provided: MobileCallbacks */function(e,t,n){"use strict";n.r(t),n.d(t,"MobileCallbacks",(function(){return o}));var r=n(/*! ../compat */"./src/compat.js"),i=Object(r.getGlobal)();function o(){this.ios=i.webkit,this.android=i.JSINTERFACE,this.iosSend=function(e,t){return i.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=i.JSINTERFACE}var s=o.prototype;s.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},s.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},s.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},s.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},s.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},s.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},s.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},s.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},s.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},s.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},s.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},s.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},s.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},s.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},s.setLoadingProgress=function(e,t){this.ios?this.iosSend("setLoadingProgress",{state:e,progress:t}):this.android&&this.androidSend.setLoadingProgress(e,t)},s.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},s.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},s.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},s.putAllSheets=function(e){this.ios?this.iosSend("putAllSheets",e):this.android&&this.androidSend.putAllSheets(e)},s.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},s.instanceTree=function(e){this.ios?this.iosSend("instanceTree",e):this.android&&this.androidSend.instanceTree(e)},s.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},s.sheetSelected=function(e){this.ios?this.iosSend("sheetSelected",e):this.android&&this.androidSend.sheetSelected(e)},"undefined"!=typeof window&&(i.MobileCallbacks=o)},"./src/module-prefix.js":
/*!******************************!*\
  !*** ./src/module-prefix.js ***!
  \******************************/
/*! no static exports found */function(e,t,n){(function(t){function n(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:t}function r(e){for(var t=n(),r=e.split("."),i=0;i<r.length;++i)t[r[i]]=t[r[i]]||{},t=t[r[i]];return t}r("Bimfish.Viewing.Private"),r("Bimfish.Viewing.Extensions"),r("Bimfish.Extensions"),r("Bimfish.Viewing.Shaders"),r("Bimfish.Viewing.UI"),r("Bimfish.LMVTK"),Bimfish.Viewing.getGlobal=n,Bimfish.Viewing.AutodeskNamespace=r,n().AutodeskNamespace=r;var i=n().Bimfish.Viewing.Private;i.LMV_WORKER_URL="lmvworker.js",i.ENABLE_DEBUG=i.ENABLE_DEBUG||!1,n().ENABLE_DEBUG=i.ENABLE_DEBUG,i.ENABLE_INLINE_WORKER=!0,e.exports.Bimfish=n().Bimfish}).call(this,n(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./src/module-suffix.js":
/*!******************************!*\
  !*** ./src/module-suffix.js ***!
  \******************************/
/*! exports provided: initializeLegacyNamespaces */function(e,t,n){"use strict";function r(e){var t=Bimfish.Viewing,n=t.Private,r=t.UI,i=t.Extensions;for(var o in e.av)t[o]=e.av[o];for(var s in e.avp)n[s]=e.avp[s];for(var a in e.avu)r[a]=e.avu[a];for(var l in e.ave)i[l]=e.ave[l];t.getGlobal().THREE=e.THREE,t.getGlobal().LMV=e,n.isRightClick=t.isRightClick,n.isMiddleClick=t.isMiddleClick}n.r(t),n.d(t,"initializeLegacyNamespaces",(function(){return r}))},"./src/net/LiveReviewClient.js":
/*!*************************************!*\
  !*** ./src/net/LiveReviewClient.js ***!
  \*************************************/
/*! exports provided: LiveReviewClient, InteractionInterceptor, ViewTransceiver */function(e,t,n){"use strict";n.r(t),n.d(t,"LiveReviewClient",(function(){return l})),n.d(t,"InteractionInterceptor",(function(){return c})),n.d(t,"ViewTransceiver",(function(){return u}));var r=n(/*! ../application/EventDispatcher */"./src/application/EventDispatcher.js"),i=n(/*! ./MessageClient */"./src/net/MessageClient.js"),o=n(/*! ../application/ViewerState */"./src/application/ViewerState.js"),s=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),a=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function l(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.messageClient=null,this.presenceChannelId=null,this.viewtx=null,this.interceptor=null}function c(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,n){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}function u(e){var t,n,r=this,i=this.viewer=null,a=!1,l=!1,c=!1,u=this.client=e,d=new THREE.Ray,h=null,f=!1;this.channelId=null;var p={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};function m(e){a=!0;var t=JSON.parse(e.data.msg);n.restoreState(t),i.impl.invalidate(!0,!1,!0),a=!1}function g(e){return Math.round(1e3*e)/1e3}function v(e){for(var t=0;t<e.length;t++)e[t]=g(e[t])}function y(e){var n=e.data.msg;!0===n[1]||c||(n[0]!=t&&(t=n[0],e.data.lastInControl=n[0],r.dispatchEvent({type:"controlChange",channelId:r.channelId,data:e.data})),l=!1,i.navigation.setView((new THREE.Vector3).set(n[2],n[3],n[4]),(new THREE.Vector3).set(n[5],n[6],n[7])),i.navigation.setCameraUpVector((new THREE.Vector3).set(n[8],n[9],n[10])))}function _(n){if(l||c){var i=n.camera,o=[i.position.x,i.position.y,i.position.z,i.target.x,i.target.y,i.target.z,i.up.x,i.up.y,i.up.z];v(o),o.unshift(c),o.unshift(e.getLocalId()),u.sendMessage("camera",o,r.channelId),t!=o[0]&&(t=o[0],r.dispatchEvent({type:"controlChange",channelId:r.channelId,data:{lastInControl:t}}))}}function b(e,t,n){var o=r.getDocument();e&&!h&&(h=o.createElement("div")).classList.add("collabPointer"),e&&!f?(i.container.appendChild(h),f=!0):!e&&f&&(i.container.removeChild(h),f=!1),e&&(h.style.left=t-6+"px",h.style.top=n-6+"px")}function x(e){if(!l&&!c){var t=e.data.msg;d.origin.set(t[1],t[2],t[3]),d.direction.set(t[4],t[5],t[6]);var n=d.at(i.getCamera().near);n.project(i.getCamera()),b(!0,(n=i.impl.viewportToClient(n.x,n.y)).x,n.y)}}function w(t){if(!a){var i=n.getState(p);e.sendMessage("state",JSON.stringify(i),r.channelId)}}this.takeControl=function(){l=!0,b(!1)},this.updatePointer=function(t){!function(t){if(l){var n=i.impl.clientToViewport(t.canvasX,t.canvasY);i.impl.viewportToRay(n,d);var o=[d.origin.x,d.origin.y,d.origin.z,d.direction.x,d.direction.y,d.direction.z];v(o),o.unshift(e.getLocalId()),u.sendMessage("pointer",o,r.channelId)}}(t)},this.connectCamera=function(e){c=!e},this.attach=function(e,t){i&&this.detach(),this.viewer=i=e,n=new o.ViewerState(i),u.addEventListener("cameraChange",y),u.addEventListener("pointerMove",x),i.hasEventListener(s.CAMERA_CHANGE_EVENT,_)||i.addEventListener(s.CAMERA_CHANGE_EVENT,_),t||(u.addEventListener("viewerState",m),i.hasEventListener(s.SELECTION_CHANGED_EVENT,w)||(i.addEventListener(s.SELECTION_CHANGED_EVENT,w),i.addEventListener(s.ISOLATE_EVENT,w),i.addEventListener(s.HIDE_EVENT,w),i.addEventListener(s.SHOW_EVENT,w),i.addEventListener(s.EXPLODE_CHANGE_EVENT,w),i.addEventListener(s.LAYER_VISIBILITY_CHANGED_EVENT,w),i.addEventListener(s.CUTPLANES_CHANGE_EVENT,w)))},this.detach=function(){b(!1),u&&(u.removeEventListener("cameraChange",y),u.removeEventListener("viewerState",m)),i&&(i.removeEventListener(s.CAMERA_CHANGE_EVENT,_),i.removeEventListener(s.SELECTION_CHANGED_EVENT,w),i.removeEventListener(s.ISOLATE_EVENT,w),i.removeEventListener(s.HIDE_EVENT,w),i.removeEventListener(s.SHOW_EVENT,w),i.removeEventListener(s.EXPLODE_CHANGE_EVENT,w),i.removeEventListener(s.LAYER_VISIBILITY_CHANGED_EVENT,w),i.removeEventListener(s.CUTPLANES_CHANGE_EVENT,w),this.viewer=i=null,n=null)}}a.GlobalManagerMixin.call(l.prototype),l.prototype.destroy=function(){this.leaveLiveReviewSession()},l.prototype.joinLiveReviewSession=function(e){this.messageClient||(this.messageClient=i.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=this.getWindow().location.host),this.messageClient.isConnected()||this.messageClient.connect(e),this.viewtx||(this.viewtx=new u(this.messageClient),this.viewtx.setGlobalManager(this.globalManager)),this.viewtx.channelId=e,this.viewtx.attach(this.viewer),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new c(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},l.prototype.leaveLiveReviewSession=function(){this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.viewtx=null,this.messageClient=null,this.interceptor=null},u.prototype.constructor=u,r.EventDispatcher.prototype.apply(u.prototype),a.GlobalManagerMixin.call(u.prototype)},"./src/net/MessageClient.js":
/*!**********************************!*\
  !*** ./src/net/MessageClient.js ***!
  \**********************************/
/*! exports provided: setUserName, MessageClient */function(e,t,n){"use strict";n.r(t),n.d(t,"setUserName",(function(){return c})),n.d(t,"MessageClient",(function(){return u}));var r,i=n(/*! ../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../application/EventDispatcher */"./src/application/EventDispatcher.js"),s=n(/*! ../file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),a=n(/*! ../envinit */"./src/envinit.js"),l=(n(/*! ../compat */"./src/compat.js"),{userName:""});function c(e){l.userName=e}function u(e,t){var n,o={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},s=null,a=Array.isArray(e)?e:[e],c=0,u={},d={},h=this;function f(){return l.userName&&l.userName.length?l.userName:s?s.slice(0,5):"Unknown"}function p(e){switch(e.type){case"txt":!function(e){if(0==e.msg.indexOf("/nick ")){var t=h.getUserById(e.from,e.roomId),n=e.msg.slice(6);if(n.length&&(t.name=n,t.id==s)){var r=Bimfish.Viewing.i18n.translate("you");t.name+=" ("+r+")"}h.dispatchEvent({type:"userListChange",data:e,channelId:e.roomId})}}(e);break;case"joinok":!function(e){var t=d[e.roomId];i.logger.info("joined channel "+e.roomId),e.users&&e.users.length?t.users=e.users:t.users=[];for(var n=0;n<t.users.length;n++)t.users[n].name&&t.users[n].name.length||(t.users[n].name=t.users[n].id.slice(0,5));var r=f(),o=Bimfish.Viewing.i18n.translate("you"),a={id:s,name:r+" ("+o+")",isSelf:!0,status:0};t.userSet[s]||(t.users.push(a),t.userSet[s]=a);0!=a.id.indexOf(r)&&h.sendChatMessage("/nick "+r,e.roomId)}(e);break;case"join_error":break;case"sessionId":i.logger.info("Connect successful, your id is: "+e.id),s=e.id;break;case"joined":e.userStatus="joined",function(e){e.user.name&&e.user.name.length||(e.user.name=e.user.id.slice(0,5));if(e.roomId){var t=d[e.roomId];t?(t.users.push(e.user),i.logger.info(e.user+" joined room "+e.roomId)):i.logger.warn("Channel "+e.roomId+" does not exist for socket "+s)}}(e);break;case"left":e.userStatus="left",function(e){for(var t in i.logger.info(e.user+" left room "+e.room),d){for(var n=d[t].users,r=-1,o=0;o<n.length;o++)if(n[o].id==e.user){r=o;break}-1!=r&&n.splice(r,1),delete d[t].userSet[e.user]}}(e);break;case"camera":case"pointer":break;default:i.logger.log(e)}var t=e.roomId,n={type:o[e.type],data:e,channelId:t};h.dispatchEvent(n)}function m(e){c<a.length?(i.logger.info("Connect failed, trying another server..."),n.disconnect(),n=null,c++,h.connect(h.sessionID)):h.dispatchEvent({type:"socketError",data:e})}function g(e){h.dispatchEvent({type:"socketError",data:e})}function v(e){for(var t in c=0,u)h.join(t)}this.connect=function(e){if(!n)return void 0!==window.WebSocket&&(r||(r="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=e,(n=r.connect(a[c]+"?sessionID="+e,{path:t,forceNew:!0})).on("connect",v),n.on("message",p),n.on("connect_error",m),n.on("error",g),!0)},this.join=function(e){n&&n.connected?(delete u[e],d[e]={id:e,users:[],userSet:{}},n.emit("join",{roomId:e,name:f()})):u[e]=1},this.disconnect=function(){n&&(n.disconnect(),n=null,d={},s=null)},this.sendMessage=function(e,t,r){var i={type:e,from:s,msg:t,roomId:r};n.emit("message",i)},this.sendPrivateMessage=function(e,t){var r={type:"private",target:e,from:s,msg:t};n.emit("message",r)},this.sendChatMessage=function(e,t){var r={type:"txt",from:s,msg:e,roomId:t};n.emit("message",r),p(r)},this.getUserById=function(e,t){for(var n=d[t].users,r=0;r<n.length;r++)if(n[r].id==e)return n[r];return null},this.getLocalId=function(){return s},this.getChannelInfo=function(e){return d[e]},this.isConnected=function(){return n}}u.prototype.constructor=u,o.EventDispatcher.prototype.apply(u.prototype);var d={};u.GetInstance=function(e,t){e||(e=a.EnvironmentConfigurations[Object(s.getEnv)()].LMV.RTC),Array.isArray(e)||(e=[e]);var n=d[e[0]];return n||(n=new u(e,t),d[e[0]]=n,n)}},"./src/resource-loader.js":
/*!********************************!*\
  !*** ./src/resource-loader.js ***!
  \********************************/
/*! exports provided: theResourceLoader, loadDependency */function(e,t,n){"use strict";n.r(t),n.d(t,"theResourceLoader",(function(){return l})),n.d(t,"loadDependency",(function(){return c}));var r=n(/*! ./globals */"./src/globals.js"),i=n(/*! ./compat */"./src/compat.js");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=Object(i.getGlobal)(),a=s.document,l=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadPromises={}}var t,n,i;return t=e,(n=[{key:"getResourceUrl",value:function(e){return e.indexOf("://")>0?e:Object(r.getResourceUrl)(e)}},{key:"loadPromiseLibrary",value:function(e,t){if(void 0===s.Promise){var n=this.getResourceUrl("es6-promise.min.js");this.loadScriptIntoDom(n,e,t)}else e()}},{key:"loadScriptIntoDom",value:function(e,t,n){var r=a.createElement("SCRIPT");r.src=e;var i=function(){r.onerror=null,r.onload=null};r.onload=function(){i(),t()},r.onerror=function(t){i(),n&&n(new Error("Error loading script ".concat(e,", with error ").concat(t)))},a.head.appendChild(r)}},{key:"loadScript",value:function(e,t){var n=this;if(t&&void 0!==s[t])return Promise.resolve();var i=(e=this.getResourceUrl(e)).toLowerCase();if(i in this.loadPromises)return this.loadPromises[i];var o=Object(r.getScript)(e);return this.loadPromises[i]=o?Promise.resolve():new Promise((function(t,r){n.loadScriptIntoDom(e,t,r)})),this.loadPromises[i]}},{key:"loadCSS",value:function(e){var t=(e=this.getResourceUrl(e)).toLowerCase();if(e in this.loadPromises)return this.loadPromises[t];var n=this._getLink(e);return this.loadPromises[t]=n?Promise.resolve():new Promise((function(e,t){var n=a.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",href),n.onload=e,n.onerror=t,a.head.appendChild(n)})),this.loadPromises[t]}},{key:"_getLink",value:function(e){for(var t=a.getElementsByTagName("link"),n=0,r=t.length;n<r;n++)if(t[n].href===e)return t[n];return null}}])&&o(t.prototype,n),i&&o(t,i),e}());function c(e,t,n,r){l.loadScript(t,e).then((function(){n&&n()})).catch((function(e){r&&r(e)}))}Object.freeze(l)},"./src/tools/DefaultHandler.js":
/*!*************************************!*\
  !*** ./src/tools/DefaultHandler.js ***!
  \*************************************/
/*! exports provided: DefaultHandler */function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultHandler",(function(){return r}));n(/*! three */"./thirdparty/three.js/three.js");function r(e,t,n){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,r){for(var i=0;i<t.length;++i)switch(t[i]){case"selectOnly":e.selector&&r&&e.selector.setSelection([r.dbId],r.model);break;case"deselectAll":e.selector&&e.selector.setSelection([]);break;case"selectToggle":e.selector&&r&&e.selector.toggleSelection(r.dbId,r.model);break;case"isolate":r&&e.isolate(r.dbId);break;case"showAll":e.showAll();break;case"setCOI":r&&r.intersectPoint&&(n.setPivotPoint(r.intersectPoint,!0,!0),n.pivotActive(!0,!0));break;case"hide":r&&e.hide(r.dbId);break;case"show":r&&e.show(r.dbId);break;case"toggleVisibility":r&&e.toggleVisibility(r.dbId);break;case"focus":e.selector&&(r?e.selector.setSelection([r.dbId],r.model):e.selector.setSelection([]),n.fitToView())}},this.handleSingleClick=function(t,r){var i=t.ctrlKey||t.metaKey,o=t.shiftKey,s=t.altKey;if(0===r){var a=e.clientToViewport(t.canvasX,t.canvasY),l="click";i&&(l+="Ctrl"),o&&(l+="Shift"),s&&(l+="Alt");var c=(u=e.hitTestViewport(a,!1))?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[l]&&this.clickConfig[l][c])return this.handleAction(this.clickConfig[l][c],u),!0}else if(1===r&&o&&!s&&!i){var u;a=e.clientToViewport(t.canvasX,t.canvasY);if((u=e.hitTestViewport(a,!1))&&u.intersectPoint)return n.setPivotPoint(u.intersectPoint,!0,!0),n.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(r,i){if(e.selector&&0===i){var o=e.clientToViewport(r.canvasX,r.canvasY),s=e.hitTestViewport(o,!1);return s?e.selector.setSelection([s.dbId],s.model):e.selector.clearSelection(),n.fitToView(),!0}return 1===i&&(t.fitBounds(!1,n.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(n){if(n.clientX=n.pointers[0].clientX,n.clientY=n.pointers[0].clientY,e.api.triggerSingleTapCallback(n),n.hasOwnProperty("pointers")&&2===n.pointers.length)return t.setRequestHomeView(!0),!0;if(e.selector){var r=e.clientToViewport(n.canvasX,n.canvasY),i=e.hitTestViewport(r,!1);return i?(e.selector.setSelection([i.dbId],i.model),e.api.triggerSelectionChanged([i.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t);var r=this.handleSingleTap(t,0);return n.fitToView(),r},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))},this.handleGesture=function(t){return!!t.type.contains("swipe")&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerSwipeCallback(t))}}},"./src/tools/FovTool.js":
/*!******************************!*\
  !*** ./src/tools/FovTool.js ***!
  \******************************/
/*! exports provided: FovTool */function(e,t,n){"use strict";n.r(t),n.d(t,"FovTool",(function(){return i}));var r=n(/*! three */"./thirdparty/three.js/three.js");function i(e){var t=e.navigation,n=t.getCamera(),i=["fov"],o=!1,s=0,a=null,l=null,c=!1,u=0,d=-5,h=new r.Vector3,f=new r.Vector3,p=new r.Vector3,m=null;function g(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(e){u=0},this.deactivate=function(e){d=-5},this.getCursor=function(){return 0!==u&&-5===d?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var t=f.x-h.x,n=f.y-h.y,r=f.z-h.z;Math.abs(t)<.001&&(t=0),Math.abs(n)<.001&&(n=0),Math.abs(r)<.001&&(r=0),e.set(t,n,r)},this.stepMotionDelta=function(e,t){t?(h.x+=.6*e.x,h.y+=.6*e.y,h.z+=.6*e.z):h.copy(f)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),t=0;return l&&e-l>100?(t=g(s),s=0,a=null,l=null,c=!1):a&&e-a>100&&(c?Math.abs(s)>=3&&(t=s,s=0):(t=g(s),c=!0,s=0)),t},this.update=function(){var e=!1,r=d>-5;if(d>-5){this.controller.setIsLocked(!0),this.getMotionDelta(p);var i=p.x,s=p.y,a=p.z;if(0!==i||0!==s||0!==a)if(r=!0,d>=0)s=-s,0!==(a=Math.abs(i)>Math.abs(s)?i:s)&&(a*=-1,t.setVerticalFov(t.getVerticalFov()*(1+a),!0));else{var l=this.getAccumulatedWheelDelta()/3;0!==l&&t.setFocalLength(t.getFocalLength()+l,!0)}this.stepMotionDelta(p,!0),-1===d&&Math.abs(a)<1e-5&&(this.interactionEnd(-1),e=!0)}return r?this.utilities.pivotActive(t.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!o&&(e||d>-5)&&(d>-1&&h.copy(f),d=-5,this.controller.setIsLocked(!1)),n.dirty},this.interactionStart=function(e,n){(n||e>d)&&(d=e,o=!0),t.toPerspective()},this.interactionEnd=function(e){e===d&&(-1!==e&&this.utilities.pivotActive(!1),o=!1)},this.handleWheelInput=function(e){if(d>-1)return!1;t.getReverseZoomDirection()&&(e*=-1),f.z+=e,s+=e;var n=Date.now();return a||(a=n),l=n,0!=e&&this.interactionStart(-1),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return this.handleButtonUp(e,0);case"drag3start":return m="drag",this.handleButtonDown(e,0);case"drag3move":return"drag"===m&&this.handleMouseMove(e);case"drag3end":return"drag"===m&&this.handleButtonUp(e,0),m=null,!1}return!1},this.handleButtonDown=function(e,t){return u+=1<<t,2!==t&&(h.x=.5*(e.normalizedX+1),h.y=1-.5*(e.normalizedY+1),f.copy(h),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return u-=1<<t,2!==t&&(f.x=.5*(e.normalizedX+1),f.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return f.x=.5*(e.normalizedX+1),f.y=1-.5*(e.normalizedY+1),d>-1},this.handleBlur=function(e){return this.interactionEnd(d),!1}}},"./src/tools/GestureHandler.js":
/*!*************************************!*\
  !*** ./src/tools/GestureHandler.js ***!
  \*************************************/
/*! exports provided: GestureRecognizers, GestureHandler */function(e,t,n){"use strict";n.r(t),n.d(t,"GestureRecognizers",(function(){return o})),n.d(t,"GestureHandler",(function(){return s}));var r,i=n(/*! ../compat */"./src/compat.js");Object(i.isNodeJS)()||(r=n(/*! ../../thirdparty/hammer/hammer.js */"./thirdparty/hammer/hammer.js"));var o={};function s(e){var t=e.navigation,n=["gestures"],s=this,a=!0,l=!1,c=!0,u=null,d=!1,h=Object(i.isTouchDevice)();t.setIsTouchDevice(h),h&&((u=new r.Manager(e.canvasWrap,{recognizers:[o.drag,o.doubletap,o.doubletap2,o.singletap,o.singletap2,o.press,o.drag3,o.swipe,o.pan,o.pinch,o.rotate],handlePointerEventMouse:!1,inputClass:i.isIE11?r.PointerEventInput:r.TouchInput})).get("pinch").recognizeWith([u.get("drag")]),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return n},this.getName=function(){return n[0]},this.isActive=function(){return d},this.__clientToCanvasCoords=function(t){var n,r,i=e.impl.getCanvasBoundingClientRect(),o=i.width,s=i.height;t.hasOwnProperty("center")?(n=t.center.x-i.left,r=t.center.y-i.top):(n=t.pointers[0].clientX-i.left,r=t.pointers[0].clientY-i.top),t.canvasX=n,t.canvasY=r,t.normalizedX=n/o*2-1,t.normalizedY=(s-r)/s*2-1},this.distributeGesture=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handleGesture",e)&&e.preventDefault()},this.onSingleTap=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.onHammerInput=function(e){s.setMouseDisabledWhenTouching(e)},this.setMouseDisabledWhenTouching=function(e){e.isFirst&&!l?(a=s.controller.enableMouseButtons(!1),l=!0):e.isFinal&&setTimeout((function(){s.controller.enableMouseButtons(a),l=!1}),10)},this.activate=function(e){u&&!d&&(u.on("dragstart dragmove dragend",this.distributeGesture),u.on("singletap",this.onSingleTap),u.on("singletap2",this.onSingleTap),u.on("doubletap",this.onDoubleTap),u.on("doubletap2",this.onDoubleTap),u.on("press pressup",this.onPressHold),u.on("drag3start drag3move drag3end",this.distributeGesture),u.on("swipeleft swiperight swipeup swipedown",this.distributeGesture),c&&(u.on("panstart panmove panend",this.distributeGesture),u.on("pinchstart pinchmove pinchend",this.distributeGesture),u.on("rotatestart rotatemove rotateend",this.distributeGesture)),u.on("hammer.input",this.onHammerInput),u.get("doubletap2").recognizeWith("doubletap"),u.get("singletap2").recognizeWith("singletap"),u.get("singletap").requireFailure("doubletap"),u.get("swipe").recognizeWith("drag")),d=!0},this.deactivate=function(e){u&&d&&(u.off("dragstart dragmove dragend",this.distributeGesture),u.off("singletap",this.onSingleTap),u.off("singletap2",this.onSingleTap),u.off("doubletap",this.onDoubleTap),u.off("doubletap2",this.onDoubleTap),u.off("press pressup",this.onPressHold),u.off("drag3start drag3move drag3end",this.distributeGesture),u.off("swipeleft swiperight swipeup swipedown",this.distributeGesture),c&&(u.off("panstart panmove panend",this.distributeGesture),u.off("pinchstart pinchmove pinchend",this.distributeGesture),u.off("rotatestart rotatemove rotateend",this.distributeGesture)),u.off("hammer.input",this.onHammerInput)),d=!1},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){c=!1,u&&(u.remove(r.Pan),u.remove(r.Pinch),u.remove(r.Rotate),u.off("panstart panmove panend",this.distributeGesture),u.off("pinchstart pinchmove pinchend",this.distributeGesture),u.off("rotatestart rotatemove rotateend",this.distributeGesture))},this.setGestureParameter=function(e,t,n){var r=u&&u.get(e);return!!r&&(r.options[t]=n,!0)},this.restoreGestureParameterDefault=function(e,t){var n=u&&u.get(e);if(!n)return!1;var r=o[e][1];return n.options[t]=r.hasOwnProperty(t)?r[t]:n.defaults[t],!0}}r&&function(){if(!o.singletap){var e=o;e.singletap=[r.Tap,{event:"singletap",threshold:7,time:400}],e.singletap2=[r.Tap,{event:"singletap2",pointers:2,threshold:7,time:400}],e.press=[r.Press,{event:"press",time:500,threshold:50}],e.doubletap=[r.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],e.doubletap2=[r.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],e.swipe=[r.Swipe,{event:"swipe",pointers:1,threshold:200,velocity:1.7}],e.drag=[r.Pan,{event:"drag",pointers:1}],e.drag3=[r.Pan,{event:"drag3",pointers:3,threshold:15}],e.pan=[r.Pan,{event:"pan",pointers:2,threshold:20}],e.pinch=[r.Pinch,{event:"pinch",pointers:2,enable:!0,threshold:.05}],e.rotate=[r.Rotate,{event:"rotate",pointers:2,enable:!0,threshold:7}]}}()},"./src/tools/HotGestureTool.js":
/*!*************************************!*\
  !*** ./src/tools/HotGestureTool.js ***!
  \*************************************/
/*! exports provided: HotGestureTool */function(e,t,n){"use strict";function r(e){var t=["hottouch"],n={SHIFT:0,ALT:0,CONTROL:0},r=null,i=null,o=!1,s=!1,a=null,l=16,c=17,u=18;this.active=!1,this.getNames=function(){return t},this.getName=function(){return t[0]},this.activate=function(e){this.active=!0},this.deactivate=function(e){this.active=!1},this.isActive=function(){return this.active},this.__checkStart=function(){a&&(this.controller.distributeEvent("handleGesture",a),a=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var t=e.getActiveNavigationTool(),n=!1===o&&!0===s;if(n||!0===o&&!1===s){var a=n?"worldup":"fov";if(t===a)return!1;if(t===r)return e.setActiveNavigationTool(a),r=a,this.__checkStart(),!1;i=t,e.setActiveNavigationTool(a),r=a,this.__checkStart()}else r&&(e.setActiveNavigationTool(i),r=null,i=null);return!1},this.resetKeys=function(){n.SHIFT=0,n.CONTROL=0,n.ALT=0},this.updateModifierState=function(e){n.CONTROL=e.ctrlKey?1:0,n.SHIFT=e.shiftKey?1:0,n.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===a)return!1;switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(a=t,o=!0);break;case"drag3move":break;case"drag3end":o=!1;break;case"rotatestart":e.navigation.isActionEnabled("roll")&&(a=t,s=!0);break;case"rotatemove":break;case"rotateend":s=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case l:n.SHIFT=1;break;case c:n.CONTROL=1;break;case u:n.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case l:n.SHIFT=0;break;case c:n.CONTROL=0;break;case u:n.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}}n.r(t),n.d(t,"HotGestureTool",(function(){return r}))},"./src/tools/HotkeyManager.js":
/*!************************************!*\
  !*** ./src/tools/HotkeyManager.js ***!
  \************************************/
/*! exports provided: HotkeyManager */function(e,t,n){"use strict";n.r(t),n.d(t,"HotkeyManager",(function(){return r}));n(/*! ./KeyCode */"./src/tools/KeyCode.js");function r(){var e=[],t=[],n=[],r=[],i=["hotkeys"];function o(e,t){return e-t}function s(){var e,i=t.join();for(e=0;e<r.length;)r[e].keys===i?r.splice(e,1):e++;for(e=0;e<n.length;)n[e].keys!==i?n.splice(e,1):e++}function a(i,o){var a=t.join(),l=t.slice(0),c=t.indexOf(o);c>-1&&t.splice(c,1);var u=t.join(),d=t.slice(0);s();var h,f=[],p=[];for(c=e.length-1;c>=0;c--)(h=e[c]).keys===a&&h.onRelease?f.unshift(h):h.keys===u&&h.onPress&&p.unshift(h);for(c=f.length-1;c>=0&&!(h=f[c]).onRelease(l);c--)h.options.tryUntilSuccess&&r.unshift(h);for(c=p.length-1;c>=0&&!(h=p[c]).onPress(d);c--)h.options.tryUntilSuccess&&n.unshift(h)}return{pushHotkeys:function(t,n,r){if(e.some((function(e){return e.id===t})))return!1;for(var i=0;i<n.length;i++)e.push({id:t,keys:n[i].keycodes.sort(o).join(),onPress:n[i].onPress,onRelease:n[i].onRelease,options:r||{}});return!0},popHotkeys:function(t){for(var n=!1,r=e.length-1;r>=0;r--)e[r].id===t&&(e.splice(r,1),n=!0);return n},handleKeyDown:function(i,o){if(-1===t.indexOf(o)){for(var a=t.join(),l=t.slice(0),c=0;c<t.length&&t[c]<o;)c++;t.splice(c,0,o);var u=t.join(),d=t.slice(0);s();var h,f=[],p=[];for(c=e.length-1;c>=0;c--)(h=e[c]).keys===a&&h.onRelease?f.unshift(h):h.keys===u&&h.onPress&&p.unshift(h);for(c=f.length-1;c>=0&&!(h=f[c]).onRelease(l);c--)h.options.tryUntilSuccess&&r.unshift(h);for(c=p.length-1;c>=0&&!(h=p[c]).onPress(d);c--)h.options.tryUntilSuccess&&n.unshift(h)}},handleKeyUp:a,handleBlur:function(){for(var e=t.length-1;e>=0;e--)a(0,t[e])},getName:function(){return i[0]},getNames:function(){return i},activate:function(){},deactivate:function(){},update:function(){var e,t;for(t=0;t<r.length;)!0===(e=r[t]).onRelease(e.keys.split())?r.splice(t,1):t++;for(t=0;t<n.length;)!0===(e=n[t]).onPress(e.keys.split())?n.splice(t,1):t++;return!1}}}},"./src/tools/KeyCode.js":
/*!******************************!*\
  !*** ./src/tools/KeyCode.js ***!
  \******************************/
/*! exports provided: KeyCode */function(e,t,n){"use strict";n.r(t),n.d(t,"KeyCode",(function(){return r}));var r={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,PLUS:107,PLUSMOZ:171,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224}},"./src/tools/Navigation.js":
/*!*********************************!*\
  !*** ./src/tools/Navigation.js ***!
  \*********************************/
/*! exports provided: Navigation */function(e,t,n){"use strict";n.r(t),n.d(t,"Navigation",(function(){return o}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js");function o(e){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=1e-6,this.__minDistance=1e-5;var t=void 0,n=void 0,i=2,o=200,s=null,a={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(e){e!==s&&(s=e,e&&(e.hasOwnProperty("target")||(e.target=new r.Vector3(0,0,0)),e.hasOwnProperty("pivot")||(e.pivot=new r.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return s},this.setScreenViewport=function(e){a=e},this.getScreenViewport=function(){return a},this.__setUp=function(e){if(e&&s&&0!==e.clone().normalize().sub(s.worldup).lengthSq())return s.worldup.copy(e).normalize(),s.dirty=!0,!0;return!1},this.__getUp=function(){return s?s.worldup:new r.Vector3(0,1,0)},this.setView=function(e,t){s&&e&&t&&(s.position.copy(e),s.target.copy(t),s.dirty=!0)},this.orientCameraUp=function(){s&&this.isActionEnabled("roll")&&(s.up.copy(this.getAlignedUpVector()),s.dirty=!0)},this.getPivotPoint=function(){return s?s.pivot.clone():new r.Vector3(0,0,0)},this.setPivotPoint=function(e){s&&e&&(s.pivot.copy(e),s.dirty=!0)},this.getPosition=function(){return s?s.position.clone():new r.Vector3(0,0,1)},this.setPosition=function(e){s&&e&&(s.position.copy(e),s.dirty=!0)},this.setTarget=function(e){s&&e&&(s.target.copy(e),s.dirty=!0)},this.getTarget=function(){return s?s.target.clone():new r.Vector3(0,0,0)},this.getEyeVector=function(){return s?s.target.clone().sub(s.position):new r.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(e){return s?e.center().sub(s.position):new r.Vector3(0,0,-1)},this.getFovMin=function(){return 6.88},this.getFovMax=function(){return 100},this.setZoomInLimitFactor=function(e){o=e},this.getZoomInLimitFactor=function(){return o},this.setZoomOutLimitFactor=function(e){i=e},this.getZoomOutLimitFactor=function(){return i},this.isPointVisible=function(e){return(new r.Frustum).setFromMatrix(s.projectionMatrix.clone().multiply(s.matrixWorldInverse)).containsPoint(e)},this.setVerticalFov=function(e,t){if((!s||s.isPerspective)&&(e<6.88?e=6.88:e>100&&(e=100),s&&this.isActionEnabled("fov"))){if(Math.abs(s.fov-e)<=1e-6)return;if(t){var n=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),i=this.getPosition(),o=this.getEyeVector(),a=r.Math.degToRad(s.fov),l=r.Math.degToRad(e),c=n?this.getPivotPlaneDistance():o.length(),u=c*Math.tan(.5*a)/Math.tan(.5*l),d=o.normalize().multiplyScalar(c-u);this.setPosition(i.add(d)),n&&this.setTarget(this.getTarget().add(d))}s.setFov(e),s.dirty=!0}},this.applyRotation=function(e,t,n,r){e.sub(n),e.applyAxisAngle(r,t),e.add(n)},this.getSignedAngle=function(e,t,n){var r=e.angleTo(t),i=e.clone().cross(t).normalize();return r*(n.dot(i)>0?1:-1)},this.computeFit=function(t,n,i,o,s){if(!o||o.empty())return{position:t,target:n};s=void 0===s?1:s;for(var a=o.center(),l=o.size(),c=t.clone().sub(n).normalize(),u=Math.tan(r.Math.degToRad(.5*i)),d=0,h=this.computeOrthogonalUp(t,n),f=c.clone().cross(h).normalize(),p=new r.Vector3,m=0===l.z?4:8,g=0;g<m;g++){p.set(0==(1&g)?-.5*l.x:.5*l.x,0==(2&g)?-.5*l.y:.5*l.y,0==(4&g)?-.5*l.z:.5*l.z);var v=0;e.isPerspective&&(v=p.dot(c));var y=Math.abs(p.dot(h)),_=Math.abs(p.dot(f)),b=v+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*y/u;d<b&&(d=b),d<(b=v+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*_/(s*u))&&(d=b)}return a.add(h.multiplyScalar(-d*this.FIT_TO_VIEW_VERTICAL_OFFSET)),a.add(f.multiplyScalar(d*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),c.multiplyScalar(d),{position:a.clone().add(c),target:a}},this.computeOrthogonalUp=function(e,t){var n=this.__getUp(),r=t.clone().sub(e);if(0===r.lengthSq())return r.copy(n);var i=r.clone().cross(n);return 0===i.lengthSq()&&(n.z>n.y?r.y-=1e-4:r.z-=1e-4,i.crossVectors(r,n)),i.cross(r).normalize()},this.fitBounds=function(e,t,n){var r=this.getTarget(),i=this.getPosition();if(!this.isActionEnabled("gotoview")||!t||t.empty())return{position:i,target:r};var o=this.getVerticalFov();if(!n){var a=(t=t.clone()).center(),l=i.clone().sub(r).normalize(),c=this.getSignedAngle(this.getCameraUpVector(),this.getAlignedUpVector(),l);this.applyRotation(t.min,c,a,l),this.applyRotation(t.max,c,a,l),t.setFromPoints([t.min.clone(),t.max.clone()])}var u=this.computeFit(i,r,o,t,s.aspect),d=n?this.computeOrthogonalUp(i,r):s.up;return e?(s.up.copy(d),this.setView(u.position,u.target)):this.setRequestTransitionWithUp(!0,u.position,u.target,o,d),this.setPivotPoint(u.target),this.setPivotSetFlag(!0),u},this.computeOverviewDistance=function(e){if(this.__is2D){var t=e.size(),n=s.aspect,i=t.x/n,o=t.y;return Math.max(i,o)}var a=this.getVerticalFov(),l=(t=e.size()).length();return 0===l&&(l=2),s.isPerspective?.5*l/Math.tan(r.Math.degToRad(.5*a)):l},this.applyDollyConstraint=function(e,r){if(!(t||n||i))return e;var a=e;if((t||i&&r)&&e>1){var l,c=s.isPerspective?this.getEyeToCenterOfBoundsVec(r):this.getEyeVector();l=t?i*this.computeOverviewDistance(t):i*this.computeOverviewDistance(r);var u=Math.abs(l/c.length());u=Math.max(u,1),a=Math.min(a,u)}if((n||o&&r)&&this.__is2D){var d=(n?s.clientHeight/n:this.computeOverviewDistance(r)/o)/-(c=this.getEyeVector()).z;d=Math.min(d,1),a=Math.max(a,d)}return a},this.applyPanningConstraint2D=function(e){if(this.__is2D&&t){var n=s.position.x+e.x,i=s.position.y+e.y;n=r.Math.clamp(n,t.min.x,t.max.x),i=r.Math.clamp(i,t.min.y,t.max.y);var o=n-s.position.x,a=i-s.position.y,l=Math.min(e.x,0),c=Math.min(e.y,0),u=Math.max(e.x,0),d=Math.max(e.y,0);o=r.Math.clamp(o,l,u),a=r.Math.clamp(a,c,d),e.x=o,e.y=a}},this.updateCamera=function(){s&&(s.updateProjectionMatrix(),this.orient(s,s.target,s.position,s.up),s.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,r){t=e,n=r}}o.prototype.constructor=o,o.prototype.setIs2D=function(e){this.__is2D=!!e},o.prototype.getIs2D=function(){return this.__is2D},o.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},o.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},o.prototype.orient=function(){var e,t,n,i;return function(o,s,a,l){e||(e=new r.Matrix4,t=new r.Vector3,n=new r.Vector3,i=new r.Vector3);var c=e.elements;i.subVectors(a,s).normalize(),0===i.lengthSq()&&(i.z=1),t.crossVectors(l,i).normalize(),0===t.lengthSq()&&(l.z>l.y?i.y-=1e-4:i.z+=1e-4,t.crossVectors(l,i).normalize()),n.crossVectors(i,t),c[0]=t.x,c[4]=n.x,c[8]=i.x,c[1]=t.y,c[5]=n.y,c[9]=i.y,c[2]=t.z,c[6]=n.z,c[10]=i.z,o.setRotationFromMatrix(e)}}(),o.prototype.fov2fl=function(e){var t=r.Math.degToRad(e);return t<=0&&(t=1e-4),Math.round(12/Math.tan(.5*t))},o.prototype.fl2fov=function(e){e<=0&&(e=1e-4);var t=2*Math.atan(12/e);return r.Math.radToDeg(t)},o.prototype.setCameraUpVector=function(e){if(this.isActionEnabled("roll")){var t=this.getCamera();t.up.copy(e),t.dirty=!0}},o.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},o.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},o.prototype.getCameraRightVector=function(e){var t=new r.Vector3,n=e?this.getWorldUpVector():this.getCamera().up,i=this.getEyeVector();return t.crossVectors(i,n),0===t.lengthSq()&&(Math.abs(i.z)>=Math.abs(i.y)?n.set(0,1,0):n.set(0,0,1),t.crossVectors(i,n)),t.normalize()},o.prototype.setWorldUpVector=function(e,t){this.isActionEnabled("roll")&&(this.__setUp(e),t&&this.orientCameraUp())},o.prototype.getWorldUpVector=function(){return this.__getUp().clone()},o.prototype.getWorldRightVector=function(){var e=new r.Vector3;return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},o.prototype.getVerticalFov=function(){return this.getCamera().fov},o.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},o.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},o.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},o.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},o.prototype.setReverseHorizontalLookDirection=function(e){this.getIs2D()?i.logger.warn("Bimfish.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!e},o.prototype.setReverseVerticalLookDirection=function(e){this.getIs2D()?i.logger.warn("Bimfish.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!e},o.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},o.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Bimfish.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},o.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Bimfish.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},o.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},o.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},o.prototype.setOrbitPastWorldPoles=function(e){this.getIs2D()?i.logger.warn("Bimfish.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!e},o.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(i.logger.warn("Bimfish.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},o.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},o.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},o.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},o.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},o.prototype.setWheelSetsPivot=function(e){this.__options.wheelSetsPivot=!!e},o.prototype.getWheelSetsPivot=function(){return this.__options.wheelSetsPivot},o.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},o.prototype.getIsLocked=function(){return this.__options.lockNavigation},o.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)e.hasOwnProperty(t)&&(this.__lockSettings[t]=e[t])},o.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},o.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||!0===this.__lockSettings[e]},o.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},o.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},o.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},o.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},o.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},o.prototype.getRequestHomeView=function(){return this.__homeViewRequested},o.prototype.setRequestTransition=function(e,t,n,r,i,o){this.__destinationView=e?{position:t.clone(),coi:n.clone(),fov:r,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:i,pivot:o?o.clone():n.clone()}:null},o.prototype.setRequestTransitionWithUp=function(e,t,n,r,i,o,s){this.__destinationView=e?{position:t.clone(),coi:n.clone(),fov:r,up:i.clone(),worldUp:o||this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():n.clone()}:null},o.prototype.getRequestTransition=function(){return this.__destinationView},o.prototype.setTransitionActive=function(e){this.__transitionActive=!!e},o.prototype.getTransitionActive=function(){return this.__transitionActive},o.prototype.getWorldSize=function(e){var t=this.getCamera(),n=t.aspect,i=2*e*Math.tan(r.Math.degToRad(.5*t.fov)),o=i*n;return new r.Vector2(o,i)},o.prototype.screenToViewport=function(e,t){return e=2*e-1,t=2*(t=1-t)-1,new r.Vector3(e,t,1)},o.prototype.viewportToScreen=function(e,t){return e=(e+1)/2,t=1-(t=(t+1)/2),new r.Vector2(e,t)},o.prototype.getWorldPoint=function(e,t){var n=this.screenToViewport(e,t);e=n.x,t=n.y;var i,o=this.getCamera();o.isPerspective&&(i=(i=new r.Vector3(e,t,1)).unproject(o));var s,a,l=this.getEyeVector(),c=this.getPosition();if(!o.isPerspective||isNaN(i.x)){var u=this.getWorldSize(l.length()),d=this.getCameraRightVector(!1).multiplyScalar(.5*e*u.x),h=this.getCameraUpVector().multiplyScalar(.5*t*u.y);s=l.clone().add(d).add(h).normalize()}else s=i.sub(c).normalize();var f=this.getPivotPoint(),p=s.dot(l);return a=this.__pivotIsSetFlag&&(this.getIs2D()||o.isPerspective&&p>0)?0!==p?Math.abs(f.sub(c).dot(l))/p:f.sub(c).length():o.isPerspective?.5*(o.near+o.far):o.orthoScale,s.multiplyScalar(a).add(c)},o.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),n=this.getPosition();return e.sub(n).dot(t.normalize())},o.prototype.panRelative=function(e,t,n){if(this.isActionEnabled("pan")){var r=this.getScreenViewport(),i=this.getCamera(),o=this.getWorldSize(n),s=e*o.x*r.width/i.clientWidth,a=t*o.y*r.height/i.clientHeight,l=this.getCameraRightVector(!1).multiplyScalar(s),c=this.getCameraUpVector().multiplyScalar(a),u=l.add(c);this.applyPanningConstraint2D(u),this.setView(this.getPosition().add(u),this.getTarget().add(u))}},o.prototype.dollyFromPoint=function(e,t,n){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var r=this.getPosition(),i=this.getEyeVector();if(!this.getCamera().isPerspective){var o=i.lengthSq(),s=i.dot(this.getTarget().sub(t));t=i.clone().multiplyScalar(s/o).add(t)}var a=t.clone().sub(r),l=a.length(),c=l+e;c<this.__minDistance&&(c=this.__minDistance);var u=c/l;if(u=this.applyDollyConstraint(u,n),Math.abs(u-1)>this.__kEpsilon){a.multiplyScalar(u),a.set(-a.x,-a.y,-a.z);var d=a.add(t);i=this.getEyeVector();this.getCamera().isPerspective||i.multiplyScalar(u),this.setView(d,i.add(d))}}},o.prototype.toPerspective=function(){if(this.getIs2D())i.logger.warn("Bimfish.Viewing.Navigation.toPerspective is not applicable to 2D");else{var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)}},o.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},o.snapToAxis=function(e){var t=new r.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e}},"./src/tools/OrbitDollyPanTool.js":
/*!****************************************!*\
  !*** ./src/tools/OrbitDollyPanTool.js ***!
  \****************************************/
/*! exports provided: OrbitDollyPanTool */function(e,t,n){"use strict";n.r(t),n.d(t,"OrbitDollyPanTool",(function(){return s}));var r=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),i=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),o=n(/*! ../application/PreferenceNames */"./src/application/PreferenceNames.js");function s(e,t,n){var i=this;this.setGlobalManager(t.globalManager);var s,a,l=this,c=n&&n.hasOwnProperty("dollyDragScale")?n.dollyDragScale:100,u=-1!=navigator.userAgent.search("Mac OS"),d=t.navigation,h=d.getCamera(),f=["orbit","freeorbit","dolly","pan"],p=f[0],m=[p],g=p,v=null,y=1,_=0,b=0,x=0,w=0,E=!0,A=!1,M=null,S=!1,T=33,C=34,P=37,L=38,D=39,R=40,I=48,j=187,O=189,N=-5,k=new THREE.Vector3,F=new THREE.Vector3,V=new THREE.Vector2,B=new THREE.Vector2,U=new THREE.Vector2,z=new THREE.Vector2,G=new THREE.Vector3,H=new THREE.Vector3,W=new THREE.Vector3,X=new THREE.Vector3,q=new THREE.Vector3,Y=new THREE.Vector3,K=new THREE.Vector3,Q=new THREE.Vector3,Z=new THREE.Vector3,J=new THREE.Quaternion,$=[!1,!1,!1,!1,!1,!1],ee={SHIFT:0,ALT:0,CONTROL:0,SPACE:0};this.active=!1;var te,ne=function(t){e.renderer().rolloverObjectId(0,null,0)},re=n&&n.hasOwnProperty("dollyScrollScale")?n.dollyScrollScale:.6,ie=1,oe=5,se=.025;function ae(e,t){var n=l.getWindow(),r=0,i=0,o=n.innerWidth,s=n.innerHeight;Q.set((e-.5*o-r)/(.5*o),(.5*s+i-t)/(.5*s),0);var a=Q.length();return a>1?Q.normalize():Q.z=Math.sqrt(1-a*a),X.copy(h.position).sub(h.pivot),Y.copy(h.up).setLength(Q.y),Y.add(K.copy(h.up).cross(X).setLength(Q.x)),Y.add(X.setLength(Q.z)),Y}this.getNames=function(){return f},this.getName=function(){return f[0]},this.activate=function(n){this.active=!0,m.push(n),g=n,E=t.prefs.get(o.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR),t.prefs.addListeners(o.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR,this._onPrefCursor),e.canvas.addEventListener("mouseout",ne),t.addEventListener(r.ESCAPE_EVENT,this.handleBlur)},this.deactivate=function(n){this.active=!1,t.prefs.removeListeners(o.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR,this._onPrefCursor);var i=m.length-1;i>0&&m[i]===n&&(m.pop(),g=m[i-1]),0===m.length&&e.canvas.removeEventListener("mouseout",ne),t.removeEventListener(r.ESCAPE_EVENT,this.handleBlur)},this.isActive=function(){return this.active},this.adjustDollyLookSpeed=function(e){0===e?(se=.025,oe=5):((se*=e>0?1.1:.9)<1e-6&&(se=1e-6),(oe*=e>0?1.1:.9)<1e-6&&(oe=1e-6))},this.getDollySpeed=function(e){var t=d.getEyeVector(),n=d.getPosition(),r=e.clone().sub(n).dot(t.normalize())*se;return Math.abs(r)<.01?r<0?-.01:.01:r},this.getDollyScrollScale=function(){return re},this.setDollyScrollScale=function(e){re=e},this.getDollyDragScale=function(){return c},this.setDollyDragScale=function(e){c=e},this.getLookSpeed=function(){return oe},this.coiIsActive=function(){return d.getPivotSetFlag()&&d.isPointVisible(d.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&console.log(this),this.utilities.autocam.orbitMultiplier=this.getLookSpeed()},this.getTriggeredMode=function(){return 1===N&&ee.SHIFT?m[1]:(e=ee,2===N&&e.SHIFT&&!e.ALT&&!e.CONTROL||2===N&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===g&&!e.ALT&&"pinch"!==v||0!==G.z?function(){var e=ee;return!(e.CONTROL||e.ALT||e.SHIFT||2!==N&&1!==N)}()?"pan":"dolly":function(){var e=ee;return 2===N&&!e.SHIFT&&!(e.ALT^e.CONTROL)||2===N&&e.SHIFT&&e.CONTROL||1===N&&!e.SHIFT&&!e.CONTROL||1===N&&e.ALT||1===N&&e.CONTROL&&!e.ALT||0===N&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===g&&1!==N&&!e.ALT&&!("pinch"===v)||e.SPACE}()?"pan":"pan"===v||"pinch"===v?"dollypan":g);var e},this.initTracking=function(e,t){var n;if(h.isPerspective){n=.5*(h.near+h.far);var r=this.utilities.getHitPoint(e,t),i=d.getPosition();if(r&&r.sub){var o=r.sub(i),s=d.getEyeVector().normalize();n=Math.abs(s.dot(o))}else{if(d.getPivotSetFlag()&&d.isPointVisible(d.getPivotPoint())){var a=d.getPivotPlaneDistance();a>1e-5&&(n=a)}}}else n=d.getEyeVector().length();ie=n},this.initOrbit=function(){this.utilities.setTemporaryPivot(h.isPerspective&&d.getPivotPoint().sub(d.getPosition()).dot(d.getEyeVector())<=0?d.getTarget():null)},this.getActiveMode=function(){return p},this.getCursor=function(){if(!E)return null;switch(p){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var n=d&&d.getReverseZoomDirection()?-1.5:1.5;u&&(n*=-1),$[0]&&(F.x+=.01,U.x+=20),$[1]&&(F.x-=.01,U.x-=20),$[2]&&(F.y+=.01,U.y+=20),$[3]&&(F.y-=.01,U.y-=20),$[4]&&(F.z+=n),$[5]&&(F.z-=n);var r=F.x-k.x,i=F.y-k.y,o=F.z-k.z;Math.abs(r)<.001&&(r=0),Math.abs(i)<.001&&(i=0),Math.abs(o)<.001&&(o=0),e.set(r,i,o),t&&t.set(U.x-B.x,U.y-B.y)},this.stepMotionDelta=function(e,t){t?(k.x+=.6*e.x,k.y+=.6*e.y,k.z+=.6*e.z):k.copy(F),B.copy(U)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(te=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),te},this.update=function(){var e,n=!1,r=!1;this.getMotionDelta(G,z);var i=G.x,o=G.y,l=G.z;if(A||this.checkInteractionMode(),(A=N>-1)&&this.controller.setIsLocked(!0),0!==i||0!==o||0!==l){switch(p){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(z.x=-z.x,M&&this.utilities.autocam.orbit(U,M,z.multiplyScalar(2),this.utilities.autocam.startState));break;case"freeorbit":!function(){if(d.isActionEnabled("orbit")){X.subVectors(h.position,h.pivot),q.subVectors(h.position,h.target);var e=q.length();q.normalize();var t=Math.acos(H.dot(W)/H.length()/W.length());t&&(t*=2,Z.crossVectors(H,W).normalize(),J.setFromAxisAngle(Z,-t),X.applyQuaternion(J),h.up.applyQuaternion(J),W.applyQuaternion(J),q.applyQuaternion(J),H.copy(W)),h.position.addVectors(h.pivot,X),h.target.subVectors(h.position,q.multiplyScalar(e)),h.dirty=!0}}();break;case"dolly":var u,m=new THREE.Vector2;l*=re,N>=0?(o=-o,l=Math.abs(i)>Math.abs(o)?i:o,d.getReverseZoomDirection()&&(l*=-1),l*=c,i=0,o=0,m=d.viewportToScreen(0,0)):(e=d.getScreenViewport(),s&&a?(m.x=s/e.width,m.y=a/e.height):m=d.viewportToScreen(0,0)),!d.getIs2D()&&d.getZoomTowardsPivot()?this.coiIsActive()?u=d.getPivotPoint():(m=d.viewportToScreen(0,0),u=d.getWorldPoint(m.x,m.y)):u=d.getWorldPoint(m.x,m.y),d.dollyFromPoint(l*this.getDollySpeed(u),u,this.getFitBounds());break;case"pan":d.panRelative(-i,o,ie);break;case"dollypan":0===i&&0===o||d.panRelative(-i,o,ie),e=d.getScreenViewport(),u=d.getWorldPoint(s/e.width,a/e.height);var g=d.getPosition(),w=d.getIs2D()?g.sub(u).length():ie,E=(_/b-1)*w;d.dollyFromPoint(E,u,this.getFitBounds());var T=new THREE.Vector3,C=new THREE.Quaternion,P=d.getCameraUpVector(),L=T.copy(h.position).sub(h.target).normalize();C.setFromAxisAngle(L,1.2*x),P.applyQuaternion(C),d.getIs2D()||d.setCameraUpVector(P),_=b,y,ie=w+E}r=!0}return this.stepMotionDelta(G,"pan"!==p&&"dollypan"!==p),-1===N&&Math.abs(l)<1e-5&&(this.interactionEnd(-1),n=!0,r=!0),(ee.SHIFT||ee.ALT)&&-1!==f.indexOf(t.getActiveNavigationTool())&&(r=!0),!S&&(n||N>-5)&&(N>-1&&(k.copy(F),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),N=-5,A&&this.controller.setIsLocked(!1),A=!1,M=null,v=null),r?this.utilities.pivotActive(d.getPivotSetFlag(),N<=-1):this.utilities.pivotUpdate(),h.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode();e!==p&&("pan"===(p=e)&&N>-1||"dollypan"===p)&&this.initTracking(k.x,k.y)},this.interactionStart=function(e,t){(t||e>N)&&(N=e,S=!0,e>-1&&("pan"===p&&this.initTracking(k.x,k.y),"orbit"===p&&this.initOrbit()),this.utilities.pivotActive(d.getPivotSetFlag(),-1===e),this.utilities.autocam&&(this.utilities.autocam.sync(h),this.utilities.autocam.startInteraction(B.x,B.y),M=B.clone()))},this.interactionCheck=function(){($[0]||$[1]||$[2]||$[3]||$[4]||$[5]||ee.SHIFT||ee.CONTROL||ee.ALT||ee.SPACE)&&this.interactionStart(-4,!0)},this.interactionEnd=function(e){e===N&&(-1!==e&&this.utilities.pivotActive(!1),S=!1)},this.isInteractionActive=function(){return S},this.handleWheelInput=function(t,n){if(s=n.canvasX,a=n.canvasY,this.isDragging)return!1;if(d.getIs2D()){var r=d.getScreenViewport(),i=e.intersectGround(s+r.width,a+r.height);this.utilities.setPivotPoint(i,!0,!0)}else if(d.getWheelSetsPivot()){var o=e.hitTest(s,a,!0);o&&o.intersectPoint&&this.utilities.setPivotPoint(o.intersectPoint,!0,!0)}return d.getReverseZoomDirection()&&(t*=-1),F.z+=t,0!=t&&this.interactionStart(-1),!0},this.resetKeys=function(){this.autoMove(-1,!1),ee.SHIFT=0,ee.CONTROL=0,ee.ALT=0,ee.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?$[0]=$[1]=$[2]=$[3]=$[4]=$[5]=t:$[e]=t,t||this.interactionEnd(-4),this.interactionCheck())},this.updateModifierState=function(e){ee.CONTROL=u&&e.metaKey||e.ctrlKey?1:0,ee.SHIFT=e.shiftKey?1:0,ee.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e);var n=!1;switch(t){case j:this.adjustSpeed(1),n=!0;break;case O:this.adjustSpeed(-1),n=!0;break;case I:this.adjustSpeed(0),n=!0;break;case P:this.autoMove(0,!0),n=!0;break;case D:this.autoMove(1,!0),n=!0;break;case T:this.autoMove(2,!0),n=!0;break;case C:this.autoMove(3,!0),n=!0;break;case L:this.autoMove(4,!0),n=!0;break;case R:this.autoMove(5,!0),n=!0;break;default:return!1}return this.isDragging||this.interactionStart(-4),n},this.handleKeyUp=function(e,t){this.updateModifierState(e);var n=!1;switch(t){case P:this.autoMove(0,!1),n=!0;break;case D:this.autoMove(1,!1),n=!0;break;case T:this.autoMove(2,!1),n=!0;break;case C:this.autoMove(3,!1),n=!0;break;case L:this.autoMove(4,!1),n=!0;break;case R:this.autoMove(5,!1),n=!0;break;default:return!1}return n&&(this.interactionEnd(-4),S||this.interactionCheck()),n},this.handleDollyPan=function(e){s=e.canvasX,a=e.canvasY;var t=d.getScreenViewport();U.x=s,U.y=a,F.x=U.x/t.width,F.y=U.y/t.height,b=function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,n=e.pointers[1].clientY-e.pointers[0].clientY;return Math.sqrt(t*t+n*n)}(e);var n,r,i=THREE.Math.degToRad(e.rotation);x=i-w,Math.abs(x)>1&&(x=0),w=i,n=e.type,r="start",-1!==n.indexOf(r,n.length-r.length)&&(_=b,1,x=0,w=i),y=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return v="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"!==v&&(this.handleButtonDown(e,0),v="drag"),this.handleMouseMove(e);case"dragend":return"drag"===v&&(this.handleButtonUp(e,0),v=null,!0);case"panstart":return v="pan",this.handlePanStart(e),this.handleDollyPan(e),!0;case"panmove":return"pan"!==v&&(v="pan",this.handlePanStart(e)),this.handleDollyPan(e);case"panend":return"pan"===v&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0);case"pinchstart":return this.isDragging=!0,v="pinch",k.x=.5*(e.normalizedX+1),k.y=1-.5*(e.normalizedY+1),V.set(e.canvasX,e.canvasY),B.set(e.canvasX,e.canvasY),A=!1,this.interactionStart(3),this.handleDollyPan(e),!0;case"pinchmove":return"pinch"===v&&this.handleDollyPan(e);case"pinchend":return"pinch"===v&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),k.x=.5*(e.normalizedX+1),k.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),F.copy(k),U.copy(B),H.copy(ae(e.canvasX,e.canvasY)),W.copy(H),s=e.canvasX,a=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handlePanStart=function(e){return this.isDragging=!0,k.x=.5*(e.normalizedX+1),k.y=1-.5*(e.normalizedY+1),V.set(e.canvasX,e.canvasY),B.set(e.canvasX,e.canvasY),this.interactionStart(3),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),F.x=.5*(e.normalizedX+1),F.y=1-.5*(e.normalizedY+1),U.set(e.canvasX,e.canvasY),W.copy(ae(e.canvasX,e.canvasY)),H.copy(W),s=e.canvasX,a=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(F.x=.5*(t.normalizedX+1),F.y=1-.5*(t.normalizedY+1),U.set(t.canvasX,t.canvasY),W.copy(ae(t.canvasX,t.canvasY)),s=t.canvasX,a=t.canvasY,!0):(k.x=.5*(t.normalizedX+1),k.y=1-.5*(t.normalizedY+1),B.set(t.canvasX,t.canvasY),F.x=k.x,F.y=k.y,U.copy(B),s=t.canvasX,a=t.canvasY,t.target===e.canvas&&e.rolloverObject(s,a),!1)},this.handleBlur=function(e){i.resetKeys(),i.interactionEnd(N)},this._onPrefCursor=function(e){E=e}.bind(this)}i.GlobalManagerMixin.call(s.prototype)},"./src/tools/Selector.js":
/*!*******************************!*\
  !*** ./src/tools/Selector.js ***!
  \*******************************/
/*! exports provided: SelectionType, Selector, MultiModelSelector */function(e,t,n){"use strict";n.r(t),n.d(t,"SelectionType",(function(){return l})),n.d(t,"Selector",(function(){return c})),n.d(t,"MultiModelSelector",(function(){return u}));var r=n(/*! ../wgs/scene/SelectionMode */"./src/wgs/scene/SelectionMode.js"),i=n(/*! ../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),o=n(/*! ../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),a=n(/*! three */"./thirdparty/three.js/three.js"),l={MIXED:1,REGULAR:2,OVERLAYED:3};function c(e,t){var n=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=r.SelectionMode.LEAF_OBJECT,this.lockedNodes=[];var s={};function c(){return t.getData().instanceTree}function u(n){var r=c();if(s[n]>0)s[n]--,0==s[n]&&e.highlightObjectNode(t,n,!1);else if(s[n]<0)throw"Selection State machine broken. Negatively selected object!";r&&r.enumNodeChildren(n,(function(e){u(e)}),!1)}function d(n,r,i){var o=c();if(s[n])s[n]++;else{switch(i){default:case l.MIXED:e.highlightObjectNode(t,n,!0,r);break;case l.REGULAR:e.highlightObjectNode(t,n,!0,!0);break;case l.OVERLAYED:e.highlightObjectNode(t,n,!0,!1)}s[n]=1}o&&o.enumNodeChildren(n,(function(e){d(e,!0,i)}),!1)}function h(e){if(void 0!==e&&n.selectedObjectIds[e])return!0}function f(e,t){if(!n.isNodeSelectionLocked(e)){var r=c();if(t=t||l.MIXED,!r||(e=r.findNodeForSelection(e,n.selectionMode),r.isNodeSelectable(e)))h(e)||(n.selectedObjectIds[e]=t,n.selectionCount++,d(e,!1,t))}}function p(e){h(e)&&(u(e),n.selectedObjectIds[e]=0,n.selectionCount--)}this.getInstanceTree=c,this.hasSelection=function(){return n.selectionCount>0},this.getSelectionLength=function(){return n.selectionCount},this.getSelection=function(){var e=[],t=n.selectedObjectIds;for(var r in t)if(t[r]){var i=parseInt(r);e.push(i)}return e},this.isSelected=function(e){return h(e)},this.clearNodeSelection=function(e){return void 0!==e&&0!==this.selectionCount&&(u(e),delete n.selectedObjectIds[e],!0)},this.clearSelection=function(e){if(this.selectionCount>0){var t=n.selectedObjectIds;for(var r in t){var i=parseInt(r);void 0!==i&&u(i)}return n.selectedObjectIds={},n.selectionCount=0,!0}},this.deselectInvisible=function(){var r=!1,i=n.selectedObjectIds,o=e.visibilityManager;for(var s in i){var a=parseInt(s);a&&!o.isNodeVisible(t,a)&&(p(a),r=!0)}return r},this.toggleSelection=function(e,t){e?h(e)?p(e):f(e,t):o.logger.error("Attempting to select node 0.",Object(i.errorCodeString)(i.ErrorCodes.VIEWER_INTERNAL_ERROR))},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.isNodeSelectionLocked=function(e){if(-1===e)return!1;var t=c();return t?t.isNodeSelectionLocked(e):-1!==n.lockedNodes.indexOf(e)},this.lockSelection=function(e,t){var r=c();function i(e,t){if(e&&-1!==e)if(t)-1===n.lockedNodes.indexOf(e)&&(n.lockedNodes.push(e),n.clearNodeSelection(e));else{var r=n.lockedNodes.indexOf(e);n.lockedNodes.splice(r,1)}}e=Array.isArray(e)?e:[e],r?e.forEach((function(e){r.enumNodeChildren(e,(function(e){r.lockNodeSelection(e,!1),i(e,t),t&&r.lockNodeSelection(e,t)}),!0)})):e.forEach((function(e){i(e,t)}))},this.setSelection=function(e,t){if(!function(e){if(n.selectionCount!==e.length)return!1;for(var t=0;t<e.length;t++)if(!h(e[t]))return!1;return!0}(e)&&(this.clearSelection(!0),null!=e&&0!==e.length))for(var r=0;r<e.length;r++)f(e[r],t)},this.getSelectionBounds=function(){var e=new a.Box3,r=new a.Box3,i=c();if(i){var o=t.getFragmentList(),s=n.selectedObjectIds;for(var l in s){var u=parseInt(l);i.enumNodeFragments(u,(function(t){o.getWorldBounds(t,r),e.union(r)}),!0)}}return e},this.getSelectionVisibility=function(){var e=!1,r=!1,i=n.selectedObjectIds;for(var o in i){var s=parseInt(o);if(s){var a=c();if(a&&a.isNodeHidden(s)?r=!0:e=!0,e&&r)break}}return{hasVisible:e,hasHidden:r,model:t}},this.update2DSelectionHighlighting=function(){if(t.isLoadDone()){var e=t.getPropertyDb();if(!e||e.isLoadDone()){s={};for(var r=n.getSelection(),i=0;i<r.length;i++){var o=r[i];d(o,!1,n.selectedObjectIds[o])}}}},this.dtor=function(){this.selectedObjectIds=null}}function u(e){var t=[];function n(){t.length>1&&o.logger.warn("This selection call does not yet support multiple models.")}function r(){for(var n,r=[],i=0;i<t.length;i++){var o=[],a=[],l=t[i].selector.selectedObjectIds,c=t[i].selector.getInstanceTree();for(var u in l)if(l[u]){var d=parseInt(u);d&&(o.push(d),c&&c.enumNodeFragments(d,(function(e){a.push(e)}),!1))}o.length&&r.push({fragIdsArray:a,dbIdArray:o,nodeArray:o,model:t[i]})}1===t.length&&(n={type:s.SELECTION_CHANGED_EVENT,fragIdsArray:r[0]?r[0].fragIdsArray:[],dbIdArray:r[0]?r[0].dbIdArray:[],nodeArray:r[0]?r[0].dbIdArray:[],model:t[0]},e.api.dispatchEvent(n)),n={type:s.AGGREGATE_SELECTION_CHANGED_EVENT,selections:r},e.api.dispatchEvent(n)}function i(){for(var e=!1,n=0;n<t.length;n++)e=t[n].selector.deselectInvisible()||e;e&&r()}function l(e){e.model.is2d()&&e.model.selector&&e.model.selector.update2DSelectionHighlighting()}this.highlightDisabled=!1,this.highlightPaused=!1,this.selectionDisabled=!1,this.addModel=function(n){-1==t.indexOf(n)&&(n.selector=new c(e,n),t.push(n))},this.removeModel=function(e){var n=t.indexOf(e);e.selector.getSelection();e.selector.clearSelection(),e.selector=null,t.splice(n,1)},this.hasSelection=function(){for(var e=0;e<t.length;e++)if(t[e].selector.hasSelection())return!0;return!1},this.getSelectionLength=function(){for(var e=0,n=0;n<t.length;n++)e+=t[n].selector.getSelectionLength();return e},this.getSelection=function(){return n(),t.length>1&&o.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),t[0]?t[0].selector.getSelection():[]},this.getAggregateSelection=function(){for(var e=[],n=0;n<t.length;n++){var r=t[n].selector.getSelection();r&&r.length&&e.push({model:t[n],selection:r})}return e},this.clearSelection=function(e){for(var n,i=0;i<t.length;i++)t[i].selector.clearSelection(e)&&(n=!0);!e&&n&&r()},this.toggleSelection=function(e,i,o){this.selectionDisabled||(i||(n(),i=t[0]),i.selector.toggleSelection(e,o),r())},this.setSelectionMode=function(e){for(var n=0;n<t.length;n++)t[n].selector.setSelectionMode(e)},this.isNodeSelectionLocked=function(e,r){return r||(n(),r=t[0]),r&&r.selector.isNodeSelectionLocked(e)},this.lockSelection=function(e,r,i){i||(n(),i=t[0]),i&&i.selector.lockSelection(e,r)},this.unlockSelection=function(e,r){var i=this;e||r?(r||(n(),r=t[0]),e=e||r.selector.lockedNodes.slice(),this.lockSelection(e,!1,r)):t.forEach((function(e){var t=e.selector.lockedNodes.slice();i.lockSelection(t,!1,e)}))},this.setSelection=function(e,i,o){if(!this.selectionDisabled){if(e&&0!==e.length){if(i)for(var s=0;s<t.length;s++)t[s]!==i&&t[s].selector.clearSelection();else n(),i=t[0];i.selector.setSelection(e,o)}else this.clearSelection(!0);r()}},this.setAggregateSelection=function(e){if(!this.selectionDisabled){if(e&&0!==e.length)for(var t=0;t<e.length;++t){var n=e[t].model,i=e[t].ids,o=e[t].selectionType;n.selector.setSelection(i,o)}else this.clearSelection(!0);r()}},this.getSelectionBounds=function(){if(1==t.length)return t[0].selector.getSelectionBounds();for(var e=new a.Box3,n=0;n<t.length;n++){var r=t[n].selector.getSelectionBounds();e.union(r)}return e},this.getSelectionVisibility=function(){for(var e={hasVisible:!1,hasHidden:!1,details:[]},n=0;n<t.length;n++){var r=t[n].selector.getSelectionVisibility();e.hasVisible=e.hasVisible||r.hasVisible,e.hasHidden=e.hasHidden||r.hasHidden,e.details.push(r)}return e},this.dtor=function(){for(var e=0;e<t.length;e++)t[e].selector.dtor()},e.api.addEventListener(s.ISOLATE_EVENT,(function(e){i()})),e.api.addEventListener(s.HIDE_EVENT,(function(e){i()})),e.api.addEventListener(s.GEOMETRY_LOADED_EVENT,l),e.api.addEventListener(s.OBJECT_TREE_CREATED_EVENT,l),e.api.addEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,l)}},"./src/tools/ToolController.js":
/*!*************************************!*\
  !*** ./src/tools/ToolController.js ***!
  \*************************************/
/*! exports provided: ToolController */function(e,t,n){"use strict";n.r(t),n.d(t,"ToolController",(function(){return l}));var r=n(/*! ../compat */"./src/compat.js"),i=n(/*! ../logger/Logger */"./src/logger/Logger.js"),o=n(/*! ../application/EventTypes */"./src/application/EventTypes.js"),s=n(/*! ./KeyCode */"./src/tools/KeyCode.js"),a=n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js");function l(e,t,n,a,c){this.setGlobalManager(t.globalManager),this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=n,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var u=-1!==navigator.userAgent.search("Mac OS"),d=-1!==navigator.userAgent.search("Firefox"),h=-1!==navigator.userAgent.search("Chrome"),f=-1!==navigator.userAgent.search("Safari")&&!h,p={},m=[],g=!1,v=-1,y=-1,_=!1,b=null,x=!1,w={},E=this;function A(e){return e.getPriority instanceof Function&&e.getPriority()||0}function M(e,n){return t.navigation.getUseLeftHandedInput()&&0===e||d&&1===e||u&&!f&&0===e&&n.ctrlKey}this.__registerToolByName=function(e,t){p[t]=e},this.registerTool=function(e){var t=e.getNames();if(!t||0===t.length)return i.logger.warn("Cannot register tool with no name."),!1;for(var n=!1,r=0;r<t.length;++r)"default"!==t[r]&&(this.__registerToolByName(e,t[r]),n=!0);return e.utilities=a,e.controller=this,e.register&&e.register(),n},this.deregisterTool=function(e){this.deactivateTool(e.getName());var t=e.getNames();if(!t||0===t.length)return!1;for(var n=t.length;--n>=0;)this.__deregisterToolName(t[n]);return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){e in p&&(!function(e){for(var t=m.length;--t>=0;)m[t].activeName===e&&(p[e].deactivate(e),m.splice(t,1))}(e),delete p[e])},this.getTool=function(e){return p[e]},this.getActiveToolName=function(){var e=m.length;return e>0?m[e-1].activeName:"default"},this.getActiveTool=function(){var e=m.length;return e>0?m[e-1]:p.default},this.isToolActivated=function(e){for(var t=0;t<m.length;t++)if(m[t].activeName===e)return!0;return!1},this.setToolActiveName=function(e){var t=p[e];t&&(t.activeName=e)},this.rearrangeByPriorities=function(){m.sort((function(e,t){return A(e)-A(t)}))},this.activateTool=function(e){if(g)return!1;var n=p[e];if(n){void 0===n.count&&(n.count=0);var r=null;m.length&&"intercept"===m[m.length-1].activeName&&(r=m.pop());for(var s=0,a=0;a<m.length;a++)m[a]===n&&n.count++,A(m[a])<=A(n)&&(s=a+1);return n.activeName=e,0===n.count&&(n.count++,m.splice(s,0,n)),n.activate(e,t),r&&m.push(r),t.dispatchEvent({type:o.TOOL_CHANGE_EVENT,toolName:e,tool:n,active:!0}),!0}return i.logger.warn("activateTool not found: "+e),!1},this.deactivateTool=function(e){if(g)return!1;for(var n=m.length;--n>=0;)if(m[n].activeName===e){var r=p[e];return 1===r.count&&m.splice(n,1),r.count--,r.deactivate(e),t.dispatchEvent({type:o.TOOL_CHANGE_EVENT,toolName:e,tool:r,active:!1}),!0}return i.logger.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(p)},this.setDefaultTool=function(e){var t=this.getDefaultTool();return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return p.default},this.setDefaultTool(c),this.setIsLocked=function(e){var t=g;return g=!!e,t},this.getIsLocked=function(){return g},this.__checkCursor=function(){for(var e=null,n=m.length;--n>=0;){var r=m[n];if(r.getCursor&&(e=r.getCursor()))break}e||(e="auto"),b!=e&&(t.canvas.style.cursor=e,b=e)},this.update=function(e){this.__checkCursor();var n=!1;a&&a.update()&&(n=!0);for(var r=m.length;--r>=0;){var i=m[r];i.update&&i.update(e)&&(n=!0)}if(t.navigation.getCamera().dirty?(t.navigation.updateCamera(),n=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,n)t.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){this.moveDelay-Date.now()>0?n=!0:this.moveDelay=0}return n},this.__clientToCanvasCoords=function(t,n,r){var i=e.getCanvasBoundingClientRect(),o=i.width,s=i.height,a=t.clientX-i.left,l=t.clientY-i.top;t.canvasX=a,t.canvasY=l,t.normalizedX=a/o*2-1,t.normalizedY=(s-l)/s*2-1,n&&n.set(a/o,l/s,0),r&&r.set(a,l)},this.__invokeStack=function(e,t,n){for(var r=m.length;--r>=0;){var i=m[r];if(i&&i[e]&&i[e](t,n))return!0}var o=this.getDefaultTool();return!(!o[e]||!o[e](t,n))},this.distributeEvent=function(e,t,n){return this.__invokeStack(e,t,n)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect());for(var e=m.length;--e>=0;){var n=m[e];n.handleResize&&n.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e);this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e);this.__invokeStack("handleDoubleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e,t)&&(t.preventDefault(),t.stopPropagation())},this.applyButtonMappings=function(e){var n=e.button;return"buttons"in e&&(e.firefoxSpoof?n=0:!_||1&e.buttons?2===n&&1&e.buttons&&(n=0,e.firefoxSpoof=_=!0):(e.firefoxSpoof=!0,_=!1,n=0)),t.navigation.getUseLeftHandedInput()&&(n=0===n?2:2===n?0:n),n},this.applyKeyMappings=function(e){switch(e.keyCode){case s.KeyCode.LCOMMAND:case s.KeyCode.RCOMMAND:case s.KeyCode.COMMANDMOZ:return s.KeyCode.CONTROL;case s.KeyCode.EQUALSMOZ:return s.KeyCode.EQUALS;case s.KeyCode.DASHMOZNEW:case s.KeyCode.DASHMOZ:return s.KeyCode.DASH}return e.keyCode},this.handleKeyDown=function(e){var t=this.applyKeyMappings(e);t&&this.__invokeStack("handleKeyDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleKeyUp=function(e){var t=this.applyKeyMappings(e);t&&this.__invokeStack("handleKeyUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&(e.preventDefault(),e.stopPropagation())},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&(e.preventDefault(),e.stopPropagation())},this.keydown=function(e){if(!l._lastTouchedElement||E.domElement.contains(l._lastTouchedElement)){var t=E.getDocument();if(!(t.activeElement instanceof HTMLInputElement||t.activeElement instanceof HTMLTextAreaElement||t.activeElement instanceof HTMLSelectElement)){if(t.activeElement){var n=t.activeElement.getAttribute("contenteditable");if("true"===n||""===n)return}E.handleKeyDown(e)}}},this.keyup=function(e){E.handleKeyUp(e)},this.mousedown=function(e){var t=E.getDocument();r.isIE11&&Object(r.inFullscreen)(t)||t.activeElement&&t.activeElement.blur&&t.activeElement.blur(),E.__clientToCanvasCoords(e);var n=E.applyButtonMappings(e);if(E.handleButtonDown(e,n),v=e.canvasX,y=e.canvasY,M(n,e)){var i=w,o=void 0!==i.time&&e.timeStamp-i.time<500,s=void 0!==i.x&&void 0!==i.y&&Math.abs(i.x-e.canvasX)<=2&&Math.abs(i.y-e.canvasY)<=2;(!o||!s||i.clickCount&&2<=i.clickCount)&&(i.clickCount=0),i.clickCount?1===i.clickCount&&(i.clickCount=2):(i.clickCount=1,i.x=e.canvasX,i.y=e.canvasY,i.time=e.timeStamp)}E.addDocumentEventListener("mouseup",(function e(t){E.applyButtonMappings(t)===n&&(E.removeDocumentEventListener("mouseup",e),E.mouseup(t))}),!1),E.registerWindowMouseMove()},this.mousemove=function(e){E.__clientToCanvasCoords(e);var t=v-e.canvasX,n=y-e.canvasY;(Math.abs(t)>2||Math.abs(n)>2)&&(v=-1,y=-1),E.handleMouseMove(e)},this.mouseup=function(e){E.__clientToCanvasCoords(e);var t=E.applyButtonMappings(e);E.handleButtonUp(e,t);var n=v-e.canvasX,r=y-e.canvasY;if(v=-1,y=-1,Math.abs(n)<=2&&Math.abs(r)<=2&&E.handleSingleClick(e),M(t,e)){var i=w;2===i.clickCount&&(E.handleDoubleClick(e),i.clickCount=0,i.x=void 0,i.y=void 0,i.time=void 0)}E.unregisterWindowMouseMove()},this.doubleclick=function(e){E.__clientToCanvasCoords(e),v=e.canvasX,y=e.canvasY,E.handleDoubleClick(e)},this.mousewheel=function(e){if(E.scrollInputEnabled){E.__clientToCanvasCoords(e);var t=0;if(e.wheelDelta)t=e.wheelDelta/40;else if(e.detail)t=-e.detail;else if(e.deltaY){var n=d?1:40;t=-e.deltaY/n}E.handleWheelInput(t,e)}},this.blur=function(e){E.handleBlur(e)},this.mouseover=function(e){l._lastTouchedElement=e.target},this.registerWindowMouseMove=function(){E.addWindowEventListener("mousemove",E.mousemove),E.addWindowEventListener("mouseover",E.mouseover),E.domElement.removeEventListener("mousemove",E.mousemove),E.domElement.removeEventListener("mouseover",E.mouseover)},this.unregisterWindowMouseMove=function(){E.removeWindowEventListener("mousemove",E.mousemove),E.removeWindowEventListener("mouseover",E.mouseover),E.domElement.addEventListener("mousemove",E.mousemove),E.domElement.addEventListener("mouseover",E.mouseover)},this.enableMouseButtons=function(e){e&&!x?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&x&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var t=x;return x=e,t},this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),E.addWindowEventListener("keydown",this.keydown,!1),E.addWindowEventListener("keyup",this.keyup,!1),E.addWindowEventListener("blur",this.blur,!1),this.uninitialize=function(){for(x&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),this.removeWindowEventListener("mousemove",E.mousemove),this.removeWindowEventListener("mouseover",E.mouseover)),E.removeWindowEventListener("keydown",this.keydown),E.removeWindowEventListener("keyup",this.keyup),E.removeWindowEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;m.length>0;)this.deactivateTool(m[m.length-1].activeName);p=null,m=null,E=null,a=null,t=null,e=null},this.set2DMode=function(e){},this.setAutocam=function(e){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera();n.sync(e),n.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e}}Object.defineProperty(l,"_lastTouchedElement",{value:null,writable:!0}),a.GlobalManagerMixin.call(l.prototype)},"./src/tools/ToolInterface.js":
/*!************************************!*\
  !*** ./src/tools/ToolInterface.js ***!
  \************************************/
/*! exports provided: ToolInterface */function(e,t,n){"use strict";function r(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.getPriority=function(){return 0},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}n.r(t),n.d(t,"ToolInterface",(function(){return r}))},"./src/tools/UnifiedCamera.js":
/*!************************************!*\
  !*** ./src/tools/UnifiedCamera.js ***!
  \************************************/
/*! exports provided: UnifiedCamera */function(e,t,n){"use strict";n.r(t),n.d(t,"UnifiedCamera",(function(){return i}));var r=n(/*! three */"./thirdparty/three.js/three.js");function i(e,t){r.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.clientWidth=e,this.clientHeight=t,this.target=new r.Vector3(0,0,-1),this.worldup=new r.Vector3(0,1,0),this.orthographicCamera=new r.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new r.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()}i.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,i.prototype=Object.create(r.Camera.prototype),i.prototype.clone=function(){var e=new i(2*this.right,2*this.top);return r.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.clientWidth=this.clientWidth,e.clientHeight=this.clientHeight,e.isPerspective=this.isPerspective,this.updateProjectionMatrix(),e},i.prototype.__computeFovPosition=function(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone();var t,n,i=this.target.clone().sub(this.position),o=i.clone().normalize(),s=r.Math.degToRad(this.fov),a=r.Math.degToRad(e),l=Math.tan(.5*s)/Math.tan(.5*a);this.pivot?(t=(new r.Plane).setFromNormalAndCoplanarPoint(o.clone().negate(),this.pivot).distanceToPoint(this.position),n=o.clone().multiplyScalar(t).add(this.position)):(t=i.length(),n=this.target);t*=l;var c=o.multiplyScalar(-t);return n.clone().add(c)},i.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},i.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var e=i.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,n=t*this.aspect;this.left=this.orthographicCamera.left=-n,this.right=this.orthographicCamera.right=n,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},i.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},i.prototype.setSize=function(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},i.prototype.setFov=function(e){this.fov=e,this.updateProjectionMatrix()},i.prototype.setLens=function(e,t){void 0===t&&(t=24);var n=2*r.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},i.getViewParamsFromBox=function(e,t,n,i,o,s){var a=s||{},l=e.size();if(a.target=e.center(),a.position||(a.position=new r.Vector3),a.up||(a.up=new r.Vector3),t){a.isPerspective=!1;var c=l.x/l.y,u=n;a.orthoScale=u>c?l.y:l.x/u,a.up.set(0,0,1),a.position.copy(a.target),a.position.z+=a.orthoScale,a.target.y+=1e-6*l.y}else a.isPerspective=!0,a.fov=o,a.up.copy(i),a.position.copy(a.target),a.position.z+=1.5*Math.max(l.x,l.y,l.z);return a},i.prototype.setViewFromBox=function(e,t){i.getViewParamsFromBox(e,t,this.aspect,this.up,this.fov,this),this.updateCameraMatrices()},i.prototype.updateCameraMatrices=function(){this.lookAt(this.target),this.updateProjectionMatrix(),this.updateMatrixWorld(),this.matrixWorldInverse.getInverse(this.matrixWorld)},i.prototype.setView=function(e){e.position&&this.position.copy(e.position),e.target&&this.target.copy(e.target),e.up&&this.up.copy(e.up),void 0!==e.isPerspective&&(this.isPerspective=e.isPerspective),void 0!==e.orthoScale&&(this.orthoScale=e.orthoScale),this.updateCameraMatrices()}},"./src/tools/ViewingUtilities.js":
/*!***************************************!*\
  !*** ./src/tools/ViewingUtilities.js ***!
  \***************************************/
/*! exports provided: ViewingUtilities */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewingUtilities",(function(){return i}));var r=n(/*! three */"./thirdparty/three.js/three.js");function i(e,t,n){this.autocam=t,this.viewerImpl=e,this.setGlobalManager(this.viewerImpl.globalManager);var i=n.getCamera(),o={},s={};var a=new function(e){var t=.6,n=0,i=new r.SphereGeometry(1),o=new r.MeshPhongMaterial({color:32512,ambient:32512,opacity:t,transparent:!0}),s=new r.Mesh(i,o),a=e,l=1;a.createOverlayScene("pivot"),s.visible=!1,this.shown=function(){return s.visible},this.show=function(e,r,i){s.scale.x=r*l,s.scale.y=r*l,s.scale.z=r*l,s.position.set(e.x,e.y,e.z),o.opacity=t,s.visible=!0,a.addOverlay("pivot",s),a.invalidate(!1,!1,!0),n=i?Date.now()+500:0},this.hide=function(){s.visible&&(s.visible=!1,a.removeOverlay("pivot",s),a.invalidate(!1,!1,!0),n=0)},this.fade=function(){if(n>0){var e=n-Date.now();if(e<=0)return this.hide(),!0;var r=e/500*t;return o.opacity=r,!0}return!1},this.fading=function(){return n>0},this.setSize=function(e){l=e},this.setColor=function(e,n){o.color=new r.Color(e),void 0!==n&&(t=n,o.opacity=t)}}(this.viewerImpl);this.transitionView=function(e,r,o,s,a,l,c){a=a||n.getWorldUpVector();var u=l?function(e,t,n){var r=t.clone().sub(e);if(0===r.lengthSq())return r.copy(n);var i=r.clone().cross(n);return 0===i.lengthSq()&&(n.z>n.y?r.y-=1e-4:r.z-=1e-4,i.crossVectors(r,n)),i.cross(r).normalize()}(e,r,a):s;u||(u=i.up);var d={position:e,center:r,pivot:c=c||r,fov:o,up:u,worldUp:a,isOrtho:!1===i.isPerspective};t.goToView(d)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){var r=this.viewerImpl.hitTestViewport(n.screenToViewport(e,t),!1);return r?r.intersectPoint:null},this.activatePivot=function(e){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var t=i.isPerspective?n.getPivotPlaneDistance():n.getEyeVector().length(),o=n.getVerticalFov(),s=2*t*Math.tan(r.Math.degToRad(.5*o)),l=n.getScreenViewport(),c=this.getWindow().devicePixelRatio||1,u=5*s/(l.height*c);a.show(n.getPivotPoint(),u,e)}},this.pivotActive=function(e,t){t=t||!1,(e=e&&!n.getIs2D())||!a.shown()?e&&this.activatePivot(t):a.hide()},this.pivotUpdate=function(){a.shown()&&a.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,r){n.setPivotPoint(e),t||n.setTarget(e),r&&n.setPivotSetFlag(!0),this.setTemporaryPivot(null),n.getIs2D()||a.shown()&&this.activatePivot(a.fading())},this.savePivot=function(e){e||(e="default"),o[e]=n.getPivotPoint(),s[e]=n.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),o[e]){var t=s[e];this.setPivotPoint(o[e],!0,t),t||n.setPivotSetFlag(!1),delete o[e],delete s[e]}},this.setTemporaryPivot=function(e){if(e){var t=n.getPivotPoint(),r=n.getPivotSetFlag();this.setPivotPoint(e,!0,r),o.TEMP=t,s.TEMP=r}else delete o.TEMP,delete s.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.setPivotSize=function(e){a.setSize(e)},this.setPivotColor=function(e,t){a.setColor(e,t)},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.selector.getAggregateSelection(),e),this.activatePivot(!0)},this.update=function(){n.getRequestFitToView()&&!n.getTransitionActive()&&(n.setRequestFitToView(!1),this.fitToView()),n.getRequestHomeView()&&!n.getTransitionActive()&&(n.setRequestHomeView(!1),this.goHome());var e=n.getRequestTransition();return e&&!n.getTransitionActive()&&(n.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}}n(/*! ../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js").GlobalManagerMixin.call(i.prototype)},"./src/tools/VisibilityManager.js":
/*!****************************************!*\
  !*** ./src/tools/VisibilityManager.js ***!
  \****************************************/
/*! exports provided: VisibilityManager, MultiModelVisibilityManager */function(e,t,n){"use strict";n.r(t),n.d(t,"VisibilityManager",(function(){return s})),n.d(t,"MultiModelVisibilityManager",(function(){return a}));var r=n(/*! ../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ../application/EventTypes */"./src/application/EventTypes.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]}function a(e){this.viewerImpl=e,this.models=[]}function l(e){var t=e.getAggregateIsolatedNodes();if(1===e.models.length){var n={type:i.ISOLATE_EVENT,nodeIdArray:t.length?t[0].ids:[],model:e.models[0]};e.viewerImpl.api.dispatchEvent(n)}n={type:i.AGGREGATE_ISOLATION_CHANGED_EVENT,isolation:t};e.viewerImpl.api.dispatchEvent(n)}s.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},s.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},s.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},s.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null;t&&this.setVisibilityOnNode(t,e),this.model.getData().is2d&&this.model.setAllVisibility(e)},s.prototype.isNodeVisible=function(e){var t=this.getInstanceTree();return t?!t.isNodeHidden(e):-1==this.hiddenNodes.indexOf(e)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(e))},s.prototype.isolate=function(e){var t=this.getInstanceTree(),n=t?t.getRootId():null,r="number"==typeof e&&e===n||"object"==o(e)&&e.dbId===n;e&&!r?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},s.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0)},s.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.setAllVisibility(!1),this.isolatedNodes=e.slice(0),this.hiddenNodes=[];for(var t=0;t<e.length;t++)this.setVisibilityOnNode(e[t],!0)}else this.isolateNone();this.viewerImpl.invalidate(!0)},s.prototype.hide=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Array.isArray(e)){for(var r=0;r<e.length;++r)this.setVisibilityOnNode(e[r],!1);e.length>0&&(t={type:i.HIDE_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!1),t={type:i.HIDE_EVENT,nodeIdArray:[e],model:this.model};t&&n&&this.viewerImpl.api.dispatchEvent(t)},s.prototype.show=function(e){var t;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!0);e.length>0&&(t={type:i.SHOW_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!0),t={type:i.SHOW_EVENT,nodeIdArray:[e],model:this.model};t&&this.viewerImpl.api.dispatchEvent(t)},s.prototype.toggleVisibility=function(e){var t=this.getInstanceTree().isNodeHidden(e);this.setVisibilityOnNode(e,t);var n={type:t?i.SHOW_EVENT:i.HIDE_EVENT,nodeIdArray:[e],model:this.model};this.viewerImpl.api.dispatchEvent(n)},s.prototype.setVisibilityOnNode=function(e,t){var n=this.viewerImpl,r=this.model,i=this.getInstanceTree(),o=!t,s=r.getData().is2d;this.viewerImpl.matman();i?i.enumNodeChildren(e,(function(e){var n=i.isNodeVisibleLocked(e);if(i.setNodeHidden(e,o&&!n),s){var a=r.reverseMapDbId(e);r.getFragmentList().setObject2DGhosted(a,!t&&!n)}else i.enumNodeFragments(e,(function(e){r.setVisibility(e,t||n)}),!1)}),!0):s?r.getFragmentList().setObject2DGhosted(e,!t):r.setVisibility(e,t),n.sceneUpdated(!1),this.updateNodeVisibilityTracking(e,t)},s.prototype.updateNodeVisibilityTracking=function(e,t){var n=t;if(this.isolatedNodes.length>0){var r=this.isolatedNodes.indexOf(e);n&&-1===r?this.isolatedNodes.push(e):n||-1===r||(this.isolatedNodes.splice(r,1),0===this.isolatedNodes.length&&(this.hiddenNodes=[this.model.getRootId()]))}else{var i=this.hiddenNodes.indexOf(e);n||-1!==i?n&&-1!==i&&this.hiddenNodes.splice(i,1):this.hiddenNodes.push(e)}var o=this.getInstanceTree();o&&o.root&&o.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},s.prototype.toggleNodeVisibleLocked=function(e){var t=this.getInstanceTree().isNodeVisbileLocked(e);this.lockNodeVisible(e,!t)},s.prototype.lockNodeVisible=function(e,t){var n=this,r=this.viewerImpl,i=this.model,o=this.getInstanceTree(),s=i.getData().is2d;if(o){var a=function(e){o.enumNodeChildren(e,(function(e){if(o.lockNodeVisible(e,t),t)if(o.setNodeHidden(e,!1),s){var n=i.reverseMapDbId(e);i.getFragmentList().setObject2DGhosted(n,!1)}else o.enumNodeFragments(e,(function(e){i.setVisibility(e,!0)}),!1)}),!0),t&&(r.sceneUpdated(!0),n.updateNodeVisibilityTracking(e,t))};Array.isArray(e)?e.forEach(a):a(e)}},s.prototype.isNodeVisibleLocked=function(e){var t=this.getInstanceTree();return t&&t.isNodeVisibleLocked(e)},s.prototype.setNodeOff=function(e,t,n,r){var i,o,s=this.viewerImpl,a=this.model,l=this.getInstanceTree(),c=a.getData().is2d;if(!l)return c?a.getFragmentList().setObject2DVisible(e,!t):a.getFragmentList().setFragOff(e,t),void s.sceneUpdated(!0);if(n&&r)if(c)for(var u=0;u<n.length;++u){i=n[u],l.setNodeOff(i,t);var d=a.reverseMapDbId(i);a.getFragmentList().setObject2DVisible(d,!t)}else{for(var h=0;h<n.length;++h)i=n[h],l.setNodeOff(i,t);for(var f=0;f<r.length;++f)o=r[f],a.getFragmentList().setFragOff(o,t)}else l.enumNodeChildren(e,(function(e){if(l.setNodeOff(e,t),c){var n=a.reverseMapDbId(e);a.getFragmentList().setObject2DVisible(n,!t)}else l.enumNodeFragments(e,(function(e){a.getFragmentList().setFragOff(e,t)}),!1)}),!0);s.sceneUpdated(!0)},a.prototype.addModel=function(e){-1==this.models.indexOf(e)&&(e.visibilityManager=new s(this.viewerImpl,e),this.models.push(e))},a.prototype.removeModel=function(e){var t=this.models.indexOf(e);e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},a.prototype.warn=function(){this.models.length>1&&r.logger.warn("This selection call does not yet support multiple models.")},a.prototype.getAggregateIsolatedNodes=function(){for(var e=[],t=this.models,n=0;n<t.length;n++){var r=t[n].visibilityManager.getIsolatedNodes();r&&r.length&&e.push({model:t[n],ids:r})}return e},a.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},a.prototype.getAggregateHiddenNodes=function(){for(var e=[],t=this.models,n=0;n<t.length;n++){var r=t[n].visibilityManager.getHiddenNodes();r&&r.length&&e.push({model:t[n],ids:r})}return e},a.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},a.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},a.prototype.isolate=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.isolate(e),l(this)},a.prototype.aggregateIsolate=function(e,t){if(e&&0!==e.length){var n=this.models.concat();for(a=0;a<e.length;++a){var r=e[a].model,i=e[a].ids||e[a].selection,o=n.indexOf(r);n.splice(o,1),r.visibilityManager.isolate(i)}for(var s=!t||void 0!==t.hideLoadedModels&&t.hideLoadedModels;n.length&&s;)n.pop().visibilityManager.setAllVisibility(!1)}else for(var a=0;a<this.models.length;++a)this.models[a].visibilityManager.isolateNone();l(this)},a.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},a.prototype.aggregateHide=function(e){if(e&&0!==e.length){for(var t=0;t<e.length;++t){var n=e[t].model,r=e[t].ids||e[t].selection;n.visibilityManager.hide(r,1===this.models.length)}var o=this.getAggregateHiddenNodes(),s={type:i.AGGREGATE_HIDDEN_CHANGED_EVENT,hidden:o};this.viewerImpl.api.dispatchEvent(s)}},a.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},a.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},a.prototype.setVisibilityOnNode=function(e,t,n){n||(this.warn(),n=this.models[0]),n.visibilityManager.setVisibilityOnNode(e,t)},a.prototype.toggleVisibleLocked=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibleLocked(e)},a.prototype.lockNodeVisible=function(e,t,n){n||(this.warn(),n=this.models[0]),n.visibilityManager.lockNodeVisible(e,t)},a.prototype.isNodeVisibleLocked=function(e,t){return t||(this.warn(),t=this.models[0]),t.visibilityManager.isNodeVisibleLocked(e,t)},a.prototype.setNodeOff=function(e,t,n,r,i){n||(this.warn(),n=this.models[0]),n.visibilityManager.setNodeOff(e,t,r,i)}},"./src/tools/WorldUpTool.js":
/*!**********************************!*\
  !*** ./src/tools/WorldUpTool.js ***!
  \**********************************/
/*! exports provided: WorldUpTool */function(e,t,n){"use strict";n.r(t),n.d(t,"WorldUpTool",(function(){return o}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ../application/EventTypes */"./src/application/EventTypes.js");function o(e,t){var n,o=t.navigation,s=o.getCamera(),a=["worldup"],l=this,c=(n=new r.Vector3,function(e,t,i,o){var s=new r.Vector3(e,t,i),a=o.dot(s);return n.copy(o),n.multiplyScalar(a),s.sub(n)});var u=2*Math.PI,d=1e-5,h=!1,f=!1,p=!1,m=new function(e,t){var n=2*Math.tan(r.Math.degToRad(15)),i=new r.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),s=new r.Vector3,a=new r.Vector3,l=new r.Quaternion,h=new r.PerspectiveCamera(30,t.aspect,t.near,t.far),f=t,p=1,m=1,g=null,v=null,y=null,_=null,b=null,x=null,w=null,E=null,A=null,M=new Array(6),S=0,T=!1,C=!0,P=0,L=5*Math.PI/180,D=7*Math.PI/180,R=1;function I(e,t){var n=Math.abs(e-t);return n>u?n:Math.min(u-n,n)}function j(e,t){var n=F(e);return n.distanceToSquared(t)<d||(a.set(-t.x,-t.y,-t.z),n.distanceToSquared(a)<d)}function O(e){return e>u?e:e<=0?e+Math.PI:e-Math.PI}function N(e,t,n){var r,i=e.clone().normalize(),o=new Array(3),s=new Array(6);o[0]=c(1,0,0,i),o[1]=c(0,1,0,i),o[2]=c(0,0,1,i);var u=t.clone().cross(i).normalize();for(r=0;r<3;++r){var d=o[r];s[r]=d.length(),s[r]<.1?M[r]=1e3:(d.multiplyScalar(1/s[r]),M[r]=Math.atan2(u.dot(d),t.dot(d)))}for(M[3]=O(M[0]),M[4]=O(M[1]),M[5]=O(M[2]),s[3]=s[0],s[4]=s[1],s[5]=s[2],function(e,t){for(var n=L+D+2*Math.PI/180,r=0;r<6;++r)if(1e3!==M[r])for(var i=r+1;i<6;++i){if(1e3!==M[i])if(I(M[r],M[i])<n){if(e[r]<e[i]&&!j(r,t)||j(i,t)){M[r]=1e3;break}M[i]=1e3}}}(s,n),r=0;r<6;++r)if(1e3!==M[r]){var h=a.set(0,0,1);l.setFromAxisAngle(h,M[r]);var f=a.set(0,.54,0);f.applyQuaternion(l),E[r].position.copy(f),E[r].visible=!0}else E[r].visible=!1}function k(e,t,n,s,a){return x||(x=function(){x=new r.Object3D;var e=new r.RingGeometry(.5-.01*p,.5,60),t=new r.Mesh(e,i);v=t;var n=.007*p,o=new r.BoxGeometry(.93,n,n),s=new r.BoxGeometry(n,.93,n),a=new r.BoxGeometry(n,n,.93);y=new r.Mesh(o,i),_=new r.Mesh(s,i),b=new r.Mesh(a,i),x.add(y),x.add(_),x.add(b),w=new r.Mesh(new r.CircleGeometry(.005),i),x.add(w),E=new Array(6),A=new Array(6);for(var l=0;l<6;++l){var c=.005*p,u=.0025*p;E[l]=new r.Mesh(new r.CircleGeometry(c,16),i),A[l]=new r.Mesh(new r.CircleGeometry(u,16),i),A[l].visible=!1,E[l].add(A[l]),t.add(E[l])}return x.add(t),x}()),o.orient(v,t,h.position,s),N(n,a,s),x.scale.x=e,x.scale.y=e,x.scale.z=e,x.position.copy(t),x}function F(e){if(s.set(0,0,0),e>=0){var t=e>=3?-1:1;0===(e%=3)&&(s.x=t),1===e&&(s.y=t),2===e&&(s.z=t)}return T&&s.multiplyScalar(-1),s}function V(e,t){for(var n=I(M[0],e),r=0,i=1;i<6;++i){var o=I(M[i],e);o<n&&(n=o,r=i)}return n,n<t?r:-1}function B(e){o.setWorldUpVector(e,!0)}function U(e){if(0!==e){var t=30*Math.PI/180,n=a.copy(h.position).sub(g).normalize();l.setFromAxisAngle(n,e);var r=o.getWorldUpVector(),i=Math.abs(n.angleTo(r));(i<t||Math.PI-i<t)&&r.copy(o.getCameraUpVector()),r.applyQuaternion(l),B(r)}}function z(e,t,n,r){return e<t&&F(n).distanceToSquared(r)<d}function G(e,t){e.dot(t)<0&&(t=t.clone().multiplyScalar(-1)),o.orient(w,g,h.position,t),w.position.copy(t.multiplyScalar(.495));for(var n=!1,r=C?D:L,i=0;i<6;++i){var s=I(M[i],S),a=z(s,r,i,e);a&&(n=!0);var l=a?4:3*(1-3*s/Math.PI);l<1&&(l=1),l*=p,A[i].visible=a;var c=E[i];c.scale.x=l,c.scale.y=l,c.scale.z=l}return y.visible=n,_.visible=n,b.visible=n,n}function H(e){(S+=e)>Math.PI?S-=u:S<=-Math.PI&&(S=u+S);var t=function(){if(!C){var e=V(S,L);if(e>=0)return 0,C=!0,S=M[e],F(e)}return!1}();if(t)P=S,B(t);else if(function(){if(C){if(V(S,D)<0)return C=!1,!0;0}return!1}()){U(S-P),P=0}else{if(C)return!1;U(e)}return!0}e.createOverlayScene("roll",null,null,h),this.updateRollCamera=function(e,t){h.position.copy(f.position),h.quaternion.copy(f.quaternion),h.up.copy(f.up),h.aspect=f.aspect,e&&t&&(h.near=t-e,h.far=t+e),h.updateProjectionMatrix()},this.isSnapped=function(){return C},this.resize=function(){var e=R*n,t=e*f.aspect,r=(f.aspect<1?t:e)*m;x.scale.x=r,x.scale.y=r,x.scale.z=r},this.start=function(t,n){this.updateHUD(t,n),e.addOverlay("roll",x)},this.updateHUD=function(e,t){g=e,t<.35?t=.35:t>.8&&(t=.8),m=t,p=.8/t;var r=s.copy(e).sub(f.position),i=(R=r.length())*n,a=i*f.aspect,l=(f.aspect<1?a:i)*t;this.updateRollCamera(l,R);var c=o.getWorldUpVector(),u=o.getCameraUpVector();k(l,e,r,c,u),S=0,P=0;var d=c.dot(u);T=d<0,C=G(c,u)},this.handleRoll=function(e,t,n){if(this.updateRollCamera(),G(o.getWorldUpVector(),o.getCameraUpVector()),0!==e||0!==t){var r=n.x-e-.5,i=n.y-t-.5,s=n.x-.5,a=n.y-.5;return H(Math.atan2(a,s)-Math.atan2(i,r))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),G(o.getWorldUpVector(),o.getCameraUpVector());var t=e-S;return Math.abs(t)>.001&&H(t)},this.end=function(){e.removeOverlay("roll",x)}}(e,s),g=new r.Vector3,v=new r.Vector3,y=new r.Vector3,_=null,b=0;this.getNames=function(){return a},this.getName=function(){return a[0]},this.activate=function(e){t.addEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),p=!1},this.deactivate=function(e){m.end(),t.removeEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),_=null,h=!1,p=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=v.x-g.x,n=v.y-g.y,r=v.z-g.z;Math.abs(t)<.001&&(t=0),Math.abs(n)<.001&&(n=0),Math.abs(r)<.001&&(r=0),e.set(t,n,r)},this.stepMotionDelta=function(){g.copy(v)},this.update=function(){if(!p){var e=o.getEyeVector(),t=.5*(s.near+s.far);e.normalize().multiplyScalar(t);var n=e.add(s.position);this.utilities.savePivot(),this.utilities.setPivotPoint(n,!0,!0),this.utilities.pivotActive(!0);m.start(n,.65),p=!0}var r=f;this.getMotionDelta(y);var i=y.x,a=y.y,l=y.z;return(f||"roll"===_||h&&(0!==i||0!==a||0!==l))&&(f="roll"===_?m.handleRollTouch(b):m.handleRoll(i,a,v)),this.stepMotionDelta(),s.dirty&&(r=!0),r},this.handleResize=function(){m.resize(),f=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return _="drag",this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return _=null,this.handleButtonUp(e,0);case"rotatestart":return t.removeEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),_="roll",b=r.Math.degToRad(e.rotation),{x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,n=e.pointers[1].clientY-e.pointers[0].clientY,r=Math.sqrt(t*t+n*n),i=o.getScreenViewport();return r/Math.min(i.width,i.height)}(e),!0;case"rotatemove":return b=r.Math.degToRad(e.rotation),"roll"===_;case"rotateend":return t.addEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),b=r.Math.degToRad(e.rotation),_=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=o.getEyeVector(),t=.5*(s.near+s.far);e.normalize().multiplyScalar(t);var n=e.add(s.position);m.updateHUD(n,.65)},this.handleButtonDown=function(e,n){return g.x=.5*(e.normalizedX+1),g.y=1-.5*(e.normalizedY+1),v.copy(g),h=!0,_=null,this.controller.setIsLocked(!0),t.removeEventListener(i.CAMERA_CHANGE_EVENT,l.handleCameraChange),!0},this.handleButtonUp=function(e,n){return v.x=.5*(e.normalizedX+1),v.y=1-.5*(e.normalizedY+1),h=!1,f=!0,this.controller.setIsLocked(!1),t.addEventListener(i.CAMERA_CHANGE_EVENT,l.handleCameraChange),!0},this.handleMouseMove=function(e){return v.x=.5*(e.normalizedX+1),v.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return h=!1,_=null,!1}}},"./src/tools/autocam/Autocam.js":
/*!**************************************!*\
  !*** ./src/tools/autocam/Autocam.js ***!
  \**************************************/
/*! exports provided: Autocam */function(e,t,n){"use strict";n.r(t),n.d(t,"Autocam",(function(){return l}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ../../globalization/i18next */"./src/globalization/i18next.js"),o=n(/*! ../../application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),s=Number.MIN_VALUE||3e-308;function a(e){Math.abs(e.x)<1e-12&&Math.abs(e.y)<1e-12?e.set(0,0,e.z>0?1:-1):Math.abs(e.y)<1e-12&&Math.abs(e.z)<1e-12?e.set(e.x>0?1:-1,0,0):Math.abs(e.z)<1e-12&&Math.abs(e.x)<1e-12&&e.set(0,e.y>0?1:-1,0)}function l(e,t,n){var o=this,l=null,c=!1;this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.canvas=n,this.cameraChangedCallback=function(){},this.pivotDisplayCallback=function(){},this.transitionCompletedCallback=function(){};var u,d,h,f,p,m=Date.now(),g=!1;function v(t){c=!0,e.target.copy(o.center),e.pivot.copy(o.pivot),e.worldup?e.worldup.copy(o.sceneUpDirection):e.up.copy(o.sceneUpDirection),o.cameraChangedCallback(t),c=!1}this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.transitionCompletedCallback=null,this.canvas=null},this.registerCallbackCameraChanged=function(e){this.cameraChangedCallback=e},this.registerCallbackPivotDisplay=function(e){this.pivotDisplayCallback=e},this.registerCallbackTransitionCompleted=function(e){this.transitionCompletedCallback=e},this.showPivot=function(e){this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){c||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone();return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho};o.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===e.isPerspective}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),g=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,n=e.target?e.target:this.pivot,r=e.worldup?e.worldup:this.sceneUpDirection;this.homeVector={position:e.position.clone(),up:e.up.clone(),center:n.clone(),pivot:t.clone(),fov:e.fov,worldUp:r.clone(),isOrtho:!1===e.isPerspective},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:n.clone(),pivot:t.clone(),fov:e.fov,worldUp:r.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===e.isPerspective}},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),v(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),v(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var n=this.dir.clone(),r=n.cross(t).normalize();0===r.lengthSq()&&(n.copy(this.dir),t.z>t.y?n.y+=1e-4:n.z+=1e-4,r=n.cross(t).normalize()),e.up.copy(r).cross(this.dir).normalize()},function e(){requestAnimationFrame(e);var t=Date.now();u=t-m,m=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new r.Vector3(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone(),this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e);var _,b,w=new r.Quaternion,E=new r.Quaternion,A=new r.Quaternion,M=new r.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=r.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new r.Vector3(-1,0,0),this.alignDirTable[1]=new r.Vector3(1,0,0),this.alignDirTable[2]=new r.Vector3(0,-1,0),this.alignDirTable[3]=new r.Vector3(0,1,0),this.alignDirTable[4]=new r.Vector3(0,0,-1),this.alignDirTable[5]=new r.Vector3(0,0,1),this.alignDirTable[6]=new r.Vector3(-1,-1,0),this.alignDirTable[7]=new r.Vector3(-1,1,0),this.alignDirTable[8]=new r.Vector3(1,-1,0),this.alignDirTable[9]=new r.Vector3(1,1,0),this.alignDirTable[10]=new r.Vector3(0,-1,-1),this.alignDirTable[11]=new r.Vector3(0,-1,1),this.alignDirTable[12]=new r.Vector3(0,1,-1),this.alignDirTable[13]=new r.Vector3(0,1,1),this.alignDirTable[14]=new r.Vector3(-1,0,-1),this.alignDirTable[15]=new r.Vector3(1,0,-1),this.alignDirTable[16]=new r.Vector3(-1,0,1),this.alignDirTable[17]=new r.Vector3(1,0,1),this.alignDirTable[18]=new r.Vector3(-1,-1,-1),this.alignDirTable[19]=new r.Vector3(-1,-1,1),this.alignDirTable[20]=new r.Vector3(-1,1,-1),this.alignDirTable[21]=new r.Vector3(-1,1,1),this.alignDirTable[22]=new r.Vector3(1,-1,-1),this.alignDirTable[23]=new r.Vector3(1,-1,1),this.alignDirTable[24]=new r.Vector3(1,1,-1),this.alignDirTable[25]=new r.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new r.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var S,T,C={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=C,this.zoomDelta=new r.Vector2;var P,L=new r.Vector3,D=new r.Vector3;function R(e,t){var n=new r.Vector2(0,0),i=o.getWindow();return n.x=e/i.innerWidth,n.y=t/i.innerHeight,n}function I(e,t,n){var r,i,s,a;r=i=s=a=0;var l=0,c=null,u=null,d=o.snapOrbitDeadZone,h=o.orbitMultiplier;return"h"==e?(r=o.snapOrbitThresholdH,i=o.snapOrbitAccelerationAX,s=o.snapOrbitAccelerationBX,a=1-o.snapOrbitAccelerationPointX,u=o.lockDeltaX,c=o.lockedX):(r=o.snapOrbitThresholdV,i=o.snapOrbitAccelerationAY,s=o.snapOrbitAccelerationBY,a=1-o.snapOrbitAccelerationPointY,u=o.lockDeltaY,c=o.lockedY),c?(u+=n)<-d?(l=(u+d)*h*1/s,c=!1):u>d&&(l=(u-d)*h*1/s,c=!1):(l=Math.abs(t)>r?n*h:Math.abs(t)>a*r?n*t>0?n*h*i:n*h*1/i:n*t>0?n*h*s:n*h*1/s)*t>0&&Math.abs(l)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,c=!0,l=t),l}function j(){return o.combined}function O(e,t){var n=!1,r=o.getWindow(),i=r.innerWidth,s=e.x%i,a=r.innerHeight,l=e.y%a,c=s>0?s-t.x:i+s-t.x,u=l>0?l-t.y:a+l-t.y;return Math.abs(c)<30&&Math.abs(u)<30&&(n=!0),n}function N(e,t,n){var i=o.getWindow();if(!P||!e){if(e){var s=new r.Vector2,a=t.x,l=t.y;!function(e,t,n){var r=o.getWindow();n.x=(e.x-t.x)/r.innerWidth,e.x=t.x+(e.x-t.x)%r.innerWidth,n.y=(e.y-t.y)/r.innerHeight,e.y=t.y+(e.y-t.y)%r.innerHeight}(t,n,s),i.innerWidth*s.x,i.innerHeight*s.y,a<n.x?a-=60:a+=60,l<n.y?l-=60:l+=60}P=e}}function k(e){var t=Math.pow(e,2);e<0&&(t=-t);var n=R(0,t),r=.01*(o.maxSceneBound-o.minSceneBound);n.y*=r;var i=o.userHeightSpeed*n.y;return i=function(e,t,n){if(0===t)return 0;var r=e,i=o.saveEye.clone().sub(worldUp.clone().multiplyScalar(n+r)),s=o.saveEye.clone().sub(worldUp.clone().multiplyScalar(n)),a=0,l=(o.maxSceneBound-o.minSceneBound)/1e3;o.topLimit&&t>0?(a=o.maxSceneBound-l,o.topLimit=!1):o.bottomLimit&&t<0?(a=o.minSceneBound+l,o.bottomLimit=!1):a=i.dot(worldUp);var c=s.dot(worldUp);return a<o.minSceneBound?c<o.minSceneBound&&(o.bottomLimit=!0,r=0):a>o.maxSceneBound&&c>o.maxSceneBound&&(o.topLimit=!0,r=0),r}(i,e,o.m_amount)}function F(e){var t=o.sceneFrontDirection.clone().cross(o.sceneUpDirection),n=Math.abs(Math.abs(e.dot(o.sceneUpDirection))-1),r=Math.abs(Math.abs(e.dot(o.sceneFrontDirection))-1),i=Math.abs(Math.abs(e.dot(t))-1);return n<1e-5||r<1e-5||i<1e-5}this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new r.Vector2(0,0),openBracket:new r.Vector2(0,0),openBracketA:new r.Vector2(0,0),openBracketB:new r.Vector2(0,0),openLocationOrigin:new r.Vector2(0,0),locationOffset:new r.Vector2(0,0),snapOffset:new r.Vector2(0,0),slideOffset:new r.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new r.Vector2(0,0),this.menuOrigin=new r.Vector2(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.loadObject=function(e,t,n){(new r.JSONLoader).load(e,(function(e,i){var o=new r.MeshPhongMaterial(i),s=new r.Mesh(e,o);s.scale=t,s.position.copy(n),s.geometry.computeBoundingBox();var a=s.geometry.boundingBox.clone();D.set(a.max.x,a.max.y,a.max.z),L.set(a.min.x,a.min.y,a.min.z),D.multiply(t),L.multiply(t),scene.add(s),objects.push(s)}))},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up);var n=t.worldup?t.worldup:t.up;n.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(n),g&&!this.navApi.getTransitionActive()&&(g=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},r.Box2.prototype.setCenter=function(e){var t=new r.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},r.Box2.prototype.getIcon2DCoords=function(e,t){var n=this.center;t.set((e.x-n.x)/(this.size().x/2),(e.y-n.y)/(this.size().y/2))},r.Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,o=e.w,s=n+n,a=r+r,l=i+i,c=n*s,u=n*a,d=n*l,h=r*a,f=r*l,p=i*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(h+p),t[3]=u-v,t[6]=d+g,t[1]=u+v,t[4]=1-(c+p),t[7]=f-m,t[2]=d-g,t[5]=f+m,t[8]=1-(c+h),this},r.Quaternion.prototype.setFromRotationMatrix3=function(e){var t,n=e.elements,r=n[0],i=n[3],o=n[6],s=n[1],a=n[4],l=n[7],c=n[2],u=n[5],d=n[8],h=r+a+d;return h>0?(t=.5/Math.sqrt(h+1),this.w=.25/t,this.x=(u-l)*t,this.y=(o-c)*t,this.z=(s-i)*t):r>a&&r>d?(t=2*Math.sqrt(1+r-a-d),this.w=(u-l)/t,this.x=.25*t,this.y=(i+s)/t,this.z=(o+c)/t):a>d?(t=2*Math.sqrt(1+a-r-d),this.w=(o-c)/t,this.x=(i+s)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+d-r-a),this.w=(s-i)/t,this.x=(o+c)/t,this.y=(l+u)/t,this.z=.25*t),this},r.Quaternion.prototype.rotate=function(e){var t=(new r.Matrix4).makeRotationFromQuaternion(this).elements,n=(new r.Matrix3).set(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]);return e.applyMatrix3(n)},r.Vector3.prototype.findAngleWith=function(e,t){var n=0,i=this.clone().normalize().clone().dot(e.clone().normalize()),o=this.clone().cross(e).clone().normalize();if(o.clone().length()<s)n=i>0?0:180;else{var a=o.clone().dot(t.clone().normalize());t=a>0?o:-o;var l=(new r.Quaternion).setFromAxisAngle(t,90*r.Math.degToRad);l=l.clone().rotate(e).clone().normalize().clone().dot(this),n=Math.acos(i)*r.Math.radToDeg,Math.abs(n-90)<s&&(n=90),(n<90&&i*l>0||n>90&&i*l<0||90==n&&l>0)&&(n*=-1)}return n=r.Math.degToRad(n)},"contains"in String.prototype||(String.prototype.contains=function(e,t){return-1!==String.prototype.indexOf.call(this,e,t)}),Math.linearClamp=function(e,t,n){return e<=t?0:e>=n?1:(e-t)/(n-t)},Math.easeClamp=function(e,t,n){if(e<=t)return 0;if(e>=n)return 1;var r=(e-t)/(n-t);return.5*(Math.sin((r-.5)*Math.PI)+1)},Math.linearInterp=function(e,t,n){return t*(1-e)+n*e},Math.equalityClamp=function(e,t,n){return e<=t?t:e>=n?n:e},Math.round2=function(e){return Math.round(100*e)/100},Math.round1=function(e){return Math.round(10*e)/10},this.animateTransition=function(t){if(t){var n=!1,r=0;if(this.setCameraOrtho(t.isOrtho),o.elapsedTime>=C.duration)return r=1,o.center.copy(t.center),o.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,(n=!t.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,v(n),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),this.navApi.setTransitionActive(!1),void this.transitionCompletedCallback();this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var i=C.destinationPercent,s=1-(r=Math.easeClamp(o.elapsedTime/C.duration,0,i));o.elapsedTime+=u/500;var a=o.center.clone().multiplyScalar(s).add(t.center.clone().multiplyScalar(r)),l=e.position.clone().multiplyScalar(s).add(t.position.clone().multiplyScalar(r)),c=e.up.clone().multiplyScalar(s).add(t.up.clone().multiplyScalar(r)),d=e.pivot.clone().multiplyScalar(s).add(t.pivot.clone().multiplyScalar(r)),h=this.sceneUpDirection.clone().multiplyScalar(s).add(t.worldUp.clone().multiplyScalar(r)),f=e.fov*s+t.fov*r;o.center.copy(a),o.pivot.copy(d),e.position.copy(l),e.up.copy(c),e.target.copy(a),t.isOrtho||(e.fov=f),e.dirty=!0,(n=h.distanceToSquared(this.sceneUpDirection)>1e-4)&&this.setWorldUpVector(h),e.lookAt(o.center),v(n),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame((function(){o.animateTransition(t)}))}},this.sphericallyInterpolateTransition=function(t){var n,i,s,a=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),o.elapsedTime>=C.duration)a=1,this.currentlyAnimating=!1;else{var l=C.destinationPercent;a=Math.easeClamp(o.elapsedTime/C.duration,0,l),o.elapsedTime+=u/500}if(1===a)i=T.position,n=T.center,s=T.up;else{var c=new r.Matrix3,d=w.clone();d.slerp(E,a),c.makeRotationFromQuaternion(d);var h=Math.linearInterp(a,_,b),f=c.elements;i=(n=S.center.clone().multiplyScalar(1-a).add(T.center.clone().multiplyScalar(a))).clone().sub(new r.Vector3(f[0],f[1],f[2]).multiplyScalar(h)),s=new r.Vector3(f[3],f[4],f[5])}o.center.copy(n),e.position.copy(i),e.up.copy(s),o.navApi.getUsePivotAlways()||o.pivot.copy(n),e.lookAt(o.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame((function(){o.sphericallyInterpolateTransition(t)}))):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),v(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=Math.round1(e.up.x),n=Math.round1(e.up.y),r=Math.round1(e.up.z),i=this.sceneFrontDirection.clone(),o=this.sceneUpDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();i.x=Math.round1(i.x),i.y=Math.round1(i.y),i.z=Math.round1(i.z),o.x=Math.round1(o.x),o.y=Math.round1(o.y),o.z=Math.round1(o.z),s.x=Math.round1(s.x),s.y=Math.round1(s.y),s.z=Math.round1(s.z);var a=s.clone().multiplyScalar(-1),l=o.clone().multiplyScalar(-1),c=i.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(o.x==t&&o.y==n&&o.z==r)return"up";if(l.x==t&&l.y==n&&l.z==r)return"down";if(s.x==t&&s.y==n&&s.z==r)return"right";if(a.x==t&&a.y==n&&a.z==r)return"left";break;case"right":if(o.x==t&&o.y==n&&o.z==r)return"up";if(l.x==t&&l.y==n&&l.z==r)return"down";if(c.x==t&&c.y==n&&c.z==r)return"left";if(i.x==t&&i.y==n&&i.z==r)return"right";break;case"left":if(o.x==t&&o.y==n&&o.z==r)return"up";if(l.x==t&&l.y==n&&l.z==r)return"down";if(i.x==t&&i.y==n&&i.z==r)return"left";if(c.x==t&&c.y==n&&c.z==r)return"right";break;case"back":if(o.x==t&&o.y==n&&o.z==r)return"up";if(l.x==t&&l.y==n&&l.z==r)return"down";if(a.x==t&&a.y==n&&a.z==r)return"right";if(s.x==t&&s.y==n&&s.z==r)return"left";break;case"top":if(c.x==t&&c.y==n&&c.z==r)return"down";if(i.x==t&&i.y==n&&i.z==r)return"up";if(s.x==t&&s.y==n&&s.z==r)return"right";if(a.x==t&&a.y==n&&a.z==r)return"left";break;case"bottom":if(i.x==t&&i.y==n&&i.z==r)return"down";if(c.x==t&&c.y==n&&c.z==r)return"up";if(s.x==t&&s.y==n&&s.z==r)return"right";if(a.x==t&&a.y==n&&a.z==r)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.cube&&this.cube.showCompass(this.cube.prevRenderCompass),this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),v(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front",this.cube.showCompass(!1)),this.sceneUpDirection.copy(e.up.clone()),a(this.sceneUpDirection),this.sceneFrontDirection.copy(this.getView()).normalize(),a(this.sceneFrontDirection),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),a(this.cubeFront),this.orthographicFaces&&this.setCameraOrtho(!0),v(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top",this.cube.showCompass(!1)),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),a(this.sceneUpDirection),this.sceneFrontDirection.copy(e.up),a(this.sceneFrontDirection),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),a(this.cubeFront),v(!0)},this.calculateCubeTransform=function(t){var n=this.sceneUpDirection.clone(),i=this.sceneFrontDirection.clone(),a=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();(S=e.clone()).center=o.center.clone(),S.pivot=o.pivot.clone(),(T=e.clone()).center=o.center.clone(),T.pivot=o.pivot.clone();var l=new r.Vector3(0,0,0);t.contains("back")&&(l=l.add(i)),t.contains("front")&&(l=l.sub(i)),t.contains("top")&&(l=l.add(n)),t.contains("bottom")&&(l=l.sub(n)),t.contains("right")&&(l=l.add(a)),t.contains("left")&&(l=l.sub(a));var c=n,u=l.clone().normalize();if(1-Math.abs(u.dot(n))<s)for(var d=this.getView().normalize(),h=[i.clone(),i.clone().negate(),a.clone(),a.clone().negate()],f=u.dot(n)>0?1:-1,p=d.clone().add(e.up.clone().multiplyScalar(f)).normalize(),m=-2,g=0;g<4;g++){var v=p.dot(h[g]);v>m&&(m=v,c=h[g].multiplyScalar(f))}b=_=this.getView().length(),T.position.copy(T.center.clone().add(l.multiplyScalar(b/l.length()))),T.up.copy(c);var y=S.center.clone().sub(S.position).normalize(),x=y.clone().cross(S.up).normalize(),C=x.clone().cross(y).normalize(),P=new r.Matrix3;P.set(y.x,C.x,x.x,y.y,C.y,x.y,y.z,C.z,x.z),w.setFromRotationMatrix3(P),C=(x=(y=T.center.clone().sub(T.position).normalize()).clone().cross(T.up).normalize()).clone().cross(y).normalize(),P.set(y.x,C.x,x.x,y.y,C.y,x.y,y.z,C.z,x.z),A.setFromAxisAngle(y,0),M.setFromAxisAngle(C,0),E.setFromRotationMatrix3(P),E.multiply(A).multiply(M).normalize()},this.centerShot=function(t){S&&!t||(o.elapsedTime=0,(S=T=e.clone()).center=o.center);var n=o.pivot.clone(),r=n.clone().sub(S.position),i=S.center.clone().sub(S.position).normalize(),s=S.up.clone(),a=i.clone().cross(s).normalize();s=a.clone().cross(i).normalize();var l=a.clone().multiplyScalar(a.dot(r)),c=s.clone().multiplyScalar(s.dot(r)),d=l.clone().add(c);T.position.copy(S.position.clone().add(d)),T.center=n,T.pivot=n;var h=0;if(o.elapsedTime>=C.duration)h=1;else{var f=C.destinationPercent;h=Math.easeClamp(o.elapsedTime/C.duration,0,f),o.elapsedTime+=u/2e3}var p=e.position.clone().multiplyScalar(1-h).add(T.position.clone().multiplyScalar(h)),m=o.center.clone().multiplyScalar(1-h).add(T.center.clone().multiplyScalar(h)),g=o.pivot.clone().multiplyScalar(1-h).add(T.pivot.clone().multiplyScalar(h));e.position.copy(p),o.center.copy(m),o.pivot.copy(g),e.lookAt(o.center),v(!1),1===h?this.addHistoryElement():requestAnimationFrame((function(){o.centerShot(!1)}))},this.levelShot=function(){var t=this.getView(),n=t.length(),r=this.sceneUpDirection.clone(),i=e.up.clone().normalize(),a=t.normalize(),l=a.dot(r);if(1-Math.abs(l)>s){var c=a.clone().cross(r);(a=r.clone().cross(c)).normalize()}else a=i.clone();a.multiplyScalar(n);var u={center:a.add(e.position),up:r,position:e.position,pivot:o.center.clone().add(a),fov:e.fov,worldUp:r};o.elapsedTime=0,o.animateTransition(u)},this.fitToWindow=function(){var t=this.getView(),n=e.up.clone();t.normalize(),n.normalize(),(T=e.clone()).center=o.center,(n=function(e,t){var n=e.clone();if(Math.abs(n.clone().dot(t))<s)return n.normalize(),n;(n=function(e,t){t.normalize();var n=e.clone().dot(t),r=t.clone().multiplyScalar(n);return r=e.clone().sub(r)}(e,t)).length()<s&&(n=function(e){for(var t=new r.Vector3(0,0,0),n=[new r.Vector3(0,1,0),new r.Vector3(1,0,0),new r.Vector3(0,0,1),new r.Vector3(0,1,1),new r.Vector3(1,0,1),new r.Vector3(1,1,0),new r.Vector3(1,1,1)],i=0;i<7;i++)if(Math.abs(n[i].dot(e))<s){t=n[i];break}return t}(t));return n.normalize(),n}(n,t)).normalize(),T.up.copy(n);var i=t.clone().cross(n);i.normalize();var a=L.clone(),l=D.clone(),c=[a,l],u=new r.Vector3(l.x-a.x,l.y-a.y,l.z-a.z);c[2]=new r.Vector3(l.x,a.y,l.z),c[3]=new r.Vector3(l.x,a.y,a.z),c[4]=new r.Vector3(l.x,l.y,a.z),c[5]=new r.Vector3(a.x,l.y,l.z),c[6]=new r.Vector3(a.x,l.y,a.z),c[7]=new r.Vector3(a.x,a.y,l.z);for(var d=0;d<8;d++){var h=c[d].clone().sub(e.position);c[d].setX(h.clone().dot(i)),c[d].setY(h.clone().dot(n)),c[d].setZ(h.clone().dot(t))}var f,p,m,g,v=r.Math.degToRad(e.topFov),y=r.Math.degToRad(e.bottomFov),_=r.Math.degToRad(e.leftFov),b=r.Math.degToRad(e.rightFov);f=_>=0?Number.MAX_VALUE:s,p=b>=0?Number.MAX_VALUE:s,m=v>=0?Number.MAX_VALUE:s,g=y>=0?Number.MAX_VALUE:s;for(var x=1/Math.tan(b),w=-1/Math.tan(_),E=1/Math.tan(v),A=-1/Math.tan(y),M=0;M<8;M++){var S=c[M].clone(),C=S.z-w*S.x;f=_>=0?Math.min(f,C):Math.max(f,C),C=S.z-x*S.x,p=b>=0?Math.min(p,C):Math.max(p,C),C=S.z-E*S.y,m=v>=0?Math.min(m,C):Math.max(m,C),C=S.z-A*S.y,g=y>=0?Math.min(g,C):Math.max(g,C)}var P=(p-f)/(w-x),R=w*P+f,I=(g-m)/(E-A),j=E*I+m,O=0;if(R<=j){var N=(v-y)/2;if(Math.abs(N)>s){var k=1/Math.tan(N);I=I-j/k+R/k}O=R}else{var F=(b-_)/2;if(Math.abs(F)>s){var V=1/Math.tan(F);P=P-R/V+j/V}O=j}var B=new r.Vector3(P,I,O),U=i.clone().multiplyScalar(B.x),z=n.clone().multiplyScalar(B.y),G=t.clone().multiplyScalar(B.z);B=U.clone().add(z.clone().add(G)),T.position.add(B);var H=u.clone().sub(T.position).dot(t);T.center=T.position.clone().add(t.multiplyScalar(H)),T.pivot=u.clone();var W={center:T.center,up:T.up,position:T.position,pivot:T.pivot,fov:e.fov,worldUp:o.sceneUpDirection.clone()};o.elapsedTime=0,o.animateTransition(W)},this.updatePivotPosition=function(t){var n,i=o.getWindow(),s=new r.Vector3(t.x/i.innerWidth*2-1,-t.y/i.innerHeight*2+1,.5);if(s=s.unproject(e),n=new r.Raycaster(e.position,s.sub(e.position).normalize()).intersectObjects(objects),"zoom"==o.mode)if(void 0!==n[0]){var a=n[0].point;o.pivot.copy(a)}else{var l=function(t){var n,i,s=o.getWindow();t.y=Math.abs(t.y-s.innerHeight);var a=e.position,l=o.center.clone().sub(a),c=e.up,u=l.clone().cross(c),d=l.clone().length(),h=d*Math.tan(r.Math.degToRad(e.leftFov)),f=d*Math.tan(r.Math.degToRad(e.rightFov)),p=d*Math.tan(r.Math.degToRad(e.topFov)),m=d*Math.tan(r.Math.degToRad(e.bottomFov)),g=h+f,v=p+m,y=t.x*g/s.innerWidth-h,_=t.y*v/s.innerHeight-m;return c=c.clone().normalize().clone().multiplyScalar(_),u=u.clone().normalize().clone().multiplyScalar(y),o.ortho?(n=a.clone().add(u).clone().add(c),i=l):(n=a,i=l.clone().add(c).clone().add(u)),{rayO:n,rayD:i}}(t);o.pivot.copy(l.rayO.clone().add(l.rayD))}else if(void 0!==n[0]){wheel.cursorImage("pivot");a=n[0].point;o.isMouseDown||o.pivot.copy(a)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(t,n,i,s,a){var l=new r.Vector3(0,1,0),c=e.position.clone().dot(l);Math.linearClamp(c,o.minSceneBound,o.maxSceneBound)},this.drawDropdownMenu=function(e,t,n,r,o,s,a){var c=0,u=this.getDocument();if(l)s.appendChild(l);else{(l=u.createElement("div")).className="dropDownMenu",l.style.top="100px",l.style.left="-400px";for(var d=0,h=0,f=0;f<e.length;f++){var p;if(null===e[f])(p=u.createElement("li")).style.height="1px",d+=1,p.style.backgroundColor="#E0E0E0";else{var m=i.i18n.translate(e[f]);if(h=m.length>h?m.length:h,n[f]){p=u.createElement("div");var g=u.createElement("input"),v=u.createElement("label");g.type="radio",g.className="dropDownMenuCheck",v.innerHTML=m,v.className="dropDownMenuCheckText",p.appendChild(g),p.appendChild(v),p.className="dropDownMenuCheckbox"}else(p=u.createElement("li")).textContent=m,p.className=t[f]?"dropDownMenuItem":"dropDownMenuItemDisabled";p.id="menuItem"+c,c++,d+=25,p.setAttribute("data-i18n",e[f])}l.appendChild(p)}s.appendChild(l),l.style.minWidth=Math.max(256,7.4*h)+"px";var y=l.getBoundingClientRect().width;this.menuSize.x=y,this.menuSize.y=d}c=0;for(f=0;f<e.length;f++)if(null!==e[f]){if(n[f]){var _="menuItem"+c,b=u.getElementById(_);b&&(b.children[0].checked=n[f]())}c++}var x=o-15,w=r+1,E=this.canvas.getBoundingClientRect();w+this.menuSize.x>E.right&&(w=r-this.menuSize.x-1),x+this.menuSize.y>E.bottom&&(x=E.bottom-this.menuSize.y),x-=a.y,w-=a.x,l.style.top=x+"px",l.style.left=w+"px",this.menuOrigin.x=w,this.menuOrigin.y=x},this.removeDropdownMenu=function(e){e.removeChild(l)},this.isFaceView=function(){return F(this.center.clone().sub(e.position).normalize())&&F(e.up)},this.startInteraction=function(e,t){this.startCursor=new r.Vector2(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new r.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,n,i,s){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var a="wheel";if(o.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),s&&s.saveEye.copy(this.camera.position)),s&&(a="cube"),"cube"==a?(this.saveCenter.copy(s.saveCenter),this.saveEye.copy(s.saveEye),this.savePivot.copy(s.savePivot),this.saveUp.copy(s.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),j()&&null==h&&(h=this.saveCenter.clone(),d=this.saveEye.clone(),p=this.savePivot.clone(),f=this.saveUp.clone()),this.preserveOrbitUpDirection){var l=R(t.x-n.x,t.y-n.y),c=R(i.x,i.y),u=this.sceneUpDirection.clone(),m=this.sceneFrontDirection.clone(),g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),y=j()?p:this.savePivot,_=j()?d:this.saveEye,b=j()?h:this.saveCenter,x=j()?f:this.saveUp,w=y.clone().sub(_).normalize(),E=b.clone().sub(_).normalize(),A=E.clone().cross(x),M=_.clone().sub(y).length(),S=_.clone().sub(b).length(),T=w.clone().multiplyScalar(-1),C=E.clone().multiplyScalar(-1),P=A,L=x.clone();if(!this.constrainOrbitHorizontal){u.dot(this.saveUp)<-.009&&(l.x=-l.x,c.x=-c.x);var D=0;D=j()?c.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+I("h",0,-c.x):l.x*this.orbitMultiplier,this.lastSnapRotateX=D;var O=(new r.Quaternion).setFromAxisAngle(u,-D);T.applyQuaternion(O),C.applyQuaternion(O),P.applyQuaternion(O),L.applyQuaternion(O)}if(!this.constrainOrbitVertical){var N=m.clone().multiplyScalar(m.dot(P)),k=g.clone().multiplyScalar(g.dot(P)),F=N.clone().add(k);F.clone().normalize();var V=0;if(j())V=c.y*this.orbitMultiplier;else{var B=I("v",0,c.y);V=this.useSnap?this.lastSnapRotateY+B:l.y*this.orbitMultiplier}var U=(new r.Quaternion).setFromAxisAngle(F,-V);if(this.navApi.getOrbitPastWorldPoles())T.applyQuaternion(U).normalize(),C.applyQuaternion(U).normalize(),L.applyQuaternion(U).normalize();else{var z=L.clone();if(z.applyQuaternion(U).normalize(),u.dot(z)<0){var G=C.clone();G.applyQuaternion(U).normalize();var H=G.angleTo(u);Math.abs(H)>.5*Math.PI&&(H-=H>0?Math.PI:-Math.PI),V-=H,U.setFromAxisAngle(F,-V),T.applyQuaternion(U).normalize(),C.applyQuaternion(U).normalize(),L.applyQuaternion(U).normalize()}else T.applyQuaternion(U).normalize(),C.applyQuaternion(U).normalize(),L.applyQuaternion(U).normalize()}this.lastSnapRotateY=V}var W=T.multiplyScalar(M).add(y);e.position.copy(W),e.up.copy(L),this.center.copy(W),this.center.sub(C.multiplyScalar(S)),j()&&(h.copy(this.center),d.copy(e.position),p.copy(this.pivot),f.copy(e.up))}e.lookAt(this.center),v(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var n=R(t.x,t.y),i=this.userLookSpeed,o=this.getView(),s=e.up,a=o.clone().cross(s).normalize(),l=this.sceneUpDirection.clone(),c=n.clone();c.x*=Math.PI,c.y*=Math.PI/e.aspect,c.multiplyScalar(i);var u=(new r.Quaternion).setFromAxisAngle(a,-c.y);if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var d=s.clone();if(d.applyQuaternion(u).normalize(),d.dot(l)<0){var h=o.clone();h.applyQuaternion(u);var f=h.angleTo(l);Math.abs(f)>.5*Math.PI&&(f-=f>0?Math.PI:-Math.PI),c.y-=f,u.setFromAxisAngle(a,-c.y)}}o=u.clone().rotate(o),(s=u.clone().rotate(s)).normalize();var p=e.keepSceneUpright?l:s,m=(new r.Quaternion).setFromAxisAngle(p,-c.x);o=m.clone().rotate(o),s=m.clone().rotate(s),this.center.copy(o.add(e.position)),e.up.copy(s),e.lookAt(this.center),v(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=R(t.x,t.y);var n=this.getView(),i=e.up.clone().cross(n),o=n.clone().cross(i);i.normalize(),o.normalize(),n.normalize();var s=this.pivot.clone().sub(e.position),a=n.clone().dot(s),l=a*(Math.tan(r.Math.degToRad(e.leftFov))+Math.tan(r.Math.degToRad(e.rightFov))),c=a*(Math.tan(r.Math.degToRad(e.topFov))+Math.tan(r.Math.degToRad(e.bottomFov))),u=t.x*Math.abs(l),d=t.y*Math.abs(c),h=new r.Vector3,f=i.clone().multiplyScalar(u),p=o.clone().multiplyScalar(d);h=f.clone().add(p).clone().multiplyScalar(this.userPanSpeed),e.position.add(h),this.center.add(h),e.lookAt(this.center),v(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var n=this.userZoomSpeed,r=Number.MAX_VALUE,i=t.x+t.y,s=Math.pow(n,i),a=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(s)),l=a.clone().add(o.D.clone().multiplyScalar(o.D.clone().dot(this.pivot.clone().sub(a).clone())));if(!(s>=r)){if(i>0){Math.pow(n,i-0);if(i<0)return void 0;e.position.copy(a),this.center.copy(l);var c=a.clone().sub(this.saveEye).dot(o.D);c>r?(e.position.copy(this.saveEye.sub(o.D).clone().multiplyScalar(r)),r>0?-1:0):-c/r}else e.position.copy(a),this.center.copy(l);e.lookAt(this.center),v(!1)}}},this.walk=function(t,n,i,o,a){if(this.navApi.isActionEnabled("walk")){var l=this.sceneUpDirection.clone(),c=this.sceneFrontDirection.clone(),u=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);O(t,n)?(wheel.cursorImage("SWWalk"),N(!0,t,n),x=n.x,y=n.y):N(!1,t,n),x=t.x,y=t.y;var d=R(x-n.x,y-n.y),h=-d.x,f=-d.y,p=h<0?-1:1,m=f<0?-1:1,g=Math.abs(h),_=Math.abs(f),b=new r.Vector2(30,30);b=R(b.x,b.y),g=O(t,n)?0:Math.abs(h)-b.x,_=O(t,n)?0:Math.abs(f)-b.y;_/=.25;var w=(g=(g/=.25)<1?Math.easeClamp(g,0,1):Math.pow(g,1))>0?g*p:0,E=(_=_<1?Math.easeClamp(_,0,1):Math.pow(_,1))>0?_*m:0,A=this.getView(),M=A.length();A.normalize(),A.clone().cross(e.up).normalize();var S=u.clone().multiplyScalar(u.clone().dot(A)),T=c.clone().multiplyScalar(c.clone().dot(A)).clone().add(S);T=T.clone().length()>s?T.normalize():e.up;var C=E*(1*this.walkMultiplier),P=T,L=Math.cos(.65);1!=L&&(l.clone().dot(e.up)<-s&&l.clone().dot(A)<-L||l.clone().dot(e.up)>s&&l.clone().dot(A)>L)&&(P=-P);var D=-w*this.walkMultiplier*.05,I=e.up;(l.clone().dot(e.up)<-s||Math.abs(l.clone().dot(e.up))<s&&l.clone().dot(A)>s)&&(D=-D),I=l;var j=(new r.Quaternion).setFromAxisAngle(I,D);j.normalize(),(A=j.clone().rotate(A)).normalize(),e.up.copy(j.clone().rotate(e.up)),e.up.normalize(),e.position.add(P.clone().multiplyScalar(C)),this.center.copy(e.position.clone().add(A.clone().multiplyScalar(M))),(P=l).normalize(),0===C&&(C=.01),e.lookAt(this.center),v(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var n=k(t);o.m_amount+=n;var i=new r.Vector3(0,1,0),s=o.saveEye.clone().sub(i.clone().multiplyScalar(o.m_amount)),a=s.clone().dot(i);e.position.copy(s),a<o.minSceneBound&&e.position.add(i.clone().multiplyScalar(o.minSceneBound-a)),a>o.maxSceneBound&&e.position.add(i.clone().multiplyScalar(o.maxSceneBound-a)),this.center.copy(e.position.clone().add(o.saveCenter.clone().sub(o.saveEye))),e.lookAt(this.center),v(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped||this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(e){var t=o.getWindow();this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var n=0;n<this.rewindParams.history.length;n++){var i=n-this.rewindParams.timelineIndex,s=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[n].thumbnailBounds.setCenter(new r.Vector2(e.x+i*s,e.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[n].weight=n==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);s=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=e.clone(),this.rewindParams.openLocationOrigin=e.clone(),this.rewindParams.openBracket=e.clone(),this.rewindParams.openBracketA=new r.Vector2(s,e.y),this.rewindParams.openBracketB=new r.Vector2(t.innerWidth-s,e.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var a=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=a}this.rewindParams.locationOffset=new r.Vector2(0,0),this.rewindParams.snapOffset=new r.Vector2(0,0)},this.slideTimeline=function(e){var t=o.getWindow();if(this.rewindParams.open&&0!==this.rewindParams.history.length){var n=e.clone().add(this.rewindParams.locationOffset),i=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),s=i,a=t.innerWidth-i,l=this.rewindParams.history[0].thumbnailBounds.center().x,c=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,u=0;if(n.x<this.rewindParams.openBracketA.x){var d=l-(u=n.x-this.rewindParams.openBracketA.x);s<d&&(u=Math.min(u+(d-s),0))}if(n.x>this.rewindParams.openBracketB.x){var h=c-(u=n.x-this.rewindParams.openBracketB.x);a>h&&(u=Math.max(u+(h-a),0))}this.rewindParams.openLocation.x+=u,this.rewindParams.openBracketA.x+=u,this.rewindParams.openBracketB.x+=u,this.rewindParams.openBracket.x=n.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var f=new r.Vector2(-u,0),p=n.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));f.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var m=!1;if(this.rewindParams.snappingEnabled)for(var g=0;g<this.rewindParams.history.length;g++){var v=this.rewindParams.history[g].thumbnailBounds.center().add(f);if(Math.abs(v.x-p.x)<4||this.rewindParams.snapped&&Math.abs(v.x-p.x)<16){m=!0,0!==u?(this.rewindParams.snapOffset.x=v.x-p.x,f.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=v.x-p.x,p.x=v.x;break}}this.rewindParams.snapped=m;for(var y=-1,_=0,b=0;b<this.rewindParams.history.length;b++){var x=this.rewindParams.history[b].thumbnailBounds.clone();if(this.rewindParams.history[b].thumbnailBounds.setCenter(this.rewindParams.history[b].thumbnailBounds.center().add(f)),this.rewindParams.history[b].thumbnail){var w=this.rewindParams.history[b].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+b).css("left",w),$("#rewindBorder"+b).css("left",w-4)}var E=new r.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));x.setFromCenterAndSize(x.center(),E);var A=new r.Vector2(0,0);x.getIcon2DCoords(p,A);var M=1-Math.abs(Math.equalityClamp(A.x,-1,1));this.rewindParams.history[b].weight=M,0===b&&p.x<x.center().x&&(this.rewindParams.history[b].weight=1),b===this.rewindParams.history.length-1&&p.x>x.center().x&&(this.rewindParams.history[b].weight=1),_+=this.rewindParams.history[b].weight,this.rewindParams.history[b].weight>y&&(y=this.rewindParams.history[b].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[b].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[b].thumbnailBounds.center().x-p.x,this.rewindParams.timelineIndexSlide=b)}for(var S=0;S<this.rewindParams.history.length;S++)this.rewindParams.history[S].weight=this.rewindParams.history[S].weight/_;var T=this.rewindParams.history[0].thumbnailBounds.center().x,C=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<T?(this.rewindParams.locationOffset.x+=T-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=T):this.rewindParams.openBracket.x>C&&(this.rewindParams.locationOffset.x+=C-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=C)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,o.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var t=this.rewindParams.timelineIndex,n=0;if(o.elapsedTime>=C.duration)n=1;else{var r=C.destinationPercent;n=Math.easeClamp(o.elapsedTime/C.duration,0,r),o.elapsedTime+=u/500}o.center.copy(o.center.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.center.clone().multiplyScalar(n))),e.position.copy(e.position.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.position.clone().multiplyScalar(n))),e.up.copy(this.rewindParams.history[t].camera.up),o.pivot.copy(o.center),e.lookAt(o.center),v(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==n&&requestAnimationFrame((function(){o.animateToRewindIndex()}))},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var t=o.getWindow(),n=new r.PerspectiveCamera(70,t.innerWidth/t.innerHeight,1,1e4);n.center=new r.Vector3(0,0,0),n.pivot=new r.Vector3(0,0,0),n.leftFov=0,n.rightFov=0,n.topFov=0,n.bottomFov=0,n.up.set(0,0,0);for(var i=0;i<this.rewindParams.history.length;i++){var s=this.rewindParams.history[i].camera,a=this.rewindParams.history[i].weight;n.center.add(s.center.clone().multiplyScalar(a)),n.position.add(s.position.clone().multiplyScalar(a)),n.up.add(s.up.clone().multiplyScalar(a)),n.rotation.add(s.rotation.clone().multiplyScalar(a)),n.pivot.add(s.pivot.clone().multiplyScalar(a)),n.leftFov+=s.leftFov*a,n.rightFov+=s.rightFov*a,n.topFov+=s.topFov*a,n.bottomFov+=s.bottomFov*a}e.position.copy(n.position),e.up.copy(n.up),e.rotation=n.rotation,e.leftFov=n.leftFov,e.rightFov=n.rightFov,e.topFov=n.topFov,e.bottomFov=n.bottomFov,o.center.copy(n.center),o.pivot.copy(n.pivot),e.lookAt(o.center),e.up.normalize(),v(!1)}}o.GlobalManagerMixin.call(l.prototype)},"./src/tools/autocam/ViewCube.js":
/*!***************************************!*\
  !*** ./src/tools/autocam/ViewCube.js ***!
  \***************************************/
/*! exports provided: ViewCube */function(e,t,n){"use strict";n.r(t),n.d(t,"ViewCube",(function(){return g}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ../../../thirdparty/three.js/DDSLoader */"./thirdparty/three.js/DDSLoader.js"),o=n(/*! ../../wgs/render/ShaderUtils */"./src/wgs/render/ShaderUtils.js"),s=n(/*! ../../wgs/render/WebGLRenderer */"./src/wgs/render/WebGLRenderer.js"),a=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),l=n(/*! ../../compat */"./src/compat.js"),c=n(/*! ../../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),u=n(/*! ../../file-loaders/net/endpoints */"./src/file-loaders/net/endpoints.js"),d=n(/*! ../../../src/application/GlobalManagerMixin */"./src/application/GlobalManagerMixin.js"),h=Bimfish.Viewing,f=function(e){return Math.abs(e-1)<1e-12},p=function(e){return!(!f(e.length())||!f(Math.abs(e.x))&&!f(Math.abs(e.y))&&!f(Math.abs(e.z)))};function m(e){var t=e/2,n=16711680,i=65280,o=255,s=new r.Matrix4,a=[],l=new r.PlaneBufferGeometry(50,50),c=function(e,t){var n=h.getGlobal().document.createElement("canvas");n.width=n.height=128;var i=n.getContext("2d");i.font="128px Arial",i.fillStyle="rgba(255,255,255,1)",i.textAlign="center",i.textBaseline="middle",i.fillText(e,n.width/2,n.height/2);var o=new r.Texture(n);return o.needsUpdate=!0,new r.Mesh(l,new r.MeshBasicMaterial({map:o,side:r.DoubleSide,transparent:!0,color:t,depthWrite:!1,depthTest:!0}))};this.triadScene=new r.Scene,this.triadLabelScene=new r.Scene;var u=new r.BoxGeometry(e,10,10),d=new r.Mesh(u,new r.MeshBasicMaterial({color:n,shading:r.SmoothShading})),m=new r.Mesh(u,new r.MeshBasicMaterial({color:i,shading:r.SmoothShading})),g=new r.Mesh(u,new r.MeshBasicMaterial({color:o,shading:r.SmoothShading}));d.applyMatrix(s.makeTranslation(5,-t,-t)),m.applyMatrix(s.makeRotationZ(Math.PI/2)),m.applyMatrix(s.makeTranslation(-t,5,-t)),g.applyMatrix(s.makeRotationY(Math.PI/2)),g.applyMatrix(s.makeTranslation(-t,-t,5)),this.triadScene.add(d),this.triadScene.add(m),this.triadScene.add(g);var v=c("X",n),y=c("Y",i),_=c("Z",o),b=function(e){var n=-(50+t)/2-20,r=t+50;v.position.set(r,n,n),y.position.set(n,r,n),_.position.set(n,n,r),e&&(v.position.applyQuaternion(e),y.position.applyQuaternion(e),_.position.applyQuaternion(e))};b(),a.push(v),a.push(y),a.push(_),this.triadLabelScene.add(v),this.triadLabelScene.add(y),this.triadLabelScene.add(_),this.orient=function(e,t){if(p(e)&&p(t)&&!(this.up&&this.front&&e.equals(this.up)&&t.equals(this.front))){this.up=e.clone(),this.front=t.clone();var n,i,o,s,a=0,l=0;e.x?(n="x",i="y",o="z",a=2*Math.PI/3):e.y?(n="y",i="z",o="x"):e.z&&(n="z",i="x",o="y",a=-2*Math.PI/3),f(-t[i])?l=Math.PI:t[o]&&(l=-t[o]*e[n]*Math.PI/2),s=f(-e[n])?Math.PI:0;var c=new r.Quaternion,u=new r.Quaternion,d=new r.Vector3(1,1,1);d.normalize(),u.setFromAxisAngle(d,a),c.setFromAxisAngle(e,l),u.multiply(c),c.setFromAxisAngle(t,s),u.multiply(c),b(u),this.triadScene.setRotationFromQuaternion(u)}},this.getSprites=function(){return a}}function g(e,t,n,h,f){var g=this;d.GlobalManagerMixin.call(this);var v=t,y=t.camera;t.setCube(this),g.currentFace="front",g.showTriad=f&&f.showTriad,g.localizeResourcePath=h;var _,b,x,w,E,A,M,S,T,C,P,L,D,R=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],I=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],j=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],O=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],N=[null,null,function(){return!v.orthographicFaces&&!y.isPerspective},function(){return!v.orthographicFaces&&y.isPerspective},function(){return v.orthographicFaces},null,null,null,null,null,null,null,null],k=[];g.pcam=new r.PerspectiveCamera(45,1,1,2e3),g.ocam=new r.OrthographicCamera(-265,265,265,-265,-1e3,1e3),g.ocam.fov=g.pcam.fov,g.ocam.aspect=g.pcam.aspect,g.camera=y.isPerspective?g.pcam:g.ocam,g.camera.position.copy(y.position),g.center=new r.Vector3(0,0,0),g.camera.lookAt(g.center);var F,V,B,U,z,G,H,W=[],X=[],q=[],Y=[],K=[],Q=null,Z=null,J=null,$=0,ee=0,te=!0,ne=!1,re=!1,ie=!1,oe=-1!=navigator.userAgent.search("Chrome"),se=-1!=navigator.platform.search("Win32"),ae=!1,le=!1,ce=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var ue=function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}},de=function(e){e.preventDefault(),e.stopPropagation();var t=g.getDocument();re=t.pointerLockElement===n||t.mozPointerLockElement===n||t.webkitPointerLockElement===n},he=function(){g.renderCompass?(g.rollMesh.position.set($+30,$+30,0),g.rollLeftMesh.position.set($+30,1.5*$,.1),g.rollRightMesh.position.set(1.5*$,$+30,.1),g.contextMesh.position.set(1.6*$,-1.6*$,0)):(g.rollMesh.position.set(.5*$+20,.5*$+20,0),g.rollLeftMesh.position.set(.5*$+20,$+20,.1),g.rollRightMesh.position.set($+20,.5*$+20,.1),g.contextMesh.position.set($,-$,0))},fe=function(){v.navApi.isActionEnabled("orbit")&&(n.style.opacity="1.0",le=!1),requestAnimationFrame(g.render)},pe=function(e){if(le||v.viewCubeMenuOpen||!v.navApi.isActionEnabled("orbit"))v.navApi.isActionEnabled("orbit")&&(n.style.opacity=1);else{var t=Math.max(4*Math.abs((e.clientX-H.x)/H.w-.5)-1,0),r=Math.max(4*Math.abs((e.clientY-H.y)/H.h-.5)-1,0),i=Math.max(0,Math.min(Math.sqrt(t*t+r*r),1));n.style.opacity=1-i*(1-g.inactiveOpacity)}},me=function(){v.viewCubeMenuOpen||(n.style.opacity=g.inactiveOpacity,le=!0,requestAnimationFrame(g.render))},ge=function(e){var t=new Image,n=g.getWindow(),i=u.endpoint.getUseCredentials()&&(-1===e.indexOf("://")||-1!==e.indexOf(n.location.host));t.crossOrigin=i?"use-credentials":"anonymous";var o=new r.Texture(t);return t.onload=function(){o.needsUpdate=!0,++ee>=11&&requestAnimationFrame(g.render)},t.src=e,o},ve=function(){var e,t,n=[],r=[];for(n[0]=Pe(0,0),n[1]=Pe(0,Math.PI/2),n[2]=Pe(0,-Math.PI/2),n[3]=Pe(0,Math.PI),n[4]=Pe(Math.PI/2,0),n[5]=Pe(Math.PI/2,Math.PI/2),n[6]=Pe(Math.PI/2,-Math.PI/2),n[7]=Pe(Math.PI/2,Math.PI),r[0]=Ce(0,0,0),r[1]=Ce(0,Math.PI/2,0),r[2]=Ce(0,-Math.PI/2,0),r[3]=Ce(0,Math.PI,0),r[4]=Ce(Math.PI/2,0,0),r[5]=Ce(Math.PI/2,Math.PI/2,0),r[6]=Ce(Math.PI/2,-Math.PI/2,0),r[7]=Ce(Math.PI/2,Math.PI,0),r[8]=Ce(0,0,Math.PI/2),r[9]=Ce(0,0,-Math.PI/2),r[10]=Ce(-Math.PI/2,0,-Math.PI/2),r[11]=Ce(-Math.PI,0,-Math.PI/2),W.push(Te(0,0)),W[0].name="front",q.push(W[0]),K.push(W[0]),x.add(W[0]),W.push(Te(0,Math.PI/2)),W[1].name="right",q.push(W[1]),K.push(W[1]),x.add(W[1]),W.push(Te(0,Math.PI)),W[2].name="back",q.push(W[2]),K.push(W[2]),x.add(W[2]),W.push(Te(0,-Math.PI/2)),W[3].name="left",q.push(W[3]),K.push(W[3]),x.add(W[3]),W.push(Te(Math.PI/2,0)),W[4].name="bottom",q.push(W[4]),K.push(W[4]),x.add(W[4]),W.push(Te(-Math.PI/2,0)),W[5].name="top",q.push(W[5]),K.push(W[5]),x.add(W[5]),e=W.length,t=0;t<n.length;t++)W.push(n[t]),W[e+t].name=I[t],x.add(W[e+t]),q.push(W[e+t]),K.push(W[e+t]);for(e=W.length,t=0;t<r.length;t++)W.push(r[t]),W[e+t].name=R[t],x.add(W[e+t]),q.push(W[e+t]),K.push(W[e+t])},ye=function(e,t,n){var i,o=new r.Vector3;if("PerspectiveCamera"===t.type)o.copy(e),o.unproject(t),i=new r.Raycaster(t.position,o.sub(t.position).normalize());else{var s=new r.Vector3;s.copy(e),s.unproject(t),o.copy(t.position).negate().normalize(),i=new r.Raycaster(s,o)}return i.intersectObjects(n)},_e=function(e,t){var n=e.clientX-t.x,i=e.clientY-t.y;return n=n/t.w*2-1,i=(t.h-i)/t.h*2-1,new r.Vector3(n,i,.5)};function be(e,t){var n={};return 0===e.type.indexOf("touch")?e.touches.length>0?(n.clientX=e.touches[0].clientX,n.clientY=e.touches[0].clientY,n.pageX=e.touches[0].pageX,n.pageY=e.touches[0].pageY,n.screenX=e.touches[0].screenX,n.screenY=e.touches[0].screenY,n.movementX=n.screenX-t.prevX,n.movementY=n.screenY-t.prevY,n.which=v.navApi.getUseLeftHandedInput()?3:1):n=t.prevCoords:(n.clientX=e.clientX,n.clientY=e.clientY,n.pageX=e.pageX,n.pageY=e.pageY,n.screenX=e.screenX,n.screenY=e.screenY,n.which=e.which,ne?(n.movementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,n.movementY=e.movementY||e.mozMovementY||e.webkitMovementY||0):(n.movementX=n.screenX-t.prevX,n.movementY=n.screenY-t.prevY)),t.prevX=n.screenX,t.prevY=n.screenY,t.prevCoords=n,n}var xe=function(e){if(e.preventDefault(),e.stopPropagation(),v.navApi.isActionEnabled("orbit")&&!v.currentlyAnimating){var t,r=be(e,g);H=ue(n),n.removeEventListener("mousemove",Me,!1),g.addDocumentEventListener("mouseup",Ae,!1),g.addDocumentEventListener("touchend",Ae,!1),v.navApi.getUsePivotAlways()||(v.pivot.copy(v.center),v.navApi.setPivotPoint(v.center),v.navApi.setPivotSetFlag(!1)),v.startInteraction(r.pageX,r.pageY),0==v.rewindParams.history.length&&v.addHistoryElement(),v.rewindParams.snapped&&v.rewindParams.timelineIndex+1==v.rewindParams.history.length||v.addIntermediateHistoryElement();var i=v.navApi.getUseLeftHandedInput()?1:3;r.which!==i&&(g.animSpeed<=0?a.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation",Object(c.errorCodeString)(c.ErrorCodes.VIEWER_INTERNAL_ERROR)):(t=_e(r,H),ye(t,g.camera,K).length>0&&(Re(),g.draggable&&(g.addDocumentEventListener("mousemove",we,!1),g.addDocumentEventListener("touchmove",we,!1),ne&&(n.requestPointerLock(),ie=oe&&se)))))}},we=function e(t){if(t.preventDefault(),t.stopPropagation(),g.animSpeed<=0)return g.removeDocumentEventListener("mousemove",e,!1),g.removeDocumentEventListener("touchmove",e,!1),void a.logger.error("animSpeed cannot be 0 or less",Object(c.errorCodeString)(c.ErrorCodes.VIEWER_INTERNAL_ERROR));if(!v.currentlyAnimating){var n=be(t,g);ne&&ie&&(ie=!1,n.movementX=n.movementY=0),re&&(n.movementX>300||n.movementY>300)&&(n.movementX=0,n.movementY=0),n.movementX!==n.movementY||0!==n.movementX?(te=!1,ae=!0,v.showPivot(!0),v.currentCursor=new r.Vector2(n.pageX,n.pageY),v.orbit(v.currentCursor,v.startCursor,new r.Vector3(-n.movementX,n.movementY,0),v.startState),g.camera.lookAt(g.center),requestAnimationFrame(g.render)):v.currentlyAnimating=!1}},Ee=function(e){(e||(g.removeDocumentEventListener("mouseup",Ae,!1),g.removeDocumentEventListener("touchend",Ae,!1)),g.removeDocumentEventListener("mousemove",we,!1),g.removeDocumentEventListener("touchmove",we,!1),n.addEventListener("mousemove",Me,!1),re)&&g.getDocument().exitPointerLock()},Ae=function(e){var t,r,i;if(e.preventDefault(),e.stopPropagation(),v.currentlyAnimating||ae)return v.endInteraction(),v.showPivot(!1),ae=!1,void Ee(!1);var o=be(e,g);if(v.viewCubeMenuOpen){var s=o.clientX-H.x,l=o.clientY-H.y;if(v.menuOrigin.x<=s&&s<=v.menuOrigin.x+v.menuSize.x&&v.menuOrigin.y<=l&&l<=v.menuOrigin.y+v.menuSize.y){var c=function(e){a.logger.track({name:"navigation/"+e,aggregate:"count"})};switch(Math.floor((l-5-v.menuOrigin.y)/25)){case 0:c("home"),v.goHome();break;case 1:c("setortho"),v.setOrthographicFaces(!1),v.toOrthographic(),g.camera=g.ocam;break;case 2:c("setpersp"),v.setOrthographicFaces(!1),v.toPerspective(),g.camera=g.pcam;break;case 3:v.setOrthographicFaces(!0),te?(v.toOrthographic(),g.camera=g.ocam):(v.toPerspective(),g.camera=g.pcam);break;case 4:c("sethome"),v.setCurrentViewAsHome(!1);break;case 5:c("focushome"),v.setCurrentViewAsHome(!0);break;case 6:c("resethome"),v.resetHome();break;case 7:c("setfront"),v.setCurrentViewAsFront();break;case 8:c("settop"),v.setCurrentViewAsTop();break;case 9:v.resetOrientation()}}return v.viewCubeMenuOpen=!1,v.removeDropdownMenu(n),(o.clientX<H.x||o.clientX>H.w+H.x||o.clientY<H.y||o.clientY>H.h+H.y)&&me(),g.mouseMoveSave&&g.processMouseMove(g.mouseMoveSave),v.endInteraction(),void Ee(!1)}var u=v.navApi.getUseLeftHandedInput()?1:3;if(o.which===u)return v.viewCubeMenuOpen=!0,v.drawDropdownMenu(j,O,N,o.clientX,o.clientY,n,H),void Ee(!0);var d=_e(o,H);if(t=ye(d,g.camera,K),r=ye(d,S,X),i=ye(d,S,Y),r.length>0&&te){for(var h=["top","bottom","right","left","front","back"],f=v.getOrientation(),p={front:{up:[0,1,2,3],right:[2,3,1,0],down:[1,0,3,2],left:[3,2,0,1]},right:{up:[0,1,5,4],right:[5,4,1,0],down:[1,0,4,5],left:[4,5,0,1]},left:{up:[0,1,4,5],right:[4,5,1,0],down:[1,0,5,4],left:[5,4,0,1]},back:{up:[0,1,3,2],right:[3,2,1,0],down:[1,0,2,3],left:[2,3,0,1]},top:{up:[5,4,2,3],right:[2,3,4,5],down:[4,5,3,2],left:[3,2,5,4]},bottom:{up:[4,5,2,3],right:[2,3,5,4],down:[5,4,3,2],left:[3,2,4,5]}}[g.currentFace][f],m=0;m<4;m++)if(r[0].object===X[m]){w=h[p[m]];break}v.calculateCubeTransform(w),g.currentFace=w,v.elapsedTime=0,v.sphericallyInterpolateTransition()}if(i.length>0){if(v.elapsedTime=0,g.wantHomeButton&&i[0].object===Y[z])return v.goHome(),void Ee(!1);if(g.wantContextMenu&&i[0].object===Y[G])return v.viewCubeMenuOpen=!0,v.drawDropdownMenu(j,O,N,o.clientX,o.clientY,n,H),void Ee(!0);if(g.wantRollArrows&&te&&(i[0].object===Y[V]||i[0].object===Y[B])){var _=i[0].object===Y[B],b={center:v.center.clone(),position:y.position.clone(),pivot:y.pivot.clone(),fov:y.fov,worldUp:v.sceneUpDirection.clone(),isOrtho:!1===y.isPerspective},x=v.center.clone().sub(y.position).normalize();_?b.up=y.up.clone().cross(x):(b.up=y.up.clone().multiplyScalar(-1),b.up.cross(x)),b.up.normalize(),v.elapsedTime=0,v.animateTransition(b)}}if(t.length>0){var w=t[0].object.name;g.mouseMoveSave=e,g.cubeRotateTo(w)}Ee(!1)};this.cubeRotateTo=function(e){g.currentFace=e,v.orthographicFaces&&-1!==g.currentFace.indexOf(",")&&v.setCameraOrtho(!1),v.calculateCubeTransform(g.currentFace),v.elapsedTime=0,v.sphericallyInterpolateTransition((function(){g.mouseMoveSave&&g.processMouseMove(g.mouseMoveSave)}))},this.processMouseMove=function(e){var t,n,r;if(v.viewCubeMenuOpen||v.currentlyAnimating)g.mouseMoveSave=e;else{g.mouseMoveSave=null;var i=be(e,g),o=_e(i,H);if(t=ye(o,g.camera,q),n=ye(o,S,X),r=ye(o,S,Y),Q&&!ae&&(Q.material.color.setHex(12040636),Q=null,requestAnimationFrame(g.render)),n.length>0&&!ae){Q=n[0].object;for(var s=F.children.length;--s>=0;)if(Q===X[s]){(Q=F.children[s]).material.color.setHex(45055);break}requestAnimationFrame(g.render)}Z&&!ae&&(Z.material.opacity=0,Z=null,requestAnimationFrame(g.render)),t.length>0&&!ae&&((Z=t[0].object).material.opacity=.3,requestAnimationFrame(g.render)),r.length>0&&!ae?J!==r[0].object&&(g.wantHomeButton&&r[0].object===Y[z]?(J=r[0].object,Y[z].material.map=ce[0]):g.wantRollArrows&&r[0].object===Y[V]?(J=r[0].object,Y[U].material.map=ce[1]):g.wantRollArrows&&r[0].object===Y[B]?(J=r[0].object,Y[U].material.map=ce[2]):g.wantContextMenu&&r[0].object===Y[G]?(J=r[0].object,Y[G].material.map=ce[6]):g.wantHomeButton&&J===Y[z]?(J=null,Y[z].material.map=ce[3]):!g.wantRollArrows||J!==Y[V]&&J!==Y[B]&&J!==Y[U]?g.wantContextMenu&&J===Y[G]&&(J=null,Y[G].material.map=ce[5]):(J=null,Y[U].material.map=ce[4]),requestAnimationFrame(g.render)):null===J||ae||(g.wantHomeButton&&J===Y[z]?(J=null,Y[z].material.map=ce[3]):!g.wantRollArrows||J!==Y[V]&&J!==Y[B]&&J!==Y[U]?g.wantContextMenu&&J===Y[G]&&(J=null,Y[G].material.map=ce[5]):(J=null,Y[U].material.map=ce[4]),requestAnimationFrame(g.render))}};var Me=function(e){v.navApi.isActionEnabled("orbit")&&g.processMouseMove(e)},Se=function(){H=ue(n),g.width=n.offsetWidth,g.height=n.offsetHeight,g.pcam.aspect=g.ocam.aspect=g.width/g.height,g.pcam.updateProjectionMatrix(),g.ocam.updateProjectionMatrix(),g.camera.topFov=g.camera.bottomFov=g.camera.fov/2,g.camera.leftFov=g.camera.rightFov=g.camera.aspect*g.camera.fov/2,g.pcam.aspect=g.ocam.aspect=g.camera.aspect,g.pcam.topFov=g.ocam.topFov=g.camera.topFov,g.pcam.bottomFov=g.ocam.bottomFov=g.camera.bottomFov,g.pcam.leftFov=g.ocam.leftFov=g.camera.leftFov,g.pcam.rightFov=g.ocam.rightFov=g.camera.rightFov,g.renderer.setSize(g.width,g.height),requestAnimationFrame(g.render)},Te=function(e,t){var n,i=Math.floor(.45*$/2)||45,o=Math.floor(.6*$/2)||60,s=i+o,a=new r.Geometry,l=new r.Vector3(0,0,0),c=new r.Vector3(o,-o,s),u=new r.Vector3(o,o,s),d=new r.Vector3(-o,o,s),h=new r.Vector3(-o,-o,s);return a.vertices.push(l),a.vertices.push(c),a.vertices.push(u),a.vertices.push(d),a.vertices.push(h),a.faces.push(new r.Face3(1,2,3)),a.faces.push(new r.Face3(1,3,4)),a.applyMatrix((new r.Matrix4).makeRotationX(e)),a.applyMatrix((new r.Matrix4).makeRotationY(t)),a.computeFaceNormals(),a.computeVertexNormals(),n=new r.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new r.Mesh(a,n)},Ce=function(e,t,n){var i,o=Math.floor(.45*$/2)||45,s=Math.floor(.6*$/2)||60,a=o+s,l=new r.Geometry,c=new r.Vector3(s,a,a),u=new r.Vector3(-s,a,a),d=new r.Vector3(-s,s,a),h=new r.Vector3(s,s,a),f=new r.Vector3(s,a,s),p=new r.Vector3(-s,a,s),m=new r.Vector3(-s,a,a),g=new r.Vector3(s,a,a);return l.vertices.push(c),l.vertices.push(u),l.vertices.push(d),l.vertices.push(h),l.vertices.push(f),l.vertices.push(p),l.vertices.push(m),l.vertices.push(g),l.faces.push(new r.Face3(0,1,2)),l.faces.push(new r.Face3(0,2,3)),l.faces.push(new r.Face3(4,5,6)),l.faces.push(new r.Face3(4,6,7)),l.applyMatrix((new r.Matrix4).makeRotationX(e)),l.applyMatrix((new r.Matrix4).makeRotationY(t)),l.applyMatrix((new r.Matrix4).makeRotationZ(n)),l.computeFaceNormals(),l.computeVertexNormals(),i=new r.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new r.Mesh(l,i)},Pe=function(e,t){var n,i=Math.floor(.45*$/2)||45,o=Math.floor(.6*$/2)||60,s=i+o,a=new r.Geometry,l=new r.Vector3(s,s,s),c=new r.Vector3(o,s,s),u=new r.Vector3(o,o,s),d=new r.Vector3(s,o,s),h=new r.Vector3(s,s,o),f=new r.Vector3(s,s,s),p=new r.Vector3(s,o,s),m=new r.Vector3(s,o,o),g=new r.Vector3(s,s,s),v=new r.Vector3(s,s,o),y=new r.Vector3(o,s,o),_=new r.Vector3(o,s,s);return a.vertices.push(l),a.vertices.push(c),a.vertices.push(u),a.vertices.push(d),a.vertices.push(h),a.vertices.push(f),a.vertices.push(p),a.vertices.push(m),a.vertices.push(g),a.vertices.push(v),a.vertices.push(y),a.vertices.push(_),a.faces.push(new r.Face3(0,1,2)),a.faces.push(new r.Face3(0,2,3)),a.faces.push(new r.Face3(4,5,6)),a.faces.push(new r.Face3(4,6,7)),a.faces.push(new r.Face3(8,9,10)),a.faces.push(new r.Face3(8,10,11)),a.applyMatrix((new r.Matrix4).makeRotationX(e)),a.applyMatrix((new r.Matrix4).makeRotationY(t)),a.computeFaceNormals(),a.computeVertexNormals(),n=new r.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new r.Mesh(a,n)},Le=function(e){var t=v.cubeFront.clone(),n=v.sceneUpDirection.clone(),i=t.clone().cross(n);n.copy(i).cross(t),t.normalize(),n.normalize(),i.normalize();var o=new r.Vector3(t.x,n.x,i.x).multiplyScalar(e.x);return o.add(new r.Vector3(t.y,n.y,i.y).multiplyScalar(e.y)),o.add(new r.Vector3(t.z,n.z,i.z).multiplyScalar(e.z)),o};this.render=function(){g.camera=y.isPerspective?g.pcam:g.ocam;var e=g.compass?g.viewScaleFactorCompass*g.viewScale:g.viewScale,t=v.center.clone().sub(y.position).normalize(),n=y.up.normalize(),i=new r.Matrix4;t=Le(t),n=Le(n),g.camera.position.copy(t),g.camera.position.multiplyScalar(-e/g.camera.position.length()),g.camera.up=n.normalize(),g.camera.lookAt(g.center),De();var o=g.renderTriad&&p(v.sceneUpDirection)&&p(v.sceneFrontDirection),s=g.renderer;if(s){for(var a=0;a<k.length;a++)i.lookAt(g.camera.position,k[a].position,g.camera.up),k[a].setRotationFromMatrix(i);s.clear(),s.render(_,g.camera),s.render(b,g.camera),s.render(w,g.camera),o&&(E.orient(v.sceneUpDirection,v.sceneFrontDirection.clone().multiplyScalar(-1)),s.render(E.triadScene,g.camera),s.render(E.triadLabelScene,g.camera)),s.render(x,g.camera),g.renderCompass&&s.render(M,g.camera),s.render(A,S)}},this.getScreenShot=function(e){return new Promise((function(e,t){var n=g.renderer;if(!n)return t("No renderer");var r=g.getDocument().createElement("canvas");r.width=g.width,r.height=g.height;var i=r.getContext("2d");i.fillStyle="#FFFFFF",i.fillRect(0,0,g.width,g.height),n.domElement.toBlob((function(t){var n=new Image,o=g.getWindow();n.src=o.URL.createObjectURL(t),n.onload=function(){i.drawImage(n,0,0,g.width,g.height),o.URL.revokeObjectURL(n.src),r.toBlob((function(t){e(t)}),"image/png")}}),"image/png")}))};var De=function(){!(te=v.isFaceView())||le||v.currentlyAnimating?Re():Ie(),le?je():Oe(),le?Ne():ke()},Re=function(){A.remove(F),Y[U].material.opacity=0,Y[G].material.opacity=0},Ie=function(){A.add(F);var e=g.wantRollArrows?1:0;Y[U].material.opacity=e,Y[G].material.opacity=e},je=function(){D.material.opacity=Object(l.isMobileDevice)()?1:0},Oe=function(){D.material.opacity=g.wantContextMenu?1:0},Ne=function(){P.material.opacity=0},ke=function(){P.material.opacity=g.wantHomeButton?1:0};this.refreshCube=function(){Se()},this.setSize=function(e,t){if(g.width=e,g.height=t,n.children.length>1)for(var r=1;r<n.children.length;r++)n.children[r].style.bottom=(g.height/5).toString()+"px";Se()},this.useTransparency=function(e){le=e,e?(n.onmouseover=fe,n.onmousemove=pe,n.onmouseout=me,me()):(n.onmouseover=null,n.onmouseout=null,n.onmousemove=null,n.style.opacity="1.0")},this.showTriad=function(e){e!==g.renderTriad&&(g.renderTriad=e,requestAnimationFrame(g.render))},this.showCompass=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.initCompass(),g.renderCompass!==e&&(g.prevRenderCompass=g.renderCompass,g.renderCompass=e,he(),requestAnimationFrame(g.render))},this.setCompassRotation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.initCompass();var t=e-g.northAngle;0!==t&&(g.northAngle=e,g.compassPointerMeshUp.rotateZ(t),g.compassPointerMeshDown.rotateZ(t),requestAnimationFrame(g.render))},this.initCompass=function(){if(!g.hasCompass){g.hasCompass=!0,g.northAngle=0;var e=Bimfish.Viewing.Private.getResourceUrl;M=new r.Scene;var t=2.9*$,n=new r.PlaneBufferGeometry(t,t,2,2),i=new r.MeshBasicMaterial({color:0,side:r.DoubleSide,map:ge(e("res/textures/VCcompass-pointer-b.png")),shading:r.FlatShading,transparent:!0}),o=new r.MeshBasicMaterial({color:0,side:r.DoubleSide,map:ge(e("res/textures/VCcompass-base.png")),shading:r.FlatShading,transparent:!0}),s=new r.Mesh(n,i),a=new r.Mesh(n,i),l=new r.Mesh(n,o);g.compassPointerMeshUp=s,g.compassPointerMeshDown=a;var c=-Math.PI/2;l.rotateX(c),s.rotateX(c),a.rotateX(c);var u=.5*-$-(Math.floor(.25*$/2)||25);l.translateZ(u),s.translateZ(u+.1),a.translateZ(u-.1),M.add(l),M.add(s),M.add(a),requestAnimationFrame(g.render)}},this.showControls=function(e){e||void 0===e?fe():me()},this.dtor=function(){this.renderer=null},this.refreshTexture=function(e){var t=Bimfish.Viewing.Private.getResourceUrl,n=this.localizeResourcePath||"res/textures/",s=(new i.DDSLoader).load(t(n+"VCcrossRGBA8small.dds"),e);s.minFilter=s.maxFilter=r.LinearFilter,this.texture&&this.texture.dispose(),this.texture=s;var a=this.material;if(!a){var l=r.ShaderLib.cube;(a=Object(o.createShaderMaterial)(l)).depthWrite=!1,this.material=a}return a.uniforms.tCube.value=s,a},this.localize=function(){var e=this,t=Object(l.getGlobal)();this.localizeResourcePath=t.LOCALIZATION_REL_PATH,this.refreshTexture((function(){requestAnimationFrame(e.render)}))},function(){var e=n.getBoundingClientRect();g.width=e.width,g.height=e.height,H=ue(n),(S=new r.PerspectiveCamera(70,g.height/g.width,1,1e4)).position.set(0,0,500),_=new r.Scene,b=new r.Scene,x=new r.Scene,w=new r.Scene,A=new r.Scene,te=!0,$=160,g.viewScale=4*$;var t=g.refreshTexture(),i=r.LinearFilter,o=Bimfish.Viewing.Private.getResourceUrl,l="res/textures/",c=new r.BoxGeometry($,$,$,4,4,4),u=new r.BoxGeometry($+1,$+1,$+1,4,4,4);(T=new r.Mesh(c,t)).position.set(0,0,0),b.add(T);var d=ge(o(l+"VCedge1.png"));d.minFilter=d.maxFilter=i,(C=new r.Mesh(u,new r.MeshBasicMaterial({map:d,overdraw:!1,transparent:!0,shading:r.SmoothShading}))).position.set(0,0,0),w.add(C),E=new m($+20),Array.prototype.push.apply(k,E.getSprites());var h=$+5,f=new r.Geometry,p=new r.Vector3(-30,0,0),y=new r.Vector3(30,0,0),M=new r.Vector3(0,-30,0);f.vertices.push(p),f.vertices.push(y),f.vertices.push(M),f.faces.push(new r.Face3(1,0,2)),f.computeFaceNormals();var R=new r.MeshBasicMaterial({overdraw:!0,color:12040636,depthTest:!1,depthWrite:!1,transparent:!1,opacity:1,shading:r.FlatShading}),I=new r.MeshBasicMaterial({overdraw:!0,color:12040636,depthTest:!1,depthWrite:!1,transparent:!1,opacity:1,shading:r.FlatShading}),j=new r.MeshBasicMaterial({overdraw:!0,color:12040636,depthTest:!1,depthWrite:!1,transparent:!1,opacity:1,shading:r.FlatShading}),O=new r.MeshBasicMaterial({overdraw:!0,color:12040636,depthTest:!1,depthWrite:!1,transparent:!1,opacity:1,shading:r.FlatShading}),N=new r.PlaneBufferGeometry(.5*$,.3*$,2,2),W=new r.MeshBasicMaterial({transparent:!0,opacity:0}),q=new r.Mesh(f,R),K=new r.Mesh(N,W);q.position.set(0,h,0),K.position.set(0,.9*h,.1);var Q=new r.Mesh(f,I),Z=new r.Mesh(N,W);Q.position.set(0,-h,0),Z.position.set(0,.9*-h,.1),Q.rotation.z+=Math.PI,Z.rotation.z+=Math.PI;var J=new r.Mesh(f,j),ee=new r.Mesh(N,W);J.position.set(h,0,0),ee.position.set(.9*h,0,.1),J.rotation.z-=Math.PI/2,ee.rotation.z-=Math.PI/2;var re=new r.Mesh(f,O),ie=new r.Mesh(N,W);re.position.set(-h,0,0),ie.position.set(.9*-h,0,.1),re.rotation.z+=Math.PI/2,ie.rotation.z+=Math.PI/2,(F=new r.Object3D).position.set(0,0,0),F.add(q),F.add(Q),F.add(J),F.add(re),A.add(K),A.add(Z),A.add(ee),A.add(ie),A.add(F),X.push(K),X.push(Z),X.push(ee),X.push(ie);var oe=new r.PlaneBufferGeometry($/3,$/3,2,2),se=new r.MeshBasicMaterial({map:ge(o(l+"VChome.png")),transparent:!0,shading:r.FlatShading});(P=new r.Mesh(oe,se)).position.set(-$,$,0),z=Y.length,A.add(P),Y.push(P);var ae=new r.PlaneBufferGeometry(1.5*$,1.5*$,2,2),le=new r.MeshBasicMaterial({map:ge(o(l+"VCarrows.png")),shading:r.FlatShading,depthTest:!1,depthWrite:!1,transparent:!0}),fe=new r.Mesh(ae,le);g.rollMesh=fe;var pe=new r.PlaneBufferGeometry(.6*$,.45*$,2,2),me=new r.MeshBasicMaterial({transparent:!0,opacity:0}),ye=new r.Mesh(pe,me);g.rollLeftMesh=ye;var _e=new r.PlaneBufferGeometry(.45*$,.6*$,2,2),be=new r.MeshBasicMaterial({transparent:!0,opacity:0}),we=new r.Mesh(_e,be);g.rollRightMesh=we,A.add(fe),A.add(ye),A.add(we),V=Y.length,Y.push(ye),B=Y.length,Y.push(we),U=Y.length,Y.push(fe);var Ee=new r.PlaneBufferGeometry($/2.3,$/2.3,2,2),Ae=new r.MeshBasicMaterial({map:ge(o(l+"VCcontext.png")),transparent:!0,depthTest:!1,depthWrite:!1,shading:r.FlatShading});D=new r.Mesh(Ee,Ae),g.contextMesh=D,G=Y.length,A.add(D),Y.push(D),he();var Se=new r.Geometry;Se.vertices.push(new r.Vector3(0,0,0));var Te,Ce=Math.floor(.2*$/2)||20;if(Se.vertices.push(new r.Vector3(-$/2,-$/2-Ce,-$/2)),Se.vertices.push(new r.Vector3($/2,-$/2-Ce,-$/2)),Se.vertices.push(new r.Vector3($/2,-$/2-Ce,$/2)),Se.vertices.push(new r.Vector3(-$/2,-$/2-Ce,$/2)),Se.faces.push(new r.Face3(4,3,2)),Se.faces.push(new r.Face3(4,2,1)),Te=new r.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),L=new r.Mesh(Se,Te),_.add(L),ve(),"CANVAS"===v.renderer.toUpperCase()?g.renderer=new r.CanvasRenderer:"WEBGL"===v.renderer.toUpperCase()?g.renderer=new s.WebGLRenderer({alpha:!0,antialias:!1}):(a.logger.warn("Incorrect use of Autocam.renderer property"),g.renderer=new r.CanvasRenderer),g.useTransparency(!0),g.setSize(g.width,g.height),g.camera.topFov=g.camera.bottomFov=g.camera.fov/2,g.camera.leftFov=g.camera.rightFov=g.camera.aspect*g.camera.fov/2,g.pcam.topFov=g.ocam.topFov=g.camera.topFov,g.pcam.bottomFov=g.ocam.bottomFov=g.camera.bottomFov,g.pcam.leftFov=g.ocam.leftFov=g.camera.leftFov,g.pcam.rightFov=g.ocam.rightFov=g.camera.rightFov,g.renderer.autoClear=!1,g.renderer.setSize(g.width,g.height),g.renderer.sortObjects=!1,n.appendChild(g.renderer.domElement),n.addEventListener("touchstart",xe,!1),n.addEventListener("mousedown",xe,!1),n.addEventListener("mousemove",Me,!1),ne=!1){var Pe=g.getDocument();Pe.exitPointerLock=Pe.exitPointerLock||Pe.mozExitPointerLock||Pe.webkitExitPointerLock,n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,g.addDocumentEventListener("pointerlockchange",de,!1),g.addDocumentEventListener("mozpointerlockchange",de,!1),g.addDocumentEventListener("webkitpointerlockchange",de,!1)}ce.push(ge(o(l+"VChomeS.png"))),ce.push(ge(o(l+"VCarrowsS0.png"))),ce.push(ge(o(l+"VCarrowsS1.png"))),ce.push(ge(o(l+"VChome.png"))),ce.push(ge(o(l+"VCarrows.png"))),ce.push(ge(o(l+"VCcontext.png"))),ce.push(ge(o(l+"VCcontextS.png")))}()}},"./src/tools/viewtransitions/ViewTransition.js":
/*!*****************************************************!*\
  !*** ./src/tools/viewtransitions/ViewTransition.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=(0,n(/*! ../../compat */"./src/compat.js").getGlobal)();function o(){this.stop=null,this.isRunning=!0}function s(e,t,n,r,s){var a=performance.now(),l=1e3*n,c=0,u=new o;u.stop=function(){c&&i.cancelAnimationFrame(c),u.isRunning=!1},u.skip=function(){u.isRunning&&(r(t),u.stop(),s&&s())};return function n(o){var d=(o-a)/l;d=Math.max(d,0),d=Math.min(d,1),r(e+d*(t-e)),d<1?c=i.requestAnimationFrame(n):(u.isRunning=!1,s&&s())}(a),u}var a,l=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setValueCb=n,this.animTime=r,this.fadeAnim=null,this.targetValue=t,this.curValue=t,n(t)}var t,n,i;return t=e,(n=[{key:"_stopAnim",value:function(){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null)}},{key:"fadeTo",value:function(e,t){var n=this;e!==this.targetValue&&(this._stopAnim(),this.targetValue=e,this.fadeAnim=s(this.curValue,this.targetValue,this.animTime,(function(e){e=u(e),n.curValue=e,n.setValueCb(e)}),t))}},{key:"setValue",value:function(e){this._stopAnim(),this.curValue=e,this.setValueCb(e)}}])&&r(t.prototype,n),i&&r(t,i),e}();function c(e,t,n){return(1-n)*e+n*t}function u(e){return THREE.Math.smootherstep(e,0,1)}function d(e){var t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,a=0,l=0,d=new THREE.Vector3,h=new THREE.Quaternion,f=new THREE.Quaternion,p=new THREE.Vector3,m=new THREE.Quaternion,g=new THREE.Object3D;new THREE.Matrix4;function v(e,t,n,r){Bimfish.Viewing.Navigation.prototype.orient(g,n,t,r),e.copy(g.quaternion)}this.init=function(e,c,u,p){t.copy(e.position),n.copy(e.target),r.copy(e.up),i.copy(c),o.copy(u),s.copy(p),d.copy(e.worldup),a=t.distanceTo(n),l=i.distanceTo(o),v(h,t,n,d),v(f,i,o,d)},this.updateCamera=function(e,n){var r=u(e);n.position.lerpVectors(t,i,r),THREE.Quaternion.slerp(h,f,m,r),m.normalize();var o=c(a,l,r);!function(e,t,n){p.set(0,0,-n).applyQuaternion(t),e.target.addVectors(e.position,p),p.set(0,1,0).applyQuaternion(t),e.up.copy(p)}(n,m,o),n.dirty=!0},this.updateViewerCamera=function(e,t){this.updateCamera(e,t.impl.camera),t.impl.syncCamera(),t.impl.invalidate(!0,!0)}}e.exports={flyToView:function(e,t,n,r){a||(a=new d),n=n||2;var i=e.impl.camera;return a.init(i,t.position,t.target,t.up),s(0,1,n,(function(t){a.updateViewerCamera(t,e)}),r)},ShadowFader:function(e,t,n){var r=1,i=null,o=t,a=void 0,l=n;function c(t){r=t,e.impl.setGroundShadowAlpha(t)}function u(){i=null,l&&l(a)}this.shadowOn=function(){i&&a||(i&&!a&&(i.stop(),i=null),r>=1||(i=s(r,1,o*(1-r),c,u),a=!0))},this.shadowOff=function(){i&&!a||(i&&a&&(i.stop(),i=null),r<=0||(i=s(r,0,o*r,c,u),a=!1))},this.isFading=function(){return i&&i.isRunning}},lerp:c,smootherStep:u,fadeValue:s,AnimatedParam:l}},"./src/wasm/Wasm.js":
/*!**************************!*\
  !*** ./src/wasm/Wasm.js ***!
  \**************************/
/*! exports provided: Wasm */function(e,t,n){"use strict";function r(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function i(e,t){try{WebAssembly.instantiateStreaming||(WebAssembly.instantiateStreaming=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return e.next=4,e.sent.arrayBuffer();case 4:return r=e.sent,e.next=7,WebAssembly.instantiate(r,n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(e){r(s,i,o,a,l,"next",e)}function l(e){r(s,i,o,a,l,"throw",e)}a(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())}catch(e){throw new Error("WebAssembly is not supported for the current browser.")}if(!e)throw new Error("Expecting a wasm file path.");var n=256,i=256;t&&t.memory&&(n=t.memory.initial,i=t.memory.maximum),this._wasmPath=e,this._memory=new WebAssembly.Memory({initial:n,maximum:i})}n.r(t),n.d(t,"Wasm",(function(){return i})),i.prototype.constructor=i,i.prototype.instantiate=function(){var e=this,t={env:{abortStackOverflow:function(e){throw new Error("overflow")},table:new WebAssembly.Table({initial:0,maximum:0,element:"anyfunc"}),__table_base:0,memory:this._memory,__memory_base:1024,STACKTOP:0,STACK_MAX:this.getBuffer().byteLength}};return new Promise((function(n,r){try{WebAssembly.instantiateStreaming(fetch(e._wasmPath),t).then((function(t){var r=t.instance.exports;e.proxy=r,n(r)}))}catch(e){r(e)}}))},i.prototype.getBuffer=function(){return this._memory.buffer}},"./src/wgs/globals.js":
/*!****************************!*\
  !*** ./src/wgs/globals.js ***!
  \****************************/
/*! exports provided: memoryOptimizedLoading, GPU_MEMORY_LIMIT, GPU_OBJECT_LIMIT, USE_VAO, GEOMETRY_OVERHEAD, PIXEL_CULLING_THRESHOLD */function(e,t,n){"use strict";n.r(t),n.d(t,"memoryOptimizedLoading",(function(){return i})),n.d(t,"GPU_MEMORY_LIMIT",(function(){return o})),n.d(t,"GPU_OBJECT_LIMIT",(function(){return s})),n.d(t,"USE_VAO",(function(){return a})),n.d(t,"GEOMETRY_OVERHEAD",(function(){return l})),n.d(t,"PIXEL_CULLING_THRESHOLD",(function(){return c}));var r=n(/*! ../compat */"./src/compat.js"),i=!0,o=1024*(Object(r.isMobileDevice)()?64:256)*1024,s=Object(r.isMobileDevice)()?2500:1e4,a=!Object(r.isMobileDevice)(),l=336,c=1},"./src/wgs/render/BackgroundShader.js":
/*!********************************************!*\
  !*** ./src/wgs/render/BackgroundShader.js ***!
  \********************************************/
/*! exports provided: BackgroundShader */function(e,t,n){"use strict";n.r(t),n.d(t,"BackgroundShader",(function(){return l}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/background_vert.glsl */"./src/wgs/render/shaders/background_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/background_frag.glsl */"./src/wgs/render/shaders/background_frag.glsl"),a=n.n(s),l={uniforms:{color1:{type:"v3",value:new r.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new r.Vector3(1/255,2/255,3/255)},opacity:{type:"f",value:1},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},uCamDir:{type:"v3",value:new r.Vector3},uCamUp:{type:"v3",value:new r.Vector3},uResolution:{type:"v2",value:new r.Vector2(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0}},vertexShader:o.a,fragmentShader:a.a}},"./src/wgs/render/BasicShader.js":
/*!***************************************!*\
  !*** ./src/wgs/render/BasicShader.js ***!
  \***************************************/
/*! exports provided: BasicShader */function(e,t,n){"use strict";n.r(t),n.d(t,"BasicShader",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),o=n(/*! ./shaders/basic_vert.glsl */"./src/wgs/render/shaders/basic_vert.glsl"),s=n.n(o),a=n(/*! ./shaders/basic_frag.glsl */"./src/wgs/render/shaders/basic_frag.glsl"),l=n.n(a),c={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.shadowmap,i.ShaderChunks.CutPlanesUniforms,i.ShaderChunks.IdUniforms,i.ShaderChunks.ThemingUniform,i.ShaderChunks.PointSizeUniforms,i.ShaderChunks.WideLinesUniforms]),vertexShader:s.a,fragmentShader:l.a};r.ShaderLib.firefly_basic=c},"./src/wgs/render/BlendShader.js":
/*!***************************************!*\
  !*** ./src/wgs/render/BlendShader.js ***!
  \***************************************/
/*! exports provided: BlendShader */function(e,t,n){"use strict";n.r(t),n.d(t,"BlendShader",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),o=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),s=n.n(o),a=n(/*! ./shaders/blend_frag.glsl */"./src/wgs/render/shaders/blend_frag.glsl"),l=n.n(a),c={uniforms:r.UniformsUtils.merge([i.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},aoOpacity:{type:"f",value:.625},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},tID2:{type:"t",value:null},objIDv4:{type:"v4",value:new r.Vector4(0,0,0,0)},modelIDv2:{type:"v2",value:new r.Vector2(0,0)},edgeObjIDv4:{type:"v4",value:new r.Vector4(0,0,0,0)},edgeModelIDv2:{type:"v2",value:new r.Vector2(0,0)},highlightIntensity:{type:"f",value:1},resolution:{type:"v2",value:new r.Vector2(1/1024,1/512)},selectionColor:{type:"c",value:new r.Color(0,0,0)},expand2dSelection:{type:"f",value:.5},tCrossFadeTex0:{type:"t",value:null},tCrossFadeTex1:{type:"t",value:null},crossFadeOpacity0:{type:"f",value:0},crossFadeOpacity1:{type:"f",value:0}}]),vertexShader:s.a,fragmentShader:l.a}},"./src/wgs/render/CelShader.js":
/*!*************************************!*\
  !*** ./src/wgs/render/CelShader.js ***!
  \*************************************/
/*! exports provided: CelShader */function(e,t,n){"use strict";n.r(t),n.d(t,"CelShader",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),o=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),s=n.n(o),a=n(/*! ./shaders/cel_frag.glsl */"./src/wgs/render/shaders/cel_frag.glsl"),l=n.n(a),c={uniforms:r.UniformsUtils.merge([i.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new r.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},tFill:{type:"t",value:null},tPaper:{type:"t",value:null},style:{type:"i",value:0},idEdges:{type:"i",value:1},normalEdges:{type:"i",value:1},depthEdges:{type:"i",value:1},brightness:{type:"f",value:0},contrast:{type:"f",value:0},grayscale:{type:"i",value:0},preserveColor:{type:"i",value:0},levels:{type:"f",value:6},repeats:{type:"f",value:3},rotation:{type:"f",value:0},tGraphite1:{type:"t",value:null},tGraphite2:{type:"t",value:null},tGraphite3:{type:"t",value:null},tGraphite4:{type:"t",value:null},tGraphite5:{type:"t",value:null},tGraphite6:{type:"t",value:null},tGraphite7:{type:"t",value:null},tGraphite8:{type:"t",value:null}}]),vertexShader:s.a,fragmentShader:l.a}},"./src/wgs/render/CopyShader.js":
/*!**************************************!*\
  !*** ./src/wgs/render/CopyShader.js ***!
  \**************************************/
/*! exports provided: CopyShader */function(e,t,n){"use strict";n.r(t),n.d(t,"CopyShader",(function(){return a}));var r=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),i=n.n(r),o=n(/*! ./shaders/copy_frag.glsl */"./src/wgs/render/shaders/copy_frag.glsl"),s=n.n(o),a={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:i.a,fragmentShader:s.a}},"./src/wgs/render/DecodeEnvMap.js":
/*!****************************************!*\
  !*** ./src/wgs/render/DecodeEnvMap.js ***!
  \****************************************/
/*! exports provided: CreateCubeMapFromColors, DecodeEnvMap */function(e,t,n){"use strict";n.r(t),n.d(t,"CreateCubeMapFromColors",(function(){return s})),n.d(t,"DecodeEnvMap",(function(){return f}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./HalfFloat */"./src/wgs/render/HalfFloat.js"),o=n(/*! ../../logger/Logger */"./src/logger/Logger.js");function s(e,t){for(var n=255*e.x,i=255*e.y,o=255*e.z,s=255*t.x,a=255*t.y,l=255*t.z,c=new Uint8Array(16),u=new Uint8Array(16),d=new Uint8Array(16),h=0;h<4;h++)c[4*h]=n,c[4*h+1]=i,c[4*h+2]=o,c[4*h+3]=255,u[4*h]=s,u[4*h+1]=a,u[4*h+2]=l,u[4*h+3]=255,h>1?(d[4*h]=n,d[4*h+1]=i,d[4*h+2]=o,d[4*h+3]=255):(d[4*h]=s,d[4*h+1]=a,d[4*h+2]=l,d[4*h+3]=255);var f=new r.DataTexture(d,2,2,r.RGBAFormat),p=new r.DataTexture(d,2,2,r.RGBAFormat),m=new r.DataTexture(u,2,2,r.RGBAFormat),g=new r.DataTexture(c,2,2,r.RGBAFormat),v=new r.DataTexture(d,2,2,r.RGBAFormat),y=new r.DataTexture(d,2,2,r.RGBAFormat),_=new r.Texture(null,r.CubeReflectionMapping,r.RepeatWrapping,r.RepeatWrapping,r.LinearFilter,r.LinearFilter,r.RGBAFormat);return _.image=[p,f,g,m,y,v],_.needsUpdate=!0,_}var a=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268];function l(e,t){var n=255*t[2]+t[3],r=Math.pow(2,(n-127)/2),i=r/t[1],o=t[0]*i,s=a[0]*o+a[3]*r+a[6]*i,l=a[1]*o+a[4]*r+a[7]*i,c=a[2]*o+a[5]*r+a[8]*i;s<0&&(s=0),l<0&&(l=0),c<0&&(c=0),e[0]=s,e[1]=l,e[2]=c}function c(e,t,n){var r=.0625*Math.sqrt(t[0]*n),i=.0625*Math.sqrt(t[1]*n),o=.0625*Math.sqrt(t[2]*n),s=Math.max(Math.max(r,i),Math.max(o,1e-6));s>1&&(s=1);var a=Math.ceil(255*s)/255;r>1&&(r=1),i>1&&(i=1),o>1&&(o=1),e[3]=a;var l=1/a;e[0]=r*l,e[1]=i*l,e[2]=o*l}function u(e,t,n){var r=Math.sqrt(t[0]*n),i=Math.sqrt(t[1]*n),o=Math.sqrt(t[2]*n);r>65504&&(r=65504),i>65504&&(i=65504),o>65504&&(o=65504),e[0]=r,e[1]=i,e[2]=o}var d=new Float32Array(4),h=new Float32Array(4);function f(e,t,n,s){if(e.LogLuv){for(var a=Math.pow(2,t),f=Array.isArray(e.image)?e.image:[e.image],p=0;p<f.length;p++)for(var m=f[p],g=0;g<m.mipmaps.length;g++){var v,y=m.mipmaps[g],_=y.data;n?(v=new Uint16Array(_.length/4*3),y.data=v):v=_.buffer;for(var b=0,x=0;x<_.length;x+=4)d[0]=_[x]/255,d[1]=_[x+1]/255,d[2]=_[x+2]/255,d[3]=_[x+3]/255,l(h,d),n?(u(d,h,a),v[b++]=Object(i.FloatToHalf)(d[0]),v[b++]=Object(i.FloatToHalf)(d[1]),v[b++]=Object(i.FloatToHalf)(d[2])):(c(d,h,a),_[x]=Math.round(255*d[0]),_[x+1]=Math.round(255*d[1]),_[x+2]=Math.round(255*d[2]),_[x+3]=Math.round(255*d[3]))}e.LogLuv=!1,n?(e.type=r.HalfFloatType,e.format=r.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,s&&s(e)}else o.logger.warn("Environment map expected to be in LogLuv format.")}},"./src/wgs/render/EdgeShader.js":
/*!**************************************!*\
  !*** ./src/wgs/render/EdgeShader.js ***!
  \**************************************/
/*! exports provided: EdgeShader */function(e,t,n){"use strict";n.r(t),n.d(t,"EdgeShader",(function(){return l}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/edge_vert.glsl */"./src/wgs/render/shaders/edge_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/edge_frag.glsl */"./src/wgs/render/shaders/edge_frag.glsl"),a=n.n(s),l={uniforms:{color:{type:"v4",value:new r.Vector4(0,0,0,.3)},cutplanes:{type:"v4v",value:[]}},vertexShader:o.a,fragmentShader:a.a}},"./src/wgs/render/FXAAShader.js":
/*!**************************************!*\
  !*** ./src/wgs/render/FXAAShader.js ***!
  \**************************************/
/*! exports provided: FXAAShader */function(e,t,n){"use strict";n.r(t),n.d(t,"FXAAShader",(function(){return l}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/fxaa_vert.glsl */"./src/wgs/render/shaders/fxaa_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/fxaa_frag.glsl */"./src/wgs/render/shaders/fxaa_frag.glsl"),a=n.n(s),l={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new r.Vector2(1/1024,1/512)}},vertexShader:o.a,fragmentShader:a.a}},"./src/wgs/render/GaussianPass.js":
/*!****************************************!*\
  !*** ./src/wgs/render/GaussianPass.js ***!
  \****************************************/
/*! exports provided: GaussianPass */function(e,t,n){"use strict";n.r(t),n.d(t,"GaussianPass",(function(){return u}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/gaussian_vert.glsl */"./src/wgs/render/shaders/gaussian_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/gaussian_frag.glsl */"./src/wgs/render/shaders/gaussian_frag.glsl"),a=n.n(s),l=n(/*! ./ShaderPass */"./src/wgs/render/ShaderPass.js"),c={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new r.Vector4(1,1,1,1)}},vertexShader:o.a,fragmentShader:a.a},u=function(e,t,n,i,o){var s,a,u,d=e,h=t,f=n||3,p=i||1,m=o.hasAlpha||!1,g=o.blending||!1,v=o.flipUV||!1;this.render=function(e,t,n){s.render(e,u,n),a.render(e,t,u)},this.setSize=function(e,t){this.cleanup(),d=e,h=t,(u=new r.WebGLRenderTarget(e,t,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:void 0!==o.format?o.format:r.RGBAFormat,type:void 0!==o.type?o.type:r.UnsignedByteType,stencilBuffer:!1})).generateMipmaps=!1,s.material.defines.KERNEL_SCALE_H=a.material.defines.KERNEL_SCALE_H=(p/d).toFixed(4),s.material.defines.KERNEL_SCALE_V=a.material.defines.KERNEL_SCALE_V=(p/h).toFixed(4),s.material.needsUpdate=a.material.needsUpdate=!0},this.cleanup=function(){u&&u.dispose()},this.setColor=function(e){a.material.uniforms.uColor.value.x=e.r,a.material.uniforms.uColor.value.y=e.g,a.material.uniforms.uColor.value.z=e.b},this.setAlpha=function(e){a.material.uniforms.uColor.value.w=e},s=new l.ShaderPass(c),a=new l.ShaderPass(c),this.setSize(e,t),s.material.blending=a.material.blending=r.NoBlending,s.material.depthWrite=a.material.depthWrite=!1,s.material.depthTest=a.material.depthTest=!1,s.material.defines.HORIZONTAL=1,s.material.defines.KERNEL_RADIUS=a.material.defines.KERNEL_RADIUS=f.toFixed(1),g&&(a.material.transparent=!0,a.material.blending=r.NormalBlending),m&&(s.material.defines.HAS_ALPHA=a.material.defines.HAS_ALPHA=""),v&&(s.material.defines.FLIP_UV="")}},"./src/wgs/render/GroundFlags.js":
/*!***************************************!*\
  !*** ./src/wgs/render/GroundFlags.js ***!
  \***************************************/
/*! exports provided: GroundFlags */function(e,t,n){"use strict";n.r(t),n.d(t,"GroundFlags",(function(){return r}));var r={GROUND_UNFINISHED:0,GROUND_FINISHED:1,GROUND_RENDERED:2}},"./src/wgs/render/GroundReflection.js":
/*!********************************************!*\
  !*** ./src/wgs/render/GroundReflection.js ***!
  \********************************************/
/*! exports provided: GroundReflection */function(e,t,n){"use strict";n.r(t),n.d(t,"GroundReflection",(function(){return f}));var r=n(/*! ./ShaderPass */"./src/wgs/render/ShaderPass.js"),i=n(/*! ./GaussianPass */"./src/wgs/render/GaussianPass.js"),o=n(/*! ./BackgroundShader */"./src/wgs/render/BackgroundShader.js"),s=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),a=n.n(s),l=n(/*! ./shaders/groundreflection_draw_frag.glsl */"./src/wgs/render/shaders/groundreflection_draw_frag.glsl"),c=n.n(l),u=n(/*! ./GroundFlags */"./src/wgs/render/GroundFlags.js"),d=n(/*! three */"./thirdparty/three.js/three.js"),h={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:a.a,fragmentShader:c.a},f=function(e,t,n,s){var a,l,c,f,p,m,g=e,v=g.getContext(),y=t||512,_=n||512,b=!1,x=new d.Color(0,0,0),w=!1,E=!1;this.inTarget=void 0,this.outTarget=void 0;var A,M,S,T,C=!0,P=u.GroundFlags.GROUND_UNFINISHED,L={color:new d.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18};if(this.setTransform=function(e,t,n){f=e,c.normal=t,c.constant=-e.dot(t)},this.cleanup=function(){a&&a.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(e,t){y=e,_=t,this.cleanup(),this.inTarget=new d.WebGLRenderTarget(y*L.texScale,_*L.texScale,{magFilter:d.LinearFilter,minFilter:d.LinearFilter,format:d.RGBAFormat,stencilBuffer:!1}),this.inTarget.generateMipmaps=!1,this.outTarget=new d.WebGLRenderTarget(y*L.texScale,_*L.texScale,{magFilter:d.LinearFilter,minFilter:d.LinearFilter,format:d.RGBAFormat,stencilBuffer:!1}),this.outTarget.generateMipmaps=!1,a?a.setSize(y*L.texScale*L.blurTexScale,_*L.texScale*L.blurTexScale):a=new i.GaussianPass(y*L.texScale*L.blurTexScale,_*L.texScale*L.blurTexScale,L.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(e){var t;t=e.isPerspective?f.clone():e.target.clone();var n=e.position.clone().sub(t).normalize(),r=Math.PI/2-n.angleTo(c.normal);if(!(b=r<0)){if(L.fadeAngle>0){var i=Math.min(L.fadeAngle,r)/L.fadeAngle;a.setAlpha(i*L.alpha)}var o,s,l,u=(s=(o=c).normal,l=o.constant,(new d.Matrix4).set(1-2*s.x*s.x,-2*s.y*s.x,-2*s.x*s.z,-2*l*s.x,-2*s.x*s.y,1-2*s.y*s.y,-2*s.y*s.z,-2*l*s.y,-2*s.x*s.z,-2*s.y*s.z,1-2*s.z*s.z,-2*l*s.z,0,0,0,1));(p=e.clone()).applyMatrix(u),p.projectionMatrix.elements[5]*=-1,p.matrixWorldNeedsUpdate=!0,e.worldUpTransform?p.worldUpTransform=e.worldUpTransform.clone():p.worldUpTransform=new d.Matrix4}},this.renderIntoReflection=function(e){b||g.render(e,p,this.inTarget)},this.prepareGroundReflection=(M=0,S=0,T=0,function(e,t,n,r,i,o){var s,a,l,c=t.modelQueue();if(P!==u.GroundFlags.GROUND_UNFINISHED||c.isEmpty())return P=u.GroundFlags.GROUND_FINISHED,i;if(A!=c.getGeomScenes()&&(C=!0),C){if(C=!1,this.updateCamera(t.camera),this.isGroundCulled())return P=u.GroundFlags.GROUND_FINISHED,i;this.clear(),A=c.getGeomScenes(),M=A.length,S=0,T=r?Math.max(Math.ceil(M/100),r):M,P=u.GroundFlags.GROUND_UNFINISHED}else{if(P!==u.GroundFlags.GROUND_UNFINISHED)return P=u.GroundFlags.GROUND_FINISHED,i;0===r&&(T=M)}i&&(s=performance.now(),a=(o=void 0===o?1:o)*i);for(var d=0;d<T&&S<M;){var h=A[S++];if(h&&(d++,h.forceVisible=!0,this.renderIntoReflection(h),h.forceVisible=!1,i)){var f=performance.now()-s;if(a<f&&S<M){P=u.GroundFlags.GROUND_UNFINISHED,l=i-f;break}}}return S<M&&(P=u.GroundFlags.GROUND_UNFINISHED,l=i?i-performance.now()+s:1),void 0===l||n?(this.postprocess(t.camera,t.matman()),e&&e.enabled&&t.renderGroundShadow(this.outTarget),this.renderReflection(t.camera,t.renderer().getColorTarget()),void 0===l&&(P=u.GroundFlags.GROUND_RENDERED),i?i-performance.now()+s:1):l}),this.renderReflection=function(e,t){b||(v.depthRange(.999999,1),l.render(g,t,this.outTarget),v.depthRange(0,1))},this.toggleEnvMapBackground=function(e){E=e,m.uniforms.envMapBackground.value=e},this.postprocess=function(e){b||(w||E?(m.uniforms.uCamDir.value=e.worldUpTransform?e.getWorldDirection().clone().applyMatrix4(e.worldUpTransform):e.getWorldDirection(),m.uniforms.uCamUp.value=e.worldUpTransform?e.up.clone().applyMatrix4(e.worldUpTransform):e.up,m.uniforms.uResolution.value.set(y,_),m.uniforms.uHalfFovTan.value=Math.tan(d.Math.degToRad(.5*e.fov)),m.render(g,this.outTarget),g.clearTarget(this.outTarget,!1,!0,!1)):(g.setClearColor(x,1),g.clearTarget(this.outTarget,!0,!0,!1)),a.render(g,this.outTarget,this.inTarget))},this.clear=function(){g.setClearColor(x,0),g.clearTarget(this.inTarget,!0,!0,!1),g.clearBlend()},this.setClearColors=function(e,t,n){t?(x.setRGB(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)),w=!e.equals(t)&&!n):(x.copy(e),w=!1),w&&(m.uniforms.color1.value.copy(e),m.uniforms.color2.value.copy(t))},this.setEnvRotation=function(e){m.material.envRotationSin=Math.sin(e),m.material.envRotationCos=Math.cos(e)},this.isGroundCulled=function(){return b},this.getStatus=function(){return P},this.setDirty=function(){C=!0,P=u.GroundFlags.GROUND_UNFINISHED},this.setColor=function(e){a.setColor(L.color),L.color.set(e)},this.setAlpha=function(e){a.setAlpha(L.alpha),L.alpha=e},s)for(var D in L)L[D]=void 0!==s[D]?s[D]:L[D];(l=new r.ShaderPass(h)).material.blending=d.NoBlending,l.material.depthTest=!0,l.material.depthWrite=!1,l.scene.position.z=-.999999,s.clearPass?m=s.clearPass:((m=new r.ShaderPass(o.BackgroundShader)).material.blending=d.NoBlending,m.material.depthWrite=!1,m.material.depthTest=!1),this.setSize(y,_),a.setAlpha(L.color),a.setAlpha(L.alpha),c=new d.Plane(new d.Vector3(0,1,0),0),f=new d.Vector3(0,0,0)}},"./src/wgs/render/GroundShadow.js":
/*!****************************************!*\
  !*** ./src/wgs/render/GroundShadow.js ***!
  \****************************************/
/*! exports provided: createGroundShape, setGroundShapeTransform, GroundShadow */function(e,t,n){"use strict";n.r(t),n.d(t,"createGroundShape",(function(){return S})),n.d(t,"setGroundShapeTransform",(function(){return T})),n.d(t,"GroundShadow",(function(){return C}));var r,i,o,s=n(/*! ./ShaderUtils */"./src/wgs/render/ShaderUtils.js"),a=n(/*! ./ShaderPass */"./src/wgs/render/ShaderPass.js"),l=n(/*! ./shaders/groundshadow_depth_vert.glsl */"./src/wgs/render/shaders/groundshadow_depth_vert.glsl"),c=n.n(l),u=n(/*! ./shaders/groundshadow_depth_frag.glsl */"./src/wgs/render/shaders/groundshadow_depth_frag.glsl"),d=n.n(u),h=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),f=n.n(h),p=n(/*! ./shaders/groundshadow_ao_frag.glsl */"./src/wgs/render/shaders/groundshadow_ao_frag.glsl"),m=n.n(p),g=n(/*! ./shaders/groundshadow_blur_frag.glsl */"./src/wgs/render/shaders/groundshadow_blur_frag.glsl"),v=n.n(g),y=n(/*! ./shaders/groundshadow_color_frag.glsl */"./src/wgs/render/shaders/groundshadow_color_frag.glsl"),_=n.n(y),b=n(/*! ./GroundFlags */"./src/wgs/render/GroundFlags.js"),x=n(/*! three */"./thirdparty/three.js/three.js"),w={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:c.a,fragmentShader:d.a},E={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new x.Vector3(1,1,1)}},defines:{},vertexShader:f.a,fragmentShader:m.a},A={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:f.a,fragmentShader:v.a},M={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new x.Vector4(0,0,0,1)}},vertexShader:f.a,fragmentShader:_.a};function S(e){var t=new x.PlaneBufferGeometry(1,1);if(t.attributes.index.array.reverse)t.attributes.index.array.reverse();else for(var n,r=t.attributes.index.array,i=Math.floor(r.length/2),o=0,s=r.length;o<i;++o)n=r[o],r[o]=r[s-1-o],r[s-1-o]=n;return new x.Mesh(t,e)}function T(e,t,n,s,a){r||(r=new x.Matrix4),i||(i=new x.Vector3),o||(o=new x.Vector3),i.subVectors(t,s),r.lookAt(i,t,a),o.copy(s).multiplyScalar(-.5*n.y).add(t),e.position.copy(o),e.rotation.setFromRotationMatrix(r),e.scale.set(n.z,n.x,n.y)}function C(e,t){var n,r,i,o,l,c,u,d,h,f,p,m,g,v,y,_,C,P,L,D=e,R=!1,I=!0,j=b.GroundFlags.GROUND_FINISHED,O={texSize:64,pixScale:1,blurRadius:7,debug:!1};if(this.setTransform=(m=new x.Vector3(0,0,0),g=new x.Vector3(0,0,0),v=new x.Vector3(0,0,0),y=new x.Vector3(0,0,0),function(e,t,r,o){e.equals(m)&&t.equals(g)&&r.equals(v)&&o.equals(y)||(m.copy(e),g.copy(t),v.copy(r),y.copy(o),this.setDirty(),n.left=-t.z/2,n.right=t.z/2,n.top=t.x/2,n.bottom=-t.x/2,n.near=1,n.far=t.y+n.near,n.updateProjectionMatrix(),T(i,e,t,r,o),n.position.addVectors(e,r.clone().multiplyScalar(-t.y/2-n.near)),o&&n.up.set(o.x,o.y,o.z),n.lookAt(e),O.debug&&(p.position.set(e.x,e.y,e.z),p.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),p.scale.set(t.z,t.x,t.y)),f.uniforms.worldSize.value.copy(t))}),this.renderIntoShadow=function(e){if(!e.overrideMaterial||!e.overrideMaterial.transparent){var t=e.overrideMaterial;e.overrideMaterial=c,D.render(e,n,o,!1),e.overrideMaterial=t}},this.prepareGroundShadow=(C=0,P=0,L=0,function(e,t,n,r){if(!this.enabled||e.isEmpty())return j=b.GroundFlags.GROUND_FINISHED,n;if(_!=e.getGeomScenes()&&(I=!0),I)this.clear(),I=!1,_=e.getGeomScenes(),C=_.length,P=0,L=t?Math.max(Math.ceil(C/100),t):C;else{if(j===b.GroundFlags.GROUND_RENDERED||j===b.GroundFlags.GROUND_FINISHED)return j=b.GroundFlags.GROUND_FINISHED,n;0===t&&(L=C)}var i,o,s;n&&(i=performance.now(),o=(r=void 0===r?1:r)*n);for(var a=0;a<L&&P<C;){var l=_[P++];if(l&&(a++,l.forceVisible=!0,this.renderIntoShadow(l),l.forceVisible=!1,n)){var c=performance.now()-i;if(o<c){j=b.GroundFlags.GROUND_UNFINISHED,s=n-c;break}}}return P<C&&(j=b.GroundFlags.GROUND_UNFINISHED,s=n?n-performance.now()+i:1),void 0!==s?s:(this.postprocess(),j=b.GroundFlags.GROUND_RENDERED,n?n-performance.now()+i:1)}),this.renderShadow=function(e,t){R&&(t?D.render(r,e,t,!1):D.render(r,e))},this.postprocess=function(){h.render(D,l,o),d.render(D,o,l),R=!0},this.clear=function(){var e=D.getClearColor().getHex(),t=D.getClearAlpha();D.setClearColor(0,0),D.clearTarget(o,!0,!0,!1),D.setClearColor(e,t),D.clearBlend(),R=!1},this.setColor=function(e){u.uniforms.uShadowColor.value.x=e.r,u.uniforms.uShadowColor.value.y=e.g,u.uniforms.uShadowColor.value.z=e.b},this.getColor=function(){return new x.Color(u.uniforms.uShadowColor.value.x,u.uniforms.uShadowColor.value.y,u.uniforms.uShadowColor.value.z)},this.setAlpha=function(e){u.uniforms.uShadowColor.value.w=e},this.getAlpha=function(){return u.uniforms.uShadowColor.value.w},this.isValid=function(){return R},this.getStatus=function(){return j},this.setDirty=function(){I=!0,j=b.GroundFlags.GROUND_UNFINISHED},this.getDepthMaterial=function(){return c},t)for(var N in O)O[N]=t[N]||O[N];r=new x.Scene,n=new x.OrthographicCamera,(o=new x.WebGLRenderTarget(O.texSize,O.texSize,{minFilter:x.LinearFilter,magFilter:x.LinearFilter,format:x.RGBAFormat,stencilBuffer:!1})).generateMipmaps=!1,(l=new x.WebGLRenderTarget(O.texSize,O.texSize,{minFilter:x.LinearFilter,magFilter:x.LinearFilter,format:x.RGBAFormat,stencilBuffer:!1})).generateMipmaps=!1,(c=Object(s.createShaderMaterial)(w)).side=x.DoubleSide,c.blending=x.NoBlending,d=new a.ShaderPass(A,"tDepth"),h=new a.ShaderPass(A,"tDepth"),f=new a.ShaderPass(E,"tDepth"),d.material.defines.KERNEL_SCALE=h.material.defines.KERNEL_SCALE=(O.pixScale/O.texSize).toFixed(4),d.material.defines.KERNEL_RADIUS=h.material.defines.KERNEL_RADIUS=O.blurRadius.toFixed(2),f.material.blending=d.material.blending=h.material.blending=x.NoBlending,f.material.depthWrite=d.material.depthWrite=h.material.depthWrite=!1,f.material.depthTest=d.material.depthTest=h.material.depthTest=!1,d.material.defines.HORIZONTAL=1,(u=Object(s.createShaderMaterial)(M)).uniforms.tDepth.value=o,u.depthWrite=!1,u.transparent=!0,i=S(u),r.add(i),O.debug&&(p=new x.Mesh(new x.BoxGeometry(1,1,1),new x.MeshBasicMaterial({color:65280,wireframe:!0})),r.add(p)),this.setTransform(new x.Vector3(0,0,0),new x.Vector3(1,1,1),new x.Vector3(0,1,0),x.Object3D.DefaultUp)}C.prototype.constructor=C},"./src/wgs/render/HalfFloat.js":
/*!*************************************!*\
  !*** ./src/wgs/render/HalfFloat.js ***!
  \*************************************/
/*! exports provided: FloatToHalf, HalfToFloat, HALF_INT_MAX, IntToHalf, HalfToInt, HalfTest */function(e,t,n){"use strict";n.r(t),n.d(t,"FloatToHalf",(function(){return a})),n.d(t,"HalfToFloat",(function(){return l})),n.d(t,"HALF_INT_MAX",(function(){return c})),n.d(t,"IntToHalf",(function(){return u})),n.d(t,"HalfToInt",(function(){return d})),n.d(t,"HalfTest",(function(){return h}));var r=new Float32Array(1),i=new Uint32Array(r.buffer),o=new Uint16Array(1),s=new Uint16Array(1),a=function(e){r[0]=e;var t=i[0],n=0;if(0==(2147483647&t))s[n++]=t>>16;else{var a=2147483648&t,l=2139095040&t,c=8388607&t;if(0===l)s[n++]=a>>16;else if(2139095040==l)s[n++]=0===c?a>>16|31744:65024;else{var u,d,h=a>>16,f=(0|l>>23)-127+15;f>=31?s[n++]=a>>16|31744:f<=0?(14-f>24?u=0:(u=(c|=8388608)>>14-f,o[0]=u,u=o[0],c>>13-f&1&&(u+=1)),s[n++]=h|u):(d=f<<10,o[0]=d,d=o[0],u=c>>13,o[0]=u,u=o[0],s[n++]=4096&c?1+(h|d|u):h|d|u)}}return s[0]},l=function(e){var t,n=65535&e;if(0==(32767&n))t=n<<16;else{var o=32768&n,s=31744&n,a=1023&n;if(0===s){var l=-1;do{l++,a<<=1}while(0==(1024&a));var c=o<<16,u=(s<<16>>26)-15+127-l,d=u<<23,h=(1023&a)<<13;t=c|d|h}else t=31744==s?0===a?o<<16|2139095040:4290772992:(c=o<<16)|(d=(u=(s<<16>>26)-15+127)<<23)|(h=a<<13)}return i[0]=t,r[0]},c=59390,u=function(e){if(e>c-1||e<0)return console.log("out of range"),a(NaN);if(0===e)return 0;var t=!1;e>c/2-1&&(t=!0,e-=c/2-1);var n=0|Math.abs(e/1024),r=Math.pow(2,n-13),i=r+(e-1024*n)*r/1024;return t&&(i=-i),a(i)},d=function(e){if(0===e)return 0;var t=l(e),n=!1;t<0&&(n=!0,t=-t);var r=0|Math.floor(Math.log(t)/Math.log(2)),i=Math.pow(2,r),o=(t-i)/i*1024+1024*(r+13);return n&&(o+=c/2-1),o},h=function(){for(var e=[-1/255,-.17,-75,-1789,-.005],t=0;t<e.length;t++)console.log("input",e[t],"encoded",a(e[t]),"decoded",l(a(e[t])));for(t=0;t<c;t++){var n=d(u(t));n!==t&&console.log("Roundtrip failed for",t,n)}}},"./src/wgs/render/LineShader.js":
/*!**************************************!*\
  !*** ./src/wgs/render/LineShader.js ***!
  \**************************************/
/*! exports provided: LineShader */function(e,t,n){"use strict";n.r(t),n.d(t,"LineShader",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/line_vert.glsl */"./src/wgs/render/shaders/line_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/line_frag.glsl */"./src/wgs/render/shaders/line_frag.glsl"),a=n.n(s),l=n(/*! ./ShaderChunks.js */"./src/wgs/render/ShaderChunks.js"),c={uniforms:r.UniformsUtils.merge([l.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new r.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new r.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new r.Vector4(0,0,1,1)},modelId:{type:"v3",value:new r.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0},viewportBounds:{type:"v4",value:new r.Vector4(0,0,1,1)},unpackXform:{type:"v4",value:new r.Vector4(1,1,0,0),perObject:!0},tIdColor:{type:"t",value:null,perObject:!0},vIdColorTexSize:{type:"v2",value:new r.Vector2(256,1),perObject:!0}}]),attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0,uvIdColor:0},defines:{},vertexShader:o.a,fragmentShader:a.a}},"./src/wgs/render/LineShaderSS.js":
/*!****************************************!*\
  !*** ./src/wgs/render/LineShaderSS.js ***!
  \****************************************/
/*! exports provided: LineShaderSS */function(e,t,n){"use strict";n.r(t),n.d(t,"LineShaderSS",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/liness_vert.glsl */"./src/wgs/render/shaders/liness_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/liness_frag.glsl */"./src/wgs/render/shaders/liness_frag.glsl"),a=n.n(s),l=n(/*! ./ShaderChunks.js */"./src/wgs/render/ShaderChunks.js"),c={uniforms:r.UniformsUtils.merge([l.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:1},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new r.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new r.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},size:{type:"v2",value:new r.Vector2(1024,768)},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new r.Vector4(0,0,1,1)},modelId:{type:"v3",value:new r.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0},viewportBounds:{type:"v4",value:new r.Vector4(0,0,1,1)},unpackXform:{type:"v4",value:new r.Vector4(1,1,0,0),perObject:!0},tIdColor:{type:"t",value:null,perObject:!0},vIdColorTexSize:{type:"v2",value:new r.Vector2(256,1),perObject:!0}}]),attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0,uvIdColor:0},defines:{},vertexShader:o.a,fragmentShader:a.a}},"./src/wgs/render/LineStyleDef.js":
/*!****************************************!*\
  !*** ./src/wgs/render/LineStyleDef.js ***!
  \****************************************/
/*! exports provided: LineStyleDefs, createLinePatternTextureData, createLinePatternTextureFromDefs, createLinePatternTexture, createLinePatternForDef */function(e,t,n){"use strict";n.r(t),n.d(t,"LineStyleDefs",(function(){return i})),n.d(t,"createLinePatternTextureData",(function(){return o})),n.d(t,"createLinePatternTextureFromDefs",(function(){return s})),n.d(t,"createLinePatternTexture",(function(){return a})),n.d(t,"createLinePatternForDef",(function(){return l}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}],o=function(e,t){for(var n=e+3,i=t,o=1;o<n;)o*=2;for(n=o,o=1;o<i;)o*=2;i=o;var s=new Uint8Array(n*i),a=new r.DataTexture(s,n,i,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter,0);return a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,{tex:s,pw:n,ph:i,lineStyleTex:a}},s=function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e[r];i.def.length>n&&(n=i.def.length)}for(var s=o(n,t),a=s.tex,c=s.pw,u=s.lineStyleTex,d=0;d<t;d++){var h=e[d];l(h,a,d,c)}return u},a=function(){return s(i)},l=function(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:96,o=n*r,s=e.unit&&"mm"==e.unit?1/25.4:1,a=e.pen_width||0,l=e.def,c=0,u=0;u<l.length;u++){var d=Math.abs(l[u]),h=d<=.5*a;h&&(d=0);var f=0|d*i*s;c+=f,t[o+u+2]=f||1}t[o]=c%256,t[o+1]=c/256,t[o+l.length+2]=0}},"./src/wgs/render/MSDF.js":
/*!********************************!*\
  !*** ./src/wgs/render/MSDF.js ***!
  \********************************/
/*! exports provided: MSDF_EDGE_COLOR_BLACK, MSDF_EDGE_COLOR_RED, MSDF_EDGE_COLOR_GREEN, MSDF_EDGE_COLOR_YELLOW, MSDF_EDGE_COLOR_BLUE, MSDF_EDGE_COLOR_MAGENTA, MSDF_EDGE_COLOR_CYAN, MSDF_EDGE_COLOR_WHITE, MSDFShape, MSDFContour, MSDFLinearSegment */function(e,t,n){"use strict";n.r(t),n.d(t,"MSDF_EDGE_COLOR_BLACK",(function(){return l})),n.d(t,"MSDF_EDGE_COLOR_RED",(function(){return c})),n.d(t,"MSDF_EDGE_COLOR_GREEN",(function(){return u})),n.d(t,"MSDF_EDGE_COLOR_YELLOW",(function(){return d})),n.d(t,"MSDF_EDGE_COLOR_BLUE",(function(){return h})),n.d(t,"MSDF_EDGE_COLOR_MAGENTA",(function(){return f})),n.d(t,"MSDF_EDGE_COLOR_CYAN",(function(){return p})),n.d(t,"MSDF_EDGE_COLOR_WHITE",(function(){return m})),n.d(t,"MSDFShape",(function(){return M})),n.d(t,"MSDFContour",(function(){return y})),n.d(t,"MSDFLinearSegment",(function(){return g}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=-1e240;function o(){this.distance=i,this.dot=1}function s(e,t){return e.x*t.y-e.y*t.x}function a(e,t,n){t=t,n=n;var i=e.length();return 0===i?t?new r.Vector2(0,n?0:1):new r.Vector2(0,-(n?0:1)):t?new r.Vector2(-e.y/i,e.x/i):new r.Vector2(e.y/i,-e.x/i)}o.prototype={constructor:o,set:function(e,t){return this.distance=e,this.dot=t,this},copy:function(e){this.distance=e.distance,this.dot=e.dot},lessThan:function(e){return Math.abs(this.distance)<Math.abs(e.distance)||Math.abs(this.distance)===Math.abs(e.distance)&&this.dot<e.dot},greaterThan:function(e){return Math.abs(this.distance)>Math.abs(e.distance)||Math.abs(this.distance)===Math.abs(e.distance)&&this.dot>e.dot},lessThanOrEquals:function(e){return Math.abs(this.distance)<Math.abs(e.distance)||Math.abs(this.distance)==Math.abs(e.distance)&&this.dot<=e.dot},greaterThanOrEquals:function(e){return Math.abs(this.distance)>Math.abs(e.distance)||Math.abs(this.distance)==Math.abs(e.distance)&&this.dot>=e.dot}};var l=0,c=1,u=2,d=3,h=4,f=5,p=6,m=7;function g(e,t,n){this.p=[],this.p[0]=e.clone(),this.p[1]=t.clone(),this.color=n}function v(e,t){return(t.x-e.x)*(e.y+t.y)}function y(){this.edges=[]}function _(e,t,n){return e.dot(t)<=0||Math.abs(s(e,t))>n}function b(e,t){return x(e,t,l)}function x(e,t,n){var r=e&n;if(r==c||r==u||r==h)return[e=r^m,t];if(e==l||e==m)return[e=[p,f,d][t%3],t=Math.floor(t/3)];var i=e<<1+(1&t);return[e=(i|i>>3)&m,t>>=1]}function w(){this.minDistance=new o,this.nearEdge=null,this.nearParam=0}function E(e,t,n){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),n))}function A(e,t){var n=t.point(0),r=t.point(1),i=e,o=e.clone().sub(n),s=r.clone().sub(n),l=o.dot(s)/s.dot(s);return l<0?o.length():l>1?i.clone().sub(r).length():Math.abs(a(s,!1,!1).dot(o))}function M(){this.contours=[],this.windings=[],this.inverseYAxis=!1}g.prototype={constructor:g,set:function(e){return this.color=e,this},clone:function(){return new this.constructor(this.p[0],this.p[1],this.color)},point:function(e){return this.p[0].clone().lerp(this.p[1],e)},direction:function(){return this.p[1].clone().sub(this.p[0])},signedDistance:function(e){var t=e.clone().sub(this.p[0]),n=this.direction(),r=t.dot(n)/n.dot(n),i=this.p[r>.5?1:0].clone().sub(e),l=i.length();if(r>0&&r<1){var c=a(n,!1,!1).dot(t);if(Math.abs(c)<l){var u=new o;return u.set(c,0),[u,r]}}var d=2*(s(t,n)>0?1:0)-1,h=new o;return h.set(d*l,Math.abs(n.normalize().dot(i.normalize(i)))),[h,r]},distanceToPseudoDistance:function(e,t,n){var r,i;if(n<0){i=this.direction().normalize();var o=t.clone().sub(this.p[0]);o.dot(i)<0&&(r=s(o,i),Math.abs(r)<=Math.abs(e.distance)&&(e.distance=r,e.dot=0))}else if(n>1){i=this.direction().normalize();var a=t.clone().sub(this.p[1]);a.dot(i)>0&&(r=s(a,i),Math.abs(r)<=Math.abs(e.distance)&&(e.distance=r,e.dot=0))}},moveStartPoint:function(e){this.p[0].copy(e)},moveEndPoint:function(e){this.p[1].copy(e)},splitInThirds:function(e,t,n){var r=this.point(1/3),i=this.point(2/3);new g(this.p[0],r,this.color),new g(r,i,this.color),new g(i,this.p[1],this.color)}},y.prototype={constructor:y,addEdge:function(e){this.edges.push(e)},winding:function(){if(0===this.edges.length)return 0;var e,t,n,i,o,s=0;if(1==this.edges.length)e=new r.Vector2,t=new r.Vector2,n=new r.Vector2,e.copy(this.edges[0].point(0)),t.copy(this.edges[0].point(1/3)),n.copy(this.edges[0].point(2/3)),s+=v(e,t),s+=v(t,n),s+=v(n,e);else if(2==this.edges.length)e=new r.Vector2,t=new r.Vector2,n=new r.Vector2,i=new r.Vector2,e.copy(this.edges[0].point(0)),t.copy(this.edges[0].point(.5)),n.copy(this.edges[1].point(0)),i.copy(this.edges[1].point(.5)),s+=v(e,t),s+=v(t,n),s+=v(n,i),s+=v(i,e);else{var a=new r.Vector2,l=new r.Vector2;a=this.edges[this.edges.length-1].point(0);for(var c=0;c<this.edges.length;c++)s+=v(a,l=this.edges[c].point(0)),a=l}return(o=s)>0?1:o<0?-1:0}},w.prototype={constructor:w,clear:function(){this.nearEdge=null,this.nearParam=0},copy:function(e){this.minDistance.copy(e.minDistance),this.nearEdge=e.nearEdge,this.nearParam=e.nearParam}},M.prototype={constructor:M,addContour:function(e){this.contours.push(e)},addBlankContour:function(){var e=new y;return this.contours.push(e),e},initialize:function(){this.contours.length;for(var e=0;e<this.contours.length;++e){var t=this.contours[e];this.windings.push(t.winding())}},edgeColoringSimple:function(e,t){for(var n=Math.sin(e),r=0;r<this.contours.length;++r){var i=this.contours[r],o=[];if(i.edges.length>0)for(var s=i.edges[i.edges.length-1].direction(1),a=0;a<i.edges.length;++a){var l=i.edges[a];_(s.normalize(),l.direction(0).normalize(),n)&&o.push(a),s=l.direction(1)}if(0===o.length)for(var c=0;c<i.edges.length;++c)i.edges[c].color=m;else if(1==o.length){var u=[m,m],d=b(u[0],t);u[0]=d[0],t=d[1],u[2]=u[0],d=b(u[0],t),u[0]=d[0],t=d[1];var h=o[0];if(i.edges.length>=3)for(var f=i.edges.length,p=0;p<f;++p)i.edges[(h+p)%f].color=u[Math.floor(2.875*p/(f-1)+.0625)];else if(i.edges.length>=1){var g=[];i.edges[0].splitInThirds(g[0+3*h],g[1+3*h],g[2+3*h]),i.edges.length>=2?(i.edges[1].splitInThirds(g[3-3*h],g[4-3*h],g[5-3*h]),g[0].color=g[1].color=u[0],g[2].color=g[3].color=u[1],g[4].color=g[5].color=u[2]):(g[0].color=u[0],g[1].color=u[1],g[2].color=u[2]),i.edges.clear();for(var v=0;v<g.length;++v)i.edges.push(g[v])}}else{var y=o.length,w=0,E=o[0],A=i.edges.length,M=m,S=b(M,t);M=S[0],t=S[1];for(var T=M,C=0;C<A;++C){var P=(E+C)%A;w+1<y&&o[w+1]==P&&(M=(S=x(M,t,(++w===y-1?1:0)*T))[0],t=S[1]),i.edges[P].color=M}}}},calculateMSDFValue:function(e){for(var t=this.contours.length,n=[],o=new w,s=new w,a=new w,l=Math.abs(i),d=-i,f=i,p=0,m=new w,g=new w,v=new w,y=0;y<this.contours.length;++y){n[y]={r:i,g:i,b:i,med:i};var _=this.contours[y];m.clear(),g.clear(),v.clear();for(var b=0;b<_.edges.length;++b){var x=_.edges[b],A=x.signedDistance(e),M=A[0],S=A[1];(x.color&c)>0&&M.lessThan(m.minDistance)&&(m.minDistance.copy(M),m.nearEdge=x,m.nearParam=S),(x.color&u)>0&&M.lessThan(g.minDistance)&&(g.minDistance.copy(M),g.nearEdge=x,g.nearParam=S),(x.color&h)>0&&M.lessThan(v.minDistance)&&(v.minDistance.copy(M),v.nearEdge=x,v.nearParam=S)}m.minDistance.lessThan(o.minDistance)&&o.copy(m),g.minDistance.lessThan(s.minDistance)&&s.copy(g),v.minDistance.lessThan(a.minDistance)&&a.copy(v);var T=Math.abs(E(m.minDistance.distance,g.minDistance.distance,v.minDistance.distance));T<l&&(l=T,p=-this.windings[y]),m.nearEdge&&m.nearEdge.distanceToPseudoDistance(m.minDistance,e,m.nearParam),g.nearEdge&&g.nearEdge.distanceToPseudoDistance(g.minDistance,e,g.nearParam),v.nearEdge&&v.nearEdge.distanceToPseudoDistance(v.minDistance,e,v.nearParam),T=E(m.minDistance.distance,g.minDistance.distance,v.minDistance.distance),n[y].r=m.minDistance.distance,n[y].g=g.minDistance.distance,n[y].b=v.minDistance.distance,n[y].med=T,this.windings[y]>0&&T>=0&&Math.abs(T)<Math.abs(f)&&(f=T),this.windings[y]<0&&T<=0&&Math.abs(T)<Math.abs(d)&&(d=T)}o.nearEdge&&o.nearEdge.distanceToPseudoDistance(o.minDistance,e,o.nearParam),s.nearEdge&&s.nearEdge.distanceToPseudoDistance(s.minDistance,e,s.nearParam),a.nearEdge&&a.nearEdge.distanceToPseudoDistance(a.minDistance,e,a.nearParam);var C={r:i,g:i,b:i,med:i};if(f>=0&&Math.abs(f)<=Math.abs(d)){C.med=i,p=1;for(var P=0;P<t;++P)this.windings[P]>0&&n[P].med>C.med&&Math.abs(n[P].med)<Math.abs(d)&&(C=n[P])}else if(d<=0&&Math.abs(d)<=Math.abs(f)){C.med=-i,p=-1;for(var L=0;L<t;++L)this.windings[L]<0&&n[L].med<C.med&&Math.abs(n[L].med)<Math.abs(f)&&(C=n[L])}for(var D=0;D<t;++D)this.windings[D]!=p&&Math.abs(n[D].med)<Math.abs(C.med)&&(C=n[D]);return E(o.minDistance.distance,s.minDistance.distance,a.minDistance.distance)==C.med&&(C.r=o.minDistance.distance,C.g=s.minDistance.distance,C.b=a.minDistance.distance),new r.Vector3(C.r,C.g,C.b)},minSameColoredEdgeDistance:function(){for(var e=[1e10,1e10,1e10],t=0;t<this.contours.length;++t)for(var n=this.contours[t],r=0;r<n.edges.length;++r)for(var i=n.edges[r],o=0;o+1<r;++o){var s=n.edges[o];if(i.color==s.color){var a=Math.min(Math.min(A(i.point(0),s),A(i.point(1),s)),Math.min(A(s.point(0),i),A(s.point(1),i))),l=i.color-f;e[l]=Math.min(e[l],a)}}return Math.min(Math.min(e[0],e[1]),e[2])}}},"./src/wgs/render/MaterialConverter.js":
/*!*********************************************!*\
  !*** ./src/wgs/render/MaterialConverter.js ***!
  \*********************************************/
/*! exports provided: MaterialConverter */function(e,t,n){"use strict";n.r(t),n.d(t,"MaterialConverter",(function(){return N}));var r=n(/*! ./PrismShader */"./src/wgs/render/PrismShader.js"),i=n(/*! ./MSDF */"./src/wgs/render/MSDF.js"),o=n(/*! three */"./thirdparty/three.js/three.js");function s(e,t,n){if(!e||!e.colors)return new o.Color(1,0,0);var r=e.colors[t];if(!r)return new o.Color(0,0,0);var i=r.values;if(!i||!i.length)return new o.Color(1,0,0);var s=i[0];return new o.Color(s.r,s.g,s.b)}function a(e,t,n){if(!e||!e.scalars)return n;var r=e.scalars[t];return r?r.values[0]:n}function l(e,t,n){if(!e||!e.booleans)return n;var r=e.booleans[t];return void 0===r?n:r}function c(e,t,n,r){if(!e||!e[t])return r;var i=e[t][n];return i?i.values[0]:r}function u(e,t,n,r){if(!e||!e.scalars)return r;var i=e.scalars[t];return i?function(e,t,n){var r=g[n];r||(r=1,o.warn("Unsupported unit: "+n));var i=g[t];i||(i=1,o.warn("Unsupported unit: "+t));return e*r/i}(i.values[0],i.units,n):r}function d(e,t,n,r){if(!e||!e[t])return r;var i=e[t][n];return i&&i.connections?i.connections[0]:r}function h(e){var t=e;return t<=.04045?t/=12.92:t=Math.pow((t+.055)/1.055,2.4),t}function f(e){var t,n,r;return t=h(e.r),n=h(e.g),r=h(e.b),new o.Color(t,n,r)}var p,m,g={MilliMeter:1e3,mm:1e3,8206:1e3,DeciMeter:10,dm:10,8204:10,CentiMeter:100,cm:100,8205:100,Meter:1,m:1,8193:1,KiloMeter:.001,km:.001,8201:.001,Inch:39.37008,in:39.37008,8214:39.37008,Foot:3.28084,ft:3.28084,8215:3.28084,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,8221:1.09361};function v(e,t){var n=u(e,"texture_RealWorldOffsetX",t,0),r=u(e,"texture_RealWorldOffsetY",t,0),i=c(e,"scalars","texture_UOffset",0),o=c(e,"scalars","texture_VOffset",0),s=1,a=1;null!=c(e,"scalars","texture_RealWorldScale")?s=a=u(e,"texture_RealWorldScale",t,1):(s=u(e,"texture_RealWorldScaleX",t,1),a=u(e,"texture_RealWorldScaleY",t,1)),s=0===s?1:s,a=0===a?1:a;var l=c(e,"scalars","texture_UScale",1),d=c(e,"scalars","texture_VScale",1),h=c(e,"scalars","texture_WAngle",1);h*=Math.PI/180;var f=Math.cos(h),p=Math.sin(h),m=l/s,g=d/a;return{elements:[f*m,p*m,0,-p*g,f*g,0,-f*m*n+p*g*r+i,-p*m*n-f*g*r+o,1]}}function y(e,t,n){e[n+"_enable"]=c(t,"booleans",n+"_enable",0);var r=function(e,t,n){var r={bands:0,weights:new o.Vector4(1,1,1,1),frequencies:new o.Vector4(1,1,1,1)};if(!e||!e[t])return r;var i=e[t][n];if(!(i&&i.values&&i.values instanceof Array))return r;var s=i.values;r.bands=s.length/2;for(var a=0;a<r.bands;++a)r.frequencies.setComponent(a,1/s[2*a]),r.weights.setComponent(a,s[2*a+1]);return r}(t,"scalars",n+"_prof");e[n+"_bands"]=r.bands,e[n+"_weights"]=r.weights,e[n+"_frequencies"]=r.frequencies}function _(e,t){if(0!==t.randomOffsetMode){e.tilingRandomAxisS=new o.Vector2,e.tilingRandomAxisT=new o.Vector2,e.tilingRandomAlignmentOffset=new o.Vector2;var n=e.tilingRandomAxisS;n.set(1,0);var r=e.tilingRandomAxisT;r.set(0,1);var i=e.tilingRandomAlignmentOffset;i.set(0,0);var s=new o.Matrix4,a=new o.Matrix4,l=function(e){var t=["opaque_albedo_map","opaque_f0_map","layered_diffuse_map","layered_bottom_f0_map","surface_roughness_map","surface_normal_map","surface_albedo_map","surface_anisotropy_map","surface_cutout_map"];if(void 0!==e.textureMaps)for(var n=0;n<t.length;++n)if(void 0!==e.textureMaps[t[n]]&&void 0!==e.textureMaps[t[n]].textureObj&&void 0!==e.textureMaps[t[n]].textureObj.matrix){var r=e.textureMaps[t[n]].textureObj.matrix.elements,i=new o.Matrix4;return i.set(r[0],r[1],0,r[2],r[3],r[4],0,r[5],0,0,1,0,r[6],r[7],0,r[8]),i}return new o.Matrix4}(e),c=function(e,t){var n=new o.Matrix4;n.makeScale(t.x,t.y,1);var r=new o.Matrix4;return r.makeTranslation(-e.x,-e.y,0),n.multiply(r),n}(new o.Vector2(0,1),new o.Vector2(1,-1));c.multiply(l),l.copy(c),s.multiplyMatrices(l,e.tilingUVTransform),a.getInverse(s);var u=new o.Vector4(1,0,0,0).applyMatrix4(a);n.set(u.x,u.y),u=new o.Vector4(0,1,0,0).applyMatrix4(a),r.set(u.x,u.y);for(var d=new o.Vector2,h=new o.Box2,f=t.alignedVertices,p=0;p<f.length;p++)u.set(f[p].x,f[p].y,0,1),u.applyMatrix4(s),d.set(u.x,u.y),h.expandByPoint(d);u.set(-h.min.x,-h.min.y,0,0),u.applyMatrix4(a),i.set(u.x,u.y);var m=h.size(),g=1===t.randomOffsetMode?new o.Vector2(m.x,m.y):new o.Vector2(0,0);n.multiplyScalar(1-g.x),r.multiplyScalar(1-g.y)}}function b(e,t,n){var r=new o.Vector2(n.x,n.y).sub(t),i=new o.Vector2(e.x,e.y).sub(t),s=r.dot(i);if(s<=0)return i.length();var a=r.dot(r);return s>=a?new o.Vector2(e).sub(n).length():Math.sqrt(Math.max(i.dot(i)-s*s/a,0))}function x(e,t){for(var n=1e11,r=n,i=-1,o=0;o<e.vertices.length;o++){var s=o==e.vertices.length-1?0:o+1;(r=b(t,e.vertices[o],e.vertices[s]))<n&&(n=r,i=o)}return[n,i]}function w(e,t,n){for(var r=e.length,i=r-1,o=!1,s=0;s<r;++s)(e[s].y<n&&e[i].y>=n||e[i].y<n&&e[s].y>=n)&&e[s].x+(n-e[s].y)/(e[i].y-e[s].y)*(e[i].x-e[s].x)<t&&(o=!o),i=s;return o}function E(e,t){var n=t.bbox.size(),r=2*e.cornerRoundingSize*.7071/3,i=P(Math.ceil(n.x/r)+2,128,1024),s=P(Math.ceil(n.y/r)+2,128,1024);i-=2,s-=2,n.x<n.y?s=Math.floor(i*n.y/n.x):i=Math.floor(s*n.x/n.y),i+=2,s+=2,function(e,t){e.normalToEdges=[];for(var n=e.vertices.length,r=Math.cos(t),i=Math.sin(t),s=0;s<n;++s){var a=s,l=s==n-1?0:s+1,c=new o.Vector2(e.vertices[l].x,e.vertices[l].y);c.sub(e.vertices[a]),c.normalize();var u=new o.Vector3(c.y*i,-c.x*i,r);e.normalToEdges.push(u)}e.cornerRoundingAngle=t}(t,e.cornerRoundingAngle);for(var a=new Uint8Array(i*s*4),l=new o.Vector2(n.x/(i-2),n.y/(s-2)),c=new o.Vector2,u=new o.Vector3,d=new o.Vector3(0,0,1),h=0,f=0;f<s;f++){c.y=(s-f-1.5)*l.y+t.bbox.min.y;for(var p=0;p<i;p++){c.x=(p-.5)*l.x+t.bbox.min.x;var m=x(t,c),g=m[0],v=m[1];g<e.cornerRoundingSize+e.insetSize?(w(t.vertices,c.x,c.y)||(g=-g),u.copy(t.normalToEdges[v]),u.lerp(d,(g-e.insetSize)/e.cornerRoundingSize),u.normalize(),a[h++]=255*P(.5*(u.x+1),0,1),a[h++]=255*P(.5*(u.y+1),0,1),a[h++]=255*P(.5*(u.z+1),0,1),a[h++]=255):(a[h++]=127,a[h++]=127,a[h++]=255,a[h++]=255)}}t.material.TilingNormalMap=new o.DataTexture(a,i,s,o.RGBAFormat,o.UnsignedByteType,o.UVMapping,o.ClampToEdgeWrapping,o.ClampToEdgeWrapping,o.LinearFilter,o.LinearFilter),t.material.TilingNormalMap.needsUpdate=!0;var y=new o.Vector2(-t.bbox.min.x,-t.bbox.min.y);t.material.TilingNormalMap_texMatrix=new o.Matrix3,t.material.TilingNormalMap_texMatrix.set(1/n.x*(i-2)/i,0,0,0,1/n.y*(s-2)/s,0,y.x/n.x*(i-2)/i+1/i,y.y/n.y*(s-2)/s+1/s,1),t.material.TilingNormalMap_texMatrix.transpose()}function A(e,t){return e<<t|e>>>32-t}function M(e,t){var n,r,i;return n=r=i=3735928567+t,r+=e.y,function(e,t,n){var r=4294967296;return n=((n^=t)-A(t,14)+r)%r,n=((n^=t=((t^=e=((e^=n)-A(n,11)+r)%r)-A(e,25)+r)%r)-A(t,16)+r)%r,n=((n^=t=((t^=e=((e^=n)-A(n,4)+r)%r)-A(e,14)+r)%r)-A(t,24)+r)%r}(n+=e.x,r,i)}function S(e,t){for(var n,r,i=new Uint8Array(1048576),s=new o.Vector2,a=new o.Vector2(107021*t,t),l=new o.Vector2,c=new o.Vector2,u=0,d=0;d<512;d++){s.y=Math.floor(-(d+1-256));for(var h=0;h<512;h++)s.x=Math.floor(h-256),l.copy(s),l.add(a),n=c,r=void 0,r=M(l,33),n.x=(65535&r)>>>8,n.y=r>>>16>>>8,i[u++]=0,i[u++]=0,i[u++]=c.x,i[u++]=c.y}e.material.TilingRandomMap=new o.DataTexture(i,512,512,o.RGBAFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter),e.material.TilingRandomMap.needsUpdate=!0;new o.Vector2(-e.bbox.min.x,-e.bbox.min.y);e.material.TilingRandomMap_texMatrix=new o.Matrix3,e.material.TilingRandomMap_texMatrix.set(1/512,0,0,0,1/512,0,.5,.5,1),e.material.TilingRandomMap_texMatrix.transpose()}function T(e,t,n){var r=[];r[0]=new o.Vector2(e.offsetVectorA.x,e.offsetVectorB.x),r[1]=new o.Vector2(e.offsetVectorA.y,e.offsetVectorB.y);for(var i=C(r),s=new o.Box2,a=new o.Vector2,l=0;l<t.vertices.length;++l)a.x=t.vertices[l].dot(i[0]),a.y=t.vertices[l].dot(i[1]),s.expandByPoint(a);n[0]=Math.floor(s.min.x-1),n[2]=Math.ceil(s.max.x),n[1]=Math.floor(s.min.y-1),n[3]=Math.ceil(s.max.y)}function C(e){var t=e[0].x*e[1].y-e[0].y*e[1].x,n=[];return n[0]=new o.Vector2(e[1].y/t,-e[0].y/t),n[1]=new o.Vector2(-e[1].x/t,e[0].x/t),n}function P(e,t,n){return e>n?n:e<t?t:e}function L(e,t){var n=new i.MSDFShape;!function(e,t){for(var n=e.addBlankContour(),r=new o.Vector2,s=new o.Vector2,a=0;a<t.vertices.length;++a){var l=a,c=(a+1)%t.vertices.length;r=t.vertices[l],s=t.vertices[c],n.addEdge(new i.MSDFLinearSegment(r,s,i.MSDF_EDGE_COLOR_WHITE))}e.initialize(),e.edgeColoringSimple(3,0)}(n,t);for(var r=t.bbox.size(),s=.7071*n.minSameColoredEdgeDistance()*.5,a=P(Math.ceil(r.x/s)+2,16,512),l=P(Math.ceil(r.y/s)+2,16,512),c=new Uint8Array(a*l*4),u=new o.Vector2(r.x/(a-2),r.y/(l-2)),d=(new o.Vector2(u.x*a,u.y*l),.5/(u.x+u.y)),h=new o.Vector2,f=new o.Vector3,p=0,m=0;m<l;m++){h.y=(l-m-1.5)*u.y+t.bbox.min.y;for(var g=0;g<a;g++)h.x=(g-.5)*u.x+t.bbox.min.x,f=(f=n.calculateMSDFValue(h)).add(new o.Vector3(e.insetSize,e.insetSize,e.insetSize)),c[p++]=255*P(f.x*d+.5,0,1),c[p++]=255*P(f.y*d+.5,0,1),c[p++]=255*P(f.z*d+.5,0,1),c[p++]=0}t.material.TilingMap=new o.DataTexture(c,a,l,o.RGBAFormat,o.UnsignedByteType,o.UVMapping,o.ClampToEdgeWrapping,o.ClampToEdgeWrapping,o.LinearFilter,o.LinearFilter),t.material.TilingMap.needsUpdate=!0;var v=new o.Vector2(-t.bbox.min.x,-t.bbox.min.y);t.material.TilingMap_texMatrix=new o.Matrix3,t.material.TilingMap_texMatrix.set(1/r.x*(a-2)/a,0,0,0,1/r.y*(l-2)/l,0,v.x/r.x*(a-2)/a+1/a,v.y/r.y*(l-2)/l+1/l,1),t.material.TilingMap_texMatrix.transpose()}function D(e,t,n){var r=e.properties;t.clampS=!c(r,"booleans","texture_URepeat",!1),t.clampT=!c(r,"booleans","texture_VRepeat",!1),t.wrapS=t.clampS?o.ClampToEdgeWrapping:o.RepeatWrapping,t.wrapT=t.clampT?o.ClampToEdgeWrapping:o.RepeatWrapping,t.matrix=e.matrix||(e.matrix=v(r,n)),"UnifiedBitmap"==e.definition&&(t.invert=c(r,"booleans","unifiedbitmap_Invert",!1)),"BumpMap"==e.definition&&(t.bumpmapType=c(r,"choicelists","bumpmap_Type",0),t.bumpScale=function(e,t,n){if(0===t){var r=u(e,"bumpmap_Depth",n,0),i=1,s=1;return null!=c(e,"scalars","texture_RealWorldScale")?i=s=u(e,"texture_RealWorldScale",n,1):(i=u(e,"texture_RealWorldScaleX",n,1),s=u(e,"texture_RealWorldScaleY",n,1)),i=0===i?1:1/i,s=0===s?1:1/s,new o.Vector2(i*r,s*r)}var a=c(e,"scalars","bumpmap_NormalScale",1);return new o.Vector2(a,a)}(r,t.bumpmapType,n))}function R(e){var t=a(e,"texture_UScale",1),n=a(e,"texture_VScale",1),r=a(e,"texture_UOffset",0),i=a(e,"texture_VOffset",0),o=a(e,"texture_WAngle",0);return{elements:[Math.cos(o)*t,Math.sin(o)*n,0,-Math.sin(o)*t,Math.cos(o)*n,0,r,i,1]}}function I(e,t,n){return e.matrix||(e.matrix=t?v(e.properties,n):R(e.properties)),e.matrix}function j(e){var t=e.materials,n=t[e.userassets[0]];if(n){var r=n.definition;if("TilingPattern"===r)(n=t[n.properties.references.grout_material.connections[0]])&&(r=n.definition);return"PrismLayered"==r||"PrismMetal"==r||"PrismOpaque"==r||"PrismTransparent"==r||"PrismGlazing"==r||"PrismWood"==r}return!1}function O(e){return.299*e.r+.587*e.g+.114*e.b}var N={convertMaterial:function(e,t,n,i){i=i||e.userassets;var u=e.materials,h=u[i];h&&"TilingPattern"===h.definition&&(h=u[h.properties.references.grout_material.connections[0]]);var g,v,_=h.properties,b=j(e);if(n){if(!(b?n.isPrismMaterial:n instanceof o.MeshPhongMaterial))return null;n.needsUpdate=!0}else n=b?Object(r.createPrismMaterial)():new o.MeshPhongMaterial;if(n.proteinMat=e,n.proteinCategories=h.categories,n.packedNormals=!0,h&&b){n.tag=h.tag,n.prismType=h.definition,void 0===n.prismType&&(n.prismType=""),void 0!==e.IsSingleSided&&!1===e.IsSingleSided&&(n.side=o.DoubleSide);var x=n.mapList;switch(n.transparent=!1,n.envExponentMin=1,n.envExponentMax=512,n.envExponentCount=10,n.surface_albedo=f(s(_,"surface_albedo",new o.Color(1,0,0))),x.surface_albedo_map=d(_,"colors","surface_albedo",null),n.surface_anisotropy=c(_,"scalars","surface_anisotropy",0),x.surface_anisotropy_map=d(_,"scalars","surface_anisotropy",null),n.surface_rotation=c(_,"scalars","surface_rotation",0),x.surface_rotation_map=d(_,"scalars","surface_rotation",null),n.surface_roughness=c(_,"scalars","surface_roughness",0),x.surface_roughness_map=d(_,"scalars","surface_roughness",null),x.surface_cutout_map=d(_,"textures","surface_cutout",null),x.surface_normal_map=d(_,"textures","surface_normal",null),null!=x.surface_cutout_map&&(n.side=o.DoubleSide,n.transparent=!0),n.prismType){case"PrismOpaque":n.opaque_albedo=f(s(_,"opaque_albedo",new o.Color(1,0,0))),x.opaque_albedo_map=d(_,"colors","opaque_albedo",null),n.opaque_luminance_modifier=f(s(_,"opaque_luminance_modifier",new o.Color(0,0,0))),x.opaque_luminance_modifier_map=d(_,"colors","opaque_luminance_modifier",null),n.opaque_f0=c(_,"scalars","opaque_f0",0),x.opaque_f0_map=d(_,"scalars","opaque_f0",null),n.opaque_luminance=c(_,"scalars","opaque_luminance",0);break;case"PrismMetal":n.metal_f0=f(s(_,"metal_f0",new o.Color(1,0,0))),x.metal_f0_map=d(_,"colors","metal_f0",null);break;case"PrismLayered":n.layered_bottom_f0=f(s(_,"layered_bottom_f0",new o.Color(1,1,1))),x.layered_bottom_f0_map=d(_,"colors","layered_bottom_f0",null),n.layered_diffuse=f(s(_,"layered_diffuse",new o.Color(1,0,0))),x.layered_diffuse_map=d(_,"colors","layered_diffuse",null),n.layered_anisotropy=c(_,"scalars","layered_anisotropy",0),x.layered_anisotropy_map=d(_,"scalars","layered_anisotropy",null),n.layered_f0=c(_,"scalars","layered_f0",0),x.layered_f0_map=d(_,"scalars","layered_f0",null),n.layered_fraction=c(_,"scalars","layered_fraction",0),x.layered_fraction_map=d(_,"scalars","layered_fraction",null),n.layered_rotation=c(_,"scalars","layered_rotation",0),x.layered_rotation_map=d(_,"scalars","layered_rotation",null),n.layered_roughness=c(_,"scalars","layered_roughness",0),x.layered_roughness_map=d(_,"scalars","layered_roughness",null),x.layered_normal_map=d(_,"textures","layered_normal",null);break;case"PrismTransparent":n.transparent_color=f(s(_,"transparent_color",new o.Color(1,0,0))),n.transparent_distance=c(_,"scalars","transparent_distance",0),n.transparent_ior=c(_,"scalars","transparent_ior",0),n.transparent=!0;break;case"PrismGlazing":n.glazing_f0=f(s(_,"glazing_f0",new o.Color(1,1,1))),x.glazing_f0_map=d(_,"colors","glazing_f0",null),n.glazing_transmission_color=f(s(_,"glazing_transmission_color",new o.Color(1,1,1))),x.glazing_transmission_color_map=d(_,"colors","glazing_transmission_color",null),n.glazing_transmission_roughness=a(_,"glazing_transmission_roughness",0),x.glazing_transmission_roughness_map=d(_,"scalars","glazing_transmission_roughness",null),n.side=c(_,"booleans","glazing_backface_culling",!1)?o.FrontSide:o.DoubleSide,n.transparent=!0;break;case"PrismWood":y(n,_,"wood_fiber_cosine"),y(n,_,"wood_fiber_perlin"),n.wood_fiber_perlin_scale_z=c(_,"scalars","wood_fiber_perlin_scale_z",0),y(n,_,"wood_growth_perlin"),n.wood_latewood_ratio=c(_,"scalars","wood_latewood_ratio",0),n.wood_earlywood_sharpness=c(_,"scalars","wood_earlywood_sharpness",0),n.wood_latewood_sharpness=c(_,"scalars","wood_latewood_sharpness",0),n.wood_ring_thickness=c(_,"scalars","wood_ring_thickness",0),y(n,_,"wood_earlycolor_perlin"),n.wood_early_color=f(s(_,"wood_early_color",new o.Color(1,0,0))),n.wood_use_manual_late_color=c(_,"booleans","wood_use_manual_late_color",0),n.wood_manual_late_color=f(s(_,"wood_manual_late_color",new o.Color(1,0,0))),y(n,_,"wood_latecolor_perlin"),n.wood_late_color_power=c(_,"scalars","wood_late_color_power",0),y(n,_,"wood_diffuse_perlin"),n.wood_diffuse_perlin_scale_z=c(_,"scalars","wood_diffuse_perlin_scale_z",0),n.wood_use_pores=c(_,"booleans","wood_use_pores",0),n.wood_pore_type=c(_,"choicelists","wood_pore_type",0),n.wood_pore_radius=c(_,"scalars","wood_pore_radius",0),n.wood_pore_cell_dim=c(_,"scalars","wood_pore_cell_dim",0),n.wood_pore_color_power=c(_,"scalars","wood_pore_color_power",0),n.wood_pore_depth=c(_,"scalars","wood_pore_depth",0),n.wood_use_rays=c(_,"booleans","wood_use_rays",0),n.wood_ray_color_power=c(_,"scalars","wood_ray_color_power",0),n.wood_ray_seg_length_z=c(_,"scalars","wood_ray_seg_length_z",0),n.wood_ray_num_slices=c(_,"integers","wood_ray_num_slices",0),n.wood_ray_ellipse_z2x=c(_,"scalars","wood_ray_ellipse_z2x",0),n.wood_ray_ellipse_radius_x=c(_,"scalars","wood_ray_ellipse_radius_x",0),n.wood_use_latewood_bump=c(_,"booleans","wood_use_latewood_bump",0),n.wood_latewood_bump_depth=c(_,"scalars","wood_latewood_bump_depth",0),n.wood_use_groove_roughness=c(_,"booleans","wood_use_groove_roughness",0),n.wood_groove_roughness=c(_,"scalars","wood_groove_roughness",0),n.wood_diffuse_lobe_weight=c(_,"scalars","wood_diffuse_lobe_weight",0),n.wood_curly_distortion_enable=c(_,"booleans","wood_curly_distortion_enable",0),n.wood_curly_distortion_scale=c(_,"scalars","wood_curly_distortion_scale",0),x.wood_curly_distortion_map=d(_,"scalars","wood_curly_distortion_map",null),m||function(){var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=new Uint8Array(e),n=new o.DataTexture(t,256,1,o.LuminanceFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter,0);n.generateMipmaps=!1,n.flipY=!1,n.needsUpdate=!0;var r=new Uint8Array([225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197]),i=new o.DataTexture(r,256,1,o.LuminanceFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter,0);i.generateMipmaps=!1,i.flipY=!1,i.needsUpdate=!0;for(var s,a,l,c,u,d,h,f,p=function(t){return e[t%256]},g=new Array(262144),v=0;v<256;++v)for(f=0;f<256;++f)s=p(f)+v,a=p(s),l=p(s+1),c=p(f+1)+v,u=p(c),d=p(c+1),g[h=4*(256*v+f)]=a,g[h+1]=l,g[h+2]=u,g[h+3]=d;var y=new Uint8Array(g),_=new o.DataTexture(y,256,256,o.RGBAFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter,0);_.generateMipmaps=!1,_.flipY=!1,_.needsUpdate=!0;var b=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],x=new Array(1024);for(f=0;f<256;++f){var w=e[f]%16;x[4*f]=127*b[3*w]+128,x[4*f+1]=127*b[3*w+1]+128,x[4*f+2]=127*b[3*w+2]+128,x[4*f+3]=0}var E=new Uint8Array(x),A=new o.DataTexture(E,256,1,o.RGBAFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter,0);A.generateMipmaps=!1,A.flipY=!1,A.needsUpdate=!0,m={permutation:n,gradient:i,perm2D:_,permGrad:A}}(),n.uniforms.permutationMap.value=m.permutation,n.uniforms.gradientMap.value=m.gradient,n.uniforms.perm2DMap.value=m.perm2D,n.uniforms.permGradMap.value=m.permGrad;break;default:o.warn("Unknown prism type: "+n.prismType)}for(var w in n.enableImportantSampling&&(n.surface_anisotropy||n.surface_rotation||n.layered_anisotropy||n.layered_rotation)&&(p||function(){var e=new Uint8Array([0,128,64,191,32,160,96,223,16,143,80,207,48,175,112,239,8,135,72,199,40,167,103,231,25,151,88,215,56,183,120,250]),t=new o.DataTexture(e,32,1,o.LuminanceFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter,0);t.generateMipmaps=!1,t.flipY=!1,t.needsUpdate=!0;for(var n,r,i=function(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))},s=new Uint8Array(16384),a=0;a<128;++a)for(var l=0;l<128;++l){n=a/128*2-1,r=l/128*2-1;var c=(n=Math.min(Math.max(1/128-1,n),1-1/128))-1/128,u=n+1/128,d=(r=Math.min(Math.max(1/128-1,r),1-1/128))-1/128,h=r+1/128,f=i(u,h)-i(c,h)-i(u,d)+i(c,d);s[128*a+l]=1e6*f}var m=new o.DataTexture(s,128,128,o.LuminanceFormat,o.UnsignedByteType,o.UVMapping,o.RepeatWrapping,o.RepeatWrapping,o.NearestFilter,o.NearestFilter,0);m.generateMipmaps=!1,m.flipY=!1,m.needsUpdate=!0,p={randomNum:t,solidAngle:m}}(),n.uniforms.importantSamplingRandomMap.value=p.randomNum,n.uniforms.importantSamplingSolidAngleMap.value=p.solidAngle),n.defines={},n.textureMaps={},x)if(x[w]){var E=u[x[w]];v=E.properties,E.matrix=I(E,!0,t);var A="BumpMap"==E.definition?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",M=v.uris[A].values,S=M[0];S&&(g={mapName:w,uri:S,uriPointer:M,textureObj:E,isPrism:!0},n.textureMaps[g.mapName]=g,n.defines["USE_"+w.toUpperCase()]="")}n.defines[n.prismType.toUpperCase()]="","PrismWood"==n.prismType&&n.enable3DWoodBump&&(n.defines.PRISMWOODBUMP=""),n.enableImportantSampling&&(n.defines.ENABLEIMPORTANTSAMPLING="")}else if(h&&!b&&"SimplePhong"==h.definition){n.tag=h.tag,n.proteinType=h.proteinType,void 0===n.proteinType&&(n.proteinType=null);var T=l(_,"generic_baked_lighting",!1);n.disableEnvMap=T;var C=n.ambient=s(_,"generic_ambient"),P=n.color=s(_,"generic_diffuse"),L=n.specular=s(_,"generic_specular"),D=n.emissive=s(_,"generic_emissive");n.shininess=a(_,"generic_glossiness",30),n.opacity=1-a(_,"generic_transparency",0),n.reflectivity=a(_,"generic_reflectivity_at_0deg",0);var R=l(_,"generic_bump_is_normal"),O=a(_,"generic_bump_amount",0);null==O&&(O=1),R?(O>1&&(O=1),n.normalScale=new o.Vector2(O,O)):(O>=1&&(O=.03),n.bumpScale=O);var N=l(_,"generic_is_metal");void 0!==N&&(n.metal=N);var k=l(_,"generic_backface_cull");void 0===k||k||(n.side=o.DoubleSide),n.transparent=h.transparent,n.textureMaps={};var F=h.textures;for(var V in F)if((g={}).textureObj=u[F[V].connections[0]],v=g.textureObj.properties,g.textureObj.matrix=I(g.textureObj,!1,t),g.uriPointer=v.uris.unifiedbitmap_Bitmap.values,g.uri=g.uriPointer[0],g.uri){if("generic_diffuse"==V)g.mapName="map",(!n.color||0===n.color.r&&0===n.color.g&&0===n.color.b)&&n.color.setRGB(1,1,1);else if("generic_bump"==V)g.mapName=R?"normalMap":"bumpMap";else if("generic_specular"==V)g.mapName="specularMap";else{if("generic_alpha"!=V)continue;g.mapName="alphaMap",n.side=o.DoubleSide,n.transparent=!0}n.textureMaps[g.mapName]=g}0===P.r&&0===P.g&&0===P.b&&0===L.r&&0===L.g&&0===L.b&&0===C.r&&0===C.g&&0===C.b&&0===D.r&&0===D.g&&0===D.b&&(P.r=P.g=P.b=.4),n.extraDepthOffset=a(_,"generic_depth_offset"),n.extraDepthOffset&&(n.polygonOffset=!0,n.polygonOffsetFactor=n.extraDepthOffset,n.polygonOffsetUnits=0)}else n.ambient=new o.Color(197379),n.color=new o.Color(7829367),n.specular=new o.Color(3355443),n.shininess=30,n.shading=o.SmoothShading;return e.transparent=n.transparent,n},materialTilingPattern:function(e,t,n,r,i){var s,l,d=t.properties,h={overallTransform:new o.Matrix4,insetSize:0,hasRoundCorner:!1,cornerRoundingAngle:0,cornerRoundingSize:0,offsetVectorA:new o.Vector2,offsetVectorB:new o.Vector2},f=new o.Vector2(u(d,"scale_factor_x",i,1),u(d,"scale_factor_y",i,1)),p=u(d,"overall_offset_vector_x",i,1),m=u(d,"overall_offset_vector_y",i,1),g=a(d,"overall_rotation_angle",0)*Math.PI/180;!function(e,t,n,r){e.scale(r);var i=new o.Vector3(Math.sin(n.x),Math.sin(n.y),Math.sin(n.z)),s=new o.Vector3(Math.cos(n.x),Math.cos(n.y),Math.cos(n.z)),a=i.y*i.x,l=i.y*s.x,c=new o.Matrix4;c.set(s.z*s.y,i.z*s.y,-i.y,0,s.z*a-i.z*s.x,i.z*a+s.z*s.x,s.y*i.x,0,s.z*l+i.z*i.x,i.z*l-s.z*i.x,s.y*s.x,0,0,0,0,1),c.multiply(e),e.makeTranslation(t.x,t.y,t.z),e.multiply(c)}(h.overallTransform,new o.Vector3(-p,-m,0),new o.Vector3(0,0,-g),new o.Vector3(1,1,1)),h.insetSize=u(d,"inset_size",i,1),h.cornerRoundingAngle=a(d,"overall_corner_rounding_angle",0)*Math.PI/180,h.cornerRoundingSize=u(d,"overall_corner_rounding_size",i,1),h.offsetVectorA.x=a(d,"offset_vector_a_x",0)*f.x,h.offsetVectorA.y=a(d,"offset_vector_a_y",0)*f.y,h.offsetVectorB.x=a(d,"offset_vector_b_x",0)*f.x,h.offsetVectorB.y=a(d,"offset_vector_b_y",0)*f.y,h.hasRoundCorner=h.cornerRoundingAngle>0&&h.cornerRoundingSize>0;var v=[];for(s=0,l=n.length;s<l;s++){var y=n[s].properties,b={material:r[s].material,randomOffsetMode:0,rotation:0,vertices:[]};v[s]=b,b.randomOffsetMode=c(y,"choicelists","random_offset_mode",0),b.rotation=a(y,"rotation_angle",0)*Math.PI/180;for(var x=y.scalars.vertices.values,w=0;w<x.length;w+=2)b.vertices[w/2]=new o.Vector2(x[w],x[w+1]);for(var A=0;A<b.vertices.length;A++)b.vertices[A].multiply(f);b.material.useRandomOffset=0!=b.randomOffsetMode}!function(e,t){var n=new o.Box2;n.expandByPoint(new o.Vector2(0,0)),n.expandByPoint(e.offsetVectorA),n.expandByPoint(e.offsetVectorB);var r,i,s=new o.Vector2(e.offsetVectorA.x,e.offsetVectorA.y);for(s.add(e.offsetVectorB),n.expandByPoint(s),r=0,i=t.length;r<i;r++){var a=t[r];a.material.tilingRepeatRange=[],T(e,a,a.material.tilingRepeatRange),a.bbox=new o.Box2;for(var l=0;l<a.vertices.length;++l)a.bbox.expandByPoint(a.vertices[l]);L(e,a),e.hasRoundCorner&&E(e,a),a.material.useRandomOffset&&S(a,r),a.alignedVertices=[];for(var c=0;c<a.vertices.length;++c){var u=new o.Vector2(a.vertices[c].x,a.vertices[c].y);u.sub(a.bbox.min),a.alignedVertices.push(u)}a.material.tileAlignOffset=new o.Vector2(-a.bbox.min.x,-a.bbox.min.y)}}(h,v);var M,P,D,R,I=C([h.offsetVectorA.clone(),h.offsetVectorB.clone()]);for(s=0,l=v.length;s<l;s++){var j=v[s],O=j.material;O.tilingOverallTransform=h.overallTransform,O.hasRoundCorner=h.hasRoundCorner,O.tilingUVTransform=(M=j.rotation,P=void 0,D=void 0,R=void 0,P=Math.sin(M),D=Math.cos(M),(R=new o.Matrix4).set(D,-P,0,0,P,D,0,0,0,0,1,0,0,0,0,1),R),O.useRandomOffset&&_(O,j),O.tile2uv=new o.Vector4(h.offsetVectorA.x,h.offsetVectorA.y,h.offsetVectorB.x,h.offsetVectorB.y),O.uv2tile=new o.Vector4(I[0].x,I[0].y,I[1].x,I[1].y)}},convertTexture:function(e,t,n,r){"bumpMap"==e.mapName||"normalMap"==e.mapName?t.anisotropy=0:t.anisotropy=r||0,t.flipY=void 0===e.flipY||e.flipY,t.invert=!1,t.wrapS=o.RepeatWrapping,t.wrapT=o.RepeatWrapping,e.isPrism?D(e.textureObj,t,n):function(e,t){if(e){var n=e.properties;t.invert=l(n,"unifiedbitmap_Invert"),t.clampS=!l(n,"texture_URepeat",!0),t.clampT=!l(n,"texture_VRepeat",!0),t.wrapS=t.clampS?o.ClampToEdgeWrapping:o.RepeatWrapping,t.wrapT=t.clampT?o.ClampToEdgeWrapping:o.RepeatWrapping,t.matrix=e.matrix||(e.matrix=R(n))}}(e.textureObj,t)},get2DMapTransform:I,isPrismMaterial:j,hasTiling:function(e){var t=e.materials[e.userassets[0]];return!(!t||"TilingPattern"!==t.definition)},convertMaterialGltf:function(e,t){var n=new o.MeshPhongMaterial;n.packedNormals=!0,n.textureMaps={};var r=e.values,i=r.diffuse;if(i)if(Array.isArray(i))n.color=new o.Color(i[0],i[1],i[2]);else if("string"==typeof i){n.color=new o.Color(1,1,1);var s={mapName:"map"},a=t.gltf.textures[i];s.uri=a.source,s.flipY=!1,n.textureMaps[s.mapName]=s}var l=r.specular;return l&&(n.specular=new o.Color(l[0],l[1],l[2])),r.shininess&&(n.shininess=r.shininess),n.reflectivity=0,n.transparent=!1,n},applyAppearanceHeuristics:function(e,t,n){var r=e.proteinMat?e.proteinMat:null,i=e.prismType&&-1!==e.prismType.indexOf("Prism");i&&e.transparent&&(e.side===o.FrontSide&&"PrismGlazing"!=e.prismType&&(e.side=o.DoubleSide),e.side===o.DoubleSide&&e.depthTest&&(e.twoPassTransparency=!0));var s=e.textureMaps||{};if(!t){var a=e.proteinType&&-1!==e.proteinType.indexOf("Prism");if(e.metal)e.reflectivity||(e.reflectivity=O(e.specular)),r&&(1===e.reflectivity&&(e.reflectivity=O(e.specular)),0===e.color.r&&0===e.color.g&&0===e.color.b||(e.color.r*=.1,e.color.g*=.1,e.color.b*=.1));else if(a){var l=!1;if("PrismLayered"===e.proteinType){e.clearcoat=!0,e.reflectivity=.06;var c=e.proteinCategories;c&&c.length&&-1!=c[0].indexOf("Metal")&&(l=!0)}e.reflectivity=Math.sqrt(e.reflectivity),l?e.specular.copy(e.color):(e.specular.r=e.reflectivity,e.specular.g=e.reflectivity,e.specular.b=e.reflectivity)}else e.reflectivity?e.reflectivity>.3?(e.metal=!0,e.specular.r=e.color.r,e.specular.g=e.color.g,e.specular.b=e.color.b,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1):(e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):1!==e.color.r||1!==e.color.g||1!==e.color.b||1!==e.specular.r||1!==e.specular.g||1!==e.specular.b||s.map||s.specularMap?(e.reflectivity=.01+.06*O(e.specular),e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):(e.metal=!0,e.reflectivity=.7,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1),e.opacity<1&&(e.reflectivity=1);(e.transparent||s.map&&-1!==s.map.uri.toLowerCase().indexOf(".png")||s.alphaMap)&&(e.alphaTest=.01)}if(s.normalMap){var u=e.bumpScale;(void 0===u||u>=1)&&(u=1),e.normalScale=new o.Vector2(u,u)}else(void 0===e.bumpScale&&(s.map||s.bumpMap)||e.bumpScale>=1)&&(e.bumpScale=.03);t&&!i||!e.transparent||(i?(e.lmv_depthWriteTransparent=!0,e.depthWrite=!!n):e.opacity>=1?s.alphaMap||(e.transparency=!1):(e.lmv_depthWriteTransparent=!0,e.depthWrite=!!n)),void 0!==e.shininess&&(e.shininess*=.25)},applyGeometryFlagsToMaterial:function(e,t){if(t.attributes.color&&(e.vertexColors=o.VertexColors,e.needsUpdate=!0),!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern){var n=!1;e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0,n=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0,n=!0),n&&void 0===e.bumpScale&&(e.bumpScale=.03)}},swapPrismWoodTextures:function(e){var t=m;return m=e,t},disposePrismWoodTextures:function(e){e&&(e.permutation.dispose(),e.gradient.dispose(),e.perm2D.dispose(),e.permGrad.dispose())}}},"./src/wgs/render/MaterialManager.js":
/*!*******************************************!*\
  !*** ./src/wgs/render/MaterialManager.js ***!
  \*******************************************/
/*! exports provided: MATERIAL_VARIANT, MaterialManager */function(e,t,n){"use strict";n.r(t),n.d(t,"MATERIAL_VARIANT",(function(){return m})),n.d(t,"MaterialManager",(function(){return g}));var r=n(/*! ./LineStyleDef */"./src/wgs/render/LineStyleDef.js"),i=n(/*! ./PrismShader */"./src/wgs/render/PrismShader.js"),o=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),s=n(/*! ./MaterialConverter */"./src/wgs/render/MaterialConverter.js"),a=(n(/*! ../scene/RenderModel */"./src/wgs/scene/RenderModel.js"),n(/*! ../../file-loaders/main/TextureLoader */"./src/file-loaders/main/TextureLoader.js")),l=n(/*! three */"./thirdparty/three.js/three.js"),c=n(/*! ./ShaderUtils */"./src/wgs/render/ShaderUtils.js"),u=n(/*! ./LineShader */"./src/wgs/render/LineShader.js"),d=n(/*! ./LineShaderSS */"./src/wgs/render/LineShaderSS.js");function h(e,t,n){e.x=t.r,e.y=t.g,e.z=t.b,e.w=n}var f=new l.Color("#0000FF"),p=.6,m={INSTANCED:0,VERTEX_IDS:1};function g(e){this._renderer=e,this._textures={},this._texturesToUpdate=[],this._materials={},this._materialsNonHDR={},this._exposureBias=0,this._tonemapMethod=0,this._envMapExposure=1,this._envRotationSin=0,this._envRotationCos=1,this._reflectionMap=null,this._irradianceMap=null,this._cutplanes=[],this._mrtNormals=!1,this._mrtIdBuffer=void 0,this._polygonOffsetOn=!1,this._pixelsPerUnit=1,this._lineStyleTex=null,this._swapBlackAndWhite=0,this._grayscaleLines=0,this._depthWriteTransparent=!0,this._needsTwoSided=!1,this._hasTransparentMaterial=!1,this.hasPrism=!1,this._layerMaskTextures=[],this._layerMaps=[],this._selectionTextures={},this._prismWoodTextures=void 0,this.defaultMaterial=new l.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:l.SmoothShading,reflectivity:0}),this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.initLineStyleTexture()}g.prototype.dtor=function(){this.cleanup(),l.Cache.clear()},g.prototype._getModelHash=function(e){return"model:"+(e?e.id:"")+"|"},g.prototype._getMaterialHash=function(e,t){return e&&e.isOTG()?t:this._getModelHash(e)+"mat:"+t},g.prototype._getTextureHash=function(e,t,n){return this._getModelHash(e)+"tex:"+t+"|map:"+n},g.prototype.addNonHDRMaterial=function(e,t){t.doNotCut||(t.cutplanes=this._cutplanes),this._applyMRTFlags(t),this._materialsNonHDR[e]=t},g.prototype.removeNonHDRMaterial=function(e){delete this._materialsNonHDR[e]},g.prototype.addMaterialNonHDR=function(e,t){this.addNonHDRMaterial(e,t)},g.prototype.addHDRMaterial=function(e,t){this._reflectionMap&&!t.disableEnvMap&&(t.envMap=this._reflectionMap),this._irradianceMap&&(t.irradianceMap=this._irradianceMap),t.exposureBias=Math.pow(2,this._exposureBias),t.tonemapOutput=this._tonemapMethod,t.envMapExposure=this._envMapExposure,t.envRotationSin=this._envRotationSin,t.envRotationCos=this._envRotationCos,this._applyCutPlanes(t),this._applyMRTFlags(t),this._applyPolygonOffset(t,this._polygonOffsetOn),this._materials[e]=t},g.prototype._applyCutPlanes=function(e){e.doNotCut||(e.cutplanes=this._cutplanes,e.needsUpdate=!0,this._cutplanes&&this._cutplanes.length>0?e.side=l.DoubleSide:this._needsTwoSided||e.is2d||(e.side=l.FrontSide))},g.prototype.addMaterial=function(e,t,n){var r=t.prismType&&-1!==t.prismType.indexOf("Prism");this.hasPrism=r||this.hasPrism,s.MaterialConverter.applyAppearanceHeuristics(t,r||n,this.isDepthWriteTransparentEnabled()),t.side===l.DoubleSide&&(this._needsTwoSided=!0),this.addHDRMaterial(e,t)},g.prototype.addLineMaterial=function(e,t,n){var r=n&&this._layerMaskTextures[n];r&&(t.defines.HAS_LAYERS=1,t.uniforms.tLayerMask.value=r),t.hasLineStyles&&(t.defines.HAS_LINESTYLES=1,t.defines.MAX_LINESTYLE_LENGTH=this._lineStyleTex.image.width,t.uniforms.tLineStyle.value=this._lineStyleTex,t.uniforms.vLineStyleTexSize.value.set(this._lineStyleTex.image.width,this._lineStyleTex.image.height)),t.uniforms.swap.value=this._swapBlackAndWhite,t.uniforms.grayscale.value=this._grayscaleLines,t.doNotCut||(t.cutplanes=this._cutplanes),this._updatePixelScaleForMaterial(t),this._materials[e]=t},g.prototype.addOverrideMaterial=function(e,t){if(this.addNonHDRMaterial(e,t),t.variants)for(var n=0;n<t.variants.length;n++){var r=t.variants[n];if(r){var i=e+"_variant_"+n;this.addNonHDRMaterial(i,r)}}},g.prototype.getMaterialVariant=function(e,t,n){var r=!!e.hash,i=(r?e.hash:this._getModelHash(n)+e.id)+"|"+t,o=this._materials[i];return o||(o=this.cloneMaterial(e,n),t===m.INSTANCED?(o.useInstancing=!0,o.vertexIds=!0):t===m.VERTEX_IDS&&(o.vertexIds=!0),this.addHDRMaterial(i,o)),r&&this._addMaterialRef(o,n.id),o},g.prototype.addInstancingSupport=function(e){var t=e.clone();t.useInstancing=!0,t.packedNormals=e.packedNormals;var n=e.clone();n.wideLines=!0,n.packedNormals=e.packedNormals,e.variants=[t,n],e.getCustomOverrideMaterial=function(e){return e.useInstancing?this.variants[0]:e.wideLines?(this.variants[1].linewidth=e.linewidth,this.variants[1]):null}},g.prototype.addCompactLayoutSupport=function(e){var t=function(t){var n=t.clone();return e.uniforms.tSelectionTexture.value&&(n.uniforms.tSelectionTexture.value=e.uniforms.tSelectionTexture.value),e.uniforms.tLayerMask.value&&(n.uniforms.tLayerMask.value=e.uniforms.tLayerMask.value),n.is2d=e.is2d,n.modelScale=e.modelScale,n.defines=Object.assign({},e.defines),n.attributes=Object.assign({},e.attributes),n},n=t(e);n.defines.UNPACK_POSITIONS=1;var r=t(e);r.defines.USE_INSTANCING=1;var i=t(e);i.defines.UNPACK_POSITIONS=1,i.defines.USE_INSTANCING=1,e.variants=[n,r,i],e.getCustomOverrideMaterial=function(e){if(e.defines){var t=(e.defines.UNPACK_POSITIONS?1:0)+(e.defines.USE_INSTANCING?2:0);if(t>0)return this.variants[t-1]}return null}},g.prototype.removeMaterial=function(e){delete this._materials[e]},g.prototype.findMaterial=function(e,t){var n=this._getMaterialHash(e,t);return this._materials[n]},g.prototype.convertSharedMaterial=function(e,t,n){var r=this.findMaterial(e,n);return r||((r=this.convertOneMaterial(e,t,n)).hash=n),this._addMaterialRef(r,e.id),r},g.prototype.convertOneMaterial=function(e,t,n){var r=e.getData(),i=r&&r.materials?r.materials.scene.SceneUnit:"inch",a=s.MaterialConverter.swapPrismWoodTextures(this._prismWoodTextures);a&&o.logger.warn("Unexpected wood textures converting a material");var c=s.MaterialConverter.convertMaterial(t,i);if(r.doubleSided&&(c.side=l.DoubleSide),this.addMaterial(n,c),this._hasTransparentMaterial=this._hasTransparentMaterial||c.transparent,s.MaterialConverter.hasTiling(t)){c.decals=[];for(var u=t.materials,d=u[t.userassets[0]],h=d.properties.references.base_materials.connections,f=d.properties.references.tiles.connections,p=[],m=0;m<f.length;m++){var g=u[f[m]];p.push(g),(b=s.MaterialConverter.convertMaterial(t,i,null,h[m])).useTiling=!0,b.transparent=!0,c.decals.push({uv:0,material:b}),this.addMaterial(n+"|tile|"+m,b)}s.MaterialConverter.materialTilingPattern(t,d,p,c.decals,i)}if(t.decals){c.decals||(c.decals=[]);for(var v=0,y=t.decals.length;v<y;v++){var _=t.decals[v],b=s.MaterialConverter.convertMaterial(_.material,i);c.decals.push({uv:_.uv||0,material:b}),this.addMaterial(n+"|decal|"+v,b)}}return this._prismWoodTextures=s.MaterialConverter.swapPrismWoodTextures(a),c},g.prototype.forEach=function(e,t,n,r){for(var i in r=r||this._materials){var o=r[i];t&&o.is2d||(e(o),n&&o.variants&&o.variants.forEach((function(t){t&&e(t)})))}};var v={needsClear:!1,needsRender:!1,overlayDirty:!1};function y(e,t,n){var r=e.slots[n];r?-1==r.indexOf(t)&&r.push(t):e.slots[n]=[t]}g.prototype.updateMaterials=function(){for(v.needsRender=!1;this._texturesToUpdate.length;){var e=this._texturesToUpdate.pop();for(var t in e.slots)for(var n=e.slots[t],r=0;r<n.length;r++)n[r][t]=e.tex,n[r].needsUpdate=!0,v.needsRender=!0}return v},g.prototype.setTextureInCache=function(e,t,n){var r=this._getTextureHash(e,t.uri,t.mapName),i=this._textures[r];if(i){for(var o in i.tex||(i.tex=n),i.slots)for(var s=i.slots[o],a=0;a<s.length;a++)s[a][o]=n;this._texturesToUpdate.push(i)}},g.prototype.loadTextureFromCache=function(e,t,n,r){var i=this._getTextureHash(e,n.uri,n.mapName),o=this._textures[i];if(o)o.tex?(t[r]=o.tex,t.needsUpdate=!0):(o.slots[r]||(o.slots[r]=[]),o.slots[r].push(t));else{var s={};s[r]=[t],this._textures[i]={slots:s,tex:null}}return!!o},g.prototype.getModelMaterials=function(e){var t=this._getModelHash(e),n={};for(var r in this._materials)-1!==r.indexOf(t)&&(n[r]=this._materials[r]);return n},g.prototype.exportModelMaterials=function(e,t){var n=this._getModelHash(e),r={};for(var i in this._materials)if(-1!==i.indexOf(n)){var o=this._materials[i];o.defines&&o.defines.hasOwnProperty("SELECTION_RENDERER")||(r[i]=o)}var s={};for(var i in this._materialsNonHDR)-1!==i.indexOf(n)&&(s[i]=this._materialsNonHDR[i]);var a={};for(var l in this._textures)-1!==l.indexOf(n)&&(a[l]=this._textures[l]);return this.cleanup(e),{mats:r,matsNonHDR:s,textures:a}},g.prototype.importModelMaterials=function(e,t){for(var n in e.mats){var r=e.mats[n];r.is2d?this.addLineMaterial(n,r,t):this.addHDRMaterial(n,r)}for(var n in e.matsNonHDR)this.addMaterialNonHDR(n,e.matsNonHDR[n]);for(var i in e.textures)this._textures[i]=e.textures[i]},g.prototype.cloneMaterial=function(e,t){var n=e.isPrismMaterial?Object(i.clonePrismMaterial)(e):e.clone();if(e.defines&&(n.defines=Object.assign({},e.defines)),(n instanceof l.MeshPhongMaterial||n.isPrismMaterial)&&(n.packedNormals=e.packedNormals,n.exposureBias=e.exposureBias,n.irradianceMap=e.irradianceMap,n.envMapExposure=e.envMapExposure,n.envRotationSin=e.envRotationSin,n.envRotationCos=e.envRotationCos,n.proteinType=e.proteinType,n.proteinMat=e.proteinMat,n.proteinCategories=e.proteinCategories,n.tonemapOutput=e.tonemapOutput,n.cutplanes=e.cutplanes,n.textureMaps=e.textureMaps,n.texturesLoaded=e.texturesLoaded),e.doNotCut&&(n.doNotCut=!0),e.is2d&&(n.is2d=!0),e.disableEnvMap&&(n.disableEnvMap=!0),e.textureMaps)for(var r in e.textureMaps)if(e[r])n[r]=e[r];else if(t){var s=n.textureMaps[r],a=s.uri,c=s.mapName,u=this._getTextureHash(t,a,c),d=this._textures[u];d?y(d,n,r):o.logger.error("Missing texture receiver",u)}else o.logger.error("Cannot connect pending texture maps because cloneMaterial was called without a model");return this._applyMRTFlags(n),n},g.prototype.setupMaterial=function(e,t,n){var r=e.getData(),i=this.findMaterial(e,n);if(!i){i=this.cloneMaterial(this.defaultMaterial,e);var a=this._getMaterialHash(e,n);this._materials[a]=i,o.logger.warn("Material ("+n+") missing, using default material instead.")}if(t.isLines||t.isWideLines||t.isPoints){var c=!!t.attributes.color,u=i;if(u||(u=this.defaultMaterial.clone()),t.isPoints)i=new l.PointCloudMaterial({vertexColors:c,size:t.pointSize});else{var d=c?"cachedLineMaterialVC":"cachedLineMaterial";i=u[d],t.isWideLines?(i||((i=u[d]=new l.MeshBasicMaterial({vertexColors:c})).wideLines=!0,t.isLines=!1),i.polygonOffset=u.polygonOffset,i.polygonOffsetFactor=u.polygonOffsetFactor,i.polygonOffsetUnits=u.polygonOffsetUnits,i.linewidth=u.linewidth):i||(i=u[d]=new l.LineBasicMaterial({vertexColors:c}))}c||(i.color=u.color),i.svfMatId=n;var h=this._getMaterialHash(e,n+"_line_"+i.id);this.addMaterialNonHDR(h,i),r.hasLines=!0}else i.svfMatId=n,s.MaterialConverter.applyGeometryFlagsToMaterial(i,t);return i},g.prototype._addMaterialRef=function(e,t){e._sharedBy||(e._sharedBy=[]);var n=e._sharedBy;-1===n.indexOf(t)&&n.push(t)},g.prototype._removeMaterialRef=function(e,t){var n=e._sharedBy,r=n?n.indexOf(t):-1;-1!==r&&n.splice(r,1)},g.prototype.cleanup=function(e){var t=this,n=this._getModelHash(e),r={};for(var i in this._textures){var o=this._textures[i];-1===i.indexOf(n)?r[i]=o:o.tex&&(o.tex.dispose(),o.tex.needsUpdate=!0)}this._textures=r;var a={},c={type:"dispose"};for(var u in this._materials){var d=this._materials[u],h=!e||-1!==u.indexOf(n);if(d._sharedBy&&(h?d._sharedBy.length=0:(this._removeMaterialRef(d,e.id),0===d._sharedBy.length&&(h=!0))),h){if((d=this._materials[u]).dispatchEvent(c),d.needsUpdate=!0,d.envMap=null,d.is2d){d.uniforms.tLayerMask.value=null,d.uniforms.tLineStyle.value=null;var f=d.uniforms.tRaster;f&&f.value instanceof l.Texture&&(f.value.dispose(),f.value.needsUpdate=!0)}}else a[u]=this._materials[u]}this._materials=a;var p={};for(var u in this._materialsNonHDR){if(e&&-1===u.indexOf(n))p[u]=this._materialsNonHDR[u];else(d=this._materialsNonHDR[u]).dispatchEvent(c),d.needsUpdate=!0}this._materialsNonHDR=p;var m=function(e,n){var r=t._selectionTextures[e];r&&(r.dispose(),r.needsUpdate=!0,n&&delete t._selectionTextures[e])};if(s.MaterialConverter.disposePrismWoodTextures(this._prismWoodTextures),this._prismWoodTextures=void 0,e)m(e.id,!0),delete this._layerMaskTextures[e.id],delete this._layerMaps[e.id];else{for(var g in this._selectionTextures)this._selectionTextures.hasOwnProperty(g)&&m(g,!1);this._selectionTextures={},this._layerMaskTextures={},this._layerMaps={}}},g.prototype.toggleDepthWriteTransparent=function(e){this._depthWriteTransparent!=e&&(this._depthWriteTransparent=e,this.forEach((function(t){t.lmv_depthWriteTransparent&&(t.depthWrite=e)}),!1,!0))},g.prototype.isDepthWriteTransparentEnabled=function(){return this._depthWriteTransparent},g.prototype.hasTwoSidedMaterials=function(){return this._needsTwoSided},g.prototype.hasTransparentMaterial=function(){return this._hasTransparentMaterial},g.prototype.texturesLoaded=function(){return 0===this._texturesToUpdate.length},g.prototype.renderer=function(){return this._renderer},g.prototype.setTonemapExposureBias=function(e){this._exposureBias=e;var t=Math.pow(2,e);this.forEach((function(e){e.exposureBias=t,e.needsUpdate=!0}),!0,!0)},g.prototype.setTonemapMethod=function(e){this._tonemapMethod=e,this.forEach((function(t){t.tonemapOutput=e,t.needsUpdate=!0}),!0,!0)},g.prototype.setEnvExposure=function(e){var t=Math.pow(2,e);this._envMapExposure=t,this.forEach((function(e){e.envMapExposure=t,e.needsUpdate=!0}),!0,!0)},g.prototype.setEnvRotation=function(e){var t=this._envRotationSin=Math.sin(e),n=this._envRotationCos=Math.cos(e);this.forEach((function(e){e.envRotationSin=t,e.envRotationCos=n,e.needsUpdate=!0}),!0,!0)},g.prototype.setReflectionMap=function(e){this._reflectionMap=e,this.forEach((function(t){t.disableEnvMap||(t.envMap=e,t.needsUpdate=!0)}),!0,!0)},g.prototype.setIrradianceMap=function(e){this._irradianceMap=e,this.forEach((function(t){t.irradianceMap=e,t.needsUpdate=!0}),!0,!0)},g.prototype.setCutPlanes=function(e){for(var t=this,n=!1,r=this._cutplanes.length!==(e&&e.length||0);this._cutplanes.length>0;)this._cutplanes.pop();if(e)for(var i=0;i<e.length;i++)this._cutplanes.push(e[i].clone());if(r)for(var o in this.forEach((function(e){t._applyCutPlanes(e),n=n||e.side==l.DoubleSide}),!1,!0),this._materialsNonHDR)this._materialsNonHDR[o].doNotCut||(this._materialsNonHDR[o].needsUpdate=!0);return n||this._needsTwoSided},g.prototype.getCutPlanes=function(){return this._cutplanes.slice()},g.prototype.getCutPlanesRaw=function(){return this._cutplanes},g.prototype._applyPolygonOffset=function(e){(e instanceof l.MeshPhongMaterial||e.isPrismMaterial)&&(e.polygonOffset=this._polygonOffsetOn,e.polygonOffsetFactor=this._polygonOffsetFactor,e.polygonOffsetUnits=this._polygonOffsetUnits,e.extraDepthOffset&&(e.polygonOffsetFactor+=e.extraDepthOffset),e.needsUpdate=!0)},g.prototype.getPolygonOffsetOn=function(){return this._polygonOffsetOn},g.prototype.getPolygonOffsetFactor=function(){return this._polygonOffsetFactor},g.prototype.getPolygonOffsetUnits=function(){return this._polygonOffsetUnits},g.prototype.togglePolygonOffset=function(e,t,n){this._polygonOffsetOn=e,this._polygonOffsetFactor=e?t||1:0,this._polygonOffsetUnits=e?n||.1:0;var r=this;this.forEach((function(e){r._applyPolygonOffset(e)}),!1,!0)},g.prototype._applyMRTFlags=function(e){var t=e.supportsMrtNormals||e instanceof l.MeshPhongMaterial||e.isPrismMaterial||e instanceof l.MeshBasicMaterial||e instanceof l.LineBasicMaterial,n=e.mrtNormals,r=e.mrtIdBuffer,i=this._renderer&&this._renderer.supportsMRT();e.mrtNormals=t&&i&&this._mrtNormals,e.mrtIdBuffer=i?this._mrtIdBuffer:void 0,e.mrtNormals===n&&e.mrtIdBuffer===r||(e.needsUpdate=!0)},g.prototype.toggleMRTSetting=function(e){this._mrtNormals=e.mrtNormals,this._mrtIdBuffer=e.mrtIdBuffer;var t=this;function n(e){t._applyMRTFlags(e)}this.forEach(n,!0),this.forEach(n,!0,!0,this._materialsNonHDR)},g.prototype.initLineStyleTexture=function(){this._lineStyleTex=Object(r.createLinePatternTexture)()},g.prototype.setLineStyleTexture=function(e){this._lineStyleTex=e},g.prototype.initLayersTexture=function(e,t,n){for(var r=this._layerMaskTextures[n],i=r?r.image.data:new Uint8Array(65536),o=0,s=e;o<s;o++)i[o]=255;(r=r||new l.DataTexture(i,256,256,l.LuminanceFormat,l.UnsignedByteType,l.UVMapping,l.ClampToEdgeWrapping,l.ClampToEdgeWrapping,l.NearestFilter,l.NearestFilter,0)).generateMipmaps=!1,r.flipY=!1,r.needsUpdate=!0,this._layerMaskTextures[n]=r,this._layerMaps[n]=t},g.prototype.setLayerVisible=function(e,t,n){for(var r=this._layerMaskTextures[n],i=r.image.data,o=this._layerMaps[n],s=t?255:0,a=0;a<e.length;++a){i[o[e[a]]]=s}r.needsUpdate=!0,this.forEach((function(e){e.is2d&&(e.needsUpdate=!0)}))},g.prototype.initSelectionTexture=function(e,t){for(var n=e||1,r=0|Math.ceil(n/4096),i=1;i<r;)i*=2;r=i;for(var o=new Uint8Array(4096*r),s=0;s<n;s++)o[s]=0;var a=new l.DataTexture(o,4096,r,l.LuminanceFormat,l.UnsignedByteType,l.UVMapping,l.ClampToEdgeWrapping,l.ClampToEdgeWrapping,l.NearestFilter,l.NearestFilter,0);return a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,this._selectionTextures[t]=a,a},g.prototype.highlightObject2D=function(e,t,n){var r=this._selectionTextures[n];r&&(r.image.data[e]=t?255:0,r.needsUpdate=!0)},g.prototype._updatePixelScaleForMaterial=function(e){e.is2d&&(e.isScreenSpace?(e.uniforms.size.value.set(this._deviceWidth,this._deviceHeight),e.uniforms.aaRange.value=.5):e.uniforms.aaRange.value=.5/(this._pixelsPerUnit*e.modelScale),e.uniforms.pixelsPerUnit.value=this._pixelsPerUnit*e.modelScale)},g.prototype.updatePixelScale=function(e,t,n){var r=this;this._pixelsPerUnit=e,this._deviceWidth=t,this._deviceHeight=n,this.forEach((function(e){return r._updatePixelScaleForMaterial(e)}))},g.prototype.updateSwapBlackAndWhite=function(e){var t=this._swapBlackAndWhite=e?1:0;this.forEach((function(e){e.is2d&&(e.uniforms.swap.value=t)}))},g.prototype.setGrayscale=function(e){var t=this._grayscaleLines=e?1:0;this.forEach((function(e){e.is2d&&(e.uniforms.grayscale.value=t)}))},g.prototype.updateViewportId=function(e){this.forEach((function(t){t.is2d&&(t.uniforms.viewportId.value=e,t.needsUpdate=!0)}))},g.prototype.create2DMaterial=function(e,t,n,r,i){var o=e?e.getData():null,s="__lineMaterial__";t.image&&(s+="|image:"+t.image.name),t.clip&&(s+="|clip:"+JSON.stringify(t.clip)),n&&(s+="|id"),r&&(s+="|selection"),t.skipEllipticals&&(s+="|skipEllipticals"),t.skipCircles&&(s+="|skipCircles"),t.skipTriangleGeoms&&(s+="|skipTriangleGeoms"),t.useInstancing&&(s+="|useInstancing"),t.isScreenSpace&&(s+="|isScreenSpace"),t.unpackPositions&&(s+="|unpackPositions"),t.hasLineStyles&&(s+="|hasLineStyles");var h=this._getMaterialHash(e,s);if(!this._materials.hasOwnProperty(h)){var f;if(t.isScreenSpace?(f=Object(c.createShaderMaterial)(d.LineShaderSS)).isScreenSpace=!0:f=Object(c.createShaderMaterial)(u.LineShader),t.hasLineStyles&&(f.hasLineStyles=!0),f.is2d=!0,f.transparent=!0,f.depthWrite=!1,f.depthTest=!1,f.side=l.DoubleSide,f.blending=l.NormalBlending,n?(f.defines.ID_COLOR=1,f.blending=l.NoBlending):r?(f.uniforms.tSelectionTexture.value=r,f.uniforms.vSelTexSize.value.set(r.image.width,r.image.height),f.defines.SELECTION_RENDERER=1,this.get2dSelectionColor(f.uniforms.selectionColor)):(this.get2dSelectionColor(f.uniforms.selectionColor),this.renderer()&&this.renderer().supportsMRT()&&(f.mrtIdBuffer=this._mrtIdBuffer)),t.skipEllipticals||(f.defines.HAS_ELLIPTICALS=1),t.skipCircles||(f.defines.HAS_CIRCLES=1),t.skipTriangleGeoms||(f.defines.HAS_TRIANGLE_GEOMS=1),t.useInstancing&&(f.defines.USE_INSTANCING=1),t.unpackPositions&&!n&&(f.defines.UNPACK_POSITIONS=1),t.msdfFontTexture&&(f.attributes.extraParams=1,f.defines.MSDF_TEXTURE_FONT=1),t.viewportBounds&&(f.uniforms.viewportBounds.value=t.viewportBounds,f.defines.VIEWPORT_CLIPPING=1),t.image){var p=function(n,r){n?(n.wrapS=l.ClampToEdgeWrapping,n.wrapT=l.ClampToEdgeWrapping,n.minFilter=r?l.LinearFilter:l.LinearMipMapLinearFilter,n.magFilter=l.LinearFilter,n.anisotropy=1,n.flipY=!0,n.generateMipmaps=!0,n.needsUpdate=!0,t.msdfFontTexture||(f.defines.HAS_RASTER_QUADS=1),f.uniforms.tRaster.value=n,"number"==typeof t.opacity&&(f.uniforms.opacity.value=t.opacity),f.needsUpdate=!0,i&&i(n,e)):i&&i(n,e,t)};if("undefined"!=typeof HTMLCanvasElement&&t.image instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t.image instanceof HTMLImageElement)p(new l.Texture(a.TextureLoader.imageToCanvas(t.image),l.UVMapping),!0);else a.TextureLoader.loadTextureWithSecurity(t.image.dataURI,l.UVMapping,p,null,o.acmSessionId)}f.modelScale=t.modelScale||1,f.textureMaps={},this.addLineMaterial(h,f,e&&e.id),(n||r)&&this.addCompactLayoutSupport(f)}return s},g.prototype.set2dSelectionColor=function(e,t){f=new l.Color(e),p=null==t?p:t,this.forEach((function(e){if(e.is2d&&e.uniforms){var t=e.uniforms.selectionColor;t&&(h(t.value,f,p),e.needsUpdate=!0)}}))},g.prototype.get2dSelectionColor=function(e){return e&&h(e.value,f,p),f},g.prototype.get2dSelectionOpacity=function(){return p}},"./src/wgs/render/NormalsShader.js":
/*!*****************************************!*\
  !*** ./src/wgs/render/NormalsShader.js ***!
  \*****************************************/
/*! exports provided: NormalsShader */function(e,t,n){"use strict";n.r(t),n.d(t,"NormalsShader",(function(){return a}));var r=n(/*! ./shaders/normals_vert.glsl */"./src/wgs/render/shaders/normals_vert.glsl"),i=n.n(r),o=n(/*! ./shaders/normals_frag.glsl */"./src/wgs/render/shaders/normals_frag.glsl"),s=n.n(o),a={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:i.a,fragmentShader:s.a}},"./src/wgs/render/PhongShader.js":
/*!***************************************!*\
  !*** ./src/wgs/render/PhongShader.js ***!
  \***************************************/
/*! exports provided: PhongShader */function(e,t,n){"use strict";n.r(t),n.d(t,"PhongShader",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),o=n(/*! ./shaders/phong_vert.glsl */"./src/wgs/render/shaders/phong_vert.glsl"),s=n.n(o),a=n(/*! ./shaders/phong_frag.glsl */"./src/wgs/render/shaders/phong_frag.glsl"),l=n.n(a),c={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.bump,r.UniformsLib.normalmap,r.UniformsLib.lights,r.UniformsLib.fog,i.ShaderChunks.CutPlanesUniforms,i.ShaderChunks.IdUniforms,i.ShaderChunks.ThemingUniform,i.ShaderChunks.ShadowMapUniforms,i.ShaderChunks.WideLinesUniforms,{emissive:{type:"c",value:new r.Color(0)},specular:{type:"c",value:new r.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},texMatrix:{type:"m3",value:new r.Matrix3},texMatrixBump:{type:"m3",value:new r.Matrix3},texMatrixAlpha:{type:"m3",value:new r.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:s.a,fragmentShader:l.a};r.ShaderLib.firefly_phong=c},"./src/wgs/render/PrismShader.js":
/*!***************************************!*\
  !*** ./src/wgs/render/PrismShader.js ***!
  \***************************************/
/*! exports provided: GetPrismMapUniforms, PrismShader, createPrismMaterial, clonePrismMaterial */function(e,t,n){"use strict";n.r(t),n.d(t,"GetPrismMapUniforms",(function(){return u})),n.d(t,"PrismShader",(function(){return h})),n.d(t,"createPrismMaterial",(function(){return f})),n.d(t,"clonePrismMaterial",(function(){return p}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),o=n(/*! ./ShaderUtils */"./src/wgs/render/ShaderUtils.js"),s=n(/*! ./shaders/prism_vert.glsl */"./src/wgs/render/shaders/prism_vert.glsl"),a=n.n(s),l=n(/*! ./shaders/prism_frag.glsl */"./src/wgs/render/shaders/prism_frag.glsl"),c=n.n(l);function u(e){var t=e+"_texMatrix",n=e+"_invert",i={};return i[e]={type:"t",value:null},i[t]={type:"m3",value:new r.Matrix3},i[n]={type:"i",value:0},i}function d(e){var t=e+"_texMatrix",n=e+"_bumpScale",i=e+"_bumpmapType",o={};return o[e]={type:"t",value:null},o[t]={type:"m3",value:new r.Matrix3},o[n]={type:"v2",value:new r.Vector2(1,1)},o[i]={type:"i",value:0},o}var h={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.lights,r.UniformsLib.fog,i.ShaderChunks.CutPlanesUniforms,i.ShaderChunks.IdUniforms,i.ShaderChunks.ThemingUniform,i.ShaderChunks.ShadowMapUniforms,u("surface_albedo_map"),u("surface_roughness_map"),u("surface_cutout_map"),u("surface_anisotropy_map"),u("surface_rotation_map"),u("opaque_albedo_map"),u("opaque_f0_map"),u("opaque_luminance_modifier_map"),u("layered_bottom_f0_map"),u("layered_f0_map"),u("layered_diffuse_map"),u("layered_fraction_map"),u("layered_roughness_map"),u("layered_anisotropy_map"),u("layered_rotation_map"),u("metal_f0_map"),u("wood_curly_distortion_map"),u("glazing_f0_map"),u("glazing_transmission_color_map"),u("glazing_transmission_roughness_map"),d("surface_normal_map"),d("layered_normal_map"),u("TilingMap"),u("TilingNormalMap"),u("TilingRandomMap"),{surface_albedo:{type:"c",value:new r.Color(1118481)},surface_roughness:{type:"f",value:1},surface_anisotropy:{type:"f",value:1},surface_rotation:{type:"f",value:1},opaque_albedo:{type:"c",value:new r.Color(1118481)},opaque_f0:{type:"f",value:1},opaque_luminance_modifier:{type:"c",value:new r.Color(1118481)},opaque_luminance:{type:"f",value:1},metal_f0:{type:"c",value:new r.Color(1118481)},layered_f0:{type:"f",value:1},layered_diffuse:{type:"c",value:new r.Color(0)},layered_fraction:{type:"f",value:1},layered_bottom_f0:{type:"c",value:new r.Color(1118481)},layered_roughness:{type:"f",value:1},layered_anisotropy:{type:"f",value:1},layered_rotation:{type:"f",value:1},transparent_ior:{type:"f",value:2},transparent_color:{type:"c",value:new r.Color(1118481)},transparent_distance:{type:"f",value:1},glazing_f0:{type:"c",value:new r.Color(16777215)},glazing_transmission_roughness:{type:"f",value:0},glazing_transmission_color:{type:"c",value:new r.Color(16777215)},wood_fiber_cosine_enable:{type:"i",value:1},wood_fiber_cosine_bands:{type:"i",value:2},wood_fiber_cosine_weights:{type:"v4",value:new r.Vector4(2.5,.5,1,1)},wood_fiber_cosine_frequencies:{type:"v4",value:new r.Vector4(15,4,1,1)},wood_fiber_perlin_enable:{type:"i",value:1},wood_fiber_perlin_bands:{type:"i",value:3},wood_fiber_perlin_weights:{type:"v4",value:new r.Vector4(3,1,.2,1)},wood_fiber_perlin_frequencies:{type:"v4",value:new r.Vector4(40,20,3.5,1)},wood_fiber_perlin_scale_z:{type:"f",value:.3},wood_growth_perlin_enable:{type:"i",value:1},wood_growth_perlin_bands:{type:"i",value:3},wood_growth_perlin_weights:{type:"v4",value:new r.Vector4(1,2,1,1)},wood_growth_perlin_frequencies:{type:"v4",value:new r.Vector4(1,5,13,1)},wood_latewood_ratio:{type:"f",value:.238},wood_earlywood_sharpness:{type:"f",value:.395},wood_latewood_sharpness:{type:"f",value:.109},wood_ring_thickness:{type:"f",value:.75},wood_earlycolor_perlin_enable:{type:"i",value:1},wood_earlycolor_perlin_bands:{type:"i",value:2},wood_earlycolor_perlin_weights:{type:"v4",value:new r.Vector4(.3,.5,.15,1)},wood_earlycolor_perlin_frequencies:{type:"v4",value:new r.Vector4(8,3,.35,1)},wood_early_color:{type:"c",value:new r.Color(.286,.157,.076)},wood_use_manual_late_color:{type:"i",value:0},wood_manual_late_color:{type:"c",value:new r.Color(.62,.35,.127)},wood_latecolor_perlin_enable:{type:"i",value:1},wood_latecolor_perlin_bands:{type:"i",value:1},wood_latecolor_perlin_weights:{type:"v4",value:new r.Vector4(.75,.55,1,1)},wood_latecolor_perlin_frequencies:{type:"v4",value:new r.Vector4(4.5,.05,1,1)},wood_late_color_power:{type:"f",value:1.25},wood_diffuse_perlin_enable:{type:"i",value:1},wood_diffuse_perlin_bands:{type:"i",value:3},wood_diffuse_perlin_weights:{type:"v4",value:new r.Vector4(.15,.2,.05,1)},wood_diffuse_perlin_frequencies:{type:"v4",value:new r.Vector4(.05,.1,3,1)},wood_diffuse_perlin_scale_z:{type:"f",value:.2},wood_use_pores:{type:"i",value:1},wood_pore_type:{type:"i",value:0},wood_pore_radius:{type:"f",value:.04},wood_pore_cell_dim:{type:"f",value:.15},wood_pore_color_power:{type:"f",value:1.45},wood_pore_depth:{type:"f",value:.02},wood_use_rays:{type:"i",value:1},wood_ray_color_power:{type:"f",value:1.1},wood_ray_seg_length_z:{type:"f",value:5},wood_ray_num_slices:{type:"f",value:160},wood_ray_ellipse_z2x:{type:"f",value:10},wood_ray_ellipse_radius_x:{type:"f",value:.2},wood_use_latewood_bump:{type:"i",value:1},wood_latewood_bump_depth:{type:"f",value:.01},wood_use_groove_roughness:{type:"i",value:1},wood_groove_roughness:{type:"f",value:.85},wood_diffuse_lobe_weight:{type:"f",value:.9},wood_curly_distortion_enable:{type:"i",value:0},wood_curly_distortion_scale:{type:"f",value:.25},wood_ring_fraction:{type:"v4",value:new r.Vector4(0,0,0,0)},wood_fall_rise:{type:"v2",value:new r.Vector2(0,0)},permutationMap:{type:"t",value:null},gradientMap:{type:"t",value:null},perm2DMap:{type:"t",value:null},permGradMap:{type:"t",value:null},importantSamplingRandomMap:{type:"t",value:null},importantSamplingSolidAngleMap:{type:"t",value:null},irradianceMap:{type:"t",value:null},envMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},envExponentMin:{type:"f",value:1},envExponentMax:{type:"f",value:512},envExponentCount:{type:"f",value:10},tilingOverallTransform:{type:"m4",value:new r.Matrix4},uv2tile:{type:"v4",value:new r.Vector4(1,0,0,1)},tile2uv:{type:"v4",value:new r.Vector4(1,0,0,1)},tileAlignOffset:{type:"v2",value:new r.Vector2(0,0)},tilingUVTransform:{type:"m4",value:new r.Matrix4},tilingRandomAxisS:{type:"v2",value:new r.Vector2(0,0)},tilingRandomAxisT:{type:"v2",value:new r.Vector2(0,0)},tilingRandomAlignmentOffset:{type:"v2",value:new r.Vector2(0,0)}}]),vertexShader:a.a,fragmentShader:c.a};r.ShaderLib.prism=h;var f=function(){var e=Object(o.createShaderMaterial)(h);return e.defaultAttributeValues.uvw=[0,0,0],e.enable3DWoodBump=!1,e.enableImportantSampling=!1,e.mapList={},e.isPrismMaterial=!0,e},p=function(e){var t=f();switch(t.name=e.name,t.side=e.side,t.opacity=e.opacity,t.transparent=e.transparent,t.blending=e.blending,t.blendSrc=e.blendSrc,t.blendDst=e.blendDst,t.blendEquation=e.blendEquation,t.blendSrcAlpha=e.blendSrcAlpha,t.blendDstAlpha=e.blendDstAlpha,t.blendEquationAlpha=e.blendEquationAlpha,t.depthTest=e.depthTest,t.depthWrite=e.depthWrite,t.polygonOffset=e.polygonOffset,t.polygonOffsetFactor=e.polygonOffsetFactor,t.polygonOffsetUnits=e.polygonOffsetUnits,t.alphaTest=e.alphaTest,t.overdraw=e.overdraw,t.visible=e.visible,t.mapList=e.mapList,t.prismType=e.prismType,t.surface_albedo=e.surface_albedo,void 0!==e.surface_albedo_map&&(t.surface_albedo_map=e.surface_albedo_map),t.surface_roughness=e.surface_roughness,void 0!==e.surface_roughness_map&&(t.surface_roughness_map=e.surface_roughness_map),t.surface_anisotropy=e.surface_anisotropy,void 0!==e.surface_anisotropy_map&&(t.surface_anisotropy_map=e.surface_anisotropy_map),t.surface_rotation=e.surface_rotation,void 0!==e.surface_rotation_map&&(t.surface_rotation_map=e.surface_rotation_map),void 0!==e.surface_cutout_map&&(t.surface_cutout_map=e.surface_cutout_map),void 0!==e.surface_normal_map&&(t.surface_normal_map=e.surface_normal_map),t.uniforms.importantSamplingRandomMap.value=e.uniforms.importantSamplingRandomMap.value,t.uniforms.importantSamplingSolidAngleMap.value=e.uniforms.importantSamplingSolidAngleMap.value,t.prismType){case"PrismOpaque":t.opaque_albedo=(new r.Color).copy(e.opaque_albedo),t.opaque_luminance_modifier=(new r.Color).copy(e.opaque_luminance_modifier),t.opaque_f0=e.opaque_f0,t.opaque_luminance=e.opaque_luminance,void 0!==e.opaque_albedo_map&&(t.opaque_albedo_map=e.opaque_albedo_map),void 0!==e.opaque_luminance_modifier_map&&(t.opaque_luminance_modifier_map=e.opaque_luminance_modifier_map),void 0!==e.opaque_f0_map&&(t.opaque_f0_map=e.opaque_f0_map);break;case"PrismMetal":t.metal_f0=(new r.Color).copy(e.metal_f0),void 0!==e.metal_f0_map&&(t.metal_f0_map=e.metal_f0_map);break;case"PrismLayered":t.layered_f0=e.layered_f0,t.layered_diffuse=(new r.Color).copy(e.layered_diffuse),t.layered_fraction=e.layered_fraction,t.layered_bottom_f0=(new r.Color).copy(e.layered_bottom_f0),t.layered_roughness=e.layered_roughness,t.layered_anisotropy=e.layered_anisotropy,t.layered_rotation=e.layered_rotation,void 0!==e.layered_bottom_f0_map&&(t.layered_bottom_f0_map=e.layered_bottom_f0_map),void 0!==e.layered_f0_map&&(t.layered_f0_map=e.layered_f0_map),void 0!==e.layered_diffuse_map&&(t.layered_diffuse_map=e.layered_diffuse_map),void 0!==e.layered_fraction_map&&(t.layered_fraction_map=e.layered_fraction_map),void 0!==e.layered_rotationlayered_roughness_map&&(t.layered_rotationlayered_roughness_map=e.layered_rotationlayered_roughness_map),void 0!==e.layered_anisotropy_map&&(t.layered_anisotropy_map=e.layered_anisotropy_map),void 0!==e.layered_rotation_map&&(t.layered_rotation_map=e.layered_rotation_map),void 0!==e.layered_normal_map&&(t.layered_normal_map=e.layered_normal_map);break;case"PrismTransparent":t.transparent_color=(new r.Color).copy(e.transparent_color),t.transparent_distance=e.transparent_distance,t.transparent_ior=e.transparent_ior,t.transparent=e.transparent,t.twoPassTransparency=e.twoPassTransparency;break;case"PrismGlazing":t.glazing_f0=(new r.Color).copy(e.glazing_f0),t.glazing_transmission_color=(new r.Color).copy(e.glazing_transmission_color),t.glazing_transmission_roughness=e.glazing_transmission_roughness,void 0!==e.glazing_f0_map&&(t.glazing_f0_map=e.glazing_f0_map),void 0!==e.glazing_transmission_color_map&&(t.glazing_transmission_color_map=e.glazing_transmission_color_map),void 0!==e.glazing_transmission_roughness_map&&(t.glazing_transmission_roughness_map=e.glazing_transmission_roughness_map);break;case"PrismWood":t.wood_fiber_cosine_enable=e.wood_fiber_cosine_enable,t.wood_fiber_cosine_bands=e.wood_fiber_cosine_bands,t.wood_fiber_cosine_weights=(new r.Vector4).copy(e.wood_fiber_cosine_weights),t.wood_fiber_cosine_frequencies=(new r.Vector4).copy(e.wood_fiber_cosine_frequencies),t.wood_fiber_perlin_enable=e.wood_fiber_perlin_enable,t.wood_fiber_perlin_bands=e.wood_fiber_perlin_bands,t.wood_fiber_perlin_weights=(new r.Vector4).copy(e.wood_fiber_perlin_weights),t.wood_fiber_perlin_frequencies=(new r.Vector4).copy(e.wood_fiber_perlin_frequencies),t.wood_fiber_perlin_scale_z=e.wood_fiber_perlin_scale_z,t.wood_growth_perlin_enable=e.wood_growth_perlin_enable,t.wood_growth_perlin_bands=e.wood_growth_perlin_bands,t.wood_growth_perlin_weights=(new r.Vector4).copy(e.wood_growth_perlin_weights),t.wood_growth_perlin_frequencies=(new r.Vector4).copy(e.wood_growth_perlin_frequencies),t.wood_latewood_ratio=e.wood_latewood_ratio,t.wood_earlywood_sharpness=e.wood_earlywood_sharpness,t.wood_latewood_sharpness=e.wood_latewood_sharpness,t.wood_ring_thickness=e.wood_ring_thickness,t.wood_earlycolor_perlin_enable=e.wood_earlycolor_perlin_enable,t.wood_earlycolor_perlin_bands=e.wood_earlycolor_perlin_bands,t.wood_earlycolor_perlin_weights=(new r.Vector4).copy(e.wood_earlycolor_perlin_weights),t.wood_earlycolor_perlin_frequencies=(new r.Vector4).copy(e.wood_earlycolor_perlin_frequencies),t.wood_early_color=(new r.Color).copy(e.wood_early_color),t.wood_use_manual_late_color=e.wood_use_manual_late_color,t.wood_manual_late_color=(new r.Color).copy(e.wood_manual_late_color),t.wood_latecolor_perlin_enable=e.wood_latecolor_perlin_enable,t.wood_latecolor_perlin_bands=e.wood_latecolor_perlin_bands,t.wood_latecolor_perlin_weights=(new r.Vector4).copy(e.wood_latecolor_perlin_weights),t.wood_latecolor_perlin_frequencies=(new r.Vector4).copy(e.wood_latecolor_perlin_frequencies),t.wood_late_color_power=e.wood_late_color_power,t.wood_diffuse_perlin_enable=e.wood_diffuse_perlin_enable,t.wood_diffuse_perlin_bands=e.wood_diffuse_perlin_bands,t.wood_diffuse_perlin_weights=(new r.Vector4).copy(e.wood_diffuse_perlin_weights),t.wood_diffuse_perlin_frequencies=(new r.Vector4).copy(e.wood_diffuse_perlin_frequencies),t.wood_diffuse_perlin_scale_z=e.wood_diffuse_perlin_scale_z,t.wood_use_pores=e.wood_use_pores,t.wood_pore_type=e.wood_pore_type,t.wood_pore_radius=e.wood_pore_radius,t.wood_pore_cell_dim=e.wood_pore_cell_dim,t.wood_pore_color_power=e.wood_pore_color_power,t.wood_pore_depth=e.wood_pore_depth,t.wood_use_rays=e.wood_use_rays,t.wood_ray_color_power=e.wood_ray_color_power,t.wood_ray_seg_length_z=e.wood_ray_seg_length_z,t.wood_ray_num_slices=e.wood_ray_num_slices,t.wood_ray_ellipse_z2x=e.wood_ray_ellipse_z2x,t.wood_ray_ellipse_radius_x=e.wood_ray_ellipse_radius_x,t.wood_use_latewood_bump=e.wood_use_latewood_bump,t.wood_latewood_bump_depth=e.wood_latewood_bump_depth,t.wood_use_groove_roughness=e.wood_use_groove_roughness,t.wood_groove_roughness=e.wood_groove_roughness,t.wood_diffuse_lobe_weight=e.wood_diffuse_lobe_weight,t.uniforms.permutationMap.value=e.uniforms.permutationMap.value,t.uniforms.gradientMap.value=e.uniforms.gradientMap.value,t.uniforms.perm2DMap.value=e.uniforms.perm2DMap.value,t.uniforms.permGradMap.value=e.uniforms.permGradMap.value,void 0!==e.wood_curly_distortion_map&&(t.wood_curly_distortion_map=e.wood_curly_distortion_map,t.wood_curly_distortion_enable=e.wood_curly_distortion_enable,t.wood_curly_distortion_scale=e.wood_curly_distortion_scale),t.wood_ring_fraction=e.wood_ring_fraction,t.wood_fall_rise=e.wood_fall_rise;break;default:r.warn("Unknown prism type: "+e.prismType)}return t.envExponentMin=e.envExponentMin,t.envExponentMax=e.envExponentMax,t.envExponentCount=e.envExponentCount,t.envMap=e.envMap,e.useTiling&&(t.useTiling=e.useTiling,t.tilingOverallTransform=(new r.Matrix4).copy(e.tilingOverallTransform),t.TilingMap=e.TilingMap,t.TilingMap_texMatrix=(new r.Matrix3).copy(e.TilingMap_texMatrix),t.hasRoundCorner=e.hasRoundCorner,t.hasRoundCorner&&(t.TilingNormalMap=e.TilingNormalMap,t.TilingNormalMap_texMatrix=(new r.Matrix3).copy(e.TilingNormalMap_texMatrix)),t.useRandomOffset=e.useRandomOffset,t.useRandomOffset&&(t.TilingRandomMap=e.TilingRandomMap,t.TilingRandomMap_texMatrix=(new r.Matrix3).copy(e.TilingRandomMap_texMatrix),t.tilingRandomAxisS=(new r.Vector2).copy(e.tilingRandomAxisS),t.tilingRandomAxisT=(new r.Vector2).copy(e.tilingRandomAxisT),t.tilingRandomAlignmentOffset=(new r.Vector2).copy(e.tilingRandomAlignmentOffset)),t.uv2tile=e.uv2tile,t.tile2uv=e.tile2uv,t.tilingRepeatRange=[e.tilingRepeatRange[0],e.tilingRepeatRange[1],e.tilingRepeatRange[2],e.tilingRepeatRange[3]],t.tileAlignOffset=(new r.Vector2).copy(e.tileAlignOffset),t.tilingUVTransform=(new r.Matrix4).copy(e.tilingUVTransform)),t.defines=e.defines,t}},"./src/wgs/render/RenderContext.js":
/*!*****************************************!*\
  !*** ./src/wgs/render/RenderContext.js ***!
  \*****************************************/
/*! exports provided: RenderContext */function(e,t,n){"use strict";n.r(t),n.d(t,"RenderContext",(function(){return C}));var r=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),i=n(/*! ../../file-loaders/net/ErrorCodes */"./src/file-loaders/net/ErrorCodes.js"),o=n(/*! ../../compat */"./src/compat.js"),s=n(/*! three */"./thirdparty/three.js/three.js"),a=n(/*! ./ShaderUtils */"./src/wgs/render/ShaderUtils.js"),l=n(/*! ./NormalsShader */"./src/wgs/render/NormalsShader.js"),c=n(/*! ./ShaderPass */"./src/wgs/render/ShaderPass.js"),u=n(/*! ./EdgeShader */"./src/wgs/render/EdgeShader.js"),d=n(/*! ./SAOShader */"./src/wgs/render/SAOShader.js"),h=n(/*! ./SAOBlurShader */"./src/wgs/render/SAOBlurShader.js"),f=n(/*! ./SAOMinifyShader */"./src/wgs/render/SAOMinifyShader.js"),p=n(/*! ./FXAAShader */"./src/wgs/render/FXAAShader.js"),m=n(/*! ./BlendShader */"./src/wgs/render/BlendShader.js"),g=n(/*! ./BackgroundShader */"./src/wgs/render/BackgroundShader.js"),v=n(/*! ./CopyShader */"./src/wgs/render/CopyShader.js"),y=n(/*! ./RenderContextPostProcess */"./src/wgs/render/RenderContextPostProcess.js"),_=Object(o.getGlobal)().document,b=1,x=2,w=3,E=4,A=5,M=6,S=7,T=8;function C(){var e,t,n,C,P,L,D,R,I,j,O,N,k,F,V,B=!1,U=new y.RenderContextPostProcessManager;this.postShadingManager=function(){return U};var z,G,H,W,X,q,Y,K=!1,Q=null,Z=null,J=null,$=null,ee=null,te=null,ne=null,re=[],ie=0,oe=0,se=0,ae=0,le=1,ce=!1,ue=!1,de=new Uint8Array(4),he=[0,0],fe=(new s.Color).setRGB(1,1,1),pe=(new s.Color).setRGB(0,0,0),me=new s.Vector4(0,0,0,.3),ge=new s.Vector4(1,1,1,1),ve=new s.Vector4(1,1,1,.5),ye=null,_e=1,be=!1,xe=!1,we=!1,Ee=!1,Ae=!1,Me=s.RGBAFormat,Se=s.FloatType,Te=!1,Ce=0,Pe=0,Le=0,De=[.42,0,1,1],Re=!0,Ie={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,postProcShaded:!1,envMapBg:!1,numIdTargets:1,alwaysUseModelId:!1,renderEdges:!1},je={},Oe=null,Ne=null;function ke(e,t,n,r,i){var o=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,format:n,type:r,stencilBuffer:!1});return i&&(o.shareDepthFrom=i),o.name="depthTarget",o}function Fe(t){try{var n=ke(2,2,t.format,t.type);n.generateMipmaps=!1,e.setRenderTarget(n);var r=e.context,i=r.checkFramebufferStatus(r.FRAMEBUFFER);return e.setRenderTarget(null),n.dispose(),i===r.FRAMEBUFFER_COMPLETE}catch(e){return!1}}function Ve(e,t){e.depthWrite=t;for(var n=0;n<e.variants.length;n++){var r=e.variants[n];r&&(r.depthWrite=t)}}function Be(e){e(t);for(var n=1;n<t.variants.length;n++)e(t.variants[n])}function Ue(e){e.material.blending=s.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}function ze(e){switch(e){case b:return!0;case x:return Te&&(Ie.sao||Ie.postProcShaded);case w:return Ie.idbuffer;case E:return!0;case S:return Ie.sao;case A:return Ie.antialias||Ie.sao||Ie.customPresentPass||Ie.postProcShaded;case M:return Ie.postProcShaded||Ie.customPresentPass;case T:return Ie.antialias&&Ie.postProcShaded}}function Ge(e,t){var n=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,format:s.RGBAFormat,type:s.UnsignedByteType,stencilBuffer:!1});return n.generateMipmaps=!1,n.shareDepthFrom=Z,n.canReadPixels=!0,n}function He(){var t=$,n=Z;if(F.uniforms.useAO.value){var r=function(){var e=[F.uniforms.useOverlay.value,F.uniforms.objIDv4.value];return F.uniforms.useOverlay.value=0,F.uniforms.objIDv4.value=new s.Vector4,e}();F.render(e,t,n),n=t,t=ne,function(e){F.uniforms.useOverlay.value=e[0],F.uniforms.objIDv4.value=e[1]}(r)}if(U.render(e,t,n),n=t,t=t===$?ne:$,F.uniforms.useOverlay.value||F.uniforms.objIDv4.value){r=function(){var e=F.uniforms.useAO.value;return F.uniforms.useAO.value=0,e}();F.render(e,t,n),n=t,function(e){F.uniforms.useAO.value=e}(r)}return n}this.settings=Ie,this.depthTargetSupported=function(){return Te},this.isRolloverHighlightEnabled=function(){return _enableRolloverHighlight},this.isWeakDevice=function(){return be},this.init=function(y,_,b,x){var w;(function(){var e=l.NormalsShader;(t=Object(a.createShaderMaterial)(e)).blending=s.NoBlending,t.packedNormals=!0,t.depthWrite=!1;var n={NoCutPlanes:1,Instancing:2,UnpackedNormals:4,Count:8},r=[];r[0]=null;for(var i=1;i<n.Count;i++){var o=t.clone();o.packedNormals=t.packedNormals,i&n.NoCutPlanes&&(o.cutPlanes=null,o.doNotCut=!0),i&n.Instancing&&(o.useInstancing=!0),i&n.UnpackedNormals&&(o.packedNormals=!1),r[i]=o}t.variants=r,t.getCustomOverrideMaterial=function(e){var t=!e||!e.cutplanes||0==e.cutplanes.length,r=e.useInstancing,i=!e.packedNormals,o=(t?n.NoCutPlanes:0)|(r?n.Instancing:0)|(i?n.UnpackedNormals:0);return this.variants[o]}}(),function(){var e=u.EdgeShader;(n=Object(a.createShaderMaterial)(e)).depthWrite=!0,n.depthTest=!0,n.isEdgeMaterial=!0,n.transparent=!0,n.blending=s.NormalBlending;var t={Instancing:1,DoNotCut:2,Count:4},r=[];r[0]=null;for(var i=1;i<t.Count;i++){var l=n.clone();l.defines=Object(o.ObjectAssign)({},n.defines),l.isEdgeMaterial=!0,i&t.Instancing&&(l.useInstancing=!0),i&t.DoNotCut&&(l.doNotCut=!0,l.cutplanes=[]),r[i]=l}n.variants=r,n.getCustomOverrideMaterial=function(e){var r=e.useInstancing?t.Instancing:0;e.doNotCut&&(r|=t.DoNotCut);var i=this.variants[r]||n;return we?xe?i.uniforms.color.value.copy(ve):i.uniforms.color.value.copy(ge):i.uniforms.color.value.copy(me),void 0!==e.edgeOpacity&&(i.uniforms.color.value.w=e.edgeOpacity),i.uniforms.color.needsUpdate=!0,i}}(),Ue(j=new c.ShaderPass(d.SAOShader)),Ue(I=new c.ShaderPass(h.SAOBlurShader)),Ue(N=new c.ShaderPass(f.SAOMinifyFirstShader)),Ue(O=new c.ShaderPass(f.SAOMinifyShader)),Ue(k=new c.ShaderPass(p.FXAAShader)),Ue(F=new c.ShaderPass(m.BlendShader)),Ue(R=new c.ShaderPass(g.BackgroundShader)),Ue(V=new c.ShaderPass(v.CopyShader)),y)?(be=Object(o.isMobileDevice)(),Ie.idbuffer=!be,Ie.alwaysUseModelId&&(Ie.idbuffer=!0,Ie.numIdTargets=2,F.material.defines.USE_MODEL_ID="1",F.material.defines.USE_IDBUFFER_SELECTION="1"),q=_,Y=b,e=y,ue=!!x,(w=(be?[{format:s.RGBAFormat,type:s.HalfFloatType},{format:s.RGBAFormat,type:s.FloatType}]:[{format:s.RGBAFormat,type:s.FloatType},{format:s.RGBAFormat,type:s.HalfFloatType}]).find(Fe))?(Te=!0,Me=w.format,Se=w.type):(Te=!1,r.logger.warn("Depth target is unsupported for this device."))):Object(o.isNodeJS)()||r.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",Object(i.errorCodeString)(i.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED))},this.setDepthMaterialOffset=function(e,t,n){Be((function(r){r.polygonOffset=e,r.polygonOffsetFactor=t,r.polygonOffsetUnits=n,r.extraDepthOffset&&(r.polygonOffsetFactor+=r.extraDepthOffset),r.needsUpdate=!0}))},this.setNoDepthNoBlend=Ue,this.overlayUpdate=function(){if(0===Pe||-1===Pe)return!1;var e=F.uniforms.highlightIntensity.value,t=1;if(Re){var n=.004*(performance.now()-Ce);n=Math.min(n,1),t=function(e,t){var n=3*e[1],r=3*(e[3]-e[1])-n;return(((1-n-r)*t+r)*t+n)*t}(De,n)}return e!=t&&(F.uniforms.highlightIntensity.value=t,!0)},this.setRollOverFadeEnabled=function(e){Re=e},this.beginScene=function(t,n,a,l){if(P=n,D=t.fog,L=a,B=!1,K=!1,!Z&&q)this.initPostPipeline(Ie.sao,Ie.antialias);else if(!Z&&!q)return void(ce||Object(o.isNodeJS)()||(r.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",Object(i.errorCodeString)(i.ErrorCodes.VIEWER_INTERNAL_ERROR)),ce=!0));if(l){var c=Ie.envMapBg&&!!R.material.envMap;ye&&!c?(e.setClearColor(ye,_e),e.clearTarget(Z,!0,!0,!1)):(R.uniforms.uCamDir.value=P.worldUpTransform?P.getWorldDirection().clone().applyMatrix4(P.worldUpTransform):P.getWorldDirection(),R.uniforms.uCamUp.value=P.worldUpTransform?P.up.clone().applyMatrix4(P.worldUpTransform):P.up,R.uniforms.uResolution.value.set(q,Y),R.uniforms.uHalfFovTan.value=Math.tan(s.Math.degToRad(.5*P.fov)),R.uniforms.opacity.value=_e,e.clearTarget(Z,!1,!0,!1),R.render(e,Z,null)),Oe&&Oe.clearTarget(e);for(var u=0;u<re.length;u++)e.setClearColor(fe,1),e.clearTarget(re[u],!0,!1,!1)}if(ze(x)){l&&(e.setClearColor(pe,0),e.clearTarget(X,!0,!1,!1));var d=n.near,h=n.far;j.uniforms.cameraNear.value=d,j.uniforms.cameraFar.value=h,U.updateUniformValue("cameraNear",d),U.updateUniformValue("cameraFar",h),N.uniforms.cameraNear.value=d,N.uniforms.cameraInvNearFar.value=1/(d-h);var f=n.projectionMatrix.elements;n.isPerspective?j.uniforms.projInfo.value.set(-2/(Z.width*f[0]),-2/(Z.height*f[5]),(1-f[8])/f[0],(1+f[9])/f[5]):j.uniforms.projInfo.value.set(-2/(Z.width*f[0]),-2/(Z.height*f[5]),(1-f[12])/f[0],(1-f[13])/f[5]),U.updateUniformValue("projInfo",j.uniforms.projInfo.value,!0),F.uniforms.projInfo.value.copy(j.uniforms.projInfo.value);var p=n.isPerspective?0:1;j.uniforms.isOrtho.value=p,U.updateUniformValue("isOrtho",p),F.uniforms.isOrtho.value=p;j.uniforms.projScale.value=Z.height*f[5]*.125,F.uniforms.worldMatrix_mainPass.value=n.matrixWorld}Ie.sao||(F.uniforms.useAO.value=0),this.renderScenePart(t,!0,!0,!0,!0)},this.renderScenePart=function(r,i,o,s,a){var l=ze(x),c=Z,u=X,d=!1;Oe&&(c=Oe.chooseColorTarget(r,c),d=(u=Oe.getRenderSao(r)?X:null)&&X.shareDepthFrom!==c),B=!1,K=!1;var h,f=a?L:void 0;r.fog=D,Ee&&Ae?ze(w)&&s&&l?e.render(r,P,[c,u].concat(re),!1,f):l?e.render(r,P,[c,u],!1,f):ze(w)&&s?e.render(r,P,[c].concat(re)):e.render(r,P,c,!1,f):Ae?(ze(w)&&s?e.render(r,P,[c].concat(re),!1,f):e.render(r,P,c,!1,f),l&&o&&!r.sortObjects&&u&&(h=r.overrideMaterial,r.overrideMaterial=t,t.depthWrite!==d&&Ve(t,d),e.render(r,P,u,!1),r.overrideMaterial=h)):(i?e.render(r,P,c,!1,f):d=!0,ze(w)&&s&&(C?(h=r.overrideMaterial,r.overrideMaterial=C,e.render(r,P,re[0],!1),r.overrideMaterial=h):(e.setProgramPrefix(1,"#define ID_COLOR","#define ID_COLOR"),e.render(r,P,re[0],!1),e.setProgramPrefix(0,"","")),d=!1),l&&o&&!r.sortObjects&&u&&(h=r.overrideMaterial,t.depthWrite!==d&&Ve(t,d),r.overrideMaterial=t,e.render(r,P,u,!1),r.overrideMaterial=h)),i&&Ie.renderEdges&&(h=r.overrideMaterial,r.overrideMaterial=n,e.context.depthFunc(e.context.LESS),e.render(r,P,[c],!1),e.context.depthFunc(e.context.LEQUAL),r.overrideMaterial=h)},this.clearAllOverlays=function(){e.clearTarget(J,!0,!1,!1)},this.renderOverlays=function(t,r,i){var o=0;for(var s in we=!0,t){var a=t[s],l=a.scene,c=a.camera?a.camera:P;l.children.length&&(o||(o=1,i||(e.setClearColor(pe,0),e.clearTarget(J,!0,!1,!1))),a.materialPre&&(l.overrideMaterial=a.materialPre),e.render(l,c,J,!1,r),a.materialPost&&(xe=!0,e.context.depthFunc(e.context.GREATER),Ie.renderEdges&&(n.depthWrite=!1,n.depthTest=!1,l.overrideMaterial=n,e.render(l,c,J,!1)),l.overrideMaterial=a.materialPost,e.render(l,c,J,!1,r),e.context.depthFunc(e.context.LEQUAL),xe=!1),Ie.renderEdges&&a.materialPre&&(n.depthWrite=!1,n.depthTest=!0,l.overrideMaterial=n,e.render(l,c,J,!1)),l.overrideMaterial=null)}we=!1,n.depthWrite=!0,n.depthTest=!0,F.uniforms.useOverlay.value=o},this.computeSSAO=function(t){if(!t&&Ie.sao){if(!B){if(Q&&Q.length){var n=Q[0];N.uniforms.resolution.value.set(1/n.width,1/n.height),N.render(e,n,X);for(var r=1;r<Q.length;r++){var i=Q[r];O.uniforms.resolution.value.set(1/i.width,1/i.height),O.render(e,i,n),n=i}}j.render(e,te,Z),I.uniforms.axis.value.set(1,0),I.render(e,$,te),I.uniforms.axis.value.set(0,1),I.render(e,te,$),B=!0}F.uniforms.useAO.value=1}else F.uniforms.useAO.value=0},this.presentBuffer=function(t){if(e){var n=Ne||null;if(!(F.uniforms.useAO.value||F.uniforms.useOverlay.value||Oe||0!==Pe&&-1!==Pe||0!==Le&&-1!==Le))Ie.antialias?t?(k.render(e,$,Z),t.render(e,n,$)):Ie.postProcShaded?(U.render(e,$,Z),V.render(e,ee,$),k.render(e,n,ee)):k.render(e,n,Z):t?t.render(e,n,Z):Ie.postProcShaded?(U.render(e,$,Z),V.render(e,n,$)):V.render(e,n,Z);else if(Ie.antialias)if(t)F.render(e,$,Z),k.render(e,ne,$),t.render(e,n,ne);else if(Ie.postProcShaded){var r=He();V.render(e,ee,r),k.render(e,n,ee)}else F.render(e,$,Z),k.render(e,n,$);else if(t)F.render(e,$,Z),t.render(e,n,$);else if(Ie.postProcShaded){r=He();V.render(e,n,r)}else F.render(e,n,Z)}},this.composeFinalFrame=function(e,t){this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){if(e&&e.setRenderTarget(null),Z&&(Z.dispose(),Z=null),X&&(X.dispose(),X=null),J&&(J.dispose(),J=null),Oe&&Oe.disposeTargets(),$&&($.dispose(),$=null),te&&(te.dispose(),te=null),ne&&(ne.dispose(),ne=null),Q){for(var t=0;t<Q.length;t++)Q[t].dispose();Q=[]}},this.setSize=function(t,n,i,o){if(q=t,Y=n,Ie.logicalWidth=t,Ie.logicalHeight=n,0===t&&0===n||!e)this.cleanup();else{var a,l=0|t*e.getPixelRatio(),c=0|n*e.getPixelRatio();Ie.deviceWidth=l,Ie.deviceHeight=c,o||(ue?e.setViewport(0,0,t,n):e.setSize(t,n));var u=l,d=c;(Ie.useSSAA||Ie.postProcShaded&&!be&&e.getPixelRatio()<=1&&U.postProcessEdgesOn())&&(l*=2,c*=2);var h=1/l,f=1/c;if(!i&&Z&&Z.width==l&&Z.height==c||(r.logger.log("Reallocating render targets."),this.cleanup(),(Z=new s.WebGLRenderTarget(l,c,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBAFormat,type:Ie.useHdrTarget?s.FloatType:s.UnsignedByteType,stencilBuffer:!1})).generateMipmaps=!1,Z.name="colorTarget",(J=new s.WebGLRenderTarget(l,c,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,format:s.RGBAFormat,stencilBuffer:!1})).generateMipmaps=!1,J.name="overlayTarget",J.shareDepthFrom=Z,X=null,$=null,ee=null,te=null,ne=null,Q=[]),Oe&&Oe.updateTargets(l,c,i,Ie.useHdrTarget),ze(A)&&(!i&&$&&$.width==l&&$.height==c||(($=new s.WebGLRenderTarget(l,c,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).generateMipmaps=!1,$.name="postTarget1")),!te&&ze(S)&&((te=$.clone()).name="SSAO target"),!ne&&ze(M)&&((ne=$.clone()).name="post target 2"),!ee&&ze(T)&&((ee=new s.WebGLRenderTarget(u,d,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).generateMipmaps=!1,ee.name="postTargetNormal"),ze(x)){if(i||!X||X.width!=l||X.height!=c){X=ke(l,c,Me,Se,Z),Q=[];for(var p=0;p<5;p++){var m=0|l/(2<<p),g=0|c/(2<<p),v=null;m>=1&&g>=1&&((v=new s.WebGLRenderTarget(m,g,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,format:s.RGBAFormat,depthBuffer:!1,stencilBuffer:!1})).generateMipmaps=!1,Q.push(v)),j.uniforms["tDepth_mip"+(p+1)].value=v}Ee=e.verifyMRTWorks([Z,X])}j.uniforms.size.value.set(l,c),j.uniforms.resolution.value.set(h,f),j.uniforms.tDepth.value=X,I.uniforms.size.value.set(l,c),I.uniforms.resolution.value.set(h,f),U.updateUniformValue("tDepth",X),F.uniforms.tDepth.value=X}if(ze(w)){if(i||!re[0]||re[0].width!=l||re[0].height!=c){for(a=0;a<re.length;a++)re[a]&&re[a].dispose();for(re=[],a=0;a<Ie.numIdTargets;a++){var y=Ge(l,c);y.name="id "+a,re.push(y)}(Ae=e.verifyMRTWorks([Z].concat(re)))||r.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work.")}U.updateUniformValue("tID",re[0])}else if(re[0]){for(a=0;a<re.length;a++)re[a].dispose(),re[a]=null;re.length=0}k.uniforms.uResolution.value.set(h,f),U.changeResolution(h,f),F.uniforms.tOverlay.value=J,F.uniforms.tAO.value=te,F.uniforms.useAO.value=Ie.sao?1:0,F.uniforms.resolution.value.set(h,f),F.uniforms.tID.value=re[0]||null,F.uniforms.tID2.value=re[1]||null,Oe&&Oe.updateBlendPass()}},this.getMaxAnisotropy=function(){return e?e.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:Ee&&ze(x),mrtIdBuffer:Ae&&ze(w)?Ie.numIdTargets:void 0}},this.setIdTargetCount=function(e){if(!(e>2||e<1)&&e!==Ie.numIdTargets&&(Ie.numIdTargets=e,0!==re.length&&2===e&&1===re.length)){var t=Ge(re[0].width,re[0].height);return t.name="id "+re.length,re.push(t),F.uniforms.tID2.value=t,F.material.defines.USE_MODEL_ID="1",F.material.needsUpdate=!0,!0}},this.getAntialiasing=function(){return Ie.antialias},this.initPostPipeline=function(e,t){Ie.sao=e&&!o.isIE11&&Te,Ie.antialias=t&&!o.isIE11,Ie.haveTwoSided&&Be((function(e){e.side=s.DoubleSide})),Be((function(e){e.needsUpdate=!0})),j.material.needsUpdate=!0,I.material.needsUpdate=!0,N.material.needsUpdate=!0,O.material.needsUpdate=!0,k.material.needsUpdate=!0,U.setMaterialNeedsUpdate(),F.material.needsUpdate=!0,R.material.needsUpdate=!0,V.material.needsUpdate=!0,this.setSize(q,Y)},this.setClearColors=function(e,t){(ye=t?e.equals(t)||be?new s.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):void 0:e.clone())||(R.uniforms.color1.value.copy(e),R.uniforms.color2.value.copy(t))},this.setClearAlpha=function(e){_e=e},this.setAOEnabled=function(e){Ie.sao=e&&Te,je.sao=Ie.sao,this.setSize(q,Y,!1,!0)},this.setAOOptions=function(e,t,n){void 0!==e&&(j.uniforms.radius.value=e,j.uniforms.bias.value=Object(o.isMobileDevice)()?.1:.01,I.uniforms.radius.value=e),void 0!==t&&(j.uniforms.intensity.value=t),F.uniforms.aoOpacity.value=void 0!==n?n:1,B=!1},this.getAOEnabled=function(){return Ie.sao},this.getAORadius=function(){return j.uniforms.radius.value},this.getAOIntensity=function(){return j.uniforms.intensity.value},this.setCubeMap=function(e){R.material.envMap=e,e||this.toggleEnvMapBackground(!1),e&&Ie.envMapBg&&(R.uniforms.envMapBackground.value=!0)},this.getCubeMap=function(){return R.material.envMap},this.setEnvRotation=function(e){se=e,R.material.envRotationSin=Math.sin(e),R.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return se},this.setEnvExposure=function(e){R.uniforms.envMapExposure.value=Math.pow(2,e),R.material.envMapExposure=Math.pow(2,e),R.material.needsUpdate=!0,ie=e},this.setTonemapExposureBias=function(e){oe=e,R.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return oe},this.setCamera=function(e){P=e},this.setTonemapMethod=function(t){ae=t,e.gammaInput=0!==t,R.material.tonemapOutput=ae,R.material.needsUpdate=!0},this.getToneMapMethod=function(){return ae},this.toggleTwoSided=function(e){Ie.haveTwoSided!=e&&t&&Be((function(t){t.side=e?s.DoubleSide:s.FrontSide,t.needsUpdate=!0})),Ie.haveTwoSided=e},this.toggleEdges=function(e){Ie.renderEdges=e,je.renderEdges=e},this.getRenderEdges=function(){return Ie.renderEdges},this.getRenderEdges=function(){return Ie.renderEdges},this.toggleEnvMapBackground=function(e){Ie.envMapBg=e,R.uniforms.envMapBackground.value=e&&!!R.material.envMap},this.enter2DMode=function(e,t,n){C=e,je.sao=Ie.sao,je.postProcShaded=Ie.postProcShaded,je.antialias=Ie.antialias,je.idbuffer=Ie.idbuffer,je.renderEdges=Ie.renderEdges,n&&(je.selectionColor=Ie.selectionColor,this.setSelectionColor(n)),Ie.idbuffer=!!t,Ie.postProcShaded=!1,Ie.renderEdges=!1,F.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){C=null,Ie.idbuffer=je.idbuffer,Ie.postProcShaded=je.postProcShaded,Ie.renderEdges=je.renderEdges,je.selectionColor&&this.setSelectionColor(je.selectionColor),delete F.material.defines.IS_2D,this.initPostPipeline(je.sao,je.antialias)},this.idAtPixel=function(t,n,r){if(!re[0])return 0;var i=0|.5*(t+1)*re[0].width,o=0|.5*(n+1)*re[0].height;if(K&&i===z&&o===G)return r&&(r[0]=H,r[1]=W),H;e.readRenderTargetPixels(re[0],i,o,1,1,de);var s=de[2]<<16|de[1]<<8|de[0],a=0;return re[1]?(e.readRenderTargetPixels(re[1],i,o,1,1,de),a=(a=de[1]<<8|de[0])<<16>>16,s=s<<8>>8):s=s<<8>>8,z=i,G=o,H=s,W=a,K=!0,r&&(r[0]=s,r[1]=a),s},this.idAtPixels=function(t,n,r,i){if(!re[0])return 0;var o=.5*(t+1)*re[0].width-.5*(r-1),s=.5*(n+1)*re[0].height-.5*(r-1),a=new Uint8Array(4*r*r);e.readRenderTargetPixels(re[0],o,s,r,r,a);var l=void 0;return i&&re[1]&&(l=new Uint8Array(4*r*r),e.readRenderTargetPixels(re[1],o,s,r,r,l)),function(){for(var e,t=0,n=0,o=0,s=-1,c=0;c<r*r;c++){var u=t+(r-1)/2,d=n+(r-1)/2;if(u>=0&&u<=r&&d>=0&&d<=r){var h=u+d*r;if((e=(e=a[4*h+2]<<16|a[4*h+1]<<8|a[4*h])<<8>>8)>=0){if(l){var f=l[4*h+1]<<8|l[4*h];f=f<<16>>16,i[0]=e,i[1]=f}break}}if(t==n||t<0&&t==-n||t>0&&t==1-n){var p=o;o=-s,s=p}t+=o,n+=s}return e}()},this.readbackTargetId=function(){if(!re[0])return null;var t=new Uint8Array(4*re[0].width*re[0].height);return e.readRenderTargetPixels(re[0],0,0,re[0].width,re[0].height,t),{buffer:t,width:re[0].width,height:re[0].height}},this.rolloverObjectViewport=function(e,t){he[1]=0;var n=this.idAtPixel(e,t,he);return this.rolloverObjectId(n,null,he[1])},this.rolloverObjectId=function(e,t,n){return n=n||0,(e!==Pe||n!==Le)&&(F.uniforms.highlightIntensity.value=0,Ce=performance.now(),Pe=e,Le=n,-1===e&&(e=0),void 0===n&&(n=1),F.uniforms.objIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),F.uniforms.modelIDv2.value.set((255&n)/255,(n>>8&255)/255),!0)},this.setDbIdForEdgeDetection=function(e,t){F.uniforms.edgeObjIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),F.uniforms.edgeModelIDv2.value.set((255&t)/255,(t>>8&255)/255)},this.setSpatialFilterForRollOver=function(e){if(!e||this.spatialFilterForRollOverSupported()){F.material.defines.SPATIAL_FILTER!==e&&(e&&""!==e?F.material.defines.SPATIAL_FILTER=e:delete F.material.defines.SPATIAL_FILTER,F.material.needsUpdate=!0,F.uniforms.highlightIntensity.value=0,Ce=performance.now())}else r.logger.warn("Spatial filter for mouse-over can only be used with depth target")},this.spatialFilterForRollOverSupported=function(){return ze(x)},this.setEdgeColor=function(e){me.copy(e)},this.setSelectionColor=function(e){var t=new s.Color(e);t.r=Math.pow(t.r,2),t.g=Math.pow(t.g,2),t.b=Math.pow(t.b,2),F.uniforms.selectionColor.value.set(t),F.material.needsUpdate=!0,Ie.selectionColor=e},this.setUnitScale=function(e){le=e},this.getUnitScale=function(){return le},this.getBlendPass=function(){return F},this.getClearPass=function(){return R},this.getColorTarget=function(){return Z},this.getIDTargets=function(){return re},this.getDepthTarget=function(){return X},this.getIdTarget=function(){return re[0]},this.getDepthMaterial=function(){return t},this.getPostTarget=function(){return $},this.getEdgeMaterial=function(){return n},this.setCrossFade=function(e){Oe=e},this.getCrossFade=function(){return Oe},this.setOffscreenTarget=function(e){Ne=e},this.getNamedTarget=function(e){switch(e){case"color":return Z;case"overlay":return J;case"id":return re[0];case"post1":return $;case"post2":return ne;case"postdisplay":return ee;case"ssao":return te;case"depth":return X}return null},this.getCurrentFramebuffer=function(){return e.getCurrentFramebuffer()},this.getConfig=function(){return{renderEdges:Ie.renderEdges,envMapBackground:Ie.envMapBg,envMap:R.material.envMap,envExposure:ie,toneMapExposureBias:oe,envRotation:this.getEnvRotation(),tonemapMethod:ae,clearColor:ye&&ye.clone(),clearColorTop:!ye&&R.uniforms.color1.value.clone(),clearColorBottom:!ye&&R.uniforms.color2.value.clone(),clearAlpha:_e,aoEnabled:this.getAOEnabled(),aoRadius:this.getAORadius(),aoIntensity:this.getAOIntensity(),twoSided:Ie.haveTwoSided,edgeColor:me.clone(),unitScale:this.getUnitScale(),is2D:!!F.material.defines.IS_2D,antialias:this.getAntialiasing()}},this.applyConfig=function(e){this.toggleEdges(e.renderEdges),this.toggleEnvMapBackground(e.envMapBackground),this.setCubeMap(e.envMap),this.setEnvExposure(e.envExposure),this.setTonemapExposureBias(e.toneMapExposureBias),this.setEnvRotation(e.envRotation),this.setTonemapMethod(e.tonemapMethod),this.toggleTwoSided(e.twoSided),this.setEdgeColor(e.edgeColor),this.setUnitScale(e.unitScale),e.clearColor?this.setClearColors(e.clearColor):this.setClearColors(e.clearColorTop,e.clearColorBottom),this.setClearAlpha(e.clearAlpha);var t=!!F.material.defines.IS_2D;e.is2D&&!t?this.enter2DMode():!e.is2D&&t&&this.exit2DMode();var n=e.aoEnabled!=this.getAOEnabled(),r=e.antialias!=this.getAntialiasing();(n||r)&&this.initPostPipeline(e.aoEnabled,e.antialias)},this.targetToCanvas=function(t){var n=t.width,r=t.height,i=new Uint8Array(n*r*4);e.readRenderTargetPixels(t,0,0,n,r,i);var s=_.createElement("canvas");s.width=n,s.height=r;var a,l=s.getContext("2d"),c=new Uint8ClampedArray(i);return o.isIE11?(a=l.createImageData(n,r)).data.set(c):a=new ImageData(c,n,r),l.putImageData(a,0,0),l.globalCompositeOperation="copy",l.translate(0,r),l.scale(1,-1),l.drawImage(s,0,0,n,r),l.globalCompositeOperation="source-over",{canvas:s,ctx:l}}}},"./src/wgs/render/RenderContextPostProcess.js":
/*!****************************************************!*\
  !*** ./src/wgs/render/RenderContextPostProcess.js ***!
  \****************************************************/
/*! exports provided: RenderContextPostProcessExtension, RenderContextPostProcessManager */function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}n.r(t),n.d(t,"RenderContextPostProcessExtension",(function(){return u})),n.d(t,"RenderContextPostProcessManager",(function(){return d}));var u=function(){function e(t){a(this,e),this.renderContext=t}return c(e,[{key:"load",value:function(){}},{key:"unload",value:function(){this.renderContext=void 0}},{key:"render",value:function(e,t,n){}},{key:"updateUniformValue",value:function(e,t,n){}},{key:"changeResolution",value:function(e,t){}},{key:"setMaterialNeedsUpdate",value:function(){}},{key:"postProcessEdgesOn",value:function(){}},{key:"getRenderOptionClass",value:function(){}}]),e}(),d=function(e){function t(){return a(this,t),i(this,o(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,e),c(t,[{key:"registerPostProcessingExtension",value:function(e){this.extension=e}},{key:"removePostProcessingExtension",value:function(){this.extension&&(this.extension.unload(),this.extension=void 0)}},{key:"getRenderOptionClass",value:function(){if(this.extension)return this.extension.getRenderOptionClass()}},{key:"preloadPostProcessStyle",value:function(e){this.extension&&this.extension.preloadPostProcessStyle(e)}},{key:"setPostProcessParameter",value:function(e,t){this.extension&&this.extension.setPostProcessParameter(e,t)}},{key:"render",value:function(e,t,n){this.extension&&this.extension.render(e,t,n)}},{key:"updateUniformValue",value:function(e,t,n){this.extension&&this.extension.updateUniformValue(e,t,n)}},{key:"changeResolution",value:function(e,t){this.extension&&this.extension.changeResolution(e,t)}},{key:"setMaterialNeedsUpdate",value:function(){this.extension&&this.extension.setMaterialNeedsUpdate()}},{key:"postProcessEdgesOn",value:function(){if(this.extension)return this.extension.postProcessEdgesOn()}}]),t}(u)},"./src/wgs/render/SAOBlurShader.js":
/*!*****************************************!*\
  !*** ./src/wgs/render/SAOBlurShader.js ***!
  \*****************************************/
/*! exports provided: SAOBlurShader */function(e,t,n){"use strict";n.r(t),n.d(t,"SAOBlurShader",(function(){return l}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/sao_blur_frag.glsl */"./src/wgs/render/shaders/sao_blur_frag.glsl"),a=n.n(s),l={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new r.Vector2(512,512)},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)},axis:{type:"v2",value:new r.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:o.a,fragmentShader:a.a}},"./src/wgs/render/SAOMinifyShader.js":
/*!*******************************************!*\
  !*** ./src/wgs/render/SAOMinifyShader.js ***!
  \*******************************************/
/*! exports provided: SAOMinifyFirstShader, SAOMinifyShader */function(e,t,n){"use strict";n.r(t),n.d(t,"SAOMinifyFirstShader",(function(){return u})),n.d(t,"SAOMinifyShader",(function(){return d}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./shaders/screen_quad_vert.glsl */"./src/wgs/render/shaders/screen_quad_vert.glsl"),o=n.n(i),s=n(/*! ./shaders/sao_minfirst_frag.glsl */"./src/wgs/render/shaders/sao_minfirst_frag.glsl"),a=n.n(s),l=n(/*! ./shaders/sao_min_frag.glsl */"./src/wgs/render/shaders/sao_min_frag.glsl"),c=n.n(l),u={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)}},vertexShader:o.a,fragmentShader:a.a},d={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)}},vertexShader:o.a,fragmentShader:c.a}},"./src/wgs/render/SAOShader.js":
/*!*************************************!*\
  !*** ./src/wgs/render/SAOShader.js ***!
  \*************************************/
/*! exports provided: SAOShader */function(e,t,n){"use strict";n.r(t),n.d(t,"SAOShader",(function(){return c}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),o=n(/*! ./shaders/screen_quad_uv_vert.glsl */"./src/wgs/render/shaders/screen_quad_uv_vert.glsl"),s=n.n(o),a=n(/*! ./shaders/sao_frag.glsl */"./src/wgs/render/shaders/sao_frag.glsl"),l=n.n(a),c={uniforms:r.UniformsUtils.merge([i.ShaderChunks.DepthTextureUniforms,{size:{type:"v2",value:new r.Vector2(512,512)},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:12},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:s.a,fragmentShader:l.a}},"./src/wgs/render/ShaderChunks.js":
/*!****************************************!*\
  !*** ./src/wgs/render/ShaderChunks.js ***!
  \****************************************/
/*! exports provided: CutPlanesUniforms, IdUniforms, ThemingUniform, ShadowMapCommonUniforms, ShadowMapUniforms, PointSizeUniforms, WideLinesUniforms, DepthTextureUniforms, GetPrismMapSampleChunk, GetPrismMapUniformChunk, resolve, PackDepthShaderChunk, TonemapShaderChunk, OrderedDitheringShaderChunk, CutPlanesShaderChunk, PackNormalsShaderChunk, HatchPatternShaderChunk, EnvSamplingShaderChunk, IdVertexDeclaration, IdVertexShaderChunk, IdFragmentDeclaration, IdOutputShaderChunk, FinalOutputShaderChunk, ThemingFragmentDeclaration, ThemingFragmentShaderChunk, InstancingVertexDeclaration, ShadowMapDeclareCommonUniforms, ShadowMapVertexDeclaration, ShadowMapVertexShaderChunk, ShadowMapFragmentDeclaration, PointSizeDeclaration, PointSizeShaderChunk, ShaderChunks */function(e,t,n){"use strict";n.r(t),n.d(t,"CutPlanesUniforms",(function(){return he})),n.d(t,"IdUniforms",(function(){return fe})),n.d(t,"ThemingUniform",(function(){return pe})),n.d(t,"ShadowMapCommonUniforms",(function(){return me})),n.d(t,"ShadowMapUniforms",(function(){return ge})),n.d(t,"PointSizeUniforms",(function(){return ve})),n.d(t,"WideLinesUniforms",(function(){return ye})),n.d(t,"DepthTextureUniforms",(function(){return _e})),n.d(t,"GetPrismMapSampleChunk",(function(){return Ee})),n.d(t,"GetPrismMapUniformChunk",(function(){return Ae})),n.d(t,"resolve",(function(){return Se})),n.d(t,"PackDepthShaderChunk",(function(){return Te})),n.d(t,"TonemapShaderChunk",(function(){return Ce})),n.d(t,"OrderedDitheringShaderChunk",(function(){return Pe})),n.d(t,"CutPlanesShaderChunk",(function(){return Le})),n.d(t,"PackNormalsShaderChunk",(function(){return De})),n.d(t,"HatchPatternShaderChunk",(function(){return Re})),n.d(t,"EnvSamplingShaderChunk",(function(){return Ie})),n.d(t,"IdVertexDeclaration",(function(){return je})),n.d(t,"IdVertexShaderChunk",(function(){return Oe})),n.d(t,"IdFragmentDeclaration",(function(){return Ne})),n.d(t,"IdOutputShaderChunk",(function(){return ke})),n.d(t,"FinalOutputShaderChunk",(function(){return Fe})),n.d(t,"ThemingFragmentDeclaration",(function(){return Ve})),n.d(t,"ThemingFragmentShaderChunk",(function(){return Be})),n.d(t,"InstancingVertexDeclaration",(function(){return Ue})),n.d(t,"ShadowMapDeclareCommonUniforms",(function(){return ze})),n.d(t,"ShadowMapVertexDeclaration",(function(){return Ge})),n.d(t,"ShadowMapVertexShaderChunk",(function(){return He})),n.d(t,"ShadowMapFragmentDeclaration",(function(){return We})),n.d(t,"PointSizeDeclaration",(function(){return Xe})),n.d(t,"PointSizeShaderChunk",(function(){return qe})),n.d(t,"ShaderChunks",(function(){return Ye}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./chunks/pack_depth.glsl */"./src/wgs/render/chunks/pack_depth.glsl"),o=n.n(i),s=n(/*! ./chunks/depth_texture.glsl */"./src/wgs/render/chunks/depth_texture.glsl"),a=n.n(s),l=n(/*! ./chunks/tonemap.glsl */"./src/wgs/render/chunks/tonemap.glsl"),c=n.n(l),u=n(/*! ./chunks/ordered_dither.glsl */"./src/wgs/render/chunks/ordered_dither.glsl"),d=n.n(u),h=n(/*! ./chunks/cutplanes.glsl */"./src/wgs/render/chunks/cutplanes.glsl"),f=n.n(h),p=n(/*! ./chunks/pack_normals.glsl */"./src/wgs/render/chunks/pack_normals.glsl"),m=n.n(p),g=n(/*! ./chunks/hatch_pattern.glsl */"./src/wgs/render/chunks/hatch_pattern.glsl"),v=n.n(g),y=n(/*! ./chunks/env_sample.glsl */"./src/wgs/render/chunks/env_sample.glsl"),_=n.n(y),b=n(/*! ./chunks/id_decl_vert.glsl */"./src/wgs/render/chunks/id_decl_vert.glsl"),x=n.n(b),w=n(/*! ./chunks/id_vert.glsl */"./src/wgs/render/chunks/id_vert.glsl"),E=n.n(w),A=n(/*! ./chunks/id_decl_frag.glsl */"./src/wgs/render/chunks/id_decl_frag.glsl"),M=n.n(A),S=n(/*! ./chunks/id_frag.glsl */"./src/wgs/render/chunks/id_frag.glsl"),T=n.n(S),C=n(/*! ./chunks/final_frag.glsl */"./src/wgs/render/chunks/final_frag.glsl"),P=n.n(C),L=n(/*! ./chunks/theming_decl_frag.glsl */"./src/wgs/render/chunks/theming_decl_frag.glsl"),D=n.n(L),R=n(/*! ./chunks/theming_frag.glsl */"./src/wgs/render/chunks/theming_frag.glsl"),I=n.n(R),j=n(/*! ./chunks/instancing_decl_vert.glsl */"./src/wgs/render/chunks/instancing_decl_vert.glsl"),O=n.n(j),N=n(/*! ./chunks/shadowmap_decl_common.glsl */"./src/wgs/render/chunks/shadowmap_decl_common.glsl"),k=n.n(N),F=n(/*! ./chunks/shadowmap_decl_vert.glsl */"./src/wgs/render/chunks/shadowmap_decl_vert.glsl"),V=n.n(F),B=n(/*! ./chunks/shadowmap_vert.glsl */"./src/wgs/render/chunks/shadowmap_vert.glsl"),U=n.n(B),z=n(/*! ./chunks/shadowmap_decl_frag.glsl */"./src/wgs/render/chunks/shadowmap_decl_frag.glsl"),G=n.n(z),H=n(/*! ./chunks/float3_average.glsl */"./src/wgs/render/chunks/float3_average.glsl"),W=n.n(H),X=n(/*! ./chunks/line_decl_common.glsl */"./src/wgs/render/chunks/line_decl_common.glsl"),q=n.n(X),Y=n(/*! ./chunks/prism_wood.glsl */"./src/wgs/render/chunks/prism_wood.glsl"),K=n.n(Y),Q=n(/*! ./chunks/prism_glazing.glsl */"./src/wgs/render/chunks/prism_glazing.glsl"),Z=n.n(Q),J=n(/*! ./chunks/prism_transparency.glsl */"./src/wgs/render/chunks/prism_transparency.glsl"),$=n.n(J),ee=n(/*! ./chunks/normal_map.glsl */"./src/wgs/render/chunks/normal_map.glsl"),te=n.n(ee),ne=n(/*! ./chunks/decl_point_size.glsl */"./src/wgs/render/chunks/decl_point_size.glsl"),re=n.n(ne),ie=n(/*! ./chunks/point_size.glsl */"./src/wgs/render/chunks/point_size.glsl"),oe=n.n(ie),se=n(/*! ./chunks/wide_lines_decl.glsl */"./src/wgs/render/chunks/wide_lines_decl.glsl"),ae=n.n(se),le=n(/*! ./chunks/wide_lines_vert.glsl */"./src/wgs/render/chunks/wide_lines_vert.glsl"),ce=n.n(le),ue=n(/*! ./chunks/hsv.glsl */"./src/wgs/render/chunks/hsv.glsl"),de=n.n(ue),he={cutplanes:{type:"v4v",value:[]},hatchParams:{type:"v2",value:new r.Vector2(1,10)},hatchTintColor:{type:"c",value:new r.Color(16777215)},hatchTintIntensity:{type:"f",value:1}},fe={dbId:{type:"v3",value:new r.Vector3(0,0,0)},modelId:{type:"v3",value:new r.Vector3(0,0,0)}},pe={themingColor:{type:"v4",value:new r.Vector4(0,0,0,0)}},me={shadowESMConstant:{type:"f",value:0}},ge=r.UniformsUtils.merge([{shadowMap:{type:"t",value:null},shadowMapSize:{type:"v2",value:new r.Vector2(0,0)},shadowBias:{type:"f",value:0},shadowDarkness:{type:"f",value:0},shadowMatrix:{type:"m4",value:new r.Matrix4},shadowLightDir:{type:"v3",value:new r.Vector3}},me]),ve={point_size:{type:"f",value:1}},ye={view_size:{type:"v2",value:new r.Vector2(640,480)}},_e={tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new r.Vector4},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new r.Matrix4}},be={};for(var xe in r.ShaderChunk)be[xe]=r.ShaderChunk[xe];be.pack_depth=o.a,be.depth_texture=a.a,be.tonemap=c.a,be.ordered_dither=d.a,be.cutplanes=f.a,be.pack_normals=m.a,be.hatch_pattern=v.a,be.env_sample=_.a,be.id_decl_vert=x.a,be.id_vert=E.a,be.id_decl_frag=M.a,be.id_frag=T.a,be.final_frag=P.a,be.theming_decl_frag=D.a,be.theming_frag=I.a,be.instancing_decl_vert=O.a,be.shadowmap_decl_common=k.a,be.shadowmap_decl_vert=V.a,be.shadowmap_vert=U.a,be.shadowmap_decl_frag=G.a,be.float3_average=W.a,be.line_decl_common=q.a,be.prism_wood=K.a,be.prism_glazing=Z.a,be.prism_transparency=$.a,be.normal_map=te.a,be.decl_point_size=re.a,be.point_size=oe.a,be.wide_lines_decl=ae.a,be.wide_lines_vert=ce.a,be.hsv=de.a;var we={};function Ee(e,t,n,r){var i=n?"_v3":"",o=n?"vec3 ":"",s=n?t+" = average("+t+i+");":"",a=r?t+i+" = SRGBToLinear("+t+i+");":"";return["#if defined( USE_"+e.toUpperCase()+"_MAP )","vec2 uv_"+e+"_map = ("+e+"_map_texMatrix * vec3(uv, 1.0)).xy;",e.toUpperCase()+"_CLAMP_TEST;",o+t+i+" = texture2D("+e+"_map, uv_"+e+"_map).xyz;",a,"if("+e+"_map_invert) "+t+i+" = vec3(1.0) - "+t+i+";",s,"#else",t+" = "+e+";","#endif"].join("\n")}function Ae(e){var t=e+"_texMatrix",n=e+"_invert";return["#if defined( "+("USE_"+e).toUpperCase()+" )","uniform sampler2D "+e+";","uniform mat3 "+t+";","uniform bool "+n+";","#endif"].join("\n")}we.prism_check=function(e){return["#if defined( USE_SURFACE_ALBEDO_MAP ) || defined( USE_SURFACE_ROUGHNESS_MAP ) || defined( USE_SURFACE_CUTOUT_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_OPAQUE_ALBEDO_MAP ) || defined( USE_OPAQUE_F0_MAP ) || defined( USE_OPAQUE_LUMINANCE_MODIFIER_MAP ) || defined( USE_LAYERED_BOTTOM_F0_MAP ) || defined( USE_LAYERED_F0_MAP ) || defined( USE_LAYERED_DIFFUSE_MAP ) || defined( USE_LAYERED_FRACTION_MAP ) || defined( USE_LAYERED_ROUGHNESS_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_METAL_F0_MAP ) || defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP )","#define "+e,"#endif"].join("\n")},we.prism_sample_texture=function(e,t,n,r){return Ee(e,t,"true"===n,"true"===r)},we.prism_uniforms=Ae,we.prism_bump_uniforms=function(e){var t=e+"_texMatrix",n=e+"_bumpScale",r=e+"_bumpmapType";return["#if defined( "+("USE_"+e).toUpperCase()+" )","uniform sampler2D "+e+";","uniform mat3 "+t+";","uniform vec2 "+n+";","uniform int "+r+";","#endif"].join("\n")};var Me={};for(xe in we)Me[xe]=new RegExp("#"+xe+" *<([\\w\\d., ]*)>","g");var Se=function e(t){for(var n in we){var r=Me[n];t=t.replace(r,(function(e,t){var r=t.split(",").map((function(e){return e.trim()}));return we[n].apply(null,r)}))}return t.replace(/#include *<([\w\d.]+)>/g,(function(t,n){if(!be[n])throw new Error("Cannot resolve #include<"+n+">");return e(be[n])}))},Te=be.pack_depth,Ce=be.tonemap,Pe=be.ordered_dither,Le=be.cutplanes,De=be.pack_normals,Re=be.hatch_pattern,Ie=be.env_sample,je=be.id_decl_vert,Oe=be.id_vert,Ne=be.id_decl_frag,ke=be.id_frag,Fe=be.final_frag,Ve=be.theming_decl_frag,Be=be.theming_frag,Ue=be.instancing_decl_vert,ze=be.shadowmap_decl_common,Ge=be.shadowmap_decl_vert,He=be.shadowmap_vert,We=be.shadowmap_decl_frag,Xe=be.decl_point_size,qe=be.point_size,Ye={IdUniforms:fe,ThemingUniform:pe,CutPlanesUniforms:he,ShadowMapCommonUniforms:me,ShadowMapUniforms:ge,PointSizeUniforms:ve,WideLinesUniforms:ye,DepthTextureUniforms:_e,PackDepthShaderChunk:Te,TonemapShaderChunk:Ce,OrderedDitheringShaderChunk:Pe,CutPlanesShaderChunk:Le,PackNormalsShaderChunk:De,HatchPatternShaderChunk:Re,EnvSamplingShaderChunk:Ie,IdVertexDeclaration:je,IdVertexShaderChunk:Oe,IdFragmentDeclaration:Ne,IdOutputShaderChunk:ke,FinalOutputShaderChunk:Fe,ThemingFragmentDeclaration:Ve,ThemingFragmentShaderChunk:Be,InstancingVertexDeclaration:Ue,ShadowMapDeclareCommonUniforms:ze,ShadowMapVertexDeclaration:Ge,ShadowMapVertexShaderChunk:He,ShadowMapFragmentDeclaration:We,PointSizeDeclaration:Xe,PointSizeShaderChunk:qe,GetPrismMapSampleChunk:Ee,GetPrismMapUniformChunk:Ae,resolve:Se}},"./src/wgs/render/ShaderPass.js":
/*!**************************************!*\
  !*** ./src/wgs/render/ShaderPass.js ***!
  \**************************************/
/*! exports provided: ShaderPass */function(e,t,n){"use strict";n.r(t),n.d(t,"ShaderPass",(function(){return o}));var r=n(/*! ./ShaderUtils */"./src/wgs/render/ShaderUtils.js"),i=n(/*! three */"./thirdparty/three.js/three.js"),o=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.material=Object(r.createShaderMaterial)(e),this.uniforms=this.material.uniforms,this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new i.OrthographicCamera(-1,1,1,-1,0,1);var n=new i.BufferGeometry,o=new Float32Array(9);o[0]=-1,o[1]=-1,o[2]=0,o[3]=3,o[4]=-1,o[5]=0,o[6]=-1,o[7]=3,o[8]=0;var s=new Float32Array(6);s[0]=0,s[1]=0,s[2]=2,s[3]=0,s[4]=0,s[5]=2;var a=new Float32Array(9);a[0]=0,a[1]=0,a[2]=1,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=1,n.addAttribute("position",new i.BufferAttribute(o,3)),n.addAttribute("normal",new i.BufferAttribute(a,3)),n.addAttribute("uv",new i.BufferAttribute(s,2)),this.quad=new i.Mesh(n,this.material),this.scene=new i.Scene,this.scene.add(this.quad)};o.prototype={render:function(e,t,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture||n),this.renderToScreen||!t?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}}},"./src/wgs/render/ShaderUtils.js":
/*!***************************************!*\
  !*** ./src/wgs/render/ShaderUtils.js ***!
  \***************************************/
/*! exports provided: createShaderMaterial, setMacro, removeMacro */function(e,t,n){"use strict";n.r(t),n.d(t,"createShaderMaterial",(function(){return i})),n.d(t,"setMacro",(function(){return o})),n.d(t,"removeMacro",(function(){return s}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=function(e){var t={vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return e.uniforms&&(t.uniforms=r.UniformsUtils.clone(e.uniforms)),e.defines&&(t.defines=Object.assign({},e.defines)),e.extensions&&(t.extensions=Object.assign({},e.extensions)),e.attributes&&(t.attributes=e.attributes),new r.ShaderMaterial(t)},o=function(e,t,n){n=n||"",e.defines||(e.defines={}),e.defines[t]!=n&&(e.defines[t]=n,e.needsUpdate=!0)},s=function(e,t){(e.defines||e.defines[t])&&(delete e.defines[t],e.needsUpdate=!0)}},"./src/wgs/render/ShadowMap.js":
/*!*************************************!*\
  !*** ./src/wgs/render/ShadowMap.js ***!
  \*************************************/
/*! exports provided: ShadowMapShader, GroundShadowShader, ShadowMapOverrideMaterials, ShadowConfig, SHADOWMAP_NEEDS_UPDATE, SHADOWMAP_INCOMPLETE, SHADOWMAP_VALID, ShadowMaps, ShadowRender */function(e,t,n){"use strict";n.r(t),n.d(t,"ShadowMapShader",(function(){return _})),n.d(t,"GroundShadowShader",(function(){return b})),n.d(t,"ShadowMapOverrideMaterials",(function(){return x})),n.d(t,"ShadowConfig",(function(){return w})),n.d(t,"SHADOWMAP_NEEDS_UPDATE",(function(){return E})),n.d(t,"SHADOWMAP_INCOMPLETE",(function(){return A})),n.d(t,"SHADOWMAP_VALID",(function(){return M})),n.d(t,"ShadowMaps",(function(){return C})),n.d(t,"ShadowRender",(function(){return P}));var r=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),i=n(/*! ./ShaderUtils */"./src/wgs/render/ShaderUtils.js"),o=n(/*! ./PrismShader */"./src/wgs/render/PrismShader.js"),s=n(/*! ./WebGLProgram */"./src/wgs/render/WebGLProgram.js"),a=n(/*! ./GroundShadow */"./src/wgs/render/GroundShadow.js"),l=n(/*! ./GaussianPass */"./src/wgs/render/GaussianPass.js"),c=n(/*! ../scene/RenderFlags */"./src/wgs/scene/RenderFlags.js"),u=n(/*! three */"./thirdparty/three.js/three.js"),d=n(/*! ./shaders/shadowmap_vert.glsl */"./src/wgs/render/shaders/shadowmap_vert.glsl"),h=n.n(d),f=n(/*! ./shaders/shadowmap_frag.glsl */"./src/wgs/render/shaders/shadowmap_frag.glsl"),p=n.n(f),m=n(/*! ./shaders/shadowmap_ground_vert.glsl */"./src/wgs/render/shaders/shadowmap_ground_vert.glsl"),g=n.n(m),v=n(/*! ./shaders/shadowmap_ground_frag.glsl */"./src/wgs/render/shaders/shadowmap_ground_frag.glsl"),y=n.n(v),_={uniforms:u.UniformsUtils.merge([r.ShaderChunks.ShadowMapCommonUniforms,{shadowMapRangeMin:{type:"f",value:0},shadowMapRangeSize:{type:"f",value:0},shadowMinOpacity:{type:"f",value:0},map:{type:"t",value:null},alphaMap:{type:"t",value:null},texMatrix:{type:"m3",value:new u.Matrix3},texMatrixAlpha:{type:"m3",value:new u.Matrix3}},Object(o.GetPrismMapUniforms)("surface_cutout_map")]),vertexShader:h.a,fragmentShader:p.a},b={uniforms:r.ShaderChunks.ShadowMapUniforms,vertexShader:g.a,fragmentShader:y.a};function x(){var e=[],t=Object(i.createShaderMaterial)(_),n=new u.Material;n.visible=!1;var r=[];var o=new function(){this.init=function(){this.isPrism=!1,this.alphaMap=!1,this.alphaClampS=!1,this.alphaClampT=!1,this.alphaInvert=!1,this.rgbaMap=!1,this.rgbaClampS=!1,this.rgbaClampT=!1,this.rgbaInvert=!1,this.instanced=!1,this.decalIndex=-1},this.init(),this.getMaterialIndex=function(){return(this.isPrism?1:0)|(this.alphaMap?2:0)|(this.alphaClampS?4:0)|(this.alphaClampT?8:0)|(this.alphaInvert?16:0)|(this.rgbaMap?32:0)|(this.rgbaClampS?64:0)|(this.rgbaClampT?128:0)|(this.rgbaInvert?256:0)|(this.instanced?512:0)|1024*(this.decalIndex+1)}};function a(r,a){if((l=r)instanceof u.MeshPhongMaterial?l.opacity<w.ShadowMinOpacity:l.isPrismMaterial?"PrismTransparent"===l.prismType||"PrismGlazing"===l.prismType:!l.visible)return n;var l,c=r instanceof u.MeshPhongMaterial,d=r.isPrismMaterial;if(!c&&!d)return null;var h=c?r.alphaMap:r.surface_cutout_map,f=c&&r.alphaTest?r.map:null;if(!h&&!f&&!r.useInstancing)return null;var p=o;p.init(),p.isPrism=d,p.alphaMap=!!h,p.rgbaMap=!!f,p.instanced=r.useInstancing,p.decalIndex=void 0===a?-1:a,h&&(p.alphaClampS=h.clampS,p.alphaClampT=h.clampT,p.alphaInvert=h.invert),f&&(p.rgbaClampS=f.clampS,p.rgbaClampT=f.clampT,p.rgbaInvert=f.invert);var m=function(n,r){var o=n.getMaterialIndex();if(!e[o]){var a=t.clone();n.isPrism&&n.alphaMap&&(Object(i.setMacro)(a,"USE_SURFACE_CUTOUT_MAP"),a.fragmentShader=Object(s.GetPrismMapChunk)("surface_cutout",n.alphaClampS,n.alphaClampT)+"\n"+a.fragmentShader),n.instanced&&(a.useInstancing=!0),e[o]=a}return e[o]}(p);return h&&(c?(m.uniforms.alphaMap.value=h,m.uniforms.texMatrixAlpha.value=h.matrix,m.alphaMap=h,m.side=r.side):(m.uniforms.surface_cutout_map.value=h,m.uniforms.surface_cutout_map_texMatrix.value.copy(h.matrix),m.uniforms.surface_cutout_map_invert.value=h.invert,m.side=u.DoubleSide)),f&&(m.uniforms.map.value=f,m.uniforms.texMatrix.value=f.matrix,m.map=f),m}this.forEachMaterial=function(n){for(var r=0;r<e.length;r++){var i=e[r];i&&n(i)}n(t)},this.getCustomOverrideMaterial=function(e){var t=a(e);if(!t)return null;if(!e.decals)return t.decals=null,t;if(e.decals){r.length=0;for(var n=0;n<e.decals.length;n++){var i=e.decals[n],o=a(i.material,n);if(!o)return null;r.push({uv:i.uv,material:o})}}return t.decals=r,t},this.dispose=function(){this.forEachMaterial((function(e){e.dispose()}))}}var w={ShadowMapSize:1024,ShadowESMConstant:80,ShadowBias:.001,ShadowDarkness:.7,ShadowMapBlurRadius:4,ShadowMinOpacity:.9,UseHardShadows:!1,BlurShadowMap:!0},E=0,A=1,M=2;function S(){this.shadowMap=void 0,this.shadowMapSize=void 0,this.shadowMatrix=void 0,this.shadowLightDir=void 0,this.init=function(e){this.shadowMap=e,this.shadowMapSize=new u.Vector2(e.width,e.height),this.shadowMatrix=new u.Matrix4,this.shadowLightDir=new u.Vector3},this.apply=function(e){e.shadowMap=this.shadowMap,e.shadowMatrix=this.shadowMatrix,e.shadowLightDir=this.shadowLightDir,this.shadowMap?(Object(i.setMacro)(e,"USE_SHADOWMAP"),w.UseHardShadows&&Object(i.setMacro)(e,"USE_HARD_SHADOWS")):(Object(i.removeMacro)(e,"USE_SHADOWMAP"),Object(i.removeMacro)(e,"USE_HARD_SHADOWS"))}}var T=new S;function C(e){var t=null,n=null,r=new u.OrthographicCamera,o=Math.exp(w.ShadowESMConstant),s=w.UseHardShadows?new u.Color(1,1,1):new u.Color(o,1,1),d=e,h=null,f=null,p=null,m=Object(i.createShaderMaterial)(_),g=new x;m.getCustomOverrideMaterial=g.getCustomOverrideMaterial;var v=null;function y(e,t){e.forEach((function(e){t.apply(e)}))}function C(e){var t=new u.WebGLRenderTarget(e,e,{minFilter:u.LinearFilter,magFilter:u.LinearFilter,format:u.RGBAFormat,type:u.FloatType,stencilBuffer:!1,generateMipmaps:!1});return t.generateMipmaps=!1,t}function P(e){d.setRenderTarget(e),d.setClearColor(s,1),d.clear()}var L,D,R,I,j,O,N,k,F,V,B,U=(L=new u.Matrix4,D=new u.Matrix4,R=new u.Vector3(0,0,0),I=new u.Box3,j=new u.Vector3,O=new u.Vector3,function(e,t,n){e.position.copy(n),e.lookAt(R),L.makeRotationFromQuaternion(e.quaternion),D.getInverse(L),I.copy(t).applyMatrix4(D),O=I.center(O),j.set(O.x,O.y,I.max.z),j.applyMatrix4(L),e.position.copy(j),O=I.size(O),e.left=-.5*O.x,e.right=.5*O.x,e.bottom=-.5*O.y,e.top=.5*O.y,e.near=0,e.far=O.z,e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),e.updateProjectionMatrix()});function z(e){e.uniforms.shadowMapRangeMin.value=r.near,e.uniforms.shadowMapRangeSize.value=r.far-r.near,e.uniforms.shadowESMConstant.value=w.ShadowESMConstant,e.uniforms.shadowMinOpacity.value=w.ShadowMinOpacity}this.init=function(){(t=new S).init(C(w.ShadowMapSize)),n=w.BlurShadowMap?new l.GaussianPass(w.ShadowMapSize,w.ShadowMapSize,w.ShadowMapBlurRadius,1,{type:t.shadowMap.type,format:t.shadowMap.format}):void 0,(h=Object(i.createShaderMaterial)(b)).depthWrite=!1,h.transparent=!0,f=Object(a.createGroundShape)(h),(p=new u.Scene).add(f),this.groundShapeBox=new u.Box3,P(v=C(1))},this.init(),this.state=E,this.startUpdate=function(e,t,n,i,o){var s=e.getVisibleBounds(!0);return this.beginShadowMapUpdate(n,s,i),e.reset(r,c.RenderFlags.RENDER_SHADOWMAP,!0),this.state=A,t=this.continueUpdate(e,t,o)},this.continueUpdate=function(e,n,r){return n=e.renderSome(this.renderSceneIntoShadowMap,n),e.isDone()?(this.state=M,this.finishShadowMapUpdate(r)):function(e){var n=t.shadowMap;t.shadowMap=v,y(e,t),t.apply(h),t.shadowMap=n}(r),n},this.beginShadowMapUpdate=function(e,n,o){U(r,n,o),z(m),g.forEachMaterial(z),w.UseHardShadows&&(Object(i.setMacro)(m,"USE_HARD_SHADOWS"),g.forEachMaterial((function(e){Object(i.setMacro)(e,"USE_HARD_SHADOWS")}))),P(t.shadowMap),this.renderSceneIntoShadowMap(p)},this.renderSceneIntoShadowMap=function(e){e.overrideMaterial=m,d.render(e,r,t.shadowMap),e.overrideMaterial=null},this.finishShadowMapUpdate=function(e){n&&!w.UseHardShadows&&n.render(d,t.shadowMap,t.shadowMap),t.shadowMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),t.shadowMapRangeMin=r.near,t.shadowMapRangeSize=r.far-r.near,t.shadowLightDir.copy(r.position).normalize(),y(e,t),t.apply(h),this.isValid=!0},this.cleanup=function(e){n&&n.cleanup(),t.shadowMap&&t.shadowMap.dispose(),y(e,T),m.dispose(),g.dispose(),h.dispose(),f.geometry.dispose()},this.setGroundShadowTransform=function(e,t,n,r){Object(a.setGroundShapeTransform)(f,e,t,n,r),this.groundShapeBox.setFromObject(f)},this.renderGroundShadow=function(e,t){d.render(p,e,t,!1)},this.expandByGroundShadow=(N=new u.Plane,k=new u.Ray,F=new u.Vector3,V=new u.Vector3,B=new u.Box3,function(e,t){N.normal.set(0,1,0),N.constant=-e.min.y,k.direction.copy(t).negate().normalize();var n,r,i,o=e.center(F),s=100*o.distanceToSquared(e.min)*100;B.makeEmpty();for(var a=0;a<8;a++){k.origin=(n=e,r=a,i=void 0,(i=new u.Vector3).x=1&r?n.max.x:n.min.x,i.y=2&r?n.max.y:n.min.y,i.z=4&r?n.max.z:n.min.z,i);var l=k.intersectPlane(N,V);l&&(l.distanceToSquared(o)>=s||B.expandByPoint(l))}e.union(B)}),this.getShadowParams=function(){return t},this.getShadowCamera=function(){return r}}var P=function(){};P.RefreshUniformsShadow=function(e,t){e.shadowMap&&(e.shadowMap.value=t.shadowMap),e.shadowMatrix&&(e.shadowMatrix.value=t.shadowMatrix),e.shadowLightDir&&(e.shadowLightDir.value=t.shadowLightDir),e.shadowESMConstant&&(e.shadowESMConstant.value=w.ShadowESMConstant),e.shadowBias&&(e.shadowBias.value=w.ShadowBias),e.shadowMapSize&&(e.shadowMapSize.value=w.ShadowMapSize),e.shadowDarkness&&(e.shadowDarkness.value=w.ShadowDarkness)}},"./src/wgs/render/WebGLProgram.js":
/*!****************************************!*\
  !*** ./src/wgs/render/WebGLProgram.js ***!
  \****************************************/
/*! exports provided: PrismMaps, GetPrismMapChunk, WebGLProgram */function(e,t,n){"use strict";n.r(t),n.d(t,"PrismMaps",(function(){return u})),n.d(t,"GetPrismMapChunk",(function(){return d})),n.d(t,"WebGLProgram",(function(){return h}));var r,i,o,s=n(/*! ./WebGLShader */"./src/wgs/render/WebGLShader.js"),a=n(/*! ./ShaderChunks */"./src/wgs/render/ShaderChunks.js"),l=n(/*! three */"./thirdparty/three.js/three.js"),c=n(/*! ../../compat */"./src/compat.js"),u=["opaque_luminance_modifier","surface_albedo","surface_roughness","surface_anisotropy","surface_rotation","opaque_f0","opaque_albedo","metal_f0","layered_f0","layered_diffuse","layered_roughness","layered_anisotropy","layered_rotation","layered_bottom_f0","layered_fraction","surface_cutout","glazing_transmission_color","glazing_f0","glazing_transmission_roughness","wood_curly_distortion"],d=function(e,t,n){var r="uv_"+e+"_map",i="";return t&&n?i="if ("+r+".x < 0.0 || "+r+".x > 1.0 || "+r+".y < 0.0 || "+r+".y > 1.0) { discard; }":t?i="if ("+r+".x < 0.0 || "+r+".x > 1.0) { discard; }":n&&(i="if ("+r+".y < 0.0 || "+r+".y > 1.0) { discard; }"),"#define "+e.toUpperCase()+"_CLAMP_TEST "+i},h=(r=0,i=function(e){return""!==e},o=function(e,t,n,r,i){var o=r?"1.0-":"",s="texture2D("+e+", (UV))",a="";return i=i||"vec4(0.0)",t&&n?a="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+i+" : ":t?a="((UV).x < 0.0 || (UV).x > 1.0) ? "+i+" : ":n&&(a="((UV).y < 0.0 || (UV).y > 1.0) ? "+i+" : "),"#define GET_"+e.toUpperCase()+"(UV) ("+a+o+s+")"},function(e,t,n,h){var f=e,p=f.context,m=f.isWebGL2(),g=n.defines,v=n.__webglShader.uniforms,y=n.attributes,_=Object(a.resolve)(n.__webglShader.vertexShader),b=Object(a.resolve)(n.__webglShader.fragmentShader),x=n.index0AttributeName;void 0===x&&!0===h.morphTargets&&(x="position"),h.envMap;var w,E,A=e.gammaFactor>0?e.gammaFactor:1,M=function(e){var t,n,r=[];for(var i in e)!1!==(t=e[i])&&(n="#define "+i+" "+t,r.push(n));return r.join("\n")}(g),S=p.createProgram();n instanceof l.RawShaderMaterial?((w=[M].filter(i).join("\n")).length>0&&(w+="\n"),(E=[M].filter(i).join("\n")).length>0&&(E+="\n")):(w=[m?"#version 300 es\n    #define _LMVWEBGL2_\n    #define texture2D texture\n    #define textureCube texture\n    #define attribute in\n    #define varying out\n":"","precision "+h.precision+" float;","precision "+h.precision+" int;",M,h.vertexPrefix,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",f.gammaInput?"#define GAMMA_INPUT":"",f.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+A,h.mrtNormals?"#define MRT_NORMALS":"",h.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_BONES "+h.maxBones,"#define NUM_CUTPLANES "+h.numCutplanes,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define ENVMAP_MODE_REFLECTION":"",h.irradianceMap?"#define USE_IRRADIANCEMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.vertexIds?"#define USE_VERTEX_ID":"",h.useTiling?"#define USE_TILING":"",h.useInstancing?"#define USE_INSTANCING":"",h.wideLines?"#define WIDE_LINES":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",h.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef PRISMWOOD","attribute vec3 uvw;","#endif","#ifdef USE_COLOR","   attribute vec3 color;","#endif",""].join("\n"),E=[m?"#version 300 es\n    #define _LMVWEBGL2_\n    #define texture2D texture\n    #define textureCube texture\n    #define textureCubeLodEXT textureLod\n    #define gl_FragColor outFragColor\n    #define varying in\n":"\n    #define gl_FragDepth gl_FragDepthEXT\n    #extension GL_OES_standard_derivatives : enable\n",m||!h.bumpMap&&!h.normalMap?"":"#extension GL_OES_standard_derivatives : enable",m||!h.mrtIdBuffer&&!h.mrtNormals||c.isIE11?"":"#extension GL_EXT_draw_buffers : enable",!m&&h.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",h.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",M,h.fragmentPrefix,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define NUM_CUTPLANES "+h.numCutplanes,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",f.gammaInput?"#define GAMMA_INPUT":"",f.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+A,h.mrtNormals?"#define MRT_NORMALS":"",h.mrtIdBuffer?"#define MRT_ID_BUFFER":"",h.mrtIdBuffer>1?"#define MODEL_COLOR":"","#define TONEMAP_OUTPUT "+(h.tonemapOutput||0),h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define ENVMAP_TYPE_CUBE":"",h.envMap?"#define ENVMAP_MODE_REFLECTION":"",h.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",h.irradianceMap?"#define USE_IRRADIANCEMAP":"",h.envGammaEncoded?"#define ENV_GAMMA":"",h.irrGammaEncoded?"#define IRR_GAMMA":"",h.envRGBM?"#define ENV_RGBM":"",h.irrRGBM?"#define IRR_RGBM":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.vertexIds?"#define USE_VERTEX_ID":"",h.metal?"#define METAL":"",h.clearcoat?"#define CLEARCOAT":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.hatchPattern?"#define HATCH_PATTERN":"",h.mapInvert?"#define MAP_INVERT":"",h.useTiling?"#define USE_TILING":"",h.useTiling?"#define TILE_RANGE_X_MIN "+h.tilingRepeatRange[0]:"",h.useTiling?"#define TILE_RANGE_Y_MIN "+h.tilingRepeatRange[1]:"",h.useTiling?"#define TILE_RANGE_X_MAX "+h.tilingRepeatRange[2]:"",h.useTiling?"#define TILE_RANGE_Y_MAX "+h.tilingRepeatRange[3]:"",h.hasRoundCorner?"#define USE_TILING_NORMAL":"",h.useRandomOffset?"#define USE_TILING_RANDOM":"",o("map",h.mapClampS,h.mapClampT),o("bumpMap",h.bumpMapClampS,h.bumpMapClampT),o("normalMap",h.normalMapClampS,h.normalMapClampT),o("specularMap",h.specularMapClampS,h.specularMapClampT),o("alphaMap",h.alphaMapClampS,h.alphaMapClampT,h.alphaMapInvert),"#ifdef USE_ENVMAP","#ifdef HAVE_TEXTURE_LOD",m?"":"#extension GL_EXT_shader_texture_lod : enable","#endif","#endif","precision "+h.precisionFragment+" float;","precision "+h.precisionFragment+" int;",m?"layout(location = 0) out vec4 outFragColor;":"","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#if defined(USE_ENVMAP) || defined(USE_IRRADIANCEMAP)","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"),h.isPrism&&(E+=function(e){for(var t="\n",n=0;n<u.length;n++){var r=e[u[n]];r&&(t+=d(u[n],r.S,r.T)+"\n")}return t}(h)));var T=new s.WebGLShader(p,p.VERTEX_SHADER,w+_),C=new s.WebGLShader(p,p.FRAGMENT_SHADER,E+b);p.attachShader(S,T),p.attachShader(S,C),void 0!==x&&p.bindAttribLocation(S,0,x),p.linkProgram(S),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===p.getProgramParameter(S,p.LINK_STATUS)&&(l.error("THREE.WebGLProgram: Could not initialise shader."),l.error("gl.VALIDATE_STATUS",p.getProgramParameter(S,p.VALIDATE_STATUS)),l.error("gl.getError()",p.getError())),""!==p.getProgramInfoLog(S)&&l.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",p.getProgramInfoLog(S))),p.deleteShader(T),p.deleteShader(C);var P=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];for(var L in h.logarithmicDepthBuffer&&P.push("logDepthBufFC"),v)P.push(L);for(var D in this.uniforms=function(e,t,n){for(var r={},i=0,o=n.length;i<o;i++){var s=n[i];r[s]=e.getUniformLocation(t,s)}return r}(p,S,P),P=["position","normal","uv","uv2","tangent","color","lineDistance","uvw","id","instOffset","instScaling","instRotation","prev","next","side"],y)P.push(D);return this.attributes=function(e,t,n){for(var r={},i=0,o=n.length;i<o;i++){var s=n[i];r[s]=e.getAttribLocation(t,s)}return r}(p,S,P),this.attributesKeys=Object.keys(this.attributes),this.id=r++,this.code=t,this.usedTimes=1,this.program=S,this.vertexShader=T,this.fragmentShader=C,this})},"./src/wgs/render/WebGLRenderer.js":
/*!*****************************************!*\
  !*** ./src/wgs/render/WebGLRenderer.js ***!
  \*****************************************/
/*! exports provided: DEBUG_TEXTURE_LOAD, WebGLRenderer */function(e,t,n){"use strict";n.r(t),n.d(t,"DEBUG_TEXTURE_LOAD",(function(){return c})),n.d(t,"WebGLRenderer",(function(){return h}));var r=n(/*! ./WebGLProgram */"./src/wgs/render/WebGLProgram.js"),i=n(/*! ./ShadowMap */"./src/wgs/render/ShadowMap.js"),o=n(/*! ../scene/RenderBatch */"./src/wgs/scene/RenderBatch.js"),s=n(/*! ../../compat */"./src/compat.js"),a=n(/*! three */"./thirdparty/three.js/three.js"),l=n(/*! ../globals */"./src/wgs/globals.js"),c=!1,u=Object(s.getGlobal)(),d=u.document,h=function(e){a.log("THREE.WebGLRenderer",a.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:d.createElement("canvas"),n=u.devicePixelRatio||1,h=void 0!==e.precision?e.precision:"highp",f=h,p=void 0!==e.alpha&&e.alpha,m=void 0===e.premultipliedAlpha||e.premultipliedAlpha,g=void 0!==e.antialias&&e.antialias,v=void 0===e.stencil||e.stencil,y=void 0===e.preserveDrawingBuffer||e.preserveDrawingBuffer,_=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,b=new a.Color(0),x=0,w=-1!=u.navigator.userAgent.indexOf("Firefox")&&-1!=u.navigator.userAgent.indexOf("Mac OS");w=w||s.isIE11;var E=[],A={},M=new a.Matrix4,S=new a.Matrix3,T=[],C=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var P,L,D,R,I,j=this,O=[],N=null,k=null,F=-1,V=null,B="",U=0,z="",G="",H=0,W=0,X=0,q=t.width,Y=t.height,K={},Q=new a.Frustum,Z=new a.Matrix4,J=new a.Matrix4,$=new a.Vector3,ee=new a.Vector3,te=!0,ne={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var re={alpha:p,premultipliedAlpha:m,antialias:g,stencil:v,preserveDrawingBuffer:y};if((P=e.useWebGL2?t.getContext("webgl2",re):null)?L=!0:P=t.getContext("webgl",re)||t.getContext("experimental-webgl",re),null===P)throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";0==P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.HIGH_FLOAT).precision&&(f="mediump"),t.addEventListener("webglcontextlost",(function(e){e.preventDefault(),le(),ae(),A={},j.webglcontextlost&&j.webglcontextlost(e)}),!1)}catch(e){return void a.error(e)}var ie=new a.WebGLState(P,Vt);void 0===P.getShaderPrecisionFormat&&(P.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var oe=new a.WebGLExtensions(P);oe.get("EXT_texture_filter_anisotropic"),oe.get("WEBGL_compressed_texture_s3tc"),L?oe.get("EXT_color_buffer_float"):(oe.get("OES_texture_float"),oe.get("OES_texture_float_linear"),oe.get("OES_texture_half_float"),oe.get("OES_texture_half_float_linear"),oe.get("OES_standard_derivatives"),oe.get("EXT_shader_texture_lod"),D=oe.get("WEBGL_draw_buffers"),R=oe.get("ANGLE_instanced_arrays"),I=oe.get("OES_vertex_array_object"),_&&oe.get("EXT_frag_depth"));var se=function(e,t,n,r){!0===m&&(e*=r,t*=r,n*=r),P.clearColor(e,t,n,r)},ae=function(){P.clearColor(0,0,0,1),P.clearDepth(1),P.clearStencil(0),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.frontFace(P.CCW),P.cullFace(P.BACK),P.enable(P.CULL_FACE),P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA),P.viewport(W,X,q,Y),se(b.r,b.g,b.b,x)},le=function(){N=null,V=null,B="",F=-1,te=!0,ie.reset(),ie.disableUnusedAttributes()};ae(),this.context=P,this.state=ie;for(var ce=P.getParameter(P.MAX_TEXTURE_IMAGE_UNITS),ue=P.getParameter(P.MAX_VERTEX_TEXTURE_IMAGE_UNITS),de=P.getParameter(P.MAX_TEXTURE_SIZE),he=P.getParameter(P.MAX_CUBE_MAP_TEXTURE_SIZE),fe=ue>0,pe=P.getShaderPrecisionFormat(P.VERTEX_SHADER,P.HIGH_FLOAT),me=P.getShaderPrecisionFormat(P.VERTEX_SHADER,P.MEDIUM_FLOAT),ge=P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.HIGH_FLOAT),ve=P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.MEDIUM_FLOAT),ye=new Uint8Array(16),_e=0;_e<4;_e++)c?1===_e||2===_e?(ye[4*_e]=246,ye[4*_e+1]=140,ye[4*_e+2]=220):(ye[4*_e]=48,ye[4*_e+1]=195,ye[4*_e+2]=3):ye[4*_e]=ye[4*_e+1]=ye[4*_e+2]=0,ye[4*_e+3]=255;var be=new a.DataTexture(ye,2,2,a.RGBAFormat,a.UnsignedByteType,a.UVMapping,a.RepeatWrapping,a.RepeatWrapping,a.NearestFilter,a.NearestFilter);be.needsUpdate=!0;var xe,we,Ee=function(){if(void 0!==xe)return xe;if(xe=[],oe.get("WEBGL_compressed_texture_pvrtc")||oe.get("WEBGL_compressed_texture_s3tc"))for(var e=P.getParameter(P.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)xe.push(e[t]);return xe},Ae=pe.precision>0,Me=me.precision>0;"highp"!==h||Ae||(Me?(h="mediump",a.warn("WebGLRenderer: highp not supported, using mediump")):(h="lowp",a.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==h||Me||(h="lowp",a.warn("WebGLRenderer: mediump not supported, using lowp")),Ae=ge.precision>0,Me=ve.precision>0,"highp"!==f||Ae||(Me?(f="mediump",a.warn("WebGLRenderer: highp not supported, using mediump")):(f="lowp",a.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==f||Me||(f="lowp",a.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return P},this.isWebGL2=function(){return L},this.forceContextLoss=function(){oe.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return fe},this.supportsFloatTextures=function(){return L||oe.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return L||oe.get("OES_texture_half_float_linear")},this.supportsStandardDerivatives=function(){return L||oe.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return L||oe.get("WEBGL_compressed_texture_s3tc")},this.supportsElementIndexUint=function(){return L||oe.get("OES_element_index_uint")},this.supportsMRT=function(){return L||!w&&D},this.supportsInstancedArrays=function(){return L||!!R},this.supportsBlendMinMax=function(){return L||oe.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==we)return we;var e=oe.get("EXT_texture_filter_anisotropic");return we=null!==e?P.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){n=e},this.getCurrentFramebuffer=function(){return k},this.setSize=function(e,r,i){t.width=e*n,t.height=r*n,!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r)},this.setViewport=function(e,t,r,i){W=e*n,X=t*n,q=r*n,Y=i*n,P.viewport(W,X,q,Y)};var Se=!1;this.enableViewportOnOffscreenTargets=function(e){Se=e};var Te=[];function Ce(e){e.__webglVertexBuffer=P.createBuffer(),e.__webglNormalBuffer=P.createBuffer(),e.__webglTangentBuffer=P.createBuffer(),e.__webglColorBuffer=P.createBuffer(),e.__webglUVBuffer=P.createBuffer(),e.__webglUV2Buffer=P.createBuffer(),e.__webglSkinIndicesBuffer=P.createBuffer(),e.__webglSkinWeightsBuffer=P.createBuffer(),e.__webglFaceBuffer=P.createBuffer(),e.__webglLineBuffer=P.createBuffer(),j.info.memory.geometries++}this.pushViewport=function(){Te.push(W),Te.push(X),Te.push(q),Te.push(Y)},this.popViewport=function(){var e=Te.length-4;W=Te[e],X=Te[e+1],q=Te[e+2],Y=Te[e+3],P.viewport(W,X,q,Y),Te.length=e},this.setScissor=function(e,t,r,i){P.scissor(e*n,t*n,r*n,i*n)},this.enableScissorTest=function(e){e?P.enable(P.SCISSOR_TEST):P.disable(P.SCISSOR_TEST)},this.getClearColor=function(){return b},this.setClearColor=function(e,t){b.set(e),x=void 0!==t?t:1,se(b.r,b.g,b.b,x)},this.getClearAlpha=function(){return x},this.setClearAlpha=function(e){x=e,se(b.r,b.g,b.b,x)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=P.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=P.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=P.STENCIL_BUFFER_BIT),P.clear(r)},this.clearColor=function(){P.clear(P.COLOR_BUFFER_BIT)},this.clearDepth=function(){P.clear(P.DEPTH_BUFFER_BIT)},this.clearStencil=function(){P.clear(P.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.resetGLState=le;var Pe=function e(t){t.target.traverse((function(t){t.removeEventListener("remove",e),function(e){(e instanceof a.Mesh||e instanceof a.PointCloud||e instanceof a.Line)&&delete A[e.id];delete e.__webglInit,delete e.__webglActive}(t)}))},Le=function e(t){var n=t.target;n.removeEventListener("dispose",e),Oe(n)},De=function e(t){var n=t.target;n.removeEventListener("dispose",e),Be(n),j.info.memory.textures--},Re=function e(t){var n=t.target;n.removeEventListener("dispose",e),Ue(n),j.info.memory.textures--},Ie=function e(t){var n=t.target;n.removeEventListener("dispose",e),ze(n)},je=function(e){if(void 0!==e.__webglVertexBuffer&&(P.deleteBuffer(e.__webglVertexBuffer),e.__webglVertexBuffer=void 0),void 0!==e.__webglNormalBuffer&&(P.deleteBuffer(e.__webglNormalBuffer),e.__webglNormalBuffer=void 0),void 0!==e.__webglTangentBuffer&&(P.deleteBuffer(e.__webglTangentBuffer),e.__webglTangentBuffer=void 0),void 0!==e.__webglColorBuffer&&(P.deleteBuffer(e.__webglColorBuffer),e.__webglColorBuffer=void 0),void 0!==e.__webglUVBuffer&&(P.deleteBuffer(e.__webglUVBuffer),e.__webglUVBuffer=void 0),void 0!==e.__webglUV2Buffer&&(P.deleteBuffer(e.__webglUV2Buffer),e.__webglUV2Buffer=void 0),void 0!==e.__webglSkinIndicesBuffer&&(P.deleteBuffer(e.__webglSkinIndicesBuffer),e.__webglSkinIndicesBuffer=void 0),void 0!==e.__webglSkinWeightsBuffer&&(P.deleteBuffer(e.__webglSkinWeightsBuffer),e.__webglSkinWeightsBuffer=void 0),void 0!==e.__webglFaceBuffer&&(P.deleteBuffer(e.__webglFaceBuffer),e.__webglFaceBuffer=void 0),void 0!==e.__webglLineBuffer&&(P.deleteBuffer(e.__webglLineBuffer),e.__webglLineBuffer=void 0),void 0!==e.__webglLineDistanceBuffer&&(P.deleteBuffer(e.__webglLineDistanceBuffer),e.__webglLineDistanceBuffer=void 0),void 0!==e.__webglCustomAttributesList){for(var t in e.__webglCustomAttributesList)P.deleteBuffer(e.__webglCustomAttributesList[t].buffer);e.__webglCustomAttributesList=void 0}j.info.memory.geometries--},Oe=function(e){var t,n,r,i;if(e.__webglInit=void 0,e instanceof a.BufferGeometry){if(void 0!==e.vbbuffer&&(P.deleteBuffer(e.vbbuffer),e.vbbuffer=void 0),void 0!==e.ibbuffer&&(P.deleteBuffer(e.ibbuffer),e.ibbuffer=void 0),void 0!==e.iblinesbuffer&&(P.deleteBuffer(e.iblinesbuffer),e.iblinesbuffer=void 0),e.vaos){for(t=0;t<e.vaos.length;t++)Je(e.vaos[t].vao);e.vaos=void 0}var o=e.attributes;for(var s in o)void 0!==o[s].buffer&&(P.deleteBuffer(o[s].buffer),o[s].buffer=void 0);j.info.memory.geometries--}else{var l=gt[e.id];if(void 0!==l){for(t=0,n=l.length;t<n;t++){var c=l[t];if(void 0!==c.numMorphTargets){for(r=0,i=c.numMorphTargets;r<i;r++)P.deleteBuffer(c.__webglMorphTargetsBuffers[r]);delete c.__webglMorphTargetsBuffers}if(void 0!==c.numMorphNormals){for(r=0,i=c.numMorphNormals;r<i;r++)P.deleteBuffer(c.__webglMorphNormalsBuffers[r]);delete c.__webglMorphNormalsBuffers}je(c)}delete gt[e.id]}else je(e)}};this.deallocateGeometry=Oe;var Ne,ke,Fe,Ve,Be=function(e){if(e.__webglTextureCube)P.deleteTexture(e.__webglTextureCube),e.__webglTextureCube=void 0;else{if(!e.__webglInit)return;P.deleteTexture(e.__webglTexture),e.__webglInit=void 0,e.__webglTexture=void 0}},Ue=function(e){e&&e.__webglTexture&&(P.deleteTexture(e.__webglTexture),P.deleteFramebuffer(e.__webglFramebuffer),void 0!==e.__webglRenderbuffer&&P.deleteRenderbuffer(e.__webglRenderbuffer))},ze=function(e){var t=!1;e.program=void 0,e.programs.forEach((function(e){var n,r,i,o;if(void 0!==e&&null!=(n=e.program))for(r=0,i=O.length;r<i;r++)if((o=O[r])&&o.program===n){o.usedTimes--,0===o.usedTimes&&(O[r]=void 0,P.deleteProgram(n),j.info.memory.programs--,t=!0);break}}),!1),e.programs.length=0,t&&(O=O.filter((function(e){return void 0!==e})))};function Ge(e,t){var n=e.vertices.length,r=t.material;if(r.attributes)for(var i in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),r.attributes){var o=r.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(n*s),o.buffer=P.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function He(e,t){var n=t.geometry,r=e.faces3,i=3*r.length,o=1*r.length,s=3*r.length,a=We(t,e),l=Ye(a),c=Xe(a),u=qe(a);e.__vertexArray=new Float32Array(3*i),c&&(e.__normalArray=new Float32Array(3*i)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*i)),u&&(e.__colorArray=new Float32Array(3*i)),l&&(n.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*i)),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*i))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*i),e.__skinWeightArray=new Float32Array(4*i));var d=(L||oe.get("OES_element_index_uint"))&&o>21845?Uint32Array:Uint16Array;if(e.__typeArray=d,e.__faceArray=new d(3*o),e.__lineArray=new d(2*s),e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes)for(var h in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),a.attributes){var f=a.attributes[h],p={};for(var m in f)p[m]=f[m];if(!p.__webglInitialized||p.createUniqueBuffers){p.__webglInitialized=!0;var g=1;"v2"===p.type?g=2:"v3"===p.type?g=3:"v4"===p.type?g=4:"c"===p.type&&(g=3),p.size=g,p.array=new Float32Array(i*g),p.buffer=P.createBuffer(),p.buffer.belongsToAttribute=h,f.needsUpdate=!0,p.__original=f}e.__webglCustomAttributesList.push(p)}e.__inittedArrays=!0}function We(e,t){return e.material instanceof a.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Xe(e){return!(e instanceof a.MeshBasicMaterial&&!e.envMap||e instanceof a.MeshDepthMaterial)&&(function(e){return e&&void 0!==e.shading&&e.shading===a.SmoothShading}(e)?a.SmoothShading:a.FlatShading)}function qe(e){return!!e.vertexColors&&e.vertexColors}function Ye(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e instanceof a.ShaderMaterial)}function Ke(e,t,n,r,i){if(e.__inittedArrays){var o,s,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S,T,C,L,D,R,I=Xe(i),j=qe(i),O=Ye(i),N=I===a.SmoothShading,k=0,F=0,V=0,B=0,U=0,z=0,G=0,H=0,W=0,X=0,q=e.__vertexArray,Y=e.__uvArray,K=e.__uv2Array,Q=e.__normalArray,Z=e.__tangentArray,J=e.__colorArray,$=e.__webglCustomAttributesList,ee=e.__faceArray,te=e.__lineArray,ne=t.geometry,re=ne.verticesNeedUpdate,ie=ne.elementsNeedUpdate,oe=ne.uvsNeedUpdate,se=ne.normalsNeedUpdate,ae=ne.tangentsNeedUpdate,le=ne.colorsNeedUpdate,ce=ne.vertices,ue=e.faces3,de=ne.faces,he=ne.faceVertexUvs[0],fe=ne.faceVertexUvs[1];if(re){for(o=0,s=ue.length;o<s;o++)g=ce[(l=de[ue[o]]).a],v=ce[l.b],y=ce[l.c],q[F]=g.x,q[F+1]=g.y,q[F+2]=g.z,q[F+3]=v.x,q[F+4]=v.y,q[F+5]=v.z,q[F+6]=y.x,q[F+7]=y.y,q[F+8]=y.z,F+=9;P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,q,n)}if(le&&j){for(o=0,s=ue.length;o<s;o++)d=(l=de[ue[o]]).vertexColors,h=l.color,3===d.length&&j===a.VertexColors?(w=d[0],E=d[1],A=d[2]):(w=h,E=h,A=h),J[W]=w.r,J[W+1]=w.g,J[W+2]=w.b,J[W+3]=E.r,J[W+4]=E.g,J[W+5]=E.b,J[W+6]=A.r,J[W+7]=A.g,J[W+8]=A.b,W+=9;W>0&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,J,n))}if(ae&&ne.hasTangents){for(o=0,s=ue.length;o<s;o++)_=(f=(l=de[ue[o]]).vertexTangents)[0],b=f[1],x=f[2],Z[G]=_.x,Z[G+1]=_.y,Z[G+2]=_.z,Z[G+3]=_.w,Z[G+4]=b.x,Z[G+5]=b.y,Z[G+6]=b.z,Z[G+7]=b.w,Z[G+8]=x.x,Z[G+9]=x.y,Z[G+10]=x.z,Z[G+11]=x.w,G+=12;P.bindBuffer(P.ARRAY_BUFFER,e.__webglTangentBuffer),P.bufferData(P.ARRAY_BUFFER,Z,n)}if(se&&I){for(o=0,s=ue.length;o<s;o++)if(c=(l=de[ue[o]]).vertexNormals,u=l.normal,3===c.length&&N)for(M=0;M<3;M++)T=c[M],Q[z]=T.x,Q[z+1]=T.y,Q[z+2]=T.z,z+=3;else for(M=0;M<3;M++)Q[z]=u.x,Q[z+1]=u.y,Q[z+2]=u.z,z+=3;P.bindBuffer(P.ARRAY_BUFFER,e.__webglNormalBuffer),P.bufferData(P.ARRAY_BUFFER,Q,n)}if(oe&&he&&O){for(o=0,s=ue.length;o<s;o++)if(void 0!==(p=he[ue[o]]))for(M=0;M<3;M++)C=p[M],Y[V]=C.x,Y[V+1]=C.y,V+=2;V>0&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglUVBuffer),P.bufferData(P.ARRAY_BUFFER,Y,n))}if(oe&&fe&&O){for(o=0,s=ue.length;o<s;o++)if(void 0!==(m=fe[ue[o]]))for(M=0;M<3;M++)L=m[M],K[B]=L.x,K[B+1]=L.y,B+=2;B>0&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglUV2Buffer),P.bufferData(P.ARRAY_BUFFER,K,n))}if(ie){for(o=0,s=ue.length;o<s;o++)ee[U]=k,ee[U+1]=k+1,ee[U+2]=k+2,U+=3,te[H]=k,te[H+1]=k+1,te[H+2]=k,te[H+3]=k+2,te[H+4]=k+1,te[H+5]=k+2,H+=6,k+=3;P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,ee,n),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,te,n)}if($)for(M=0,S=$.length;M<S;M++)if((R=$[M]).__original.needsUpdate){if(X=0,1===R.size){if(void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)l=de[ue[o]],R.array[X]=R.value[l.a],R.array[X+1]=R.value[l.b],R.array[X+2]=R.value[l.c],X+=3;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)D=R.value[ue[o]],R.array[X]=D,R.array[X+1]=D,R.array[X+2]=D,X+=3}else if(2===R.size){if(void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)l=de[ue[o]],g=R.value[l.a],v=R.value[l.b],y=R.value[l.c],R.array[X]=g.x,R.array[X+1]=g.y,R.array[X+2]=v.x,R.array[X+3]=v.y,R.array[X+4]=y.x,R.array[X+5]=y.y,X+=6;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)g=D=R.value[ue[o]],v=D,y=D,R.array[X]=g.x,R.array[X+1]=g.y,R.array[X+2]=v.x,R.array[X+3]=v.y,R.array[X+4]=y.x,R.array[X+5]=y.y,X+=6}else if(3===R.size){var pe;if(pe="c"===R.type?["r","g","b"]:["x","y","z"],void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)l=de[ue[o]],g=R.value[l.a],v=R.value[l.b],y=R.value[l.c],R.array[X]=g[pe[0]],R.array[X+1]=g[pe[1]],R.array[X+2]=g[pe[2]],R.array[X+3]=v[pe[0]],R.array[X+4]=v[pe[1]],R.array[X+5]=v[pe[2]],R.array[X+6]=y[pe[0]],R.array[X+7]=y[pe[1]],R.array[X+8]=y[pe[2]],X+=9;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)g=D=R.value[ue[o]],v=D,y=D,R.array[X]=g[pe[0]],R.array[X+1]=g[pe[1]],R.array[X+2]=g[pe[2]],R.array[X+3]=v[pe[0]],R.array[X+4]=v[pe[1]],R.array[X+5]=v[pe[2]],R.array[X+6]=y[pe[0]],R.array[X+7]=y[pe[1]],R.array[X+8]=y[pe[2]],X+=9;else if("faceVertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)g=(D=R.value[ue[o]])[0],v=D[1],y=D[2],R.array[X]=g[pe[0]],R.array[X+1]=g[pe[1]],R.array[X+2]=g[pe[2]],R.array[X+3]=v[pe[0]],R.array[X+4]=v[pe[1]],R.array[X+5]=v[pe[2]],R.array[X+6]=y[pe[0]],R.array[X+7]=y[pe[1]],R.array[X+8]=y[pe[2]],X+=9}else if(4===R.size)if(void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)l=de[ue[o]],g=R.value[l.a],v=R.value[l.b],y=R.value[l.c],R.array[X]=g.x,R.array[X+1]=g.y,R.array[X+2]=g.z,R.array[X+3]=g.w,R.array[X+4]=v.x,R.array[X+5]=v.y,R.array[X+6]=v.z,R.array[X+7]=v.w,R.array[X+8]=y.x,R.array[X+9]=y.y,R.array[X+10]=y.z,R.array[X+11]=y.w,X+=12;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)g=D=R.value[ue[o]],v=D,y=D,R.array[X]=g.x,R.array[X+1]=g.y,R.array[X+2]=g.z,R.array[X+3]=g.w,R.array[X+4]=v.x,R.array[X+5]=v.y,R.array[X+6]=v.z,R.array[X+7]=v.w,R.array[X+8]=y.x,R.array[X+9]=y.y,R.array[X+10]=y.z,R.array[X+11]=y.w,X+=12;else if("faceVertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)g=(D=R.value[ue[o]])[0],v=D[1],y=D[2],R.array[X]=g.x,R.array[X+1]=g.y,R.array[X+2]=g.z,R.array[X+3]=g.w,R.array[X+4]=v.x,R.array[X+5]=v.y,R.array[X+6]=v.z,R.array[X+7]=v.w,R.array[X+8]=y.x,R.array[X+9]=y.y,R.array[X+10]=y.z,R.array[X+11]=y.w,X+=12;P.bindBuffer(P.ARRAY_BUFFER,R.buffer),P.bufferData(P.ARRAY_BUFFER,R.array,n)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Qe(e){if(e.streamingDraw){if(!e.streamingIndex){var t=e.attributes.index;t&&(t.buffer=P.createBuffer(),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,t.buffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,t.array||e.ib,P.STATIC_DRAW))}}else{e.vb&&void 0===e.vbbuffer&&(e.vbbuffer=P.createBuffer(),e.vbNeedsUpdate=!0),e.ib&&void 0===e.ibbuffer&&(e.ibbuffer=P.createBuffer(),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.ibbuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,e.ib,P.STATIC_DRAW)),e.iblines&&void 0===e.iblinesbuffer&&(e.iblinesbuffer=P.createBuffer(),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.iblinesbuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,e.iblines,P.STATIC_DRAW));for(var n=e.attributes,r=e.attributesKeys,i=0,o=r.length;i<o;i++){var s=r[i],a=n[s],l="index"===s;if(a.array&&void 0===a.buffer&&(a.buffer=P.createBuffer(),a.needsUpdate=!0),!0===a.needsUpdate){var c=l?P.ELEMENT_ARRAY_BUFFER:P.ARRAY_BUFFER;P.bindBuffer(c,a.buffer),P.bufferData(c,a.array,P.STATIC_DRAW),a.needsUpdate=!1}}e.vbNeedsUpdate&&(P.bindBuffer(P.ARRAY_BUFFER,e.vbbuffer),P.bufferData(P.ARRAY_BUFFER,e.vb,P.STATIC_DRAW),e.vbNeedsUpdate=!1,e.discardAfterUpload&&(e.vb=null))}}function Ze(e){L?P.bindVertexArray(e):I.bindVertexArrayOES(e)}function Je(e){L?P.deleteVertexArray(e):I.deleteVertexArrayOES(e)}function $e(e,t,n){L?P.vertexAttribDivisor(e,t&&n||0):R&&R.vertexAttribDivisorANGLE(e,t&&n||0)}function et(e,t,n,r,i){L?P.drawElementsInstanced(e,t,n,r,i):R.drawElementsInstancedANGLE(e,t,n,r,i)}function tt(e,t,n,r){var i;if(!I||!l.USE_VAO||n.streamingDraw)return n.vaos=null,!1;if(!L&&!I)return n.vaos=null,!1;if(void 0===n.vaos&&(n.vaos=[]),i=L?P.createVertexArray():I.createVertexArrayOES(),n.vaos.push({geomhash:t.id,uv:r,vao:i}),Ze(i),e.isEdgeMaterial)P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.iblinesbuffer);else{var o=n.attributes.index;o&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.ibbuffer||o.buffer)}for(var s=null,a=t.attributes,c=t.attributesKeys,u=n.vbstride,d=n.offsets&&n.offsets.length?n.offsets[0].index:0,h=n.offsets&&n.offsets.length&&n.offsets[0].instanceStart||0,f=0,p=c.length;f<p;f++){var m=c[f],g=a[m];if(g>=0){var v=n.attributes[m];if("uv"===m&&r&&(v=n.attributes["uv"+(r+1)]),!v){Ze(null);for(var y=0;y<n.vaos.length;y++)Je(n.vaos[y].vao);return n.vaos=null,!1}var _=P.FLOAT,b=v.bytesPerItem||4;1===b?_=P.UNSIGNED_BYTE:2===b&&(_=P.UNSIGNED_SHORT),P.enableVertexAttribArray(g);var x=d;v.divisor&&(x+=h),void 0!==v.itemOffset?(s!=n.vbbuffer&&(P.bindBuffer(P.ARRAY_BUFFER,n.vbbuffer),s=n.vbbuffer),P.vertexAttribPointer(g,v.itemSize,_,!!v.normalize,4*u,4*(v.itemOffset+x*u))):(P.bindBuffer(P.ARRAY_BUFFER,v.buffer),s=v.buffer,P.vertexAttribPointer(g,v.itemSize,_,!!v.normalize,0,x*v.itemSize*b)),$e(g,n.numInstances,v.divisor)}}return!0}function nt(e,t){var n=K[e];return n||(n=P.createBuffer(),K[e]=n),P.bindBuffer(P.ARRAY_BUFFER,n),P.bufferData(P.ARRAY_BUFFER,t,P.DYNAMIC_DRAW),n}function rt(e,t,n,r,i,o,s){var a,l=t.attributes,c=t.attributesKeys,u=0;if(i)if(!i.buffer&&n.streamingDraw){var d=K.index;d||(d=P.createBuffer(),K.index=d),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,d),e.isEdgeMaterial?P.bufferData(P.ELEMENT_ARRAY_BUFFER,n.iblines,P.DYNAMIC_DRAW):P.bufferData(P.ELEMENT_ARRAY_BUFFER,i.array||n.ib,P.DYNAMIC_DRAW)}else e.isEdgeMaterial?P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.iblinesbuffer):P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.ibbuffer||i.buffer);for(var h=0,f=c.length;h<f;h++){var p=c[h],m=l[p];if(m>=0){var g=n.attributes[p];if("uv"===p&&o&&(g=n.attributes["uv"+(o+1)]),g){var v,y,_=void 0!==g.itemOffset;_?(v=n.vbstride,y=g.itemOffset,u!==a&&(n.streamingDraw?u=nt("interleavedVB",n.vb):(u=n.vbbuffer,P.bindBuffer(P.ARRAY_BUFFER,u)),a=u)):(v=g.itemSize,y=0,n.streamingDraw?u=nt(p,g.array):(u=g.buffer,P.bindBuffer(P.ARRAY_BUFFER,u)));var b=P.FLOAT,x=g.bytesPerItem||4;1===x?b=P.UNSIGNED_BYTE:2===x&&(b=P.UNSIGNED_SHORT),_&&(x=4),ie.enableAttribute(m);var w=r;g.divisor&&(w+=s),P.vertexAttribPointer(m,g.itemSize,b,g.normalize,v*x,(y+w*v)*x),$e(m,n.numInstances,g.divisor)}else if(e.defaultAttributeValues){var E=e.defaultAttributeValues[p];E&&2===E.length?P.vertexAttrib2fv(m,e.defaultAttributeValues[p]):E&&3===E.length?P.vertexAttrib3fv(m,e.defaultAttributeValues[p]):E&&4===E.length&&P.vertexAttrib4fv(m,e.defaultAttributeValues[p])}}}ie.disableUnusedAttributes()}function it(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function ot(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?t.z-e.z:e.id-t.id}function st(e){lt(e,!0)}function at(e){lt(e,!1)}function lt(e,t,n){var r,i;if(n||!1!==e.visible){if(e instanceof a.Scene||e instanceof a.Group);else if(e instanceof o.RenderBatch)e.forEach(t?st:at);else if(function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",Pe));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",Le),t instanceof a.BufferGeometry||(e instanceof a.Mesh?yt(e,t):e instanceof a.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=P.createBuffer(),e.__webglColorBuffer=P.createBuffer(),e.__webglLineDistanceBuffer=P.createBuffer(),j.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__lineDistanceArray=new Float32Array(1*n),e.__webglLineCount=n,Ge(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof a.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=P.createBuffer(),e.__webglColorBuffer=P.createBuffer(),j.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__webglPointCount=n,Ge(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof a.Mesh){if(t instanceof a.BufferGeometry)_t(A,t,e);else if(t instanceof a.Geometry)for(var n=gt[t.id],r=0,i=n.length;r<i;r++)_t(A,n[r],e)}else(e instanceof a.Line||e instanceof a.PointCloud)&&_t(A,t,e)}(e),e instanceof a.Light)E.push(e);else{var s=A[e.id];if(s&&(!1===e.frustumCulled||!0===Q.intersectsObject(e)))for(r=0,i=s.length;r<i;r++){var l=s[r];mt(l),l.render=!0,!0===t&&($.setFromMatrixPosition(e.matrixWorld),$.applyProjection(Z),l.z=$.z)}}if(e.children)for(r=0,i=e.children.length;r<i;r++)lt(e.children[r],t,n)}}function ct(e,t){if(!t.getCustomOverrideMaterial)return t;var n=t.getCustomOverrideMaterial(e);return n||t}function ut(e,t,n,r,i){for(var o,s=0,l=e.length;s<l;s++){var c=e[s],u=c.object,d=c.buffer;if(i)o=ct(c.material,i);else{if(!(o=c.material))continue;At(o)}if(o.twoPassTransparency){var h=o.side;o.side=a.BackSide,dt(o,t,n,r,d,i,u),o.side=a.FrontSide,dt(o,t,n,r,d,i,u),o.side=h}else dt(o,t,n,r,d,i,u)}}function dt(e,t,n,r,i,o,s){if(j.setMaterialFaces(e),i instanceof a.BufferGeometry?j.renderBufferDirect(t,n,r,e,i,s):j.renderBuffer(t,n,r,e,i,s),e.decals)for(var l=e.decals,c=0,u=l.length;c<u;c++){var d=l[c];At(e=d.material),j.setMaterialFaces(e),i instanceof a.BufferGeometry&&j.renderBufferDirect(t,n,r,e,i,s,d.uv)}}function ht(e,t){if(e.visible&&!e.hide){var n;if(Ve)n=ct(e.material,Ve);else{if(!(n=e.material))return;At(n)}if(n.twoPassTransparency){var r=n.side;n.side=a.BackSide,ft(e,n),n.side=a.FrontSide,ft(e,n),n.side=r}else ft(e,n)}}function ft(e,t){if(j.setMaterialFaces(t),j.renderBufferDirect(Ne,ke,Fe,t,e.geometry,e),t.decals)for(var n=t.decals,r=0,i=n.length;r<i;r++){var o=n[r];At(t=o.material),j.setMaterialFaces(t),j.renderBufferDirect(Ne,ke,Fe,t,e.geometry,e,o.uv)}}function pt(e,t,n,r,i,o){Ne=n,ke=r,Fe=i,Ve=o||null,e.forEach(ht,e.forceVisible?1:32,!1)}function mt(e){var t=e.object,n=e.buffer,r=t.geometry,i=t.material;if(i instanceof a.MeshFaceMaterial){var o=r instanceof a.BufferGeometry?0:n.materialIndex;i=i.materials[o],e.material=i,i.transparent?C.push(e):T.push(e)}else i&&(e.material=i,i.transparent?C.push(e):T.push(e))}this.renderBufferDirect=function(e,t,n,r,i,o,s){if(!1!==r.visible&&(!r.isEdgeMaterial||i.iblines)){Qe(o.geometry);var l=Mt(e,t,n,r,o),c=i.attributes,u=!1,d=r.wireframe?1:0,h="direct_"+i.id+(s?"/"+s:"")+"_"+l.id+"_"+d;h!==B&&(B=h,u=!0);var f,p=i.offsets&&i.offsets.length,m=p&&i.offsets.some((function(e){e.index>=0||e.instanceStart}));m?u=!0:(f=function(e,t,n,r){var i=n.vaos;if(i)for(var o=0,s=i.length;o<s;o++){var a=i[o];if(a.geomhash===t.id&&a.uv===r)return Ze(a.vao),!0}else if(null===i)return!1;return tt(e,t,n,r)}(r,l,i,s||0),u=u&&!f),u&&ie.initAttributes();var g,v=c.index;if(v){var y,_,b=v.array?v.array:i.ib;r.isEdgeMaterial&&(v=c.indexlines,b=i.iblines),v.bytesPerItem?4===(_=v.bytesPerItem)&&!L&&oe.get("OES_element_index_uint"):_=b instanceof Uint32Array&&(L||oe.get("OES_element_index_uint"))?4:2,y=4===_?P.UNSIGNED_INT:P.UNSIGNED_SHORT;var x=i.offsets;p&&r.isEdgeMaterial&&!x[0].hasOwnProperty("edgeStart")&&(x=null);var w=0;do{var E,A,M,S,T;if(p){var C=x[w];E=C.index,A=r.isEdgeMaterial?C.edgeStart||0:C.start,M=r.isEdgeMaterial?C.edgeCount||b.length:C.count,S=C.instanceStart||0,T=C.numInstances||i.numInstances;var D=r.program.uniforms;if(D.themingColor&&"themingColor"in C){var I=C.themingColor;I instanceof a.Vector4?P.uniform4f(D.themingColor,I.x,I.y,I.z,I.w):P.uniform4f(D.themingColor,0,0,0,0)}}else E=0,A=0,M=b.length,S=0,T=i.numInstances;u&&(rt(r,l,i,E,v,s,S),m||(u=!1)),g=P.TRIANGLES,i.isPoints?g=P.POINTS:(i.isLines||r.isEdgeMaterial)&&(g=P.LINES),T?et(g,M,y,A*_,T):P.drawElements(g,M,y,A*_)}while(x&&++w<x.length)}else{i.offsets&&i.offsets.length>1&&console.error("Geometry with draw calls and no index buffer"),u&&rt(r,l,i,0,void 0,s,0);var j=i.attributes.position;g=P.TRIANGLES,i.isPoints?g=P.POINTS:(i.isLines||r.isEdgeMaterial)&&(g=P.LINES),i.numInstances?function(e,t,n,r){L?P.drawArraysInstanced(e,t,n,r):R.drawArraysInstancedANGLE(e,t,n,r)}(g,0,j.array.length/3,i.numInstances):P.drawArrays(g,0,j.array.length/j.itemSize)}f&&Ze(null)}},this.renderBuffer=function(e,t,r,i,o,s){if(!1!==i.visible){!function(e){var t,n,r=e.geometry;if(r instanceof a.BufferGeometry)Qe(r);else if(e instanceof a.Mesh){!0===r.groupsNeedUpdate&&yt(e,r);for(var i=gt[r.id],o=0,s=i.length;o<s;o++){var l=i[o];n=We(e,l),t=n.attributes&&bt(n),(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||r.colorsNeedUpdate||r.tangentsNeedUpdate||t)&&Ke(l,e,P.DYNAMIC_DRAW,!r.dynamic,n)}r.verticesNeedUpdate=!1,r.morphTargetsNeedUpdate=!1,r.elementsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.tangentsNeedUpdate=!1,n.attributes&&xt(n)}else e instanceof a.Line?(n=We(e,r),t=n.attributes&&bt(n),(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||t)&&function(e,t){var n,r,i,o,s,a,l,c,u,d,h,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,_=g.length,b=e.__vertexArray,x=e.__colorArray,w=e.__lineDistanceArray,E=e.verticesNeedUpdate,A=e.colorsNeedUpdate,M=e.lineDistancesNeedUpdate,S=e.__webglCustomAttributesList;if(E){for(n=0;n<v;n++)o=p[n],b[s=3*n]=o.x,b[s+1]=o.y,b[s+2]=o.z;P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,b,t)}if(A){for(r=0;r<y;r++)a=m[r],x[s=3*r]=a.r,x[s+1]=a.g,x[s+2]=a.b;P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,x,t)}if(M){for(i=0;i<_;i++)w[i]=g[i];P.bindBuffer(P.ARRAY_BUFFER,e.__webglLineDistanceBuffer),P.bufferData(P.ARRAY_BUFFER,w,t)}if(S)for(l=0,c=S.length;l<c;l++)if((f=S[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(s=0,d=f.value.length,1===f.size)for(u=0;u<d;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.r,f.array[s+1]=h.g,f.array[s+2]=h.b,s+=3;else for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,f.array[s+2]=h.z,s+=3;else if(4===f.size)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,f.array[s+2]=h.z,f.array[s+3]=h.w,s+=4;P.bindBuffer(P.ARRAY_BUFFER,f.buffer),P.bufferData(P.ARRAY_BUFFER,f.array,t)}}(r,P.DYNAMIC_DRAW),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,r.lineDistancesNeedUpdate=!1,n.attributes&&xt(n)):e instanceof a.PointCloud&&(n=We(e,r),t=n.attributes&&bt(n),(r.verticesNeedUpdate||r.colorsNeedUpdate||t)&&function(e,t){var n,r,i,o,s,a,l,c,u,d,h,f=e.vertices,p=e.colors,m=f.length,g=p.length,v=e.__vertexArray,y=e.__colorArray,_=e.verticesNeedUpdate,b=e.colorsNeedUpdate,x=e.__webglCustomAttributesList;if(_){for(n=0;n<m;n++)i=f[n],v[o=3*n]=i.x,v[o+1]=i.y,v[o+2]=i.z;P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,v,t)}if(b){for(r=0;r<g;r++)s=p[r],y[o=3*r]=s.r,y[o+1]=s.g,y[o+2]=s.b;P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,y,t)}if(x)for(a=0,l=x.length;a<l;a++)if((h=x[a]).needsUpdate&&(void 0===h.boundTo||"vertices"===h.boundTo)){if(o=0,u=h.value.length,1===h.size)for(c=0;c<u;c++)h.array[c]=h.value[c];else if(2===h.size)for(c=0;c<u;c++)d=h.value[c],h.array[o]=d.x,h.array[o+1]=d.y,o+=2;else if(3===h.size)if("c"===h.type)for(c=0;c<u;c++)d=h.value[c],h.array[o]=d.r,h.array[o+1]=d.g,h.array[o+2]=d.b,o+=3;else for(c=0;c<u;c++)d=h.value[c],h.array[o]=d.x,h.array[o+1]=d.y,h.array[o+2]=d.z,o+=3;else if(4===h.size)for(c=0;c<u;c++)d=h.value[c],h.array[o]=d.x,h.array[o+1]=d.y,h.array[o+2]=d.z,h.array[o+3]=d.w,o+=4;P.bindBuffer(P.ARRAY_BUFFER,h.buffer),P.bufferData(P.ARRAY_BUFFER,h.array,t)}}(r,P.DYNAMIC_DRAW),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,n.attributes&&xt(n))}(s);var l=Mt(e,t,r,i,s),c=l.attributes,u=!1,d=i.wireframe?1:0,h=o.id+"_"+l.id+"_"+d;if(h!==B&&(B=h,u=!0),u&&ie.initAttributes(),!i.morphTargets&&c.position>=0&&u&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglVertexBuffer),ie.enableAttribute(c.position),y(c.position,3,P.FLOAT,!1,0,0)),u){if(o.__webglCustomAttributesList)for(var f=0,p=o.__webglCustomAttributesList.length;f<p;f++){var m=o.__webglCustomAttributesList[f];c[m.buffer.belongsToAttribute]>=0&&(P.bindBuffer(P.ARRAY_BUFFER,m.buffer),ie.enableAttribute(c[m.buffer.belongsToAttribute]),y(c[m.buffer.belongsToAttribute],m.size,P.FLOAT,!1,0,0))}c.color>=0&&(s.geometry.colors.length>0||s.geometry.faces.length>0?(P.bindBuffer(P.ARRAY_BUFFER,o.__webglColorBuffer),ie.enableAttribute(c.color),y(c.color,3,P.FLOAT,!1,0,0)):i.defaultAttributeValues&&P.vertexAttrib3fv(c.color,i.defaultAttributeValues.color)),c.normal>=0&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglNormalBuffer),ie.enableAttribute(c.normal),y(c.normal,3,P.FLOAT,!1,0,0)),c.tangent>=0&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglTangentBuffer),ie.enableAttribute(c.tangent),y(c.tangent,4,P.FLOAT,!1,0,0)),c.uv>=0&&(s.geometry.faceVertexUvs[0]?(P.bindBuffer(P.ARRAY_BUFFER,o.__webglUVBuffer),ie.enableAttribute(c.uv),y(c.uv,2,P.FLOAT,!1,0,0)):i.defaultAttributeValues&&P.vertexAttrib2fv(c.uv,i.defaultAttributeValues.uv)),c.uv2>=0&&(s.geometry.faceVertexUvs[1]?(P.bindBuffer(P.ARRAY_BUFFER,o.__webglUV2Buffer),ie.enableAttribute(c.uv2),y(c.uv2,2,P.FLOAT,!1,0,0)):i.defaultAttributeValues&&P.vertexAttrib2fv(c.uv2,i.defaultAttributeValues.uv2)),c.lineDistance>=0&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglLineDistanceBuffer),ie.enableAttribute(c.lineDistance),y(c.lineDistance,1,P.FLOAT,!1,0,0))}if(ie.disableUnusedAttributes(),s instanceof a.Mesh){var g=o.__typeArray===Uint32Array?P.UNSIGNED_INT:P.UNSIGNED_SHORT;i.wireframe?(ie.setLineWidth(i.wireframeLinewidth*n),u&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),P.drawElements(P.LINES,o.__webglLineCount,g,0)):(u&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),P.drawElements(P.TRIANGLES,o.__webglFaceCount,g,0))}else if(s instanceof a.Line){var v=s.mode===a.LineStrip?P.LINE_STRIP:P.LINES;ie.setLineWidth(i.linewidth*n),P.drawArrays(v,0,o.__webglLineCount)}else s instanceof a.PointCloud&&P.drawArrays(P.POINTS,0,o.__webglPointCount)}function y(e,t,n,r,i,o){P.vertexAttribPointer(e,t,n,r,i,o),R&&R.vertexAttribDivisorANGLE(e,0)}},this.render=function(e,t,n,r,i){if(t instanceof a.Camera!=!1){B="",F=-1,V=null,void 0!==i&&(E.length=0,te=!0);var s=e.fog;!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),t.worldUpTransform?J.multiplyMatrices(t.worldUpTransform,t.matrixWorld):J.copy(t.matrixWorld),Z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Q.setFromMatrix(Z);var l=e instanceof o.RenderBatch&&e.renderImmediate;if(l||(T.length=0,C.length=0,lt(e,!0===j.sortObjects,!0===e.forceVisible),!0===j.sortObjects&&(T.sort(ot),C.sort(it))),te&&(i&&i.length&&(E=i.slice()),Rt(E)),this.setRenderTarget(n),this.resetGLState(),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var c=e.overrideMaterial;At(c),l?pt(e,"",t,E,s,c):(ut(T,t,E,s,c),ut(C,t,E,s,c))}else l?pt(e,"",t,E,s,null):(ie.setBlending(a.NoBlending),ut(T,t,E,s,null),ut(C,t,E,s,null));n&&n.generateMipmaps&&n.minFilter!==a.NearestFilter&&n.minFilter!==a.LinearFilter&&function(e){P.bindTexture(P.TEXTURE_2D,e.__webglTexture),P.generateMipmap(P.TEXTURE_2D),P.bindTexture(P.TEXTURE_2D,null)}(n),this.resetGLState(),ie.setDepthTest(!0),ie.setDepthWrite(!0)}else a.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.clearBlend=function(){ie.setBlending(a.NoBlending)},this.setProgramPrefix=function(e,t,n){U=e,z=t,G=n},this.getProgramPrefix=function(){return{programPrefix:U,vertexPrefix:z,fragmentPrefix:G}};var gt={},vt=0;function yt(e,t){var n=e.material,r=!1;void 0!==gt[t.id]&&!0!==t.groupsNeedUpdate||(delete A[e.id],gt[t.id]=function(e,t){for(var n,r,i=L||oe.get("OES_element_index_uint")?4294967296:65535,o={},s=e.morphTargets?e.morphTargets.length:0,a=e.morphNormals?e.morphNormals.length:0,l={},c=[],u=0,d=e.faces.length;u<d;u++){var h=e.faces[u],f=t?h.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),(n=o[f].hash+"_"+o[f].counter)in l||(r={id:vt++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:s,numMorphNormals:a},l[n]=r,c.push(r)),l[n].vertices+3>i&&(o[f].counter+=1,(n=o[f].hash+"_"+o[f].counter)in l||(r={id:vt++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:s,numMorphNormals:a},l[n]=r,c.push(r))),l[n].faces3.push(u),l[n].vertices+=3}return c}(t,n instanceof a.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var i=gt[t.id],o=0,s=i.length;o<s;o++){var l=i[o];void 0===l.__webglVertexBuffer?(Ce(l),He(l,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,r=!0):r=!1,(r||void 0===e.__webglActive)&&_t(A,l,e)}e.__webglActive=!0}function _t(e,t,n){var r=n.id;e[r]=e[r]||[],e[r].push({id:r,buffer:t,object:n,material:null,z:0})}function bt(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function xt(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}var wt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"firefly_basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"firefly_basic",LineDashedMaterial:"dashed",PointCloudMaterial:"firefly_basic"};function Et(e,t,n,i){e.addEventListener("dispose",Ie);var o=wt[e.type];if(o){var s=a.ShaderLib[o];e.__webglShader={uniforms:a.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var l=function(e){for(var t=0,n=0,r=0,i=0,o=0,s=e.length;o<s;o++){var l=e[o];l.onlyShadow||(l instanceof a.DirectionalLight&&t++,l instanceof a.PointLight&&n++,l instanceof a.SpotLight&&r++,l instanceof a.HemisphereLight&&i++)}return{directional:t,point:n,spot:r,hemi:i}}(t),c={precision:h,precisionFragment:f,supportsVertexTextures:fe,haveTextureLod:L||!!oe.get("EXT_shader_texture_lod"),map:!!e.map,envMap:!!e.envMap,irradianceMap:!!e.irradianceMap,envIsSpherical:e.envMap&&e.envMap.mapping==a.SphericalReflectionMapping,envGammaEncoded:e.envMap&&e.envMap.GammaEncoded,irrGammaEncoded:e.irradianceMap&&e.irradianceMap.GammaEncoded,envRGBM:e.envMap&&e.envMap.RGBM,irrRGBM:e.irradianceMap&&e.irradianceMap.RGBM,lightMap:!!e.lightMap,bumpMap:(L||oe.get("OES_standard_derivatives"))&&!!e.bumpMap,normalMap:(L||oe.get("OES_standard_derivatives"))&&!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,vertexIds:e.vertexIds,useInstancing:e.useInstancing,wideLines:e.wideLines,fog:n,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:_,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,alphaTest:e.alphaTest,metal:e.metal,clearcoat:e.clearcoat,wrapAround:e.wrapAround,doubleSided:e.side===a.DoubleSide,flipSided:e.side===a.BackSide,mrtNormals:e.mrtNormals,mrtIdBuffer:e.mrtIdBuffer,vertexPrefix:z,fragmentPrefix:G,tonemapOutput:e.tonemapOutput,packedNormals:e.packedNormals,hatchPattern:!!e.hatchParams,numCutplanes:e.cutplanes?e.cutplanes.length:0,useTiling:e.useTiling,tilingRepeatRange:e.useTiling&&e.tilingRepeatRange,hasRoundCorner:e.hasRoundCorner,useRandomOffset:e.useRandomOffset,mapInvert:e.map&&e.map.invert,mapClampS:e.map&&e.map.clampS,mapClampT:e.map&&e.map.clampT,bumpMapClampS:e.bumpMap&&e.bumpMap.clampS,bumpMapClampT:e.bumpMap&&e.bumpMap.clampT,normalMapClampS:e.normalMap&&e.normalMap.clampS,normalMapClampT:e.normalMap&&e.normalMap.clampT,specularMapClampS:e.specularMap&&e.specularMap.clampS,specularMapClampT:e.specularMap&&e.specularMap.clampT,alphaMapInvert:e.alphaMap&&e.alphaMap.invert,alphaMapClampS:e.alphaMap&&e.alphaMap.clampS,alphaMapClampT:e.alphaMap&&e.alphaMap.clampT};e.isPrismMaterial&&(!function(e,t){if(t.textureMaps)for(var n=0;n<r.PrismMaps.length;n++){var i=r.PrismMaps[n],o=t.textureMaps[i+"_map"];if(o){var s=o.textureObj.properties.booleans;e[i]={S:!s.texture_URepeat.values[0],T:!s.texture_VRepeat.values[0]}}}}(c,e),c.isPrism=!0);var u,d,p=[];for(var m in o?p.push(o):(p.push(e.fragmentShader),p.push(e.vertexShader)),e.defines)p.push(m),p.push(e.defines[m]);for(u in c)p.push(u),p.push(c[u]);var g,v=p.join();for(u=0,d=O.length;u<d;u++){var y=O[u];if(y.code===v){(g=y).usedTimes++;break}}for(var b in void 0===g&&(g=new r.WebGLProgram(j,v,e,c),O.push(g),j.info.memory.programs=O.length),e.programs||(e.programs=[]),e.programs[U]=g,e.uniformsLists||(e.uniformsLists=[]),e.uniformsList=e.uniformsLists[U]=[],e.__webglShader.uniforms){var x=g.uniforms[b];x&&e.uniformsList.push([e.__webglShader.uniforms[b],x])}}function At(e){!0===e.transparent?ie.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):ie.setBlending(a.NoBlending),ie.setDepthTest(e.depthTest),ie.setDepthWrite(e.depthWrite),ie.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Mt(e,t,n,r,o){H=0,r.needsUpdate?(r.program&&ze(r),Et(r,t,n),r.needsUpdate=!1):r.programs[U]||Et(r,t,n);var s=!1,l=!1,c=!1;r.uniformsList=r.uniformsLists[U];var d,h=r.program=r.programs[U],f=h.uniforms,p=r.__webglShader.uniforms;if(h.id!==N&&(P.useProgram(h.program),N=h.id,s=!0,l=!0,c=!0),r.id!==F&&(-1===F&&(c=!0),F=r.id,l=!0),(s||e!==V)&&(P.uniformMatrix4fv(f.projectionMatrix,!1,e.projectionMatrix.elements),_&&P.uniform1f(f.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==V&&(V=e),(r instanceof a.ShaderMaterial||r instanceof a.MeshPhongMaterial||r.isPrismMaterial||r.envMap)&&null!==f.cameraPosition&&($.setFromMatrixPosition(e.matrixWorld),P.uniform3f(f.cameraPosition,$.x,$.y,$.z)),(r instanceof a.MeshPhongMaterial||r instanceof a.MeshLambertMaterial||r instanceof a.ShaderMaterial||r.isPrismMaterial||r.skinning)&&(null!==f.viewMatrix&&P.uniformMatrix4fv(f.viewMatrix,!1,e.matrixWorldInverse.elements),null!==f.viewMatrixInverse&&P.uniformMatrix4fv(f.viewMatrixInverse,!1,J.elements),f.mvpMatrix&&P.uniformMatrix4fv(f.mvpMatrix,!1,Z.elements),c?(Tt(p,r),Ct(p,!0)):Ct(p,!1))),f.unpackXform){var m=o.geometry,g=m.unpackXform;if(g?P.uniform4f(f.unpackXform,g.x,g.y,g.z,g.w):P.uniform4f(f.unpackXform,1,1,0,0),f.tIdColor){P.uniform2f(f.vIdColorTexSize,m.vIdColorTexSize.x,m.vIdColorTexSize.y);var v=Lt();P.uniform1i(f.tIdColor,v),j.setTexture(m.tIdColor,v)}}if(l){if((r instanceof a.MeshPhongMaterial||r instanceof a.MeshLambertMaterial||r.isPrismMaterial||r.lights)&&(te&&(c=!0,Rt(t),te=!1),c?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(p,ne),Pt(p,!0)):Pt(p,!1)),(r instanceof a.MeshBasicMaterial||r instanceof a.MeshLambertMaterial||r instanceof a.MeshPhongMaterial)&&(!function(e,t){e.opacity.value=t.opacity,e.diffuse.value.copy(t.color),e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));function n(e,t,n){var r=n.offset,i=n.repeat;if(t){var o=t.value;n.matrix?o.copy(n.matrix):o.identity(),o.elements[6]+=r.x,o.elements[7]+=r.y,o.elements[0]*=i.x,o.elements[3]*=i.x,o.elements[1]*=i.y,o.elements[4]*=i.y}else e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}t.alphaMap&&n(e,e.texMatrixAlpha,t.alphaMap);var r,i;t.normalMap?r=t.normalMap:t.bumpMap&&(r=t.bumpMap);void 0!==r&&n(e,e.texMatrixBump,r);t.map?i=t.map:t.specularMap&&(i=t.specularMap);void 0!==i&&n(e,e.texMatrix,i);e.envMap.value=t.envMap,e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap);e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(p,r),Tt(p,r)),r instanceof a.PointCloudMaterial?function(e,t){St(e,t),e.point_size.value=t.size}(p,r):r instanceof a.LineBasicMaterial?St(p,r):r instanceof a.LineDashedMaterial?(St(p,r),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(p,r)):r instanceof a.MeshPhongMaterial?function(e,t){if(e.shininess.value=t.shininess,e.reflMipIndex){var n=Math.log(Math.max(1+1e-10,t.shininess));e.reflMipIndex.value=Math.max(0,-.72134752*n+5.5)}e.emissive&&e.emissive.value.copy(t.emissive);e.specular.value.copy(t.specular),e.exposureBias&&(e.exposureBias.value=t.exposureBias)}(p,r):r instanceof a.MeshLambertMaterial?function(e,t){e.emissive.value.copy(t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(p,r):r instanceof a.MeshDepthMaterial?(p.mNear.value=e.near,p.mFar.value=e.far,p.opacity.value=r.opacity):r instanceof a.MeshNormalMaterial?p.opacity.value=r.opacity:r.isPrismMaterial&&(!function(e,t){function n(e,t,n){e[n].value=t[n],null!=t[n]&&(e[n+"_texMatrix"].value=t[n].matrix,e[n+"_invert"].value=t[n].invert)}function r(e,t,n){e[n].value=t[n],null!=t[n]&&(e[n+"_texMatrix"].value=t[n].matrix,e[n+"_bumpScale"].value=t[n].bumpScale,e[n+"_bumpmapType"].value=t[n].bumpmapType)}switch(e.exposureBias.value=t.exposureBias,e.opacity.value=t.opacity,e.surface_albedo.value=t.surface_albedo,e.surface_roughness.value=t.surface_roughness,e.surface_anisotropy.value=t.surface_anisotropy,e.surface_rotation.value=t.surface_rotation,n(e,t,"surface_albedo_map"),n(e,t,"surface_roughness_map"),n(e,t,"surface_cutout_map"),n(e,t,"surface_anisotropy_map"),n(e,t,"surface_rotation_map"),r(e,t,"surface_normal_map"),t.prismType){case"PrismOpaque":e.opaque_albedo.value=t.opaque_albedo,e.opaque_luminance_modifier.value=t.opaque_luminance_modifier,e.opaque_f0.value=t.opaque_f0,e.opaque_luminance.value=t.opaque_luminance,n(e,t,"opaque_albedo_map"),n(e,t,"opaque_luminance_modifier_map"),n(e,t,"opaque_f0_map");break;case"PrismMetal":e.metal_f0.value=t.metal_f0,n(e,t,"metal_f0_map");break;case"PrismLayered":e.layered_f0.value=t.layered_f0,e.layered_diffuse.value=t.layered_diffuse,e.layered_fraction.value=t.layered_fraction,e.layered_bottom_f0.value=t.layered_bottom_f0,e.layered_roughness.value=t.layered_roughness,e.layered_anisotropy.value=t.layered_anisotropy,e.layered_rotation.value=t.layered_rotation,n(e,t,"layered_bottom_f0_map"),n(e,t,"layered_f0_map"),n(e,t,"layered_diffuse_map"),n(e,t,"layered_fraction_map"),n(e,t,"layered_roughness_map"),n(e,t,"layered_anisotropy_map"),n(e,t,"layered_rotation_map"),r(e,t,"layered_normal_map");break;case"PrismTransparent":e.transparent_color.value=t.transparent_color,e.transparent_distance.value=t.transparent_distance,e.transparent_ior.value=t.transparent_ior;break;case"PrismGlazing":e.glazing_f0.value=t.glazing_f0,e.glazing_transmission_color.value=t.glazing_transmission_color,e.glazing_transmission_roughness.value=t.glazing_transmission_roughness,n(e,t,"glazing_f0_map"),n(e,t,"glazing_transmission_color_map"),n(e,t,"glazing_transmission_roughness_map");break;case"PrismWood":e.wood_fiber_cosine_enable.value=t.wood_fiber_cosine_enable,e.wood_fiber_cosine_bands.value=t.wood_fiber_cosine_bands,e.wood_fiber_cosine_weights.value=t.wood_fiber_cosine_weights,e.wood_fiber_cosine_frequencies.value=t.wood_fiber_cosine_frequencies,e.wood_fiber_perlin_enable.value=t.wood_fiber_perlin_enable,e.wood_fiber_perlin_bands.value=t.wood_fiber_perlin_bands,e.wood_fiber_perlin_weights.value=t.wood_fiber_perlin_weights,e.wood_fiber_perlin_frequencies.value=t.wood_fiber_perlin_frequencies,e.wood_fiber_perlin_scale_z.value=t.wood_fiber_perlin_scale_z,e.wood_growth_perlin_enable.value=t.wood_growth_perlin_enable,e.wood_growth_perlin_bands.value=t.wood_growth_perlin_bands,e.wood_growth_perlin_weights.value=t.wood_growth_perlin_weights,e.wood_growth_perlin_frequencies.value=t.wood_growth_perlin_frequencies,e.wood_latewood_ratio.value=t.wood_latewood_ratio,e.wood_earlywood_sharpness.value=t.wood_earlywood_sharpness,e.wood_latewood_sharpness.value=t.wood_latewood_sharpness,e.wood_ring_thickness.value=t.wood_ring_thickness,e.wood_earlycolor_perlin_enable.value=t.wood_earlycolor_perlin_enable,e.wood_earlycolor_perlin_bands.value=t.wood_earlycolor_perlin_bands,e.wood_earlycolor_perlin_weights.value=t.wood_earlycolor_perlin_weights,e.wood_earlycolor_perlin_frequencies.value=t.wood_earlycolor_perlin_frequencies,e.wood_early_color.value=t.wood_early_color,e.wood_use_manual_late_color.value=t.wood_use_manual_late_color,e.wood_manual_late_color.value=t.wood_manual_late_color,e.wood_latecolor_perlin_enable.value=t.wood_latecolor_perlin_enable,e.wood_latecolor_perlin_bands.value=t.wood_latecolor_perlin_bands,e.wood_latecolor_perlin_weights.value=t.wood_latecolor_perlin_weights,e.wood_latecolor_perlin_frequencies.value=t.wood_latecolor_perlin_frequencies,e.wood_late_color_power.value=t.wood_late_color_power,e.wood_diffuse_perlin_enable.value=t.wood_diffuse_perlin_enable,e.wood_diffuse_perlin_bands.value=t.wood_diffuse_perlin_bands,e.wood_diffuse_perlin_weights.value=t.wood_diffuse_perlin_weights,e.wood_diffuse_perlin_frequencies.value=t.wood_diffuse_perlin_frequencies,e.wood_diffuse_perlin_scale_z.value=t.wood_diffuse_perlin_scale_z,e.wood_use_pores.value=t.wood_use_pores,e.wood_pore_type.value=t.wood_pore_type,e.wood_pore_radius.value=t.wood_pore_radius,e.wood_pore_cell_dim.value=t.wood_pore_cell_dim,e.wood_pore_color_power.value=t.wood_pore_color_power,e.wood_pore_depth.value=t.wood_pore_depth,e.wood_use_rays.value=t.wood_use_rays,e.wood_ray_color_power.value=t.wood_ray_color_power,e.wood_ray_seg_length_z.value=t.wood_ray_seg_length_z,e.wood_ray_num_slices.value=t.wood_ray_num_slices,e.wood_ray_ellipse_z2x.value=t.wood_ray_ellipse_z2x,e.wood_ray_ellipse_radius_x.value=t.wood_ray_ellipse_radius_x,e.wood_use_latewood_bump.value=t.wood_use_latewood_bump,e.wood_latewood_bump_depth.value=t.wood_latewood_bump_depth,e.wood_use_groove_roughness.value=t.wood_use_groove_roughness,e.wood_groove_roughness.value=t.wood_groove_roughness,e.wood_diffuse_lobe_weight.value=t.wood_diffuse_lobe_weight,n(e,t,"wood_curly_distortion_map"),null!=e.wood_curly_distortion_map.value&&(e.wood_curly_distortion_map.value.minFilter=a.NearestFilter,e.wood_curly_distortion_map.value.magFilter=a.NearestFilter,e.wood_curly_distortion_enable.value=t.wood_curly_distortion_enable,e.wood_curly_distortion_scale.value=t.wood_curly_distortion_scale);var i=1-t.wood_latewood_ratio,o=t.wood_earlywood_sharpness*i,s=t.wood_latewood_sharpness*t.wood_latewood_ratio,l=i+s;e.wood_ring_fraction.value=new a.Vector4(i,o,s,l),e.wood_fall_rise.value=new a.Vector2(i-o,t.wood_latewood_ratio-s);break;default:a.warn("Unknown prism type: "+t.prismType)}t.useTiling&&(e.tilingOverallTransform.value=t.tilingOverallTransform,e.TilingMap.value=t.TilingMap,e.TilingMap_texMatrix.value=t.TilingMap_texMatrix,t.hasRoundCorner&&(e.TilingNormalMap.value=t.TilingNormalMap,e.TilingNormalMap_texMatrix.value=t.TilingNormalMap_texMatrix),t.useRandomOffset&&(e.TilingRandomMap.value=t.TilingRandomMap,e.TilingRandomMap_texMatrix.value=t.TilingRandomMap_texMatrix,e.tilingRandomAxisS.value=t.tilingRandomAxisS,e.tilingRandomAxisT.value=t.tilingRandomAxisT,e.tilingRandomAlignmentOffset.value=t.tilingRandomAlignmentOffset),e.uv2tile.value=t.uv2tile,e.tile2uv.value=t.tile2uv,e.tileAlignOffset.value=t.tileAlignOffset,e.tilingUVTransform.value=t.tilingUVTransform);e.envExponentMin.value=t.envExponentMin,e.envExponentMax.value=t.envExponentMax,e.envExponentCount.value=t.envExponentCount}(p,r),Tt(p,r)),r.wideLines){var y=o.geometry.lineWidth;void 0!==r.linewidth&&(y=r.linewidth),p.view_size.value=new a.Vector2(u.innerWidth/y,u.innerHeight/y)}i.ShadowRender&&r.shadowMap&&i.ShadowRender.RefreshUniformsShadow(p,r);var b=p.cutplanes;r.cutplanes&&r.cutplanes.length>0&&b&&(b.value=r.cutplanes,b._array&&b._array.length!=4*r.cutplanes&&(b._array=void 0)),r.hatchParams&&p.hatchParams&&(p.hatchParams.value.copy(r.hatchParams),p.hatchTintColor.value.copy(r.hatchTintColor),p.hatchTintIntensity.value=r.hatchTintIntensity),function(e){for(var t,n,r,i=0,o=e.length;i<o;i++){var s=e[i][0];if(!1!==s.needsUpdate&&!s.perObject){var l,c,u=s.type,d=s.value,h=e[i][1];switch(u){case"1i":P.uniform1i(h,d);break;case"1f":P.uniform1f(h,d);break;case"2f":P.uniform2f(h,d[0],d[1]);break;case"3f":P.uniform3f(h,d[0],d[1],d[2]);break;case"4f":P.uniform4f(h,d[0],d[1],d[2],d[3]);break;case"1iv":P.uniform1iv(h,d);break;case"3iv":P.uniform3iv(h,d);break;case"1fv":P.uniform1fv(h,d);break;case"2fv":P.uniform2fv(h,d);break;case"3fv":P.uniform3fv(h,d);break;case"4fv":P.uniform4fv(h,d);break;case"Matrix3fv":P.uniformMatrix3fv(h,!1,d);break;case"Matrix4fv":P.uniformMatrix4fv(h,!1,d);break;case"i":P.uniform1i(h,d);break;case"f":P.uniform1f(h,d);break;case"v2":P.uniform2f(h,d.x,d.y);break;case"v3":P.uniform3f(h,d.x,d.y,d.z);break;case"v4":P.uniform4f(h,d.x,d.y,d.z,d.w);break;case"c":P.uniform3f(h,d.r,d.g,d.b);break;case"iv1":P.uniform1iv(h,d);break;case"iv":P.uniform3iv(h,d);break;case"fv1":P.uniform1fv(h,d);break;case"fv":P.uniform3fv(h,d);break;case"v2v":for(void 0===s._array&&(s._array=new Float32Array(2*d.length)),l=0,c=d.length;l<c;l++)r=2*l,s._array[r]=d[l].x,s._array[r+1]=d[l].y;P.uniform2fv(h,s._array);break;case"v3v":for(void 0===s._array&&(s._array=new Float32Array(3*d.length)),l=0,c=d.length;l<c;l++)r=3*l,s._array[r]=d[l].x,s._array[r+1]=d[l].y,s._array[r+2]=d[l].z;P.uniform3fv(h,s._array);break;case"v4v":for(void 0===s._array&&(s._array=new Float32Array(4*d.length)),l=0,c=d.length;l<c;l++)r=4*l,s._array[r]=d[l].x,s._array[r+1]=d[l].y,s._array[r+2]=d[l].z,s._array[r+3]=d[l].w;P.uniform4fv(h,s._array);break;case"m3":P.uniformMatrix3fv(h,!1,d.elements);break;case"m3v":for(void 0===s._array&&(s._array=new Float32Array(9*d.length)),l=0,c=d.length;l<c;l++)d[l].flattenToArrayOffset(s._array,9*l);P.uniformMatrix3fv(h,!1,s._array);break;case"m4":P.uniformMatrix4fv(h,!1,d.elements);break;case"m4v":for(void 0===s._array&&(s._array=new Float32Array(16*d.length)),l=0,c=d.length;l<c;l++)d[l].flattenToArrayOffset(s._array,16*l);P.uniformMatrix4fv(h,!1,s._array);break;case"t":if(t=d,n=Lt(),P.uniform1i(h,n),!t){P.activeTexture(P.TEXTURE0+n),P.bindTexture(P.TEXTURE_2D,be.__webglTexture);continue}Array.isArray(t.image)&&6===t.image.length||t instanceof a.CubeTexture?t.needsUpdate?Ot(t,n):(P.activeTexture(P.TEXTURE0+n),P.bindTexture(P.TEXTURE_CUBE_MAP,t.__webglTextureCube)):t instanceof a.WebGLRenderTargetCube?Nt(t,n):j.setTexture(t,n);break;case"tv":for(void 0===s._array&&(s._array=[]),l=0,c=s.value.length;l<c;l++)s._array[l]=Lt();for(P.uniform1iv(h,s._array),l=0,c=s.value.length;l<c;l++)t=s.value[l],n=s._array[l],t&&j.setTexture(t,n);break;default:a.warn("THREE.WebGLRenderer: Unknown uniform type: "+u)}}}}(r.uniformsList)}if(function(e,t,n){M.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),P.uniformMatrix4fv(e.modelViewMatrix,!1,M.elements),e.normalMatrix&&(S.getNormalMatrix(M),P.uniformMatrix3fv(e.normalMatrix,!1,S.elements))}(f,o,e),null!==f.modelMatrix&&P.uniformMatrix4fv(f.modelMatrix,!1,o.matrixWorld.elements),f.modelId){f.dbId&&(d=o.dbId||o.fragId||0,P.uniform3f(f.dbId,(255&d)/255,(d>>8&255)/255,(d>>16&255)/255));var x=o.modelId;P.uniform3f(f.modelId,(255&x)/255,(x>>8&255)/255,(d>>24&255)/255)}else null!==f.dbId&&(d=o.dbId||o.fragId||0,P.uniform3f(f.dbId,(255&d)/255,(d>>8&255)/255,(d>>16&255)/255));if(f.themingColor){var w=o.themingColor;w instanceof a.Vector4?P.uniform4f(f.themingColor,w.x,w.y,w.z,w.w):P.uniform4f(f.themingColor,0,0,0,0)}return h}function St(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Tt(e,t){e.envMap&&(e.envMap.value=t.envMap),e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap),e.envMapExposure&&(e.envMapExposure.value=t.envMapExposure),e.envRotationSin&&e.envRotationCos&&(e.envRotationSin.value=t.envRotationSin,e.envRotationCos.value=t.envRotationCos)}function Ct(e,t){e.envMap&&(e.envMap.needsUpdate=t),e.irradianceMap&&(e.irradianceMap.needsUpdate=t),e.envMapExposure&&(e.envMapExposure.needsUpdate=t)}function Pt(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Lt(){var e=H;return e>=ce&&a.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ce),H+=1,e}function Dt(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function Rt(e){var t,n,r,i,o,s,l,c,u=0,d=0,h=0,f=ne,p=f.directional.colors,m=f.directional.positions,g=f.point.colors,v=f.point.positions,y=f.point.distances,_=f.spot.colors,b=f.spot.positions,x=f.spot.distances,w=f.spot.directions,E=f.spot.anglesCos,A=f.spot.exponents,M=f.hemi.skyColors,S=f.hemi.groundColors,T=f.hemi.positions,C=0,P=0,L=0,D=0,R=0,I=0,j=0,O=0,N=0,k=0,F=0,V=0;for(t=0,n=e.length;t<n;t++)if(!(r=e[t]).onlyShadow)if(i=r.color,l=r.intensity,c=r.distance,r instanceof a.AmbientLight){if(!r.visible)continue;u+=i.r,d+=i.g,h+=i.b}else if(r instanceof a.DirectionalLight){if(R+=1,!r.visible)continue;ee.setFromMatrixPosition(r.matrixWorld),$.setFromMatrixPosition(r.target.matrixWorld),ee.sub($),ee.normalize(),m[N=3*C]=ee.x,m[N+1]=ee.y,m[N+2]=ee.z,Dt(p,N,i,l),C+=1}else if(r instanceof a.PointLight){if(I+=1,!r.visible)continue;Dt(g,k=3*P,i,l),$.setFromMatrixPosition(r.matrixWorld),v[k]=$.x,v[k+1]=$.y,v[k+2]=$.z,y[P]=c,P+=1}else if(r instanceof a.SpotLight){if(j+=1,!r.visible)continue;Dt(_,F=3*L,i,l),$.setFromMatrixPosition(r.matrixWorld),b[F]=$.x,b[F+1]=$.y,b[F+2]=$.z,x[L]=c,ee.copy($),$.setFromMatrixPosition(r.target.matrixWorld),ee.sub($),ee.normalize(),w[F]=ee.x,w[F+1]=ee.y,w[F+2]=ee.z,E[L]=Math.cos(r.angle),A[L]=r.exponent,L+=1}else if(r instanceof a.HemisphereLight){if(O+=1,!r.visible)continue;ee.setFromMatrixPosition(r.matrixWorld),ee.normalize(),T[V=3*D]=ee.x,T[V+1]=ee.y,T[V+2]=ee.z,o=r.color,s=r.groundColor,Dt(M,V,o,l),Dt(S,V,s,l),D+=1}for(t=3*C,n=Math.max(p.length,3*R);t<n;t++)p[t]=0;for(t=3*P,n=Math.max(g.length,3*I);t<n;t++)g[t]=0;for(t=3*L,n=Math.max(_.length,3*j);t<n;t++)_[t]=0;for(t=3*D,n=Math.max(M.length,3*O);t<n;t++)M[t]=0;for(t=3*D,n=Math.max(S.length,3*O);t<n;t++)S[t]=0;f.directional.length=C,f.point.length=P,f.spot.length=L,f.hemi.length=D,f.ambient[0]=u,f.ambient[1]=d,f.ambient[2]=h}function It(e,t,n){var r;n?(P.texParameteri(e,P.TEXTURE_WRAP_S,Vt(t.wrapS)),P.texParameteri(e,P.TEXTURE_WRAP_T,Vt(t.wrapT)),P.texParameteri(e,P.TEXTURE_MAG_FILTER,Vt(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,Vt(t.minFilter))):(P.texParameteri(e,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(e,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),t.wrapS===a.ClampToEdgeWrapping&&t.wrapT===a.ClampToEdgeWrapping||a.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),P.texParameteri(e,P.TEXTURE_MAG_FILTER,kt(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,kt(t.minFilter)),t.minFilter!==a.NearestFilter&&t.minFilter!==a.LinearFilter&&a.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(r=oe.get("EXT_texture_filter_anisotropic"))&&t.type!==a.FloatType&&t.type!==a.HalfFloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(P.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,j.getMaxAnisotropy())),t.__oldAnisotropy=t.anisotropy)}function jt(e,t){if(e.width<=t&&e.height<=t)return e;var n=Math.max(e.width,e.height),r=Math.floor(e.width*t/n),i=Math.floor(e.height*t/n),o=d.createElement("canvas");return o.width=r,o.height=i,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r,i),o}function Ot(e,t){if(6===e.image.length)if(e.needsUpdate){e.__webglTextureCube||(e.addEventListener("dispose",De),e.__webglTextureCube=P.createTexture(),j.info.memory.textures++),P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTextureCube),P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,e.flipY);var n,r=e instanceof a.CompressedTexture,i=e.image[0]instanceof a.DataTexture,o=[];for(n=0;n<6;n++)!j.autoScaleCubemaps||r||i?o[n]=i?e.image[n].image:e.image[n]:o[n]=jt(e.image[n],he);var s=o[0],l=a.Math.isPowerOfTwo(s.width)&&a.Math.isPowerOfTwo(s.height),c=Vt(e.format),u=Vt(e.type);for(It(P.TEXTURE_CUBE_MAP,e,l),n=0;n<6;n++)if(r)for(var d,h=o[n].mipmaps,f=0,p=h.length;f<p;f++)d=h[f],e.format!==a.RGBAFormat&&e.format!==a.RGBFormat?Ee().indexOf(c)>-1?P.compressedTexImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,f,c,d.width,d.height,0,d.data):a.warn("Attempt to load unsupported compressed texture format"):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,f,c,d.width,d.height,0,c,u,d.data);else i?P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,c,o[n].width,o[n].height,0,c,u,o[n].data):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,c,c,u,o[n]);e.generateMipmaps&&l&&P.generateMipmap(P.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTextureCube)}function Nt(e,t){P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTexture)}function kt(e){return e===a.NearestFilter||e===a.NearestMipMapNearestFilter||e===a.NearestMipMapLinearFilter?P.NEAREST:P.LINEAR}function Ft(e,t){if(L){if(e===a.RGBFormat)switch(t){case a.UnsignedByteType:return P.RGB8;case a.FloatType:return P.RGB32F;case a.HalfFloatType:return P.RGB16F}else if(e===a.RGBAFormat)switch(t){case a.UnsignedByteType:return P.RGBA8;case a.FloatType:return P.RGBA32F;case a.HalfFloatType:return P.RGBA16F}console.error("failed to map texture format and type to internalformat")}return Vt(e)}function Vt(e){var t;if(e===a.RepeatWrapping)return P.REPEAT;if(e===a.ClampToEdgeWrapping)return P.CLAMP_TO_EDGE;if(e===a.MirroredRepeatWrapping)return P.MIRRORED_REPEAT;if(e===a.NearestFilter)return P.NEAREST;if(e===a.NearestMipMapNearestFilter)return P.NEAREST_MIPMAP_NEAREST;if(e===a.NearestMipMapLinearFilter)return P.NEAREST_MIPMAP_LINEAR;if(e===a.LinearFilter)return P.LINEAR;if(e===a.LinearMipMapNearestFilter)return P.LINEAR_MIPMAP_NEAREST;if(e===a.LinearMipMapLinearFilter)return P.LINEAR_MIPMAP_LINEAR;if(e===a.UnsignedByteType)return P.UNSIGNED_BYTE;if(e===a.UnsignedShort4444Type)return P.UNSIGNED_SHORT_4_4_4_4;if(e===a.UnsignedShort5551Type)return P.UNSIGNED_SHORT_5_5_5_1;if(e===a.UnsignedShort565Type)return P.UNSIGNED_SHORT_5_6_5;if(e===a.ByteType)return P.BYTE;if(e===a.ShortType)return P.SHORT;if(e===a.UnsignedShortType)return P.UNSIGNED_SHORT;if(e===a.IntType)return P.INT;if(e===a.UnsignedIntType)return P.UNSIGNED_INT;if(e===a.FloatType)return P.FLOAT;if(e===a.HalfFloatType)return L?P.HALF_FLOAT:36193;if(e===a.AlphaFormat)return P.ALPHA;if(e===a.RGBFormat)return P.RGB;if(e===a.RGBAFormat)return P.RGBA;if(e===a.LuminanceFormat)return P.LUMINANCE;if(e===a.LuminanceAlphaFormat)return P.LUMINANCE_ALPHA;if(e===a.AddEquation)return P.FUNC_ADD;if(e===a.SubtractEquation)return P.FUNC_SUBTRACT;if(e===a.ReverseSubtractEquation)return P.FUNC_REVERSE_SUBTRACT;if(e===a.ZeroFactor)return P.ZERO;if(e===a.OneFactor)return P.ONE;if(e===a.SrcColorFactor)return P.SRC_COLOR;if(e===a.OneMinusSrcColorFactor)return P.ONE_MINUS_SRC_COLOR;if(e===a.SrcAlphaFactor)return P.SRC_ALPHA;if(e===a.OneMinusSrcAlphaFactor)return P.ONE_MINUS_SRC_ALPHA;if(e===a.DstAlphaFactor)return P.DST_ALPHA;if(e===a.OneMinusDstAlphaFactor)return P.ONE_MINUS_DST_ALPHA;if(e===a.DstColorFactor)return P.DST_COLOR;if(e===a.OneMinusDstColorFactor)return P.ONE_MINUS_DST_COLOR;if(e===a.SrcAlphaSaturateFactor)return P.SRC_ALPHA_SATURATE;if(null!==(t=oe.get("WEBGL_compressed_texture_s3tc"))){if(e===a.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===a.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===a.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===a.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=oe.get("WEBGL_compressed_texture_pvrtc"))){if(e===a.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===a.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===a.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===a.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=oe.get("EXT_blend_minmax"))){if(e===a.MinEquation)return t.MIN_EXT;if(e===a.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===a.CullFaceNone?P.disable(P.CULL_FACE):(t===a.FrontFaceDirectionCW?P.frontFace(P.CW):P.frontFace(P.CCW),e===a.CullFaceBack?P.cullFace(P.BACK):e===a.CullFaceFront?P.cullFace(P.FRONT):P.cullFace(P.FRONT_AND_BACK),P.enable(P.CULL_FACE))},this.setMaterialFaces=function(e){ie.setDoubleSided(e.side===a.DoubleSide),ie.setFlipSided(e.side===a.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",De),e.__webglTexture=P.createTexture(),j.info.memory.textures++),P.bindTexture(P.TEXTURE_2D,e.__webglTexture),P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,e.flipY),P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),P.pixelStorei(P.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=jt(e.image,de);var t=e.image,n=a.Math.isPowerOfTwo(t.width)&&a.Math.isPowerOfTwo(t.height),r=Vt(e.format),i=Vt(e.type),o=Ft(e.format,e.type);It(P.TEXTURE_2D,e,n);var s,l,c,u=e.mipmaps;if(e instanceof a.DataTexture)if(u.length>0&&n){for(l=0,c=u.length;l<c;l++)s=u[l],P.texImage2D(P.TEXTURE_2D,l,o,s.width,s.height,0,r,i,s.data);e.generateMipmaps=!1}else P.texImage2D(P.TEXTURE_2D,0,o,t.width,t.height,0,r,i,t.data);else if(e instanceof a.CompressedTexture){for(l=0,c=u.length;l<c;l++)s=u[l],e.format!==a.RGBAFormat&&e.format!==a.RGBFormat?Ee().indexOf(r)>-1?P.compressedTexImage2D(P.TEXTURE_2D,l,o,s.width,s.height,0,s.data):a.warn("Attempt to load unsupported compressed texture format"):P.texImage2D(P.TEXTURE_2D,l,o,s.width,s.height,0,r,i,s.data);if(u.length>1&&Ee().indexOf(r)>-1)for(var d,h=s.width>>1,f=s.height>>1,p=u.length;h>=1||f>=1;)d=4==s.width&&4==s.height?s.data:new DataView(s.data.buffer,s.data.byteOffset,s.data.byteLength*(Math.max(h,4)*Math.max(f,4))/(s.width*s.height)),P.compressedTexImage2D(P.TEXTURE_2D,p,o,Math.max(h,1),Math.max(f,1),0,d),h>>=1,f>>=1,++p}else if(u.length>0&&n){for(l=0,c=u.length;l<c;l++)P.texImage2D(P.TEXTURE_2D,l,o,r,i,u[l]);e.generateMipmaps=!1}else P.texImage2D(P.TEXTURE_2D,0,o,r,i,e.image);e.generateMipmaps&&n&&P.generateMipmap(P.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){P.activeTexture(P.TEXTURE0+t),e.needsUpdate?j.uploadTexture(e):e.__webglTexture?P.bindTexture(P.TEXTURE_2D,e.__webglTexture):P.bindTexture(P.TEXTURE_2D,be.__webglTexture)},j.uploadTexture(be),this.initFrameBufferMRT=function(e,t){var n,r=e[0],i=!1;r&&!r.__webglFramebuffer&&(void 0===r.depthBuffer&&(r.depthBuffer=!0),void 0===r.stencilBuffer&&(r.stencilBuffer=!0),r.__webglFramebuffer=P.createFramebuffer(),P.bindFramebuffer(P.FRAMEBUFFER,r.__webglFramebuffer),r.shareDepthFrom?n=r.__webglRenderbuffer=r.shareDepthFrom.__webglRenderbuffer:(n=r.__webglRenderbuffer,r.depthBuffer&&!r.stencilBuffer?(n||(n=r.__webglRenderbuffer=P.createRenderbuffer()),P.bindRenderbuffer(P.RENDERBUFFER,n),P.renderbufferStorage(P.RENDERBUFFER,L?P.DEPTH_COMPONENT32F:P.DEPTH_COMPONENT16,r.width,r.height)):r.depthBuffer&&r.stencilBuffer&&(n||(n=r.__webglRenderbuffer=P.createRenderbuffer()),P.bindRenderbuffer(P.RENDERBUFFER,n),P.renderbufferStorage(P.RENDERBUFFER,L?P.DEPTH24_STENCIL8:P.DEPTH_STENCIL,r.width,r.height))),r.depthBuffer&&!r.stencilBuffer?P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_ATTACHMENT,P.RENDERBUFFER,n):r.depthBuffer&&r.stencilBuffer&&P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_STENCIL_ATTACHMENT,P.RENDERBUFFER,n),i=!0);var o,s=k;for(P.bindFramebuffer(P.FRAMEBUFFER,r.__webglFramebuffer),o=0;o<e.length;o++){var l=e[o];if(l&&!l.__webglTexture){var c=a.Math.isPowerOfTwo(l.width)&&a.Math.isPowerOfTwo(l.height),u=Vt(l.format),d=Vt(l.type),h=Ft(l.format,l.type);l.addEventListener("dispose",Re),l.__webglTexture=P.createTexture(),j.info.memory.textures++,P.bindTexture(P.TEXTURE_2D,l.__webglTexture),It(P.TEXTURE_2D,l,c),P.texImage2D(P.TEXTURE_2D,0,h,l.width,l.height,0,u,d,null),c&&l.generateMipmaps&&P.generateMipmap(P.TEXTURE_2D)}P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0+o,P.TEXTURE_2D,l&&l.__webglTexture,0)}if(this.supportsMRT()&&function(e){for(var t=L?P.getParameter(P.MAX_COLOR_ATTACHMENTS):P.getParameter(D.MAX_COLOR_ATTACHMENTS_WEBGL),n=L?P.COLOR_ATTACHMENT0:D.COLOR_ATTACHMENT0_WEBGL,r=e.length;r<t;)P.framebufferTexture2D(P.FRAMEBUFFER,n+r,P.TEXTURE_2D,null,0),r++;var i=[n];for(r=1;r<e.length;r++)i.push(n+r);L?P.drawBuffers(i):D.drawBuffersWEBGL(i)}(e),t){var f=P.checkFramebufferStatus(P.FRAMEBUFFER);f!==P.FRAMEBUFFER_COMPLETE&&(a.log("Can't use multiple render targets. Falling back to two passes. "+f),s===r.__webglFramebuffer&&(s=k=null),P.bindFramebuffer(P.FRAMEBUFFER,s),P.deleteFramebuffer(r.__webglFramebuffer),delete r.__webglFramebuffer,t=!1)}return P.bindFramebuffer(P.FRAMEBUFFER,s),i&&(P.bindTexture(P.TEXTURE_2D,null),P.bindRenderbuffer(P.RENDERBUFFER,null),P.bindFramebuffer(P.FRAMEBUFFER,null)),t},this.setRenderTarget=function(e){var t,n,r,i,o,s;if(Array.isArray(e))this.initFrameBufferMRT(e),(t=e[0]).initForMRT=!0;else if(e){var a=e.__webglFramebuffer;a&&k===a&&!e.initForMRT||this.initFrameBufferMRT([e]),(t=e).initForMRT=!1}!t||Se?(r=q,i=Y,o=W,s=X):(r=t.width,i=t.height,o=0,s=0),(n=t?t.__webglFramebuffer:null)!==k&&(P.bindFramebuffer(P.FRAMEBUFFER,n),P.viewport(o,s,r,i),k=n)},this.verifyMRTWorks=function(e){return!!this.supportsMRT()&&this.initFrameBufferMRT(e,!0)},this.readRenderTargetPixels=function(e,t,n,r,i,o){if(e instanceof a.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==a.RGBAFormat&&e.format!==a.RGBFormat||e.type!==a.UnsignedByteType)return void a.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not a readable format.");var s=!1;e.__webglFramebuffer!==k&&(P.bindFramebuffer(P.FRAMEBUFFER,e.__webglFramebuffer),s=!0),e.canReadPixels||P.checkFramebufferStatus(P.FRAMEBUFFER)===P.FRAMEBUFFER_COMPLETE?P.readPixels(t,n,r,i,P.RGBA,P.UNSIGNED_BYTE,o):a.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&P.bindFramebuffer(P.FRAMEBUFFER,k)}}else a.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}},"./src/wgs/render/WebGLShader.js":
/*!***************************************!*\
  !*** ./src/wgs/render/WebGLShader.js ***!
  \***************************************/
/*! exports provided: WebGLShader */function(e,t,n){"use strict";n.r(t),n.d(t,"WebGLShader",(function(){return i}));var r=n(/*! three */"./thirdparty/three.js/three.js");function i(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===e.getShaderParameter(i,e.COMPILE_STATUS)&&r.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&r.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(i),function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n))),i}},"./src/wgs/render/chunks/cutplanes.glsl":
/*!**********************************************!*\
  !*** ./src/wgs/render/chunks/cutplanes.glsl ***!
  \**********************************************/
/*! no static exports found */function(e,t){e.exports="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\nvoid checkCutPlanes(vec3 worldPosition) {\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n#endif\n"},"./src/wgs/render/chunks/decl_point_size.glsl":
/*!****************************************************!*\
  !*** ./src/wgs/render/chunks/decl_point_size.glsl ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports="uniform float point_size;"},"./src/wgs/render/chunks/depth_texture.glsl":
/*!**************************************************!*\
  !*** ./src/wgs/render/chunks/depth_texture.glsl ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture2D(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n"},"./src/wgs/render/chunks/env_sample.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/chunks/env_sample.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="\nuniform float envRotationSin;\nuniform float envRotationCos;\nvec3 adjustLookupVector(in vec3 lookup) {\n    return vec3(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    ret *= exposure;\n    return ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\nvec3 sampleIrradianceMap(vec3 dirWorld, samplerCube irrMap, float exposure) {\n    vec4 cubeColor4 = textureCube(irrMap, adjustLookupVector(dirWorld));\n#ifdef IRR_GAMMA\n    vec3 indirectDiffuse = GammaDecode(cubeColor4, exposure);\n#elif defined(IRR_RGBM)\n    vec3 indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n#else\n    vec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\n    indirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\n    return indirectDiffuse;\n}\n"},"./src/wgs/render/chunks/final_frag.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/chunks/final_frag.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="#ifdef HATCH_PATTERN\ngl_FragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, gl_FragColor, hatchTintColor, hatchTintIntensity);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef MRT_NORMALS\noutNormal = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#include<id_frag>\n"},"./src/wgs/render/chunks/float3_average.glsl":
/*!***************************************************!*\
  !*** ./src/wgs/render/chunks/float3_average.glsl ***!
  \***************************************************/
/*! no static exports found */function(e,t){e.exports="float averageOfFloat3(in vec3 value) { \n    const float oneThird = 1.0 / 3.0; \n    return dot(value, vec3(oneThird, oneThird, oneThird)); \n} \n"},"./src/wgs/render/chunks/hatch_pattern.glsl":
/*!**************************************************!*\
  !*** ./src/wgs/render/chunks/hatch_pattern.glsl ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports="#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nuniform vec3 hatchTintColor;\nuniform float hatchTintIntensity;\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 3.5;\n    return exp(-exponent*exponent);\n}\nvec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {\n    float hatchSlope = hatchParams.x;\n    float hatchPeriod = hatchParams.y;\n    if (abs(hatchSlope) <= 1.0) {\n        float hatchPhase = coord.y - hatchSlope * coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    } else {\n        float hatchPhase = - coord.y / hatchSlope + coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    }\n    return fragColor;\n}\n#endif\n"},"./src/wgs/render/chunks/hsv.glsl":
/*!****************************************!*\
  !*** ./src/wgs/render/chunks/hsv.glsl ***!
  \****************************************/
/*! no static exports found */function(e,t){e.exports="vec3 rgb2hsv(vec3 color)\n{\n    float delta;\n    float colorMax, colorMin;\n    float h,s,v;\n    vec3 hsv;\n    colorMax = max(color.r,color.g);\n    colorMax = max(colorMax,color.b);\n    colorMin = min(color.r,color.g);\n    colorMin = min(colorMin,color.b);\n    v = colorMax;\n    if(colorMax != 0.0)\n    {\n        s = (colorMax - colorMin)/colorMax;\n    }\n    else\n    {\n        s = 0.0;\n    }\n    if(s != 0.0)\n    {\n        delta = colorMax-colorMin;\n        if (color.r == colorMax)\n        {\n            h = (color.g-color.b)/delta;\n        }\n        else if (color.g == colorMax)\n        {\n            h = 2.0 + (color.b-color.r) / delta;\n        }\n        else\n        {\n            h = 4.0 + (color.r-color.g)/delta;\n        }\n        h /= 6.0;\n        if( h < 0.0)\n        {\n            h +=1.0;\n        }\n    }\n    else\n    {\n        h = 0.0;\n    }\n    hsv = vec3(h,s,v);\n    return hsv;\n}\nvec3 hsv2rgb(vec3 hsv)\n{\n    vec3 color;\n    float f,p,q,t;\n    float h,s,v;\n    float i,hi;\n    {\n        h = hsv.x*6.0;\n        s = hsv.y;\n        v = hsv.z;\n        i = floor(h);\n        f = h-i;\n        p = v * (1.0 - s);\n        q = v * (1.0 - (s * f));\n        t = v * (1.0 - (s * (1.0 - f)));\n        float r,g,b;\n        if (i == 0.0)\n        {\n            r = v;\n            g = t;\n            b = p;\n        }\n        else if (i == 1.0)\n        {\n            r = q;\n            g = v;\n            b = p;\n        }\n        else if (i == 2.0)\n        {\n            r = p;\n            g = v;\n            b = t;\n        }\n        else if (i == 3.0)\n        {\n            r = p;\n            g = q;\n            b = v;\n        }\n        else if (i == 4.0)\n        {\n            r = t;\n            g = p;\n            b = v;\n        }\n        else\n        {\n            r = v;\n            g = p;\n            b = q;\n        }\n        color = vec3(r,g,b);\n    }\n    return color;\n}"},"./src/wgs/render/chunks/id_decl_frag.glsl":
/*!*************************************************!*\
  !*** ./src/wgs/render/chunks/id_decl_frag.glsl ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports="#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\n    varying highp float depth;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\n    #ifdef USE_VERTEX_ID\n        varying vec3 vId;\n    #elif defined(LINE_2D_SHADER)\n        varying vec4 dbId;\n    #else\n        uniform vec3 dbId;\n    #endif\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\n    uniform vec3 modelId;\n#endif\n#ifdef _LMVWEBGL2_\n    #if defined(MRT_NORMALS)\n        layout(location = 1) out vec4 outNormal;\n        #if defined(MRT_ID_BUFFER)\n            layout(location = 2) out vec4 outId;\n            #if defined(MODEL_COLOR)\n                layout(location = 3) out vec4 outModelId;\n            #endif\n        #endif\n    #elif defined(MRT_ID_BUFFER)\n        layout(location = 1) out vec4 outId;\n        #if defined(MODEL_COLOR)\n            layout(location = 2) out vec4 outModelId;\n        #endif\n    #endif\n#else\n    #define gl_FragColor gl_FragData[0]\n    #if defined(MRT_NORMALS)\n        #define outNormal gl_FragData[1]\n        #if defined(MRT_ID_BUFFER)\n            #define outId gl_FragData[2]\n            #if defined(MODEL_COLOR)\n                #define outModelId gl_FragData[3]\n            #endif\n        #endif\n    #elif defined(MRT_ID_BUFFER)\n        #define outId gl_FragData[1]\n        #if defined(MODEL_COLOR)\n            #define outModelId gl_FragData[2]\n        #endif\n    #endif\n#endif"},"./src/wgs/render/chunks/id_decl_vert.glsl":
/*!*************************************************!*\
  !*** ./src/wgs/render/chunks/id_decl_vert.glsl ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports="#ifdef USE_VERTEX_ID\nattribute vec3 id;\nvarying   vec3 vId;\n#endif\n"},"./src/wgs/render/chunks/id_frag.glsl":
/*!********************************************!*\
  !*** ./src/wgs/render/chunks/id_frag.glsl ***!
  \********************************************/
/*! no static exports found */function(e,t){e.exports="\n#if defined(USE_VERTEX_ID) && (defined(MRT_ID_BUFFER) || defined(ID_COLOR))\n    vec3 dbId = vId;\n#endif\n#ifdef MRT_ID_BUFFER\n    #ifndef ENABLE_ID_DISCARD\n        const float writeId = 1.0;\n    #endif\n    outId = vec4(dbId.rgb, writeId);\n    #ifdef MODEL_COLOR\n        outModelId = vec4(modelId.rgb, writeId);\n    #endif\n#elif defined(ID_COLOR)\n    #ifdef ENABLE_ID_DISCARD\n        if (writeId==0.0) {\n            discard;\n        }\n    #endif\n    gl_FragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n    #ifdef ENABLE_ID_DISCARD\n        if (writeId==0.0) {\n            discard;\n        }\n    #endif\n    gl_FragColor = vec4(modelId.rgb, 1.0);\n#endif\n"},"./src/wgs/render/chunks/id_vert.glsl":
/*!********************************************!*\
  !*** ./src/wgs/render/chunks/id_vert.glsl ***!
  \********************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef USE_VERTEX_ID\nvId = id;\n#endif\n"},"./src/wgs/render/chunks/instancing_decl_vert.glsl":
/*!*********************************************************!*\
  !*** ./src/wgs/render/chunks/instancing_decl_vert.glsl ***!
  \*********************************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef USE_INSTANCING\nattribute vec3 instOffset;\nattribute vec4 instRotation;\nattribute vec3 instScaling;\nvec3 applyQuaternion(vec3 p, vec4 q) {\n    return p + 2.0 * cross(q.xyz, cross(q.xyz, p) + q.w * p);\n}\nvec3 getInstancePos(vec3 pos) {\n    return instOffset + applyQuaternion(instScaling * pos, instRotation);\n}\nvec3 getInstanceNormal(vec3 normal) {\n    return applyQuaternion(normal/instScaling, instRotation);\n}\n#else\nvec3 getInstancePos(vec3 pos)       { return pos;    }\nvec3 getInstanceNormal(vec3 normal) { return normal; }\n#endif\n"},"./src/wgs/render/chunks/line_decl_common.glsl":
/*!*****************************************************!*\
  !*** ./src/wgs/render/chunks/line_decl_common.glsl ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports="\n#define LINE_2D_SHADER 1\n#define TAU     6.28318530718\n#define PI      3.14159265358979\n#define HALF_PI 1.57079632679\n#define PI_0_5  HALF_PI\n#define PI_1_5  4.71238898038\n#define ENABLE_ID_DISCARD\n#define VBB_GT_TRIANGLE_INDEXED  0.0\n#define VBB_GT_LINE_SEGMENT      1.0\n#define VBB_GT_ARC_CIRCULAR      2.0\n#define VBB_GT_ARC_ELLIPTICAL    3.0\n#define VBB_GT_TEX_QUAD          4.0\n#define VBB_GT_ONE_TRIANGLE      5.0\n#define VBB_GT_MSDF_TRIANGLE_INDEXED 6.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  0.0\n#define VBB_SEG_START_LEFT   1.0\n#define VBB_SEG_END_RIGHT    2.0\n#define VBB_SEG_END_LEFT     3.0\n#define LTSCALE 0.25\nvarying vec4 fsColor;\nvarying vec2 fsOffsetDirection;\nvarying vec4 fsMultipurpose;\nvarying float fsHalfWidth;\nvarying vec2 fsVpTC;\nvarying float fsGhosting;\n"},"./src/wgs/render/chunks/normal_map.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/chunks/normal_map.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="#if defined(USE_SURFACE_NORMAL_MAP) || defined( USE_LAYERED_NORMAL_MAP ) || defined( USE_TILING_NORMAL )\nvoid heightMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    mat3 mtxTangent = mat3(T, B, N);\n    T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));\n    B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));\n    const float oneThird = 1.0 / 3.0;\n    vec3 avg = vec3(oneThird, oneThird, oneThird);\n    vec2 offset = fwidth(st);\n    float h0 = dot(texture2D(bumpTexture, st).xyz, avg);\n    float hx = dot(texture2D(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);\n    float hy = dot(texture2D(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);\n    vec2 diff = vec2(h0 - hx, h0 - hy) / offset;\n    N = normalize(\n        N + (\n            diff.x * T * bumpScale.x +\n            diff.y * B * bumpScale.y\n        )\n    );\n}\nvoid normalMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    vec3 mapN =  2.0 * texture2D(bumpTexture, st).xyz - 1.0;\n    mapN.xy *= bumpScale.x;\n    mapN.z *= bumpScale.y;\n    vec3 v = vec3(mapN.y, -mapN.x, 0.0);\n    float c = -mapN.z;\n    mat3 skewV = mat3(\n        0.0, v.z, -v.y,\n        -v.z, 0.0, v.x,\n        v.y, -v.x, 0.0\n    );\n    mat3 rot = mat3(1.0) + skewV + skewV*skewV * 1.0/(1.0-c);\n    N *= rot;\n    T *= rot;\n    B *= rot;\n}\n#endif\n"},"./src/wgs/render/chunks/ordered_dither.glsl":
/*!***************************************************!*\
  !*** ./src/wgs/render/chunks/ordered_dither.glsl ***!
  \***************************************************/
/*! no static exports found */function(e,t){e.exports="vec3 orderedDithering(vec3 col) {\n    const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\n    const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\n    const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\n    const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\n    int i = int(mod(float(gl_FragCoord.x), 4.0));\n    int j = int(mod(float(gl_FragCoord.y), 4.0));\n    vec4 biasRow;\n    if      (i==0) biasRow = m0;\n    else if (i==1) biasRow = m1;\n    else if (i==2) biasRow = m2;\n    else           biasRow = m3;\n    float bias;\n    if      (j==0) bias = biasRow.x;\n    else if (j==1) bias = biasRow.y;\n    else if (j==2) bias = biasRow.z;\n    else           bias = biasRow.w;\n    return col + bias / 17.0 / 256.0;\n}\n"},"./src/wgs/render/chunks/pack_depth.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/chunks/pack_depth.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n"},"./src/wgs/render/chunks/pack_normals.glsl":
/*!*************************************************!*\
  !*** ./src/wgs/render/chunks/pack_normals.glsl ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n"},"./src/wgs/render/chunks/point_size.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/chunks/point_size.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="gl_PointSize = point_size;"},"./src/wgs/render/chunks/prism_glazing.glsl":
/*!**************************************************!*\
  !*** ./src/wgs/render/chunks/prism_glazing.glsl ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports="\nvec3 TransmitAdjust(vec3 transmission, vec3 f0) \n{ \n   vec3 limit = max(1.0 - f0, 0.00001); \n   return clamp(transmission, vec3(0.0, 0.0, 0.0), limit) / limit; \n} \nfloat ColorToIlluminance(in vec3 color) \n{ \n   const vec3 rgb2grey = vec3(0.299, 0.587, 0.114); \n   float illuminance = dot(rgb2grey, color); \n   return illuminance; \n} \nvoid applyPrismGlazingOpacity(\n    inout vec4 color,\n    vec3 transmissionF,\n    float transmissionAlpha,\n    float NdotV,\n    float glazingIlluminace) \n{\n    const float third = 1.0/3.0; \n    float transSurface = exp(-(transmissionAlpha + (transmissionAlpha < 0.0025 ? 0.0 : 0.25)) * NdotV * PI); \n    float opacity = 1.0- dot((1.0 - transmissionF), vec3(third,third,third)) * transSurface * glazingIlluminace; \n    opacity = clamp(opacity, 0.01, 0.99);\n    color.a *= opacity;\n} \n"},"./src/wgs/render/chunks/prism_transparency.glsl":
/*!*******************************************************!*\
  !*** ./src/wgs/render/chunks/prism_transparency.glsl ***!
  \*******************************************************/
/*! no static exports found */function(e,t){e.exports="void applyPrismTransparency(\n    inout vec4 color,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    float fsLevel = max(max(color.r, color.g), color.b);\n    color = vec4(color.rgb/fsLevel, fsLevel);\n    float transLevel = min(min(transparentColor.r, transparentColor.g), transparentColor.b);\n    transLevel = min( (1.0 - surface_roughness), transLevel );\n    float transAlpha = (1.0 - transLevel) * 0.4 + surface_roughness * 0.55;\n    vec3 tr_g_color = sqrt(transparentColor);\n    vec4 transColor = vec4(0.5 * vec3(tr_g_color), transAlpha);\n    float strength = 1.0 - (1.0 - fsLevel) * (1.0 - fsLevel);\n    color = mix(transColor, color, strength);\n    color.a = max(color.a, 0.05);\n    if (transparentIor == 1.0 && tr_g_color == vec3(1.0)) {\n        color.a = 0.0;\n    }\n}"},"./src/wgs/render/chunks/prism_wood.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/chunks/prism_wood.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="#if defined( PRISMWOOD )\n#define ONE 0.00390625\nfloat GetIndexedValue(vec4 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else if (index == 2)\n        return array[2];\n    else if (index == 3)\n        return array[3];\n    else\n        return 0.0;\n}\nint GetIndexedValue(ivec2 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else\n        return 0;\n}\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nfloat SampleCurlyPattern(vec2 uv)\n{\n    vec2 uv_wood_curly_distortion_map = (wood_curly_distortion_map_texMatrix * vec3(uv, 1.0)).xy;\n    WOOD_CURLY_DISTORTION_CLAMP_TEST;\n    vec3 curlyDistortion = texture2D(wood_curly_distortion_map, uv_wood_curly_distortion_map).xyz;\n    if(wood_curly_distortion_map_invert) curlyDistortion = vec3(1.0) - curlyDistortion;\n    return curlyDistortion.r;\n}\nvec3 DistortCurly(vec3 p)\n{\n    if (!wood_curly_distortion_enable) return p;\n    float r = length(p.xy);\n    if (r < 0.00001) return p;\n    const float INV_ANGLE_INTERVAL = 1.27323954;\n    const float NUM_INTERVAL = 8.0;\n    float theta = atan(p.y, p.x);\n    if (theta < 0.0)\n        theta += PI2;\n    float intIdx = theta * INV_ANGLE_INTERVAL;\n    int idx0 = int(mod(floor(intIdx), NUM_INTERVAL));\n    int idx1 = int(mod(ceil(intIdx), NUM_INTERVAL));\n    const vec4 HASH_TABLE1 = vec4(0.450572,0.114598, 0.886043, 0.315119);\n    const vec4 HASH_TABLE2 = vec4(0.216133,0.306264, 0.685616, 0.317907);\n    float offset0 = idx0 < 4 ? GetIndexedValue(HASH_TABLE1, idx0) : GetIndexedValue(HASH_TABLE2, idx0-4);\n    float offset1 = idx1 < 4 ? GetIndexedValue(HASH_TABLE1, idx1) : GetIndexedValue(HASH_TABLE2, idx1-4);\n    const float maxOffset = 100.0;\n    offset0 = (offset0 - 0.5) * maxOffset;\n    offset1 = (offset1 - 0.5) * maxOffset;\n    vec2 uv0 = vec2(p.z + offset0, r);\n    float shiftWeight0 =  SampleCurlyPattern(uv0);\n    vec2 uv1 = vec2(p.z + offset1, r);\n    float shiftWeight1 =  SampleCurlyPattern(uv1);\n    float interpWeight = fract(intIdx);\n    float shiftWeight = mix(shiftWeight0, shiftWeight1, interpWeight);\n    const float INV_MIN_RADIUS = 2.0;\n    float shiftWeightAdjust = smoothstep(0.0, 1.0, r * INV_MIN_RADIUS);\n    r -= wood_curly_distortion_scale * (shiftWeight * shiftWeightAdjust);\n    float thetaNew = atan(p.y, p.x);\n    vec3 pNew = p;\n    pNew.x = r * cos(thetaNew);\n    pNew.y = r * sin(thetaNew);\n    return pNew;\n}\n#endif\nvec3 un2sn(vec3 range)\n{\n    return range * 2.0 - 1.0;\n}\nfloat inoise(vec3 p)\n{\n    vec3 modp = mod(floor(p), 256.0);\n    modp.xy = modp.xy * ONE;\n    vec4 AA = texture2D(perm2DMap, vec2(modp.x, modp.y), 0.0) * 255.0;\n    AA = AA + modp.z;\n    AA = mod(floor(AA), 256.0);\n    AA *= ONE;\n    vec3 gradx1 = un2sn(texture2D(permGradMap,vec2(AA.x,0.0),0.0).xyz);\n    vec3 grady1 = un2sn(texture2D(permGradMap,vec2(AA.y,0.0),0.0).xyz);\n    vec3 gradz1 = un2sn(texture2D(permGradMap,vec2(AA.z,0.0),0.0).xyz);\n    vec3 gradw1 = un2sn(texture2D(permGradMap,vec2(AA.w,0.0),0.0).xyz);\n    vec3 gradx2 = un2sn(texture2D(permGradMap,vec2(AA.x + ONE,0.0),0.0).xyz);\n    vec3 grady2 = un2sn(texture2D(permGradMap,vec2(AA.y + ONE,0.0),0.0).xyz);\n    vec3 gradz2 = un2sn(texture2D(permGradMap,vec2(AA.z + ONE,0.0),0.0).xyz);\n    vec3 gradw2 = un2sn(texture2D(permGradMap,vec2(AA.w + ONE,0.0),0.0).xyz);\n    p -= floor(p);\n    vec3 fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix( mix( mix( dot(gradx1, p ),\n                          dot(gradz1, p + vec3(-1.0, 0.0, 0.0)), fadep.x),\n                     mix( dot(grady1, p + vec3(0.0, -1.0, 0.0)),\n                          dot(gradw1, p + vec3(-1.0, -1.0, 0.0)), fadep.x), fadep.y),\n                mix( mix( dot(gradx2, p + vec3(0.0, 0.0, -1.0)),\n                          dot(gradz2, p + vec3(-1.0, 0.0, -1.0)), fadep.x),\n                     mix( dot(grady2, p + vec3(0.0, -1.0, -1.0)),\n                          dot(gradw2, p + vec3(-1.0, -1.0, -1.0)), fadep.x), fadep.y), fadep.z);\n}\nfloat inoise(float p)\n{\n    float modp = mod(floor(p), 256.0);\n    modp = (modp + 256.0) * ONE;\n    float permx = texture2D(permutationMap, vec2(modp, 0.0), 0.0).r;\n    float gradx = texture2D(gradientMap, vec2(permx, 0.0), 0.0).r*2.0-1.0;\n    float permy = texture2D(permutationMap, vec2(modp + ONE, 0.0), 0.0).r;\n    float grady = texture2D(gradientMap, vec2(permy, 0.0), 0.0).r*2.0-1.0;\n    p -= floor(p);\n    float fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix(gradx * p, grady * (p - 1.0), fadep);\n}\nfloat multiband_inoise(vec3 p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nfloat multiband_inoise(float p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nvec3 Distort3DCosineRadialDir(vec3 p)\n{\n    float radius = length(p.xy);\n    if (radius < 0.00001) return p;\n    vec2 theta = p.xy / radius;\n    float radiusShift = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= wood_fiber_cosine_bands) break;\n        radiusShift += GetIndexedValue(wood_fiber_cosine_weights, i) * cos(p.z * RECIPROCAL_PI2 * GetIndexedValue(wood_fiber_cosine_frequencies, i));\n    }\n    const float MIN_RADIUS = 1.5;\n    float weight = clamp(radius / MIN_RADIUS, 0.0, 1.0);\n    if(weight >= 0.5)\n        weight = weight * weight * (3.0 - (weight + weight));\n    p.xy += theta * radiusShift * weight;\n    return p;\n}\nvec3 Distort3DPerlin(vec3 p)\n{\n    vec3 pAniso = vec3(p.xy, p.z * wood_fiber_perlin_scale_z);\n    p.xy += multiband_inoise(pAniso, wood_fiber_perlin_bands, wood_fiber_perlin_weights, wood_fiber_perlin_frequencies);\n    return p;\n}\nvec3 Distort(vec3 p)\n{\n    if(wood_fiber_cosine_enable)\n        p = Distort3DCosineRadialDir(p);\n    if(wood_fiber_perlin_enable)\n        p = Distort3DPerlin(p);\n    return p;\n}\nfloat DistortRadiusLength(float radiusLength)\n{\n    radiusLength += multiband_inoise(radiusLength, wood_growth_perlin_bands, wood_growth_perlin_weights, wood_growth_perlin_frequencies);\n    if (radiusLength < 0.0) radiusLength = 0.0;\n    return radiusLength;\n}\nfloat ComputeEarlyWoodRatio(float radiusLength)\n{\n    float fraction = mod(radiusLength, wood_ring_thickness) / wood_ring_thickness;\n    if (fraction <= wood_ring_fraction.y)\n       return 1.0;\n    else if(fraction <= wood_ring_fraction.x)\n       return (1.0 - (fraction - wood_ring_fraction.y) / wood_fall_rise.x);\n    else if(fraction <= wood_ring_fraction.w)\n       return 0.0;\n    else\n       return ((fraction - wood_ring_fraction.w) / wood_fall_rise.y);\n}\nvec3 DistortEarlyColor(vec3 earlyColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_earlycolor_perlin_bands,wood_earlycolor_perlin_weights,wood_earlycolor_perlin_frequencies);\n    earlyColor = pow(abs(earlyColor), vec3(expValue));\n    return earlyColor;\n}\nvec3 DistortLateColor(vec3 lateColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_latecolor_perlin_bands,wood_latecolor_perlin_weights,wood_latecolor_perlin_frequencies);\n    lateColor = pow(abs(lateColor), vec3(expValue));\n    return lateColor;\n}\nvec3 DistortDiffuseColor(vec3 diffAlbedo, vec3 p)\n{\n    p.z *= wood_diffuse_perlin_scale_z;\n    float expValue = 1.0 + multiband_inoise(p, wood_diffuse_perlin_bands, wood_diffuse_perlin_weights, wood_diffuse_perlin_frequencies);\n    diffAlbedo = pow(abs(diffAlbedo), vec3(expValue));\n    return diffAlbedo;\n}\nfloat LayerRoughnessVar(float roughness, float earlyWoodRatio)\n{\n    return earlyWoodRatio * wood_groove_roughness + (1.0 - earlyWoodRatio) * roughness;\n}\nfloat hashword(vec2 k)\n{\n    k = mod(k, vec2(256.0)) * ONE;\n    float a = texture2D(permutationMap, vec2(k.x, 0.0)).x + k.y ;\n    a = texture2D(permutationMap, vec2(a, 0.0)).x ;\n    return a*255.0;\n}\nfloat wyvillsq(float rsq)\n{\n    if (rsq >= 1.0) return 0.0;\n    float tmp = 1.0 - rsq;\n    return tmp*tmp*tmp;\n}\nfloat Weight2DNeighborImpulses(vec3 p, float woodWeight)\n{\n    if(woodWeight <= 0.0) return 0.0;\n    float poreRadius = wood_pore_radius * woodWeight;\n    vec2 left = floor((p.xy - poreRadius) / wood_pore_cell_dim);\n    vec2 right = floor((p.xy + poreRadius) / wood_pore_cell_dim);\n    float weight = 0.0;\n    float invRsq = 1.0 / (poreRadius * poreRadius);\n    const float norm =  1.0 / 15.0;\n    for (int j = 0; j <= 4; j++)\n    {\n        if (j > int(right.y - left.y)) continue;\n        for (int i = 0; i <= 4; i++)\n        {\n            if (i > int(right.x - left.x)) continue;\n            vec2 pij = vec2(float(i) + left.x,float(j) + left.y);\n            float hRNum = hashword(pij);\n            float impPosX = mod(hRNum, 16.0) * norm;\n            float impPosY = floor(hRNum / 16.0) * norm;\n            impPosX = (pij.x + impPosX)* wood_pore_cell_dim;\n            impPosY = (pij.y + impPosY)* wood_pore_cell_dim;\n            float dsq = (p.x - impPosX) * (p.x - impPosX) + (p.y - impPosY) * (p.y - impPosY);\n            weight += wyvillsq(dsq * invRsq);\n        }\n    }\n    return weight;\n}\nfloat Weight3DRayImpulses(vec3 p)\n{\n    int segIdx = int(floor(p.z / wood_ray_seg_length_z));\n    float factor = p.z / wood_ray_seg_length_z - float(segIdx);\n    int segIdx1 = segIdx - 1;\n    if ( factor > 0.5 )\n        segIdx1 = segIdx + 1;\n    float theta = atan(p.y, p.x);\n    float sliceIdx = floor(((theta + PI) * RECIPROCAL_PI2) * wood_ray_num_slices);\n    if ( sliceIdx == wood_ray_num_slices)\n        sliceIdx-=1.0;\n    ivec2 arrSegs = ivec2(segIdx, segIdx1);\n    float weight = 0.0;\n    const float norm =  1.0 / 15.0;\n    float radialOffset = 5.0;\n    float radialLength = length(p.xy);\n    for (int seg = 0; seg < 2; seg++)\n    {\n        float hRNum = hashword(vec2(sliceIdx, GetIndexedValue(arrSegs, seg)));\n        float rn1 = mod(hRNum,16.0) * norm;\n        if (radialLength < radialOffset * rn1)\n            continue;\n        float rayTheta = rn1;\n        rayTheta = ( ( sliceIdx + rayTheta ) / wood_ray_num_slices ) * ( 2.0 * PI ) - PI;\n        float rayPosZ = (hRNum/16.0)* norm;\n        rayPosZ = ( float(GetIndexedValue(arrSegs, seg)) + rayPosZ ) * wood_ray_seg_length_z;\n        vec3 pt1 = vec3(0.0);\n        vec3 pt2 = vec3(cos(rayTheta), sin(rayTheta), 0.0);\n        vec3 p1 = p;\n        p1.z -= rayPosZ;\n        p1.z /=  wood_ray_ellipse_z2x;\n        vec3 v1 = pt2 - pt1;\n        vec3 v2 = pt1 - p1;\n        v2 = cross(v1, v2);\n        float dist = length(v2) / length(v1);\n        float invRsq = 1.0 / ( wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x);\n        weight += wyvillsq( (dist * dist) * invRsq );\n    }\n    return weight;\n}\nvec3 DarkenColorWithPores(vec3 p, vec3 diffColor, float woodWeight)\n{\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float a = wood_pore_color_power - 1.0;\n    float b = 1.0;\n    float y = a * poresWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nvec3 DarkenColorWithRays(vec3 p, vec3 diffColor)\n{\n    float raysWeight = Weight3DRayImpulses(p);\n    float a = wood_ray_color_power - 1.0;\n    float b = 1.0;\n    float y = a * raysWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nfloat ComputeWoodWeight(float earlyWoodRatio)\n{\n    float woodWeight = 0.0;\n    if (wood_pore_type == 0)\n        woodWeight = 1.0;\n    else if (wood_pore_type == 1)\n        woodWeight = earlyWoodRatio;\n    else if (wood_pore_type == 2)\n        woodWeight = 1.0 - earlyWoodRatio;\n    else\n        woodWeight = -1.0;\n    return woodWeight;\n}\n#if defined( PRISMWOODBUMP )\nfloat ComputeEarlyWoodRatioAA(float radiusLength, float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    float samplesf = clamp(4.0 / transPixels, 1.0, 4.0);\n    int samples = int(samplesf);\n    float inverseSamples = 1.0 / float(samples);\n    vec2 rdelta = vec2(dFdx(radiusLength), dFdy(radiusLength)) * inverseSamples;\n    float earlywoodRatio = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= samples) break;\n        for (int j = 0; j < 4; ++j)\n        {\n            if (j >= samples) break;\n            float r = radiusLength + dot(vec2(i, j), rdelta);\n            earlywoodRatio += ComputeEarlyWoodRatio(r);\n        }\n    }\n    return earlywoodRatio * (inverseSamples * inverseSamples);\n}\nfloat LatewoodDepthVariation(float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    return clamp(transPixels * 0.5, 0.0, 1.0);\n}\nfloat LatewoodHeightVariation(float earlyWoodRatio, float latewoodBumpDepth,\n                              float depthVar)\n{\n    return ( 1.0 - earlyWoodRatio ) * latewoodBumpDepth * depthVar;\n}\nfloat PoreDepthVariation(float woodWeight, float invUnitExt)\n{\n    float porePixels = woodWeight * wood_pore_radius * invUnitExt;\n    return clamp(porePixels, 0.0, 1.0);\n}\nfloat PoreHeightVariation(float earlyWoodRatio, float poresWeight, float poreDepth,\n                          float depthVar)\n{\n    return poresWeight * (-1.0 * poreDepth) * depthVar;\n}\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvec3 WoodBumpHeight(float heightLeft, float heightRight, float heightBack, float heightFront)\n{\n    const float epsilon = 0.001;\n    float heightDeltaX = heightRight - heightLeft;\n    vec3 Tu = vec3(2.0 * epsilon, 0.0, heightDeltaX);\n    float heightDeltaY = heightFront - heightBack;\n    vec3 Tv = vec3(0.0, 2.0 * epsilon, heightDeltaY);\n    return cross(Tu, Tv);\n}\nvec3 SelectNormal(vec3 N, vec3 bumpN, vec3 V)\n{\n    float bumpNdotV = dot(bumpN, V);\n    if(bumpNdotV > 0.0)\n        return bumpN;\n    else return N;\n}\nfloat MinInverseUnitExtent(vec3 p)\n{\n    return 1.0 / max(max(length(dFdx(p.xy)), length(dFdy(p.xy))), 0.000001);\n}\nfloat HeightVariation(vec3 pos)\n{\n    vec3 p = Distort(pos);\n    float radiusLength = length(p.xy);\n    if (wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n    float invUnitExt = MinInverseUnitExtent(p);\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n    float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float depthVar = PoreDepthVariation(woodWeight, invUnitExt);\n    float poreHeightVariation = -1.0 * poresWeight * wood_pore_depth * depthVar;\n    float latewoodHeightVariation = 0.0;\n    if (wood_use_latewood_bump)\n    {\n        float latewoodDepthVar = LatewoodDepthVariation(invUnitExt);\n        latewoodHeightVariation = (1.0 - earlyWoodRatio) * wood_latewood_bump_depth * latewoodDepthVar;\n    }\n    float sumHeightVariation = poreHeightVariation + latewoodHeightVariation;\n    return sumHeightVariation;\n}\n#endif\nvec3 NoiseWood(vec3 p, inout float roughness)\n{\n    p = Distort(p);\n    float radiusLength = length(p.xy);\n    if(wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n#if defined( PRISMWOODBUMP )\n    float invUnitExt = MinInverseUnitExtent( p );\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n#else\n    float earlyWoodRatio = ComputeEarlyWoodRatio(radiusLength);\n#endif\n    vec3 earlyColor = wood_early_color;\n    if (wood_earlycolor_perlin_enable)\n        earlyColor = DistortEarlyColor(earlyColor, radiusLength);\n    vec3 lateColor;\n    if (wood_use_manual_late_color)\n        lateColor = wood_manual_late_color;\n    else\n        lateColor = pow(abs(earlyColor), vec3(wood_late_color_power));\n    if(wood_latecolor_perlin_enable)\n        lateColor = DistortLateColor(lateColor, radiusLength);\n    vec3 diffAlbedo = earlyWoodRatio * earlyColor + (1.0 - earlyWoodRatio) * lateColor;\n    if(wood_diffuse_perlin_enable)\n        diffAlbedo = DistortDiffuseColor(diffAlbedo, p);\n    if (wood_use_pores)\n    {\n        float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n        diffAlbedo = DarkenColorWithPores(p, diffAlbedo, woodWeight);\n    }\n    if (wood_use_rays)\n        diffAlbedo = DarkenColorWithRays(p, diffAlbedo);\n    if(wood_use_groove_roughness)\n        roughness = LayerRoughnessVar(roughness, earlyWoodRatio);\n    return clamp(diffAlbedo, vec3(0.0), vec3(1.0));\n}\n#if defined(PRISMWOODBUMP)\nvoid getFinalWoodContext(\n    inout vec3 N, vec3 V, inout vec3 Tu, inout vec3 Tv, vec3 p,\n    vec3 geoNormal, vec3 tNormal, mat3 normalMatrix\n) {\n    vec3 offsetTuLeft = p - 0.001 * Tu;\n    vec3 offsetTuRight = p + 0.001 * Tu;\n    vec3 offsetTvLeft = p - 0.001 * Tv;\n    vec3 offsetTvRight = p + 0.001 * Tv;\n    float heightVariationTuLeft = HeightVariation(offsetTuLeft);\n    float heightVariationTuRight = HeightVariation(offsetTuRight);\n    float heightVariationTvLeft = HeightVariation(offsetTvLeft);\n    float heightVariationTvRight = HeightVariation(offsetTvRight);\n    vec3 bumpHeight = WoodBumpHeight(heightVariationTuLeft, heightVariationTuRight, heightVariationTvLeft, heightVariationTvRight);\n    vec3 newNormal = normalize(bumpHeight.x * Tu + bumpHeight.y * Tv + bumpHeight.z * vtNormal);\n    vec3 newNormalView = normalize(vNormalMatrix * newNormal);\n    vec3 selectedNormal = SelectNormal(geoNormal, newNormalView, V);\n    ComputeTangents(selectedNormal, Tu, Tv);\n    Tu = normalize(Tu);\n    Tv = normalize(Tv);\n    N = faceforward(selectedNormal, -V, selectedNormal);\n}\n#endif\n#endif\n"},"./src/wgs/render/chunks/shadowmap_decl_common.glsl":
/*!**********************************************************!*\
  !*** ./src/wgs/render/chunks/shadowmap_decl_common.glsl ***!
  \**********************************************************/
/*! no static exports found */function(e,t){e.exports="\nuniform float shadowESMConstant;\nuniform float shadowMapRangeMin;\nuniform float shadowMapRangeSize;\n"},"./src/wgs/render/chunks/shadowmap_decl_frag.glsl":
/*!********************************************************!*\
  !*** ./src/wgs/render/chunks/shadowmap_decl_frag.glsl ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap;\nuniform vec2      shadowMapSize;\nuniform float     shadowDarkness;\nuniform float     shadowBias;\nuniform vec3      shadowLightDir;\nvarying vec4 vShadowCoord;\n#include<shadowmap_decl_common>\nfloat getShadowValue() {\n    float fDepth;\n    vec3 shadowColor = vec3( 1.0 );\n    vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n    shadowCoord.xyz = 0.5 * (shadowCoord.xyz + vec3(1.0, 1.0, 1.0));\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    float shadowValue = 1.0;\n    if (inFrustum) {\n        shadowCoord.z = min(0.999, shadowCoord.z);\n        shadowCoord.z -= shadowBias;\n#ifdef USE_HARD_SHADOWS\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float fDepth = rgbaDepth.r;\n        if ( fDepth < shadowCoord.z ) {\n            shadowValue = 1.0 - shadowDarkness;\n        }\n#else\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float shadowMapValue = rgbaDepth.r;\n        shadowValue = exp(-shadowESMConstant * shadowCoord.z) * shadowMapValue;\n        shadowValue = min(shadowValue, 1.0);\n        shadowValue = mix(1.0 - shadowDarkness, 1.0, shadowValue);\n#endif\n    }\n    return shadowValue;\n}\n#else\nfloat getShadowValue() { return 1.0; }\n#endif\nvec3 applyEnvShadow(vec3 colorWithoutShadow, vec3 worldNormal) {\n#if defined(USE_SHADOWMAP)\n    float dp  = dot(shadowLightDir, worldNormal);\n    float dpValue = (dp + 1.0) / 2.0;\n    dpValue = min(1.0, dpValue * 1.5);\n    float sv = getShadowValue();\n    vec3 result = colorWithoutShadow * min(sv, dpValue);\n    return result;\n#else\n    return colorWithoutShadow;\n#endif\n}\n"},"./src/wgs/render/chunks/shadowmap_decl_vert.glsl":
/*!********************************************************!*\
  !*** ./src/wgs/render/chunks/shadowmap_decl_vert.glsl ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord;\nuniform mat4 shadowMatrix;\n#endif\n"},"./src/wgs/render/chunks/shadowmap_vert.glsl":
/*!***************************************************!*\
  !*** ./src/wgs/render/chunks/shadowmap_vert.glsl ***!
  \***************************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef USE_SHADOWMAP\n{\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vShadowCoord = shadowMatrix * worldPosition;\n}\n#endif\n"},"./src/wgs/render/chunks/theming_decl_frag.glsl":
/*!******************************************************!*\
  !*** ./src/wgs/render/chunks/theming_decl_frag.glsl ***!
  \******************************************************/
/*! no static exports found */function(e,t){e.exports="uniform vec4 themingColor;\n"},"./src/wgs/render/chunks/theming_frag.glsl":
/*!*************************************************!*\
  !*** ./src/wgs/render/chunks/theming_frag.glsl ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports="gl_FragColor.rgb = mix(gl_FragColor.rgb, themingColor.rgb, themingColor.a);\n"},"./src/wgs/render/chunks/tonemap.glsl":
/*!********************************************!*\
  !*** ./src/wgs/render/chunks/tonemap.glsl ***!
  \********************************************/
/*! no static exports found */function(e,t){e.exports="\nfloat luminance_post(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\n    return dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\n    vec3 R = vec3( 3.240479, -1.537150, -0.498535);\n    vec3 G = vec3(-0.969256,  1.875992,  0.041556);\n    vec3 B = vec3( 0.055648, -0.204043,  1.057311);\n    vec3 rgb;\n    rgb.b = dot(xyz, B);\n    rgb.g = dot(xyz, G);\n    rgb.r = dot(xyz, R);\n    return rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\n    vec3 X = vec3(0.412453, 0.35758, 0.180423);\n    vec3 Y = vec3(0.212671, 0.71516, 0.0721688);\n    vec3 Z = vec3(0.0193338, 0.119194, 0.950227);\n    vec3 xyz;\n    xyz.x = dot(rgb, X);\n    xyz.y = dot(rgb, Y);\n    xyz.z = dot(rgb, Z);\n    return xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\n    float sum = xyz.x + xyz.y + xyz.z;\n    sum = 1.0 / sum;\n    vec3 xyY;\n    xyY.z = xyz.y;\n    xyY.x = xyz.x * sum;\n    xyY.y = xyz.y * sum;\n    return xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\n    float x = xyY.x;\n    float y = xyY.y;\n    float Y = xyY.z;\n    vec3 xyz;\n    xyz.y = Y;\n    xyz.x = x * (Y / y);\n    xyz.z = (1.0 - x - y) * (Y / y);\n    return xyz;\n}\nfloat toneMapCanon_T(float x)\n{\n    float xpow = pow(x, 1.60525727);\n    float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n    return clamp(tmp, 0.0, 1.0);\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\n    x *= Shift;\n    const float A = 0.2;\n    const float B = 0.34;\n    const float C = 0.002;\n    const float D = 1.68;\n    const float E = 0.0005;\n    const float F = 0.252;\n    const float scale = 1.0/0.833837;\n    return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\n    x *= Shift;\n    const float A = 0.27;\n    const float B = 0.29;\n    const float C = 0.052;\n    const float D = 0.2;\n    const float F = 0.18;\n    const float scale = 1.0/0.897105;\n    return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\nvec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {\n    vec3 outColor = x.rgb;\n    outColor = min(outColor, vec3(3.0));\n    float inLum = luminance_pre(outColor);\n    if (inLum > 0.0) {\n        float outLum = toneMapCanon_T(inLum);\n        outColor = outColor * (outLum / inLum);\n        outColor = clamp(outColor, vec3(0.0), vec3(1.0));\n    }\n    float gamma = 1.0/2.2;\n    outColor = pow(outColor, vec3(gamma));\n    return outColor;\n}\n"},"./src/wgs/render/chunks/wide_lines_decl.glsl":
/*!****************************************************!*\
  !*** ./src/wgs/render/chunks/wide_lines_decl.glsl ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef WIDE_LINES\nattribute vec3 prev;\nattribute vec3 next;\nattribute float side;\nuniform vec2 view_size;\nvec2 to2d(vec4 i) {\n  return i.xy / i.w;\n}\n#endif\n"},"./src/wgs/render/chunks/wide_lines_vert.glsl":
/*!****************************************************!*\
  !*** ./src/wgs/render/chunks/wide_lines_vert.glsl ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports="\n#ifdef WIDE_LINES\nvec4 mvpPosition = projectionMatrix * mvPosition; \nmat3 vectorMatrix = mat3(modelViewMatrix);\nvec2 _pos = to2d(mvpPosition) * view_size;\nvec2 _prev = to2d(projectionMatrix * vec4(mvPosition.xyz + vectorMatrix * (prev * 0.01), 1.0)) * view_size;\nvec2 _next = to2d(projectionMatrix * vec4(mvPosition.xyz - vectorMatrix * (next * 0.01), 1.0)) * view_size;\nvec2 dir1 = _pos - _next;\nvec2 dir2 = _prev - _pos;\ndir2 = (length(dir2) > 0.0000001) ? normalize(dir2) : vec2(0.0, 0.0);\ndir1 = (length(dir1) > 0.0000001) ? normalize(dir1) : dir2;\nvec2 dir_sharp = normalize(dir1 + dir2);\nvec2 dir = normalize(dir1 + dir_sharp);\nvec2 offset = vec2(-dir.y, dir.x);\nfloat len = 1.0 / cross(vec3(offset, 0), vec3(dir1, 0)).z;\noffset *= len;\noffset /= view_size;\noffset *= side;\noffset *= mvpPosition.w;\nmvpPosition.xy += offset;\ngl_Position = mvpPosition;\n#endif\n"},"./src/wgs/render/shaders/background_frag.glsl":
/*!*****************************************************!*\
  !*** ./src/wgs/render/shaders/background_frag.glsl ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec3 vColor;\nvarying vec2 vUv;\nuniform samplerCube envMap;\nuniform vec3 uCamDir;\nuniform vec3 uCamUp;\nuniform vec2 uResolution;\nuniform float uHalfFovTan;\nuniform float opacity;\nuniform bool envMapBackground;\n#include<env_sample>\nconst int bloomRange = 4;\n#include<ordered_dither>\nuniform float envMapExposure;\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\nvec3 rayDir(in vec2 vUv) {\n    vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);\n    vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);\n    vec3 C = normalize(uCamDir);\n    vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );\n    return ray;\n}\nvec3 getColor(in vec3 rd) {\n    return RGBMDecode(textureCube(envMap, adjustLookupVector(rd)), envMapExposure);\n}\nvoid main() {\n    vec3 rd = rayDir(vUv);\n    vec3 outColor;\n    if (envMapBackground) {\n        outColor = getColor(rd);\n#if TONEMAP_OUTPUT == 1\n        outColor = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outColor);\n#elif TONEMAP_OUTPUT == 2\n        outColor = toneMapCanonFilmic_WithGamma(exposureBias * outColor);\n#endif\n    }\n    else {\n        outColor = vColor;\n    }\n    gl_FragColor = vec4(orderedDithering(outColor), opacity);\n}\n"},"./src/wgs/render/shaders/background_vert.glsl":
/*!*****************************************************!*\
  !*** ./src/wgs/render/shaders/background_vert.glsl ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports="uniform vec3 color1;\nuniform vec3 color2;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvoid main() {\n    if (uv.y == 0.0)\n        vColor = color2;\n    else\n        vColor = color1;\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},"./src/wgs/render/shaders/basic_frag.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/basic_frag.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="uniform vec3 diffuse;\nuniform float opacity;\n#include<common>\n#include<color_pars_fragment>\n#include<map_pars_fragment>\n#include<alphamap_pars_fragment>\n#include<lightmap_pars_fragment>\n#include<envmap_pars_fragment>\n#include<specularmap_pars_fragment>\n#include<logdepthbuf_pars_fragment>\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\n#include<id_decl_frag>\n#include<theming_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#include<logdepthbuf_fragment>\n#include<map_fragment>\n#include<color_fragment>\n#include<alphamap_fragment>\n#include<alphatest_fragment>\n#include<specularmap_fragment>\n    outgoingLight = diffuseColor.rgb;\n#include<lightmap_fragment>\n#include<envmap_fragment>\n#include<linear_to_gamma_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    vec3 geomNormal = vec3(0.0,0.0,0.0);\n    float depth = 0.0;\n#include<theming_frag>\n#include<final_frag>\n}\n"},"./src/wgs/render/shaders/basic_vert.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/basic_vert.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="#include<id_decl_vert>\n#include<decl_point_size>\n#include<common>\n#include<map_pars_vertex>\n#include<lightmap_pars_vertex>\n#include<envmap_pars_vertex>\n#include<color_pars_vertex>\n#include<logdepthbuf_pars_vertex>\n#include<wide_lines_decl>\n#include<pack_normals>\n#ifdef USE_INSTANCING\n    #include<instancing_decl_vert>\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n#ifdef USE_INSTANCING\n    vec3 instancePosition = getInstancePos(position);\n    #define position instancePosition\n#endif\n#if defined(USE_ENVMAP) && (defined(UNPACK_NORMALS) || defined(USE_INSTANCE))\n    vec3 correctNormal;\n    #ifdef UNPACK_NORMALS\n        correctNormal = decodeNormal(normal);\n    #else\n        correctNormal = normal;\n    #endif\n    #ifdef USE_INSTANCING\n        correctNormal = getInstanceNormal(correctNormal);\n    #endif\n    #define normal correctNormal\n#endif\n#include<map_vertex>\n#include<lightmap_vertex>\n#include<color_vertex>\n#ifdef USE_ENVMAP\n#include<defaultnormal_vertex>\n#endif\n#include<default_vertex>\n#include<wide_lines_vert>\n#include<logdepthbuf_vertex>\n#include<worldpos_vertex>\n#if NUM_CUTPLANES > 0\n    vec4 _worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = _worldPosition.xyz;\n#endif\n#include<envmap_vertex>\n#include<id_vert>\n#include<point_size>\n}\n"},"./src/wgs/render/shaders/blend_frag.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/blend_frag.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform float aoOpacity;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform vec2 resolution;\nuniform vec4 objIDv4;\nuniform sampler2D tID;\nuniform vec4 edgeObjIDv4;\n#if defined(USE_MODEL_ID)\nuniform vec2 modelIDv2;\nuniform sampler2D tID2;\nuniform vec2 edgeModelIDv2;\n#endif\nuniform float highlightIntensity;\nuniform vec3 selectionColor;\n#ifdef IS_2D\nuniform float expand2dSelection;\n#endif\nuniform sampler2D tCrossFadeTex0;\nuniform sampler2D tCrossFadeTex1;\nuniform float     crossFadeOpacity0;\nuniform float     crossFadeOpacity1;\nvarying vec2 vUv;\n#ifdef SPATIAL_FILTER\n#include<depth_texture>\n#endif\n#include<tonemap>\n#ifdef USE_IDBUFFER_SELECTION\nbool isSelection(vec2 vUv, float I, float J) {\n    vec4 idAtPixel = texture2D(tID, vUv+resolution*vec2(I,J));\n    if (idAtPixel.rgb == vec3(0.0))\n        return false;\n#if defined(USE_MODEL_ID)\n    vec4 modelAtPixel = texture2D(tID2, vUv+resolution*vec2(I,J));\n    idAtPixel.a = modelAtPixel.b;\n    vec4 idDelta = abs(idAtPixel.rgba - edgeObjIDv4.rgba);\n    vec2 modelDelta = abs(modelAtPixel.rg - edgeModelIDv2.rg);\n#else\n    vec4 idDelta = vec4(abs(idAtPixel.rgb - edgeObjIDv4.rgb), 0.0);\n    vec2 modelDelta = vec2(0.0, 0.0);\n#endif\n    if (max(max(modelDelta.r, modelDelta.g), max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n        return true;\n    } else {\n        return false;\n    }\n}\n#else\nbool isSelected(vec3 C) {\n    float minS = min(selectionColor.r, min(selectionColor.g, selectionColor.b));\n    float maxS = max(selectionColor.r, max(selectionColor.g, selectionColor.b));\n    float satS = maxS - minS;\n    float minC = min(C.r, min(C.g, C.b));\n    float maxC = max(C.r, max(C.g, C.b));\n    float satC = maxC - minC;\n    if (satC < .01 || satS < .01)\n        return false;\n    vec3 S = (selectionColor - minS) / satS;\n    vec3 H = (C - minC) / satC;\n    vec3 D = H - S;\n    float eps = .15;\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\n#define IS_SELECTION(C) isSelected((C).rgb)\n#endif\nvec4 overlayEdgeDetect(vec2 vUv) {\n#ifdef IS_2D\n#define MAX_ALPHA(c)\n#define SUM_ALPHA(c, w) sumAlpha += c.a * w; sumWeight += w;\n#else\n#define MAX_ALPHA(c) maxAlpha = max(maxAlpha, c.a);\n#define SUM_ALPHA(c, w) \n#endif\n#ifdef USE_IDBUFFER_SELECTION\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && isSelection(vUv, I, J)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#else\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#endif\n#ifndef IS_2D\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a <= 0.0) hasEdge++; }\n#endif\n    int hasEdge = 0;\n    vec4 center = texture2D(tOverlay, vUv);\n    vec4 selectionPixel = vec4(0.0);\n#ifdef IS_2D\n    float sumAlpha = 0.0, sumWeight = 0.0;\n#else\n    float maxAlpha = 0.0;\n    bool paintOutline = false;\n#endif\n    if (center.a <= 0.0) {\n        CHECK_EDGE_ALPHA(-1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0,-1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA(-1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA(-1.0, 1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0, 1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 1.0, 1.0);\n        if (hasEdge != 0) {\n#ifdef IS_2D\n            center.a = -clamp(expand2dSelection - 1.0 + sumAlpha / sumWeight, 0.0, 1.0);\n            center.rgb = center.a < 0.0 ? selectionPixel.rgb : center.rgb;\n#else\n            center = selectionPixel;\n            paintOutline = true;\n#endif\n        }\n    }\n#ifdef USE_IDBUFFER_SELECTION\n    else if (center.a > 0.0 && isSelection(vUv, 0.0, 0.0)) {\n#else\n    else if (center.a > 0.0 && IS_SELECTION(center)) {\n#endif\n#ifdef IS_2D\n        center.a = -clamp(center.a + expand2dSelection, 0.0, 1.0);\n#else\n        CHECK_EDGE_SELECTION(-1.0,-1.0);\n        CHECK_EDGE_SELECTION( 0.0,-1.0);\n        CHECK_EDGE_SELECTION( 1.0,-1.0);\n        CHECK_EDGE_SELECTION(-1.0, 0.0);\n        CHECK_EDGE_SELECTION( 1.0, 0.0);\n        CHECK_EDGE_SELECTION(-1.0, 1.0);\n        CHECK_EDGE_SELECTION( 0.0, 1.0);\n        CHECK_EDGE_SELECTION( 1.0, 1.0);\n        if (hasEdge != 0)\n            paintOutline = true;\n        else\n            center.a = -center.a;\n#endif\n    }\n#ifndef IS_2D\n    if (paintOutline) {\n        float maxComponent = max(center.r, max(center.g, center.b));\n        center.rgb /= maxComponent;\n        center.rgb = sqrt(center.rgb);\n        center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n    }\n#endif\n    return center;\n}\n#ifdef SPATIAL_FILTER\nSPATIAL_FILTER\n#endif\nvec4 sampleColor() {\n    return texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return (useAO != 0) ? sqrt(texture2D(tAO, vUv).r) : 1.0;\n}\nvec3 applyCrossFade(vec3 srcColor, sampler2D fadeTex, float opacity, vec2 vUv) {\n    vec4 blendCol = texture2D(fadeTex, vUv);\n    return mix(srcColor.rgb, blendCol.rgb, blendCol.a * opacity);\n}\nvoid applyHighlighting(inout vec3 rgb, float filterValue) {\n#ifdef IS_2D\n    rgb = mix(rgb, vec3(1.0,1.0,0.0), filterValue * highlightIntensity * 0.25);\n#else\n    rgb += filterValue * highlightIntensity * 0.20;\n#endif\n}\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    #ifdef NUM_CROSSFADE_TARGETS\n        #if (NUM_CROSSFADE_TARGETS > 1)\n            #if (TARGET_FADE_MODE == 0)\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex0, crossFadeOpacity0, vUv);\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex1, crossFadeOpacity1, vUv);\n            #else\n                vec4 t0 = texture2D(tCrossFadeTex0, vUv);\n                vec4 t1 = texture2D(tCrossFadeTex1, vUv);\n                vec4 mixed = mix(t0, t1, crossFadeOpacity1);\n                texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n                float aoGamma = 1.0 + 3.0 * (1.0 - 2.0 * abs(crossFadeOpacity1 - 0.5));\n                if (aoGamma == 0.0)\n                    aoGamma = 1.0;\n                ao = pow(ao, 1.0 / aoGamma);\n            #endif\n        #else\n            vec4 mixed = texture2D(tCrossFadeTex0, vUv);\n            texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n        #endif\n    #else\n    #endif\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    if (useOverlay != 0) {\n        vec4 overlay = overlayEdgeDetect(vUv);\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n#ifdef IS_2D\n            overlay.a *= 0.6;\n#else\n            if (overlay.a >= 0.99) {\n                overlay.a = 0.75;\n                texel.rgb = vec3(luminance_post(texel.rgb));\n            }\n#endif\n        }\n        texel.rgb = mix(texel.rgb, sqrt(overlay.rgb), overlay.a);\n    }\n    if (objIDv4 != vec4(0.0)) {\n    vec4 idAtPixel = texture2D(tID, vUv);\n    #ifdef SPATIAL_FILTER\n        vec3 worldPos = reconstructWorldPosition(gl_FragCoord.xy, vUv);\n        float filterValue = (spatialFilter(worldPos) ? 1.0 : 0.0);\n        if (idAtPixel != vec4(1,1,1,1)) {\n            applyHighlighting(texel.rgb, filterValue);\n        }\n    #else\n#if defined(USE_MODEL_ID)\n        vec4 modelAtPixel = texture2D(tID2, vUv);\n        idAtPixel.a = modelAtPixel.b;\n        vec4 idDelta = abs(idAtPixel.rgba - objIDv4.rgba);\n        vec2 modelDelta = abs(modelAtPixel.rg - modelIDv2.rg);\n#else\n        vec4 idDelta = vec4(abs(idAtPixel.rgb - objIDv4.rgb), 0.0);\n        vec2 modelDelta = vec2(0.0, 0.0);\n#endif\n        if (max(max(modelDelta.r, modelDelta.g), max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n            applyHighlighting(texel.rgb, 1.0);\n        }\n#endif\n    }\n    gl_FragColor = texel;\n}\n"},"./src/wgs/render/shaders/cel_frag.glsl":
/*!**********************************************!*\
  !*** ./src/wgs/render/shaders/cel_frag.glsl ***!
  \**********************************************/
/*! no static exports found */function(e,t){e.exports="\n#include<depth_texture>\nuniform sampler2D tDiffuse;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D tFill;\nuniform sampler2D tPaper;\nuniform int style;\nuniform int idEdges;\nuniform int normalEdges;\nuniform int depthEdges;\nuniform float brightness;\nuniform float contrast;\nuniform int grayscale;\nuniform int preserveColor;\nuniform float levels;\nuniform float repeats;\nuniform float rotation;\nuniform sampler2D tGraphite1;\nuniform sampler2D tGraphite2;\nuniform sampler2D tGraphite3;\nuniform sampler2D tGraphite4;\nuniform sampler2D tGraphite5;\nuniform sampler2D tGraphite6;\nuniform sampler2D tGraphite7;\nuniform sampler2D tGraphite8;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\n    float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\n    nrmz.w = -(nrmz.z + cameraNear) / (cameraFar - cameraNear);\n    nrmz.z = z;\n    return nrmz;\n}\n#include<tonemap>\n#include<hsv>\nvec3 quantize(vec3 c) {\n    float L = max(c.r, max(c.g, c.b));\n    c *= floor(L * (levels-1.0) + 0.5) / (L * (levels-1.0));\n    return c;\n}\nvec3 quantizeRGB(vec3 c) {\n    c *= c;\n    c *= floor(c * levels * 0.9999) / (levels-1.0);\n    return sqrt(c);\n}\nvec3 clampHue(vec3 c, float hues, float sats, float vals) {\n    vec3 hsv = rgb2hsv(c);\n    hsv.x = floor(hsv.x * hues + 0.5) / hues;\n    hsv.y = floor(hsv.y * sats + 0.5) / sats;\n    hsv.z = floor(hsv.z * vals + 0.5) / vals;\n    vec3 col = hsv2rgb(hsv);\n    return col;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nint isObjectEdge() {\n    vec4 MM = texture2D(tID, vUv);\n    vec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);\n    if (MM != LL) return 1;\n    vec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);\n    if (MM != LM) return 1;\n    vec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);\n    if (MM != LR) return 1;\n    vec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);\n    if (MM != ML) return 1;\n    vec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);\n    if (MM != MR) return 1;\n    vec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);\n    if (MM != UL) return 1;\n    vec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);\n    if (MM != UM) return 1;\n    vec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);\n    if (MM != UR) return 1;\n    return (MM.x + MM.y + MM.z + MM.w) >= 4.0 ? 0 : -1;\n}\nconst float r = 1.0;\nfloat normalDiff(vec3 n1, vec3 n2) {\n    float d = dot(n1.xyz, n2.xyz);\n    return acos(clamp(d, -1.0, 1.0));\n}\nint isNormalDepthEdge() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 MM = texture2D(tDepth, vUv);\n    vec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);\n    vec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);\n    vec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);\n    vec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);\n    vec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);\n    vec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);\n    vec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);\n    vec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);\n    LL = recoverNZ(LL);\n    LM = recoverNZ(LM);\n    LR = recoverNZ(LR);\n    ML = recoverNZ(ML);\n    MM = recoverNZ(MM);\n    MR = recoverNZ(MR);\n    UL = recoverNZ(UL);\n    UM = recoverNZ(UM);\n    UR = recoverNZ(UR);\n    float dd = 0.0;\n    if ( depthEdges == 1 ) {\n        float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\n        dd = abs(dFdx(G)) + abs(dFdy(G));\n    }\n    float Gn = 0.0;\n    if ( normalEdges == 1 ) {\n        float pLL = normalDiff(LL.xyz, MM.xyz);\n        float pLM = normalDiff(LM.xyz, MM.xyz);\n        float pLR = normalDiff(LR.xyz, MM.xyz);\n        float pML = normalDiff(ML.xyz, MM.xyz);\n        float pMM = normalDiff(MM.xyz, MM.xyz);\n        float pMR = normalDiff(MR.xyz, MM.xyz);\n        float pUL = normalDiff(UL.xyz, MM.xyz);\n        float pUM = normalDiff(UM.xyz, MM.xyz);\n        float pUR = normalDiff(UR.xyz, MM.xyz);\n        Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\n    }\n    \n    return (dd > 0.004 || Gn > 2.0) ? 1 : 0;\n}\nvec3 computeGraphite( vec3 color, vec2 loc ) {\n    float lum = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n    float offset;\n    vec3 col1, col2;\n    if ( lum > 6.0/7.0 ) {\n        col1 = texture2D(tGraphite1, loc ).xyz;\n        col2 = texture2D(tGraphite2, loc ).xyz;\n        offset = 6.0/7.0;\n    } else if ( lum > 5.0/7.0 ) {\n        col1 = texture2D(tGraphite2, loc ).xyz;\n        col2 = texture2D(tGraphite3, loc ).xyz;\n        offset = 5.0/7.0;\n    } else if ( lum > 4.0/7.0 ) {\n        col1 = texture2D(tGraphite3, loc ).xyz;\n        col2 = texture2D(tGraphite4, loc ).xyz;\n        offset = 4.0/7.0;\n    } else if ( lum > 3.0/7.0 ) {\n        col1 = texture2D(tGraphite4, loc ).xyz;\n        col2 = texture2D(tGraphite5, loc ).xyz;\n        offset = 3.0/7.0;\n    } else if ( lum > 2.0/7.0 ) {\n        col1 = texture2D(tGraphite5, loc ).xyz;\n        col2 = texture2D(tGraphite6, loc ).xyz;\n        offset = 2.0/7.0;\n    } else if ( lum > 1.0/7.0 ) {\n        col1 = texture2D(tGraphite6, loc ).xyz;\n        col2 = texture2D(tGraphite7, loc ).xyz;\n        offset = 1.0/7.0;\n    } else {\n        col1 = texture2D(tGraphite7, loc ).xyz;\n        col2 = texture2D(tGraphite8, loc ).xyz;\n        offset = 0.0;\n    }\n    if ( col1.r == 0.0 && col2.r == 0.0 ) {\n        return vec3(lum,lum,lum);\n    }\n    float t = (lum-offset)*7.0;\n    return (col1 * t + col2 * (1.0 - t));\n}\nvec3 colorWithAdjustments() {\n    vec3 sceneRGB = texture2D(tDiffuse, vUv).xyz;\n    if ( brightness != 0.0 || contrast != 0.0) {\n        if ( brightness < 0.0 )\n        {\n            sceneRGB = sceneRGB * (1.0 + brightness);\n        }\n        else\n        {\n            sceneRGB = sceneRGB + ((1.0 - sceneRGB) * brightness);\n        }\n        float slant = tan(( clamp(contrast,-1.0,1.0) + 1.0) * 3.141592/4.001);\n        sceneRGB = (sceneRGB - 0.5) * slant + 0.5;\n        if ( preserveColor == 1 )\n        {\n            float maxval = max( sceneRGB.r, sceneRGB.g );\n            maxval = max( maxval, sceneRGB.b );\n            if ( maxval > 1.0 )\n            {\n                sceneRGB /= maxval;\n            }\n        }\n        sceneRGB = clamp(sceneRGB,0.0,1.0);\n    }\n    if ( grayscale == 1 ) {\n        sceneRGB.rgb = vec3(luminance_post(sceneRGB.rgb));\n    }\n    return sceneRGB;\n}\nvoid main() {\n    int foundEdge = 0;\n    foundEdge = ( idEdges == 1 && isObjectEdge() == 1 ) ? 1 : 0;\n    if ( foundEdge == 0 && (normalEdges == 1 || depthEdges == 1) ) {\n        foundEdge = isNormalDepthEdge();\n    }\n    vec2 loc = vec2((vUv.x-0.5)*(resolution.y/resolution.x),vUv.y-0.5)*repeats;\n    if ( style > 2 && rotation != 0.0 ) {\n        float rot = 3.14159*rotation;\n        float sinr = sin(rot);\n        float cosr = cos(rot);\n        loc = vec2(loc.x*cosr + -loc.y*sinr, loc.x*sinr + loc.y*cosr);\n    }\n    loc += vec2(0.5,0.5);\n    vec3 color;\n    if ( style == 2 ) {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(quantize(colorWithAdjustments()),1.0);\n        }\n    } else if ( style == 3 ) {\n        color = colorWithAdjustments();\n        vec3 graphColor = computeGraphite( color, loc );\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.16,0.16,0.16,1.0) + vec4(0.18 * graphColor,0.0);\n        } else {\n            gl_FragColor = vec4(graphColor,1.0);\n        }\n        return;\n    } else if ( style == 4 ) {\n        float fill = texture2D(tFill, loc ).r;\n        float paperStrength = 0.3;\n        vec3 paper = texture2D(tPaper, loc ).rgb;\n        paper = paperStrength * paper + (1.0-paperStrength)*vec3(1.0,1.0,1.0);\n        if ( foundEdge == 1 ) {\n            gl_FragColor = 0.75 * vec4(paper * fill, 1.0);\n        } else {\n            fill = pow(fill,1.6);\n            gl_FragColor = vec4(colorWithAdjustments() * (1.0 - fill) + paper * fill, 1.0);\n        }\n    } else {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(colorWithAdjustments(),1.0);\n        }\n        return;        \n    }\n}\n"},"./src/wgs/render/shaders/copy_frag.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/copy_frag.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n}\n"},"./src/wgs/render/shaders/edge_frag.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/edge_frag.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nuniform vec4 color;\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    gl_FragColor = color;\n}"},"./src/wgs/render/shaders/edge_vert.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/edge_vert.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<instancing_decl_vert>\nvoid main() {\n    vec3 instPos = getInstancePos(position);\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}"},"./src/wgs/render/shaders/fxaa_frag.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/fxaa_frag.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="#define FXAA_EDGE_SHARPNESS (8.0)\n#define FXAA_EDGE_THRESHOLD (0.125)\n#define FXAA_EDGE_THRESHOLD_MIN (0.05)\n#define FXAA_RCP_FRAME_OPT (0.50)\n#define FXAA_RCP_FRAME_OPT2 (2.0)\nuniform sampler2D tDiffuse;\nuniform highp vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nfloat FxaaLuma(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n    float lumaNw = FxaaLuma(texture2D(tDiffuse, vPosPos.xy).rgb);\n    float lumaSw = FxaaLuma(texture2D(tDiffuse, vPosPos.xw).rgb);\n    float lumaNe = FxaaLuma(texture2D(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;\n    float lumaSe = FxaaLuma(texture2D(tDiffuse, vPosPos.zw).rgb);\n    vec4 rgbaM = texture2D(tDiffuse, vPos.xy);    \n    float lumaM = FxaaLuma(rgbaM.rgb);\n    float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));\n    float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));\n    float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);\n    float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);\n    if (lumaMaxSubMinM < lumaMaxScaledClamped) {\n        gl_FragColor = rgbaM;\n        return;\n    }\n    float dirSwMinusNe = lumaSw - lumaNe;\n    float dirSeMinusNw = lumaSe - lumaNw;\n    vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));\n    vec3 rgbN1 = texture2D(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    vec3 rgbP1 = texture2D(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;\n    vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);\n    vec3 rgbN2 = texture2D(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbP2 = texture2D(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbA = rgbN1 + rgbP1;\n    vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n    float lumaB = FxaaLuma(rgbB);\n    float alpha = rgbaM.a;\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        gl_FragColor = vec4(rgbA * 0.5, rgbaM.a);\n    else\n        gl_FragColor = vec4(rgbB, rgbaM.a);\n}\n"},"./src/wgs/render/shaders/fxaa_vert.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/fxaa_vert.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="uniform vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nvoid main() {\n    vPos = uv;\n    vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;\n    vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},"./src/wgs/render/shaders/gaussian_frag.glsl":
/*!***************************************************!*\
  !*** ./src/wgs/render/shaders/gaussian_frag.glsl ***!
  \***************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n#ifdef HAS_ALPHA\n        texCol.rgb *= texCol.a;\n#endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n#ifdef HAS_ALPHA\n    texColSum.rgb /= (texColSum.a == 0.0 ? 0.0001 : texColSum.a);\n#endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}\n"},"./src/wgs/render/shaders/gaussian_vert.glsl":
/*!***************************************************!*\
  !*** ./src/wgs/render/shaders/gaussian_vert.glsl ***!
  \***************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},"./src/wgs/render/shaders/groundreflection_draw_frag.glsl":
/*!****************************************************************!*\
  !*** ./src/wgs/render/shaders/groundreflection_draw_frag.glsl ***!
  \****************************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    vec4 texel = texture2D( tDiffuse, vUv );\n    gl_FragColor = texel;\n}\n"},"./src/wgs/render/shaders/groundshadow_ao_frag.glsl":
/*!**********************************************************!*\
  !*** ./src/wgs/render/shaders/groundshadow_ao_frag.glsl ***!
  \**********************************************************/
/*! no static exports found */function(e,t){e.exports="#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\n    return rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\n    float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\n    vec2 sampleOffset = unitDirection * radius;\n    float idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\n    float depth = 1.0 - idepth;\n    if (depth < 1e-6) {\n        if (radius == 0.0)\n            return vec2(1.0, 1.0);\n        else\n            return vec2(0.0, 1.0);\n    }\n    vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\n    float distance2 = dot(dir,dir);\n    float idistance = 1.0 / sqrt(distance2);\n    vec3 ndir = dir * idistance;\n#ifdef PRESET_2\n    float importance = ndir.y * idistance;\n#else\n    float importance = ndir.y / distance2;\n#endif\n    vec2 ret;\n    ret.x = (idepth == 0.0) ? 0.0 : importance;\n    ret.y = importance;\n    return ret;\n}\nvoid main() {\n    vec2 sum = vec2(0.0);\n    float angle = getRandomAngle(vUv);\n    for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\n        float ssR;\n        vec2 uv = tapLocation(i, angle, ssR);\n        sum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n    }\n    float ao = sum.x / sum.y;\n    gl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}\n"},"./src/wgs/render/shaders/groundshadow_blur_frag.glsl":
/*!************************************************************!*\
  !*** ./src/wgs/render/shaders/groundshadow_blur_frag.glsl ***!
  \************************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\n    float depthVal = 0.0;\n    float sum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        depthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\n        sum += KERNEL_VAL(x);\n    }\n    gl_FragColor = packDepth(depthVal/sum);\n}\n"},"./src/wgs/render/shaders/groundshadow_color_frag.glsl":
/*!*************************************************************!*\
  !*** ./src/wgs/render/shaders/groundshadow_color_frag.glsl ***!
  \*************************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;\n#include<pack_depth>\nvoid main() {\n    float depthVal = unpackDepth(texture2D(tDepth, vUv));\n    gl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}\n"},"./src/wgs/render/shaders/groundshadow_depth_frag.glsl":
/*!*************************************************************!*\
  !*** ./src/wgs/render/shaders/groundshadow_depth_frag.glsl ***!
  \*************************************************************/
/*! no static exports found */function(e,t){e.exports="#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying float vFragDepth;\n#endif\n#endif\n#include<pack_depth>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef USE_LOGDEPTHBUF_EXT\n    float depth = gl_FragDepthEXT / gl_FragCoord.w;\n#else\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n#endif\n    depth = 1.0 - depth;\n    gl_FragColor = packDepth(depth);\n}\n"},"./src/wgs/render/shaders/groundshadow_depth_vert.glsl":
/*!*************************************************************!*\
  !*** ./src/wgs/render/shaders/groundshadow_depth_vert.glsl ***!
  \*************************************************************/
/*! no static exports found */function(e,t){e.exports="#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n    vFragDepth = 1.0 + gl_Position.w;\n#else\n    gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n#endif\n}\n"},"./src/wgs/render/shaders/leafletdiff_frag.glsl":
/*!******************************************************!*\
  !*** ./src/wgs/render/shaders/leafletdiff_frag.glsl ***!
  \******************************************************/
/*! no static exports found */function(e,t){e.exports="#define HIGHLIGHT_NONE 0\n#define HIGHLIGHT_A 1\n#define HIGHLIGHT_B 2\n#define MIN_DIFF_VAL 0.5\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float splitPosition;\nuniform int model;\nuniform int highlight;\nuniform vec2 resolution1;\nuniform vec2 resolution2;\nuniform float diff_threshold;\nvarying vec2 vUvA;\nvarying vec2 vUvB;\nconst int BIT_COUNT = 2;\nint modi(int x, int y) {\n    return x - y * (x / y);\n}\nint and(int a, int b) {\n    int result = 0;\n    int n = 1;\n    for(int i = 0; i < BIT_COUNT; i++) {\n        if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n            result += n;\n        }\n        a = a / 2;\n        b = b / 2;\n        n = n * 2;\n        if(!(a > 0 && b > 0)) {\n            break;\n        }\n    }\n    return result;\n}\nfloat toGrayscale(vec4 v) {\n    return dot(v.rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n#ifdef SINGLE_MODEL\n    vec4 tex = texture2D(texture1, vUvA);\n    #ifdef SPLIT_VIEW\n    if (model == 1 && gl_FragCoord.x < splitPosition ||\n        model == 2 && gl_FragCoord.x >= splitPosition) {\n        gl_FragColor = tex;\n    } else {\n        discard;\n    }\n    #else\n    float gray = toGrayscale(tex);\n    gl_FragColor.rgb = vec3(gray);\n    #endif\n#else\n    vec4 tex1 = texture2D(texture1, vUvA);\n    vec4 tex2 = texture2D(texture2, vUvB);\n    #ifdef SPLIT_VIEW\n    gl_FragColor = gl_FragCoord.x < splitPosition ? tex1 : tex2;\n    #else\n    float gray1 = toGrayscale(tex1);\n    float gray2 = toGrayscale(tex2);\n    float maxGray = min(gray1, gray2);\n    float delta = gray1 - gray2;\n    gl_FragColor.rgb = vec3(maxGray);\n    if (abs(delta) > diff_threshold) {\n        if (delta < 0.0 && and(highlight, HIGHLIGHT_A) == HIGHLIGHT_A) {\n            gl_FragColor = vec4(max(gray2, MIN_DIFF_VAL), 0.0, 0.0, 1.0);\n        } else if (delta > 0.0 && and(highlight, HIGHLIGHT_B) == HIGHLIGHT_B) {\n            gl_FragColor = vec4(0.0, 0.0, max(gray1, MIN_DIFF_VAL), 1.0);\n        }\n    }\n        #ifdef ADD_THICKENING\n    else {\n        bool found = false;\n        for (int i = 0; i < 3; i++) {\n            for (int j = 0; j < 3; j++) {\n                if (i != 1 && j != 1) {\n                    vec4 nTex1 = texture2D(texture1, vUvA + resolution1*vec2(i - 1, j - 1));\n                    vec4 nTex2 = texture2D(texture2, vUvB + resolution2*vec2(i - 1, j - 1));\n                    float nGray1 = toGrayscale(nTex1);\n                    float nGray2 = toGrayscale(nTex2);\n                    delta = nGray1 - nGray2;\n                    if (abs(delta) > diff_threshold) {\n                        if (delta < 0.0 && and(highlight, HIGHLIGHT_A) == HIGHLIGHT_A) {\n                            gl_FragColor = vec4(1.25*max(nGray2, MIN_DIFF_VAL), 0.25, 0.25, 1.0);\n                        } else if (delta > 0.0 && and(highlight, HIGHLIGHT_B) == HIGHLIGHT_B) {\n                            gl_FragColor = vec4(0.25, 0.25, 1.25*max(nGray1, MIN_DIFF_VAL), 1.0);\n                        }\n                        found = true;\n                        break;\n                    }\n                }\n            }\n            if (found) break;\n        }\n    }\n        #endif\n    #endif\n#endif\n}"},"./src/wgs/render/shaders/leafletdiff_vert.glsl":
/*!******************************************************!*\
  !*** ./src/wgs/render/shaders/leafletdiff_vert.glsl ***!
  \******************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec2 vUvA;\nvarying vec2 vUvB;\nuniform vec4 uvTFa;\nuniform vec4 uvTFb;\nuniform vec4 offsetRepeatA;\nuniform vec4 offsetRepeatB;\nvoid main() {\n    vUvA = uv*offsetRepeatA.zw + offsetRepeatA.xy;\n   \n#ifndef SINGLE_MODEL\n    float x = (uv.x - uvTFa.x) / uvTFa.z;\n    float y = (uv.y - uvTFa.y) / uvTFa.w;\n    vec2 uvB;\n    uvB.x = uvTFb.x + x*uvTFb.z;\n    uvB.y = uvTFb.y + y*uvTFb.w;\n    vUvB = uvB * offsetRepeatB.zw + offsetRepeatB.xy;\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},"./src/wgs/render/shaders/line_frag.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/line_frag.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="\r\n\r\n\r\n#include<line_decl_common>\r\n#include<id_decl_frag>\r\n\r\nuniform highp float pixelsPerUnit;\r\nuniform highp float aaRange;\r\n\r\nuniform float opacity;\r\nuniform highp float viewportId;\r\nuniform highp float swap;\r\nuniform highp float grayscale;\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nuniform sampler2D tRaster;\r\n#endif\r\n\r\n#ifdef HAS_LINESTYLES\r\nuniform sampler2D tLineStyle;\r\nuniform vec2 vLineStyleTexSize;\r\n#endif\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\nuniform highp vec4 viewportBounds;\r\nvarying highp vec2 vPosition;\r\n#endif\r\n\r\n\r\nfloat curveGaussian(float r, float invWidth) {\r\n    float amt = clamp(r * invWidth, 0.0, 1.0);\r\n\r\n    float exponent = amt * 2.0;\r\n\r\n    return exp(-exponent*exponent);\r\n\r\n\r\n\r\n}\r\n\r\n#ifdef HAS_LINESTYLES\r\nfloat getLinePatternPixel(int i, int j) {\r\n\r\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\r\n}\r\n\r\nfloat getPatternLength(int whichPattern) {\r\n    float p1 = getLinePatternPixel(0, whichPattern);\r\n    float p2 = getLinePatternPixel(1, whichPattern);\r\n    return (p2 * 256.0 + p1);\r\n}\r\n#endif\r\n\r\n\r\nvoid fillLineSegment() {\r\n\r\n    float radius = abs(fsHalfWidth);\r\n    float parametricDistance = fsMultipurpose.x;\r\n    float segmentLength      = fsMultipurpose.y;\r\n    float totalDistance      = fsMultipurpose.z;\r\n\r\n\r\n#ifdef HAS_LINESTYLES\r\n    int whichPattern         = int(fsMultipurpose.w);\r\n\r\n    if (whichPattern > 0) {\r\n        const float TEX_TO_UNIT = 1.0 / 96.0;\r\n\r\n        float patternScale;\r\n\r\n\r\n\r\n        if (fsHalfWidth < 0.0) {\r\n            patternScale = LTSCALE;\r\n        } else {\r\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\r\n        }\r\n\r\n        float patLen = patternScale * getPatternLength(whichPattern);\r\n        float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);\r\n\r\n        bool onPixel = true;\r\n        float radiusPixels = radius * pixelsPerUnit;\r\n\r\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\r\n\r\n            float on = getLinePatternPixel(i, whichPattern);\r\n            if (on == 1.0) on = 0.0;\r\n            on *= patternScale;\r\n\r\n            onPixel = true;\r\n            phase -= on;\r\n            if (phase < 0.0) {\r\n                break;\r\n            }\r\n            else if (phase <= radiusPixels) {\r\n                onPixel = false;\r\n                break;\r\n            }\r\n\r\n            float off = getLinePatternPixel(i+1, whichPattern);\r\n            if (off <= 1.0) off = 0.0;\r\n            off *= patternScale;\r\n\r\n            onPixel = false;\r\n            phase -= off;\r\n            if (phase < -radiusPixels)\r\n                discard;\r\n            if (phase <= 0.0)\r\n                break;\r\n        }\r\n\r\n\r\n\r\n\r\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\r\n            segmentLength = 0.0;\r\n            parametricDistance = phase / pixelsPerUnit;\r\n        }\r\n    }\r\n#endif\r\n\r\n\r\n\r\n\r\n    float dist;\r\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\r\n\r\n\r\n\r\n\r\n    float ltz = max(0.0, sign(-parametricDistance));\r\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\r\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\r\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\r\n\r\n\r\n\r\n\r\n    float range =  dist - radius;\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor = fsColor;\r\n    gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n}\r\n\r\n#ifdef HAS_CIRCLES\r\nvoid fillCircularArc() {\r\n\r\n    float dist   = length(fsOffsetDirection);\r\n    vec2 angles  = fsMultipurpose.xz;\r\n    float radius = abs(fsMultipurpose.y);\r\n    float range  =  abs(dist - radius);\r\n    range -= fsHalfWidth;\r\n\r\n\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n    vec2 direction = fsOffsetDirection;\r\n    float angle = atan(direction.y, direction.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n                angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_ELLIPTICALS\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat EllipticalApprox(\r\n        const int iters,\r\n        inout float t0, inout float t1,\r\n        const vec2 y,   out   vec2 x,\r\n        const vec2 e,   const vec2 ey, const vec2 esqr\r\n        ) {\r\n    vec2 r;\r\n    for (int i = 0; i < 10; ++i) {\r\n        if(i >= iters) break;\r\n\r\n        float t = mix(t0, t1, 0.5);\r\n        r = ey / (vec2(t) + esqr);\r\n\r\n        vec2 rsq = r * r;\r\n        float f = rsq.x + rsq.y - 1.0;\r\n\r\n        if(f > 0.0) { t0 = t; } else { t1 = t; }\r\n    }\r\n\r\n    x = e * r;\r\n    return distance(x, y);\r\n}\r\n\r\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\r\n    float dist;\r\n\r\n\r\n    vec2 esqr = e * e;\r\n    vec2 ey   = e * y;\r\n    float t0 = -esqr[1] + ey[1];\r\n    float t1 = -esqr[1] + length(ey);\r\n\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n    if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\r\n        return dist;\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n\r\n\r\n    float ecc = 1.0 +  0.1 * e[0] / e[1];\r\n\r\n    if (dist > max(ecc * (width + aaRange), e[0] * 0.001))\r\n        return dist;\r\n    if (dist < (width - aaRange) / ecc)\r\n        return dist;\r\n\r\n\r\n\r\n\r\n    dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);\r\n    return dist;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\r\n    vec2 locE, locY;\r\n\r\n\r\n\r\n\r\n    float diff = sign(e[0] - e[1]);\r\n    vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\r\n    locE.x = dot(e, swizzle.xy);\r\n    locE.y = dot(e, swizzle.yx);\r\n    locY.x = dot(y, swizzle.xy);\r\n    locY.y = dot(y, swizzle.yx);\r\n\r\n\r\n    vec2 refl = sign(locY);\r\n    locY *= refl;\r\n\r\n    vec2 x;\r\n    float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\r\n\r\n    x *= refl;\r\n\r\n    locX.x = dot(x, swizzle.xy);\r\n    locX.y = dot(x, swizzle.yx);\r\n\r\n    return distance;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nvoid fillEllipticalArc() {\r\n    vec2 angles = fsMultipurpose.xz;\r\n    vec2 radii  = abs(fsMultipurpose.yw);\r\n    vec2 dir    = fsOffsetDirection;\r\n\r\n\r\n\r\n\r\n    vec2 pos;\r\n    float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);\r\n    range -= fsHalfWidth;\r\n\r\n    if (range > aaRange)\r\n        discard;\r\n\r\n    float ar = radii[0] / radii[1];\r\n\r\n\r\n\r\n\r\n    float angle = atan(ar * pos.y, pos.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n            angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n}\r\n#endif\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nvoid fillTexQuad() { gl_FragColor = texture2D(tRaster, fsMultipurpose.xy); }\r\n#endif\r\n\r\nvoid fillTriangle() { gl_FragColor = fsColor; }\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\n#ifdef MSDF_TEXTURE_FONT\r\nvarying highp vec2 vuv;\r\nvarying float isMSDFQuards;\r\nuniform sampler2D tRaster;\r\nfloat median(float r, float g, float b) {\r\n  return max(min(r, g), min(max(r, g), b));\r\n}\r\n\r\n#endif\r\n\r\n#include<cutplanes>\r\n\r\nvoid main() {\r\n\r\n\r\n\r\n\r\n\r\n    if (fsColor == vec4(0.0)) {\r\n        discard;\r\n    }\r\n\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\n    if(vPosition.x < viewportBounds.x || vPosition.x > viewportBounds.z || vPosition.y < viewportBounds.y || vPosition.y > viewportBounds.w) {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n#ifdef MSDF_TEXTURE_FONT\r\n    vec4 msdfColor = texture2D(tRaster, vuv);\r\n    float dist = median(msdfColor.r, msdfColor.g, msdfColor.b);\r\n\r\n\r\n    float delta = mix(0.25, 0.5, 1.0 - fwidth(dist));\r\n\r\n    float sigDist = dist - delta;\r\n    float msdfAlpha = clamp(sigDist/fwidth(sigDist) + delta, 0.0, 1.0);\r\n\r\n    msdfAlpha = smoothstep(0., 1., msdfAlpha);\r\n    gl_FragColor.a =  mix(msdfAlpha, 1., 1.-isMSDFQuards);\r\n    if (gl_FragColor.a < 0.0001) discard;\r\n\r\n#endif\r\n\r\n\r\n    if (fsHalfWidth == 0.0) {\r\n#ifdef HAS_RASTER_QUADS\r\n        if (fsMultipurpose.z != 0.0)\r\n            fillTexQuad();\r\n        else\r\n#endif\r\n            fillTriangle();\r\n    }\r\n    else if (fsMultipurpose.y < 0.0) {\r\n#ifdef HAS_CIRCLES\r\n#ifdef HAS_ELLIPTICALS\r\n        if (abs(fsMultipurpose.y) == fsMultipurpose.w)\r\n#endif\r\n            fillCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n#ifdef HAS_CIRCLES\r\n        else\r\n#endif\r\n            fillEllipticalArc();\r\n#endif\r\n    }\r\n    else\r\n        fillLineSegment();\r\n\r\n\r\n#ifdef MRT_NORMALS\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragData[1] = vec4(0.0);\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float writeId = 1.0;\r\n    \r\n    gl_FragColor.a *= opacity;\r\n\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n\r\n\r\n\r\n\r\n    if (fsGhosting != 0.0 || \r\n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\r\n\r\n        writeId = 0.0;\r\n\r\n\r\n\r\n        gl_FragColor.a *= ((swap == 1.0) ? 0.21 : 0.1);\r\n    }\r\n\r\n#ifndef SELECTION_RENDERER\r\n\r\n    if (grayscale != 0.0) {\r\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\r\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\r\n        gl_FragColor.rgb = vec3(gray);\r\n    }\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n#include<id_frag>\r\n}\r\n"},"./src/wgs/render/shaders/line_vert.glsl":
/*!***********************************************!*\
  !*** ./src/wgs/render/shaders/line_vert.glsl ***!
  \***********************************************/
/*! no static exports found */function(e,t){e.exports="\r\n\r\n#include<line_decl_common>\r\n\r\nattribute vec2 fields1;\r\nattribute vec4 fields2;\r\nattribute vec4 flags4b;\r\nattribute vec4 layerVp4b;\r\n\r\n#ifdef HAS_ELLIPTICALS\r\nattribute vec3 extraParams;\r\n#endif\r\n\r\n#ifdef USE_INSTANCING\r\nattribute vec4 instFlags4b;\r\n#endif\r\n\r\n#ifdef MSDF_TEXTURE_FONT\r\nvarying highp vec2 vuv;\r\nvarying float isMSDFQuards;\r\n#endif\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\nvarying vec2 vPosition;\r\n#endif\r\n\r\nuniform mat4 mvpMatrix;\r\n\r\nuniform float pixelsPerUnit;\r\nuniform float aaRange;\r\nuniform float viewportId;\r\nuniform float swap;\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_LAYERS\r\nuniform sampler2D tLayerMask;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform sampler2D tSelectionTexture;\r\nuniform vec2 vSelTexSize;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform vec4 selectionColor;\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying vec3 vWorldPosition;\r\n#endif\r\n\r\nvarying vec4 dbId;\r\n\r\n#ifdef UNPACK_POSITIONS\r\nuniform sampler2D tIdColor;\r\nuniform vec2 vIdColorTexSize;\r\nuniform vec4 unpackXform;\r\nattribute vec2 uvIdColor;\r\nfloat unpackLineWeight(float w) {\r\n    if (w > 0.5) {\r\n        return - (w - 0.5) * 1024.0;\r\n    } else {\r\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\r\n    }\r\n}\r\nvec4 getVertexColor() {\r\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\r\n    return texture2D(tIdColor, vec2(u, 0.5));\r\n}\r\nvec4 getDbId() {\r\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\r\n    vec4 normDbId = texture2D(tIdColor, vec2(u, 0.5));\r\n    return normDbId * 255.0;\r\n}\r\n#else\r\nattribute vec4 color4b;\r\nattribute vec4 dbId4b;\r\nvec4 unpackXform;\r\nfloat unpackLineWeight(float w) {\r\n    return w;\r\n}\r\nvec4 getVertexColor() {\r\n    return color4b;\r\n}\r\nvec4 getDbId() {\r\n    return dbId4b;\r\n}\r\n#endif\r\n\r\n\r\nvec2 centralVertex;\r\nvec2 offsetPosition;\r\n\r\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\r\n\r\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\r\n    minPt = min(minPt, p);\r\n    maxPt = max(maxPt, p);\r\n}\r\n\r\n#if defined(USE_INSTANCING)\r\nfloat getVertexId() { return instFlags4b.x; }\r\n#else\r\nfloat getVertexId() { return flags4b.x; }\r\n#endif\r\n\r\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\r\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\r\n\r\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\r\nvoid decodeSegmentData(out SegmentData seg) {\r\n    seg.angle         = fields2.x * TAU - PI;\r\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\r\n    seg.distTotal     = fields2.w;\r\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\r\n    seg.lineType      = flags4b.z;\r\n}\r\n\r\nvoid strokeLineSegment() {\r\n    SegmentData seg; decodeSegmentData(seg);\r\n\r\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\r\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\r\n\r\n\r\n    float angleTransverse = seg.angle + isLeftSide * HALF_PI;\r\n    float lwAdjustment = fsHalfWidth + aaRange;\r\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\r\n    offsetPosition.xy += transverseOffset;\r\n\r\n\r\n\r\n\r\n    float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;\r\n    vec2 along = distanceFromStart * cos_sin(seg.angle);\r\n    offsetPosition.xy += along;\r\n    centralVertex.xy  += along;\r\n\r\n\r\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\r\n    offsetPosition.xy -= moveOffset;\r\n    centralVertex.xy  -= moveOffset;\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\r\n    fsMultipurpose.y = seg.distAlong;\r\n    fsMultipurpose.z = seg.distTotal;\r\n    fsMultipurpose.w = seg.lineType;\r\n\r\n    if (seg.lineWidthHalf < 0.0)\r\n        fsHalfWidth = -fsHalfWidth;\r\n}\r\n\r\n\r\n#ifdef HAS_TRIANGLE_GEOMS\r\nstruct TriangleData { vec2 p0, p1, p2; };\r\nvoid decodeTriangleData(out TriangleData tri) {\r\n\r\n    tri.p1 = vec2(fields2.x, fields2.y) * unpackXform.xy + unpackXform.zw;\r\n    tri.p2 = fields2.zw * unpackXform.xy + unpackXform.zw;\r\n}\r\n\r\nvoid strokeOneTriangle() {\r\n    TriangleData tri; decodeTriangleData(tri);\r\n\r\n\r\n\r\n\r\n\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n\r\n\r\n\r\n\r\n\r\n    float vertexId = getVertexId();\r\n    if (vertexId == VBB_SEG_END_RIGHT)\r\n        offsetPosition.xy = tri.p1;\r\n    else if (vertexId == VBB_SEG_END_LEFT)\r\n        offsetPosition.xy = tri.p2;\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nstruct TexQuadData { float angle; vec2 size; };\r\nvoid decodeTexQuadData(out TexQuadData quad) {\r\n    quad.angle     = fields2.x * TAU;\r\n    quad.size   = fields2.yz * max(unpackXform.x, unpackXform.y);\r\n}\r\n\r\nvoid strokeTexQuad() {\r\n    TexQuadData quad; decodeTexQuadData(quad);\r\n\r\n    vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);\r\n\r\n    vec2 p      = 0.5 * corner * quad.size;\r\n    vec2 rot    = cos_sin(quad.angle);\r\n    vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);\r\n\r\n    offsetPosition.xy += offset;\r\n\r\n    fsMultipurpose.xy = max(vec2(0.0), corner);\r\n\r\n\r\n    fsMultipurpose.z = 1.0;\r\n    fsHalfWidth = 0.0;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)\r\nstruct ArcData { vec2 c; float start, end, major, minor, tilt; };\r\nvoid decodeArcData(out ArcData arc) {\r\n    arc.c     = fields1.xy * unpackXform.xy + unpackXform.zw;\r\n    arc.start = fields2.x * TAU;\r\n    arc.end   = fields2.y * TAU;\r\n    arc.major = fields2.w * max(unpackXform.x, unpackXform.y);\r\n#if defined(HAS_ELLIPTICALS)\r\n    arc.minor = extraParams.x;\r\n    arc.tilt  = extraParams.y * TAU;\r\n#endif\r\n}\r\n\r\nvoid strokeArc(const ArcData arc) {\r\n\r\n\r\n    float isStart = isStartVertex() ? -1.0 : 1.0;\r\n    float isLeft  = isLeftVertex()  ? -1.0 : 1.0;\r\n\r\n\r\n\r\n\r\n    vec2 minPt;\r\n    vec2 maxPt;\r\n\r\n    vec2 angles = vec2(arc.start, arc.end);\r\n    vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);\r\n    vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);\r\n    minPt = maxPt = vec2(endsX.x, endsY.x);\r\n    min_max(minPt, maxPt, vec2(endsX.y, endsY.y));\r\n\r\n    if (arc.end > arc.start) {\r\n        if (arc.start < PI_0_5 && arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI && arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 && arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    } else {\r\n\r\n        min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));\r\n\r\n\r\n\r\n        if (arc.start < PI_0_5 || arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI || arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 || arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    }\r\n\r\n    minPt -= fsHalfWidth + aaRange;\r\n    maxPt += fsHalfWidth + aaRange;\r\n\r\n    offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;\r\n    offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;\r\n\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = arc.start;\r\n    fsMultipurpose.y = -arc.major;\r\n    fsMultipurpose.z = arc.end;\r\n    fsMultipurpose.w = arc.minor;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES)\r\n\r\nvoid strokeCircularArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n\r\n    float r = arc.major;\r\n    if (r * pixelsPerUnit < 0.125)\r\n        r = 0.25 * aaRange;\r\n    arc.major = arc.minor = r;\r\n\r\n    strokeArc(arc);\r\n}\r\n\r\n#endif\r\n\r\n#if defined(HAS_ELLIPTICALS)\r\nvoid strokeEllipticalArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n    strokeArc(arc);\r\n}\r\n#endif\r\n\r\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\r\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\r\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\r\n    attribs.color         = getVertexColor();\r\n    attribs.geomType      = flags4b.y;\r\n    attribs.layerTC       = layerVp4b.xy / 255.0;\r\n    attribs.vpTC          = layerVp4b.zw / 255.0;\r\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\r\n    attribs.ghosting      = flags4b.w;\r\n}\r\n\r\nvoid strokeIndexedTriangle() {\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n}\r\n\r\n#ifdef SELECTION_RENDERER\r\nbool isSelected(const CommonAttribs attribs) {\r\n\r\n\r\n    vec3 oid = getDbId().rgb;\r\n\r\n\r\n    float id01 = oid.r + oid.g * 256.0;\r\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\r\n    float flrt = floor(t);\r\n    float texU = t - flrt;\r\n\r\n\r\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\r\n    t = (id23 + 0.5) / vSelTexSize.y;\r\n    float texV = fract(t);\r\n\r\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\r\n    return selBit.r == 1.0;\r\n}\r\n#endif\r\n\r\nbool isLayerOff(const CommonAttribs attribs) {\r\n#ifdef HAS_LAYERS\r\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\r\n    return (layerBit.r == 0.0);\r\n#else\r\n    return false;\r\n#endif\r\n}\r\n\r\nvec4 getColor(const CommonAttribs attribs) {\r\n\r\n    if (isLayerOff(attribs)) { return vec4(0.0); }\r\n\r\n#ifdef SELECTION_RENDERER\r\n    if (isSelected(attribs)) { return selectionColor; }\r\n    return vec4(0.0);\r\n#else\r\n    return attribs.color;\r\n#endif\r\n}\r\n\r\nvoid main() {\r\n#ifndef UNPACK_POSITIONS\r\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\r\n#endif\r\n\r\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\r\n#ifdef MSDF_TEXTURE_FONT\r\n    vuv = fields2.xy;\r\n    isMSDFQuards = 1.0 - abs(sign(attribs.geomType - VBB_GT_MSDF_TRIANGLE_INDEXED));\r\n#endif\r\n\r\n    fsColor = getColor(attribs);\r\n\r\n    if (swap != 0.0 ) {\r\n\r\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\r\n            fsColor.rgb = vec3(1.0,1.0,1.0);\r\n\r\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\r\n            fsColor.rgb = vec3(0.0,0.0,0.0);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    centralVertex = offsetPosition = attribs.pos;\r\n\r\n    float lineWeight = attribs.lineWidthHalf;\r\n    if (lineWeight > 0.0) {\r\n\r\n\r\n        if(lineWeight < 0.5 / pixelsPerUnit) {\r\n            lineWeight = 0.5 / pixelsPerUnit;\r\n        }\r\n    }\r\n    else {\r\n\r\n\r\n        lineWeight = abs(lineWeight) / pixelsPerUnit;\r\n    }\r\n\r\n    fsHalfWidth = lineWeight;\r\n\r\n    dbId = getDbId() / 255.0;\r\n\r\n    fsVpTC     = attribs.vpTC;\r\n    fsGhosting = attribs.ghosting;\r\n\r\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\r\n#ifdef HAS_CIRCLES\r\n    else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n    else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();\r\n#endif\r\n#ifdef HAS_RASTER_QUADS\r\n    else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();\r\n#endif\r\n#ifdef HAS_TRIANGLE_GEOMS\r\n    else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();\r\n#endif\r\n    else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();\r\n\r\n\r\n\r\n    fsOffsetDirection = offsetPosition - centralVertex;\r\n\r\n\r\n    gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n\r\n\r\n#if NUM_CUTPLANES > 0\r\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n    vWorldPosition = worldPosition.xyz;\r\n#endif\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\n    vPosition = offsetPosition.xy;\r\n#endif\r\n}\r\n"},"./src/wgs/render/shaders/liness_frag.glsl":
/*!*************************************************!*\
  !*** ./src/wgs/render/shaders/liness_frag.glsl ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports="\n#include<line_decl_common>\n#include<id_decl_frag>\nuniform highp float pixelsPerUnit;\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\nuniform highp float grayscale;\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform highp vec4 viewportBounds;\nvarying highp vec2 vPosition;\nuniform mat4 mvpMatrix;\n#endif\nfloat curveGaussian(float r, float width) {\n    float amt = clamp(abs(r / (width * 1.0)), 0.0, 1.0);\n    amt = max(amt - 0.0, 0.0);\n    float exponent = amt * 2.0;\n    return clamp(exp(-exponent*exponent), 0.0, 1.0);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef HAS_LINESTYLES\n    int whichPattern         = int(fsMultipurpose.w);\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance), patLen);\n        bool onPixel = true;\n        float radiusPixels = radius + aaRange;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase;\n        }\n    }\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (range > aaRange) {\n        discard;\n    }\n    gl_FragColor = fsColor;\n    if (range > -aaRange)\n        gl_FragColor.a *= curveGaussian(range+aaRange, aaRange * 2.0);\n}\nvoid fillTriangle() { gl_FragColor = fsColor; }\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n#ifdef VIEWPORT_CLIPPING\n    vec2 topLeft = (mvpMatrix  * vec4(viewportBounds.xy, 0., 1.)).xy;\n    vec2 bottomRight = ( mvpMatrix * vec4(viewportBounds.zw, 0., 1.)).xy;\n    vec2 topRight = (mvpMatrix  * vec4(viewportBounds.zy, 0., 1.)).xy;\n    vec2 bottomLeft = (mvpMatrix  * vec4(viewportBounds.xw, 0., 1.)).xy;\n    float leftBound = min(min(topLeft.x, bottomRight.x), min(topRight.x, bottomLeft.x));\n    float rightBound = max(max(topLeft.x, bottomRight.x), max(topRight.x, bottomLeft.x));\n    float topBound = min(min(topLeft.y, bottomRight.y), min(topRight.y, bottomLeft.y));\n    float bottomBound = max(max(topLeft.y, bottomRight.y), max(topRight.y, bottomLeft.y));\n    if(vPosition.x < leftBound || vPosition.x > rightBound || vPosition.y < topBound || vPosition.y > bottomBound) {\n        discard;\n    }\n#endif\n    if (fsHalfWidth == 0.0) {\n        fillTriangle();\n    }\n    else\n        fillLineSegment();\n#ifdef MRT_NORMALS\n    gl_FragData[1] = vec4(0.0);\n#endif\n    float writeId = 1.0;\n    gl_FragColor.a *= opacity;\n    if (gl_FragColor.a == 0.0) {\n        discard;\n    }\n    if (fsGhosting != 0.0 || \n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        gl_FragColor.a *= ((swap == 1.0) ? 0.21 : 0.1);\n    }\n#ifndef SELECTION_RENDERER\n    if (grayscale != 0.0) {\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\n        gl_FragColor.rgb = vec3(gray);\n    }\n#endif\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#include<id_frag>\n}\n"},"./src/wgs/render/shaders/liness_vert.glsl":
/*!*************************************************!*\
  !*** ./src/wgs/render/shaders/liness_vert.glsl ***!
  \*************************************************/
/*! no static exports found */function(e,t){e.exports="\n#include<line_decl_common>\nattribute vec2 fields1;\nattribute vec4 fields2;\nattribute vec4 flags4b;\nattribute vec4 layerVp4b;\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\n#ifdef VIEWPORT_CLIPPING\nvarying vec2 vPosition;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform vec2 size;\nuniform float viewportId;\nuniform float swap;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvarying vec4 dbId;\n#ifdef UNPACK_POSITIONS\nuniform sampler2D tIdColor;\nuniform vec2 vIdColorTexSize;\nuniform vec4 unpackXform;\nattribute vec2 uvIdColor;\nfloat unpackLineWeight(float w) {\n    if (w > 0.5) {\n        return - (w - 0.5) * 1024.0;\n    } else {\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\n    }\n}\nvec4 getVertexColor() {\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\n    return texture2D(tIdColor, vec2(u, 0.5));\n}\nvec4 getDbId() {\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\n    vec4 normDbId = texture2D(tIdColor, vec2(u, 0.5));\n    return normDbId * 255.0;\n}\n#else\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nvec4 unpackXform;\nfloat unpackLineWeight(float w) {\n    return w;\n}\nvec4 getVertexColor() {\n    return color4b;\n}\nvec4 getDbId() {\n    return dbId4b;\n}\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 offsetPosDepth;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.distTotal     = fields2.w;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment() {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n    float distanceAlong = seg.distAlong;\n    vec2 along = distanceAlong * cos_sin(seg.angle);\n    vec4 endPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along, 0.0, 1.0));\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd = endPosition.xy * 0.5 * size / endPosition.w;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n    }\n    vec2 screenDelta = screenEnd - screenStart;\n    float screenAngle = (distanceAlong == 0.0) ? 0.0 : atan(screenDelta.y, screenDelta.x);\n    float angleTransverse = screenAngle - isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\n    offsetPosition += transverseOffset;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\n    offsetPosition += moveOffset;\n    centralVertex += moveOffset;\n    float distanceFromStart = max(0.0, isStartCapVertex) * length(screenDelta);\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\n    fsMultipurpose.y = length(screenDelta);\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = seg.lineType;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    fsOffsetDirection = offsetPosition - centralVertex;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n}\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\n    attribs.color         = getVertexColor();\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    gl_Position = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = getDbId().rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\nvoid main() {\n#ifndef UNPACK_POSITIONS\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\n#endif\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n    fsColor = getColor(attribs);\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    if (lineWeight > 0.0) {\n        lineWeight = max(0.5, lineWeight * pixelsPerUnit);\n    }\n    else {\n        lineWeight = max(0.5, abs(lineWeight));\n    }\n    fsHalfWidth = lineWeight;\n    dbId = dbId4b / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\n    else strokeIndexedTriangle();\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef VIEWPORT_CLIPPING\n    vPosition = gl_Position.xy;\n#endif\n}\n"},"./src/wgs/render/shaders/normals_frag.glsl":
/*!**************************************************!*\
  !*** ./src/wgs/render/shaders/normals_frag.glsl ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports="varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    gl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}\n"},"./src/wgs/render/shaders/normals_vert.glsl":
/*!**************************************************!*\
  !*** ./src/wgs/render/shaders/normals_vert.glsl ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}\n"},"./src/wgs/render/shaders/phong_frag.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/phong_frag.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\n\r\n#include<env_sample>\r\n\r\n#ifdef USE_COLOR\r\nvarying vec3 vColor;\r\n#endif\r\n\r\n#ifdef GAMMA_INPUT\r\nvec3 InputToLinear(vec3 c) {\r\n    return c * c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c * c;\r\n}\r\n#else\r\nvec3 InputToLinear(vec3 c) {\r\n    return c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c;\r\n}\r\n#endif\r\n\r\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\r\nvarying vec2 vUv;\r\n#endif\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\nvarying vec2 vUvBump;\r\n#endif\r\n\r\n#if defined( USE_ALPHAMAP )\r\nvarying vec2 vUvAlpha;\r\n#endif\r\n\r\n#ifdef USE_MAP\r\nuniform sampler2D map;\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT > 0\r\nuniform float exposureBias;\r\n#include<tonemap>\r\n#endif\r\n\r\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\r\nuniform float envMapExposure;\r\n#endif\r\n\r\n#ifdef USE_FOG\r\nuniform vec3 fogColor;\r\nuniform float fogNear;\r\nuniform float fogFar;\r\n#endif\r\n#include<id_decl_frag>\r\n#include<theming_decl_frag>\r\n#include<shadowmap_decl_frag>\r\n\r\n#ifdef USE_ENVMAP\r\n\r\nuniform float reflMipIndex;\r\n\r\nuniform float reflectivity;\r\nuniform samplerCube envMap;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\nuniform float refractionRatio;\r\n\r\n#endif\r\n\r\nvec3 sampleReflection(vec3 dir, float mipIndex) {\r\n\r\n    vec3 adjDir = adjustLookupVector(dir);\r\n\r\n#ifdef ENV_GAMMA\r\n\r\n#ifdef HAVE_TEXTURE_LOD\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n#else\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\r\n#endif\r\n\r\n    return GammaDecode(envTexColor, envMapExposure);\r\n\r\n#elif defined(ENV_RGBM)\r\n\r\n#ifdef HAVE_TEXTURE_LOD\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n#else\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\r\n#endif\r\n\r\n    return RGBMDecode(envTexColor, envMapExposure);\r\n\r\n#else\r\n\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir );\r\n    vec3 cubeColor = envTexColor.xyz;\r\n\r\n#ifdef GAMMA_INPUT\r\n    cubeColor *= cubeColor;\r\n#endif\r\n\r\n    return cubeColor;\r\n\r\n#endif\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\nuniform vec3 ambientLightColor;\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\r\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\r\n\r\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\r\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\r\n\r\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\nuniform samplerCube irradianceMap;\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\nvarying highp vec3 vViewPosition;\r\n#ifndef FLAT_SHADED\r\nvarying highp vec3 vNormal;\r\n#endif\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\nuniform sampler2D bumpMap;\r\nuniform float bumpScale;\r\n\r\n\r\n\r\n\r\n\r\n\r\nvec2 dHdxy_fwd() {\r\n\r\n    vec2 dSTdx = dFdx( vUvBump );\r\n    vec2 dSTdy = dFdy( vUvBump );\r\n\r\n    float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\r\n    float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\r\n    float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\r\n\r\n    return vec2( dBx, dBy );\r\n\r\n}\r\n\r\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\r\n\r\n    vec3 vSigmaX = dFdx( surf_pos );\r\n    vec3 vSigmaY = dFdy( surf_pos );\r\n    vec3 vN = surf_norm;\r\n\r\n    vec3 R1 = cross( vSigmaY, vN );\r\n    vec3 R2 = cross( vN, vSigmaX );\r\n\r\n    float fDet = dot( vSigmaX, R1 );\r\n\r\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\r\n    return normalize( abs( fDet ) * surf_norm - vGrad );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_NORMALMAP\r\n\r\nuniform sampler2D normalMap;\r\nuniform vec2 normalScale;\r\n\r\n\r\n\r\n\r\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\r\n\r\n    vec3 q0 = dFdx( eye_pos.xyz );\r\n    vec3 q1 = dFdy( eye_pos.xyz );\r\n    vec2 st0 = dFdx( vUvBump.st );\r\n    vec2 st1 = dFdy( vUvBump.st );\r\n\r\n    vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\r\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\r\n    vec3 N = normalize( surf_norm );\r\n\r\n    vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\r\n    mapN.xy = normalScale * mapN.xy;\r\n    mat3 tsn = mat3( S, T, N );\r\n    return normalize( tsn * mapN );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_SPECULARMAP\r\nuniform sampler2D specularMap;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\nuniform sampler2D alphaMap;\r\n#endif\r\n\r\n#include<hatch_pattern>\r\n\r\n#ifdef USE_LOGDEPTHBUF\r\nuniform float logDepthBufFC;\r\n#ifdef USE_LOGDEPTHBUF_EXT\r\n#extension GL_EXT_frag_depth : enable\r\nvarying highp float vFragDepth;\r\n#endif\r\n#endif\r\n\r\nvec3 Schlick_v3(vec3 v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + (1.0 - v) * pow(facing, 5.0);\r\n}\r\n\r\nfloat Schlick_f(float v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + ( 1.0 - v ) * pow(facing, 5.0);\r\n}\r\n\r\n#include<cutplanes>\r\n\r\nvoid main() {\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\r\n\r\n#ifdef USE_MAP\r\n    vec4 texelColor = GET_MAP(vUv);\r\n#ifdef MAP_INVERT\r\n    texelColor.xyz = 1.0-texelColor.xyz;\r\n#endif\r\n#ifdef GAMMA_INPUT\r\n    texelColor.xyz *= texelColor.xyz;\r\n#endif\r\n    gl_FragColor = gl_FragColor * texelColor;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\n    vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\r\n    gl_FragColor.a *= texelAlpha.r;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n    if ( gl_FragColor.a < ALPHATEST ) discard;\r\n#endif\r\n\r\n    float specularStrength;\r\n\r\n#ifdef USE_SPECULARMAP\r\n    vec4 texelSpecular = GET_SPECULARMAP(vUv);\r\n    specularStrength = texelSpecular.r;\r\n#else\r\n    specularStrength = 1.0;\r\n#endif\r\n\r\n#ifndef FLAT_SHADED\r\n    vec3 normal = normalize( vNormal );\r\n#ifdef DOUBLE_SIDED\r\n\r\n#endif\r\n#else\r\n    vec3 fdx = dFdx( vViewPosition );\r\n    vec3 fdy = dFdy( vViewPosition );\r\n    vec3 normal = normalize( cross( fdx, fdy ) );\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 viewDirection;\r\n    if (projectionMatrix[3][3] == 0.0) {\r\n        viewDirection = normalize( vViewPosition );\r\n    } else {\r\n        viewDirection = vec3(0.0, 0.0, 1.0);\r\n    }\r\n    normal = faceforward(normal, -viewDirection, normal);\r\n\r\n    vec3 geomNormal = normal;\r\n\r\n#ifdef USE_NORMALMAP\r\n    normal = perturbNormal2Arb( -vViewPosition, normal );\r\n#elif defined( USE_BUMPMAP )\r\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\r\n#endif\r\n\r\n    vec3 totalDiffuse = vec3( 0.0 );\r\n    vec3 totalSpecular = vec3( 0.0 );\r\n\r\n\r\n\r\n    float shininessB = shininess * 4.0;\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\n    vec3 pointDiffuse  = vec3( 0.0 );\r\n    vec3 pointSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( pointLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, lVector );\r\n\r\n        float pointDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\r\n        pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\r\n\r\n\r\n\r\n        vec3 pointHalfVector = normalize( lVector + viewDirection );\r\n        float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\r\n\r\n        float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\r\n        pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\r\n\r\n    }\r\n\r\n    totalDiffuse += pointDiffuse;\r\n    totalSpecular += pointSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\n    vec3 spotDiffuse  = vec3( 0.0 );\r\n    vec3 spotSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( spotLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\r\n\r\n        if ( spotEffect > spotLightAngleCos[ i ] ) {\r\n\r\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\r\n\r\n\r\n\r\n            float dotProduct = dot( normal, lVector );\r\n\r\n            float spotDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n            spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\r\n\r\n\r\n\r\n            vec3 spotHalfVector = normalize( lVector + viewDirection );\r\n            float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\r\n            float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\r\n\r\n            float specularNormalization = shininessB * 0.125 + 0.25;\r\n            vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\r\n            spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\r\n        }\r\n\r\n    }\r\n\r\n    totalDiffuse += spotDiffuse;\r\n    totalSpecular += spotSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\n    vec3 dirDiffuse  = vec3( 0.0 );\r\n    vec3 dirSpecular = vec3( 0.0 );\r\n\r\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\r\n\r\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\r\n        vec3 dirVector = normalize( lDirection.xyz );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, dirVector );\r\n\r\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n        dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\r\n\r\n\r\n\r\n        vec3 dirHalfVector = normalize( dirVector + viewDirection );\r\n        float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\r\n        float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\r\n\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\r\n\r\n        dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\r\n\r\n    }\r\n\r\n    totalDiffuse += dirDiffuse;\r\n    totalSpecular += dirSpecular;\r\n\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\r\n    vec3 indirectDiffuse = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\r\n\r\n    indirectDiffuse = applyEnvShadow(indirectDiffuse, worldNormal);\r\n\r\n    totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\r\n#endif\r\n\r\n\r\n#ifdef METAL\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\r\n#else\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_COLOR\r\n    gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\r\n#endif\r\n\r\n\r\n#if defined(USE_ENVMAP)\r\n\r\n    vec3 reflectVec;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n#ifdef ENVMAP_MODE_REFLECTION\r\n    reflectVec = reflect( -viewDirection, normal );\r\n#else \r\n    reflectVec = refract( -viewDirection, normal, refractionRatio );\r\n#endif\r\n\r\n#else\r\n\r\n    reflectVec = reflect( -viewDirection, normal );\r\n\r\n#endif\r\n\r\n    reflectVec = mat3(viewMatrixInverse) * reflectVec;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float reflectScale = 1.0;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\r\n\r\n    cubeColor *= reflectScale;\r\n\r\n    float facing = dot( viewDirection, normal );\r\n\r\n\r\n\r\n\r\n\r\n    if (facing < -1e-2)\r\n        facing = 1.0;\r\n    else\r\n        facing = max(1e-6, facing);\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\n\r\n\r\n    facing = min(1.0, facing + bumpScale * 7.0);\r\n\r\n#endif\r\n\r\n    vec3 schlickRefl;\r\n\r\n#ifdef METAL\r\n\r\n\r\n    schlickRefl = InputToLinear(specular);\r\n\r\n#else\r\n\r\n\r\n    schlickRefl = Schlick_v3(InputToLinear(specular), facing);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float invSchlick = pow(1.0 - facing * 0.5, 5.0);\r\n\r\n\r\n    float norm_factor = (28.0 / 23.0) * (1.0 - invSchlick) * (1.0 - invSchlick);\r\n\r\n    gl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\r\n\r\n#endif\r\n\r\n\r\n    gl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\r\n\r\n#ifdef CLEARCOAT\r\n\r\n    vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\r\n    reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\r\n\r\n    vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\r\n\r\n\r\n    float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\r\n\r\n\r\n\r\n    gl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\r\n\r\n#endif\r\n\r\n\r\n\r\n\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT == 1\r\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\r\n#elif TONEMAP_OUTPUT == 2\r\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_FOG\r\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\r\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\r\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\r\n#endif\r\n#include<theming_frag>\r\n#include<final_frag>\r\n\r\n}\r\n"},"./src/wgs/render/shaders/phong_vert.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/phong_vert.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<wide_lines_decl>\n#include<shadowmap_decl_vert>\nvoid main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n    vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\n    vColor = color * color;\n#else\n    vColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n#include<wide_lines_vert>\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<shadowmap_vert>\n#include<id_vert>\n}\n"},"./src/wgs/render/shaders/prism_frag.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/prism_frag.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="\n#include<common>\n#define RECIPROCAL_PI 0.318309886\n#define ONE 0.00390625\nuniform float opacity;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform sampler2D importantSamplingRandomMap;\nuniform sampler2D importantSamplingSolidAngleMap;\n#if defined( PRISMOPAQUE )\nuniform vec3 opaque_albedo;\nuniform float opaque_f0;\nuniform vec3 opaque_luminance_modifier;\nuniform float opaque_luminance;\n#elif defined( PRISMMETAL )\nuniform vec3 metal_f0;\n#elif defined( PRISMLAYERED )\nuniform float layered_f0;\nuniform vec3 layered_diffuse;\nuniform float layered_fraction;\nuniform vec3 layered_bottom_f0;\nuniform float layered_roughness;\nuniform float layered_anisotropy;\nuniform float layered_rotation;\n#elif defined( PRISMTRANSPARENT )\nuniform float transparent_ior;\nuniform vec3 transparent_color;\nuniform float transparent_distance;\n#elif defined( PRISMGLAZING )\nuniform vec3 glazing_f0;\nuniform vec3 glazing_transmission_color;\nuniform float glazing_transmission_roughness;\n#elif defined( PRISMWOOD )\nuniform bool wood_fiber_cosine_enable;\nuniform int wood_fiber_cosine_bands;\nuniform vec4 wood_fiber_cosine_weights;\nuniform vec4 wood_fiber_cosine_frequencies;\nuniform bool wood_fiber_perlin_enable;\nuniform int wood_fiber_perlin_bands;\nuniform vec4 wood_fiber_perlin_weights;\nuniform vec4 wood_fiber_perlin_frequencies;\nuniform float wood_fiber_perlin_scale_z;\nuniform bool wood_growth_perlin_enable;\nuniform int wood_growth_perlin_bands;\nuniform vec4 wood_growth_perlin_weights;\nuniform vec4 wood_growth_perlin_frequencies;\nuniform float wood_latewood_ratio;\nuniform float wood_earlywood_sharpness;\nuniform float wood_latewood_sharpness;\nuniform float wood_ring_thickness;\nuniform bool wood_earlycolor_perlin_enable;\nuniform int wood_earlycolor_perlin_bands;\nuniform vec4 wood_earlycolor_perlin_weights;\nuniform vec4 wood_earlycolor_perlin_frequencies;\nuniform vec3 wood_early_color;\nuniform bool wood_use_manual_late_color;\nuniform vec3 wood_manual_late_color;\nuniform bool wood_latecolor_perlin_enable;\nuniform int wood_latecolor_perlin_bands;\nuniform vec4 wood_latecolor_perlin_weights;\nuniform vec4 wood_latecolor_perlin_frequencies;\nuniform float wood_late_color_power;\nuniform bool wood_diffuse_perlin_enable;\nuniform int wood_diffuse_perlin_bands;\nuniform vec4 wood_diffuse_perlin_weights;\nuniform vec4 wood_diffuse_perlin_frequencies;\nuniform float wood_diffuse_perlin_scale_z;\nuniform bool wood_use_pores;\nuniform int wood_pore_type;\nuniform float wood_pore_radius;\nuniform float wood_pore_cell_dim;\nuniform float wood_pore_color_power;\nuniform float wood_pore_depth;\nuniform bool wood_use_rays;\nuniform float wood_ray_color_power;\nuniform float wood_ray_seg_length_z;\nuniform float wood_ray_num_slices;\nuniform float wood_ray_ellipse_z2x;\nuniform float wood_ray_ellipse_radius_x;\nuniform bool wood_use_latewood_bump;\nuniform float wood_latewood_bump_depth;\nuniform bool wood_use_groove_roughness;\nuniform float wood_groove_roughness;\nuniform float wood_diffuse_lobe_weight;\nuniform sampler2D permutationMap;\nuniform sampler2D gradientMap;\nuniform sampler2D perm2DMap;\nuniform sampler2D permGradMap;\nuniform vec4 wood_ring_fraction;\nuniform vec2 wood_fall_rise;\n#endif\n#ifdef USE_TILING\nuniform mat4 tilingOverallTransform;\nuniform sampler2D TilingMap;\nuniform mat3 TilingMap_texMatrix;\nuniform vec4 uv2tile;\nuniform vec4 tile2uv;\nuniform vec2 tileAlignOffset;\nuniform mat4 tilingUVTransform;\n#ifdef USE_TILING_NORMAL\nuniform sampler2D TilingNormalMap;\nuniform mat3 TilingNormalMap_texMatrix;\n#endif\n#ifdef USE_TILING_RANDOM\nuniform sampler2D TilingRandomMap;\nuniform mat3 TilingRandomMap_texMatrix;\nuniform vec2 tilingRandomAxisS;\nuniform vec2 tilingRandomAxisT;\nuniform vec2 tilingRandomAlignmentOffset;\n#endif\n#endif\nuniform float envExponentMin;\nuniform float envExponentMax;\nuniform float envExponentCount;\n#include<env_sample>\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\n#include<id_decl_frag>\n#include<theming_decl_frag>\n#include<shadowmap_decl_frag>\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#prism_check<USE_MAP>\n#if defined(USE_MAP) || defined(USE_TILING)\nvarying vec2 vUv;\n#endif\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#endif\n#prism_uniforms<surface_albedo_map>\n#prism_uniforms<surface_roughness_map>\n#prism_uniforms<surface_cutout_map>\n#prism_uniforms<surface_anisotropy_map>\n#prism_uniforms<surface_rotation_map>\n#prism_uniforms<opaque_albedo_map>\n#prism_uniforms<opaque_f0_map>\n#prism_uniforms<opaque_luminance_modifier_map>\n#prism_uniforms<layered_bottom_f0_map>\n#prism_uniforms<layered_f0_map>\n#prism_uniforms<layered_diffuse_map>\n#prism_uniforms<layered_fraction_map>\n#prism_uniforms<layered_roughness_map>\n#prism_uniforms<layered_anisotropy_map>\n#prism_uniforms<layered_rotation_map>\n#prism_uniforms<metal_f0_map>\n#prism_uniforms<glazing_f0_map>\n#prism_uniforms<glazing_transmission_roughness_map>\n#prism_uniforms<glazing_transmission_color_map>\n#prism_uniforms<wood_curly_distortion_map>\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nuniform bool wood_curly_distortion_enable;\nuniform float wood_curly_distortion_scale;\n#endif\n#prism_bump_uniforms<surface_normal_map>\n#prism_bump_uniforms<layered_normal_map>\nfloat SRGBToLinearComponent(float color) {\n    float result = color;\n    if (result<=0.04045)\n        result *= 0.07739938;\n    else\n        result = pow(abs((result+0.055)*0.947867298), 2.4);\n    return result;\n}\nvec3 SRGBToLinear(vec3 color) {\n    vec3 result = color;\n    result.x = SRGBToLinearComponent(result.x);\n    result.y = SRGBToLinearComponent(result.y);\n    result.z = SRGBToLinearComponent(result.z);\n    return result;\n}\n#if defined( USE_ENVMAP )\nuniform float envMapExposure;\nuniform samplerCube envMap;\n#endif\n#include<normal_map>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#if defined( PRISMWOODBUMP )\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if defined( USE_ENVMAP )\nvec3 sampleReflection(vec3 N, vec3 V, float mipIndex) {\n    vec3 dir = (2.0 * dot(V, N)) * N - V;\n    dir = adjustLookupVector(mat3(viewMatrixInverse) * dir);\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return RGBMDecode(envTexColor, envMapExposure);\n#else\n    vec4 envTexColor = textureCube( envMap, dir );\n    vec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\n    cubeColor *= cubeColor;\n#endif\n    return cubeColor;\n#endif\n}\n#endif\n#include<hatch_pattern>\n#if defined( USE_ENVMAP ) && defined( USE_IRRADIANCEMAP )\nuniform samplerCube irradianceMap;\nvec3 sampleNormal(vec3 normal) {\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\n    vec3 irradiance = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\n    irradiance = applyEnvShadow(irradiance, worldNormal);\n    return irradiance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\nfloat sqr(float x) {return x*x;}\nfloat aSqrd(float maxAlphaSqr, float cosTheta)\n{\n    if (abs(cosTheta) < 1e-10)\n    {\n        return 1e10;\n    }\n    float tan2 = 1.0/sqr(cosTheta) - 1.0;\n    return maxAlphaSqr * tan2;\n}\nvec3 Fresnel_Schlick(vec3 f0, float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    return f0 + (1.0 - f0) * x5;\n}\nvec3 Fresnel_Rough(vec3 f0, float cosAngle, float alpha)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    vec3 maxReflectance = mix(vec3(1.0), f0, vec3(min(0.7, alpha)) / 0.7);\n    return f0 + (maxReflectance - f0) * x5;\n}\nfloat IORToReflectance(float ior)\n{\n    return sqr((1.0 - ior)/(1.0 + ior));\n}\nvec2 RoughnessToAlpha(float roughness, float anisotropy)\n{\n    vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);\n    alpha = alpha * alpha;\n    alpha = clamp(alpha, 0.001, 1.0);\n    return alpha;\n}\nfloat AlphaToPhong(float alpha)\n{\n    return max(0.0, 2.56/alpha - 7.0);\n}\nfloat ExponentToReflMipIndex(float exponent)\n{\n    float targetLog = log2(exponent);\n    float minLog = log2(envExponentMin);\n    float maxLog = log2(envExponentMax);\n    float deltaLog = clamp(targetLog - minLog, 0.0, maxLog - minLog);\n    float level = clamp((1.0-(deltaLog + 0.5) / envExponentCount), 0.0, 1.0) * 6.0;\n    return level;\n}\n#include<prism_wood>\n#if defined( ENABLEIMPORTANTSAMPLING ) && (defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ))\n#define IMPORTANTSAMPLING\n#endif\n#if defined( IMPORTANTSAMPLING )\n#define SAMPLECOUNT 32\nvec2 Hammersley(int index)\n{\n    float u = (float(index) + 0.5) / 32.0;\n    float v = 0.5;\n    float noise = texture2D(importantSamplingRandomMap, vec2(u, v), 0.0).r;\n   return vec2(2.0 * PI * float(index/SAMPLECOUNT), noise);\n}\nvec3 ImportanceSampleAnisotropicGGX(int index, vec2 alpha, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec2 uniformSample2D = Hammersley(index);\n    float coef = sqrt(uniformSample2D.y / (1.0 - uniformSample2D.y));\n    float sinSigma, cosSigma;\n    sinSigma = sin(uniformSample2D.x);\n    cosSigma = cos(uniformSample2D.x);\n    vec3 H = coef * ((alpha.x * cosSigma) * Tu + (alpha.y * sinSigma) * Tv) + N;\n    H = normalize(H);\n    return H;\n}\nfloat ComputePDF(vec2 alpha, float NdotH, float HdotTu, float HdotTv, float VdotH)\n{\n    float factor1 = HdotTu / alpha.x;\n    float factor2 = HdotTv / alpha.y;\n    float factor3 = factor1 * factor1 + factor2 * factor2 + NdotH * NdotH;\n    float factor = factor3 * factor3 * alpha.x * alpha.y * VdotH * 4.0 * PI;\n    if (factor > 0.0)\n    {\n        return (NdotH / factor);\n    }\n    else\n    {\n        return 0.0;\n    }\n}\n#define INVFACESIZE 0.0078125\nfloat DirectionToSolidAngle(vec3 dir)\n{\n    dir = abs(dir);\n    float first = min(dir.x, dir.y);\n    float temp = max(dir.x, dir.y);\n    float second = min(temp, dir.z);\n    float third = max(temp, dir.z);\n    first /= third;\n    second /= third;\n    float u = (first+1.0)/2.0;\n    float v = (second + 1.0) / 2.0;\n    float solidAngle = texture2D(importantSamplingSolidAngleMap, vec2(u, v), 0.0).r * 0.000255;\n    return solidAngle;\n}\nfloat Smith_GGX(float value)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + value));\n}\nvec2 RoughnessAnisotropyToAlpha(float roughness, float anisotropy)\n{\n    float aspect = sqrt(1.0 - 0.9 * anisotropy);\n    vec2 alpha = vec2(roughness * roughness / aspect, roughness * roughness * aspect);\n    return alpha;\n}\nvec3 ImportanceSamplingSpecular(float angle, vec3 reflectance, float roughness, float anisotropy, vec3 V, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec3 specular = vec3(0.0);\n    float radAngle;\n    if (anisotropy < 1e-10)\n    {\n        radAngle = 0.0;\n    }\n    else\n    {\n        radAngle = -PI * angle;\n    }\n    vec2 alpha = RoughnessAnisotropyToAlpha(roughness, anisotropy);\n    float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n    float NdotV = dot(N, V);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    vec2 sincosTheta;\n    sincosTheta.x = sin(radAngle);\n    sincosTheta.y = cos(radAngle);\n    vec3 Tu1, Tv1;\n    Tu1 = sincosTheta.y * Tu - sincosTheta.x * Tv;\n    Tv1 = sincosTheta.x * Tu + sincosTheta.y * Tv;\n    vec3 H;\n    vec3 sampleLightIntensity;\n    vec3 L;\n    float effectiveSample = 0.0;\n    for (int i = 0; i < SAMPLECOUNT; i++)\n    {\n        H = ImportanceSampleAnisotropicGGX(i, alpha, N, Tu1, Tv1);\n        float VdotH = dot(V, H);\n        L = 2.0 * VdotH * H - V;\n        float NdotH = dot(N, H);\n        float NdotL = dot(N, L);\n        if (NdotL >= 0.0 && NdotV > 0.0 && NdotH > 0.0)\n        {\n            float alpha2NL = aSqrd(alpha2, NdotL);\n            float HdotTu = dot(H, Tu1);\n            float HdotTv = dot(H, Tv1);\n            float pdf = ComputePDF(alpha, NdotH, HdotTu, HdotTv, VdotH);\n            float mipmapLevel = 0.0;\n            if (pdf > 0.0)\n            {\n                mipmapLevel = 0.3 * log2(1.0 / (float(SAMPLECOUNT) * pdf * DirectionToSolidAngle(L)));\n            }\n            mipmapLevel = clamp(mipmapLevel, 0.0, 4.0);\n            L = normalize(L);\n            sampleLightIntensity = sampleReflection(L, L, mipmapLevel).rgb;\n            float G = Smith_GGX(alpha2NL) * Smith_GGX(alpha2NV);\n            vec3 F = Fresnel_Schlick(reflectance, VdotH);\n            float factor = G * VdotH / (NdotH * NdotV);\n            if (factor >= 0.0)\n            {\n                specular += abs(sampleLightIntensity * F * factor);\n                effectiveSample += 1.0;\n            }\n        }\n    }\n    if (effectiveSample > 0.0)\n    {\n        specular /= effectiveSample;\n    }\n    return specular;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\nvec3 DiffuseLobe(vec3 diffuseColor)\n{\n    return diffuseColor * RECIPROCAL_PI;\n}\nvec3 Rotate(vec3 vec, float angle)\n{\n    float s = sin(angle);\n    float c = cos(angle);\n    return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);\n}\nfloat NDF_GGX(float alphaU, float alphaV, vec3 normal)\n{\n    float nx2 = sqr(normal.x);\n    float ny2 = sqr(normal.y);\n    float nz2 = sqr(normal.z);\n    float scale = 1.0/(alphaU * alphaV * PI);\n    return scale/sqr(nx2/sqr(alphaU) + ny2/sqr(alphaV) + nz2);\n}\nfloat G1_GGX(float aSqrd)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + aSqrd));\n}\nvec3 MicrofacetLobe(\n        vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        float roughness, float anisotropy, float rotation, vec3 reflectance)\n{\n    vec2 alpha = RoughnessToAlpha(roughness, anisotropy);\n    Hlocal = Rotate(Hlocal, rotation);\n    vec3 F = Fresnel_Schlick(reflectance, VdotH);\n    float D = NDF_GGX(alpha.x, alpha.y, Hlocal);\n    float alpha2 = max(sqr(alpha.x), sqr(alpha.y));\n    float alpha2NL = aSqrd(alpha2, NdotL);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    float G = G1_GGX(alpha2NL) * G1_GGX(alpha2NV);\n    return max(F * D * G / (4.0 * NdotL * NdotV), vec3(0.0));\n}\n#if defined( PRISMOPAQUE )\nvec3 BRDF_Opaque(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float opaqueF0, vec3 opaqueAlbedo)\n{\n    vec3 diffuse = DiffuseLobe(opaqueAlbedo);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, vec3(opaqueF0));\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMMETAL )\nvec3 BRDF_Metal(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 metalF0)\n{\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, metalF0);\n    return specular*NdotL;\n}\n#elif defined( PRISMLAYERED )\nvec3 BRDF_Layered(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 Hlocal2, float N2dotL, float N2dotH, float N2dotV,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float layeredF0, vec3 layeredDiffuse, float layeredRoughness, float layeredAnisotropy,\n        float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 Fl = Fresnel_Schlick(vec3(layeredF0), NdotL);\n    vec3 Fv = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    vec3 amount = (1.0 - Fl) * (1.0 - Fv);\n    vec3 topSpecular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n            vec3(layeredF0));\n    vec3 topDiffuse = DiffuseLobe(layeredDiffuse);\n    vec3 botSpecular = MicrofacetLobe(\n            Hlocal2, N2dotL, N2dotH, N2dotV, VdotH,\n            layeredRoughness, layeredAnisotropy, layeredRotation,\n            bottom_f0);\n    return topSpecular*NdotL + amount * mix(topDiffuse*NdotL, botSpecular*N2dotL, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 BRDF_Transparent(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, reflectance);\n    return specular*NdotL;\n}\n#elif defined( PRISMGLAZING )\nvec3 BRDF_Glazing(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 glazingF0, vec3 glazingTransmissionColor, float glazingIlluminance)\n{\n    vec3 diffuse = DiffuseLobe(glazingTransmissionColor - vec3(glazingIlluminance, glazingIlluminance, glazingIlluminance));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, glazingF0);\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMWOOD )\nvec3 BRDF_Wood(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse)\n{\n    vec3 diffuse = DiffuseLobe(woodDiffuse);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, 0.0, 0.0, vec3(0.04));\n    return (specular+diffuse)*NdotL;\n}\n#endif\n#endif\n#if defined( USE_ENVMAP )\n#if defined( PRISMOPAQUE )\nvec3 Environment_Opaque(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float opaqueF0, vec3 opaqueAlbedo, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 T)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(opaqueF0), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(opaqueF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F* surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * opaqueAlbedo * envIrradiance;\n    return diffuse + specular;\n}\n#elif defined( PRISMMETAL )\nvec3 Environment_Metal(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 metalF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, metalF0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 F = Fresnel_Rough(metalF0, NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n    return specular;\n}\n#elif defined( PRISMLAYERED )\nvec3 Environment_Layered(vec3 N, vec3 V, float NdotV, vec3 N2, float N2dotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float layeredF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv, vec3 layeredDiffuse, float layeredRoughness,\n        float layeredAnisotropy, float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 F = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n#if defined( IMPORTANTSAMPLING )\n    vec3 topSpecular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(layeredF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 topSpecular = F * surfaceAlbedo * envSpecular;\n#endif\n    vec3 amount = (1.0 - F);\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 topDiffuse = layeredDiffuse * envIrradiance;\n#if defined( IMPORTANTSAMPLING )\n    vec3 botSpecular = ImportanceSamplingSpecular(layeredRotation, bottom_f0, layeredRoughness, layeredAnisotropy, V, N2, Tu, Tv);\n#else\n    alpha = RoughnessToAlpha(layeredRoughness, 0.0).x;\n    exponent = AlphaToPhong(alpha);\n    reflMipIndex = ExponentToReflMipIndex(exponent);\n    envSpecular = sampleReflection(N2, V, reflMipIndex);\n    F = Fresnel_Rough(bottom_f0, N2dotV, alpha);\n    vec3 botSpecular = F * envSpecular;\n#endif\n    return topSpecular + amount * mix(topDiffuse, botSpecular, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 Environment_Transparent(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(reflectance, NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, reflectance, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = F * surfaceRoughness * transparent_color * envIrradiance;\n    return specular + color;\n}\n#elif defined( PRISMGLAZING )\nvec3 Environment_Glazing(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv,\n                         vec3 glazing_f0, vec3 transmissionF, float transmissionAlpha, vec3 glazingAdjustedColor, float glazingIlluminace)\n{\n    float surfaceAlpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 surfaceF = Fresnel_Rough(glazing_f0, NdotV, surfaceAlpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, glazing_f0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(surfaceAlpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = surfaceF * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = 0.5 * (1.0 - transmissionF) * (glazingAdjustedColor - vec3(glazingIlluminace, glazingIlluminace, glazingIlluminace)) * envIrradiance; \n    return specular + color;\n}\n#elif defined( PRISMWOOD )\nvec3 Environment_Wood(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(0.04), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(0.04), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * woodDiffuse * envIrradiance;\n    return diffuse + specular;\n}\n#endif\n#endif\n#if defined( PRISMTRANSPARENT )\n#include <prism_transparency>\n#elif defined( PRISMGLAZING )\n#include <prism_glazing>\n#endif\n#ifdef USE_TILING\nvec3 tilingTransform(vec2 uv, mat4 transform)\n{\n\treturn (transform * vec4(uv, 0.0, 1.0)).xyz;\n}\nvec4 tilingMapTest(sampler2D tilingSampler, mat3 transf, vec3 uv, vec4 uv2tile, vec4 tile2uv)\n{\n\tvec2 tileCoord = vec2(dot(uv2tile.xz, uv.xy), dot(uv2tile.yw, uv.xy));\n\tvec2 ijBase = floor(tileCoord);\n    vec2 fracC = fract(tileCoord);\n\tvec2 st = vec2(dot(tile2uv.xz, fracC), dot(tile2uv.yw, fracC));\n\tvec4 tileInfo = vec4(0.0, 0.0, 2.0, 2.0);\n\tvec2 iOffset = float(TILE_RANGE_X_MIN) * tile2uv.xy;\n\tvec2 jBaseOffset = float(TILE_RANGE_Y_MIN) * tile2uv.zw;\n\tfor( int i = TILE_RANGE_X_MIN; i <= TILE_RANGE_X_MAX; i++)\n\t{\n\t\tvec2 jOffset = jBaseOffset;\n\t\tfor( int j = TILE_RANGE_Y_MIN; j <= TILE_RANGE_Y_MAX; j++)\n\t\t{\n\t\t\tvec2 sampleUV = st + iOffset + jOffset;\n\t\t\tjOffset += tile2uv.zw;\n\t\t\tsampleUV = (transf * vec3(sampleUV, 1.0)).xy;\n\t\t\tvec4 tex = texture2D(tilingSampler, sampleUV);\n\t\t\tfloat d = max( min(tex.r, tex.g), min( max(tex.r, tex.g), tex.b));\n            if (d < tileInfo.z) {\n\t\t\t\ttileInfo.xy = vec2(float(i),float(j));\n\t\t\t\ttileInfo.w = tileInfo.z;\n\t\t\t\ttileInfo.z = d;\n\t\t\t} else {\n\t\t\t\ttileInfo.w = min(tileInfo.w, d);\n\t\t\t}\n\t\t}\n\t\tiOffset += tile2uv.xy;\n\t}\n\ttileInfo.zw = tileInfo.zw - 0.5;\n\tfloat w = clamp(tileInfo.z/max(fwidth(tileInfo.z), 0.000001) + 0.5, 0.0, 1.0);\n\tif ( w == 1.0 )\n\t\tdiscard;\n \tif (abs(tileInfo.w)<=abs(tileInfo.z))\n\t\tw = 0.0;\n\ttileInfo.w = 1.0 - w;\n\ttileInfo.xy -= ijBase;\n\treturn tileInfo;\n}\nvec2 tilingSubMaterialRelocate(vec3 uv, vec4 tileInfo, vec4 tile2uv)\n{\n\tvec2 offset = vec2(dot(tile2uv.xz, tileInfo.xy), dot(tile2uv.yw, tileInfo.xy));\n\treturn (uv.xy + offset);\n}\n#ifdef USE_TILING_RANDOM\nvec2 tilingRandom(vec2 uv, vec4 tileInfo, sampler2D randomSampler, mat3 transf, vec2 tileTextureAxisS, vec2 tileTextureAxisT, vec2 tile2TextureOffset)\n{\n    vec2 xti = (vec3(tileInfo.xy, 1.0) * transf).xy;\n    vec4 random = texture2D(randomSampler, xti);\n    vec2 randomOffset = vec2(tileTextureAxisS.x*random.z + tileTextureAxisT.x*random.w,\n        tileTextureAxisS.y*random.z + tileTextureAxisT.y*random.w) + tile2TextureOffset;\n    return uv + randomOffset;\n}\n#endif\nvoid tilingNormalOffset(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (vec3(uv, 1.0) * transform).xy;\n    vec3 distort =  (2.0 * texture2D(bumpTexture, st).xyz - 1.0) - vec3(0.0,0.0,1.0);\n    mat3 mat = mat3(\n        T.x, B.x, N.x,\n        T.y, B.y, N.y,\n        T.z, B.z, N.z\n    );\n    N = normalize(N + (mat*distort));\n}\n#endif\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 N = normalize(vNormal);\n    vec3 Tu = vec3(0.0);\n    vec3 Tv = vec3(0.0);\n#if defined(USE_MAP) || defined(USE_TILING)\n    vec2 uv = vUv;\n#endif\n#ifdef USE_TILING\n    vec3 v_tilingOverallTransf = tilingTransform( vUv, tilingOverallTransform );\n    vec4 v_TilingMap = tilingMapTest( TilingMap, TilingMap_texMatrix, v_tilingOverallTransf, uv2tile, tile2uv );\n    uv = tilingSubMaterialRelocate( v_tilingOverallTransf, v_TilingMap, tile2uv ) + tileAlignOffset;\n#ifdef USE_TILING_NORMAL\n    vec2 uvNorm = uv;\n#endif\n#ifdef USE_TILING_RANDOM\n    uv = tilingRandom( uv, v_TilingMap, TilingRandomMap, TilingRandomMap_texMatrix, tilingRandomAxisS, tilingRandomAxisT, tilingRandomAlignmentOffset );\n#endif\n    uv = tilingTransform( uv, tilingUVTransform ).xy;\n#endif\n#if defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP ) || MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0 || defined( PRISMWOODBUMP ) || defined( IMPORTANTSAMPLING )\n#if !defined(USE_MAP) || defined( PRISMWOODBUMP )\n    Tu = normalize(vTangent);\n    Tv = normalize(vBitangent);\n#else\n    vec3 q0 = dFdx( -vViewPosition );\n    vec3 q1 = dFdy( -vViewPosition );\n    vec2 st0 = dFdx( uv );\n    vec2 st1 = dFdy( uv );\n    Tu = normalize(  q0 * st1.t - q1 * st0.t );\n    Tv = normalize( -q0 * st1.s + q1 * st0.s );\n#endif\n#endif\n    vec3 V;\n    if (projectionMatrix[3][3] == 0.0) {\n        V = normalize( vViewPosition );\n    } else {\n        V = vec3(0.0, 0.0, 1.0);\n    }\n    N = faceforward(N, -V, N);\n#if defined(PRISMLAYERED)\n    vec3 N2 = N;\n#endif\n#ifndef FLAT_SHADED\n    vec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n    normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#else\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n#endif\n    vec3 geomNormal = normal;\n#if defined( USE_SURFACE_NORMAL_MAP )\n    if (surface_normal_map_bumpmapType == 0)\n        heightMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n    else\n        normalMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n#endif\n#if defined( USE_LAYERED_NORMAL_MAP )\n    if (layered_normal_map_bumpmapType == 0)\n        heightMapTransform(layered_normal_map, uv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n    else\n        normalMapTransform(layered_normal_map, uv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n#endif\n#ifdef USE_TILING_NORMAL\n    tilingNormalOffset(TilingNormalMap, uvNorm, TilingNormalMap_texMatrix, Tu, Tv, N);\n#endif\n#if defined( PRISMWOOD )\n#ifdef NO_UVW\n    vec3 p = vec3(0.0);\n#elif defined( USE_WOOD_CURLY_DISTORTION_MAP )\n    vec3 p = DistortCurly(vUvw);\n#else\n    vec3 p = vUvw;\n#endif\n#if !defined( NO_UVW ) && defined( PRISMWOODBUMP )\n    getFinalWoodContext(\n        N, V, Tu, Tv, p,\n        normal, vtNormal, vNormalMatrix\n    );\n#endif\n#endif\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n#if defined(PRISMLAYERED)\n    float N2dotV = clamp(dot(N2, V), EPSILON, 1.0);\n#endif\n    vec3 surfaceAlbedo;\n#prism_sample_texture<surface_albedo, surfaceAlbedo, false, true>\n    float surfaceRoughness;\n#prism_sample_texture<surface_roughness, surfaceRoughness, true, false>\n    float surfaceAnisotropy;\n#prism_sample_texture<surface_anisotropy, surfaceAnisotropy, true, false>\n    float surfaceRotation;\n#prism_sample_texture<surface_rotation, surfaceRotation, true, false>\n#if defined(PRISMOPAQUE)\n    float opaqueF0;\n#prism_sample_texture<opaque_f0, opaqueF0, true, false>\n    vec3 opaqueAlbedo;\n#prism_sample_texture<opaque_albedo, opaqueAlbedo, false, true>\n#elif defined(PRISMMETAL)\n    vec3 metalF0;\n#prism_sample_texture<metal_f0, metalF0, false, true>\n#elif defined(PRISMLAYERED)\n    float layeredF0;\n#prism_sample_texture<layered_f0, layeredF0, true, false>\n    vec3 layeredDiffuse;\n#prism_sample_texture<layered_diffuse, layeredDiffuse, false, true>\n    float layeredRoughness;\n#prism_sample_texture<layered_roughness, layeredRoughness, true, false>\n    float layeredAnisotropy;\n#prism_sample_texture<layered_anisotropy, layeredAnisotropy, true, false>\n    float layeredRotation;\n#prism_sample_texture<layered_rotation, layeredRotation, true, false>\n    vec3 bottom_f0;\n#prism_sample_texture<layered_bottom_f0, bottom_f0, false, true>\n    float layeredFraction;\n#prism_sample_texture<layered_fraction, layeredFraction, true, false>\n#elif defined( PRISMGLAZING )\n    vec3 glazingTransmissionColor;\n#prism_sample_texture<glazing_transmission_color, glazingTransmissionColor, false, true>\n    vec3 glazingF0;\n#prism_sample_texture<glazing_f0, glazingF0, false, true>\n    float glazingTransmissionRoughness;\n#prism_sample_texture<glazing_transmission_roughness, glazingTransmissionRoughness, true, false>\n    vec3 glazingAdjustedColor = TransmitAdjust(glazingTransmissionColor, glazingF0);\n    float glazingIlluminace = ColorToIlluminance(glazingAdjustedColor);\n    float transmissionAlpha = RoughnessToAlpha(glazingTransmissionRoughness, 0.0).x;\n    vec3 transmissionF = Fresnel_Rough(glazingF0, NdotV, transmissionAlpha);\n#elif defined(PRISMWOOD)\n    vec3 woodDiffuse = NoiseWood(p, surfaceRoughness);\n#endif\n    vec3 outRadianceLight = vec3(0.0);\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\n    vec3 lightDirection[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n    vec3 lightColor[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n#if MAX_DIR_LIGHTS > 0\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n        lightDirection[i] = normalize( lDirection.xyz );\n        lightColor[i] = SRGBToLinear(directionalLightColor[ i ]);\n    }\n#endif\n#if MAX_POINT_LIGHTS > 0\n    for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( pointLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n        lightColor[MAX_DIR_LIGHTS + i] = SRGBToLinear(pointLightColor[ i ]) * lDistance;\n    }\n#endif\n#if MAX_SPOT_LIGHTS > 0\n    for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( spotLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n        if ( spotEffect > spotLightAngleCos[ i ] )\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n        lightColor[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = SRGBToLinear(spotLightColor[ i ]) * lDistance * spotEffect;\n    }\n#endif\n    for( int i = 0; i < MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS; i ++ ) {\n        vec3 L = lightDirection[i];\n        float NdotL = max(EPSILON, dot(N, L));\n        vec3 H = normalize(L + V);\n        float NdotH = dot(N, H);\n        float VdotH = dot(V, H);\n        float Hu = dot(H, Tu);\n        float Hv = dot(H, Tv);\n        vec3 Hlocal = vec3(Hu, Hv, NdotH);\n#if defined(PRISMLAYERED)\n        float N2dotL = dot(N2, L);\n        float N2dotH = dot(N2, H);\n        vec3 Hlocal2 = vec3(Hu, Hv, N2dotH);\n#endif\n        vec3 brdf = lightColor[i] *\n#if defined(PRISMOPAQUE)\n            BRDF_Opaque(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                    surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                    opaqueF0, opaqueAlbedo);\n#elif defined(PRISMMETAL)\n            BRDF_Metal(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                metalF0);\n#elif defined(PRISMLAYERED)\n            BRDF_Layered(Hlocal, NdotL, NdotH, NdotV, VdotH, Hlocal2, N2dotL, N2dotH, N2dotV,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n                layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n            BRDF_Transparent(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation);\n#elif defined(PRISMGLAZING)\n            BRDF_Glazing(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                         glazingF0, glazingTransmissionColor, glazingIlluminace);\n#elif defined(PRISMWOOD)\n            BRDF_Wood(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, woodDiffuse);\n#endif\n        outRadianceLight += max(vec3(0.0), brdf);\n    }\n#endif\n    vec3 outRadianceEnv = vec3(0.0);\n#if defined( USE_ENVMAP )\n    outRadianceEnv =\n#if defined(PRISMOPAQUE)\n        Environment_Opaque(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n                opaqueF0, opaqueAlbedo, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMMETAL)\n        Environment_Metal(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, metalF0, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMLAYERED)\n        Environment_Layered(N, V, clamp(NdotV, 0.0, 1.0), N2, clamp(N2dotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n            layeredF0, surfaceAnisotropy, surfaceRotation, Tu, Tv, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n            layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n        Environment_Transparent(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMGLAZING)\n        Environment_Glazing(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv,\n            glazingF0, transmissionF, transmissionAlpha, glazingAdjustedColor, glazingIlluminace);\n#elif defined(PRISMWOOD)\n        Environment_Wood(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, woodDiffuse, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#endif\n#endif\n#if defined(PRISMOPAQUE)\n    vec3 luminanceModifier;\n#prism_sample_texture<opaque_luminance_modifier, luminanceModifier, false, true>\n    outRadianceEnv += luminanceModifier * opaque_luminance;\n#endif\n    float surface_cutout = 1.0;\n#prism_sample_texture<surface_cutout, surface_cutout, true, false>\n#if defined( USE_SURFACE_CUTOUT_MAP )\n    if(surface_cutout < 0.01) discard;\n#endif\n    gl_FragColor = vec4( outRadianceLight + outRadianceEnv, opacity*surface_cutout );\n#if TONEMAP_OUTPUT == 1\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\n#elif TONEMAP_OUTPUT == 2\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma(exposureBias * gl_FragColor.xyz);\n#endif\n#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n#if defined(PRISMTRANSPARENT)\n    applyPrismTransparency(gl_FragColor, transparent_color, transparent_ior);\n    gl_FragColor.a *= surface_cutout;\n#ifdef USE_TILING\n    gl_FragColor.a *= v_TilingMap.a;\n#endif\n#elif defined( PRISMGLAZING )\n    applyPrismGlazingOpacity(gl_FragColor, transmissionF, transmissionAlpha, NdotV, glazingIlluminace);\n#ifdef USE_TILING\n    gl_FragColor.a *= v_TilingMap.a;\n#endif\n#endif\n#include<theming_frag>\n#include<final_frag>\n}\n"},"./src/wgs/render/shaders/prism_vert.glsl":
/*!************************************************!*\
  !*** ./src/wgs/render/shaders/prism_vert.glsl ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec3 vViewPosition;\nvarying vec3 vNormal;\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#if defined(PRISMWOODBUMP)\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#prism_check<USE_MAP>\n#if defined(USE_MAP) || defined(USE_TILING)\nvarying vec2 vUv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<shadowmap_decl_vert>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\n#endif\nvoid main() {\n#if defined(USE_MAP) || defined(USE_TILING)\n    vUv = uv;\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n#if defined(PRISMWOOD) && !defined(NO_UVW)\n#if defined(PRISMWOODBUMP)\n    vUvw = instPos;\n    vtNormal = normalize(objectNormal);\n    mNormalMatrix = normalMatrix;\n#else\n    vUvw = uvw;\n#endif\n#endif\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\n    vec3 Tu, Tv;\n#if defined(PRISMWOODBUMP)\n    ComputeTangents(vtNormal, Tu, Tv);\n#else\n    ComputeTangents(vNormal, Tu, Tv);\n#endif\n    vTangent = Tu;\n    vBitangent = Tv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<id_vert>\n#include<shadowmap_vert>\n}\n"},"./src/wgs/render/shaders/sao_blur_frag.glsl":
/*!***************************************************!*\
  !*** ./src/wgs/render/shaders/sao_blur_frag.glsl ***!
  \***************************************************/
/*! no static exports found */function(e,t){e.exports="\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture2D(tDiffuse, vUv);\n    gl_FragColor.gb = temp.KEY_COMPONENTS;\n    gl_FragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},"./src/wgs/render/shaders/sao_frag.glsl":
/*!**********************************************!*\
  !*** ./src/wgs/render/shaders/sao_frag.glsl ***!
  \**********************************************/
/*! no static exports found */function(e,t){e.exports="\n#include <depth_texture>\n#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include <pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n    vec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;\n#ifdef USE_MIPMAP\n    int mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\n    if (mipLevel == 0) {\n        P.z = texture2D(tDepth, screenUV).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\n    else if (mipLevel == 2)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\n    else if (mipLevel == 3)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\n    else if (mipLevel == 4)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\n    else if (mipLevel == 5)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\n    P.z = texture2D(tDepth, screenUV).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return 6.28318 * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture2D(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        gl_FragColor.r = 1.0;\n        gl_FragColor.a = 0.0;\n        packKey(1.0, gl_FragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), gl_FragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    gl_FragColor.r = A;\n    gl_FragColor.a = 1.0;\n}\n"},"./src/wgs/render/shaders/sao_min_frag.glsl":
/*!**************************************************!*\
  !*** ./src/wgs/render/shaders/sao_min_frag.glsl ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    gl_FragColor = texture2D(tDiffuse, ssP);\n}\n"},"./src/wgs/render/shaders/sao_minfirst_frag.glsl":
/*!*******************************************************!*\
  !*** ./src/wgs/render/shaders/sao_minfirst_frag.glsl ***!
  \*******************************************************/
/*! no static exports found */function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include <pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture2D(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    gl_FragColor = packDepth(depth);\n}\n"},"./src/wgs/render/shaders/screen_quad_uv_vert.glsl":
/*!*********************************************************!*\
  !*** ./src/wgs/render/shaders/screen_quad_uv_vert.glsl ***!
  \*********************************************************/
/*! no static exports found */function(e,t){e.exports="varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},"./src/wgs/render/shaders/screen_quad_vert.glsl":
/*!******************************************************!*\
  !*** ./src/wgs/render/shaders/screen_quad_vert.glsl ***!
  \******************************************************/
/*! no static exports found */function(e,t){e.exports="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},"./src/wgs/render/shaders/shadowmap_frag.glsl":
/*!****************************************************!*\
  !*** ./src/wgs/render/shaders/shadowmap_frag.glsl ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports="#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#include<float3_average>\n#prism_uniforms<surface_cutout_map>\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform sampler2D alphaMap;\n#endif\n#endif\nuniform float shadowMinOpacity;\nvoid applyCutoutMaps() {\n    float opacity = 1.0;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#prism_sample_texture<surface_cutout, opacity, true, false>\n#else\n#ifdef USE_MAP\n    opacity *= GET_MAP(vUv).a;\n#endif\n#ifdef USE_ALPHAMAP\n    opacity *= GET_ALPHAMAP(vUvAlpha).r;\n#endif\n#endif\n#if defined(USE_SURFACE_CUTOUT_MAP) || defined(USE_MAP) || defined(USE_ALPHAMAP)\n    if (opacity < shadowMinOpacity) discard;\n#endif\n}\nvoid main() {\n    float normalizedLinearDepth = (depth - shadowMapRangeMin) / shadowMapRangeSize;\n    float val = exp(shadowESMConstant * normalizedLinearDepth);\n#ifdef USE_HARD_SHADOWS\n    val = normalizedLinearDepth;\n#endif\n    applyCutoutMaps();\n    gl_FragColor = vec4(val, 0, 0, 1);\n}\n"},"./src/wgs/render/shaders/shadowmap_ground_frag.glsl":
/*!***********************************************************!*\
  !*** ./src/wgs/render/shaders/shadowmap_ground_frag.glsl ***!
  \***********************************************************/
/*! no static exports found */function(e,t){e.exports="#include<shadowmap_decl_frag>\nvoid main() {\n    float shadowIntensity = 0.5 * (1.0 - getShadowValue());\n    gl_FragColor = vec4(0.0, 0.0, 0.0, shadowIntensity);\n}\n"},"./src/wgs/render/shaders/shadowmap_ground_vert.glsl":
/*!***********************************************************!*\
  !*** ./src/wgs/render/shaders/shadowmap_ground_vert.glsl ***!
  \***********************************************************/
/*! no static exports found */function(e,t){e.exports="#include<shadowmap_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#include<shadowmap_vert>\n}\n"},"./src/wgs/render/shaders/shadowmap_vert.glsl":
/*!****************************************************!*\
  !*** ./src/wgs/render/shaders/shadowmap_vert.glsl ***!
  \****************************************************/
/*! no static exports found */function(e,t){e.exports="#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#endif\nvoid passCutoutUVCoords() {\n#ifdef USE_SURFACE_CUTOUT_MAP\n    vUv = uv;\n#else\n#ifdef USE_MAP\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_ALPHAMAP\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#endif\n}\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n    depth = -mvPosition.z;\n    passCutoutUVCoords();\n}\n"},"./src/wgs/scene/BVHBuilder.js":
/*!*************************************!*\
  !*** ./src/wgs/scene/BVHBuilder.js ***!
  \*************************************/
/*! exports provided: NodeArray, BVHBuilder */function(e,t,n){"use strict";function r(e,t){var n,r;this.bytes_per_node=t?32:36,e instanceof ArrayBuffer?(n=e.byteLength/this.bytes_per_node,r=e,this.nodeCount=n):(n=0|e,r=new ArrayBuffer(this.bytes_per_node*n),this.nodeCount=0),this.nodeCapacity=n,this.nodesRaw=r,this.is_lean_node=t,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}n.r(t),n.d(t,"NodeArray",(function(){return r})),n.d(t,"BVHBuilder",(function(){return s})),r.prototype.setLeftChild=function(e,t){this.nodesI[e*this.node_stride+6]=t},r.prototype.getLeftChild=function(e){return this.nodesI[e*this.node_stride+6]},r.prototype.setPrimStart=function(e,t){this.is_lean_node?this.nodesI[e*this.node_stride+6]=t:this.nodesI[e*this.node_stride+8]=t},r.prototype.getPrimStart=function(e){return this.is_lean_node?this.nodesI[e*this.node_stride+6]:this.nodesI[e*this.node_stride+8]},r.prototype.setPrimCount=function(e,t){this.nodesS[e*this.node_stride_short+14]=t},r.prototype.getPrimCount=function(e){return this.nodesS[e*this.node_stride_short+14]},r.prototype.setFlags=function(e,t,n,r){this.nodesS[e*this.node_stride_short+15]=r<<3|n<<2|3&t},r.prototype.getFlags=function(e){return this.nodesS[e*this.node_stride_short+15]},r.prototype.setBox0=function(e,t){var n=e*this.node_stride,r=this.nodesF;r[n]=t[0],r[n+1]=t[1],r[n+2]=t[2],r[n+3]=t[3],r[n+4]=t[4],r[n+5]=t[5]},r.prototype.getBoxThree=function(e,t){var n=e*this.node_stride,r=this.nodesF;t.min.x=r[n],t.min.y=r[n+1],t.min.z=r[n+2],t.max.x=r[n+3],t.max.y=r[n+4],t.max.z=r[n+5]},r.prototype.getBoxArray=function(e,t,n){var r=e*this.node_stride,i=this.nodesF;t[0+(n=n||0)]=i[r],t[1+n]=i[r+1],t[2+n]=i[r+2],t[3+n]=i[r+3],t[4+n]=i[r+4],t[5+n]=i[r+5]},r.prototype.setBoxThree=function(e,t){var n=e*this.node_stride,r=this.nodesF;r[n]=t.min.x,r[n+1]=t.min.y,r[n+2]=t.min.z,r[n+3]=t.max.x,r[n+4]=t.max.y,r[n+5]=t.max.z},r.prototype.makeEmpty=function(e){var t=e*this.node_stride,n=this.nodesI;n[t+6]=-1,n[t+7]=0,this.is_lean_node||(n[t+8]=-1)},r.prototype.realloc=function(e){if(this.nodeCount+e>this.nodeCapacity){var t=0|3*this.nodeCapacity/2;t<this.nodeCount+e&&(t=this.nodeCount+e);var n=new ArrayBuffer(t*this.bytes_per_node),r=new Int32Array(n);r.set(this.nodesI),this.nodeCapacity=t,this.nodesRaw=n,this.nodesF=new Float32Array(n),this.nodesI=r,this.nodesS=new Uint16Array(n)}},r.prototype.nextNodes=function(e){this.realloc(e);var t=this.nodeCount;this.nodeCount+=e;for(var n=0;n<e;n++)this.makeEmpty(t+n);return t},r.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var i=function(){function e(e,t,n){e[0]>t[n]&&(e[0]=t[n]),e[3]<t[n]&&(e[3]=t[n]),e[1]>t[n+1]&&(e[1]=t[n+1]),e[4]<t[n+1]&&(e[4]=t[n+1]),e[2]>t[n+2]&&(e[2]=t[n+2]),e[5]<t[n+2]&&(e[5]=t[n+2])}function t(e,t,n){e[0]>t[n]&&(e[0]=t[n]),e[1]>t[n+1]&&(e[1]=t[n+1]),e[2]>t[n+2]&&(e[2]=t[n+2]),e[3]<t[n+3]&&(e[3]=t[n+3]),e[4]<t[n+4]&&(e[4]=t[n+4]),e[5]<t[n+5]&&(e[5]=t[n+5])}function n(e,t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5])}function r(e,t,n,r){for(var i=0;i<3;i++)e[t+i]=n[r+3+i]-n[r+i]}function i(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]}function o(e){e[0]=1/0,e[1]=1/0,e[2]=1/0,e[3]=-1/0,e[4]=-1/0,e[5]=-1/0}function s(e){var t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return t<0||n<0||r<0?0:2*(t*n+n*r+r*t)}function a(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function l(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function c(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}a.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},l.prototype.reset=function(){this.num_prims=0,o(this.box_bbox),o(this.box_centroid)},c.prototype.reset=function(){this.NL=0,this.AL=0,o(this.BL),o(this.CL)};var u,d=[];for(u=0;u<16;u++)d.push(new l);var h=[];for(u=0;u<15;u++)h.push(new c);var f=new Float32Array(6),p=new Float32Array(6);function m(r,o,a,l,c,u,m){if(u[l]<r.scene_epsilon)m.best_cost=1/0;else{var g,v,y=16;for(y>a-o+1&&(y=a-o+1),g=0;g<y;g++)d[g].reset();for(g=0;g<y-1;g++)h[g].reset();for(m.num_bins=y,function(n,r,i,o,s,a,l){for(var c=n.centroids,u=n.primitives,h=n.finfo.boxes,f=n.finfo.boxStride,p=.99999*l/a[o],m=s[o],g=n.sort_prims,v=r;v<=i;v++){var y=0|u[v],_=0|p*(c[3*y+o]-m);_<0?_=0:_>=l&&(_=l-1),g[v]=_,d[_].num_prims++,t(d[_].box_bbox,h,y*f),e(d[_].box_centroid,c,3*y)}}(r,o,a,l,c,u,y),i(h[0].BL,d[0].box_bbox),i(h[0].CL,d[0].box_centroid),h[0].AL=s(h[0].BL),h[0].NL=d[0].num_prims,g=1;g<y-1;g++){v=d[g];var _=h[g];i(_.BL,h[g-1].BL),n(_.BL,v.box_bbox),_.AL=s(_.BL),i(_.CL,h[g-1].CL),n(_.CL,v.box_centroid),_.NL=h[g-1].NL+v.num_prims}i(f,d[g=y-1].box_bbox),i(p,d[g].box_centroid);var b=s(f),x=d[g].num_prims,w=g,E=b*x+h[g-1].AL*h[g-1].NL;for(i(m.vb_right,f),i(m.cb_right,d[g].box_centroid),i(m.vb_left,h[g-1].BL),i(m.cb_left,h[g-1].CL),m.num_left=h[g-1].NL,g-=1;g>=1;g--){v=d[g],n(f,v.box_bbox),n(p,v.box_centroid);var A=(b=s(f))*(x+=v.num_prims)+h[g-1].AL*h[g-1].NL;A<=E&&(E=A,w=g,i(m.vb_right,f),i(m.cb_right,p),i(m.vb_left,h[g-1].BL),i(m.cb_left,h[g-1].CL),m.num_left=h[g-1].NL)}m.best_split=w,m.best_cost=E}}var g=new Float32Array(3);return{bvh_subdivide:function(t,n,i,s,l,c,u,d){r(g,0,c,0);var h=t.nodes,f=u?t.frags_per_leaf_node_transparent:t.frags_per_leaf_node,p=u?t.frags_per_inner_node_transparent:t.frags_per_inner_node,v=t.max_polys_per_node,y=0;g[1]>g[0]&&(y=1),g[2]>g[y]&&(y=2),h.setBox0(n,l);var _=0,b=0,x=s-i+1;if(t.finfo.hasPolygonCounts&&t.frags_per_inner_node)for(var w=x<=t.frags_per_inner_node?s:i+t.frags_per_inner_node-1,E=i;E<=w&&(b++,!((_+=t.finfo.getPolygonCount(t.primitives[E]))>v));E++);if(x<=f&&_<v||1===x||d>15||g[y]<t.scene_epsilon)return h.setLeftChild(n,-1),h.setPrimStart(n,i),h.setPrimCount(n,s-i+1),void h.setFlags(n,0,0,u?1:0);p&&(y=function(t,n,i,s,a,l,c,u){var d=t.primitives,h=t.centroids,f=a-s+1;f>t.frags_per_inner_node&&(f=t.frags_per_inner_node),f>u&&(f=u),n.setPrimStart(i,s),n.setPrimCount(i,f),s+=f,o(l);for(var p=s;p<=a;p++)e(l,h,3*d[p]);r(c,0,l,0);var m=0;return c[1]>c[0]&&(m=1),c[2]>c[m]&&(m=2),m}(t,h,n,i,s,c,g,b),i+=h.getPrimCount(n));var A=new a;if(m(t,i,s,y,c,g,A),A.num_bins<0)h.setPrimCount(n,h.getPrimCount(n)+s-i+1);else{!function(e,t,n,r,i,o,s){var a,l,c=e.primitives,u=e.sort_prims,d=0,h=0|t,f=0|s.best_split;for(a=t;a<=n;a++){var p=0|c[a];u[a]<f?c[h++]=p:u[d++]=p}for(l=0;l<d;l++)c[h+l]=u[l]}(t,i,s,0,0,0,A);var M=h.nextNodes(2),S=.5*(A.vb_left[3+y]+A.vb_left[y]),T=.5*(A.vb_right[3+y]+A.vb_right[y]);h.setFlags(n,y,S<T?0:1,u?1:0),h.setLeftChild(n,M),t.recursion_stack.push([t,M+1,i+A.num_left,s,A.vb_right,A.cb_right,u,d+1]),t.recursion_stack.push([t,M,i,i+A.num_left-1,A.vb_left,A.cb_left,u,d+1])}},compute_boxes:function(n){var i=n.boxv_o,s=n.boxc_o,a=n.boxv_t,l=n.boxc_t;o(i),o(s),o(a),o(l);for(var c,u,d,h,f=n.centroids,p=n.finfo.boxes,m=n.finfo.boxStride,v=0,y=n.prim_count;v<y;v++){var _=n.primitives[v];d=p,h=m*_,(c=f)[u=3*_]=.5*(d[h]+d[h+3]),c[u+1]=.5*(d[h+1]+d[h+4]),c[u+2]=.5*(d[h+2]+d[h+5]),v>=n.first_transparent?(e(l,f,3*_),t(a,p,m*_)):(e(s,f,3*_),t(i,p,m*_))}r(g,0,n.boxv_o,0);var b=Math.max(g[0],g[1],g[2]);n.scene_epsilon=1e-5*b},box_area:function(e,t){var n=e[t+3]-e[t],r=e[t+4]-e[t+1],i=e[t+5]-e[t+2];return n<0||r<0||i<0?0:2*(n*r+r*i+i*n)}}}();function o(e,t){this.boxes=e.boxes,this.polygonCounts=e.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.materials=e.materials,this.materialDefs=t,this.count=e.length,this.boxStride=6,this.wantSort=!0}function s(e,t,n){this.finfo=n||new o(e,t),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(3*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}o.prototype.getCount=function(){return this.count},o.prototype.isTransparent=function(e){return!(!this.materialDefs||!this.materialDefs[this.materials[e]])&&this.materialDefs[this.materials[e]].transparent},o.prototype.getPolygonCount=function(e){return this.polygonCounts[e]},s.prototype.sortPrimitives=function(e){var t,n,r=new Float32Array(this.work_buf),o=this.primitives,s=0,a=e;for(t=0,n=this.prim_count;t<n;t++){o[t]=t;var l=this.finfo.isTransparent(t);l&&s++,a?(r[t]=i.box_area(this.finfo.boxes,this.finfo.boxStride*t),l&&(r[t]=-r[t])):r[t]=l?-1:1}if(a)Array.prototype.sort.call(this.primitives,(function(e,t){return r[t]-r[e]}));else if(s&&s<this.prim_count){var c=new Int32Array(s),u=0,d=0;for(t=0,n=this.prim_count;t<n;t++)r[t]>=0?o[u++]=o[t]:c[d++]=o[t];o.set(c,this.prim_count-s)}this.first_transparent=this.prim_count-s},s.prototype.build=function(e){var t=e&&!!e.useSlimNodes,n=this;function o(t,r){e.hasOwnProperty(t)?n[t]=e[t]:n[t]=r}if(t)o("frags_per_leaf_node",1),o("frags_per_inner_node",0),o("frags_per_leaf_node_transparent",1),o("frags_per_inner_node_transparent",0),o("max_polys_per_node",1/0);else{var s=e.isWeakDevice?.5:1;o("frags_per_leaf_node",0|256*s),o("frags_per_inner_node",0|this.frags_per_leaf_node),o("frags_per_leaf_node_transparent",this.frags_per_leaf_node),o("frags_per_inner_node_transparent",0),o("max_polys_per_node",0|2e4*s)}if(this.nodes&&this.nodes.is_lean_node==t)this.nodes.nodeCount=0;else{for(var a=this.prim_count/this.frags_per_leaf_node,l=1;l<a;)l*=2;this.nodes=new r(l,!!e&&e.useSlimNodes)}this.sortPrimitives(this.finfo.wantSort),i.compute_boxes(this);var c,u=this.nodes.nextNodes(2);for(i.bvh_subdivide(this,u,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)c=this.recursion_stack.pop(),i.bvh_subdivide(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]);for(i.bvh_subdivide(this,u+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)c=this.recursion_stack.pop(),i.bvh_subdivide(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7])}},"./src/wgs/scene/BufferGeometry.js":
/*!*****************************************!*\
  !*** ./src/wgs/scene/BufferGeometry.js ***!
  \*****************************************/
/*! exports provided: createBufferGeometry, meshToGeometry, BufferGeometryUtils */function(e,t,n){"use strict";n.r(t),n.d(t,"createBufferGeometry",(function(){return p})),n.d(t,"meshToGeometry",(function(){return m})),n.d(t,"BufferGeometryUtils",(function(){return g}));var r=n(/*! ../globals.js */"./src/wgs/globals.js"),i=n(/*! ../../compat */"./src/compat.js"),o=n(/*! three */"./thirdparty/three.js/three.js"),s=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),a={};function l(e,t,n){var r;if(t.array)r=new o.BufferAttribute(t.array,t.itemSize);else{var i=e+"|"+t.bytesPerItem+"|"+t.normalize+"|"+t.isPattern+"|"+t.divisor+"|"+t.offset;if(r=a[i])return r;r=new o.BufferAttribute(void 0,t.itemSize),a[i]=r}return r.bytesPerItem=t.bytesPerItem,r.normalize=t.normalize,r.isPattern=t.isPattern,n&&(r.divisor=t.divisor),t.array||(t.hasOwnProperty("offset")?r.itemOffset=t.offset:s.logger.warn("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),r}var c,u,d,h={};var f=1;function p(){return d||((c=new o.BufferAttribute(void 0,1)).bytesPerItem=2,(u=new o.BufferAttribute(void 0,1)).bytesPerItem=4,(d=function(){this.id=f++,this.attributes={},this.__webglInit=void 0}).prototype=Object.create(o.BufferGeometry.prototype),d.prototype.constructor=d),new d}function m(e){var t=e.mesh,n=p();for(var s in Object(i.isNodeJS)()&&(n.packId=e.packId,n.meshIndex=e.meshIndex),n.byteSize=0,n.vb=t.vb,n.vbbuffer=void 0,n.vbNeedsUpdate=!0,n.byteSize+=t.vb.byteLength,n.hash=e.hash,n.vbstride=t.vbstride,t.isLines&&(n.isLines=t.isLines),t.isWideLines&&(n.isWideLines=!0,n.lineWidth=t.lineWidth),t.isPoints&&(n.isPoints=t.isPoints,n.pointSize=t.pointSize),e.is2d&&(n.is2d=!0),n.numInstances=t.numInstances,t.vblayout){var a=t.vblayout[s];n.attributes[s]=l(s,a,n.numInstances)}if(r.memoryOptimizedLoading)n.attributes.index=t.indices instanceof Uint32Array?u:c,n.ib=t.indices,n.ibbuffer=void 0,t.iblines&&(n.attributes.indexlines=t.iblines instanceof Uint32Array?u:c,n.iblines=t.iblines,n.iblinesbuffer=void 0);else{var d=new o.BufferAttribute(t.indices,1);d.bytesPerItem=t.indices instanceof Uint32Array?4:2,n.addAttribute("index",d)}n.attributesKeys=function(e){var t="";for(var n in e.attributes)t+=n+"|";var r=h[t];return r||(r=Object.keys(e.attributes),h[t]=r,r)}(n),n.byteSize+=t.indices.byteLength,n.boundingBox=(new o.Box3).copy(t.boundingBox),n.boundingSphere=(new o.Sphere).copy(t.boundingSphere),e.geometry=n,e.mesh=null}var g={meshToGeometry:m,createBufferGeometry:p,findBufferAttribute:l}},"./src/wgs/scene/Consolidation.js":
/*!****************************************!*\
  !*** ./src/wgs/scene/Consolidation.js ***!
  \****************************************/
/*! exports provided: isVisible, copyVertexFormat, copyPrimitiveProps, mergeGeometries, Consolidation, ConsolidationBuilder */function(e,t,n){"use strict";n.r(t),n.d(t,"isVisible",(function(){return M})),n.d(t,"copyVertexFormat",(function(){return T})),n.d(t,"copyPrimitiveProps",(function(){return C})),n.d(t,"mergeGeometries",(function(){return P})),n.d(t,"Consolidation",(function(){return D})),n.d(t,"ConsolidationBuilder",(function(){return R}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=n(/*! ./VertexEnumerator */"./src/wgs/scene/VertexEnumerator.js"),o=n(/*! ./BufferGeometry */"./src/wgs/scene/BufferGeometry.js"),s=n(/*! ./ParallelGeomMerge */"./src/wgs/scene/ParallelGeomMerge.js"),a=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),l=n(/*! ../render/MaterialManager */"./src/wgs/render/MaterialManager.js"),c=n(/*! ./MeshFlags */"./src/wgs/scene/MeshFlags.js"),u=n(/*! ./RenderFlags */"./src/wgs/scene/RenderFlags.js"),d=1,h=2,f=3,p=4;function m(e){return e.isLines?h:e.isPoints?p:e.isWideLines?f:d}function g(e,t){switch(!0===e.isLines&&(e.isLines=void 0),!0===e.isWideLines&&(e.isWideLines=void 0),!0===e.isPoints&&(e.isPoints=void 0),t){case h:e.isLines=!0;break;case f:e.isWideLines=!0;break;case p:e.isPoints=!0}}var v=c.MeshFlags.MESH_HIGHLIGHTED,y=c.MeshFlags.MESH_VISIBLE|c.MeshFlags.MESH_HIDE|v,_=c.MeshFlags.MESH_VISIBLE,b=c.MeshFlags.MESH_VISIBLE|c.MeshFlags.MESH_HIDE,x=c.MeshFlags.MESH_HIGHLIGHTED|c.MeshFlags.MESH_HIDE,w=c.MeshFlags.MESH_HIGHLIGHTED,E=u.RenderFlags.RENDER_HIDDEN,A=u.RenderFlags.RENDER_HIGHLIGHTED;function M(e,t){switch(t){case E:return 0==(e&b);case A:return(e&x)===w}return(e&y)==_}function S(e){this.geoms=[],this.matrices=[],this.vertexCount=0,this.material=e,this.fragIds=[],this.worldBox=new r.Box3}function T(e,t){for(var n in e.vb&&e.vbstride||a.logger.warn("copyVertexFormat() supports only interleaved buffers"),e.attributes)t.attributes[n]=e.attributes[n];t.attributesKeys=e.attributesKeys.slice(0),t.vbstride=e.vbstride}function C(e,t){g(t,m(e)),t.lineWidth=e.lineWidth,t.pointSize=e.pointSize}function P(e,t,n,a,l){var c=function(e){for(var t=e[0].vbstride,n=0,s=0,a=0,l=0;l<e.length;l++){var c=e[l];n+=e[l].ib.length,s+=Object(i.getVertexCount)(c),e[l].iblines&&(a+=e[l].iblines.length)}var u=Object(o.createBufferGeometry)();u.vb=new Float32Array(s*t),u.ib=new Uint16Array(n),a&&(u.iblines=new Uint16Array(a)),u.byteSize=u.vb.byteLength+u.ib.byteLength,u.iblines&&(u.byteSize+=u.iblines.byteLength),C(e[0],u),T(e[0],u);var d=new r.BufferAttribute(null,3);d.normalize=!0,d.bytesPerItem=1,u.addAttribute("id",d);var h=e[0];return g(u,m(h)),h.isPoints&&(u=h.pointSize),h.isWideLines&&(u=h.lineWidth),u}(e);return c.boundingBox=a.clone(),function(e,t){for(var n=0,r=0,o=0,s=0,a=0;a<e.length;a++){for(var l=e[a],c=Object(i.getVertexCount)(l),u=0;u<l.ib.length;u++)t.ib[o+u]=l.ib[u]+r;if(l.iblines){for(u=0;u<l.iblines.length;u++)t.iblines[s+u]=l.iblines[u]+r;s+=l.iblines.length}t.vb.set(l.vb,n),n+=l.vb.length,r+=c,o+=l.ib.length}}(e,c),l?l.addMergeTask(e,c,t,n):Object(s.runMergeSingleThreaded)(e,c,t,n),c}function L(e,t){if(e.vbstride!=t.vbstride)return!1;if(m(e)!==m(t))return!1;if(e.isPoints&&e.pointSize!==t.pointSize)return!1;if(e.isWideLines&&e.lineWidth!==t.lineWidth)return!1;if(e.attributesKeys.length!=t.attributesKeys.length)return!1;for(var n=0,r=e.attributesKeys.length;n<r;n++){var i=e.attributesKeys[n],o=e.attributes[i],s=t.attributes[i];if(!s)return!1;if(o!==s&&(o.itemOffset!==s.itemOffset||o.normalize!==s.normalize||o.itemSize!==s.itemSize||o.bytesPerItem!==s.bytesPerItem||o.isPattern!==s.isPattern))return!1}return!0}function D(e){this.meshes=[],this.fragId2MeshIndex=new Int32Array(e);for(var t=0;t<this.fragId2MeshIndex.length;t++)this.fragId2MeshIndex[t]=-1;this.byteSize=0,this.consolidationMap=null}function R(){this.buckets={},this.bucketCount=0,this.costs=0}function I(e,t){this.fragOrder=new Uint32Array(e),this.ranges=new Uint32Array(t),this.boxes=new Array(t),this.numConsolidated=-1}S.prototype={constructor:S,addGeom:function(e,t,n){this.geoms.push(e),this.fragIds.push(n),this.worldBox.union(t),this.vertexCount+=Object(i.getVertexCount)(e);var r=this.geoms.length;return 1==r?0:(void 0===e.byteSize&&a.logger.warn("Error in consolidation: Geometry must contain byteSize."),e.byteSize+(2==r?this.geoms[0].byteSize:0))}},D.prototype={constructor:D,addContainerMesh:function(e,t,n,i,o){var s=new r.Mesh(e,t);this.meshes.push(s),this.byteSize+=e.byteSize;var a=i||0,l=a+(o||n.length);s.frustumCulled=!1;for(var c=this.meshes.length-1,u=a;u<l;u++){var d=n[u];this.fragId2MeshIndex[d]=c}},addSingleMesh:function(e,t,n,i,o){var s=new r.Mesh(e,t);s.matrix.copy(i),s.matrixAutoUpdate=!1,s.dbId=o,s.fragId=n,this.meshes.push(s),s.frustumCulled=!1,this.fragId2MeshIndex[n]=this.meshes.length-1},addSingleFragment:function(e,t){var n=e.getVizmesh(t);this.addSingleMesh(n.geometry,n.material,t,n.matrixWorld,n.dbId)},applyAttributes:function(e,t,n,r){var i,o,s=this.meshes[e],a=s.geometry,l=t.vizflags,c=this.consolidationMap,u=c.fragOrder,d=a.numInstances,h=t.db2ThemingColor,f=h.length>0||void 0;if(d?o=(i=s.rangeStart)+s.geometry.numInstances:a.attributes.id?(i=c.ranges[e],o=e+1>=c.ranges.length?c.numConsolidated:c.ranges[e+1]):E=s.fragId,!r||void 0!==E)return a.offsets&&void 0===E&&(a.offsets=a.drawcalls=void 0),s.visible=M(l[void 0===E?u[i]:E],n),s.themingColor=f&&h[t.fragments.fragId2dbId[E]],s;var p,m,g=0,v=0,y=0,_=0,b=0;function x(){if(p){a.drawcalls=a.offsets=a.offsets||[];var e=a.offsets[b]||{index:0};a.offsets[b++]=e,d?(e.start=0,e.count=a.ib.length,a.iblines&&(e.edgeStart=0,e.edgeCount=a.iblines.length),e.instanceStart=g,e.numInstances=v-g):(e.start=g,e.count=v-g,a.iblines&&(e.edgeStart=y,e.edgeCount=_-y)),e.themingColor=m}}for(var w=i;w<o;++w){var E,A=M(l[E=u[w]],n),S=f&&t.db2ThemingColor[t.fragments.fragId2dbId[E]];if((A!==p||A&&S!==m)&&(v>g&&x(),g=v,y=_,p=A,m=S),d)v+=1;else{var T=t.getGeometry(E);v+=T.ib.length,T.iblines&&(_+=T.iblines.length)}}return 0===g?(s.themingColor=m,s.visible=p):(s.visible=!0,x()),a.offsets&&(a.offsets.length=b),s}},R.prototype={addGeom:function(e,t,n,r){var o=null,s=this.buckets[t.id];if(s)for(var a=0;a<s.length;a++){var l=s[a];if(L(l.geoms[0],e))if(!(Object(i.getVertexCount)(e)+l.vertexCount>65535)){o=l;break}}o||(o=new S(t),this.bucketCount++,this.buckets[t.id]?this.buckets[t.id].push(o):this.buckets[t.id]=[o]),this.costs+=o.addGeom(e,n,r)},createConsolidationMap:function(e,t){var n=new I(e.length,this.bucketCount),r=0,i=0;for(var o in this.buckets)for(var s=this.buckets[o],a=0;a<s.length;a++){var l=s[a];n.ranges[i]=r,n.boxes[i]=l.worldBox,n.fragOrder.set(l.fragIds,r),r+=l.fragIds.length,i++}n.numConsolidated=t;for(var c=t;c<e.length;c++)n.fragOrder[c]=e[c];return n}},I.prototype={buildConsolidation:function(e,t,n){var i=this.fragOrder,o=e.getCount(),a=this.ranges.length,c=new D(o),u=null;s.ParallelGeomMerge.createWorker&&(u=new s.ParallelGeomMerge(c));for(var d=[],h=new r.Matrix4,f=0;f<a;f++){var p=this.ranges[f],m=(f===a-1?this.numConsolidated:this.ranges[f+1])-p;if(1!==m){d.length=m;for(var g=new Float32Array(16*m),v=new Uint32Array(m),y=0;y<m;y++)A=i[p+y],d[y]=e.getGeometry(A),e.getOriginalWorldMatrix(A,h),g.set(h.elements,16*y),v[y]=e.getDbIds(A);var _=this.boxes[f],b=i[p],x=e.getMaterial(b),w=P(d,g,v,_,u),E=t.getMaterialVariant(x,l.MATERIAL_VARIANT.VERTEX_IDS,n);c.addContainerMesh(w,E,i,p,m)}else{var A=i[p];c.addSingleFragment(e,A,c)}}return u&&u.runTasks(),c.consolidationMap=this,c}},D.applyBVHDefaults=function(e){e.frags_per_leaf_node=512,e.max_polys_per_node=1e5},D.getDefaultBVHOptions=function(){var e={};return D.applyBVHDefaults(e),e}},"./src/wgs/scene/ConsolidationIterator.js":
/*!************************************************!*\
  !*** ./src/wgs/scene/ConsolidationIterator.js ***!
  \************************************************/
/*! exports provided: ConsolidationIterator */function(e,t,n){"use strict";n.r(t),n.d(t,"ConsolidationIterator",(function(){return l}));var r=n(/*! ./Consolidation */"./src/wgs/scene/Consolidation.js"),i=n(/*! ./InstanceBufferBuilder */"./src/wgs/scene/InstanceBufferBuilder.js"),o=n(/*! three */"./thirdparty/three.js/three.js"),s=n(/*! ./MeshFlags */"./src/wgs/scene/MeshFlags.js"),a=n(/*! ../../logger/Logger */"./src/logger/Logger.js");function l(e,t){var n=e,l=t,c=[],u=!1,d=[],h=[],f=new o.Matrix4,p=new o.Box3;this.getConsolidation=function(){return l},this.reset=function(){c.length=null,h.length=0;var e=n.getCount(),t=s.MeshFlags.MESH_MOVED,r=s.MeshFlags.MESH_VISIBLE,i=r|s.MeshFlags.MESH_HIDE|s.MeshFlags.MESH_HIGHLIGHTED,o=n.vizflags,a=l.fragId2MeshIndex;l.meshes;u=!1;for(var d=n.db2ThemingColor.length>0,f=0;f<e;f++){var p,m=o[f];if(m&t){u=!0;break}if(d){var g=n.fragments.fragId2dbId[f];p=n.db2ThemingColor[g]}var v=a[f];h[v]=h[v]||!!(p||m&i^r)}},this.dispose=function(){for(var e={type:"dispose"},t={type:"removed"},n=0;n<l.meshes.length;n++){var r=l.meshes[n],i=r.geometry;i&&(r.dispatchEvent(t),i.dispatchEvent(e),i.needsUpdate=!0)}},this.consolidateNextBatch=function(e,t,r){var i=e.nodeIndex;if(u||void 0===i)return e;if(l.inProgress)return e;for(var s=function(e){d[e]||(d[e]=new o.Scene);var t=d[e];return t.children.length=0,t}(i),f=e.start;f<e.lastItem;f++){var m,g=e.indices?e.indices[f]:f,v=l.fragId2MeshIndex[g];if(-1===v){if(!n.getGeometry(g))continue;return a.logger.warn("Warning: Missing fragment in consolidation. Consolidation disabled."),e}if(!c[v]&&(n.getWorldBounds(g,p),t.intersectsBox(p)&&(c[v]=!0,(m=l.applyAttributes(v,n,r,h[v])).visible))){var y=m&&m.geometry,_=y&&(y.isLines||y.isWideLines),b=y&&y.isPoints;n.linesHidden&&_||n.pointsHidden&&b||s.children.push(m)}}return s.boundingBox||(s.boundingBox=new o.Box3),e.getBoundingBox(s.boundingBox),s.renderImportance=e.renderImportance,s.sortObjects=e.sortObjects,s};var m=1,g=2,v=3;function y(e){return e.numInstances?g:e.attributes.id?m:v}this.updateRenderProxy=function(e,t){if(e.geometry&&e.geometry.attributes){var o=function(e){if(u)return v;var t=l.fragId2MeshIndex[e];return y(l.meshes[t].geometry)}(t);if(y(e.geometry)!=o){var s=n.getGeometry(t),a=l.fragId2MeshIndex[t],c=l.meshes[a];if(o===v)e.geometry=s,e.material=n.getMaterial(t),n.getWorldMatrix(t,e.matrix);else if(o===g){n.getWorldMatrix(t,f);var d=n.fragments.fragId2dbId[t],h=new i.InstanceBufferBuilder(s,1);h.addInstance(f,d),e.geometry=h.finish(),e.material=c.material,e.matrix.identity()}else n.getWorldMatrix(t,f),n.getWorldBounds(t,p),d=n.fragments.fragId2dbId[t],e.geometry=Object(r.mergeGeometries)([s],f.elements,[d],p),e.material=c.material,e.matrix.identity();e.dispatchEvent({type:"removed"})}}}}},"./src/wgs/scene/DeriveTopology.js":
/*!*****************************************!*\
  !*** ./src/wgs/scene/DeriveTopology.js ***!
  \*****************************************/
/*! exports provided: createWireframe */function(e,t,n){"use strict";n.r(t),n.d(t,"createWireframe",(function(){return a}));var r=n(/*! ./VertexEnumerator */"./src/wgs/scene/VertexEnumerator.js"),i=n(/*! ./LmvVector3 */"./src/wgs/scene/LmvVector3.js"),o=n(/*! ./LmvBox3 */"./src/wgs/scene/LmvBox3.js");function s(e,t){var n=[],i={},s=1;if(e.boundingBox||t){var a=(new o.LmvBox3).copy(e.boundingBox||t).size();s=Math.max(a.x,Math.max(a.y,a.z))}var l=65536/s;return Object(r.enumMeshVertices)(e,(function(e,t,r,o){var s=function(e,t){var n=0|e.x*l,r=0|e.y*l,o=0|e.z*l,s=i[n];s||(i[n]=s={});var a=s[r];a||(s[r]=a={});var c=a[o];return void 0===c&&(a[o]=c=t),c}(e,o);n[o]=s})),n}function a(e,t,n,o){if(!e.isLines&&!e.iblines){var a=s(e,n),l=function(e,t){var n=new Float32Array(3*Object(r.getVertexCount)(e));return Object(r.enumMeshVertices)(e,(function(e,t,r,i){n[3*i]=e.x,n[3*i+1]=e.y,n[3*i+2]=e.z}),t),n}(e,t),c={},u=[],d=new i.LmvVector3,h=new i.LmvVector3,f=new i.LmvVector3,p=new i.LmvVector3,m=new i.LmvVector3;for(var g in Object(r.enumMeshTriangles)(e,(function(e,t,n,r,i,o){b(r,i,o),b(i,o,r),b(o,r,i)})),c)for(var v in c[g])u.push(parseInt(g)),u.push(parseInt(v));u.length>1&&(e.iblines=new Uint16Array(u.length),e.iblines.set(u))}function y(e,t){t.x=l[3*e],t.y=l[3*e+1],t.z=l[3*e+2]}function _(e,t,n,r){y(e,d),y(t,h),y(n,f),h.sub(d),f.sub(d),h.cross(f),r.copy(h).normalize()}function b(e,t,n){var r=a[e],i=a[t],s=a[n];if(r!==i&&r!==s&&i!==s){var l=!1;if(r>i){var d=r;r=i,i=d,l=!0}var h=c[r];if(h){var f=h[i];if(void 0===f)h[i]=l?-n-1:n;else{if(o)u.push(e),u.push(t);else{_(e,t,n,p),f<0?_(i,r,a[-f-1],m):_(r,i,a[f],m);var g=p.dot(m);Math.abs(g)<.25&&(u.push(e),u.push(t))}delete h[i]}}else c[r]={},c[r][i]=n}}}},"./src/wgs/scene/FragmentList.js":
/*!***************************************!*\
  !*** ./src/wgs/scene/FragmentList.js ***!
  \***************************************/
/*! exports provided: FragmentList, FragmentPointer */function(e,t,n){"use strict";n.r(t),n.d(t,"FragmentList",(function(){return f})),n.d(t,"FragmentPointer",(function(){return E}));var r=n(/*! ../globals */"./src/wgs/globals.js"),i=n(/*! three */"./thirdparty/three.js/three.js"),o=n(/*! ./MeshFlags */"./src/wgs/scene/MeshFlags.js"),s=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),a=n(/*! ./IntArray */"./src/wgs/scene/IntArray.js"),l=(n(/*! ../../application/Viewer3D */"./src/application/Viewer3D.js"),new i.Matrix4),c=new i.Box3,u=new i.Quaternion,d=new i.Vector3,h=new i.Vector3;function f(e){this.is2d=e.is2d(),this.modelId=e.getModelId(),this.fragments=e.getData().fragments,this.geoms=e.getGeometryList(),this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!r.memoryOptimizedLoading):(this.boxes=null,this.transforms=null,this.useThreeMesh=!0);var t=this.fragments.length;if(this.vizflags=new Uint16Array(t),this.useThreeMesh&&(this.vizmeshes=new Array(t)),e.isOTG()){var n=e.getData().metadata.stats,i=n.num_materials,o=n.num_geoms;this.materialids=Object(a.allocateUintArray)(t,i),this.geomids=Object(a.allocateUintArray)(t,o)}else this.geomids=new Int32Array(t),this.materialids=new Int32Array(t);this.materialmap={},this.materialIdMap={},this.nextMaterialId=1,this.db2ThemingColor=[],this.originalColors=[],this.themingOrGhostingNeedsUpdate=[],this.dbIdIsHidden=[],this.dbIdIsGhosted=[],this.animxforms=null;for(var s=0;s<t;s++)this.vizflags[s]=1;!e.isOTG()&&this.fragments.visibilityFlags&&this.vizflags.set(this.fragments.visibilityFlags),this.allVisible=!0,this.allVisibleDirty=!0,this.nextAvailableFragID=t,this.linesHidden=!1,this.pointsHidden=!1}function p(e){var t=e.r;return e.r=e.b,e.b=t,e}f.prototype.getNextAvailableFragmentId=function(){return this.nextAvailableFragID++},f.prototype.fragmentsHaveBeenAdded=function(){return this.vizflags.length>this.fragments.length},f.prototype.getSvfMaterialId=function(e){var t=this.getMaterial(e);return t?t.svfMatId:void 0},f.prototype.setMesh=function(e,t,n,r){if(this.vizmeshes){var a=this.vizmeshes[e];a&&a.parent&&a.parent.remove(a)}if(this.vizflags.length<=e){this.isFixedSize&&(s.logger.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);var l=Math.ceil(1.5*Math.max(this.vizflags.length,e))||1;this.useThreeMesh&&l<this.vizmeshes.length&&(l=this.vizmeshes.length);var u=new Uint16Array(l);if(u.set(this.vizflags),this.vizflags=u,this.transforms){var d=new Float32Array(12*l);d.set(this.transforms),this.transforms=d}if(this.boxes){var h=new Float32Array(6*l);h.set(this.boxes),this.boxes=h}if(this.geomids){var f=new Int32Array(l);f.set(this.geomids),this.geomids=f}if(this.materialids){var p=new Int32Array(l);p.set(this.materialids),this.materialids=p}}if(this.useThreeMesh){var m;r&&t instanceof i.Mesh?(m=t,t.matrix&&m.matrixWorld.copy(t.matrix),m.dbId=m.dbId||0):(m=new i.Mesh(t.geometry,t.material),t.matrix&&(m.matrix&&m.matrix.copy(t.matrix),m.matrixWorld.copy(t.matrix)),m.is2d=t.is2d,m.isLine=t.isLine,m.isWideLine=t.isWideLine,m.isPoint=t.isPoint,m.dbId=0|this.fragments.fragId2dbId[e]),m.matrixAutoUpdate=!1,m.frustumCulled=!1,m.fragId=e,m.modelId=this.modelId,this.vizmeshes[e]=m}else{var g=void 0;t.geometry.hash?(void 0===t.geomId&&console.error("meshInfo must provide geomId"),g=t.geomId):g=t.geometry.svfid,this.geomids[e]=g,this.setMaterial(e,t.material)}var v=0;if(t.isLine?v=o.MeshFlags.MESH_ISLINE:t.isWideLine?v=o.MeshFlags.MESH_ISWIDELINE:t.isPoint&&(v=o.MeshFlags.MESH_ISPOINT),this.isFixedSize?this.vizflags[e]|=v:this.vizflags[e]|=o.MeshFlags.MESH_VISIBLE|v,n&&this.transforms&&this.boxes){var y=t.matrix,_=12*e,b=y.elements,x=this.transforms;if(x[_]=b[0],x[_+1]=b[1],x[_+2]=b[2],x[_+3]=b[4],x[_+4]=b[5],x[_+5]=b[6],x[_+6]=b[8],x[_+7]=b[9],x[_+8]=b[10],x[_+9]=b[12],x[_+10]=b[13],x[_+11]=b[14],!this.fragments.boxesLoaded){t.bbox?c.copy(t.bbox):(t.geometry&&t.geometry.boundingBox?c.copy(t.geometry.boundingBox):this.geoms.getModelBox(this.geomids[e],c),c.empty()||c.applyMatrix4(y));var w=6*e,E=this.boxes;E[w]=c.min.x,E[w+1]=c.min.y,E[w+2]=c.min.z,E[w+3]=c.max.x,E[w+4]=c.max.y,E[w+5]=c.max.z}}},f.prototype.isFlagSet=function(e,t){return!!(this.vizflags[e]&t)},f.prototype.setFlagFragment=function(e,t,n){var r=this.vizflags[e];return!!(r&t)!=n&&(this.vizflags[e]=n?r|t:r&~t,!0)},f.prototype.setFlagGlobal=function(e,t){var n=this.vizflags,r=0,i=n.length;if(t)for(;r<i;r++)n[r]=n[r]|e;else for(var o=~e;r<i;r++)n[r]=n[r]&o},f.prototype.hideLines=function(e){this.linesHidden=e},f.prototype.hidePoints=function(e){this.pointsHidden=e},f.prototype.hideFragments=function(e,t){var n=o.MeshFlags.MESH_HIDE,r=this.vizflags,i=0,s=r.length;if(t)for(;i<s;i++)r[i]&e&&(r[i]=r[i]|n);else for(var a=~n;i<s;i++)r[i]&e&&(r[i]=r[i]&a);this.allVisibleDirty=!0},f.prototype.isFragVisible=function(e){var t=this.linesHidden&&(this.isLine(e)||this.isWideLine(e)),n=this.pointsHidden&&this.isPoint(e);return 1==(7&this.vizflags[e])&&!t&&!n},f.prototype.isFragOff=function(e){return!(0!==this.vizflags[e]&&this.vizflags[e]!==o.MeshFlags.MESH_HIDE)},f.prototype.isNotLoaded=function(e){return this.vizflags[e]&o.MeshFlags.MESH_NOTLOADED},f.prototype.isLine=function(e){return!!(this.vizflags[e]&o.MeshFlags.MESH_ISLINE)},f.prototype.isWideLine=function(e){return this.isFlagSet(e,o.MeshFlags.MESH_ISWIDELINE)},f.prototype.isPoint=function(e){return this.isFlagSet(e,o.MeshFlags.MESH_ISPOINT)},f.prototype.areAllVisible=function(){if(this.allVisibleDirty){for(var e=this.vizflags,t=!0,n=0,r=e.length;n<r;n++)if(0==(1&e[n])){t=!1;break}this.allVisible=t,this.allVisibleDirty=!1}return this.allVisible};var m,g,v,y,_,b,x=(m=null,g=null,v=parseInt("00FFFFFF",16),y=parseInt("FF000000",16),function(e,t){return m||(m=new i.Color,g=new i.Color),m.set(e&v),p(m),t&&(g.setRGB(t.x,t.y,t.z),m.lerp(g,t.w)),p(m).getHex()|e&y});function w(e,t){if(e.is2d){var n=e.fragments.dbId2fragId[t];if(Array.isArray(n))for(var r=0;r<n.length;r++)e.themingOrGhostingNeedsUpdate[n[r]]=!0;else"number"==typeof n&&(e.themingOrGhostingNeedsUpdate[n]=!0)}}function E(e,t){this.frags=e,this.fragId=t,this.scale=null,this.quaternion=null,this.position=null}f.prototype.getVizmesh=((_=new i.Mesh(void 0,void 0,!0)).isTemp=!0,_.dbId=0,_.modelId=0,_.fragId=-1,_.hide=!1,_.isLine=!1,_.isWideLine=!1,_.isPoint=!1,function(e,t,n){return this.is2d&&function(e,t){var n=e.originalColors[t];if(e.themingOrGhostingNeedsUpdate[t]){var r=e.getGeometry(t),i=r?r.attributes:null,o=i?i.color4b:null,s=i?i.dbId4b:null,a=i?i.layerVp4b:null,l=i?i.flags4b:null;if(o&&s&&r.vb&&a&&l){for(var c=new Uint32Array(r.vb.buffer),u=r.vbstride,d=c.length/r.vbstride,h=!1,f=o.itemOffset,p=s.itemOffset,m=a.itemOffset,g=l.itemOffset,v=0;v<d;v++){var y=c[v*u+p],_=n?n[v]:c[v*u+f],b=c[v*u+m],w=-1==(y=y<<8>>8)&&0==(b&parseInt("FFFF",16)),E=e.db2ThemingColor[y],A=e.dbIdIsHidden[y];if(E||A){if(!n){n=new Uint32Array(d);for(var M=0;M<d;M++)n[M]=c[M*u+f];e.originalColors[t]=n}_=A?0:x(_,E),h=!0}else n&&(_=n[v]);c[v*u+f]=_;var S=e.dbIdIsGhosted[y]&&!w,T=c[v*u+g];S?T|=255<<24:T&=16777215,c[v*u+g]=T}h||(e.originalColors[t]=null),r.vbNeedsUpdate=!0,e.themingOrGhostingNeedsUpdate[t]=!1}}}(this,e),this.useThreeMesh?this.vizmeshes[e]:(_.geometry=this.getGeometry(e),_.material=this.getMaterial(e),_.dbId=this.getDbIds(e),_.modelId=this.modelId,_.fragId=e,_.visible=!0,_.isLine=this.isLine(e),_.isWideLine=this.isWideLine(e),_.isPoint=this.isPoint(e),_.hide=this.isFragOff(e),_.themingColor=this.db2ThemingColor[_.dbId],this.getWorldMatrix(e,_.matrixWorld),_)}),f.prototype.getMaterialId=function(e){var t=this.getMaterial(e);return t?t.id:0},f.prototype.getMaterial=function(e){return this.useThreeMesh?this.vizmeshes[e].material:this.materialIdMap[this.materialids[e]]},f.prototype.getGeometry=function(e){var t;return this.useThreeMesh?(t=this.vizmeshes[e])?t.geometry:null:this.geoms.getGeometry(this.geomids[e])},f.prototype.getGeometryId=function(e){return this.useThreeMesh?e:this.geomids[e]},f.prototype.setMaterial=function(e,t){if(this.useThreeMesh)this.vizmeshes[e].material=t;else{var n=this.materialmap[t.id];n||(n=this.nextMaterialId++,this.materialids=Object(a.reallocateUintArrayMaybe)(this.materialids,n),this.materialIdMap[n]=t,this.materialmap[t.id]=n),this.materialids[e]=n}},f.prototype.getCount=function(){return this.vizmeshes?this.vizmeshes.length:this.vizflags.length},f.prototype.getDbIds=function(e){return this.fragments.fragId2dbId[e]},f.prototype.dispose=function(e){if(this.useThreeMesh)for(var t={type:"dispose"},n={type:"removed"},r=0;r<this.vizmeshes.length;r++){var i=this.vizmeshes[r];i&&(i.dispatchEvent(n),i.geometry.dispatchEvent(t))}else this.geoms.dispose(e)},f.prototype.setVisibility=function(e,t){this.setFlagFragment(e,o.MeshFlags.MESH_VISIBLE,t),this.allVisibleDirty=!0},f.prototype.setFragOff=function(e,t){this.setFlagFragment(e,o.MeshFlags.MESH_HIDE,t),this.allVisibleDirty=!0},f.prototype.setAllVisibility=function(e){if(this.is2d){var t=this.fragments;if(t&&t.dbId2fragId)for(var n in t.dbId2fragId)this.setObject2DGhosted(parseInt(n),!e)}else this.setFlagGlobal(o.MeshFlags.MESH_VISIBLE,e),this.allVisible=e,this.allVisibleDirty=!1},f.prototype.updateAnimTransform=function(e,t,n,r){var i,s=this.animxforms;if(!s){var a=this.getCount();s=this.animxforms=new Float32Array(10*a);for(var l=0;l<a;l++)s[i=10*l]=1,s[i+1]=1,s[i+2]=1,s[i+3]=0,s[i+4]=0,s[i+5]=0,s[i+6]=1,s[i+7]=0,s[i+8]=0,s[i+9]=0}i=10*e;var c=!1;t&&(s[i]=t.x,s[i+1]=t.y,s[i+2]=t.z,c=!0),n&&(s[i+3]=n.x,s[i+4]=n.y,s[i+5]=n.z,s[i+6]=n.w,c=!0),r&&(s[i+7]=r.x,s[i+8]=r.y,s[i+9]=r.z,c=!0),this.setFlagFragment(e,o.MeshFlags.MESH_MOVED,c),c||(s[i]=1,s[i+1]=1,s[i+2]=1,s[i+3]=0,s[i+4]=0,s[i+5]=0,s[i+6]=1,s[i+7]=0,s[i+8]=0,s[i+9]=0)},f.prototype.getAnimTransform=function(e,t,n,r){if(!this.animxforms)return!1;if(!this.isFlagSet(e,o.MeshFlags.MESH_MOVED))return!1;var i=10*e,s=this.animxforms;return t&&(t.x=s[i],t.y=s[i+1],t.z=s[i+2]),n&&(n.x=s[i+3],n.y=s[i+4],n.z=s[i+5],n.w=s[i+6]),r&&(r.x=s[i+7],r.y=s[i+8],r.z=s[i+9]),!0},f.prototype.getOriginalWorldMatrix=function(e,t){var n=12*e,r=t.elements,i=this.transforms;if(i)r[0]=i[n],r[1]=i[n+1],r[2]=i[n+2],r[3]=0,r[4]=i[n+3],r[5]=i[n+4],r[6]=i[n+5],r[7]=0,r[8]=i[n+6],r[9]=i[n+7],r[10]=i[n+8],r[11]=0,r[12]=i[n+9],r[13]=i[n+10],r[14]=i[n+11],r[15]=1;else if(this.useThreeMesh){var o=this.getVizmesh(e);o?t.copy(o.matrixWorld):t.identity()}else t.identity()},f.prototype.getWorldMatrix=(b=new i.Matrix4,function(e,t){this.getOriginalWorldMatrix(e,t),this.isFlagSet(e,o.MeshFlags.MESH_MOVED)&&(this.getAnimTransform(e,h,u,d),b.compose(d,u,h),t.multiplyMatrices(b,t))}),f.prototype.getWorldBounds=function(e,t){if(this.boxes&&!this.isFlagSet(e,o.MeshFlags.MESH_MOVED)){var n=this.boxes,r=6*e;return t.min.x=n[r],t.min.y=n[r+1],t.min.z=n[r+2],t.max.x=n[r+3],t.max.y=n[r+4],void(t.max.z=n[r+5])}if(this.useThreeMesh){var i=this.getVizmesh(e);i&&i.geometry&&t.copy(i.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],t);t.empty()||(this.getWorldMatrix(e,l),t.applyMatrix4(l))},f.prototype.getOriginalWorldBounds=function(e,t){if(this.boxes){var n=this.boxes,r=6*e;return t[0]=n[r],t[1]=n[r+1],t[2]=n[r+2],t[3]=n[r+3],t[4]=n[r+4],void(t[5]=n[r+5])}if(this.useThreeMesh){var i=this.getVizmesh(e);i&&i.geometry&&c.copy(i.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],c);c.empty()||(this.getOriginalWorldMatrix(e,l),c.applyMatrix4(l)),t[0]=c.min.x,t[1]=c.min.y,t[2]=c.min.z,t[3]=c.max.x,t[4]=c.max.y,t[5]=c.max.z},f.prototype.setThemingColor=function(e,t){var n=this.db2ThemingColor[e];n===t||n&&t&&n.equals(t)||(this.db2ThemingColor[e]=t||void 0,w(this,e))},f.prototype.clearThemingColors=function(){if(this.is2d)for(var e in this.fragments.dbId2fragId)w(this,parseInt(e));this.db2ThemingColor.length=0},f.prototype.clearThemingColorsByIds=function(e){if(this.is2d)if(Array.isArray(e))for(var t=1,n=e.length;t<n;t++)w(this,e[t]);else w(this,e);var r=Object.keys(this.db2ThemingColor);if(Array.isArray(e))for(t=0;t<e.length;++t){r.indexOf(e[t])>-1&&delete this.db2ThemingColor[e[t]]}else r.indexOf(e)>-1&&delete this.db2ThemingColor[e]},f.prototype.setObject2DGhosted=function(e,t){!!t!=!!this.dbIdIsGhosted[e]&&(this.dbIdIsGhosted[e]=t,w(this,e))},f.prototype.setObject2DVisible=function(e,t){t!==!this.dbIdIsHidden[e]&&(this.dbIdIsHidden[e]=!t,w(this,e))},E.prototype.getWorldMatrix=function(e){this.frags.getWorldMatrix(this.fragId,e)},E.prototype.getOriginalWorldMatrix=function(e){this.frags.getOriginalWorldMatrix(this.fragId,e)},E.prototype.getWorldBounds=function(e){return this.frags.getWorldBounds(this.fragId,e)},E.prototype.getAnimTransform=function(){return this.scale||(this.scale=new i.Vector3(1,1,1),this.quaternion=new i.Quaternion(0,0,0,1),this.position=new i.Vector3(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},E.prototype.updateAnimTransform=function(){this.scale||(this.scale=new i.Vector3(1,1,1),this.quaternion=new i.Quaternion(0,0,0,1),this.position=new i.Vector3(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},E.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)},E.prototype.setMaterial=function(e){return this.frags.setMaterial(this.fragId,e)}},"./src/wgs/scene/FragmentListConsolidation.js":
/*!****************************************************!*\
  !*** ./src/wgs/scene/FragmentListConsolidation.js ***!
  \****************************************************/
/*! exports provided: consolidateFragmentList */function(e,t,n){"use strict";n.r(t),n.d(t,"consolidateFragmentList",(function(){return c}));var r=n(/*! ./Consolidation */"./src/wgs/scene/Consolidation.js"),i=n(/*! ./InstanceBufferBuilder */"./src/wgs/scene/InstanceBufferBuilder.js"),o=n(/*! ../render/MaterialManager */"./src/wgs/render/MaterialManager.js"),s=n(/*! three */"./thirdparty/three.js/three.js");var a,l=(a=null,function(e,t,n,r,l,c){var u=e.getFragmentList();a||(a=new s.Matrix4);var d=n[r],h=u.getGeometry(d),f=u.getMaterial(d),p=l-r;if(1!=p){for(var m=l-1,g=new i.InstanceBufferBuilder(h,p),v=r;v<=m;v++){var y=n[v];u.getOriginalWorldMatrix(y,a);var _=u.fragments.fragId2dbId[y];if(!g.addInstance(a,_)){var b=n[m];n[m]=y,n[v]=b,--v,--m}}var x=g.finish();if(x){var w=t.getMaterialVariant(f,o.MATERIAL_VARIANT.INSTANCED,e);c.addContainerMesh(x,w,n,r,p),c.meshes[c.meshes.length-1].rangeStart=r}for(v=m+1;v<l;v++)y=n[v],c.addSingleFragment(u,y)}else c.addSingleFragment(u,d)});function c(e,t,n,i,o){var a=e.getFragmentList(),c=i.supportsInstancedArrays();n=n||100<<20;new Set([]);var u=function(e){for(var t=e.getCount(),n=[],r=0;r<t;r++){var i=e.getGeometryId(r),o=0|n[i];n[i]=o+1}return n}(a);if(!o){var d=function(e,t){function n(n,r){var i=e.getGeometry(n),o=e.getGeometry(r),s=e.getGeometryId(n),a=e.getGeometryId(r),l=t[s],c=t[a],u=l*i.byteSize,d=c*o.byteSize;return l!=c?l-c:u!=d?u-d:i.id!=o.id?i.id-o.id:e.getMaterialId(n)-e.getMaterialId(r)}for(var r=0,i=e.getCount(),o=new Int32Array(i),s=0;s<i;s++)e.getGeometry(s)&&(o[r]=s,r++);if(r<i&&(o=new Int32Array(o.buffer,o.byteOffset,r)),o.sort)o.sort(n);else{var a=new Array(i);for(s=0;s<i;s++)a[s]=o[s];for(a.sort(n),s=0;s<o.length;s++)o[s]=a[s]}return o}(a,u);o=function(e,t,n,i,o,a){for(var l=new s.Box3,c=new r.ConsolidationBuilder,u=0;u<n.length;u++){if(o[e.getGeometryId(n[u])]>a)break;var d=n[u];e.getWorldBounds(d,l);var h=e.getGeometry(d),f=e.getMaterial(d);c.addGeom(h,f,l,d)}return c.createConsolidationMap(n,u)}(a,0,d,0,u,20)}var h=o.buildConsolidation(a,t,e),f=o.fragOrder,p=o.numConsolidated;if(console.log("合并个数",p),c)!function(e,t,n,r,i){var o=e.getFragmentList();if(!(r>=n.length)){for(var s=r,a=-1,c=-1,u=r;u<n.length;u++){var d=n[u],h=o.getGeometryId(d),f=o.getMaterialId(d);h==a&&f==c||(u!=r&&l(e,t,n,s,u,i),s=u,a=h,c=f)}l(e,t,n,s,n.length,i)}}(e,t,f,p,h),console.log("实例化个数",f.length-p);else for(var m=p;m<f.length;m++){var g=f[m];h.addSingleFragment(a,g)}!function(e,t,n,r){for(var i=e.geoms,o=[],s=0,a=0,l=0;l<t.meshes.length;l++){var c=t.meshes[l],u=c.geometry;u.byteSize||(u.byteSize=(u.vb.byteLength||0)+(u.ib.byteLength||0));var d=Number.isInteger(c.fragId);i.chooseMemoryType(u,u.numInstances,s,a),u.streamingDraw||(a+=u.byteSize,s+=1,d||(u.discardAfterUpload=!0)),d&&(o[u.id]=!0)}for(l=1;l<i.geoms.length;l++)if((u=i.geoms[l])&&!o[l]){var h=n[l];i.chooseMemoryType(u,h,s,a),u.streamingDraw&&r.deallocateGeometry(u),u.streamingDraw||(a+=u.byteSize,s+=1)}}(a,h,u,i);var v=e.getModelId();for(m=0;m<h.meshes.length;m++){h.meshes[m].modelId=v}return h}},"./src/wgs/scene/FrustumIntersector.js":
/*!*********************************************!*\
  !*** ./src/wgs/scene/FrustumIntersector.js ***!
  \*********************************************/
/*! exports provided: FrustumIntersector, OUTSIDE, INTERSECTS, CONTAINS, CONTAINMENT_UNKNOWN */function(e,t,n){"use strict";n.r(t),n.d(t,"FrustumIntersector",(function(){return o})),n.d(t,"OUTSIDE",(function(){return l})),n.d(t,"INTERSECTS",(function(){return c})),n.d(t,"CONTAINS",(function(){return u})),n.d(t,"CONTAINMENT_UNKNOWN",(function(){return d}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=[[1,5,4,7,3,2,6],[0,3,2,1,5,4,6],[0,3,2,6,5,4,6],[0,4,7,3,2,1,6],[0,3,2,1,-1,-1,4],[0,3,2,6,5,1,6],[0,4,7,6,2,1,6],[0,3,7,6,2,1,6],[0,3,7,6,5,1,6],[0,1,5,4,7,3,6],[0,1,5,4,-1,-1,4],[0,1,2,6,5,4,6],[0,4,7,3,-1,-1,4],[-1,-1,-1,-1,-1,-1,0],[1,2,6,5,-1,-1,4],[0,4,7,6,2,3,6],[2,3,7,6,-1,-1,4],[1,2,3,7,6,5,6],[0,1,5,6,7,3,6],[0,1,5,6,7,4,6],[0,1,2,6,7,4,6],[0,4,5,6,7,3,6],[4,5,6,7,-1,-1,4],[1,2,6,7,4,5,6],[0,4,5,6,2,3,6],[2,3,7,4,5,6,6],[1,2,3,7,4,5,6]];function o(){this.frustum=new r.Frustum,this.viewProj=new r.Matrix4,this.viewDir=[0,0,1],this.ar=1,this.viewport=new r.Vector3(1,1,1),this.areaConv=1,this.areaCullThreshold=1,this.eye=new r.Vector3,this.perspective=!1}var s,a,l=0,c=1,u=2,d=-1;function h(e,t,n){return n.x=1&t?e.max.x:e.min.x,n.y=2&t?e.max.y:e.min.y,n.z=4&t?e.max.z:e.min.z,n}o.OUTSIDE=l,o.INTERSECTS=c,o.CONTAINS=u,o.CONTAINMENT_UNKNOWN=d,o.prototype.reset=function(e,t){this.viewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.perspective=e.isPerspective,this.frustum.setFromMatrix(this.viewProj);var n=e.matrixWorldInverse.elements;this.ar=e.aspect,this.viewDir[0]=-n[2],this.viewDir[1]=-n[6],this.viewDir[2]=-n[10],this.eye.x=e.position.x,this.eye.y=e.position.y,this.eye.z=e.position.z,this.areaConv=e.clientWidth*e.clientHeight/4,this.cutPlanes=t},o.prototype.projectedArea=function(){var e=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],t=new r.Box2;function n(e,t){var n=e.x,r=e.y,i=e.z,o=t.elements,s=o[3]*n+o[7]*r+o[11]*i+o[15];s<0&&(s=-s);var a=1/s;e.x=(o[0]*n+o[4]*r+o[8]*i+o[12])*a,e.y=(o[1]*n+o[5]*r+o[9]*i+o[13])*a}return function(r){if(r.empty())return 0;var i=this.viewProj;e[0].set(r.min.x,r.min.y,r.min.z),e[1].set(r.min.x,r.min.y,r.max.z),e[2].set(r.min.x,r.max.y,r.min.z),e[3].set(r.min.x,r.max.y,r.max.z),e[4].set(r.max.x,r.min.y,r.min.z),e[5].set(r.max.x,r.min.y,r.max.z),e[6].set(r.max.x,r.max.y,r.min.z),e[7].set(r.max.x,r.max.y,r.max.z);for(var o=0;o<8;o++)n(e[o],i);return t.makeEmpty(),t.setFromPoints(e),t.min.x<-1&&(t.min.x=-1),t.min.x>1&&(t.min.x=1),t.min.y<-1&&(t.min.y=-1),t.min.y>1&&(t.min.y=1),t.max.x>1&&(t.max.x=1),t.max.x<-1&&(t.max.x=-1),t.max.y>1&&(t.max.y=1),t.max.y<-1&&(t.max.y=-1),(t.max.x-t.min.x)*(t.max.y-t.min.y)}}(),o.prototype.projectedBoxArea=function(){for(var e,t=[],n=[],o=0;o<10;o++)t.push(new r.Vector3),n.push(new r.Vector3);function s(e,t){var n=e.x,r=e.y,i=e.z,o=t.elements,s=o[3]*n+o[7]*r+o[11]*i+o[15];s<0&&(s=-s);var a=1/s;e.x=(o[0]*n+o[4]*r+o[8]*i+o[12])*a,e.y=(o[1]*n+o[5]*r+o[9]*i+o[13])*a}return function(r,o){if(r.empty())return 0;var a,l=this.viewProj;if(this.perspective?(a=this.eye.x>=r.min.x?this.eye.x>r.max.x?2:1:0,this.eye.y>=r.min.y&&(a+=this.eye.y>r.max.y?6:3),this.eye.z>=r.min.z&&(a+=this.eye.z>r.max.z?18:9)):(a=this.viewDir[0]<=0?this.viewDir[0]<0?2:1:0,this.viewDir[1]<=0&&(a+=this.viewDir[1]<0?6:3),this.viewDir[2]<=0&&(a+=this.viewDir[2]<0?18:9)),13===a)return 4;var c,u=i[a][6];for(c=0;c<u;c++){var d=i[a][c];t[c].set((d+1)%4<2?r.min.x:r.max.x,d%4<2?r.min.y:r.max.y,d<4?r.min.z:r.max.z),s(t[c],l)}var h=0;if(o)for(h=(t[u-1].x-t[0].x)*(t[u-1].y+t[0].y),c=0;c<u-1;c++)h+=(t[c].x-t[c+1].x)*(t[c].y+t[c+1].y);else{var f=function(t,r){var i,o,s,a,l,c,u,d,h=t,f=n,p=function(e){switch(u){case 0:return e.x>=-1;case 1:return e.x<=1;case 2:return e.y>=-1;case 3:return e.y<=1}},m=function(e){f[d].x=e.x,f[d++].y=e.y},g=function(){var e,t;switch(u){case 0:e=-1,t=o.y+(s.y-o.y)*(e-o.x)/(s.x-o.x);break;case 1:e=1,t=o.y+(s.y-o.y)*(e-o.x)/(s.x-o.x);break;case 2:t=-1,e=o.x+(s.x-o.x)*(t-o.y)/(s.y-o.y);break;case 3:t=1,e=o.x+(s.x-o.x)*(t-o.y)/(s.y-o.y)}f[d].x=e,f[d++].y=t};for(u=0;u<4&&r>2;u++){for(d=0,a=p(o=h[r-1]),c=0;c<r;c++)l=p(s=h[c]),a?l?m(s):g():l&&(g(),m(s)),o=s,a=l;r=d,i=h,h=f,f=i}return e=r,h}(t,u);if(e>=3)for(h=(f[e-1].x-f[0].x)*(f[e-1].y+f[0].y),c=0;c<e-1;c++)h+=(f[c].x-f[c+1].x)*(f[c].y+f[c+1].y)}return Math.abs(.5*h)}}(),o.prototype.estimateDepth=function(e){var t=this.viewProj.elements,n=(e.min.x+e.max.x)/2,r=(e.min.y+e.max.y)/2,i=(e.min.z+e.max.z)/2,o=1/(t[3]*n+t[7]*r+t[11]*i+t[15]);return(t[2]*n+t[6]*r+t[10]*i+t[14])*o},o.prototype.intersectsBox=(s=new r.Vector3,a=new r.Vector3,function(e){for(var t=this.frustum.planes,n=0,r=0;r<6;r++){var i=t[r];s.x=i.normal.x>0?e.min.x:e.max.x,a.x=i.normal.x>0?e.max.x:e.min.x,s.y=i.normal.y>0?e.min.y:e.max.y,a.y=i.normal.y>0?e.max.y:e.min.y,s.z=i.normal.z>0?e.min.z:e.max.z,a.z=i.normal.z>0?e.max.z:e.min.z;var l=i.distanceToPoint(s),c=i.distanceToPoint(a);if(l<0&&c<0)return o.OUTSIDE;l>0&&c>0&&n++}return 6==n?o.CONTAINS:o.INTERSECTS});var f,p=function(e,t){f||(f=new r.Vector3);for(var n=0;n<8;n++){var i=h(e,n,f);if(s=t,!((o=i).x*s.x+o.y*s.y+o.z*s.z+s.w>1e-6))return!1}var o,s;return!0};o.prototype.boxOutsideCutPlanes=function(e){if(!this.cutPlanes)return!1;for(var t=0;t<this.cutPlanes.length;t++){var n=this.cutPlanes[t];if(p(e,n))return!0}return!1}},"./src/wgs/scene/GeomMergeTask.js":
/*!****************************************!*\
  !*** ./src/wgs/scene/GeomMergeTask.js ***!
  \****************************************/
/*! exports provided: GeomMergeTask, writeIdToBuffer */function(e,t,n){"use strict";n.r(t),n.d(t,"GeomMergeTask",(function(){return i})),n.d(t,"writeIdToBuffer",(function(){return s}));var r=1;function i(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=r++}function o(e){e.x=.5*(1+Math.atan2(e.y,e.x)/Math.PI),e.y=.5*(1+e.z),e.z=0}function s(e,t,n){t[n++]=255&e,t[n++]=e>>8&255,t[n++]=e>>16&255,t[n]=0}var a=function(e,t,n,r,i,s,a){for(var l,c,u,d,h,f,p,m=e.posOffset,g=r;g<i;g++){var v=g*e.vbstride+m;a.set(e.vb[v],e.vb[v+1],e.vb[v+2]),a.applyMatrix4(n),e.vb[v]=a.x,e.vb[v+1]=a.y,e.vb[v+2]=a.z}if(-1!==e.normalOffset){var y=2*e.vbstride,_=2*e.normalOffset,b=function(e,t){return t.copy(e),t[12]=0,t[13]=0,t[14]=0,t.getInverse(t).transpose()}(n,s);for(g=r;g<i;g++){var x=g*y+_;a.set(t[x],t[x+1],0),a.divideScalar(65535),c=void 0,u=void 0,d=void 0,h=void 0,f=void 0,p=void 0,c=2*(l=a).x-1,u=2*l.y-1,d=Math.sin(c*Math.PI),h=Math.cos(c*Math.PI),f=Math.sqrt(1-u*u),p=u,l.x=h*f,l.y=d*f,l.z=p,a.applyMatrix4(b),a.normalize(),o(a),a.multiplyScalar(65535),t[x]=a.x,t[x+1]=a.y}}};function l(e,t,n){for(var r=16*e,i=0;i<16;i++)n.elements[i]=t[i+r]}i.prototype.run=function(e,t){for(var n=this.vb,r=n.length/this.vbstride,i=e.clone(),o=new Uint8Array(3*r),c=-1!==this.normalOffset?new Uint16Array(n.buffer,n.byteOffset,2*n.length):null,u=this.ranges,d=this.matrices,h=u.length-1,f=0;f<h;f++){var p=u[f],m=u[f+1];l(f,d,e),a(this,c,e,p,m,i,t);for(var g=3*p,v=m-p,y=this.dbIds[f],_=0;_<v;_++)s(y,o,g),g+=3}return{taskId:this.id,vb:this.vb,vertexIds:o}}},"./src/wgs/scene/GeometryList.js":
/*!***************************************!*\
  !*** ./src/wgs/scene/GeometryList.js ***!
  \***************************************/
/*! exports provided: GeometryList */function(e,t,n){"use strict";n.r(t),n.d(t,"GeometryList",(function(){return s}));var r=n(/*! ../globals */"./src/wgs/globals.js"),i=n(/*! ../../compat */"./src/compat.js"),o=n(/*! three */"./thirdparty/three.js/three.js");function s(e,t,n,r){this.geoms=[null],this.numGeomsInMemory=0,this.geomMemory=0,this.gpuMeshMemory=0,this.gpuNumMeshes=0,this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=t,this.geomBoxes=r?null:new Float32Array(6*Math.max(1,e+1)),this.numObjects=e,this.disableStreaming=!!n}s.prototype.getGeometry=function(e){return this.geoms[e]},s.prototype.chooseMemoryType=function(e,t,n,i){var o=r.GPU_MEMORY_LIMIT,s=2*o,a=r.GPU_OBJECT_LIMIT;if(0===o)return e.streamingDraw=!0,void(e.streamingIndex=!0);if(this.disableStreaming||i<o&&n<a)e.streamingDraw=!1,e.streamingIndex=!1;else if(i>=s)e.streamingDraw=!0,e.streamingIndex=!0;else{(this.is2d?100001:e.byteSize*(t||1))<1e5&&(e.streamingDraw=!0,e.streamingIndex=!0)}},s.prototype.addGeometry=function(e,t,n){this.chooseMemoryType(e,t,this.gpuNumMeshes,this.gpuMeshMemory);var s=e.byteSize+r.GEOMETRY_OVERHEAD;if(e.streamingDraw||(Object(i.isMobileDevice)()&&(s+=e.byteSize),this.gpuMeshMemory+=e.byteSize,this.gpuNumMeshes+=1),this.numGeomsInMemory++,(void 0===n||n<=0)&&(n=this.geoms.length),this.geoms[n]=e,this.geomBoxes){var a=this.geomBoxes.length/6|0;if(a<this.geoms.length){var l=3*this.geoms.length/2|0,c=new Float32Array(6*l);c.set(this.geomBoxes);var u=new o.Box3;for(u.makeEmpty();a<l;)c[6*a]=u.min.x,c[6*a+1]=u.min.y,c[6*a+2]=u.min.z,c[6*a+3]=u.max.x,c[6*a+4]=u.max.y,c[6*a+++5]=u.max.z;this.geomBoxes=c}var d=e.boundingBox;d?(this.geomBoxes[6*n]=d.min.x,this.geomBoxes[6*n+1]=d.min.y,this.geomBoxes[6*n+2]=d.min.z,this.geomBoxes[6*n+3]=d.max.x,this.geomBoxes[6*n+4]=d.max.y,this.geomBoxes[6*n+5]=d.max.z):(e.hash||console.error("Mesh without bbox and without hash should not be."),this.geomBoxes[6*n]=-.5,this.geomBoxes[6*n+1]=-.5,this.geomBoxes[6*n+2]=-.5,this.geomBoxes[6*n+3]=.5,this.geomBoxes[6*n+4]=.5,this.geomBoxes[6*n+5]=.5)}r.memoryOptimizedLoading&&!this.is2d&&(e.boundingBox=null,e.boundingSphere=null),this.geomMemory+=s;var h,f=e.attributes.index&&e.attributes.index.array||e.ib,p=e.isLines?2:3;return h=f?f.length/p:e.vb?e.vb.length/(p*e.stride):e.attributes.position.length/(3*p),this.geomPolyCount+=h,this.instancePolyCount+=h*(t||1),e.polyCount=h,e.instanceCount=t||1,e.svfid=n,n},s.prototype.removeGeometry=function(e,t){var n=this.getGeometry(e);if(!n)return 0;var o=n.byteSize+r.GEOMETRY_OVERHEAD;return t&&t.deallocateGeometry(n),n.streamingDraw||(Object(i.isMobileDevice)()&&(o+=n.byteSize),this.gpuMeshMemory-=n.byteSize,this.gpuNumMeshes-=1),this.geoms[e]=null,this.geomMemory-=o,this.numGeomsInMemory--,this.geomPolyCount-=n.polyCount,this.instancePolyCount-=n.instanceCount*n.polyCount,o},s.prototype.getModelBox=function(e,t){if(this.geomBoxes)if(0===e||this.geomBoxes.length/6<=e)t.makeEmpty();else{var n=6*e,r=this.geomBoxes;t.min.x=r[n],t.min.y=r[n+1],t.min.z=r[n+2],t.max.x=r[n+3],t.max.y=r[n+4],t.max.z=r[n+5]}else e>=1&&e<=this.numObjects?(t.min.x=-.5,t.min.y=-.5,t.min.z=-.5,t.max.x=.5,t.max.y=.5,t.max.z=.5):t.makeEmpty()},s.prototype.dispose=function(e){if(e)for(var t=0,n=this.geoms.length;t<n;t++)this.geoms[t]&&e.deallocateGeometry(this.geoms[t])},s.prototype.printStats=function(){o.log("Total geometry size: "+this.geomMemory/1048576+" MB"),o.log("Number of meshes: "+(this.geoms.length-1)),o.log("Num Meshes on GPU: "+this.gpuNumMeshes),o.log("Net GPU geom memory used: "+this.gpuMeshMemory)}},"./src/wgs/scene/InstanceBufferBuilder.js":
/*!************************************************!*\
  !*** ./src/wgs/scene/InstanceBufferBuilder.js ***!
  \************************************************/
/*! exports provided: InstanceBufferBuilder */function(e,t,n){"use strict";n.r(t),n.d(t,"InstanceBufferBuilder",(function(){return l}));var r=n(/*! ./Consolidation */"./src/wgs/scene/Consolidation.js"),i=n(/*! ./GeomMergeTask */"./src/wgs/scene/GeomMergeTask.js"),o=n(/*! ./BufferGeometry */"./src/wgs/scene/BufferGeometry.js"),s=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),a=n(/*! three */"./thirdparty/three.js/three.js");function l(e,t){var n=Object(o.createBufferGeometry)();n.ib=e.ib,n.vb=e.vb,n.iblines=e.iblines,Object(r.copyVertexFormat)(e,n),Object(r.copyPrimitiveProps)(e,n);this.offsets=new Float32Array(3*t),this.rotations=new Float32Array(4*t),this.scalings=new Float32Array(3*t),this.ids=new Uint8Array(3*t);var l=new a.Vector3,c=new a.Quaternion,u=new a.Vector3,d=new a.Matrix4,h=0,f=t;this.addInstance=function(e,t){return h>=f?(s.logger.warn("Instance buffer is already full."),!1):(e.decompose(l,c,u),!!function(e,t,n,r){d.compose(t,n,r);for(var i=e.elements,o=d.elements,s=0;s<16;s++){var a=i[s],l=o[s];if(Math.abs(l-a)>1e-5)return!1}return!0}(e,l,c,u)&&(this.offsets[3*h]=l.x,this.offsets[3*h+1]=l.y,this.offsets[3*h+2]=l.z,this.rotations[4*h]=c.x,this.rotations[4*h+1]=c.y,this.rotations[4*h+2]=c.z,this.rotations[4*h+3]=c.w,this.scalings[3*h]=u.x,this.scalings[3*h+1]=u.y,this.scalings[3*h+2]=u.z,Object(i.writeIdToBuffer)(t,this.ids,3*h),h++,!0))},this.finish=function(){if(0==h)return null;h<f&&(this.offsets=new Float32Array(this.offsets.buffer,0,3*h),this.rotations=new Float32Array(this.rotations.buffer,0,4*h),this.scalings=new Float32Array(this.scalings.buffer,0,3*h),this.ids=new Uint8Array(this.ids.buffer,0,3*h));var e=new a.BufferAttribute(this.offsets,3),t=new a.BufferAttribute(this.rotations,4),r=new a.BufferAttribute(this.scalings,3),i=new a.BufferAttribute(this.ids,3);return i.normalize=!0,i.bytesPerItem=1,e.divisor=1,t.divisor=1,r.divisor=1,i.divisor=1,n.addAttribute("instOffset",e),n.addAttribute("instRotation",t),n.addAttribute("instScaling",r),n.addAttribute("id",i),n.numInstances=h,n.byteSize=n.vb.byteLength+n.ib.byteLength+this.offsets.byteLength+this.rotations.byteLength+this.scalings.byteLength,n}}},"./src/wgs/scene/InstanceTree.js":
/*!***************************************!*\
  !*** ./src/wgs/scene/InstanceTree.js ***!
  \***************************************/
/*! exports provided: InstanceTree */function(e,t,n){"use strict";n.r(t),n.d(t,"InstanceTree",(function(){return o}));var r=n(/*! ./SelectionMode */"./src/wgs/scene/SelectionMode.js"),i=n(/*! ../../logger/Logger */"./src/logger/Logger.js");function o(e,t,n){this.nodeAccess=e,this.maxDepth=n,this.objectCount=t,this.numHidden=0,this.numOff=0,this.fragList=null}o.prototype.setFlagNode=function(e,t,n){var r=this.nodeAccess.getNodeFlags(e);return!!(r&t)!=n&&(n?this.nodeAccess.setNodeFlags(e,r|t):this.nodeAccess.setNodeFlags(e,r&~t),!0)},o.prototype.setFlagGlobal=function(e,t){var n=this.nodeAccess,r=0,i=n.numNodes;if(t)for(;r<i;r++)n.setNodeFlags(r,n.getNodeFlags(r)|e);else for(var o=~e;r<i;r++)n.setNodeFlags(r,n.getNodeFlags(r)&o)},o.prototype.setNodeOff=function(e,t){var n=this.setFlagNode(e,1073741824,t);return n&&(t?this.numOff++:this.numOff--),n},o.prototype.isNodeOff=function(e){return!!(1073741824&this.nodeAccess.getNodeFlags(e))},o.prototype.setNodeHidden=function(e,t){var n=this.setFlagNode(e,2147483648,t);return n&&(t?this.numHidden++:this.numHidden--),n},o.prototype.isNodeHidden=function(e){return!!(2147483648&this.nodeAccess.getNodeFlags(e))},o.prototype.lockNodeSelection=function(e,t){return this.setFlagNode(e,16384,t)},o.prototype.isNodeSelectionLocked=function(e){return!!(16384&this.nodeAccess.getNodeFlags(e))},o.prototype.lockNodeVisible=function(e,t){return this.setFlagNode(e,4096,t)},o.prototype.isNodeVisibleLocked=function(e){return!!(4096&this.nodeAccess.getNodeFlags(e))},o.prototype.isNodeExplodeLocked=function(e){return!!(8192&this.nodeAccess.getNodeFlags(e))},o.prototype.lockNodeExplode=function(e,t){return this.setFlagNode(e,8192,t)},o.prototype.getNodeType=function(e){return 7&this.nodeAccess.getNodeFlags(e)},o.prototype.isNodeSelectable=function(e){return!(536870912&this.nodeAccess.getNodeFlags(e))},o.prototype.getNodeParentId=function(e){return this.nodeAccess.getParentId(e)},o.prototype.getRootId=function(){return this.nodeAccess.rootId},o.prototype.getNodeName=function(e,t){return this.nodeAccess.name(e,t)},o.prototype.getChildCount=function(e){return this.nodeAccess.getNumChildren(e)};var s=new Array(6);o.prototype.getNodeBox=function(e,t){if(this.nodeAccess.nodeBoxes)this.nodeAccess.getNodeBox(e,t);else{var n=this.fragList;if(n)return t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0,void this.enumNodeFragments(e,(function(e){n.getOriginalWorldBounds(e,s),t[0]=Math.min(t[0],s[0]),t[1]=Math.min(t[1],s[1]),t[2]=Math.min(t[2],s[2]),t[3]=Math.max(t[3],s[3]),t[4]=Math.max(t[4],s[4]),t[5]=Math.max(t[5],s[5])}),!0);i.logger.error("getNodeBox() requires fragBoxes or nodeBoxes")}},o.prototype.getNodeIndex=function(e){return this.nodeAccess.getIndex(e)},o.prototype.enumNodeFragments=function(e,t,n){var r;"number"==typeof e?r=e:e&&(r=e.dbId);var i=this;return function e(r){var o=i.nodeAccess.enumNodeFragments(r,t);return o||(n&&(o=i.enumNodeChildren(r,(function(t){return e(t)})))?o:void 0)}(r)},o.prototype.enumNodeChildren=function(e,t,n){var r;"number"==typeof e?r=e:e&&(r=e.dbId);var i=this;if(n&&t(r))return r;return function e(r){var o=i.nodeAccess.enumNodeChildren(r,(function(r){return t(r)?r:n?e(r):void 0}));if(o)return o}(r)},o.prototype.findNodeForSelection=function(e,t){if(t===r.SelectionMode.LEAF_OBJECT)return e;var n,i,o=e;if(t===r.SelectionMode.FIRST_OBJECT){var s=[];for(n=e;n;)s.push(n),n=this.getNodeParentId(n);for(var a=s.length-1;a>=0;a--)if(5!==(i=this.getNodeType(s[a]))&&2!==i&&3!==i){o=s[a];break}}else if(t===r.SelectionMode.LAST_OBJECT)for(n=e;n;){if(4===(i=this.getNodeType(n))){o=n;break}n=this.getNodeParentId(n)}return o},o.prototype.setFragmentList=function(e){this.fragList=e}},"./src/wgs/scene/InstanceTreeStorage.js":
/*!**********************************************!*\
  !*** ./src/wgs/scene/InstanceTreeStorage.js ***!
  \**********************************************/
/*! exports provided: FlatStringStorage, InstanceTreeStorage, InstanceTreeAccess */function(e,t,n){"use strict";n.r(t),n.d(t,"FlatStringStorage",(function(){return o})),n.d(t,"InstanceTreeStorage",(function(){return s})),n.d(t,"InstanceTreeAccess",(function(){return l}));var r=n(/*! ../../file-loaders/lmvtk/common/StringUtils */"./src/file-loaders/lmvtk/common/StringUtils.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this.buf=t.buf,this.idx=t.idx,this.next=t.next):(this.buf=new Uint8Array(256),this.next=0,this.idx=[0])}var t,n,o;return t=e,(n=[{key:"allocate",value:function(e){if(this.buf.length-this.next<e){var t=Math.max(3*this.buf.length/2,this.buf.length+e),n=new Uint8Array(t);n.set(this.buf),this.buf=n}}},{key:"add",value:function(e){if(null==e)return 0;if(!e.length)return this.idx.push(this.next),this.idx.length-1;var t=Object(r.utf16to8)(e,null);return this.allocate(t),this.next+=Object(r.utf16to8)(e,this.buf,this.next),this.idx.push(this.next),this.idx.length-1}},{key:"get",value:function(e){if(e){var t=this.idx[e-1],n=this.idx[e];return t===n?"":Object(r.utf8BlobToStr)(this.buf,t,n-t)}}},{key:"flatten",value:function(){this.idx=a(this.idx)}}])&&i(t.prototype,n),o&&i(t,o),e}();function s(e,t){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=new o,this.nameSuffixes=[],this.getIndex(0)}function a(e){var t=new Int32Array(e.length);return t.set(e),t}function l(e,t,n){this.nodes=e.nodes,this.children=e.children,this.dbIdToIndex=e.dbIdToIndex,this.names=e.names,this.nameSuffixes=e.nameSuffixes,this.strings=new o(e.strings),this.rootId=t,this.numNodes=this.nodes.length/5,this.visibleIds=null,this.nodeBoxes=n}s.prototype.getIndex=function(e){var t=this.dbIdToIndex[e];if(t)return t;t=this.nextNode++,this.nodes.push(e);for(var n=1;n<5;n++)this.nodes.push(0);return this.dbIdToIndex[e]=t,t},s.prototype.setNode=function(e,t,n,r,i,o){var s,a=this.getIndex(e),l=5*a,c=i.length,u=o&&o.length;for(u&&(c+=o.length),this.nodes[l+1]=t,this.nodes[l+2]=this.nextChild,this.nodes[l+3]=u?-c:c,this.nodes[l+4]=r,s=0;s<i.length;s++)this.children[this.nextChild++]=this.getIndex(i[s]);if(u)for(s=0;s<o.length;s++)this.children[this.nextChild++]=-o[s]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(a,n)},s.prototype.processName=function(e,t){var n,r,i=-1,o=-1;if(t&&(o=t.lastIndexOf("]"),-1!==(i=t.lastIndexOf("["))&&-1!==o||(i=t.lastIndexOf(":"),o=t.length)),i>=0&&o>i){n=t.slice(0,i+1);var s=t.slice(i+1,o);(r=parseInt(s,10))&&r+""===s||(n=t,r=0)}else n=t,r=0;var a=this.s2i[n];void 0===a&&(a=this.strings.add(n),this.s2i[n]=a),this.names[e]=a,this.nameSuffixes[e]=r},s.prototype.flatten=function(e,t,n,r,i,o){this.nodes=a(this.nodes),this.children=a(this.children),this.names=a(this.names),this.nameSuffixes=a(this.nameSuffixes),this.strings.flatten(),this.s2i=null},l.prototype.getNumNodes=function(){return this.numNodes},l.prototype.getIndex=function(e){return this.dbIdToIndex[e]},l.prototype.name=function(e,t){var n,r=this.dbIdToIndex[e],i=this.strings.get(this.names[r]),o=this.nameSuffixes[r];o?n="["===i.charAt(i.length-1)?i+o+"]":i+o:n=i;return t&&(this.childCounts||this.computeChildCounts(),this.childCounts[e]>0&&(n+=" ("+this.childCounts[e]+")")),n},l.prototype.getParentId=function(e){var t=this.dbIdToIndex[e];return this.nodes[5*t+1]},l.prototype.getNodeFlags=function(e){var t=this.dbIdToIndex[e];return this.nodes[5*t+4]},l.prototype.setNodeFlags=function(e,t){var n=this.dbIdToIndex[e];n&&(this.nodes[5*n+4]=t)},l.prototype.getNumChildren=function(e){var t=this.dbIdToIndex[e],n=this.nodes[5*t+3];if(n>=0)return n;var r=this.nodes[5*t+2];n=Math.abs(n);for(var i=0,o=0;o<n;o++){if(this.children[r+o]<0)break;i++}return i},l.prototype.getNumFragments=function(e){var t=this.dbIdToIndex[e],n=this.nodes[5*t+3];if(n>=0)return 0;for(var r=this.nodes[5*t+2],i=0,o=(n=Math.abs(n))-1;o>=0;o--){if(this.children[r+o]>=0)break;i++}return i},l.prototype.getNodeBox=function(e,t){for(var n=6*this.getIndex(e),r=0;r<6;r++)t[r]=this.nodeBoxes[n+r]},l.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map((function(e){return parseInt(e)}))),this.visibleIds},l.prototype.enumNodeChildren=function(e,t){var n=this.dbIdToIndex[e],r=this.nodes[5*n+2],i=this.nodes[5*n+3];i=Math.abs(i);for(var o=0;o<i;o++){var s=this.children[r+o];if(s<0)break;if(t(this.nodes[5*s+0],e,n))return e}},l.prototype.enumNodeFragments=function(e,t){var n=this.dbIdToIndex[e],r=this.nodes[5*n+2],i=this.nodes[5*n+3];if(i<0){i=-i;for(var o=0;o<i;o++){var s=this.children[r+o];if(!(s>0)&&t(-s-1,e,n))return e}}},l.prototype.computeBoxes=function(e){this.nodeBoxes||(this.nodeBoxes=new Float32Array(6*this.numNodes));var t=this,n=t.getIndex(t.rootId),r=t.nodeBoxes;function i(e,n,i){var o=t.getIndex(e);s(e,o);for(var a=6*i,l=6*o,c=0;c<3;c++)r[a+c]>r[l+c]&&(r[a+c]=r[l+c]),r[a+c+3]<r[l+c+3]&&(r[a+c+3]=r[l+c+3])}function o(t,n,i){for(var o=6*t,s=6*i,a=0;a<3;a++)r[s+a]>e[o+a]&&(r[s+a]=e[o+a]),r[s+a+3]<e[o+a+3]&&(r[s+a+3]=e[o+a+3])}function s(e,n){var s=6*n;r[s]=r[s+1]=r[s+2]=1/0,r[s+3]=r[s+4]=r[s+5]=-1/0,t.getNumChildren(e)&&t.enumNodeChildren(e,i,!0),t.getNumFragments(e)&&t.enumNodeFragments(e,o)}s(t.rootId,n)},l.prototype.computeChildCounts=function(){this.childCounts||(this.childCounts=new Uint32Array(this.numNodes));var e=this,t=(e.getIndex(e.rootId),e.childCounts);function n(n,i,o){var s=r(n,e.getIndex(n));t[i]+=s}function r(r,i){var o=0;return 4===e.getNodeFlags(r)?o=1:(e.getNumChildren(r)&&e.enumNodeChildren(r,n,!0),e.getNumFragments(r)&&(o=1)),o+t[r]}r(e.rootId)}},"./src/wgs/scene/IntArray.js":
/*!***********************************!*\
  !*** ./src/wgs/scene/IntArray.js ***!
  \***********************************/
/*! exports provided: allocateUintArray, reallocateUintArrayMaybe */function(e,t,n){"use strict";function r(e,t){return t<=255?new Uint8Array(e):t<=65535?new Uint16Array(e):new Uint32Array(e)}function i(e,t){if(t<=255)return e;if(t<=65535&&e instanceof Uint8Array){var n=new Uint16Array(e.length);return n.set(e),n}if(!e instanceof Uint32Array){var r=new Uint32Array(e.length);return r.set(e),r}return e}n.r(t),n.d(t,"allocateUintArray",(function(){return r})),n.d(t,"reallocateUintArrayMaybe",(function(){return i}))},"./src/wgs/scene/LeafletDiffIterator.js":
/*!**********************************************!*\
  !*** ./src/wgs/scene/LeafletDiffIterator.js ***!
  \**********************************************/
/*! exports provided: LeafletDiffModes, LeafletDiffIterator */function(e,t,n){"use strict";n.r(t),n.d(t,"LeafletDiffModes",(function(){return u})),n.d(t,"LeafletDiffIterator",(function(){return f}));var r=n(/*! ../render/shaders/leafletdiff_frag.glsl */"./src/wgs/render/shaders/leafletdiff_frag.glsl"),i=n.n(r),o=n(/*! ../render/shaders/leafletdiff_vert.glsl */"./src/wgs/render/shaders/leafletdiff_vert.glsl"),s=n.n(o),a=n(/*! ./TexQuadUtils */"./src/wgs/scene/TexQuadUtils.js"),l=n(/*! three */"./thirdparty/three.js/three.js"),c=n(/*! ../../compat */"./src/compat.js"),u={NORMAL_DIFF:0,MODEL_A_ONLY:1,MODEL_B_ONLY:2,SPLIT_VIEW:3,HIGHLIGHT_A:4,HIGHLIGHT_B:5};function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1/0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;this.l=e,this.b=t,this.r=n,this.t=r}function h(){var e={},t={};this.acquireShaderMaterial=function(n,r){e[r]||function(n){e[n]=[],t[n]=0}(r);var o=e[r][t[r]];if(o)for(var a in o.defines={},n)o.uniforms[a].value=n[a].value;else o=new l.ShaderMaterial({uniforms:n,vertexShader:s.a,fragmentShader:i.a}),e[r][t[r]]=o;return t[r]++,o},this.reset=function(){for(var e in t)t[e]=0},this.setThreshold=function(t){for(var n in e)for(var r=0;r<e[n].length;r++)e[n][r].uniforms.diff_threshold.value=t,e[n][r].needsUpdate=!0},this.dispose=function(){for(var t in e)for(var n=0;n<e[t].length;n++)(r=e[t][n])&&(r.dispose(),r.needsUpdate=!0);var r}}function f(e,t){var n=e,r=t,i=new l.Scene,o=e.getDpiScale()<1||t.getDpiScale()<1?.25:.1,s=!0,f=!1,p=!0,m=new a.GeometryManager,g=new h,v=new l.Vector3,y=.5,_=0,b=3,x=Object(c.getGlobal)().devicePixelRatio||1,w=0,E=u.NORMAL_DIFF;function A(){return 0!==v.x||0!==v.y}function M(e,t,n){n.position[e](v),n.target[e](v),n.updateMatrixWorld(!0),n.matrixWorldInverse.getInverse(n.matrixWorld),t.reset(n)}function S(e,t,n){var r=e.clone();r.position.z=t;var s=e.material.map,a={diff_threshold:{type:"f",value:o},texture1:{type:"t",value:s},offsetRepeatA:{type:"v4",value:new l.Vector4(s.offset.x,s.offset.y,s.repeat.x,s.repeat.y)},model:{type:"i",value:n},splitPosition:{type:"f",value:y*_*x}},c=E===u.SPLIT_VIEW,d=g.acquireShaderMaterial(a,"nonintersect"+(c?"split":""));return d.defines.SINGLE_MODEL=1,c&&(d.defines.SPLIT_VIEW=1),r.material=d,i.add(r),r}function T(e,t,n,r){e.offsetX=t.offsetX+(r.l-n.l)/n.width()*t.scaleX,e.offsetY=t.offsetY+(r.b-n.b)/n.height()*t.scaleY,e.scaleX=t.scaleX*r.width()/n.width(),e.scaleY=t.scaleY*r.height()/n.height()}function C(e,t,n,r,s){var c=e.rect,d=n.getIntersection(c);if(d){e.intersecStatus=1,e.intersec.union(d);var h=e.material.map,f=t.clone(),p=new a.UVTransform,v=f.geometry.uvTransform;d.equals(n)?(v.copyTo(p),d.equals(c)&&(e.intersecStatus=2)):(T(p,v,n,d),f.geometry=m.acquireQuadGeom(p));var w=new a.UVTransform;T(w,e.geometry.uvTransform,c,d),f.position.set(d.l,d.b,0),f.scale.set(d.width(),d.height(),1);var A=new l.Vector2,M=new l.Vector2;0;var S={diff_threshold:{type:"f",value:o},texture1:{type:"t",value:r},texture2:{type:"t",value:h},offsetRepeatA:{type:"v4",value:new l.Vector4(r.offset.x,r.offset.y,r.repeat.x,r.repeat.y)},offsetRepeatB:{type:"v4",value:new l.Vector4(h.offset.x,h.offset.y,h.repeat.x,h.repeat.y)},uvTFa:{type:"v4",value:p.toVec4()},uvTFb:{type:"v4",value:w.toVec4()},highlight:{type:"i",value:s?0:b},splitPosition:{type:"f",value:y*_*x},resolution1:{type:"v2",value:A},resolution2:{type:"v2",value:M}},C=E===u.SPLIT_VIEW,P=g.acquireShaderMaterial(S,"intersection"+(C?"split":""));return C&&(P.defines.SPLIT_VIEW=1),f.material=P,i.add(f),d}return null}function P(e){for(var t=0;t<e.children.length;t++){var n=e.children[t];n.intersecStatus=0,n.intersec=new d;var r=new l.Vector3;r.addVectors(n.position,v);var i=n.scale;n.rect=new d(r.x,r.y,r.x+i.x,r.y+i.y)}}function L(e,t){var i=A();w=.5*(t.far-t.near);var o=n.reset(e,t);i&&M("sub",e,t);var s=r.reset(e,t);return i&&M("add",e,t),function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.getScene(),i=r.getScene();P(i);for(var o=0;o<t.children.length;o++){for(var s=0,a=t.children[o],l=a.tile,c=a.material.map,u=a.material.tile,h=a.position,f=a.scale,p=new d(h.x,h.y,h.x+f.x,h.y+f.y),m=new d,g=o<i.children.length?o:0,y=i.children.length,_=g;_<y;_++){var b=(T=i.children[_]).tile,x=T.material.tile,E=e&&(x.level!==u.level||l.level!==b.level||u.level<l.level||x.level<b.level),A=C(T,a,p,c,E);if(A&&(s=T.intersecStatus,m.union(A),2===s))break;g>0&&_===y-1&&(y=g,g=0,_=-1)}(0===s||1===s&&!p.equals(m))&&S(a,-.2*w,1)}for(var M=0;M<i.children.length;M++){var T;if(0===(T=i.children[M]).intersecStatus||1===T.intersecStatus&&!T.rect.equals(T.intersec)){var L=S(T,-.1*w,2);L.position.add(v)}}}(!o||!s),o&&s}this.setThreshold=function(e){o=e,g.setThreshold(e)},this.setDiffMode=function(e){E=e,f=!0},this.getDiffMode=function(){return E},this.getOffset=function(){return v},this.setOffset=function(e){v=e},this.setSplitPosition=function(e){y=e},this.rayCast=function(e,t){return null},this.getVisibleBounds=function(e,t){var i=new l.Box3,o=new l.Box3;n.getVisibleBounds(i,o),r.getVisibleBounds(e,t),e.union(i),t.union(o)};var D=0,R=0,I=!0;this.updateProgress=function(e){if(e)this.onProgress(100),D=0,I=!0;else{if(I)R=Date.now(),D=10,I=!1;else{var t=Date.now();D+=(D>60?10:5)*(t-R)/250,D=Math.min(95,D),R=t}this.onProgress(D)}},this.reset=function(e,t){s=!1;for(var o=0;o<i.children.length;o++){i.children[o].dispatchEvent({type:"removed"})}i.children.length=0,i.position.set(0,0,0),_=t.clientWidth,m.reset(),g.reset();var a=!0;switch(E){case u.NORMAL_DIFF:b=3,a=L(e,t);break;case u.MODEL_A_ONLY:!function(e,t){n.reset(e,t),i=n.getScene().clone()}(e,t);break;case u.MODEL_B_ONLY:!function(e,t){var n=A();n&&M("sub",e,t),r.reset(e,t),(i=r.getScene().clone()).position.copy(v),n&&M("add",e,t)}(e,t);break;case u.SPLIT_VIEW:!function(e,t){L(e,t)}(e,t);break;case u.HIGHLIGHT_A:b=1,a=L(e,t);break;case u.HIGHLIGHT_B:b=2,a=L(e,t)}p?a&&(this.onFirstSceneComplete&&this.onFirstSceneComplete(),p=!1):this.onProgress&&this.updateProgress(a)},this.nextBatch=function(){return s?null:(s=!0,i)},this.getScene=function(){return i},this.getSceneCount=function(){return 1},this.done=function(){return s},this.update=function(){return f?(f=!1,!0):n.update()||r.update()},this.dispose=function(){g.dispose(),m.dispose()},this.dtor=function(){this.dispose()}}d.prototype.width=function(){return this.r-this.l},d.prototype.height=function(){return this.t-this.b},d.prototype.getIntersection=function(e){var t=Math.max(this.l,e.l),n=Math.min(this.r,e.r),r=Math.max(this.b,e.b),i=Math.min(this.t,e.t);return n>t&&i>r?new d(t,r,n,i):null},d.prototype.equals=function(e){return this.l===e.l&&this.r===e.r&&this.t===e.t&&this.b===e.b},d.prototype.union=function(e){return this.l=Math.min(this.l,e.l),this.r=Math.max(this.r,e.r),this.b=Math.min(this.b,e.b),this.t=Math.max(this.t,e.t),this}},"./src/wgs/scene/LmvBox3.js":
/*!**********************************!*\
  !*** ./src/wgs/scene/LmvBox3.js ***!
  \**********************************/
/*! exports provided: LmvBox3 */function(e,t,n){"use strict";n.r(t),n.d(t,"LmvBox3",(function(){return s}));var r,i,o=n(/*! ./LmvVector3 */"./src/wgs/scene/LmvVector3.js"),s=function(e,t){this.min=void 0!==e?e:new o.LmvVector3(1/0,1/0,1/0),this.max=void 0!==t?t:new o.LmvVector3(-1/0,-1/0,-1/0)};s.prototype={constructor:s,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromArray:function(e,t){return this.min.x=e[t],this.min.y=e[t+1],this.min.z=e[t+2],this.max.x=e[t+3],this.max.y=e[t+4],this.max.z=e[t+5],this},copyToArray:function(e,t){e[t]=this.min.x,e[t+1]=this.min.y,e[t+2]=this.min.z,e[t+3]=this.max.x,e[t+4]=this.max.y,e[t+5]=this.max.z},setFromCenterAndSize:(i=new o.LmvVector3,function(e,t){var n=i.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new o.LmvVector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new o.LmvVector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new o.LmvVector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new o.LmvVector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.LmvVector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(r=[new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3],function(e){return r[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),r[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),r[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),r[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),r[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),r[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),r[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),r[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(r),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}},"./src/wgs/scene/LmvMatrix4.js":
/*!*************************************!*\
  !*** ./src/wgs/scene/LmvMatrix4.js ***!
  \*************************************/
/*! exports provided: LmvMatrix4 */function(e,t,n){"use strict";n.r(t),n.d(t,"LmvMatrix4",(function(){return r}));var r=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};r.prototype={constructor:r,set:function(e,t,n,r,i,o,s,a,l,c,u,d,h,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,o=e.w,s=n+n,a=r+r,l=i+i,c=n*s,u=n*a,d=n*l,h=r*a,f=r*l,p=i*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(h+p),t[4]=u-v,t[8]=d+g,t[1]=u+v,t[5]=1-(c+p),t[9]=f-m,t[2]=d-g,t[6]=f+m,t[10]=1-(c+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=r[0],w=r[4],E=r[8],A=r[12],M=r[1],S=r[5],T=r[9],C=r[13],P=r[2],L=r[6],D=r[10],R=r[14],I=r[3],j=r[7],O=r[11],N=r[15];return i[0]=o*x+s*M+a*P+l*I,i[4]=o*w+s*S+a*L+l*j,i[8]=o*E+s*T+a*D+l*O,i[12]=o*A+s*C+a*R+l*N,i[1]=c*x+u*M+d*P+h*I,i[5]=c*w+u*S+d*L+h*j,i[9]=c*E+u*T+d*D+h*O,i[13]=c*A+u*C+d*R+h*N,i[2]=f*x+p*M+m*P+g*I,i[6]=f*w+p*S+m*L+g*j,i[10]=f*E+p*T+m*D+g*O,i[14]=f*A+p*C+m*R+g*N,i[3]=v*x+y*M+_*P+b*I,i[7]=v*w+y*S+_*L+b*j,i[11]=v*E+y*T+_*D+b*O,i[15]=v*A+y*C+_*R+b*N,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+i*a*u-r*l*u-i*s*d+n*l*d+r*s*h-n*a*h)+e[7]*(+t*a*h-t*l*d+i*o*d-r*o*h+r*l*c-i*a*c)+e[11]*(+t*l*u-t*s*h-i*o*u+n*o*h+i*s*c-n*l*c)+e[15]*(-r*s*c-t*a*u+t*s*d+r*o*u-n*o*d+n*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[4],s=r[8],a=r[12],l=r[1],c=r[5],u=r[9],d=r[13],h=r[2],f=r[6],p=r[10],m=r[14],g=r[3],v=r[7],y=r[11],_=r[15];n[0]=u*m*v-d*p*v+d*f*y-c*m*y-u*f*_+c*p*_,n[4]=a*p*v-s*m*v-a*f*y+o*m*y+s*f*_-o*p*_,n[8]=s*d*v-a*u*v+a*c*y-o*d*y-s*c*_+o*u*_,n[12]=a*u*f-s*d*f-a*c*p+o*d*p+s*c*m-o*u*m,n[1]=d*p*g-u*m*g-d*h*y+l*m*y+u*h*_-l*p*_,n[5]=s*m*g-a*p*g+a*h*y-i*m*y-s*h*_+i*p*_,n[9]=a*u*g-s*d*g-a*l*y+i*d*y+s*l*_-i*u*_,n[13]=s*d*h-a*u*h+a*l*p-i*d*p-s*l*m+i*u*m,n[2]=c*m*g-d*f*g+d*h*v-l*m*v-c*h*_+l*f*_,n[6]=a*f*g-o*m*g-a*h*v+i*m*v+o*h*_-i*f*_,n[10]=o*d*g-a*c*g+a*l*v-i*d*v-o*l*_+i*c*_,n[14]=a*c*h-o*d*h-a*l*f+i*d*f+o*l*m-i*c*m,n[3]=u*f*g-c*p*g-u*h*v+l*p*v+c*h*y-l*f*y,n[7]=o*p*g-s*f*g+s*h*v-i*p*v-o*h*y+i*f*y,n[11]=s*c*g-o*u*g-s*l*v+i*u*v+o*l*y-i*c*y,n[15]=o*u*h-s*c*h+s*l*f-i*u*f-o*l*p+i*c*p;var b=i*n[0]+l*n[4]+h*n[8]+g*n[12];if(0==b){var x="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/b),this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+n,l*s-r*a,l*a+r*s,0,l*s+r*a,c*s+n,c*a-r*o,0,l*a-r*s,c*a+r*o,i*a*a+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},transformPoint:function(e){var t=e.x,n=e.y,r=e.z,i=this.elements;return e.x=i[0]*t+i[4]*n+i[8]*r+i[12],e.y=i[1]*t+i[5]*n+i[9]*r+i[13],e.z=i[2]*t+i[6]*n+i[10]*r+i[14],e},transformDirection:function(e){var t=e.x,n=e.y,r=e.z,i=this.elements;e.x=i[0]*t+i[4]*n+i[8]*r,e.y=i[1]*t+i[5]*n+i[9]*r,e.z=i[2]*t+i[6]*n+i[10]*r;var o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(o>0){var s=1/o;e.x*=s,e.y*=s,e.z*=s}return e},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new r(this.elements instanceof Float64Array).fromArray(this.elements)}}},"./src/wgs/scene/LmvVector3.js":
/*!*************************************!*\
  !*** ./src/wgs/scene/LmvVector3.js ***!
  \*************************************/
/*! exports provided: LmvVector3 */function(e,t,n){"use strict";n.r(t),n.d(t,"LmvVector3",(function(){return a}));var r,i,o,s,a=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0};a.prototype={constructor:a,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*n,c=a*n+s*t-i*r,u=a*r+i*n-o*t,d=-i*t-o*n-s*r;return this.x=l*a+d*-i+c*-s-u*-o,this.y=c*a+d*-o+u*-i-l*-s,this.z=u*a+d*-s+l*-o-c*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(e,t){return void 0===o&&(o=new a,s=new a),o.set(e,e,e),s.set(t,t,t),this.clamp(o,s)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this},projectOnVector:function(e){return void 0===r&&(r=new a),r.copy(e).normalize(),i=this.dot(r),this.copy(r).multiplyScalar(i)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new a),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new a),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}}},"./src/wgs/scene/MeshFlags.js":
/*!************************************!*\
  !*** ./src/wgs/scene/MeshFlags.js ***!
  \************************************/
/*! exports provided: MeshFlags */function(e,t,n){"use strict";n.r(t),n.d(t,"MeshFlags",(function(){return r}));var r={MESH_VISIBLE:1,MESH_HIGHLIGHTED:2,MESH_HIDE:4,MESH_ISLINE:8,MESH_MOVED:16,MESH_RENDERFLAG:32,MESH_NOTLOADED:64,MESH_ISPOINT:128,MESH_ISWIDELINE:256,MESH_TRAVERSED:512,MESH_DRAWN:1024}},"./src/wgs/scene/ModelIteratorBVH.js":
/*!*******************************************!*\
  !*** ./src/wgs/scene/ModelIteratorBVH.js ***!
  \*******************************************/
/*! exports provided: ModelIteratorBVH */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelIteratorBVH",(function(){return o}));var r=n(/*! ./FrustumIntersector */"./src/wgs/scene/FrustumIntersector.js"),i=n(/*! three */"./thirdparty/three.js/three.js");function o(){var e,t,n,o,s,a=null,l=null,c=null,u=null,d=null,h=null,f=!0,p=!1,m=!1,g=new i.Box3,v=new i.Box3,y=!1,_=!0;function b(e){var r=h[e],i=n;for(1;i>t&&h[d[i-1]]>r;)d[i]=d[i-1],i--;d[i]=e,n++}function x(e){var t=a.getLeftChild(e);-1!==t&&(x(t),x(t+1)),g.makeEmpty(),-1!==t&&(a.getBoxThree(t,v),g.union(v),a.getBoxThree(t+1,v),g.union(v)),a.getPrimCount(e)&&(g.union(c[e].getBoundingBox()),g.union(c[e].getBoundingBoxHidden())),a.setBoxThree(e,g)}this.initialize=function(t,n,r,i){e=t.getFragmentList(),s=t.RenderBatch,i&&i.hasOwnProperty("prioritize_screen_size")&&(f=i.prioritize_screen_size),l=r,c=new Array(n.nodeCount),u=new Int8Array(n.nodeCount),a=n,d=new Int32Array(n.nodeCount+1),h=new Float32Array(n.nodeCount);for(var o=0;o<n.nodeCount;o++){var p=n.getPrimCount(o);p&&(c[o]=new s(e,l,n.getPrimStart(o),p),c[o].lastItem=c[o].start+p,c[o].numAdded=p,c[o].nodeIndex=o,8&n.getFlags(o)&&(c[o].sortObjects=!0),n.getBoxArray(o,c[o].bboxes))}},this.addFragment=function(e,t){},this.reset=function(e){if(o=e,t=0,n=0,u[0]=u[1]=r.FrustumIntersector.CONTAINMENT_UNKNOWN,d[n++]=0,p=!1,m=!1,y=!1,_){for(var i=c,s=i.length,a=0;a<s;++a){var l=i[a];l&&l.resetVisStatus&&l.resetVisStatus()}_=!1}},this.nextBatch=function(){for(m||p||t!==n||(d[n++]=1,p=!0);t!==n;){var e=d[--n],i=u[e];if(i!==r.FrustumIntersector.CONTAINS&&(a.getBoxThree(e,g),i=o.intersectsBox(g)),i!==r.FrustumIntersector.OUTSIDE){var s,l,v=a.getLeftChild(e);if(-1!==v){var _=a.getFlags(e),x=o.viewDir[3&_]<0?1:0,w=_>>2&1,E=_>>3&1,A=0,M=0;f&&!p?(s=v+w,l=v+1-w,a.getBoxThree(s,g),h[s]=A=o.projectedBoxArea(g,i===r.FrustumIntersector.CONTAINS),a.getBoxThree(l,g),h[l]=M=o.projectedBoxArea(g,i===r.FrustumIntersector.CONTAINS),u[s]=u[l]=i,A>0&&b(s),M>0&&b(l)):(1^x^E&&(w=1-w),s=v+w,l=v+1-w,d[n++]=s,h[s]=-1,d[n++]=l,h[l]=-1,u[s]=u[l]=i)}if(0!==a.getPrimCount(e)){var S=c[e];return S.renderImportance=o.projectedBoxArea(S.getBoundingBox(),i===r.FrustumIntersector.CONTAINS),S}}p||m||t!==n||(d[n++]=1,p=!0)}return y=!0,null},this.skipOpaqueShapes=function(){p||m||(t=0,n=0,d[n++]=1,m=!0)},this.getVisibleBounds=function(e,t){for(var n=0;n<c.length;n++){var r=c[n];if(r){r.calculateBounds();var i=r.getBoundingBox();e.union(i),t.union(i),t.union(r.getBoundingBoxHidden())}}x(0),x(1)},this.rayCast=function(e,t,n){for(var r=[1,0],o=new i.Vector3;r.length;){var s=r.pop();if(a.getBoxThree(s,g),g.expandByScalar(.5),null!==e.ray.intersectBox(g,o)){var l=a.getLeftChild(s);if(-1!==l&&(r.push(l),r.push(l+1)),0!==a.getPrimCount(s))c[s].raycast(e,t,n)}}},this.getSceneCount=function(){return c.length},this.getGeomScenes=function(){return c},this.done=function(){return y},this.resetVisStatus=function(){_=!0}}},"./src/wgs/scene/ModelIteratorLinear.js":
/*!**********************************************!*\
  !*** ./src/wgs/scene/ModelIteratorLinear.js ***!
  \**********************************************/
/*! exports provided: ModelIteratorLinear */function(e,t,n){"use strict";n.r(t),n.d(t,"ModelIteratorLinear",(function(){return o}));n(/*! ./RenderBatch */"./src/wgs/scene/RenderBatch.js");var r=n(/*! ../../compat */"./src/compat.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){var n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._frags=t.getFragmentList(),this._RenderBatch=t.RenderBatch,this._model=t,this._fillLast=this._model.is2d(),this._fragsPerScene=(n=t.is2d(),i=500,n&&(i/=6),Object(r.isMobileDevice)()&&(i/=3),(i=Math.floor(i))>0?i:500),this._fragOrder=[],this._geomScenes=[];var o=this._frags.getCount();this._currentScene=0;for(var s=new Int32Array(o),a=0;a<o;a++)s[a]=a;this.setFragmentOrder(s,o)}var t,n,o;return t=e,(n=[{key:"setFragmentOrder",value:function(e,t){this._fragCount=t,this._fragOrder[0]=e;var n=Math.floor((this._fragCount+this._fragsPerScene-1)/this._fragsPerScene);this._geomScenes.length=n;for(var r=0;r<n;r++){var i=r*this._fragsPerScene,o=this._geomScenes[r]=new this._RenderBatch(this._frags,this._fragOrder,i,this._fragsPerScene),s=i+this._fragsPerScene;s>this._fragCount&&(s=this._fragCount),o.lastItem=s}}},{key:"addFragment",value:function(e){if(this._fragOrder[0].length<=e){var t=2*this._fragOrder[0].length;t<=e&&(t=e+1);var n=new Int32Array(t);n.set(this._fragOrder[0]),this._fragOrder[0]=n,this.visibleBoundsDirty=!0}this._fragOrder[0][e]=e;var r=Math.floor(e/this._fragsPerScene);if(this._geomScenes){var i=this._geomScenes[r];i||(this._geomScenes[r]=i=new this._RenderBatch(this._frags,this._fragOrder,r*this._fragsPerScene,this._fragsPerScene)),i&&i.onFragmentAdded(e)}}},{key:"reset",value:function(e,t){if(this._currentScene=0,this._fillLast&&this._geomScenes[0]&&(this._geomScenes[0].drawEnd=0),this._resetVisStatus){for(var n=this._geomScenes,r=n.length,i=0;i<r;++i){var o=n[i];o&&o.resetVisStatus&&o.resetVisStatus()}this._resetVisStatus=!1}}},{key:"getSceneCount",value:function(){return this._geomScenes.length}},{key:"getGeomScenes",value:function(){return this._geomScenes}},{key:"resetVisStatus",value:function(){this._resetVisStatus=!0}},{key:"done",value:function(){return!(this._fillLast&&!this._model.isLoadDone())&&this._currentScene>=this._geomScenes.length-1&&(!(e=this._geomScenes[this._currentScene])||e.drawStart>=e.lastItem);var e}},{key:"nextBatch",value:function(){if(this._currentScene>=this.getSceneCount())return null;var e=this._geomScenes[this._currentScene];if(this._fillLast){if(e.lastItem>=e.start+e.count&&(++this._currentScene,this._geomScenes[this._currentScene]&&(this._geomScenes[this._currentScene].drawEnd=this._geomScenes[this._currentScene].start)),e.drawStart=e.drawEnd,e.drawEnd=e.lastItem,e.hasOwnProperty("drawStart")&&e.lastItem<=e.drawStart)return null}else++this._currentScene;return e.renderImportance=0,e}},{key:"getVisibleBounds",value:function(e,t){for(var n=this.getSceneCount(),r=0;r<n;r++){this._geomScenes[r].calculateBounds();var i=this._geomScenes[r].getBoundingBox();e.union(i),t.union(i),t.union(this._geomScenes[r].getBoundingBoxHidden())}}},{key:"rayCast",value:function(e,t,n){for(var r=this.getSceneCount(),i=0;i<r;i++)this._geomScenes[i].raycast(e,t,n)}}])&&i(t.prototype,n),o&&i(t,o),e}()},"./src/wgs/scene/ModelIteratorTexQuad.js":
/*!***********************************************!*\
  !*** ./src/wgs/scene/ModelIteratorTexQuad.js ***!
  \***********************************************/
/*! exports provided: TexQuadConfig, ModelIteratorTexQuad */function(e,t,n){"use strict";n.r(t),n.d(t,"TexQuadConfig",(function(){return h})),n.d(t,"ModelIteratorTexQuad",(function(){return f}));var r=n(/*! ../../compat */"./src/compat.js"),i=n(/*! ./TileCoords */"./src/wgs/scene/TileCoords.js"),o=n(/*! ./SortedList */"./src/wgs/scene/SortedList.js"),s=n(/*! ./LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js"),a=n(/*! ./TexQuadUtils */"./src/wgs/scene/TexQuadUtils.js"),l=n(/*! three */"./thirdparty/three.js/three.js"),c=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),u=Object(r.getGlobal)().document,d=function(e,t){this.timeStamps=e,this.mesh=t,this.state=0};function h(){this.urlPattern=null,this.tileSize=null,this.maxLevel=null,this.skippedLevels=[],this.textureLoader=null,this.texWidth=0,this.texHeight=0,this.maxActiveTiles=Object(r.isMobileDevice)()?0:400,this.cacheSize=Object(r.isMobileDevice)()?0:150,this.onRootLoaded=null,this.levelOffset=0,this.pixelRatio=1,this.getRootTileSize=function(){return 1*(this.tileSize<<this.maxLevel)},this.getQuadWidth=function(){return this.scale*this.texWidth/this.getRootTileSize()},this.getQuadHeight=function(){return this.scale*this.texHeight/this.getRootTileSize()},this.getPageToModelTransform=function(e,t){var n=e/this.getQuadWidth(),r=t/this.getQuadHeight();return new s.LmvMatrix4(!0).set(n,0,0,0,0,r,0,0,0,0,1,0,0,0,0,1)},this.getBBox=function(){var e=this.getQuadWidth(),t=this.getQuadHeight();if(this.fitPaperSize)return new l.Box3(new l.Vector3,new l.Vector3(e,t,0));var n=1-t;return new l.Box3(new l.Vector3(0,n,0),new l.Vector3(e,1,0))},this.valid=function(){return"string"==typeof this.urlPattern&&this.urlPattern.length>0&&"number"==typeof this.tileSize&&this.tileSize>0&&"number"==typeof this.maxLevel&&this.maxLevel>0&&"number"==typeof this.texWidth&&this.texWidth>0&&"number"==typeof this.texHeight&&this.texHeight>0},this.initForSimpleImage=function(e){this.urlPattern=decodeURIComponent(e),this.maxLevel=0,this.levelOffset=0,this.tileSize=-1,this.texWidth=-1,this.texHeight=-1,this.isSimpleImage=!0},this.isLevelPresent=function(e){return!this.skippedLevels[e]},this.initFromLoadOptions=function(e,t,n){var r,i,o,s,a;this.urlPattern=decodeURIComponent(e),this.textureLoader=n,t&&(this.tileSize=t.tileSize,this.maxLevel=(r=t.texWidth,i=t.texHeight,o=t.tileSize,s=Math.ceil(Math.log2(r)),a=Math.ceil(Math.log2(i)),Math.max(s,a)-Math.log2(o)),this.texWidth=t.texWidth,this.texHeight=t.texHeight,this.levelOffset=t.levelOffset,this.zips=t.zips,this.fitPaperSize=t.fitPaperSize,this.paperHeight=t.paperHeight,this.scale=this.fitPaperSize?t.paperWidth*this.getRootTileSize()/this.texWidth:1,this.skippedLevels=function(e){var t=[];if(e.zips){n=(n=(n=(n=e.urlPattern.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/\\{x\\}/,"[0-9]+")).replace(/\\{y\\}/,"[0-9]+")).replace(/\\{z\\}/,"([0-9]+)");var n=new RegExp("^"+n+"$");t.length=e.maxLevel+1,t.fill(!0);var r=0;e.zips.forEach((function(i){Object.keys(i.fileTable).forEach((function(i){var o=n.exec(i);if(o&&o[1]){var s=parseInt(o[1])-e.levelOffset;s>=0&&s<=e.maxLevel&&(t[s]=!1,++r)}}))})),0===r&&(t.length=0,c.logger.info("No leaflet levels found - assume all are present"))}return t}(this),"number"==typeof t.maxLevel&&function(e,t,n){for(;n>0&&e.skippedLevels[n];)--n;var r=t-n;r>0&&(e.texWidth>>=r,e.texHeight>>=r,e.maxLevel=n)}(this,this.maxLevel,t.maxLevel),this.maxActiveTiles=t.maxActiveTiles||this.maxActiveTiles,this.cacheSize=t.cacheSize||this.cacheSize)}}function f(e,t){var n=e,r=1,s=e.getBBox(),c=[],h=t,f=[],p=[],m=[];this.registerView=function(){var e=c.indexOf(void 0);return-1===e&&(e=c.length),c[e]=new l.Scene,m[e]=0,f[e]=!0,e},this.registerView();var g=0,v=0,y=!1,_=[],b=null,x=!1,w=new a.GeometryManager;function E(e){var t=n.maxLevel-e;return n.texWidth>>t}function A(e){var t=n.maxLevel-e;return n.texHeight>>t}function M(e){var t=E(e.level),r=A(e.level),i=e.x*n.tileSize,o=e.y*n.tileSize;return i>=t||o>=r}function S(e){var t=E(e.level),r=A(e.level),i=e.x*n.tileSize,o=e.y*n.tileSize,s=Math.max(0,Math.min(n.tileSize,t-i)),a=Math.max(0,Math.min(n.tileSize,r-o)),c=1*n.tileSize;return new l.Vector2(s/c,a/c)}function T(e){return n.scale/(1<<e)}function C(e,t){return T(e.level)*e.x*t}function P(e,t){var r=T(e.level);return(n.fitPaperSize?n.paperHeight:1)-(e.y+1)*r*t}function L(e){return p[Object(i.tile2Index)(e)]}function D(e){var t=L(e);return t instanceof d&&2==t.state}function R(e,t,n,r){var i;if(t)b||(b=w.createQuadGeom()),i=b;else{var o=function(e,t){for(var n=e.getParent();n;){var r=L(n),i=r&&2==r.state;if(i&&t&&r.mesh.material.map.needsUpdate&&n.level>0&&(i=!1),i)break;n=n.getParent()}return n}(e);t=O(o).material;var s=function(e,t){var n=1<<e.level-t.level,r=1/n,i=r,o=S(t);r/=o.x,i/=o.y;var s=t.x*n,l=t.y*n,c=e.x-s,u=e.y-l,d=S(e);c*=r,u=1-(u*=i)-i*d.y;var h=new a.UVTransform;return h.offsetX=c,h.offsetY=u,h.scaleX=r*d.x,h.scaleY=i*d.y,h}(e,o);i=w.acquireQuadGeom(s)}var c=new l.Mesh(i,t);c.tile=e;var u=T(e.level),d=S(e),h=(1-d.y)*u*r,f=C(e,r),p=P(e,r);return c.position.set(f,p+h,0),c.scale.set(u*d.x*r,u*d.y*r,1),c}this.setAggressivePrefetching=function(e){x=e},this.getScene=function(e){return c[e=e||0]},this.nextBatch=function(e){return f[e=e||0]?null:(f[e]=!0,c[0])},this.getSceneCount=function(){return 1},this.done=function(e){return f[e||0]},this.rayCast=function(e,t){return null},this.getVisibleBounds=function(e,t){e&&e.copy(s),t&&t.copy(s)};var I=this;function j(t){var o=Object(i.tile2Index)(t),a=p[o];if(!a||0==a.state){a||(a=new d(m.slice()),p[o]=a),a.state=1;var c=function(e){var t=n.levelOffset?n.levelOffset:0;return n.urlPattern.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",e.level+t)}(t),f=function(i){if(I&&i){0==n.maxLevel&&(-1==n.texWidth&&(n.texWidth=i.image.width),-1==n.texHeight&&(n.texHeight=i.image.height),-1==n.tileSize&&(n.tileSize=Math.max(i.image.width,i.image.height)),s=e.getBBox()),function(e){for(var t=e.image,n=1;(n*=2)<t.width;);for(var r=1;(r*=2)<t.height;);if(n!==t.width||r!==t.height){var i=u.createElement("canvas");i.width=n,i.height=r;var o=i.getContext("2d");o.drawImage(t,0,0);var s,a,l=o.getImageData(0,0,n,r),c=new Uint32Array(l.data.buffer,0,n*r);if(t.height<r){var d=t.height*n;for(s=t.height;s<r;++s,d+=n)for(a=0;a<t.width;++a)c[d+a]=c[d+a-n]}if(t.width<n){var h=0;for(s=0;s<r;++s,h+=n)for(a=t.width;a<n;++a)c[h+a]=c[h+a-1]}o.putImageData(l,0,0),e.image=i,e.flipY&&e.offset.set(0,1-t.height/r),e.repeat.set(t.width/n,t.height/r)}}(i),i.minFilter=l.LinearMipMapLinearFilter,i.magFilter=l.LinearFilter;var o=new l.MeshBasicMaterial({color:4294967295});o.map=i,o.name=c,o.tile=t,o.disableEnvMap=!0,-1!==c.toLowerCase().indexOf(".png")&&(o.transparent=!0,o.alphaTest=.01),h.addMaterial(o.name,o,!0);var d=R(t,o,0,r);a.mesh=d,a.state=2,v--,y=!0;var f=i&&i.image?i.image.src:null;f&&l.Cache&&l.Cache.get(f)&&l.Cache.remove(f),0==t.level&&n.onRootLoaded&&n.onRootLoaded()}};v++,n.textureLoader(c,(function(e,t){f(e)}),(function(e){n.onDone(e,null),console.error(e)}))}}function O(e){var t=Object(i.tile2Index)(e),n=p[t];return n&&2==n.state?n.mesh:null}function N(e,t,n){var r=C(e,n),i=P(e,n);t.set(r,i,0)}function k(e,t,n){var r=T(e.level),i=C(e,n)+r,o=P(e,n)+r;t.set(i,o,0)}this.requestRootTile=function(){j(new i.TileCoords(0,0,0))};var F,V,B,U=(F=new l.Vector3,V=new l.Vector3,B=new l.Box3,function(e,t,n){return N(e,F,n),k(e,V,n),B.set(F,V),t.intersectsBox(B)>0}),z=function(){var e=new l.Vector3,t=new l.Vector3;return function(n,r,i,o){var s=T(n.level);N(n,e,o),k(n,t,o);var a,l,c,u,d=(l=e,c=t,(u=(a=i).clone()).max(l),u.min(c),u.distanceToSquared(a));return(U(n,r,o)?100:1)*(s*s)/(d=Math.max(d,1e-4))}}(),G=function(){var e=new l.Vector3,t=new l.Vector3;return function(n,r,i,o,s,a){N(n,e,a),k(n,t,a);var c=function(e,t,n,r){var i=e.clone();return i.max(n),i.min(r),i.sub(e).dot(t)}(r,i,e,t);return.5*((t.x-e.x)/(Math.tan(l.Math.degToRad(o/2))*c))*s}}();function H(e,t){this.tile=e,this.prio=t}function W(e,t){return e.prio>t.prio}function X(e,t){var n=p[Object(i.tile2Index)(e)];n&&n.timeStamps[t]!==m[t]&&(n.timeStamps[t]=m[t],g++)}function q(e,t,n){e.sort((function(e,r){var i=z(e,t,n);return z(r,t,n)-i}));for(var r=0,i=0;i<e.length;i++){var o=L(e[i]);if(!o||1!=o.state){if(v>=5)break;j(e[i]),r++}}return r}function Y(e){if(e&&e.mesh&&e.mesh.material){var t=e.mesh.material;h.removeMaterial(t.name),t.map.dispose(),t.map.needsUpdate=!0;t.dispatchEvent({type:"dispose"}),t.needsUpdate=!0}}function K(e){for(var t=0;t<m.length;t++){if(!!c[t]&&e.timeStamps[t]===m[t])return!0}return!1}this.dispose=function(){var e;for(e in p)Y(p[e]);b&&(b.dispose(),b.needsUpdate=!0),w.dispose()},this.dtor=function(){this.dispose(),I=null,h=null},this.reset=function(e,t,s){var a,l,u=(s=s||0)>0,d=c[s];for(a=0;a<d.children.length;a++){d.children[a].dispatchEvent({type:"removed"})}if(d.children.length=0,m[s]++,g=0,w.reset(),!D(new i.TileCoords(0,0,0)))return f[s]=!0,!1;var h=new o.SortedList(W),b=new i.TileCoords(0,0,0),E=z(b,e,t.position);h.add(new H(b,E));for(var A=t.getWorldDirection(),S=0|t.clientHeight*n.pixelRatio,T=[],C=[],P=[];h.size()>0;){if(l=h.get(0).tile,h.removeAt(0),!M(l)){var L=!0;l.level==n.maxLevel&&(L=!1),G(l,t.position,A,t.fov,S,r)<n.tileSize&&n.isLevelPresent(l.level)&&(L=!1);var I=U(l,e,r);if(I&&(!D(l)&&n.isLevelPresent(l.level)&&P.push(l),X(l,s)),!I&&T.length+C.length>n.maxActiveTiles&&(L=!1),L)for(var j=0;j<4;j++){var N=l.getChild(j);E=z(N,e,t.position,r),h.add(new H(N,E))}else I?T.push(l):C.push(l)}}var k=0;y=!1;var F=!0;for(a=0;a<T.length;++a){var V=O(l=T[a]);V&&V.material.map.needsUpdate&&!x&&(k<5||u?k++:(V=R(l,null,0,r),y=!0,F=!1)),V||(V=R(l,null,0,r),F=!1),d.add(V)}f[s]=!1;var B=q(P,e,t.position);g+=v;var Q=[];for(a=0;a<C.length&&!(g>=n.maxActiveTiles);a++)if(D(l=C[a]))for(var Z=0;Z<=l.level;Z++){if(X(l.getParentAtLevel(Z),s),g>n.maxActiveTiles)break}else Q.push(l),g++;if(B+=q(Q,e,t.position),x){for(Q=[],a=0;a<T.length;++a)if((l=T[a]).level!=n.maxLevel&&n.isLevelPresent(l.level+1))for(j=0;j<4;j++){!M(N=l.getChild(j))&&U(N,e,r)&&(D(N)||(Q.push(N),g++))}B+=q(Q,e,t.position)}if(u||function(e,t,r){var o=Object.keys(p),s=o.length,a=e-(n.cacheSize-s);if(!(a<=0)){o.sort((function(e,n){var o=p[e].timeStamps[0],s=p[n].timeStamps[0];if(o!=s)return o-s;var a=Object(i.index2Tile)(e),l=Object(i.index2Tile)(n);return z(a,t,r)-z(l,t,r)}));for(var l=Math.min(a,o.length),c=0;c<l;c++){var u=o[c];if(0!==Object(i.index2Tile)(u).level){var d=p[u];if(2==d.state){if(K(d))break;Y(d),delete p[u]}}}}}(B,e,t.position),F&&_.length>0){var J=_.splice(0,_.length);setTimeout((function(){for(var e=0;e<J.length;e++)J[e](s)}),1)}return F},this.callWhenRefined=function(e){_.push(e)},this.update=function(){return y},this.setDpiScale=function(e){r=e},this.getDpiScale=function(){return r},this.unregisterView=function(e){c[e]=void 0,m[e]=void 0,f[e]=void 0;for(var t=c.length;t>0&&!c[t-1];)t--;c.length=t,m.length=t,f.length=t}}},"./src/wgs/scene/ParallelGeomMerge.js":
/*!********************************************!*\
  !*** ./src/wgs/scene/ParallelGeomMerge.js ***!
  \********************************************/
/*! exports provided: ParallelGeomMerge, runMergeSingleThreaded */function(e,t,n){"use strict";n.r(t),n.d(t,"ParallelGeomMerge",(function(){return u})),n.d(t,"runMergeSingleThreaded",(function(){return d}));var r=n(/*! ./GeomMergeTask */"./src/wgs/scene/GeomMergeTask.js"),i=n(/*! ./VertexEnumerator */"./src/wgs/scene/VertexEnumerator.js"),o=n(/*! ../../file-loaders/main/WorkerCreator */"./src/file-loaders/main/WorkerCreator.js"),s=n(/*! ./LmvMatrix4 */"./src/wgs/scene/LmvMatrix4.js"),a=n(/*! ./LmvVector3 */"./src/wgs/scene/LmvVector3.js");function l(e,t,n,o){var s=function(e){for(var t=new Uint16Array(e.length+1),n=0,r=0;r<e.length;r++)t[r]=n,n+=Object(i.getVertexCount)(e[r]);return t[r]=n,t}(e),a=new r.GeomMergeTask;return a.vb=t.vb,a.vbstride=t.vbstride,a.posOffset=t.attributes.position.itemOffset,a.normalOffset=t.attributes.normal?t.attributes.normal.itemOffset:-1,a.matrices=n,a.ranges=s,a.dbIds=o,a}function c(e,t){t.vb=e.vb,t.attributes.id.array=e.vertexIds,t.needsUpdate=!0}function u(e){var t=0,n={},r=[],i=e,o=new Array(2);function s(e){for(var r=e.data,s=0;s<r.length;s++){var a=r[s],l=a.taskId;c(a,n[l]),delete n[l]}if(0===--t)for(i.inProgress=!1,s=0;s<o.length;s++)o[s].clearAllEventListenerWithIntercept(),o[s].terminate(),o[s]=null}this.addMergeTask=function(e,t,i,o){var s=l(e,t,i,o);r.push(s),n[s.id]=t},this.runTasks=function(){for(var e=0;e<2;e++)o[e]=u.createWorker(),o[e].addEventListenerWithIntercept(s);for(var n=r.length,a=Math.floor(n/2),l=0;l<2;l++){var c=l*a,d=1===l?n:c+a,h=[],f=new Array(4*(d-c)),p=0;for(e=c;e<d;e++){var m=r[e];f[p++]=m.vb.buffer,f[p++]=m.matrices.buffer,f[p++]=m.ranges.buffer,f[p++]=m.dbIds.buffer,h.push(m)}var g={operation:"MERGE_GEOMETRY",tasks:h};o[l].doOperation(g,f),t++}i.inProgress=!0}}function d(e,t,n,r){var i=l(e,t,n,r),o=new a.LmvVector3,u=new s.LmvMatrix4;c(i.run(u,o),t)}u.createWorker=o.createWorkerWithIntercept},"./src/wgs/scene/RenderBatch.js":
/*!**************************************!*\
  !*** ./src/wgs/scene/RenderBatch.js ***!
  \**************************************/
/*! exports provided: RenderBatch */function(e,t,n){"use strict";n.r(t),n.d(t,"RenderBatch",(function(){return u}));var r=n(/*! ./VBIntersector */"./src/wgs/scene/VBIntersector.js"),i=n(/*! ./FrustumIntersector */"./src/wgs/scene/FrustumIntersector.js"),o=n(/*! ./MeshFlags */"./src/wgs/scene/MeshFlags.js"),s=n(/*! ./RenderFlags */"./src/wgs/scene/RenderFlags.js"),a=n(/*! ../../logger/Logger */"./src/logger/Logger.js"),l=new(n(/*! ./LmvBox3 */"./src/wgs/scene/LmvBox3.js").LmvBox3),c=null;function u(e,t,n,r){this.frags=e,this.indices=t,this.start=n,this.count=r,this.lastItem=n,this.overrideMaterial=null,this.sortDone=!1,this.numAdded=0,this.avgFrameTime=void 0,this.nodeIndex=void 0,this.bboxes=new Array(12),this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.sortObjects=!1,this.sortDone=!1,this.sortByShaderDone=!1,this.frustumCulled=!0,this.forceVisible=!1,this.renderImmediate=!e.useThreeMesh,this.renderImportance=0}function d(e,t,n,r,i){var a,l=o.MeshFlags.MESH_RENDERFLAG,c=t[n]&~l;switch(e){case s.RenderFlags.RENDER_HIDDEN:a=!(c&o.MeshFlags.MESH_VISIBLE);break;case s.RenderFlags.RENDER_HIGHLIGHTED:a=c&o.MeshFlags.MESH_HIGHLIGHTED;break;default:a=1==(c&(o.MeshFlags.MESH_VISIBLE|o.MeshFlags.MESH_HIGHLIGHTED|o.MeshFlags.MESH_HIDE))}if(r){var u=c&(o.MeshFlags.MESH_ISLINE|o.MeshFlags.MESH_ISWIDELINE);a=a&&!u}if(i){var d=c&o.MeshFlags.MESH_ISPOINT;a=a&&!d}return t[n]=c|(a?l:0),a}function h(e,t,n,r){var i=!1;return n.getWorldBounds(r,l),e&&!t.intersectsBox(l)&&(i=!0),!i&&t.boxOutsideCutPlanes(l)&&(i=!0),i}u.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices},u.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var e=this.frags,t=this.getIndices();if(t){var n=t.subarray(this.start,this.start+this.count);Array.prototype.sort.call(n,(function(t,n){var r=e.getMaterialId(t),i=e.getMaterialId(n);return void 0===r?i?1:0:void 0===i?-1:r-i})),this.numAdded=0,this.sortDone=!0}else a.logger.warn("Only indexed RenderSubsets can be sorted.")}},u.prototype.sortByShader=function(){if(this.sortDone&&!this.sortByShaderDone){var e=this.frags,t=this.getIndices().subarray(this.start,this.start+this.count);Array.prototype.sort.call(t,(function(t,n){var r=e.getMaterial(t),i=e.getMaterial(n),o=r.program.id-i.program.id;return o||r.id-i.id})),this.numAdded=0,this.sortByShaderDone=!0}},u.prototype.sortByDepth=function(e){var t=this.frags,n=this.getIndices(),r=e,i=l;if(n){(!c||c.length<this.count)&&(c=new Float32Array(this.count));var o,s,u=c,d=this.start;this.forEachNoMesh((function(e,n){t.getGeometry(e)?(t.getWorldBounds(e,i),u[n]=r.estimateDepth(i)):u[n]=-1/0}));for(var h=1;h<this.count;h++)for(var f=h;f>0&&u[f-1]<u[f];)o=u[f-1],u[f-1]=u[f],u[f]=o,s=n[d+f-1],n[d+f-1]=n[d+f],n[d+f]=s,f--}else a.logger.warn("Only indexed RenderSubsets can be sorted.")},u.prototype.addToBox=function(e,t){var n=t?6:0,r=this.bboxes;r[0+n]=Math.min(r[0+n],e.min.x),r[1+n]=Math.min(r[1+n],e.min.y),r[2+n]=Math.min(r[2+n],e.min.z),r[3+n]=Math.max(r[3+n],e.max.x),r[4+n]=Math.max(r[4+n],e.max.y),r[5+n]=Math.max(r[5+n],e.max.z)},u.prototype.getBoundingBox=function(e){e=e||l;var t=this.bboxes;return e.min.x=t[0],e.min.y=t[1],e.min.z=t[2],e.max.x=t[3],e.max.y=t[4],e.max.z=t[5],e},u.prototype.getBoundingBoxHidden=function(e){e=e||l;var t=this.bboxes;return e.min.x=t[6],e.min.y=t[7],e.min.z=t[8],e.max.x=t[9],e.max.y=t[10],e.max.z=t[11],e},u.prototype.onFragmentAdded=function(e){this.frags.getWorldBounds(e,l),this.addToBox(l,!1),this.sortDone=!1,this.lastItem<=e&&(this.lastItem=e+1,void 0!==this.visibleStats&&(this.visibleStats=0),this.numAdded++)},u.prototype.forEach=function(e,t,n){var r,i,s,a=this.getIndices(),l=this.frags,c=!this.sortByShaderDone;if(t||n||c)for(r=t===o.MeshFlags.MESH_RENDERFLAG&&this.hasOwnProperty("drawStart")?this.drawStart:this.start,i=this.lastItem;r<i;r++){s=a?a[r]:r;u=l.getVizmesh(s,this.renderImportance);!c||u&&u.material&&u.material.program&&!u.geometry_proxy||(c=!1),!(n||u&&u.geometry)||t&&!l.isFlagSet(s,t)||e(u,s)}else for(r=this.start,i=this.lastItem;r<i;r++){var u;s=a?a[r]:r,(u=l.getVizmesh(s,this.renderImportance))&&u.geometry&&e(u,s)}c&&this.sortByShader()},u.prototype.forEachNoMesh=function(e,t,n){for(var r=this.getIndices(),i=this.frags,o=this.start,s=this.lastItem;o<s;o++){var a,l=r?r[o]:o;if(i.useThreeMesh){var c=i.getVizmesh(l);c&&(a=c.geometry)}else a=i.getGeometry(l);!n&&!a||t&&!i.isFlagSet(l,t)||e(l,o-this.start)}},u.prototype.raycast=function(e,t,n){if(!1!==e.ray.isIntersectionBox(this.getBoundingBox())){var i=this,s=l;this.forEach((function(a,l){if(!i.frags.isFlagSet(l,o.MeshFlags.MESH_HIDE)){if(n&&n.length){var c=0|i.frags.getDbIds(l);if(-1===n.indexOf(c))return}i.frags.getWorldBounds(l,s),s.expandByScalar(.5),e.ray.isIntersectionBox(s)&&r.VBIntersector.rayCast(a,e,t)}}),o.MeshFlags.MESH_VISIBLE)}},u.prototype.calculateBounds=function(){var e,t,n,r;function i(i){t.getWorldBounds(i,n);var o=e[i];r.addToBox(n,!(1&o))}return function(){this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,e=this.frags.vizflags,t=this.frags,n=l,r=this,this.forEachNoMesh(i,0,!0)}}(),u.prototype.applyVisibility=function(){var e,t,n,r,l,c;function u(i,s){if((i||!e.useThreeMesh)&&i.geometry){if(h(l,n,e,s))return i?i.visible=!1:a.logger.warn("Unexpected null mesh"),void(t[s]=t[s]&~o.MeshFlags.MESH_RENDERFLAG);var u=d(r,t,s,e.linesHidden,e.pointsHidden);i&&(i.visible=!!u),c=c&&!u}}function f(i){if(e.getGeometryId(i))if(h(l,n,e,i))t[i]=t[i]&~o.MeshFlags.MESH_RENDERFLAG;else{var s=d(r,t,i,e.linesHidden,e.pointsHidden);c=c&&!s}}return function(o,a){c=!0,n=a;var d=(r=o)===s.RenderFlags.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),h=n.intersectsBox(d);return h===i.FrustumIntersector.OUTSIDE||a.boxOutsideCutPlanes(d)||(t=this.frags.vizflags,e=this.frags,l=h!==i.FrustumIntersector.CONTAINS,e.useThreeMesh?this.forEach(u,null):this.forEachNoMesh(f,0,!1),e=null),c}}()},"./src/wgs/scene/RenderFlags.js":
/*!**************************************!*\
  !*** ./src/wgs/scene/RenderFlags.js ***!
  \**************************************/
/*! exports provided: RenderFlags */function(e,t,n){"use strict";n.r(t),n.d(t,"RenderFlags",(function(){return r}));var r={RENDER_NORMAL:0,RENDER_HIGHLIGHTED:1,RENDER_HIDDEN:2,RENDER_SHADOWMAP:3,RENDER_FINISHED:4}},"./src/wgs/scene/RenderModel.js":
/*!**************************************!*\
  !*** ./src/wgs/scene/RenderModel.js ***!
  \**************************************/
/*! exports provided: RenderModel */function(e,t,n){"use strict";n.r(t),n.d(t,"RenderModel",(function(){return y}));var r=n(/*! ../globals */"./src/wgs/globals.js"),i=n(/*! ./GeometryList */"./src/wgs/scene/GeometryList.js"),o=n(/*! ./FragmentList */"./src/wgs/scene/FragmentList.js"),s=n(/*! ./RenderBatch */"./src/wgs/scene/RenderBatch.js"),a=n(/*! ./FragmentListConsolidation */"./src/wgs/scene/FragmentListConsolidation.js"),l=n(/*! ./ConsolidationIterator */"./src/wgs/scene/ConsolidationIterator.js"),c=n(/*! ./ModelIteratorLinear */"./src/wgs/scene/ModelIteratorLinear.js"),u=n(/*! ./ModelIteratorBVH */"./src/wgs/scene/ModelIteratorBVH.js"),d=n(/*! ./ModelIteratorTexQuad */"./src/wgs/scene/ModelIteratorTexQuad.js"),h=n(/*! ./VBIntersector */"./src/wgs/scene/VBIntersector.js"),f=n(/*! three */"./thirdparty/three.js/three.js"),p=n(/*! ./MeshFlags */"./src/wgs/scene/MeshFlags.js"),m=n(/*! ./RenderFlags */"./src/wgs/scene/RenderFlags.js"),g=n(/*! ../../logger/Logger */"./src/logger/Logger.js");var v=1;function y(){var e=new f.Box3,t=new f.Box3,n=new f.Box3;this.visibleBoundsDirty=!1,this.enforceBvh=!1;var y=0;this.id=v++;var _=null,b=null,x=null,w=null,E=null,A=null,M=null,S=0,T=null,C=m.RenderFlags.RENDER_NORMAL,P=!1;this.getGeometryList=function(){return _},this.getFragmentList=function(){return b},this.getModelId=function(){return this.id},this.RenderBatch=s.RenderBatch,this.initialize=function(){var n=this.getData(),s=n.numGeoms||0,a=!function(e,t,n){return!(e&&e-3*t*2<=r.GPU_MEMORY_LIMIT&&n<r.GPU_OBJECT_LIMIT)}(n.packFileTotalSize,n.primitiveCount,s);_=new i.GeometryList(s,this.is2d(),a,this.isOTG()),b=new o.FragmentList(this);var l=this.getBoundingBox();l&&(e.copy(l),t.copy(l)),E=x=new c.ModelIteratorLinear(this)},this.getIterator=function(){return E},this.initFromCustomIterator=function(e){E=e,this.visibleBoundsDirty=!0},this.dtor=function(e){b&&b.dispose(e),E&&E.dtor&&(E.dtor(),x=null),A&&A.dispose()},this.activateFragment=function(r,i,o){b&&(b.setMesh(r,i,o),E.addFragment(r),b.getWorldBounds(r,n),e.union(n),t.union(n))},this.setFragment=function(r,i,o){return void 0===r&&(r=this.getFragmentList().getNextAvailableFragmentId()),b.setMesh(r,i,!0,o),x&&x.addFragment(r),w&&!b.fragmentsHaveBeenAdded()&&w.addFragment(r),b.getWorldBounds(r,n),e.union(n),t.union(n),r},this.setBVH=function(e,t,n){(E=w=new u.ModelIteratorBVH).initialize(this,e,t,n)},this.resetIterator=function(e,t,n){return P=!1,w&&!b.fragmentsHaveBeenAdded()&&(P=!0),P?E=w:x&&(E=x),S=0,C=n,T=t,E.reset(t,e),A&&A.reset(),E},this.nextBatch=function(){for(;;){var e=E.nextBatch();if(S++,!e)return null;if(A&&e instanceof s.RenderBatch&&(e=A.consolidateNextBatch(e,T,C)),e.modelId=this.id,e instanceof f.Scene)return e;if(!this.applyVisibility(e,C,T))return e}},this.applyVisibility=function(e,t,n){var r=e.applyVisibility(t,n);return r||this.is2d()||(e.sortObjects&&!this.getFragmentList().useThreeMesh?e.sortByDepth(n):e.sortDone||e.sortByMaterial()),r},this.getVisibleBounds=function(n){return this.visibleBoundsDirty&&(e.makeEmpty(),t.makeEmpty(),E.getVisibleBounds(e,t,n),this.visibleBoundsDirty=!1),n?t:e},this.rayIntersect=function(e,t,n,r){this.visibleBoundsDirty&&this.getVisibleBounds();var i,o=[];if(n&&n.length>0){var s=this.getInstanceTree(),a=[];if(s)for(i=0;i<n.length;i++)s.enumNodeFragments(n[i],(function(e){a.push(e)}),!0);else a=n;if(a.length>2)E.rayCast(e,o,n);else for(i=0;i<a.length;i++){var l=b.getVizmesh(a[i]);if(l){var c=h.VBIntersector.rayCast(l,e,o);c&&o.push(c)}}}else E.rayCast(e,o);if(!o.length)return null;o.sort((function(e,t){return e.distance-t.distance}));var u=!!r;for(r=r||[],i=0;i<o.length;i++){var d=o[i].fragId;if(!this.is2d())if(this.isFragVisible(d)){var p=b.getMaterial(d);if(t&&p.transparent)continue;var m=o[i],g=!1,v=m.point;if(p&&p.cutplanes)for(var y=0;y<p.cutplanes.length;y++)g=g||p.cutplanes[y].dot(new f.Vector4(v.x,v.y,v.z,1))>1e-6;if(g||r.push(m),m.model=this,!u&&r.length>0)break}}var _=r[0]||null;return _&&(_.model=this),_},this.setHighlighted=function(e,t){if(!b)return!1;var n=b.setFlagFragment(e,p.MeshFlags.MESH_HIGHLIGHTED,t);return n&&(t?y++:y--),n},this.setVisibility=function(e,t){b&&(b.setVisibility(e,t),this.visibleBoundsDirty=!0)},this.setAllVisibility=function(e){b&&(b.setAllVisibility(e),this.visibleBoundsDirty=!0)},this.hideLines=function(e){b&&b.hideLines(e)},this.hidePoints=function(e){b&&b.hidePoints(e)},this.hasHighlighted=function(){return!!y},this.isFragVisible=function(e){return b.isFragVisible(e)},this.areAllVisible=function(){return!b||b.areAllVisible()},this.getGeomScenes=function(){return E.getGeomScenes()},this.getRenderProgress=function(){var e=S/E.getSceneCount();return e>1?1:e},this.update=function(e){return!(!E||!E.update)&&E.update(e)},this.setThemingColor=function(e,t,n){if(e=this.reverseMapDbId(e),b){var r=this.getInstanceTree();n&&r?r.enumNodeChildren(e,(function(e){b.setThemingColor(e,t)}),!0):b.setThemingColor(e,t)}else g.logger.warn("Theming colors are not supported by this model type.")},this.clearThemingColors=function(){b&&b.clearThemingColors()},this.clearThemingColorsByids=function(e){b&&b.clearThemingColorsByIds(e)},this.getLeaflet=function(){return E instanceof d.ModelIteratorTexQuad?E:null},this.consolidate=function(e,t,n){var r=Object(a.consolidateFragmentList)(this,e,t,n,M);A=new l.ConsolidationIterator(b,r),M=r.consolidationMap},this.unconsolidate=function(){A&&(A.dispose(),A=null)},this.isConsolidated=function(){return!!A},this.getConsolidation=function(){return A?A.getConsolidation():null},this.setDbIdRemap=function(e){this.is2d&&(this.idRemap=e)},this.remapDbId=function(e){return this.idRemap&&e>0&&e<this.idRemap.length?this.idRemap[e]:e},this.reverseMapDbId=function(e){if(!this.idRemap||e<=0)return e;if(!this.reverseMap){this.reverseMap={};for(var t=0;t<this.idRemap.length;t++)this.reverseMap[this.idRemap[t]]=t}return this.reverseMap[e]},this.updateRenderProxy=function(e,t){A&&A.updateRenderProxy(e,t)},this.skipOpaqueShapes=function(){E&&E.skipOpaqueShapes&&E.skipOpaqueShapes()},this.invalidateBBoxes=function(){this.visibleBoundsDirty=!0}}},"./src/wgs/scene/RenderScene.js":
/*!**************************************!*\
  !*** ./src/wgs/scene/RenderScene.js ***!
  \**************************************/
/*! exports provided: RenderScene */function(e,t,n){"use strict";n.r(t),n.d(t,"RenderScene",(function(){return l}));var r=n(/*! ../globals */"./src/wgs/globals.js"),i=n(/*! ./FrustumIntersector */"./src/wgs/scene/FrustumIntersector.js"),o=n(/*! three */"./thirdparty/three.js/three.js"),s=n(/*! ./RenderFlags */"./src/wgs/scene/RenderFlags.js"),a=n(/*! ./ResetFlags */"./src/wgs/scene/ResetFlags.js");function l(){var e=!1,t=!1,n=[],l=[],c=[],u=new o.Box3,d=[],h=new i.FrustumIntersector,f=new o.Raycaster,p=performance;this.enableNonResumableFrames=!1,this.budgetForTransparent=.1;var m=!1,g=[],v=null;function y(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.id===t)return r}return null}function _(e,t){void 0===e.avgFrameTime?e.avgFrameTime=t:e.avgFrameTime=.8*e.avgFrameTime+.2*t}this.frustum=function(){return h},this.findModel=function(e){return y(n,e)},this.findHiddenModel=function(e){return y(d,e)},this.addModel=function(e){n.push(e),l.length=n.length,c.length=n.length,this.recomputeLinePrecision()},this.removeModel=function(e){var t=n.indexOf(e);return t>=0&&n.splice(t,1),l.length=n.length,c.length=n.length,this.recomputeLinePrecision(),t>=0},this.addHiddenModel=function(e){var t=d.indexOf(e);return t<0&&d.push(e),t<0},this.removeHiddenModel=function(e){var t=d.indexOf(e);return t>=0&&d.splice(t,1),t>=0},this.isEmpty=function(){return 0===n.length},this.needsRender=function(){return e},this.resetNeedsRender=function(){e=!1},this.recomputeLinePrecision=function(){for(var e=1,t=0,r=n.length;t<r;++t){var i=n[t].getData().bbox,s=.001*o.Box3.prototype.getBoundingSphere.call(i).radius;e=Math.min(e,s)}f.linePrecision=e},this.frameResumePossible=function(){return!m},this.renderSome=function(e,r){for(var i,o,s=p.now(),a=this.budgetForTransparent*r;;){for(var c=0,u=null,d=0;d<l.length;d++){var h=l[d];if(o=n[d],h||(l[d]=h=o.nextBatch()),m&&r<a)h&&!h.sortObjects&&(o.skipOpaqueShapes(),h=o.nextBatch());null!==h&&(u||(c=d,u=h),h.renderImportance>u.renderImportance&&(c=d,u=h))}if(!u){t=!0;break}if(l[c]=n[c].nextBatch(),u.sortObjects&&m)g.push(u),r-=void 0===u.avgFrameTime?.05:u.avgFrameTime;else{e(u),u.hasOwnProperty("drawEnd")&&(u.drawEnd=u.lastItem);var f=(i=p.now())-s;s=i,_(u,f),r-=u.avgFrameTime}f=(i=p.now())-s;if(s=i,_(u,f),(r-=u.avgFrameTime)<=0)break}return g.length>0&&(!function(e,t,n){var r,i;for(r=0;r<e.length;r++){var o=(i=e[r]).boundingBox||i.getBoundingBox();i.cameraDistance=o.distanceToPoint(t.position)}e.sort((function(e,t){return t.cameraDistance-e.cameraDistance}));var s=performance.now();for(r=0;r<e.length;r++){n(i=e[r]);var a=performance.now(),l=a-s;s=a,_(i,l)}}(g,v,e),g.length=0),r},this.reset=function(e,i,o,u){if(t=!1,this.resetNeedsRender(),h.reset(e,u),h.areaCullThreshold=r.PIXEL_CULLING_THRESHOLD,n.length){m=this.enableNonResumableFrames&&o==a.ResetFlags.RESET_RELOAD&&i===s.RenderFlags.RENDER_NORMAL,v=e;for(var d=0;d<n.length;d++)n[d].resetIterator(e,h,i,o),l[d]=n[d].nextBatch(),c[d]=null}},this.isDone=function(){return t||this.isEmpty()},this.setAllVisibility=function(e){for(var t=0;t<n.length;t++)n[t].setAllVisibility(e)},this.hideLines=function(e){for(var t=0;t<n.length;t++)n[t].hideLines(e)},this.hidePoints=function(e){for(var t=0;t<n.length;t++)n[t].hidePoints(e)},this.hasHighlighted=function(){for(var e=0;e<n.length;e++)if(n[e].hasHighlighted())return!0;return!1},this.areAllVisible=function(){for(var e=0;e<n.length;e++)if(!n[e].areAllVisible())return!1;return!0},this.areAll2D=function(){for(var e=0;e<n.length;e++)if(!n[e].is2d())return!1;return!0},this.areAll3D=function(){for(var e=0;e<n.length;e++)if(!n[e].is3d())return!1;return!0},this.invalidateVisibleBounds=function(){for(var e=0;e<n.length;e++)n[e].visibleBoundsDirty=!0},this.getVisibleBounds=function(e){if(1===n.length)return n[0].getVisibleBounds(e);u.makeEmpty();for(var t=0;t<n.length;t++)u.union(n[t].getVisibleBounds(e));return u},this.rayIntersect=function(e,t,r,i,o,s){var a;if(f.set(e,t),n.length>1){var l=[];if(o)for(a=0;a<o.length;a++){if(d=this.findModel(o[a])){var c=i&&i[a];(u=d.rayIntersect(f,r,c))&&l.push(u)}}else for(a=0;a<n.length;a++){var u;if(!n[a].is2d())(u=n[a].rayIntersect(f,r,i,s))&&l.push(u)}return l.length?(l.sort((function(e,t){return e.distance-t.distance})),l[0]):null}if(!n.length||n[0].is2d())return null;var d=n[0];return o&&-1===o.indexOf(d.id)?null:d.rayIntersect(f,r,i,s)},this.getRenderProgress=function(){return n[0].getRenderProgress()},this.getModels=function(){return n},this.getHiddenModels=function(){return d},this.getFragmentList=function(){return n[0].getFragmentList()},this.getGeometryList=function(){return n[0].getGeometryList()},this.getSceneCount=function(){return n[0].getSceneCount()},this.getGeomScenes=function(){return n[0].getGeomScenes()},this.explode=function(e){if(n.length){for(var t=new o.Vector3,r=0;r<n.length;r++){var i=n[r],s=i.getData().instanceTree,a=i.getFragmentList(),l=i.getVisibleBounds(!0).center();if(e*=2,s&&s.nodeAccess.nodeBoxes&&0!==e){var c=e*(s.maxDepth-1)+1,u=0|c,d=c-u,h=new Float32Array(6);!function n(r,i,o,l,c,f,p,m){var g=2*e;i==u&&(g*=d),s.getNodeBox(r,h);var v=.5*(h[0]+h[3]),y=.5*(h[1]+h[4]),_=.5*(h[2]+h[5]);i>0&&i<=u&&(f+=(v-o)*g,p+=(y-l)*g,m+=(_-c)*g);s.isNodeExplodeLocked(r)&&(f=p=m=0),s.enumNodeChildren(r,(function(e){n(e,i+1,v,y,_,f,p,m)}),!1),t.x=f,t.y=p,t.z=m,s.enumNodeFragments(r,(function(e){a.updateAnimTransform(e,null,null,t)}),!1)}(s.getRootId(),0,l.x,l.y,l.z,0,0,0)}else{var f,p,m=a.fragments.boxes;a.useThreeMesh?f=a.vizmeshes:p=a.fragments.fragId2dbId;for(var g=0,v=a.getCount();g<v;g++)if(0==e||s&&s.isNodeExplodeLocked(f?f[g]&&f[g].dbId:p[g]))a.updateAnimTransform(g);else{var y=6*g,_=.5*(m[y]+m[y+3]),b=.5*(m[y+1]+m[y+4]),x=.5*(m[y+2]+m[y+5]);t.x=e*(_-l.x),t.y=e*(b-l.y),t.z=e*(x-l.z),a.updateAnimTransform(g,null,null,t)}}}this.invalidateVisibleBounds()}},this.update=function(e){for(var t=!1,r=0;r<n.length;r++){var i=n[r];t=t||i.update(e)}return t},this.hideModel=function(e){for(var t=0;t<n.length;t++){var r=n[t];if(r&&r.id===e)return this.removeModel(r),d.push(r),!0}return!1},this.showModel=function(e){for(var t=0;t<d.length;++t){var n=d[t];if(n&&n.id===e)return this.addModel(n),d.splice(t,1),!0}return!1}}},"./src/wgs/scene/ResetFlags.js":
/*!*************************************!*\
  !*** ./src/wgs/scene/ResetFlags.js ***!
  \*************************************/
/*! exports provided: ResetFlags */function(e,t,n){"use strict";n.r(t),n.d(t,"ResetFlags",(function(){return r}));var r={RESET_NORMAL:0,RESET_REDRAW:1,RESET_RELOAD:2}},"./src/wgs/scene/SceneMath.js":
/*!************************************!*\
  !*** ./src/wgs/scene/SceneMath.js ***!
  \************************************/
/*! exports provided: SceneMath */function(e,t,n){"use strict";n.r(t),n.d(t,"SceneMath",(function(){return a}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=[new r.Vector3(1,0,0),new r.Vector3(0,1,0),new r.Vector3(0,0,1),new r.Vector3(-1,0,0),new r.Vector3(0,-1,0),new r.Vector3(0,0,-1)],o=new r.Plane;function s(e,t,n,i){var o=e;o.z=-1;var s=new r.Vector3(o.x,o.y,1);o=o.unproject(t),(s=s.unproject(t)).sub(o).normalize();var a,l=s;if(Math.abs(l[n])<1e-6)return null;a=t.isPerspective?t.position:o;var c=((i?i.min[n]:0)-a[n])/l[n];return l.multiplyScalar(c),l.add(a),l}var a={box2CutPlanes:function(e,t){for(var n=[],s=0;s<i.length;s++){o.normal.copy(i[s]);var a=s<3?e.max:e.min;o.constant=-o.normal.dot(a),t&&o.applyMatrix4(t),n.push(new r.Vector4(o.normal.x,o.normal.y,o.normal.z,o.constant))}return n},getPixelsPerUnit:function(e,t,n,i,o,a){var l;if(t){var c=s(new r.Vector3(0,0,1),e,"z",a);l=i/(2*(c?e.position.distanceTo(c):e.position.distanceTo(n.center()))*Math.tan(r.Math.degToRad(.5*e.fov)))}else{var u;if(o){var d=o,h=e.target.clone().sub(e.position).normalize(),f=h.dot(d);if(0===f)u=n.center();else{var p=-(e.position.clone().dot(d)+d.w)/f;u=n.clampPoint(h.multiplyScalar(p).add(e.position))}}else u=n.center();l=i/(2*e.position.distanceTo(u)*Math.tan(r.Math.degToRad(.5*e.fov)))}return l},intersectGroundViewport:s,getNormalizingMatrix:function(e,t){t=t||e.getData().bbox;var n=new r.Matrix4;n.makeTranslation(-t.min.x,-t.min.y,-t.min.z);var i=new r.Vector3(0,0,0).subVectors(t.max,t.min),o=new r.Matrix4;o.makeScale(1/i.x,1/i.y,1);var s=new r.Matrix4;return s.multiplyMatrices(o,n),s}}},"./src/wgs/scene/SelectionMode.js":
/*!****************************************!*\
  !*** ./src/wgs/scene/SelectionMode.js ***!
  \****************************************/
/*! exports provided: SelectionMode */function(e,t,n){"use strict";n.r(t),n.d(t,"SelectionMode",(function(){return r}));var r={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2}},"./src/wgs/scene/SortedList.js":
/*!*************************************!*\
  !*** ./src/wgs/scene/SortedList.js ***!
  \*************************************/
/*! exports provided: SortedList */function(e,t,n){"use strict";function r(e){var t=e||function(e,t){return e<t},n=[],r=[];this.add=function(e){var i=function e(i,o,s){if(o||(o=0),s||(s=r.length),o>=s)return s;if(s===o+1){var a=n[r[o]];return t(a,i)?s:o}var l=parseInt(o+(s-o)/2),c=n[r[l-1]];return t(i,c)?e(i,o,l):t(c,i)?e(i,l,s):l-1}(e);if(i==r.length)return n.push(e),void r.push(n.length-1);n.push(e),r.splice(i,0,n.length-1)},this.size=function(){return r.length},this.get=function(e){return n[r[e]]},this.removeAt=function(e){var t=r[e];n[t]=void 0,r.splice(e,1)},this.toString=function(){for(var e="",t=0,n=this.size();t<n;++t)e+=this.get(t),t<n-1&&(e+=", ");return e}}n.r(t),n.d(t,"SortedList",(function(){return r}))},"./src/wgs/scene/TexQuadUtils.js":
/*!***************************************!*\
  !*** ./src/wgs/scene/TexQuadUtils.js ***!
  \***************************************/
/*! exports provided: UVTransform, GeometryManager */function(e,t,n){"use strict";n.r(t),n.d(t,"UVTransform",(function(){return i})),n.d(t,"GeometryManager",(function(){return o}));var r=n(/*! three */"./thirdparty/three.js/three.js");function i(){this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1}function o(){var e=[],t=0,n=new i;function o(e,t){var i=t||n,o=[];o.push(new r.Vector2(i.offsetX,i.offsetY)),o.push(new r.Vector2(i.offsetX+i.scaleX,i.offsetY)),o.push(new r.Vector2(i.offsetX+i.scaleX,i.offsetY+i.scaleY)),o.push(new r.Vector2(i.offsetX,i.offsetY+i.scaleY)),e.faceVertexUvs[0].length=0,e.faceVertexUvs[0].push([o[0],o[1],o[2]]),e.faceVertexUvs[0].push([o[0],o[2],o[3]]),e.uvTransform=i,e.uvsNeedUpdate=!0}this.acquireQuadGeom=function(n){var r=e[t];return r?o(r,n):(r=this.createQuadGeom(n),e[t]=r),t++,r},this.createQuadGeom=function(e){var t=new r.Geometry;return t.vertices.push(new r.Vector3(0,0,0),new r.Vector3(1,0,0),new r.Vector3(1,1,0),new r.Vector3(0,1,0)),t.faces.push(new r.Face3(0,1,2)),t.faces.push(new r.Face3(0,2,3)),o(t,e),t.computeFaceNormals(),t},this.reset=function(){t=0},this.dispose=function(){for(var t=0;t<e.length;t++){var n=e[t];n&&(n.dispose(),n.needsUpdate=!0)}}}i.prototype.toVec4=function(){return new r.Vector4(this.offsetX,this.offsetY,this.scaleX,this.scaleY)},i.prototype.copyTo=function(e){e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.scaleX=this.scaleX,e.scaleY=this.scaleY}},"./src/wgs/scene/TileCoords.js":
/*!*************************************!*\
  !*** ./src/wgs/scene/TileCoords.js ***!
  \*************************************/
/*! exports provided: TileCoords, tile2Index, index2Tile */function(e,t,n){"use strict";function r(e,t,n){this.level=e,this.x=t,this.y=n}function i(e){var t=((1<<2*e.level)-1)/3,n=1<<e.level;return t+e.y*n+e.x}function o(e){for(var t=new r(0,0,0);i(t)<=e;)t.level++;t.level--;var n=e-i(t),o=1<<t.level;return t.y=Math.floor(n/o),t.x=n%o,t}n.r(t),n.d(t,"TileCoords",(function(){return r})),n.d(t,"tile2Index",(function(){return i})),n.d(t,"index2Tile",(function(){return o})),r.prototype={constructor:r,copy:function(){return new r(this.level,this.x,this.y)},isValid:function(){return Number.isInteger(this.level)&&this.level>=0&&Number.isInteger(this.x)&&Number.isInteger(this.y)},getChild:function(e){var t=1&e?1:0,n=2&e?1:0;return new r(this.level+1,2*this.x+t,2*this.y+n)},getParent:function(){return 0==this.level?null:new r(this.level-1,Math.floor(this.x/2),Math.floor(this.y/2))},getParentAtLevel:function(e){if(e<0||e>this.level)return null;var t=this.level-e;return new r(e,Math.floor(this.x>>t),Math.floor(this.y>>t))},toString:function(){return"("+this.level+", "+this.x+", "+this.y+")"},equals:function(e,t,n){return e instanceof r?this.equals(e.level,e.x,e.y):this.level===e&&this.x===t&&this.y===n}}},"./src/wgs/scene/VBIntersector.js":
/*!****************************************!*\
  !*** ./src/wgs/scene/VBIntersector.js ***!
  \****************************************/
/*! exports provided: VBIntersector */function(e,t,n){"use strict";n.r(t),n.d(t,"VBIntersector",(function(){return h}));var r,i,o=n(/*! ./VertexEnumerator */"./src/wgs/scene/VertexEnumerator.js"),s=n(/*! three */"./thirdparty/three.js/three.js");function a(){r||(r=new s.Matrix4,i=new s.Ray,new s.Vector3,new s.Vector3,new s.Vector3)}function l(e,t,n){a();var l=e.geometry;if(l){var c=e.material,u=c?c.side:s.FrontSide;r.getInverse(e.matrixWorld),i.copy(t.ray).applyMatrix4(r);var d,h,f=t.precision;Object(o.enumMeshTriangles)(l,(function(r,o,a,l,c,p,m,g,v,y){null!==(d=u===s.BackSide?i.intersectTriangle(a,o,r,!0):i.intersectTriangle(r,o,a,u!==s.DoubleSide))&&(d.applyMatrix4(e.matrixWorld),(h=t.ray.origin.distanceTo(d))<f||h<t.near||h>t.far||n.push({distance:h,point:d,face:new s.Face3(l,c,p,s.Triangle.normal(r,o,a)),faceIndex:y,fragId:e.fragId,dbId:e.dbId,object:e}))}))}}function c(e,t,n){a();var l=e.geometry;if(l){var c=t.linePrecision;e.isWideLine&&(e.material.linewidth?c=e.material.linewidth:e.geometry.lineWidth&&(c=e.geometry.lineWidth));var u=c*c;r.getInverse(e.matrixWorld),i.copy(t.ray).applyMatrix4(r);var d=new s.Vector3,h=new s.Vector3;l instanceof s.BufferGeometry&&Object(o.enumMeshLines)(l,(function(r,o,s,a,l){var c;i.distanceSqToSegment(r,o,h,d),d.applyMatrix4(e.matrixWorld),h.applyMatrix4(e.matrixWorld),d.distanceToSquared(h)>u||(c=t.ray.origin.distanceTo(d))<t.near||c>t.far||n.push({distance:c,point:d,face:{a:s,b:a},faceIndex:l,fragId:e.fragId,dbId:e.dbId,object:e})}))}}function u(e,t,n){e.isLine||e.isWideLine?c(e,t,n):e.isPoint?function(e,t,n){a();var l=e.geometry;if(l){r.getInverse(e.matrixWorld),i.copy(t.ray).applyMatrix4(r);var c=t.precision,u=t.params.PointCloud.threshold;u||(u=1),u*=Math.max(3,l.pointSize),u/=4,l instanceof s.BufferGeometry&&Object(o.enumMeshVertices)(l,(function(r,o,s,a){if(!(i.distanceToPoint(r)>u)){var l=i.closestPointToPoint(r);if(null!==l){l.applyMatrix4(e.matrixWorld);var d=t.ray.origin.distanceTo(l);d<c||d<t.near||d>t.far||n.push({distance:d,point:r,face:{a:a},faceIndex:a,fragId:e.fragId,dbId:e.dbId,object:e})}}}))}}(e,t,n):l(e,t,n)}var d=function(e,t){return e.distance-t.distance};var h={meshRayCast:l,lineRayCast:c,rayCast:u,intersectObject:function(e,t,n,r){!function e(t,n,r,i){if(t instanceof s.Mesh?u(t,n,r):t.raycast(n,r),!0===i)for(var o=t.children,a=0,l=o.length;a<l;a++)e(o[a],n,r,!0)}(e,t,n,r),n.sort(d)}}},"./src/wgs/scene/VertexBufferReader.js":
/*!*********************************************!*\
  !*** ./src/wgs/scene/VertexBufferReader.js ***!
  \*********************************************/
/*! exports provided: VertexBufferReader, BoundsCallback */function(e,t,n){"use strict";n.r(t),n.d(t,"VertexBufferReader",(function(){return o})),n.d(t,"BoundsCallback",(function(){return s}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=2*Math.PI;function o(e){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.ib=e.ib,this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=e.numInstances>0,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&e.tIdColor&&e.tIdColor.image&&e.tIdColor.image.data&&new Uint32Array(e.tIdColor.image.data.buffer)}function s(e){this.bounds=e,this.point=new r.Vector4,this.point.z=0,this.point.w=1}o.prototype.getDbIdAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+7]]:this.vbi[e*this.stride+7]},o.prototype.getColorAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+6]]:this.vbi[e*this.stride+6]},o.prototype.getVertexFlagsAt=function(e){return this.texData?this.vbi[e*this.stride+4]:this.vbi[e*this.stride+8]},o.prototype.getLayerIndexAt=function(e){return this.texData?65535&this.vbi[e*this.stride+5]:65535&this.vbi[e*this.stride+9]},o.prototype.getViewportIndexAt=function(e){return this.texData?this.vbi[e*this.stride+5]>>16&65535:this.vbi[e*this.stride+9]>>16&65535},o.prototype.decodeLineAt=function(e,t,n,r){if(r.onLineSegment){if(this.useCompactBuffers)var o=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w,l=this.vbs[o+2]/65535*i-Math.PI,c=this.vbs[o+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),u=this.vbs[o+4]/32767*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y)*2;else{var d=this.stride*e;s=this.vbf[d],a=this.vbf[d+1],l=this.vbf[d+2]*i-Math.PI,c=this.vbf[d+3],u=2*this.vbf[d+4]}var h=s+c*Math.cos(l),f=a+c*Math.sin(l);r.onLineSegment(s,a,h,f,n,u)}},o.prototype.decodeCircularArcAt=function(e,t,n,r){if(r.onCircularArc){if(this.useCompactBuffers)var o=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w,l=this.vbs[o+2]/65535*i,c=this.vbs[o+3]/65535*i,u=this.vbs[o+5]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var d=this.stride*e;s=this.vbf[d],a=this.vbf[d+1],l=this.vbf[d+2]*i,c=this.vbf[d+3]*i,u=this.vbf[d+5]}r.onCircularArc(s,a,l,c,u,n)}},o.prototype.decodeEllipticalArcAt=function(e,t,n,r){if(r.onEllipticalArc){var o=this.stride*e,s=this.vbf[o],a=this.vbf[o+1],l=this.vbf[o+2]*i,c=this.vbf[o+3]*i,u=this.vbf[o+5],d=this.vbf[o+10],h=this.vbf[o+11];r.onEllipticalArc(s,a,l,c,u,d,h,n)}},o.prototype.decodeTexQuadAt=function(e,t,n,r){if(r.onTexQuad){if(this.useCompactBuffers)var o=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w,l=this.vbs[o+2]/65535*i,c=this.vbs[o+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),u=this.vbs[o+4]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var d=this.stride*e;s=this.vbf[d],a=this.vbf[d+1],l=this.vbf[d+2]*i,c=this.vbf[d+3],u=this.vbf[d+4]}r.onTexQuad(s,a,c,u,l,n)}},o.prototype.decodeOneTriangleAt=function(e,t,n,r){if(r.onOneTriangle){if(this.useCompactBuffers)var i=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[i]/65535+this.useCompactBuffers.z,s=this.useCompactBuffers.y*this.vbs[i+1]/65535+this.useCompactBuffers.w,a=this.useCompactBuffers.x*this.vbs[i+2]/65535+this.useCompactBuffers.z,l=this.useCompactBuffers.y*this.vbs[i+3]/65535+this.useCompactBuffers.w,c=this.useCompactBuffers.x*this.vbs[i+4]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[i+5]/65535+this.useCompactBuffers.w;else{var d=this.stride*e;o=this.vbf[d],s=this.vbf[d+1],a=this.vbf[d+2],l=this.vbf[d+3],c=this.vbf[d+4],u=this.vbf[d+5]}r.onOneTriangle(o,s,a,l,c,u,n)}},o.prototype.decodeTriangleIndexed=function(e,t,n,r,i,o){if(o.onOneTriangle){if(this.useCompactBuffers){var s=this.stride*e*2,a=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,l=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w;s=this.stride*t*2;var c=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w;s=this.stride*n*2;var d=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,h=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w}else{var f=this.stride*e;a=this.vbf[f],l=this.vbf[f+1];f=this.stride*t;c=this.vbf[f],u=this.vbf[f+1];f=this.stride*n;d=this.vbf[f],h=this.vbf[f+1]}o.onOneTriangle(a,l,c,u,d,h,i)}},o.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var n=0;n<this.vcount;){var r=this.getVertexFlagsAt(n)>>8&255,i=this.getLayerIndexAt(n),o=this.getViewportIndexAt(n);if(a=this.getDbIdAt(n)===e)switch(r){case 1:this.decodeLineAt(n,i,o,t);break;case 2:this.decodeCircularArcAt(n,i,o,t);break;case 3:this.decodeEllipticalArcAt(n,i,o,t);break;case 4:this.decodeTexQuadAt(n,i,o,t);break;case 5:this.decodeOneTriangleAt(n,i,o,t)}n+=1}else for(n=0;n<this.ib.length;){var s=this.ib[n],a=(r=this.getVertexFlagsAt(s)>>8&255,i=this.getLayerIndexAt(s),o=this.getViewportIndexAt(s),this.getDbIdAt(s)===e);if(0===r)a&&this.decodeTriangleIndexed(this.ib[n],this.ib[n+1],this.ib[n+2],i,o,t),n+=3;else{if(a)switch(r){case 1:this.decodeLineAt(s,i,o,t);break;case 2:this.decodeCircularArcAt(s,i,o,t);break;case 3:this.decodeEllipticalArcAt(s,i,o,t);break;case 4:this.decodeTexQuadAt(s,i,o,t);break;case 5:this.decodeOneTriangleAt(s,i,o,t)}n+=6}}},o.prototype.enumGeomsForVisibleLayer=function(e,t){this.enumGeoms((function(t,n,r){return!e||0!==n&&-1!==e.indexOf(n)}),t)},o.prototype.enumGeoms=function(e,t){if(this.useInstancing)for(var n=0;n<this.vcount;){var r=this.getVertexFlagsAt(n)>>8&255,i=this.getLayerIndexAt(n),o=this.getViewportIndexAt(n),s=this.getDbIdAt(n);if(l=!e||e(s,i,o))switch(r){case 1:this.decodeLineAt(n,i,o,t);break;case 2:this.decodeCircularArcAt(n,i,o,t);break;case 3:this.decodeEllipticalArcAt(n,i,o,t);break;case 4:this.decodeTexQuadAt(n,i,o,t);break;case 5:this.decodeOneTriangleAt(n,i,o,t)}n+=1}else for(n=0;n<this.ib.length;){var a=this.ib[n],l=(r=this.getVertexFlagsAt(a)>>8&255,i=this.getLayerIndexAt(a),o=this.getViewportIndexAt(a),s=this.getDbIdAt(a),!e||e(s,i,o));if(0===r)l&&this.decodeTriangleIndexed(this.ib[n],this.ib[n+1],this.ib[n+2],i,o,t),n+=3;else{if(l)switch(r){case 1:this.decodeLineAt(a,i,o,t);break;case 2:this.decodeCircularArcAt(a,i,o,t);break;case 3:this.decodeEllipticalArcAt(a,i,o,t);break;case 4:this.decodeTexQuadAt(a,i,o,t);break;case 5:this.decodeOneTriangleAt(a,i,o,t)}n+=6}}},s.prototype.onVertex=function(e,t,n){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},s.prototype.onLineSegment=function(e,t,n,r,i){this.onVertex(e,t),this.onVertex(n,r)},s.prototype.onCircularArc=function(e,t,n,r,i,o){this.onEllipticalArc(e,t,n,r,i,i,0,o)},s.prototype.onEllipticalArc=function(e,t,n,r,i,o,s,a){0==s?n<=0&&r>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*i,2*o,s,a):(this.point.x=e+Math.cos(n)*i,this.point.y=t+Math.sin(n)*o,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(r)*i,this.point.y=t+Math.sin(r)*o,this.bounds.expandByPoint(this.point),n>r&&(this.point.x=e+i,this.point.y=t,this.bounds.expandByPoint(this.point),n-=2*Math.PI),n<.5*Math.PI&&r>.5*Math.PI&&(this.point.x=e,this.point.y=t+o,this.bounds.expandByPoint(this.point)),n<Math.PI&&r>Math.PI&&(this.point.x=e-i,this.point.y=t,this.bounds.expandByPoint(this.point)),n<1.5*Math.PI&&r>1.5*Math.PI&&(this.point.x=e,this.point.y=t-o,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*i,2*o,s,a)},s.prototype.onTexQuad=function(e,t,n,i,o,s){var a=.5*n,l=.5*n;if(0==o)this.onVertex(e-a,t-l),this.onVertex(e+a,t+l);else{var c=new r.Matrix4,u=new r.Matrix4;c.makeRotationZ(o),u.makeTranslation(e,t,0),u.multiply(c);for(var d=0;d<4;d++)this.point.x=d%2==1?a:-a,this.point.y=d>=2?l:-l,this.point.applyMatrix4(u),this.bounds.expandByPoint(this.point)}},s.prototype.onOneTriangle=function(e,t,n,r,i,o,s){this.onVertex(e,t),this.onVertex(n,r),this.onVertex(i,o)}},"./src/wgs/scene/VertexEnumerator.js":
/*!*******************************************!*\
  !*** ./src/wgs/scene/VertexEnumerator.js ***!
  \*******************************************/
/*! exports provided: getVertexCount, enumMeshVertices, enumMeshIndices, enumMeshTriangles, enumMeshLines, enumMeshEdges, VertexEnumerator */function(e,t,n){"use strict";n.r(t),n.d(t,"getVertexCount",(function(){return m})),n.d(t,"enumMeshVertices",(function(){return g})),n.d(t,"enumMeshIndices",(function(){return v})),n.d(t,"enumMeshTriangles",(function(){return y})),n.d(t,"enumMeshLines",(function(){return _})),n.d(t,"enumMeshEdges",(function(){return b})),n.d(t,"VertexEnumerator",(function(){return x}));var r,i,o,s,a,l,c,u,d,h,f,p=n(/*! ./LmvVector3 */"./src/wgs/scene/LmvVector3.js");function m(e){return e.vb?e.vb.length/e.vbstride:e.attributes.positions?e.attributes.positions.count:0}function g(e,t,n){var s=e.attributes;r||(r=new p.LmvVector3,i=new p.LmvVector3,new p.LmvVector3),n&&(o||(o=new THREE.Matrix3),o.getNormalMatrix(n));var a,l=e.vb||s.position.array,c=e.vb||s.normal&&s.normal.array,u=e.vb?e.vbstride:3;if(e.vblayout){if(!e.vblayout.position)return;a=e.vblayout.position.offset}else{if(!s.position)return;a=s.position.itemOffset||0}var d=0,h=e.vblayout?e.vblayout.normal:s.normal||null;h?d=h.offset||h.itemOffset||0:c=null,!h||3===h.itemSize&&4===h.bytesPerItem||(c=null);for(var f=e.vb?e.vb.length/e.vbstride:l.length,m=a,g=d,v=0;v<f;v++,m+=u,g+=u)r.set(l[m],l[m+1],l[m+2]),n&&r.applyMatrix4(n),c&&(i.set(c[g],c[g+1],c[g+2]),n&&i.applyMatrix3(o)),t(r,c?i:null,null,v)}function v(e,t){var n=e.ib||e.indices||(attributes.index?attributes.index.array:null);if(n){var r=e.offsets;r&&0!==r.length||(r=[{start:0,count:n.length,index:0}]);for(var i=0,o=r.length;i<o;++i)for(var s=r[i].start,a=r[i].count,l=r[i].index,c=s,u=s+a;c<u;c+=3){t(l+n[c],l+n[c+1],l+n[c+2])}}else for(var d=e.vb||attributes.position.array,h=e.vb?e.vb.length/e.vbstride:d.length/3,f=0;f<h;f++){t(3*f,3*f+1,3*f+2)}}function y(e,t){var n,r,i,o=e.attributes;s||(s=new p.LmvVector3,a=new p.LmvVector3,l=new p.LmvVector3,c=new p.LmvVector3,u=new p.LmvVector3,d=new p.LmvVector3);var h,f=e.vb||o.position.array,m=e.vb||o.normal&&o.normal.array,g=e.vb?e.vbstride:3;if(e.vblayout){if(!e.vblayout.position)return;h=e.vblayout.position.offset}else{if(!o.position)return;h=o.position.itemOffset||0}var v=0,y=e.vblayout?e.vblayout.normal:o.normal||null;y?v=y.offset||y.itemOffset||0:m=null,!y||3===y.itemSize&&4===y.bytesPerItem||(m=null);var _=e.ib||e.indices||(o.index?o.index.array:null);if(_){var b=e.offsets;b&&0!==b.length||(b=[{start:0,count:_.length,index:0}]);for(var x=0,w=b.length;x<w;++x)for(var E=b[x].start,A=b[x].count,M=b[x].index,S=E,T=E+A;S<T;S+=3){var C=(n=M+_[S])*g+h,P=(r=M+_[S+1])*g+h,L=(i=M+_[S+2])*g+h;if(s.x=f[C],s.y=f[C+1],s.z=f[C+2],a.x=f[P],a.y=f[P+1],a.z=f[P+2],l.x=f[L],l.y=f[L+1],l.z=f[L+2],m){var D=n*g+v,R=r*g+v,I=i*g+v;c.x=m[D],c.y=m[D+1],c.z=m[D+2],u.x=m[R],u.y=m[R+1],u.z=m[R+2],d.x=m[I],d.y=m[I+1],d.z=m[I+2],t(s,a,l,n,r,i,c,u,d,S/3)}else t(s,a,l,n,r,i,null,null,null,S/3)}}else{var j=e.vb?e.vb.length/e.vbstride:f.length/3;for(S=0;S<j;S++){C=(n=3*S)*g+h,P=(r=3*S+1)*g+h,L=(i=3*S+2)*g+h;if(s.x=f[C],s.y=f[C+1],s.z=f[C+2],a.x=f[P],a.y=f[P+1],a.z=f[P+2],l.x=f[L],l.y=f[L+1],l.z=f[L+2],m){D=n*g+v,R=r*g+v,I=i*g+v;c.x=m[D],c.y=m[D+1],c.z=m[D+2],u.x=m[R],u.y=m[R+1],u.z=m[R+2],d.x=m[I],d.y=m[I+1],d.z=m[I+2],t(s,a,l,n,r,i,c,u,d,S)}else t(s,a,l,n,r,i,null,null,null,S)}}}function _(e,t){var n,r,i=e.attributes;h||(h=new p.LmvVector3,f=new p.LmvVector3);var o=2;e.lineWidth&&(o=6);var s=e.ib||e.indices||(i.index?i.index.array:null);if(s){var a=e.vb?e.vb:i.position.array,l=e.vb?e.vbstride:3,c=e.offsets;c&&0!==c.length||(c=[{start:0,count:s.length,index:0}]);for(var u=0,d=c.length;u<d;++u)for(var m=c[u].start,g=c[u].count,v=c[u].index,y=m,_=m+g,b=m/o;y<_;y+=o,b++)n=v+s[y],r=v+s[y+1],h.x=a[n*l],h.y=a[n*l+1],h.z=a[n*l+2],f.x=a[r*l],f.y=a[r*l+1],f.z=a[r*l+2],t(h,f,n,r,b)}else for(a=e.vb?e.vb:i.position.array,l=e.vb?e.vbstride:3,y=0,_=a.length/l,b=0;y<_;y+=o,b++)n=y,r=y+1,h.x=a[n*l],h.y=a[n*l+1],h.z=a[n*l+2],f.x=a[r*l],f.y=a[r*l+1],f.z=a[r*l+2],t(h,f,n,r,b)}function b(e,t){var n,r,i=e.attributes;h||(h=new p.LmvVector3,f=new p.LmvVector3);var o=e.iblines;if(o){var s=e.vb?e.vb:i.position.array,a=e.vb?e.vbstride:3,l=e.offsets;l&&0!==l.length||(l=[{start:0,count:o.length,index:0}]);for(var c=0,u=l.length;c<u;++c)for(var d=l[c].start,m=l[c].count,g=l[c].index,v=d,y=d+m;v<y;v+=2)n=g+o[v],r=g+o[v+1],h.x=s[n*a],h.y=s[n*a+1],h.z=s[n*a+2],f.x=s[r*a],f.y=s[r*a+1],f.z=s[r*a+2],t(h,f,n,r)}}var x={getVertexCount:m,enumMeshVertices:g,enumMeshIndices:v,enumMeshTriangles:y,enumMeshLines:_,enumMeshEdges:b}},"./thirdparty/hammer/hammer.js":
/*!*************************************!*\
  !*** ./thirdparty/hammer/hammer.js ***!
  \*************************************/
/*! no static exports found */function(e,t,n){var r;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*! Hammer.JS - v2.0.8 - 2016-04-23
                                                                                                                                                                                                                                                                                                                                                      * http://hammerjs.github.io/
                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                      * Copyright (c) 2016 Jorik Tangelder;
                                                                                                                                                                                                                                                                                                                                                      * Licensed under the MIT license */!function(o,s,a,l){"use strict";var c=["","webkit","Moz","MS","ms","o"],u=s.createElement("div"),d=Math.round,h=Math.abs,f=Date.now;function p(e,t,n){return setTimeout(w(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function v(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,r,n),e.apply(this,arguments)}}var y=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=Array.isArray(r[i])?r[i].slice(0):r[i])}return t},_=v((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),b=v((function(e,t){return _(e,t,!0)}),"merge","Use `assign`.");function x(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&y(r,n)}function w(e,t){return function(){return e.apply(t,arguments)}}function E(e,t){return"function"==i(e)?e.apply(t&&t[0]||void 0,t):e}function A(e,t){return void 0===e?t:e}function M(e,t,n){g(P(t),(function(t){e.addEventListener(t,n,!1)}))}function S(e,t,n){g(P(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function P(e){return e.trim().split(/\s+/g)}function L(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function D(e){return Array.prototype.slice.call(e,0)}function R(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];L(i,s)<0&&r.push(e[o]),i[o]=s,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function I(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}}var j=1;function O(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}var N="ontouchstart"in o,k=void 0!==I(o,"PointerEvent"),F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),V=["x","y"],B=["clientX","clientY"];function U(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){E(e.options.enable,[e])&&n.handler(t)},this.init()}function z(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,s=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!s,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=G(t));i>1&&!n.firstMultiple?n.firstMultiple=G(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,l=t.center=H(r);t.timeStamp=f(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=Y(a,l),t.distance=q(a,l),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=X(t.deltaX,t.deltaY);var c=W(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=h(c.x)>h(c.y)?c.x:c.y,t.scale=s?(u=s.pointers,d=r,q(d[0],d[1],B)/q(u[0],u[1],B)):1,t.rotation=s?function(e,t){return Y(t[1],t[0],B)-Y(e[1],e[0],B)}(s.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,s=e.lastInterval||t,a=t.timeStamp-s.timeStamp;if(8!=t.eventType&&(a>25||void 0===s.velocity)){var l=t.deltaX-s.deltaX,c=t.deltaY-s.deltaY,u=W(a,l,c);r=u.x,i=u.y,n=h(u.x)>h(u.y)?u.x:u.y,o=X(l,c),e.lastInterval=t}else n=s.velocity,r=s.velocityX,i=s.velocityY,o=s.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var u,d;var p=e.element;T(t.srcEvent.target,p)&&(p=t.srcEvent.target);t.target=p}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function G(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:t,center:H(t),deltaX:e.deltaX,deltaY:e.deltaY}}function H(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:d(n/t),y:d(r/t)}}function W(e,t,n){return{x:t/e||0,y:n/e||0}}function X(e,t){return e===t?1:h(e)>=h(t)?e<0?2:4:t<0?8:16}function q(e,t,n){n||(n=V);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Y(e,t,n){n||(n=V);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(O(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(O(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4};function Q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,U.apply(this,arguments)}x(Q,U,{handler:function(e){var t=K[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Z={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},J={2:"touch",3:"pen",4:"mouse",5:"kinect"},$="pointerdown",ee="pointermove pointerup pointercancel";function te(){this.evEl=$,this.evWin=ee,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}o.MSPointerEvent&&!o.PointerEvent&&($="MSPointerDown",ee="MSPointerMove MSPointerUp MSPointerCancel"),x(te,U,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=Z[r],o=J[e.pointerType]||e.pointerType,s="touch"===o,a="mouse"===o,l=L(t,e.pointerId,"pointerId");1&i&&(0===e.button||s)?l<0&&(t.push(e),l=t.length-1):12&i&&(n=!0),l<0||(t[l]=e,a&&!this.manager.options.handlePointerEventMouse||this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(l,1))}});var ne={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function re(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,U.apply(this,arguments)}function ie(e,t){var n=D(e.touches),r=D(e.changedTouches);return 12&t&&(n=R(n.concat(r),"identifier",!0)),[n,r]}x(re,U,{handler:function(e){var t=ne[e.type];if(1===t&&(this.started=!0),this.started){var n=ie.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var oe={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function se(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},U.apply(this,arguments)}function ae(e,t){var n=D(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,s=D(e.changedTouches),a=[],l=this.target;if(o=n.filter((function(e){return T(e.target,l)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<s.length;)r[s[i].identifier]&&a.push(s[i]),12&t&&delete r[s[i].identifier],i++;return a.length?[R(o.concat(a),"identifier",!0),a]:void 0}x(se,U,{handler:function(e){var t=oe[e.type],n=ae.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function le(){U.apply(this,arguments);var e=w(this.handler,this);this.touch=new se(this.manager,e),this.mouse=new Q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ce(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ue.call(this,t)):12&e&&ue.call(this,t)}function ue(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function de(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),s=Math.abs(n-i.y);if(o<=25&&s<=25)return!0}return!1}x(le,U,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ce.call(this,t,n);else if(i&&de.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=I(u.style,"touchAction"),fe=void 0!==he,pe=function(){if(!fe)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||o.CSS.supports("touch-action",n)})),e}();function me(e,t){this.manager=e,this.set(t)}me.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&pe[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){E(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,"none"))return"none";var t=C(e,"pan-x"),n=C(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(C(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=C(r,"none")&&!pe.none,o=C(r,"pan-y")&&!pe["pan-y"],s=C(r,"pan-x")&&!pe["pan-x"];if(i){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!s||!o)return i||o&&6&n||s&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function ge(e){this.options=y({},this.defaults,e||{}),this.id=j++,this.manager=null,this.options.enable=A(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ve(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function ye(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function _e(e,t){var n=t.manager;return n?n.get(e):e}function be(){ge.apply(this,arguments)}function xe(){be.apply(this,arguments),this.pX=null,this.pY=null}function we(){be.apply(this,arguments)}function Ee(){ge.apply(this,arguments),this._timer=null,this._input=null}function Ae(){be.apply(this,arguments)}function Me(){be.apply(this,arguments)}function Se(){ge.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Te(e,t){return(t=t||{}).recognizers=A(t.recognizers,Te.defaults.preset),new Ce(e,t)}ge.prototype={defaults:{},set:function(e){return y(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=_e(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=_e(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===L(t,e=_e(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=_e(e,this);var t=L(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ve(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ve(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=y({},e);if(!E(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(be,ge,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),x(xe,be,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,s=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===s?1:s<0?8:16,n=s!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return be.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ye(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(we,be,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Ee,ge,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(Ae,be,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(Me,be,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return xe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=ye(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Se,ge,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||q(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=p((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Te.VERSION="2.0.8",Te.defaults={domEvents:!1,touchAction:"compute",enable:!0,handlePointerEventMouse:!0,inputTarget:null,inputClass:null,preset:[[Ae,{enable:!1}],[we,{enable:!1},["rotate"]],[Me,{direction:6}],[xe,{direction:6},["swipe"]],[Se],[Se,{event:"doubletap",taps:2},["tap"]],[Ee]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ce(e,t){var n;this.options=y({},Te.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(k?te:F?se:N?le:Q))(n,z),this.touchAction=new me(this,this.options.touchAction),Pe(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Pe(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,o){n=I(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ce.prototype={set:function(e){return y(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof ge)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=L(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return g(P(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return g(P(e),(function(e){t?n[e]&&n[e].splice(L(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=s.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()},t.stopPropagation=function(){t.srcEvent.stopPropagation()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&Pe(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},y(Te,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ce,Input:U,TouchAction:me,TouchInput:se,MouseInput:Q,PointerEventInput:te,TouchMouseInput:le,SingleTouchInput:re,Recognizer:ge,AttrRecognizer:be,Tap:Se,Pan:xe,Swipe:Me,Pinch:we,Rotate:Ae,Press:Ee,on:M,off:S,each:g,merge:b,extend:_,assign:y,inherit:x,bindFn:w,prefixed:I}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=Te,void 0===(r=function(){return Te}.call(t,n,t,e))||(e.exports=r)}(window,document)},"./thirdparty/three.js/DDSLoader.js":
/*!******************************************!*\
  !*** ./thirdparty/three.js/DDSLoader.js ***!
  \******************************************/
/*! exports provided: DDSLoader */function(e,t,n){"use strict";n.r(t),n.d(t,"DDSLoader",(function(){return i}));var r=n(/*! three */"./thirdparty/three.js/three.js"),i=function e(){this._parser=e.parse};i.prototype=Object.create(r.CompressedTextureLoader.prototype),i.prototype.constructor=i,i.parse=function(e,t){var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function o(e,t,n,r){for(var i=n*r*4,o=new Uint8Array(e,t,i),s=new Uint8Array(i),a=0,l=0,c=0;c<r;c++)for(var u=0;u<n;u++){var d=o[l],h=o[++l],f=o[++l],p=o[++l];l++,s[a]=f,s[++a]=h,s[++a]=d,s[++a]=p,a++}return s}var s=i("DXT1"),a=i("DXT3"),l=i("DXT5");if(e.byteLength<124)return console.error("THREE.DDSLoader.parse: File is empty or incomplete."),n;var c,u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var d,h=u[21],f=!1;switch(h){case s:c=8,n.format=r.RGB_S3TC_DXT1_Format;break;case a:c=16,n.format=r.RGBA_S3TC_DXT3_Format;break;case l:c=16,n.format=r.RGBA_S3TC_DXT5_Format;break;default:if(!(32==u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(d=h,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),n;f=!0,c=64,n.format=r.RGBAFormat}n.mipmapCount=1,u[7]>0&&!1!==t&&(n.mipmapCount=Math.max(1,u[7])),n.isCubemap=!!(512&u[28]),n.width=u[4],n.height=u[3];for(var p=u[1]+4,m=n.width,g=n.height,v=n.isCubemap?6:1,y=0;y<v;y++){for(var _=0;_<n.mipmapCount;_++){if(f)var b=(x=o(e,p,m,g)).length;else{b=Math.max(4,m)/4*Math.max(4,g)/4*c;var x=new Uint8Array(e,p,b)}var w={data:x,width:m,height:g};n.mipmaps.push(w),p+=b,m=Math.max(.5*m,1),g=Math.max(.5*g,1)}m=n.width,g=n.height}return n}},"./thirdparty/three.js/three.js":
/*!**************************************!*\
  !*** ./thirdparty/three.js/three.js ***!
  \**************************************/
/*! no static exports found */function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n,r,i,o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S,T,C,P,L,D,R,I,j,O,N,k,F,V,B,U,z,G,H,W,X,q={REVISION:"71"};"object"===t(e)&&(e.exports=q),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),q.log=function(){console.log.apply(console,arguments)},q.warn=function(){console.warn.apply(console,arguments)},q.error=function(){console.error.apply(console,arguments)},q.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},q.CullFaceNone=0,q.CullFaceBack=1,q.CullFaceFront=2,q.CullFaceFrontBack=3,q.FrontFaceDirectionCW=0,q.FrontFaceDirectionCCW=1,q.BasicShadowMap=0,q.PCFShadowMap=1,q.PCFSoftShadowMap=2,q.FrontSide=0,q.BackSide=1,q.DoubleSide=2,q.NoShading=0,q.FlatShading=1,q.SmoothShading=2,q.NoColors=0,q.FaceColors=1,q.VertexColors=2,q.NoBlending=0,q.NormalBlending=1,q.AdditiveBlending=2,q.SubtractiveBlending=3,q.MultiplyBlending=4,q.CustomBlending=5,q.AddEquation=100,q.SubtractEquation=101,q.ReverseSubtractEquation=102,q.MinEquation=103,q.MaxEquation=104,q.ZeroFactor=200,q.OneFactor=201,q.SrcColorFactor=202,q.OneMinusSrcColorFactor=203,q.SrcAlphaFactor=204,q.OneMinusSrcAlphaFactor=205,q.DstAlphaFactor=206,q.OneMinusDstAlphaFactor=207,q.DstColorFactor=208,q.OneMinusDstColorFactor=209,q.SrcAlphaSaturateFactor=210,q.MultiplyOperation=0,q.MixOperation=1,q.AddOperation=2,q.UVMapping=300,q.CubeReflectionMapping=301,q.CubeRefractionMapping=302,q.EquirectangularReflectionMapping=303,q.EquirectangularRefractionMapping=304,q.SphericalReflectionMapping=305,q.RepeatWrapping=1e3,q.ClampToEdgeWrapping=1001,q.MirroredRepeatWrapping=1002,q.NearestFilter=1003,q.NearestMipMapNearestFilter=1004,q.NearestMipMapLinearFilter=1005,q.LinearFilter=1006,q.LinearMipMapNearestFilter=1007,q.LinearMipMapLinearFilter=1008,q.UnsignedByteType=1009,q.ByteType=1010,q.ShortType=1011,q.UnsignedShortType=1012,q.IntType=1013,q.UnsignedIntType=1014,q.FloatType=1015,q.HalfFloatType=1025,q.UnsignedShort4444Type=1016,q.UnsignedShort5551Type=1017,q.UnsignedShort565Type=1018,q.AlphaFormat=1019,q.RGBFormat=1020,q.RGBAFormat=1021,q.LuminanceFormat=1022,q.LuminanceAlphaFormat=1023,q.RGBEFormat=q.RGBAFormat,q.RGB_S3TC_DXT1_Format=2001,q.RGBA_S3TC_DXT1_Format=2002,q.RGBA_S3TC_DXT3_Format=2003,q.RGBA_S3TC_DXT5_Format=2004,q.RGB_PVRTC_4BPPV1_Format=2100,q.RGB_PVRTC_2BPPV1_Format=2101,q.RGBA_PVRTC_4BPPV1_Format=2102,q.RGBA_PVRTC_2BPPV1_Format=2103,q.Projector=function(){q.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){q.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){q.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){q.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},q.CanvasRenderer=function(){q.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},q.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},q.Color.prototype={constructor:q.Color,r:1,g:1,b:1,set:function(e){return e instanceof q.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e},i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=r(o,i,e+1/3),this.g=r(o,i,e),this.b=r(o,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(q.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,n,r=e||{h:0,s:0,l:0},i=this.r,o=this.g,s=this.b,a=Math.max(i,o,s),l=Math.min(i,o,s),c=(l+a)/2;if(l===a)t=0,n=0;else{var u=a-l;switch(n=c<=.5?u/(a+l):u/(2-a-l),a){case i:t=(o-s)/u+(o<s?6:0);break;case o:t=(s-i)/u+2;break;case s:t=(i-o)/u+4}t/=6}return r.h=t,r.s=n,r.l=c,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new q.Color).setRGB(this.r,this.g,this.b)}},q.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},q.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1},q.Quaternion.prototype={constructor:q.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof q.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),r=Math.cos(e._y/2),i=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),a=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*r*i+n*s*a,this._y=n*s*i-o*r*a,this._z=n*r*a+o*s*i,this._w=n*r*i-o*s*a):"YXZ"===e.order?(this._x=o*r*i+n*s*a,this._y=n*s*i-o*r*a,this._z=n*r*a-o*s*i,this._w=n*r*i+o*s*a):"ZXY"===e.order?(this._x=o*r*i-n*s*a,this._y=n*s*i+o*r*a,this._z=n*r*a+o*s*i,this._w=n*r*i-o*s*a):"ZYX"===e.order?(this._x=o*r*i-n*s*a,this._y=n*s*i+o*r*a,this._z=n*r*a-o*s*i,this._w=n*r*i+o*s*a):"YZX"===e.order?(this._x=o*r*i+n*s*a,this._y=n*s*i+o*r*a,this._z=n*r*a-o*s*i,this._w=n*r*i-o*s*a):"XZY"===e.order&&(this._x=o*r*i-n*s*a,this._y=n*s*i-o*r*a,this._z=n*r*a+o*s*i,this._w=n*r*i+o*s*a),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],o=n[8],s=n[1],a=n[5],l=n[9],c=n[2],u=n[6],d=n[10],h=r+a+d;return h>0?(t=.5/Math.sqrt(h+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(s-i)*t):r>a&&r>d?(t=2*Math.sqrt(1+r-a-d),this._w=(u-l)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(o+c)/t):a>d?(t=2*Math.sqrt(1+a-r-d),this._w=(o-c)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+d-r-a),this._w=(s-i)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){return void 0===n&&(n=new q.Vector3),(r=e.dot(t)+1)<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?n.set(-e.y,e.x,0):n.set(0,-e.z,e.y)):n.crossVectors(e,t),this._x=n.x,this._y=n.y,this._z=n.z,this._w=r,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(q.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+r*l-i*a,this._y=r*c+o*a+i*s-n*l,this._z=i*c+o*l+n*a-r*s,this._w=o*c-n*s-r*a-i*l,this.onChangeCallback(),this},multiplyVector3:function(e){return q.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var a=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var c=Math.sin((1-t)*a)/l,u=Math.sin(t*a)/l;return this._w=o*c+this._w*u,this._x=n*c+this._x*u,this._y=r*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new q.Quaternion(this._x,this._y,this._z,this._w)}},q.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},q.Vector2=function(e,t){this.x=e||0,this.y=t||0},q.Vector2.prototype={constructor:q.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(q.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(q.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===i&&(i=new q.Vector2,o=new q.Vector2),i.set(e,e),o.set(t,t),this.clamp(i,o)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new q.Vector2(this.x,this.y)}},q.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},q.Vector3.prototype={constructor:q.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(q.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(q.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(q.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof q.Euler==0&&q.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===a&&(a=new q.Quaternion),this.applyQuaternion(a.setFromEuler(e)),this},applyAxisAngle:function(){var e;return function(t,n){return void 0===e&&(e=new q.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*n,c=a*n+s*t-i*r,u=a*r+i*n-o*t,d=-i*t-o*n-s*r;return this.x=l*a+d*-i+c*-s-u*-o,this.y=c*a+d*-o+u*-i-l*-s,this.z=u*a+d*-s+l*-o-c*-i,this},project:function(e){return void 0===s&&(s=new q.Matrix4),s.multiplyMatrices(e.projectionMatrix,s.getInverse(e.matrixWorld)),this.applyProjection(s)},unproject:function(){var e;return function(t){return void 0===e&&(e=new q.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new q.Vector3,t=new q.Vector3),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},cross:function(e,t){if(void 0!==t)return q.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this},projectOnVector:function(){var e,t;return function(n){return void 0===e&&(e=new q.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new q.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new q.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(q.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){q.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){q.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return q.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return q.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return q.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new q.Vector3(this.x,this.y,this.z)}},q.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},q.Vector4.prototype={constructor:q.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(q.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(q.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,o=e.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],d=o[9],h=o[2],f=o[6],p=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-h)<.01&&Math.abs(d-f)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+h)<.1&&Math.abs(d+f)<.1&&Math.abs(s+u+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,g=(u+1)/2,v=(p+1)/2,y=(a+c)/4,_=(l+h)/4,b=(d+f)/4;return m>g&&m>v?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=_/n):g>v?g<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(g)),i=b/r):v<.01?(n=.707106781,r=.707106781,i=0):(n=_/(i=Math.sqrt(v)),r=b/i),this.set(n,r,i,t),this}var x=Math.sqrt((f-d)*(f-d)+(l-h)*(l-h)+(c-a)*(c-a));return Math.abs(x)<.001&&(x=1),this.x=(f-d)/x,this.y=(l-h)/x,this.z=(c-a)/x,this.w=Math.acos((s+u+p-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new q.Vector4,t=new q.Vector4),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new q.Vector4(this.x,this.y,this.z,this.w)}},q.Euler=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||q.Euler.DefaultOrder},q.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],q.Euler.DefaultOrder="XYZ",q.Euler.prototype={constructor:q.Euler,_x:0,_y:0,_z:0,_order:q.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=q.Math.clamp,i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],h=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(h,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===t?(this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,f),this._y=0)):q.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,n,r){return void 0===e&&(e=new q.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(l=new q.Quaternion,function(e){l.setFromEuler(this),this.setFromQuaternion(l,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new q.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new q.Euler(this._x,this._y,this._z,this._order)}},q.Line3=function(e,t){this.start=void 0!==e?e:new q.Vector3,this.end=void 0!==t?t:new q.Vector3},q.Line3.prototype={constructor:q.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new q.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new q.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new q.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(c=new q.Vector3,u=new q.Vector3,function(e,t){c.subVectors(e,this.start),u.subVectors(this.end,this.start);var n=u.dot(u),r=u.dot(c)/n;return t&&(r=q.Math.clamp(r,0,1)),r}),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t),i=n||new q.Vector3;return this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new q.Line3).copy(this)}},q.Box2=function(e,t){this.min=void 0!==e?e:new q.Vector2(1/0,1/0),this.max=void 0!==t?t:new q.Vector2(-1/0,-1/0)},q.Box2.prototype={constructor:q.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new q.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new q.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new q.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new q.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new q.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new q.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new q.Box2).copy(this)}},q.Box3=function(e,t){this.min=void 0!==e?e:new q.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new q.Vector3(-1/0,-1/0,-1/0)},q.Box3.prototype={constructor:q.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new q.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new q.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse((function(t){var r=t.geometry;if(void 0!==r)if(r instanceof q.Geometry)for(var i=r.vertices,o=0,s=i.length;o<s;o++)e.copy(i[o]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e);else if(r instanceof q.BufferGeometry&&void 0!==r.attributes.position){var a=r.attributes.position.array;for(o=0,s=a.length;o<s;o+=3)e.set(a[o],a[o+1],a[o+2]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}})),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new q.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new q.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new q.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new q.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new q.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new q.Vector3;return function(t){var n=t||new q.Sphere;return n.center=this.center(),n.radius=.5*this.size(e).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(d=[new q.Vector3,new q.Vector3,new q.Vector3,new q.Vector3,new q.Vector3,new q.Vector3,new q.Vector3,new q.Vector3],function(e){return d[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),d[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),d[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),d[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),d[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),d[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),d[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),d[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(d),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new q.Box3).copy(this)}},q.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&q.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},q.Matrix3.prototype={constructor:q.Matrix3,set:function(e,t,n,r,i,o,s,a,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=n,c[1]=r,c[4]=i,c[7]=o,c[2]=s,c[5]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return q.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return q.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new q.Vector3;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var i=0,o=n;i<r;i+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*i*c+n*s*a+r*i*l-r*o*a},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===i){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return q.warn(o),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new q.Matrix3).fromArray(this.elements)}},q.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&q.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},q.Matrix4.prototype={constructor:q.Matrix4,set:function(e,t,n,r,i,o,s,a,l,c,u,d,h,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return q.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){var r=this.elements;return e.set(r[0],r[1],r[2]),t.set(r[4],r[5],r[6]),n.set(r[8],r[9],r[10]),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new q.Vector3;return function(t){var n=this.elements,r=t.elements,i=1/e.set(r[0],r[1],r[2]).length(),o=1/e.set(r[4],r[5],r[6]).length(),s=1/e.set(r[8],r[9],r[10]).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*o,n[5]=r[5]*o,n[6]=r[6]*o,n[8]=r[8]*s,n[9]=r[9]*s,n[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof q.Euler==!1&&q.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var d=o*c,h=o*u,f=s*c,p=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=h+f*l,t[5]=d-p*l,t[9]=-s*a,t[2]=p-d*l,t[6]=f+h*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*c,g=a*u,v=l*c,y=l*u;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*c,g=a*u,v=l*c,y=l*u;t[0]=m-y*s,t[4]=-o*u,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*c,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){d=o*c,h=o*u,f=s*c,p=s*u;t[0]=a*c,t[4]=f*l-h,t[8]=d*l+p,t[1]=a*u,t[5]=p*l+d,t[9]=h*l-f,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var _=o*a,b=o*l,x=s*a,w=s*l;t[0]=a*c,t[4]=w-_*u,t[8]=x*u+b,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=b*u+x,t[10]=_-w*u}else if("XZY"===e.order){_=o*a,b=o*l,x=s*a,w=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=_*u+w,t[5]=o*c,t[9]=b*u-x,t[2]=x*u-b,t[6]=s*c,t[10]=w*u+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return q.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,o=e.w,s=n+n,a=r+r,l=i+i,c=n*s,u=n*a,d=n*l,h=r*a,f=r*l,p=i*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(h+p),t[4]=u-v,t[8]=d+g,t[1]=u+v,t[5]=1-(c+p),t[9]=f-m,t[2]=d-g,t[6]=f+m,t[10]=1-(c+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new q.Vector3,t=new q.Vector3,n=new q.Vector3;return function(r,i,o){var s=this.elements;return n.subVectors(r,i).normalize(),0===n.length()&&(n.z=1),e.crossVectors(o,n).normalize(),0===e.length()&&(n.x+=1e-4,e.crossVectors(o,n).normalize()),t.crossVectors(n,e),s[0]=e.x,s[4]=t.x,s[8]=n.x,s[1]=e.y,s[5]=t.y,s[9]=n.y,s[2]=e.z,s[6]=t.z,s[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(q.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=r[0],w=r[4],E=r[8],A=r[12],M=r[1],S=r[5],T=r[9],C=r[13],P=r[2],L=r[6],D=r[10],R=r[14],I=r[3],j=r[7],O=r[11],N=r[15];return i[0]=o*x+s*M+a*P+l*I,i[4]=o*w+s*S+a*L+l*j,i[8]=o*E+s*T+a*D+l*O,i[12]=o*A+s*C+a*R+l*N,i[1]=c*x+u*M+d*P+h*I,i[5]=c*w+u*S+d*L+h*j,i[9]=c*E+u*T+d*D+h*O,i[13]=c*A+u*C+d*R+h*N,i[2]=f*x+p*M+m*P+g*I,i[6]=f*w+p*S+m*L+g*j,i[10]=f*E+p*T+m*D+g*O,i[14]=f*A+p*C+m*R+g*N,i[3]=v*x+y*M+_*P+b*I,i[7]=v*w+y*S+_*L+b*j,i[11]=v*E+y*T+_*D+b*O,i[15]=v*A+y*C+_*R+b*N,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return q.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return q.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return q.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new q.Vector3;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var i=0,o=n;i<r;i+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){q.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return q.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+i*a*u-r*l*u-i*s*d+n*l*d+r*s*h-n*a*h)+e[7]*(+t*a*h-t*l*d+i*o*d-r*o*h+r*l*c-i*a*c)+e[11]*(+t*l*u-t*s*h-i*o*u+n*o*h+i*s*c-n*l*c)+e[15]*(-r*s*c-t*a*u+t*s*d+r*o*u-n*o*d+n*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new q.Vector3;return function(){q.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[4],s=r[8],a=r[12],l=r[1],c=r[5],u=r[9],d=r[13],h=r[2],f=r[6],p=r[10],m=r[14],g=r[3],v=r[7],y=r[11],_=r[15];n[0]=u*m*v-d*p*v+d*f*y-c*m*y-u*f*_+c*p*_,n[4]=a*p*v-s*m*v-a*f*y+o*m*y+s*f*_-o*p*_,n[8]=s*d*v-a*u*v+a*c*y-o*d*y-s*c*_+o*u*_,n[12]=a*u*f-s*d*f-a*c*p+o*d*p+s*c*m-o*u*m,n[1]=d*p*g-u*m*g-d*h*y+l*m*y+u*h*_-l*p*_,n[5]=s*m*g-a*p*g+a*h*y-i*m*y-s*h*_+i*p*_,n[9]=a*u*g-s*d*g-a*l*y+i*d*y+s*l*_-i*u*_,n[13]=s*d*h-a*u*h+a*l*p-i*d*p-s*l*m+i*u*m,n[2]=c*m*g-d*f*g+d*h*v-l*m*v-c*h*_+l*f*_,n[6]=a*f*g-o*m*g-a*h*v+i*m*v+o*h*_-i*f*_,n[10]=o*d*g-a*c*g+a*l*v-i*d*v-o*l*_+i*c*_,n[14]=a*c*h-o*d*h-a*l*f+i*d*f+o*l*m-i*c*m,n[3]=u*f*g-c*p*g-u*h*v+l*p*v+c*h*y-l*f*y,n[7]=o*p*g-s*f*g+s*h*v-i*p*v-o*h*y+i*f*y,n[11]=s*c*g-o*u*g-s*l*v+i*u*v+o*l*y-i*c*y,n[15]=o*u*h-s*c*h+s*l*f-i*u*f-o*l*p+i*c*p;var b=i*n[0]+l*n[4]+h*n[8]+g*n[12];if(0==b){var x="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return q.warn(x),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){q.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){q.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){q.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){q.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){q.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+n,l*s-r*a,l*a+r*s,0,l*s+r*a,c*s+n,c*a-r*o,0,l*a-r*s,c*a+r*o,i*a*a+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new q.Vector3,t=new q.Matrix4;return function(n,r,i){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),n.x=o[12],n.y=o[13],n.z=o[14],t.elements.set(this.elements);var c=1/s,u=1/a,d=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,r.setFromRotationMatrix(t),i.x=s,i.y=a,i.z=l,this}}(),makeFrustum:function(e,t,n,r,i,o){var s=this.elements,a=2*i/(t-e),l=2*i/(r-n),c=(t+e)/(t-e),u=(r+n)/(r-n),d=-(o+i)/(o-i),h=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=d,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,n,r){var i=n*Math.tan(q.Math.degToRad(.5*e)),o=-i,s=o*t,a=i*t;return this.makeFrustum(s,a,o,i,n,r)},makeOrthographic:function(e,t,n,r,i,o){var s=this.elements,a=t-e,l=n-r,c=o-i,u=(t+e)/a,d=(n+r)/l,h=(o+i)/c;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-d,s[2]=0,s[6]=0,s[10]=-2/c,s[14]=-h,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new q.Matrix4).fromArray(this.elements)}},q.Ray=function(e,t){this.origin=void 0!==e?e:new q.Vector3,this.direction=void 0!==t?t:new q.Vector3},q.Ray.prototype={constructor:q.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new q.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new q.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new q.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new q.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:(f=new q.Vector3,p=new q.Vector3,m=new q.Vector3,function(e,t,n,r){f.copy(e).add(t).multiplyScalar(.5),p.copy(t).sub(e).normalize(),m.copy(this.origin).sub(f);var i,o,s,a,l=.5*e.distanceTo(t),c=-this.direction.dot(p),u=m.dot(this.direction),d=-m.dot(p),h=m.lengthSq(),g=Math.abs(1-c*c);if(g>0)if(o=c*u-d,a=l*g,(i=c*d-u)>=0)if(o>=-a)if(o<=a){var v=1/g;s=(i*=v)*(i+c*(o*=v)+2*u)+o*(c*i+o+2*d)+h}else o=l,s=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*d)+h;else o=-l,s=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*d)+h;else o<=-a?s=-(i=Math.max(0,-(-c*l+u)))*i+(o=i>0?-l:Math.min(Math.max(-l,-d),l))*(o+2*d)+h:o<=a?(i=0,s=(o=Math.min(Math.max(-l,-d),l))*(o+2*d)+h):s=-(i=Math.max(0,-(c*l+u)))*i+(o=i>0?l:Math.min(Math.max(-l,-d),l))*(o+2*d)+h;else o=c>0?-l:l,s=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*d)+h;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(p).multiplyScalar(o).add(f),s}),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new q.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),i=e.dot(e)-r*r,o=t.radius*t.radius;if(i>o)return null;var s=Math.sqrt(o-i),a=r-s,l=r+s;return a<0&&l<0?null:a<0?this.at(l,n):this.at(a,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:(h=new q.Vector3,function(e){return null!==this.intersectBox(e,h)}),intersectBox:function(e,t){var n,r,i,o,s,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),c>=0?(i=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(i=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(e.min.z-d.z)*u,a=(e.max.z-d.z)*u):(s=(e.max.z-d.z)*u,a=(e.min.z-d.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))},intersectTriangle:function(){var e=new q.Vector3,t=new q.Vector3,n=new q.Vector3,r=new q.Vector3;return function(i,o,s,a,l){t.subVectors(o,i),n.subVectors(s,i),r.crossVectors(t,n);var c,u=this.direction.dot(r);if(u>0){if(a)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,i);var d=c*this.direction.dot(n.crossVectors(e,n));if(d<0)return null;var h=c*this.direction.dot(t.cross(e));if(h<0)return null;if(d+h>u)return null;var f=-c*e.dot(r);return f<0?null:this.at(f/u,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new q.Ray).copy(this)}},q.Sphere=function(e,t){this.center=void 0!==e?e:new q.Vector3,this.radius=void 0!==t?t:0},q.Sphere.prototype={constructor:q.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(g=new q.Box3,function(e,t){var n=this.center;void 0!==t?n.copy(t):g.setFromPoints(e).center(n);for(var r=0,i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new q.Vector3;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new q.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new q.Sphere).copy(this)}},q.Frustum=function(e,t,n,r,i,o){this.planes=[void 0!==e?e:new q.Plane,void 0!==t?t:new q.Plane,void 0!==n?n:new q.Plane,void 0!==r?r:new q.Plane,void 0!==i?i:new q.Plane,void 0!==o?o:new q.Plane]},q.Frustum.prototype={constructor:q.Frustum,set:function(e,t,n,r,i,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],d=n[8],h=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(s-r,u-a,p-d,y-m).normalize(),t[1].setComponents(s+r,u+a,p+d,y+m).normalize(),t[2].setComponents(s+i,u+l,p+h,y+g).normalize(),t[3].setComponents(s-i,u-l,p-h,y-g).normalize(),t[4].setComponents(s-o,u-c,p-f,y-v).normalize(),t[5].setComponents(s+o,u+c,p+f,y+v).normalize(),this},intersectsObject:(_=new q.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),_.copy(t.boundingSphere),_.applyMatrix4(e.matrixWorld),this.intersectsSphere(_)}),intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:(v=new q.Vector3,y=new q.Vector3,function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];v.x=r.normal.x>0?e.min.x:e.max.x,y.x=r.normal.x>0?e.max.x:e.min.x,v.y=r.normal.y>0?e.min.y:e.max.y,y.y=r.normal.y>0?e.max.y:e.min.y,v.z=r.normal.z>0?e.min.z:e.max.z,y.z=r.normal.z>0?e.max.z:e.min.z;var i=r.distanceToPoint(v),o=r.distanceToPoint(y);if(i<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new q.Frustum).copy(this)}},q.Plane=function(e,t){this.normal=void 0!==e?e:new q.Vector3(1,0,0),this.constant=void 0!==t?t:0},q.Plane.prototype={constructor:q.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new q.Vector3,t=new q.Vector3;return function(n,r,i){var o=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);return(t||new q.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new q.Vector3;return function(t,n){var r=n||new q.Vector3,i=t.delta(e),o=this.normal.dot(i);if(0==o)return 0==this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?void 0:r.copy(i).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){return(e||new q.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new q.Vector3,t=new q.Vector3,n=new q.Matrix3;return function(r,i){var o=i||n.getNormalMatrix(r),s=e.copy(this.normal).applyMatrix3(o);s.normalize();var a=this.coplanarPoint(t);return a.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(s,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new q.Plane).copy(this)}},q.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),r=0;return function(){for(var i=0;i<36;i++)8==i||13==i||18==i||23==i?n[i]="-":14==i?n[i]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,n[i]=t[19==i?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:(x=Math.PI/180,function(e){return e*x}),radToDeg:(b=180/Math.PI,function(e){return e*b}),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},q.Spline=function(e){this.points=e;var t,n,r,i,o,s,a,l,c,u=[],d={x:0,y:0,z:0};function h(e,t,n,r,i,o,s){var a=.5*(n-e),l=.5*(r-t);return(2*(t-n)+a+l)*s+(-3*(t-n)-2*a-l)*o+a*i+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,n=Math.floor(t),r=t-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?this.points.length-1:n+1,u[3]=n>this.points.length-3?this.points.length-1:n+2,s=this.points[u[0]],a=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],o=r*(i=r*r),d.x=h(s.x,a.x,l.x,c.x,r,i,o),d.y=h(s.y,a.y,l.y,c.y,r,i,o),d.z=h(s.z,a.z,l.z,c.z,r,i,o),d},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i,o=0,s=0,a=0,l=new q.Vector3,c=new q.Vector3,u=[],d=0;for(u[0]=0,e||(e=100),r=this.points.length*e,l.copy(this.points[0]),t=1;t<r;t++)n=t/r,i=this.getPoint(n),c.copy(i),d+=c.distanceTo(l),l.copy(i),o=(this.points.length-1)*n,(s=Math.floor(o))!=a&&(u[s]=d,a=s);return u[u.length]=d,{chunks:u,total:d}},this.reparametrizeByArcLength=function(e){var t,n,r,i,o,s,a,l,c=[],u=new q.Vector3,d=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=d.chunks[t]-d.chunks[t-1],a=Math.ceil(e*s/d.total),i=(t-1)/(this.points.length-1),o=t/(this.points.length-1),n=1;n<a-1;n++)r=i+n*(1/a)*(o-i),l=this.getPoint(r),c.push(u.copy(l).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},q.Triangle=function(e,t,n){this.a=void 0!==e?e:new q.Vector3,this.b=void 0!==t?t:new q.Vector3,this.c=void 0!==n?n:new q.Vector3},q.Triangle.normal=(w=new q.Vector3,function(e,t,n,r){var i=r||new q.Vector3;i.subVectors(n,t),w.subVectors(e,t),i.cross(w);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}),q.Triangle.barycoordFromPoint=function(){var e=new q.Vector3,t=new q.Vector3,n=new q.Vector3;return function(r,i,o,s,a){e.subVectors(s,i),t.subVectors(o,i),n.subVectors(r,i);var l=e.dot(e),c=e.dot(t),u=e.dot(n),d=t.dot(t),h=t.dot(n),f=l*d-c*c,p=a||new q.Vector3;if(0==f)return p.set(-2,-1,-1);var m=1/f,g=(d*u-c*h)*m,v=(l*h-c*u)*m;return p.set(1-g-v,v,g)}}(),q.Triangle.containsPoint=function(){var e=new q.Vector3;return function(t,n,r,i){var o=q.Triangle.barycoordFromPoint(t,n,r,i,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),q.Triangle.prototype={constructor:q.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new q.Vector3,t=new q.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new q.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return q.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new q.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return q.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return q.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new q.Triangle).copy(this)}},q.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},q.Clock.prototype={constructor:q.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},q.EventDispatcher=function(){},q.EventDispatcher.prototype={constructor:q.EventDispatcher,apply:function(e){e.addEventListener=q.EventDispatcher.prototype.addEventListener,e.hasEventListener=q.EventDispatcher.prototype.hasEventListener,e.removeEventListener=q.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=q.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=[],r=t.length,i=0;i<r;i++)n[i]=t[i];for(i=0;i<r;i++)n[i].call(this,e)}}}},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},n=function(e,t,r,i){if(e.raycast(t,r),!0===i)for(var o=e.children,s=0,a=o.length;s<a;s++)n(o[s],t,r,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,n){n instanceof e.PerspectiveCamera?(this.ray.origin.copy(n.position),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(n.position).normalize()):n instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,r){var i=[];return n(e,this,i,r),i.sort(t),i},intersectObjects:function(r,i){var o=[];if(r instanceof Array==!1)return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var s=0,a=r.length;s<a;s++)n(r[s],this,o,i);return o.sort(t),o}}}(q),q.Object3D=function(){Object.defineProperty(this,"id",{value:q.Object3DIdCount++}),this.uuid=q.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=q.Object3D.DefaultUp.clone();var e=new q.Vector3,t=new q.Euler,n=new q.Quaternion,r=new q.Vector3(1,1,1);t.onChange((function(){n.setFromEuler(t,!1)})),n.onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r}}),this.rotationAutoUpdate=!0,this.matrix=new q.Matrix4,this.matrixWorld=new q.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},q.Object3D.DefaultUp=new q.Vector3(0,1,0),q.Object3D.prototype={constructor:q.Object3D,get eulerOrder(){return q.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){q.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){q.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){q.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(S=new q.Quaternion,function(e,t){return S.setFromAxisAngle(e,t),this.quaternion.multiply(S),this}),rotateX:function(){var e=new q.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new q.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new q.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new q.Vector3;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return q.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new q.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new q.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new q.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(M=new q.Matrix4,function(e){return e.applyMatrix4(M.getInverse(this.matrixWorld))}),lookAt:function(){var e=new q.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(q.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof q.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):q.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var n=this.children.indexOf(e);-1!==n&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(e){return q.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){var t=e||new q.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(E=new q.Vector3,A=new q.Vector3,function(e){var t=e||new q.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(E,t,A),t}),getWorldRotation:function(){var e=new q.Quaternion;return function(t){var n=t||new q.Euler;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new q.Vector3,t=new q.Quaternion;return function(n){var r=n||new q.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new q.Quaternion;return function(t){var n=t||new q.Vector3;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},n={},r=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===n[t.uuid]){var r=t.toJSON();delete r.metadata,n[t.uuid]=r,e.materials.push(r)}return t.uuid};return e.object=function n(i){var o={};if(o.uuid=i.uuid,o.type=i.type,""!==i.name&&(o.name=i.name),"{}"!==JSON.stringify(i.userData)&&(o.userData=i.userData),!0!==i.visible&&(o.visible=i.visible),i instanceof q.PerspectiveCamera?(o.fov=i.fov,o.aspect=i.aspect,o.near=i.near,o.far=i.far):i instanceof q.OrthographicCamera?(o.left=i.left,o.right=i.right,o.top=i.top,o.bottom=i.bottom,o.near=i.near,o.far=i.far):i instanceof q.AmbientLight?o.color=i.color.getHex():i instanceof q.DirectionalLight?(o.color=i.color.getHex(),o.intensity=i.intensity):i instanceof q.PointLight?(o.color=i.color.getHex(),o.intensity=i.intensity,o.distance=i.distance,o.decay=i.decay):i instanceof q.SpotLight?(o.color=i.color.getHex(),o.intensity=i.intensity,o.distance=i.distance,o.angle=i.angle,o.exponent=i.exponent,o.decay=i.decay):i instanceof q.HemisphereLight?(o.color=i.color.getHex(),o.groundColor=i.groundColor.getHex()):i instanceof q.Mesh||i instanceof q.Line||i instanceof q.PointCloud?(o.geometry=function(n){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[n.uuid]){var r=n.toJSON();delete r.metadata,t[n.uuid]=r,e.geometries.push(r)}return n.uuid}(i.geometry),o.material=r(i.material),i instanceof q.Line&&(o.mode=i.mode)):i instanceof q.Sprite&&(o.material=r(i.material)),o.matrix=i.matrix.toArray(),i.children.length>0){o.children=[];for(var s=0;s<i.children.length;s++)o.children.push(n(i.children[s]))}return o}(this),e},clone:function(e,t){if(void 0===e&&(e=new q.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var n=0;n<this.children.length;n++){var r=this.children[n];e.add(r.clone())}return e}},q.EventDispatcher.prototype.apply(q.Object3D.prototype),q.Object3DIdCount=0,q.Face3=function(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r instanceof q.Vector3?r:new q.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof q.Color?i:new q.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},q.Face3.prototype={constructor:q.Face3,clone:function(){var e=new q.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},q.Face4=function(e,t,n,r,i,o,s){return q.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new q.Face3(e,t,n,i,o,s)},q.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.needsUpdate=!1},q.BufferAttribute.prototype={constructor:q.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},clone:function(){return new q.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},q.Int8Attribute=function(e,t){return q.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Uint8Attribute=function(e,t){return q.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Uint8ClampedAttribute=function(e,t){return q.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Int16Attribute=function(e,t){return q.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Uint16Attribute=function(e,t){return q.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Int32Attribute=function(e,t){return q.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Uint32Attribute=function(e,t){return q.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Float32Attribute=function(e,t){return q.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.Float64Attribute=function(e,t){return q.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new q.BufferAttribute(e,t)},q.DynamicBufferAttribute=function(e,t){q.BufferAttribute.call(this,e,t),this.updateRange={offset:0,count:-1}},q.DynamicBufferAttribute.prototype=Object.create(q.BufferAttribute.prototype),q.DynamicBufferAttribute.prototype.constructor=q.DynamicBufferAttribute,q.DynamicBufferAttribute.prototype.clone=function(){return new q.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},q.BufferGeometry=function(){Object.defineProperty(this,"id",{value:q.GeometryIdCount++}),this.uuid=q.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},q.BufferGeometry.prototype={constructor:q.BufferGeometry,addAttribute:function(e,t){if(t instanceof q.BufferAttribute==!1)return q.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]});this.attributes[e]=t,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:void 0!==n?n:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new q.Matrix3).getNormalMatrix(e).applyToVector3Array(n.array),n.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new q.Matrix4).setPosition(e)),e},fromGeometry:function(e,t){t=t||{vertexColors:q.NoColors};var n=e.vertices,r=e.faces,i=e.faceVertexUvs,o=t.vertexColors,s=i[0].length>0,a=3==r[0].vertexNormals.length,l=new Float32Array(3*r.length*3);this.addAttribute("position",new q.BufferAttribute(l,3));var c=new Float32Array(3*r.length*3);if(this.addAttribute("normal",new q.BufferAttribute(c,3)),o!==q.NoColors){var u=new Float32Array(3*r.length*3);this.addAttribute("color",new q.BufferAttribute(u,3))}if(!0===s){var d=new Float32Array(3*r.length*2);this.addAttribute("uv",new q.BufferAttribute(d,2))}for(var h=0,f=0,p=0;h<r.length;h++,f+=6,p+=9){var m=r[h],g=n[m.a],v=n[m.b],y=n[m.c];if(l[p]=g.x,l[p+1]=g.y,l[p+2]=g.z,l[p+3]=v.x,l[p+4]=v.y,l[p+5]=v.z,l[p+6]=y.x,l[p+7]=y.y,l[p+8]=y.z,!0===a){var _=m.vertexNormals[0],b=m.vertexNormals[1],x=m.vertexNormals[2];c[p]=_.x,c[p+1]=_.y,c[p+2]=_.z,c[p+3]=b.x,c[p+4]=b.y,c[p+5]=b.z,c[p+6]=x.x,c[p+7]=x.y,c[p+8]=x.z}else{var w=m.normal;c[p]=w.x,c[p+1]=w.y,c[p+2]=w.z,c[p+3]=w.x,c[p+4]=w.y,c[p+5]=w.z,c[p+6]=w.x,c[p+7]=w.y,c[p+8]=w.z}if(o===q.FaceColors){var E=m.color;u[p]=E.r,u[p+1]=E.g,u[p+2]=E.b,u[p+3]=E.r,u[p+4]=E.g,u[p+5]=E.b,u[p+6]=E.r,u[p+7]=E.g,u[p+8]=E.b}else if(o===q.VertexColors){var A=m.vertexColors[0],M=m.vertexColors[1],S=m.vertexColors[2];u[p]=A.r,u[p+1]=A.g,u[p+2]=A.b,u[p+3]=M.r,u[p+4]=M.g,u[p+5]=M.b,u[p+6]=S.r,u[p+7]=S.g,u[p+8]=S.b}if(!0===s){var T=i[0][h][0],C=i[0][h][1],P=i[0][h][2];d[f]=T.x,d[f+1]=T.y,d[f+2]=C.x,d[f+3]=C.y,d[f+4]=P.x,d[f+5]=P.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new q.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new q.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox;n.makeEmpty();for(var r=0,i=t.length;r<i;r+=3)e.set(t[r],t[r+1],t[r+2]),n.expandByPoint(e)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&q.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new q.Box3,t=new q.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new q.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var r=this.boundingSphere.center,i=0,o=n.length;i<o;i+=3)t.set(n[i],n[i+1],n[i+2]),e.expandByPoint(t);e.center(r);var s=0;for(i=0,o=n.length;i<o;i+=3)t.set(n[i],n[i+1],n[i+2]),s=Math.max(s,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&q.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new q.BufferAttribute(new Float32Array(t.length),3));else for(var n=0,r=(a=e.normal.array).length;n<r;n++)a[n]=0;var i,o,s,a=e.normal.array,l=new q.Vector3,c=new q.Vector3,u=new q.Vector3,d=new q.Vector3,h=new q.Vector3;if(e.index)for(var f=e.index.array,p=this.offsets.length>0?this.offsets:[{start:0,count:f.length,index:0}],m=0,g=p.length;m<g;++m){var v=p[m].start,y=p[m].count,_=p[m].index;for(n=v,r=v+y;n<r;n+=3)i=3*(_+f[n]),o=3*(_+f[n+1]),s=3*(_+f[n+2]),l.fromArray(t,i),c.fromArray(t,o),u.fromArray(t,s),d.subVectors(u,c),h.subVectors(l,c),d.cross(h),a[i]+=d.x,a[i+1]+=d.y,a[i+2]+=d.z,a[o]+=d.x,a[o+1]+=d.y,a[o+2]+=d.z,a[s]+=d.x,a[s+1]+=d.y,a[s+2]+=d.z}else for(n=0,r=t.length;n<r;n+=9)l.fromArray(t,n),c.fromArray(t,n+3),u.fromArray(t,n+6),d.subVectors(u,c),h.subVectors(l,c),d.cross(h),a[n]=d.x,a[n+1]=d.y,a[n+2]=d.z,a[n+3]=d.x,a[n+4]=d.y,a[n+5]=d.z,a[n+6]=d.x,a[n+7]=d.y,a[n+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,n=this.attributes.normal.array,r=this.attributes.uv.array,i=t.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new q.BufferAttribute(new Float32Array(4*i),4));for(var o=this.attributes.tangent.array,s=[],a=[],l=0;l<i;l++)s[l]=new q.Vector3,a[l]=new q.Vector3;var c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S,T=new q.Vector3,C=new q.Vector3,P=new q.Vector3,L=new q.Vector2,D=new q.Vector2,R=new q.Vector2,I=new q.Vector3,j=new q.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,e.length,0);var O,N,k,F=this.drawcalls;for(w=0,E=F.length;w<E;++w){var V=F[w].start,B=F[w].count,U=F[w].index;for(b=V,x=V+B;b<x;b+=3)A=U+e[b],M=U+e[b+1],S=U+e[b+2],O=A,N=M,k=S,T.fromArray(t,3*O),C.fromArray(t,3*N),P.fromArray(t,3*k),L.fromArray(r,2*O),D.fromArray(r,2*N),R.fromArray(r,2*k),c=C.x-T.x,u=P.x-T.x,d=C.y-T.y,h=P.y-T.y,f=C.z-T.z,p=P.z-T.z,m=D.x-L.x,g=R.x-L.x,v=D.y-L.y,y=R.y-L.y,_=1/(m*y-g*v),I.set((y*c-v*u)*_,(y*d-v*h)*_,(y*f-v*p)*_),j.set((m*u-g*c)*_,(m*h-g*d)*_,(m*p-g*f)*_),s[O].add(I),s[N].add(I),s[k].add(I),a[O].add(j),a[N].add(j),a[k].add(j)}var z,G,H,W=new q.Vector3,X=new q.Vector3,Y=new q.Vector3,K=new q.Vector3;for(w=0,E=F.length;w<E;++w){V=F[w].start,B=F[w].count,U=F[w].index;for(b=V,x=V+B;b<x;b+=3)A=U+e[b],M=U+e[b+1],S=U+e[b+2],Q(A),Q(M),Q(S)}}else q.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function Q(e){Y.fromArray(n,3*e),K.copy(Y),G=s[e],W.copy(G),W.sub(Y.multiplyScalar(Y.dot(G))).normalize(),X.crossVectors(K,G),H=X.dot(a[e]),z=H<0?-1:1,o[4*e]=W.x,o[4*e+1]=W.y,o[4*e+2]=W.z,o[4*e+3]=z}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,n=this.attributes.position.array,r=t.length/3,i=new Uint16Array(t.length),o=0,s=0,a=[{start:0,count:0,index:0}],l=a[0],c=0,u=new Int32Array(6),d=new Int32Array(n.length),h=new Int32Array(n.length),f=0;f<n.length;f++)d[f]=-1,h[f]=-1;for(var p=0;p<r;p++){c=0;for(var m=0;m<3;m++){-1==d[_=t[3*p+m]]?(u[2*m]=_,u[2*m+1]=-1,c++):d[_]<l.index?(u[2*m]=_,u[2*m+1]=-1):(u[2*m]=_,u[2*m+1]=d[_])}if(s+c>l.index+e){var g={start:o,count:0,index:s};a.push(g),l=g;for(var v=0;v<6;v+=2){(y=u[v+1])>-1&&y<l.index&&(u[v+1]=-1)}}for(v=0;v<6;v+=2){var y,_=u[v];-1===(y=u[v+1])&&(y=s++),d[_]=y,h[y]=_,i[o++]=y-l.index,l.count++}}return this.reorderBuffers(i,h,s),this.offsets=a,this.drawcalls=a,a},merge:function(e,t){if(e instanceof q.BufferGeometry!=!1){void 0===t&&(t=0);var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,o=e.attributes[r],s=o.array,a=0,l=o.itemSize*t;a<s.length;a++,l++)i[l]=s[a];return this}q.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,n,r,i=this.attributes.normal.array,o=0,s=i.length;o<s;o+=3)e=i[o],t=i[o+1],n=i[o+2],r=1/Math.sqrt(e*e+t*t+n*n),i[o]*=r,i[o+1]*=r,i[o+2]*=r},reorderBuffers:function(e,t,n){var r={};for(var i in this.attributes)if("index"!=i){var o=this.attributes[i].array;r[i]=new o.constructor(this.attributes[i].itemSize*n)}for(var s=0;s<n;s++){var a=t[s];for(var i in this.attributes)if("index"!=i)for(var l=this.attributes[i].array,c=this.attributes[i].itemSize,u=r[i],d=0;d<c;d++)u[s*c+d]=l[a*c+d]}for(var i in this.attributes.index.array=e,this.attributes)"index"!=i&&(this.attributes[i].array=r[i],this.attributes[i].numItems=this.attributes[i].itemSize*n)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,n=this.offsets,r=this.boundingSphere;for(var i in t){var o=t[i],s=Array.prototype.slice.call(o.array);e.data.attributes[i]={itemSize:o.itemSize,type:o.array.constructor.name,array:s}}return n.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(n))),null!==r&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e},clone:function(){var e=new q.BufferGeometry;for(var t in this.attributes){var n=this.attributes[t];e.addAttribute(t,n.clone())}for(var r=0,i=this.offsets.length;r<i;r++){var o=this.offsets[r];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},q.EventDispatcher.prototype.apply(q.BufferGeometry.prototype),q.Geometry=function(){Object.defineProperty(this,"id",{value:q.GeometryIdCount++}),this.uuid=q.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},q.Geometry.prototype={constructor:q.Geometry,applyMatrix:function(e){for(var t=(new q.Matrix3).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var o=0,s=i.vertexNormals.length;o<s;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,n=e.attributes,r=n.position.array,i=void 0!==n.index?n.index.array:void 0,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,a=void 0!==n.uv?n.uv.array:void 0,l=[],c=[],u=0,d=0;u<r.length;u+=3,d+=2)t.vertices.push(new q.Vector3(r[u],r[u+1],r[u+2])),void 0!==o&&l.push(new q.Vector3(o[u],o[u+1],o[u+2])),void 0!==s&&t.colors.push(new q.Color(s[u],s[u+1],s[u+2])),void 0!==a&&c.push(new q.Vector2(a[d],a[d+1]));var h=function(e,n,r){var i=void 0!==o?[l[e].clone(),l[n].clone(),l[r].clone()]:[],u=void 0!==s?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[];t.faces.push(new q.Face3(e,n,r,i,u)),void 0!==a&&t.faceVertexUvs[0].push([c[e].clone(),c[n].clone(),c[r].clone()])};if(void 0!==i){var f=e.drawcalls;if(f.length>0)for(u=0;u<f.length;u++)for(var p=f[u],m=p.start,g=p.count,v=p.index,y=(d=m,m+g);d<y;d+=3)h(v+i[d],v+i[d+1],v+i[d+2]);else for(u=0;u<i.length;u+=3)h(i[u],i[u+1],i[u+2])}else for(u=0;u<r.length/3;u+=3)h(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new q.Matrix4).setPosition(e)),e},computeFaceNormals:function(){for(var e=new q.Vector3,t=new q.Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,o,s;for(s=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)s[t]=new q.Vector3;if(e){var a,l,c,u=new q.Vector3,d=new q.Vector3;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],a=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),d.subVectors(a,l),u.cross(d),s[o.a].add(u),s[o.b].add(u),s[o.c].add(u)}else for(r=0,i=this.faces.length;r<i;r++)s[(o=this.faces[r]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)s[t].normalize();for(r=0,i=this.faces.length;r<i;r++)(o=this.faces[r]).vertexNormals[0]=s[o.a].clone(),o.vertexNormals[1]=s[o.b].clone(),o.vertexNormals[2]=s[o.c].clone()},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new q.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)l=new q.Vector3,c={a:new q.Vector3,b:new q.Vector3,c:new q.Vector3},s.push(l),a.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){var e,t,n,r,i,o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S,T,C,P,L,D,R,I,j=[],O=[],N=new q.Vector3,k=new q.Vector3,F=new q.Vector3,V=new q.Vector3,B=new q.Vector3;for(n=0,r=this.vertices.length;n<r;n++)j[n]=new q.Vector3,O[n]=new q.Vector3;for(e=0,t=this.faces.length;e<t;e++)s=this.faces[e],a=this.faceVertexUvs[0][e],T=this,C=s.a,P=s.b,L=s.c,D=0,R=1,I=2,l=T.vertices[C],c=T.vertices[P],u=T.vertices[L],d=a[D],h=a[R],f=a[I],p=c.x-l.x,m=u.x-l.x,g=c.y-l.y,v=u.y-l.y,y=c.z-l.z,_=u.z-l.z,b=h.x-d.x,x=f.x-d.x,w=h.y-d.y,E=f.y-d.y,A=1/(b*E-x*w),N.set((E*p-w*m)*A,(E*g-w*v)*A,(E*y-w*_)*A),k.set((b*m-x*p)*A,(b*v-x*g)*A,(b*_-x*y)*A),j[C].add(N),j[P].add(N),j[L].add(N),O[C].add(k),O[P].add(k),O[L].add(k);var U=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(s=this.faces[e],i=0;i<Math.min(s.vertexNormals.length,3);i++)B.copy(s.vertexNormals[i]),o=s[U[i]],M=j[o],F.copy(M),F.sub(B.multiplyScalar(B.dot(M))).normalize(),V.crossVectors(s.vertexNormals[i],M),S=V.dot(O[o])<0?-1:1,s.vertexTangents[i]=new q.Vector4(F.x,F.y,F.z,S);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,r=t.length;n<r;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new q.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new q.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof q.Geometry!=!1){var r,i=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0];void 0===n&&(n=0),void 0!==t&&(r=(new q.Matrix3).getNormalMatrix(t));for(var d=0,h=s.length;d<h;d++){var f=s[d].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(d=0,h=l.length;d<h;d++){var p,m,g,v=l[d],y=v.vertexNormals,_=v.vertexColors;(p=new q.Face3(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==r&&p.normal.applyMatrix3(r).normalize();for(var b=0,x=y.length;b<x;b++)m=y[b].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),p.vertexNormals.push(m);p.color.copy(v.color);for(b=0,x=_.length;b<x;b++)g=_[b],p.vertexColors.push(g.clone());p.materialIndex=v.materialIndex+n,a.push(p)}for(d=0,h=u.length;d<h;d++){var w=u[d],E=[];if(void 0!==w){for(b=0,x=w.length;b<x;b++)E.push(w[b].clone());c.push(E)}}}else q.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e instanceof q.Mesh!=!1?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):q.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,o,s,a,l={},c=[],u=[],d=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d)]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):u[n]=u[l[t]];var h=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]==o[(f+1)%3]){f,h.push(n);break}}for(n=h.length-1;n>=0;n--){var p=h[n];for(this.faces.splice(p,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(p,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var s=[],a=[],l={},c=[],u={},d=[],h={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,g=f.vertexNormals.length>0,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=E(_,0,0),_=E(_,1,!1),_=E(_,2,!1),_=E(_,3,p),_=E(_,4,m),_=E(_,5,g),_=E(_,6,v),_=E(_,7,y),s.push(_),s.push(f.a,f.b,f.c),p){var b=this.faceVertexUvs[0][i];s.push(S(b[0]),S(b[1]),S(b[2]))}if(m&&s.push(A(f.normal)),g){var x=f.vertexNormals;s.push(A(x[0]),A(x[1]),A(x[2]))}if(v&&s.push(M(f.color)),y){var w=f.vertexColors;s.push(M(w[0]),M(w[1]),M(w[2]))}}function E(e,t,n){return n?e|1<<t:e&~(1<<t)}function A(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=a.length/3,a.push(e.x,e.y,e.z)),l[t]}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=c.length,c.push(e.getHex())),u[t]}function S(e){var t=e.x.toString()+e.y.toString();return void 0!==h[t]||(h[t]=d.length/2,d.push(e.x,e.y)),h[t]}return e.data={},e.data.vertices=r,e.data.normals=a,c.length>0&&(e.data.colors=c),d.length>0&&(e.data.uvs=[d]),e.data.faces=s,e},clone:function(){for(var e=new q.Geometry,t=this.vertices,n=0,r=t.length;n<r;n++)e.vertices.push(t[n].clone());var i=this.faces;for(n=0,r=i.length;n<r;n++)e.faces.push(i[n].clone());for(n=0,r=this.faceVertexUvs.length;n<r;n++){var o=this.faceVertexUvs[n];void 0===e.faceVertexUvs[n]&&(e.faceVertexUvs[n]=[]);for(var s=0,a=o.length;s<a;s++){for(var l=o[s],c=[],u=0,d=l.length;u<d;u++){var h=l[u];c.push(h.clone())}e.faceVertexUvs[n].push(c)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},q.EventDispatcher.prototype.apply(q.Geometry.prototype),q.GeometryIdCount=0,q.Camera=function(){q.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new q.Matrix4,this.projectionMatrix=new q.Matrix4},q.Camera.prototype=Object.create(q.Object3D.prototype),q.Camera.prototype.constructor=q.Camera,q.Camera.prototype.getWorldDirection=function(){var e=new q.Quaternion;return function(t){var n=t||new q.Vector3;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),q.Camera.prototype.lookAt=function(){var e=new q.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),q.Camera.prototype.clone=function(e){return void 0===e&&(e=new q.Camera),q.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},q.CubeCamera=function(e,t,n){q.Object3D.call(this),this.type="CubeCamera";var r=new q.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new q.Vector3(1,0,0)),this.add(r);var i=new q.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new q.Vector3(-1,0,0)),this.add(i);var o=new q.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new q.Vector3(0,1,0)),this.add(o);var s=new q.PerspectiveCamera(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new q.Vector3(0,-1,0)),this.add(s);var a=new q.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new q.Vector3(0,0,1)),this.add(a);var l=new q.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new q.Vector3(0,0,-1)),this.add(l),this.renderTarget=new q.WebGLRenderTargetCube(n,n,{format:q.RGBFormat,magFilter:q.LinearFilter,minFilter:q.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,c=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,o,n),n.activeCubeFace=3,e.render(t,s,n),n.activeCubeFace=4,e.render(t,a,n),n.generateMipmaps=c,n.activeCubeFace=5,e.render(t,l,n)}},q.CubeCamera.prototype=Object.create(q.Object3D.prototype),q.CubeCamera.prototype.constructor=q.CubeCamera,q.OrthographicCamera=function(e,t,n,r,i,o){q.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},q.OrthographicCamera.prototype=Object.create(q.Camera.prototype),q.OrthographicCamera.prototype.constructor=q.OrthographicCamera,q.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,r+t,r-t,this.near,this.far)},q.OrthographicCamera.prototype.clone=function(){var e=new q.OrthographicCamera;return q.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},q.PerspectiveCamera=function(e,t,n,r){q.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},q.PerspectiveCamera.prototype=Object.create(q.Camera.prototype),q.PerspectiveCamera.prototype.constructor=q.PerspectiveCamera,q.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*q.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},q.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,o){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=o,this.updateProjectionMatrix()},q.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=q.Math.radToDeg(2*Math.atan(Math.tan(.5*q.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(q.Math.degToRad(.5*e))*this.near,r=-n,i=t*r,o=t*n,s=Math.abs(o-i),a=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*s/this.fullWidth,i+(this.x+this.width)*s/this.fullWidth,n-(this.y+this.height)*a/this.fullHeight,n-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},q.PerspectiveCamera.prototype.clone=function(){var e=new q.PerspectiveCamera;return q.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},q.Light=function(e){q.Object3D.call(this),this.type="Light",this.color=new q.Color(e)},q.Light.prototype=Object.create(q.Object3D.prototype),q.Light.prototype.constructor=q.Light,q.Light.prototype.clone=function(e){return void 0===e&&(e=new q.Light),q.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},q.AmbientLight=function(e){q.Light.call(this,e),this.type="AmbientLight"},q.AmbientLight.prototype=Object.create(q.Light.prototype),q.AmbientLight.prototype.constructor=q.AmbientLight,q.AmbientLight.prototype.clone=function(){var e=new q.AmbientLight;return q.Light.prototype.clone.call(this,e),e},q.AreaLight=function(e,t){q.Light.call(this,e),this.type="AreaLight",this.normal=new q.Vector3(0,-1,0),this.right=new q.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},q.AreaLight.prototype=Object.create(q.Light.prototype),q.AreaLight.prototype.constructor=q.AreaLight,q.DirectionalLight=function(e,t){q.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new q.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new q.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},q.DirectionalLight.prototype=Object.create(q.Light.prototype),q.DirectionalLight.prototype.constructor=q.DirectionalLight,q.DirectionalLight.prototype.clone=function(){var e=new q.DirectionalLight;return q.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},q.HemisphereLight=function(e,t,n){q.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new q.Color(t),this.intensity=void 0!==n?n:1},q.HemisphereLight.prototype=Object.create(q.Light.prototype),q.HemisphereLight.prototype.constructor=q.HemisphereLight,q.HemisphereLight.prototype.clone=function(){var e=new q.HemisphereLight;return q.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},q.PointLight=function(e,t,n,r){q.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1},q.PointLight.prototype=Object.create(q.Light.prototype),q.PointLight.prototype.constructor=q.PointLight,q.PointLight.prototype.clone=function(){var e=new q.PointLight;return q.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},q.SpotLight=function(e,t,n,r,i,o){q.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new q.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==i?i:10,this.decay=void 0!==o?o:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},q.SpotLight.prototype=Object.create(q.Light.prototype),q.SpotLight.prototype.constructor=q.SpotLight,q.SpotLight.prototype.clone=function(){var e=new q.SpotLight;return q.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},q.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},q.Loader=function(e){this.showStatus=e,this.statusDomElement=e?q.Loader.prototype.addStatusElement():null,this.imageLoader=new q.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},q.Loader.prototype={constructor:q.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++){if(e[t]instanceof q.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var n=this;function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function i(e,i,o,s,a,l,c){var u,d=t+o,h=q.Loader.Handlers.get(d);if(null!==h?u=h.load(d):(u=new q.Texture,(h=n.imageLoader).crossOrigin=n.crossOrigin,h.load(d,(function(e){if(!1===q.Math.isPowerOfTwo(e.width)||!1===q.Math.isPowerOfTwo(e.height)){var t=r(e.width),n=r(e.height),i=document.createElement("canvas");i.width=t,i.height=n,i.getContext("2d").drawImage(e,0,0,t,n),u.image=i}else u.image=e;u.needsUpdate=!0}))),u.sourceFile=o,s&&(u.repeat.set(s[0],s[1]),1!==s[0]&&(u.wrapS=q.RepeatWrapping),1!==s[1]&&(u.wrapT=q.RepeatWrapping)),a&&u.offset.set(a[0],a[1]),l){var f={repeat:q.RepeatWrapping,mirror:q.MirroredRepeatWrapping};void 0!==f[l[0]]&&(u.wrapS=f[l[0]]),void 0!==f[l[1]]&&(u.wrapT=f[l[1]])}c&&(u.anisotropy=c),e[i]=u}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}void 0!==e.blending&&void 0!==q[e.blending]&&(a.blending=q[e.blending]),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(a.transparent=!0),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.flipSided&&(a.side=q.BackSide),void 0!==e.doubleSided&&(a.side=q.DoubleSide),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?a.vertexColors=q.FaceColors:e.vertexColors&&(a.vertexColors=q.VertexColors)),e.colorDiffuse?a.color=o(e.colorDiffuse):e.DbgColor&&(a.color=e.DbgColor),e.colorSpecular&&(a.specular=o(e.colorSpecular)),e.colorEmissive&&(a.emissive=o(e.colorEmissive)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(a.opacity=e.opacity),e.specularCoef&&(a.shininess=e.specularCoef),e.mapDiffuse&&t&&i(a,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&i(a,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&i(a,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&i(a,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&i(a,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&i(a,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(a.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(a.normalScale=new q.Vector2(e.mapNormalFactor,e.mapNormalFactor));var c=new q[s](a);return void 0!==e.DbgName&&(c.name=e.DbgName),c}},q.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var r=this.handlers[t],i=this.handlers[t+1];if(r.test(e))return i}return null}},q.XHRLoader=function(e){this.manager=void 0!==e?e:q.DefaultLoadingManager},q.XHRLoader.prototype={constructor:q.XHRLoader,load:function(e,t,n,r){var i=this,o=q.Cache.get(e);if(void 0===o){var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",(function(n){q.Cache.add(e,this.response),t&&t(this.response),i.manager.itemEnd(e)}),!1),void 0!==n&&s.addEventListener("progress",(function(e){n(e)}),!1),void 0!==r&&s.addEventListener("error",(function(e){r(e)}),!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),s.send(null),i.manager.itemStart(e)}else t&&t(o)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},q.ImageLoader=function(e){this.manager=void 0!==e?e:q.DefaultLoadingManager},q.ImageLoader.prototype={constructor:q.ImageLoader,load:function(e,t,n,r){var i=this,o=q.Cache.get(e);if(void 0===o){var s=document.createElement("img");return s.addEventListener("load",(function(n){q.Cache.add(e,this),t&&t(this),i.manager.itemEnd(e)}),!1),void 0!==n&&s.addEventListener("progress",(function(e){n(e)}),!1),void 0!==r&&s.addEventListener("error",(function(e){r(e)}),!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,i.manager.itemStart(e),s}t(o)},setCrossOrigin:function(e){this.crossOrigin=e}},q.JSONLoader=function(e){q.Loader.call(this,e),this.withCredentials=!1},q.JSONLoader.prototype=Object.create(q.Loader.prototype),q.JSONLoader.prototype.constructor=q.JSONLoader,q.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},q.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var o=new XMLHttpRequest,s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var a=JSON.parse(o.responseText),l=a.metadata;if(void 0!==l){if("object"===l.type)return void q.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void q.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var c=e.parse(a,r);n(c.geometry,c.materials)}else q.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else q.error("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")");else o.readyState===o.LOADING?i&&(0===s&&(s=o.getResponseHeader("Content-Length")),i({total:s,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==i&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},q.JSONLoader.prototype.parse=function(e,t){var n=new q.Geometry,r=void 0!==e.scale?1/e.scale:1;if(function(t){function r(e,t){return e&1<<t}var i,o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S,T,C,P,L,D=e.faces,R=e.vertices,I=e.normals,j=e.colors,O=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&O++;for(i=0;i<O;i++)n.faceVertexUvs[i]=[]}a=0,l=R.length;for(;a<l;)(x=new q.Vector3).x=R[a++]*t,x.y=R[a++]*t,x.z=R[a++]*t,n.vertices.push(x);a=0,l=D.length;for(;a<l;)if(f=D[a++],p=r(f,0),m=r(f,1),g=r(f,3),v=r(f,4),y=r(f,5),_=r(f,6),b=r(f,7),p){if((E=new q.Face3).a=D[a],E.b=D[a+1],E.c=D[a+3],(A=new q.Face3).a=D[a+1],A.b=D[a+2],A.c=D[a+3],a+=4,m&&(h=D[a++],E.materialIndex=h,A.materialIndex=h),s=n.faces.length,g)for(i=0;i<O;i++)for(T=e.uvs[i],n.faceVertexUvs[i][s]=[],n.faceVertexUvs[i][s+1]=[],o=0;o<4;o++)d=D[a++],P=T[2*d],L=T[2*d+1],C=new q.Vector2(P,L),2!==o&&n.faceVertexUvs[i][s].push(C),0!==o&&n.faceVertexUvs[i][s+1].push(C);if(v&&(u=3*D[a++],E.normal.set(I[u++],I[u++],I[u]),A.normal.copy(E.normal)),y)for(i=0;i<4;i++)u=3*D[a++],S=new q.Vector3(I[u++],I[u++],I[u]),2!==i&&E.vertexNormals.push(S),0!==i&&A.vertexNormals.push(S);if(_&&(c=D[a++],M=j[c],E.color.setHex(M),A.color.setHex(M)),b)for(i=0;i<4;i++)c=D[a++],M=j[c],2!==i&&E.vertexColors.push(new q.Color(M)),0!==i&&A.vertexColors.push(new q.Color(M));n.faces.push(E),n.faces.push(A)}else{if((w=new q.Face3).a=D[a++],w.b=D[a++],w.c=D[a++],m&&(h=D[a++],w.materialIndex=h),s=n.faces.length,g)for(i=0;i<O;i++)for(T=e.uvs[i],n.faceVertexUvs[i][s]=[],o=0;o<3;o++)d=D[a++],P=T[2*d],L=T[2*d+1],C=new q.Vector2(P,L),n.faceVertexUvs[i][s].push(C);if(v&&(u=3*D[a++],w.normal.set(I[u++],I[u++],I[u])),y)for(i=0;i<3;i++)u=3*D[a++],S=new q.Vector3(I[u++],I[u++],I[u]),w.vertexNormals.push(S);if(_&&(c=D[a++],w.color.setHex(j[c])),b)for(i=0;i<3;i++)c=D[a++],w.vertexColors.push(new q.Color(j[c]));n.faces.push(w)}}(r),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;r<i;r+=t){var o=e.skinWeights[r],s=t>1?e.skinWeights[r+1]:0,a=t>2?e.skinWeights[r+2]:0,l=t>3?e.skinWeights[r+3]:0;n.skinWeights.push(new q.Vector4(o,s,a,l))}if(e.skinIndices)for(r=0,i=e.skinIndices.length;r<i;r+=t){var c=e.skinIndices[r],u=t>1?e.skinIndices[r+1]:0,d=t>2?e.skinIndices[r+2]:0,h=t>3?e.skinIndices[r+3]:0;n.skinIndices.push(new q.Vector4(c,u,d,h))}n.bones=e.bones,n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&q.warn("THREE.JSONLoader: When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.");n.animation=e.animation,n.animations=e.animations}(),function(t){var r,i,o,s,a,l,c,u,d,h,f;if(void 0!==e.morphTargets)for(a=0,l=e.morphTargets.length;a<l;a++)for(n.morphTargets[a]={},n.morphTargets[a].name=e.morphTargets[a].name,n.morphTargets[a].vertices=[],o=n.morphTargets[a].vertices,s=e.morphTargets[a].vertices,r=0,i=s.length;r<i;r+=3){var p=new q.Vector3;p.x=s[r]*t,p.y=s[r+1]*t,p.z=s[r+2]*t,o.push(p)}if(void 0!==e.morphColors)for(a=0,l=e.morphColors.length;a<l;a++)for(n.morphColors[a]={},n.morphColors[a].name=e.morphColors[a].name,n.morphColors[a].colors=[],d=n.morphColors[a].colors,h=e.morphColors[a].colors,c=0,u=h.length;c<u;c+=3)(f=new q.Color(16755200)).setRGB(h[c],h[c+1],h[c+2]),d.push(f)}(r),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:n};var i=this.initMaterials(e.materials,t);return this.needsTangents(i)&&n.computeTangents(),{geometry:n,materials:i}},q.LoadingManager=function(e,t,n){var r=this,i=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++},this.itemEnd=function(e){i++,void 0!==r.onProgress&&r.onProgress(e,i,o),i===o&&void 0!==r.onLoad&&r.onLoad()}},q.DefaultLoadingManager=new q.LoadingManager,q.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:q.DefaultLoadingManager},q.BufferGeometryLoader.prototype={constructor:q.BufferGeometryLoader,load:function(e,t,n,r){var i=this,o=new q.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new q.BufferGeometry,n=e.data.attributes;for(var r in n){var i=n[r],o=new self[i.type](i.array);t.addAttribute(r,new q.BufferAttribute(o,i.itemSize))}var s=e.data.offsets;void 0!==s&&(t.offsets=JSON.parse(JSON.stringify(s)));var a=e.data.boundingSphere;if(void 0!==a){var l=new q.Vector3;void 0!==a.center&&l.fromArray(a.center),t.boundingSphere=new q.Sphere(l,a.radius)}return t}},q.MaterialLoader=function(e){this.manager=void 0!==e?e:q.DefaultLoadingManager},q.MaterialLoader.prototype={constructor:q.MaterialLoader,load:function(e,t,n,r){var i=this,o=new q.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new q[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var n=0,r=e.materials.length;n<r;n++)t.materials.push(this.parse(e.materials[n]));return t}},q.ObjectLoader=function(e){this.manager=void 0!==e?e:q.DefaultLoadingManager,this.texturePath=""},q.ObjectLoader.prototype={constructor:q.ObjectLoader,load:function(e,t,n,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this,o=new q.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){i.parse(JSON.parse(e),t)}),n,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var n=this.parseGeometries(e.geometries),r=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),i=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,i),s=this.parseObject(e.object,n,o);return void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new q.JSONLoader,r=new q.BufferGeometryLoader,i=0,o=e.length;i<o;i++){var s,a=e[i];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new q[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new q.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":s=new q.CircleGeometry(a.radius,a.segments);break;case"CylinderGeometry":s=new q.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":s=new q.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":s=new q.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":s=new q.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":s=new q.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":s=r.parse(a);break;case"Geometry":s=n.parse(a.data).geometry}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseMaterials:function(e,t){var n={};if(void 0!==e)for(var r=function(e){return void 0===t[e]&&q.warn("THREE.ObjectLoader: Undefined texture",e),t[e]},i=new q.MaterialLoader,o=0,s=e.length;o<s;o++){var a=e[o],l=i.parse(a);l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.map&&(l.map=r(a.map)),void 0!==a.bumpMap&&(l.bumpMap=r(a.bumpMap),a.bumpScale&&(l.bumpScale=new q.Vector2(a.bumpScale,a.bumpScale))),void 0!==a.alphaMap&&(l.alphaMap=r(a.alphaMap)),void 0!==a.envMap&&(l.envMap=r(a.envMap)),void 0!==a.normalMap&&(l.normalMap=r(a.normalMap),a.normalScale&&(l.normalScale=new q.Vector2(a.normalScale,a.normalScale))),void 0!==a.lightMap&&(l.lightMap=r(a.lightMap)),void 0!==a.specularMap&&(l.specularMap=r(a.specularMap)),n[a.uuid]=l}return n},parseImages:function(e,t){var n=this,r={};if(void 0!==e&&e.length>0){var i=new q.LoadingManager(t),o=new q.ImageLoader(i);o.setCrossOrigin(this.crossOrigin);for(var s=function(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}))},a=0,l=e.length;a<l;a++){var c=e[a],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.texturePath+c.url;r[c.uuid]=s(u)}}return r},parseTextures:function(e,t){var n={};if(void 0!==e)for(var r=0,i=e.length;r<i;r++){var o=e[r];void 0===o.image&&q.warn('THREE.ObjectLoader: No "image" speficied for',o.uuid),void 0===t[o.image]&&q.warn("THREE.ObjectLoader: Undefined image",o.image);var s=new q.Texture(t[o.image]);s.needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.repeat&&(s.repeat=new q.Vector2(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(s.minFilter=q[o.minFilter]),void 0!==o.magFilter&&(s.magFilter=q[o.magFilter]),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),o.wrap instanceof Array&&(s.wrapS=q[o.wrap[0]],s.wrapT=q[o.wrap[1]]),n[o.uuid]=s}return n},parseObject:function(){var e=new q.Matrix4;return function(t,n,r){var i,o=function(e){return void 0===n[e]&&q.warn("THREE.ObjectLoader: Undefined geometry",e),n[e]},s=function(e){return void 0===r[e]&&q.warn("THREE.ObjectLoader: Undefined material",e),r[e]};switch(t.type){case"Scene":i=new q.Scene;break;case"PerspectiveCamera":i=new q.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":i=new q.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":i=new q.AmbientLight(t.color);break;case"DirectionalLight":i=new q.DirectionalLight(t.color,t.intensity);break;case"PointLight":i=new q.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":i=new q.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":i=new q.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":i=new q.Mesh(o(t.geometry),s(t.material));break;case"Line":i=new q.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":i=new q.PointCloud(o(t.geometry),s(t.material));break;case"Sprite":i=new q.Sprite(s(t.material));break;case"Group":i=new q.Group;break;default:i=new q.Object3D}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.children)for(var a in t.children)i.add(this.parseObject(t.children[a],n,r));return i}}()},q.TextureLoader=function(e){this.manager=void 0!==e?e:q.DefaultLoadingManager},q.TextureLoader.prototype={constructor:q.TextureLoader,load:function(e,t,n,r){var i=new q.ImageLoader(this.manager);i.setCrossOrigin(this.crossOrigin),i.load(e,(function(e){var n=new q.Texture(e);n.needsUpdate=!0,void 0!==t&&t(n)}),n,r)},setCrossOrigin:function(e){this.crossOrigin=e}},q.DataTextureLoader=q.BinaryTextureLoader=function(){this._parser=null},q.BinaryTextureLoader.prototype={constructor:q.BinaryTextureLoader,load:function(e,t,n,r){var i=this,o=new q.DataTexture,s=new q.XHRLoader;return s.setResponseType("arraybuffer"),s.load(e,(function(e){var n=i._parser(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:q.ClampToEdgeWrapping,o.wrapT=void 0!==n.wrapT?n.wrapT:q.ClampToEdgeWrapping,o.magFilter=void 0!==n.magFilter?n.magFilter:q.LinearFilter,o.minFilter=void 0!==n.minFilter?n.minFilter:q.LinearMipMapLinearFilter,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=q.LinearFilter),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}},q.CompressedTextureLoader=function(){this._parser=null},q.CompressedTextureLoader.prototype={constructor:q.CompressedTextureLoader,load:function(e,t,n){var r=this,i=[],o=new q.CompressedTexture;o.image=i;var s=new q.XHRLoader;if(s.setResponseType("arraybuffer"),e instanceof Array)for(var a=0,l=function(n){s.load(e[n],(function(e){var s=r._parser(e,!0);i[n]={width:s.width,height:s.height,format:s.format,mipmaps:s.mipmaps},6===(a+=1)&&(1==s.mipmapCount&&(o.minFilter=q.LinearFilter),o.format=s.format,o.needsUpdate=!0,t&&t(o))}))},c=0,u=e.length;c<u;++c)l(c);else s.load(e,(function(e){var n=r._parser(e,!0);if(n.isCubemap)for(var s=n.mipmaps.length/n.mipmapCount,a=0;a<s;a++){i[a]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)i[a].mipmaps.push(n.mipmaps[a*n.mipmapCount+l]),i[a].format=n.format,i[a].width=n.width,i[a].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=q.LinearFilter),o.format=n.format,o.needsUpdate=!0,t&&t(o)}));return o}},q.Material=function(){Object.defineProperty(this,"id",{value:q.MaterialIdCount++}),this.uuid=q.Math.generateUUID(),this.name="",this.type="Material",this.side=q.FrontSide,this.opacity=1,this.transparent=!1,this.blending=q.NormalBlending,this.blendSrc=q.SrcAlphaFactor,this.blendDst=q.OneMinusSrcAlphaFactor,this.blendEquation=q.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},q.Material.prototype={constructor:q.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){if(t in this){var r=this[t];r instanceof q.Color?r.set(n):r instanceof q.Vector3&&n instanceof q.Vector3?r.copy(n):this[t]="overdraw"==t?Number(n):n}}else q.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof q.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==q.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==q.NormalBlending&&(e.blending=this.blending),this.side!==q.FrontSide&&(e.side=this.side)):this instanceof q.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==q.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==q.SmoothShading&&(e.shading=this.shading),this.blending!==q.NormalBlending&&(e.blending=this.blending),this.side!==q.FrontSide&&(e.side=this.side)):this instanceof q.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==q.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==q.SmoothShading&&(e.shading=this.shading),this.blending!==q.NormalBlending&&(e.blending=this.blending),this.side!==q.FrontSide&&(e.side=this.side)):this instanceof q.MeshNormalMaterial||this instanceof q.MeshDepthMaterial?(this.blending!==q.NormalBlending&&(e.blending=this.blending),this.side!==q.FrontSide&&(e.side=this.side)):this instanceof q.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==q.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==q.NormalBlending&&(e.blending=this.blending)):this instanceof q.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof q.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),!1!==this.transparent&&(e.transparent=this.transparent),!1!==this.wireframe&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new q.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},q.EventDispatcher.prototype.apply(q.Material.prototype),q.MaterialIdCount=0,q.LineBasicMaterial=function(e){q.Material.call(this),this.type="LineBasicMaterial",this.color=new q.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=q.NoColors,this.fog=!0,this.setValues(e)},q.LineBasicMaterial.prototype=Object.create(q.Material.prototype),q.LineBasicMaterial.prototype.constructor=q.LineBasicMaterial,q.LineBasicMaterial.prototype.clone=function(){var e=new q.LineBasicMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},q.LineDashedMaterial=function(e){q.Material.call(this),this.type="LineDashedMaterial",this.color=new q.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},q.LineDashedMaterial.prototype=Object.create(q.Material.prototype),q.LineDashedMaterial.prototype.constructor=q.LineDashedMaterial,q.LineDashedMaterial.prototype.clone=function(){var e=new q.LineDashedMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},q.MeshBasicMaterial=function(e){q.Material.call(this),this.type="MeshBasicMaterial",this.color=new q.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=q.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=q.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},q.MeshBasicMaterial.prototype=Object.create(q.Material.prototype),q.MeshBasicMaterial.prototype.constructor=q.MeshBasicMaterial,q.MeshBasicMaterial.prototype.clone=function(){var e=new q.MeshBasicMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},q.MeshLambertMaterial=function(e){q.Material.call(this),this.type="MeshLambertMaterial",this.color=new q.Color(16777215),this.emissive=new q.Color(0),this.wrapAround=!1,this.wrapRGB=new q.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=q.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=q.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},q.MeshLambertMaterial.prototype=Object.create(q.Material.prototype),q.MeshLambertMaterial.prototype.constructor=q.MeshLambertMaterial,q.MeshLambertMaterial.prototype.clone=function(){var e=new q.MeshLambertMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},q.MeshPhongMaterial=function(e){q.Material.call(this),this.type="MeshPhongMaterial",this.color=new q.Color(16777215),this.emissive=new q.Color(0),this.specular=new q.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new q.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new q.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=q.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=q.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},q.MeshPhongMaterial.prototype=Object.create(q.Material.prototype),q.MeshPhongMaterial.prototype.constructor=q.MeshPhongMaterial,q.MeshPhongMaterial.prototype.clone=function(){var e=new q.MeshPhongMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},q.MeshDepthMaterial=function(e){q.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},q.MeshDepthMaterial.prototype=Object.create(q.Material.prototype),q.MeshDepthMaterial.prototype.constructor=q.MeshDepthMaterial,q.MeshDepthMaterial.prototype.clone=function(){var e=new q.MeshDepthMaterial;return q.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},q.MeshNormalMaterial=function(e){q.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},q.MeshNormalMaterial.prototype=Object.create(q.Material.prototype),q.MeshNormalMaterial.prototype.constructor=q.MeshNormalMaterial,q.MeshNormalMaterial.prototype.clone=function(){var e=new q.MeshNormalMaterial;return q.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},q.MeshFaceMaterial=function(e){this.uuid=q.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},q.MeshFaceMaterial.prototype={constructor:q.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,n=this.materials.length;t<n;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new q.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},q.PointCloudMaterial=function(e){q.Material.call(this),this.type="PointCloudMaterial",this.color=new q.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=q.NoColors,this.fog=!0,this.setValues(e)},q.PointCloudMaterial.prototype=Object.create(q.Material.prototype),q.PointCloudMaterial.prototype.constructor=q.PointCloudMaterial,q.PointCloudMaterial.prototype.clone=function(){var e=new q.PointCloudMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},q.ParticleBasicMaterial=function(e){return q.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new q.PointCloudMaterial(e)},q.ParticleSystemMaterial=function(e){return q.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new q.PointCloudMaterial(e)},q.ShaderMaterial=function(e){q.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=q.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=q.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},q.ShaderMaterial.prototype=Object.create(q.Material.prototype),q.ShaderMaterial.prototype.constructor=q.ShaderMaterial,q.ShaderMaterial.prototype.clone=function(){var e=new q.ShaderMaterial;return q.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=q.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},q.RawShaderMaterial=function(e){q.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},q.RawShaderMaterial.prototype=Object.create(q.ShaderMaterial.prototype),q.RawShaderMaterial.prototype.constructor=q.RawShaderMaterial,q.RawShaderMaterial.prototype.clone=function(){var e=new q.RawShaderMaterial;return q.ShaderMaterial.prototype.clone.call(this,e),e},q.SpriteMaterial=function(e){q.Material.call(this),this.type="SpriteMaterial",this.color=new q.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},q.SpriteMaterial.prototype=Object.create(q.Material.prototype),q.SpriteMaterial.prototype.constructor=q.SpriteMaterial,q.SpriteMaterial.prototype.clone=function(){var e=new q.SpriteMaterial;return q.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},q.Texture=function(e,t,n,r,i,o,s,a,l){Object.defineProperty(this,"id",{value:q.TextureIdCount++}),this.uuid=q.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:q.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:q.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:q.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:q.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:q.LinearFilter,this.minFilter=void 0!==o?o:q.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:q.RGBAFormat,this.type=void 0!==a?a:q.UnsignedByteType,this.offset=new q.Vector2(0,0),this.repeat=new q.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},q.Texture.DEFAULT_IMAGE=void 0,q.Texture.DEFAULT_MAPPING=q.UVMapping,q.Texture.prototype={constructor:q.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new q.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},q.EventDispatcher.prototype.apply(q.Texture.prototype),q.TextureIdCount=0,q.CubeTexture=function(e,t,n,r,i,o,s,a,l){t=void 0!==t?t:q.CubeReflectionMapping,q.Texture.call(this,e,t,n,r,i,o,s,a,l),this.images=e},q.CubeTexture.prototype=Object.create(q.Texture.prototype),q.CubeTexture.prototype.constructor=q.CubeTexture,q.CubeTexture.clone=function(e){return void 0===e&&(e=new q.CubeTexture),q.Texture.prototype.clone.call(this,e),e.images=this.images,e},q.CompressedTexture=function(e,t,n,r,i,o,s,a,l,c,u){q.Texture.call(this,null,o,s,a,l,c,r,i,u),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},q.CompressedTexture.prototype=Object.create(q.Texture.prototype),q.CompressedTexture.prototype.constructor=q.CompressedTexture,q.CompressedTexture.prototype.clone=function(){var e=new q.CompressedTexture;return q.Texture.prototype.clone.call(this,e),e},q.DataTexture=function(e,t,n,r,i,o,s,a,l,c,u){q.Texture.call(this,null,o,s,a,l,c,r,i,u),this.image={data:e,width:t,height:n}},q.DataTexture.prototype=Object.create(q.Texture.prototype),q.DataTexture.prototype.constructor=q.DataTexture,q.DataTexture.prototype.clone=function(){var e=new q.DataTexture;return q.Texture.prototype.clone.call(this,e),e},q.VideoTexture=function(e,t,n,r,i,o,s,a,l){q.Texture.call(this,e,t,n,r,i,o,s,a,l),this.generateMipmaps=!1;var c=this;!function t(){requestAnimationFrame(t),e.readyState===e.HAVE_ENOUGH_DATA&&(c.needsUpdate=!0)}()},q.VideoTexture.prototype=Object.create(q.Texture.prototype),q.VideoTexture.prototype.constructor=q.VideoTexture,q.Group=function(){q.Object3D.call(this),this.type="Group"},q.Group.prototype=Object.create(q.Object3D.prototype),q.Group.prototype.constructor=q.Group,q.PointCloud=function(e,t){q.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new q.Geometry,this.material=void 0!==t?t:new q.PointCloudMaterial({color:16777215*Math.random()})},q.PointCloud.prototype=Object.create(q.Object3D.prototype),q.PointCloud.prototype.constructor=q.PointCloud,q.PointCloud.prototype.raycast=(T=new q.Matrix4,C=new q.Ray,function(e,t){var n=this,r=n.geometry,i=e.params.PointCloud.threshold;if(T.getInverse(this.matrixWorld),C.copy(e.ray).applyMatrix4(T),null===r.boundingBox||!1!==C.isIntersectionBox(r.boundingBox)){var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=new q.Vector3,a=function(r,i){var s=C.distanceToPoint(r);if(s<o){var a=C.closestPointToPoint(r);a.applyMatrix4(n.matrixWorld);var l=e.ray.origin.distanceTo(a);t.push({distance:l,distanceToRay:s,point:a.clone(),index:i,face:null,object:n})}};if(r instanceof q.BufferGeometry){var l=r.attributes,c=l.position.array;if(void 0!==l.index){var u=l.index.array,d=r.offsets;0===d.length&&(d=[{start:0,count:u.length,index:0}]);for(var h=0,f=d.length;h<f;++h)for(var p=d[h].start,m=d[h].count,g=d[h].index,v=p,y=p+m;v<y;v++){var _=g+u[v];s.fromArray(c,3*_),a(s,_)}}else{var b=c.length/3;for(v=0;v<b;v++)s.set(c[3*v],c[3*v+1],c[3*v+2]),a(s,v)}}else{var x=this.geometry.vertices;for(v=0;v<x.length;v++)a(x[v],v)}}}),q.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new q.PointCloud(this.geometry,this.material)),q.Object3D.prototype.clone.call(this,e),e},q.ParticleSystem=function(e,t){return q.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new q.PointCloud(e,t)},q.Line=function(e,t,n){q.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new q.Geometry,this.material=void 0!==t?t:new q.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==n?n:q.LineStrip},q.LineStrip=0,q.LinePieces=1,q.Line.prototype=Object.create(q.Object3D.prototype),q.Line.prototype.constructor=q.Line,q.Line.prototype.raycast=function(){var e=new q.Matrix4,t=new q.Ray,n=new q.Sphere;return function(r,i){var o=r.linePrecision,s=o*o,a=this.geometry;if(null===a.boundingSphere&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==r.ray.isIntersectionSphere(n)){e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e);var l=new q.Vector3,c=new q.Vector3,u=new q.Vector3,d=new q.Vector3,h=this.mode===q.LineStrip?1:2;if(a instanceof q.BufferGeometry){var f=a.attributes;if(void 0!==f.index){var p=f.index.array,m=f.position.array,g=a.offsets;0===g.length&&(g=[{start:0,count:p.length,index:0}]);for(var v=0;v<g.length;v++)for(var y=g[v].start,_=g[v].count,b=g[v].index,x=y;x<y+_-1;x+=h){var w=b+p[x],E=b+p[x+1];if(l.fromArray(m,3*w),c.fromArray(m,3*E),!(t.distanceSqToSegment(l,c,d,u)>s))(S=t.origin.distanceTo(d))<r.near||S>r.far||i.push({distance:S,point:u.clone().applyMatrix4(this.matrixWorld),index:x,offsetIndex:v,face:null,faceIndex:null,object:this})}}else for(m=f.position.array,x=0;x<m.length/3-1;x+=h){if(l.fromArray(m,3*x),c.fromArray(m,3*x+3),!(t.distanceSqToSegment(l,c,d,u)>s))(S=t.origin.distanceTo(d))<r.near||S>r.far||i.push({distance:S,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else if(a instanceof q.Geometry){var A=a.vertices,M=A.length;for(x=0;x<M-1;x+=h){var S;if(!(t.distanceSqToSegment(A[x],A[x+1],d,u)>s))(S=t.origin.distanceTo(d))<r.near||S>r.far||i.push({distance:S,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}}(),q.Line.prototype.clone=function(e){return void 0===e&&(e=new q.Line(this.geometry,this.material,this.mode)),q.Object3D.prototype.clone.call(this,e),e},q.Mesh=function(e,t){q.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new q.Geometry,this.material=void 0!==t?t:new q.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},q.Mesh.prototype=Object.create(q.Object3D.prototype),q.Mesh.prototype.constructor=q.Mesh,q.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},q.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(q.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},q.Mesh.prototype.raycast=function(){var e=new q.Matrix4,t=new q.Ray,n=new q.Sphere,r=new q.Vector3,i=new q.Vector3,o=new q.Vector3;return function(s,a){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),n.copy(l.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==s.ray.isIntersectionSphere(n)&&(e.getInverse(this.matrixWorld),t.copy(s.ray).applyMatrix4(e),null===l.boundingBox||!1!==t.isIntersectionBox(l.boundingBox)))if(l instanceof q.BufferGeometry){if(void 0===(D=this.material))return;var c=l.attributes,u=s.precision;if(void 0!==c.index){var d=c.index.array,h=c.position.array,f=l.offsets;0===f.length&&(f=[{start:0,count:d.length,index:0}]);for(var p=0,m=f.length;p<m;++p)for(var g=f[p].start,v=f[p].count,y=f[p].index,_=g,b=g+v;_<b;_+=3){if(E=y+d[_],A=y+d[_+1],M=y+d[_+2],r.fromArray(h,3*E),i.fromArray(h,3*A),o.fromArray(h,3*M),D.side===q.BackSide)var x=t.intersectTriangle(o,i,r,!0);else x=t.intersectTriangle(r,i,o,D.side!==q.DoubleSide);if(null!==x)x.applyMatrix4(this.matrixWorld),(V=s.ray.origin.distanceTo(x))<u||V<s.near||V>s.far||a.push({distance:V,point:x,face:new q.Face3(E,A,M,q.Triangle.normal(r,i,o)),faceIndex:null,object:this})}}else{_=0;var w=0;for(b=(h=c.position.array).length;_<b;_+=3,w+=9){if(E=_,A=_+1,M=_+2,r.fromArray(h,w),i.fromArray(h,w+3),o.fromArray(h,w+6),D.side===q.BackSide)x=t.intersectTriangle(o,i,r,!0);else x=t.intersectTriangle(r,i,o,D.side!==q.DoubleSide);if(null!==x)x.applyMatrix4(this.matrixWorld),(V=s.ray.origin.distanceTo(x))<u||V<s.near||V>s.far||a.push({distance:V,point:x,face:new q.Face3(E,A,M,q.Triangle.normal(r,i,o)),faceIndex:null,object:this})}}}else if(l instanceof q.Geometry)for(var E,A,M,S=this.material instanceof q.MeshFaceMaterial,T=!0===S?this.material.materials:null,C=(u=s.precision,l.vertices),P=0,L=l.faces.length;P<L;P++){var D,R=l.faces[P];if(void 0!==(D=!0===S?T[R.materialIndex]:this.material)){if(E=C[R.a],A=C[R.b],M=C[R.c],!0===D.morphTargets){var I=l.morphTargets,j=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var O=0,N=I.length;O<N;O++){var k=j[O];if(0!==k){var F=I[O].vertices;r.x+=(F[R.a].x-E.x)*k,r.y+=(F[R.a].y-E.y)*k,r.z+=(F[R.a].z-E.z)*k,i.x+=(F[R.b].x-A.x)*k,i.y+=(F[R.b].y-A.y)*k,i.z+=(F[R.b].z-A.z)*k,o.x+=(F[R.c].x-M.x)*k,o.y+=(F[R.c].y-M.y)*k,o.z+=(F[R.c].z-M.z)*k}}r.add(E),i.add(A),o.add(M),E=r,A=i,M=o}if(D.side===q.BackSide)x=t.intersectTriangle(M,A,E,!0);else x=t.intersectTriangle(E,A,M,D.side!==q.DoubleSide);var V;if(null!==x)x.applyMatrix4(this.matrixWorld),(V=s.ray.origin.distanceTo(x))<u||V<s.near||V>s.far||a.push({distance:V,point:x,face:R,faceIndex:P,object:this})}}}}(),q.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new q.Mesh(this.geometry,this.material)),q.Object3D.prototype.clone.call(this,e,t),e},q.Bone=function(e){q.Object3D.call(this),this.type="Bone",this.skin=e},q.Bone.prototype=Object.create(q.Object3D.prototype),q.Bone.prototype.constructor=q.Bone,q.Skeleton=function(e,t,n){var r;(this.useVertexTexture=void 0===n||n,this.identityMatrix=new q.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture)?(r=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new q.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,q.RGBAFormat,q.FloatType),this.boneTexture.minFilter=q.NearestFilter,this.boneTexture.magFilter=q.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{q.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new q.Matrix4)}},q.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new q.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},q.Skeleton.prototype.pose=function(){for(var e,t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},q.Skeleton.prototype.update=(P=new q.Matrix4,function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;P.multiplyMatrices(n,this.boneInverses[e]),P.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),q.SkinnedMesh=function(e,t,n){q.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new q.Matrix4,this.bindMatrixInverse=new q.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var i,o,s,a,l,c=0,u=this.geometry.bones.length;c<u;++c)s=(o=this.geometry.bones[c]).pos,a=o.rotq,l=o.scl,i=new q.Bone(this),r.push(i),i.name=o.name,i.position.set(s[0],s[1],s[2]),i.quaternion.set(a[0],a[1],a[2],a[3]),void 0!==l?i.scale.set(l[0],l[1],l[2]):i.scale.set(1,1,1);for(c=0,u=this.geometry.bones.length;c<u;++c)-1!==(o=this.geometry.bones[c]).parent?r[o.parent].add(r[c]):this.add(r[c])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new q.Skeleton(r,void 0,n))},q.SkinnedMesh.prototype=Object.create(q.Mesh.prototype),q.SkinnedMesh.prototype.constructor=q.SkinnedMesh,q.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},q.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},q.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof q.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==1/0?t.multiplyScalar(n):t.set(1)}},q.SkinnedMesh.prototype.updateMatrixWorld=function(e){q.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):q.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},q.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new q.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),q.Mesh.prototype.clone.call(this,e),e},q.MorphAnimMesh=function(e,t){q.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},q.MorphAnimMesh.prototype=Object.create(q.Mesh.prototype),q.MorphAnimMesh.prototype.constructor=q.MorphAnimMesh,q.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},q.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},q.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},q.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)_?(\d+)/,i=0,o=e.morphTargets.length;i<o;i++){var s=e.morphTargets[i].name.match(r);if(s&&s.length>1){var a=s[1];n[a]||(n[a]={start:1/0,end:-1/0});var l=n[a];i<l.start&&(l.start=i),i>l.end&&(l.end=i),t||(t=a)}}e.firstAnimation=t},q.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},q.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):q.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},q.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var n=this.startKeyframe+q.Math.clamp(Math.floor(this.time/t),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var r=this.time%t/t;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},q.MorphAnimMesh.prototype.interpolateTargets=function(e,t,n){for(var r=this.morphTargetInfluences,i=0,o=r.length;i<o;i++)r[i]=0;e>-1&&(r[e]=1-n),t>-1&&(r[t]=n)},q.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new q.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,q.Mesh.prototype.clone.call(this,e),e},q.LOD=function(){q.Object3D.call(this),this.objects=[]},q.LOD.prototype=Object.create(q.Object3D.prototype),q.LOD.prototype.constructor=q.LOD,q.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},q.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},q.LOD.prototype.raycast=(L=new q.Vector3,function(e,t){L.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(L);this.getObjectForDistance(n).raycast(e,t)}),q.LOD.prototype.update=function(){var e=new q.Vector3,t=new q.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);this.objects[0].object.visible=!0;for(var i=1,o=this.objects.length;i<o&&r>=this.objects[i].distance;i++)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;for(;i<o;i++)this.objects[i].object.visible=!1}}}(),q.LOD.prototype.clone=function(e){void 0===e&&(e=new q.LOD),q.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var r=this.objects[t].object.clone();r.visible=0===t,e.addLevel(r,this.objects[t].distance)}return e},q.Sprite=(D=new Uint16Array([0,1,2,0,2,3]),R=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),I=new Float32Array([0,0,1,0,1,1,0,1]),(j=new q.BufferGeometry).addAttribute("index",new q.BufferAttribute(D,1)),j.addAttribute("position",new q.BufferAttribute(R,3)),j.addAttribute("uv",new q.BufferAttribute(I,2)),function(e){q.Object3D.call(this),this.type="Sprite",this.geometry=j,this.material=void 0!==e?e:new q.SpriteMaterial}),q.Sprite.prototype=Object.create(q.Object3D.prototype),q.Sprite.prototype.constructor=q.Sprite,q.Sprite.prototype.raycast=function(){var e=new q.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceToPoint(e);r>this.scale.x||n.push({distance:r,point:this.position,face:null,object:this})}}(),q.Sprite.prototype.clone=function(e){return void 0===e&&(e=new q.Sprite(this.material)),q.Object3D.prototype.clone.call(this,e),e},q.Particle=q.Sprite,q.LensFlare=function(e,t,n,r,i){q.Object3D.call(this),this.lensFlares=[],this.positionScreen=new q.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,r,i)},q.LensFlare.prototype=Object.create(q.Object3D.prototype),q.LensFlare.prototype.constructor=q.LensFlare,q.LensFlare.prototype.add=function(e,t,n,r,i,o){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===o&&(o=1),void 0===i&&(i=new q.Color(16777215)),void 0===r&&(r=q.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:i,blending:r})},q.LensFlare.prototype.updateLensFlares=function(){var e,t,n=this.lensFlares.length,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<n;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+i*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},q.Scene=function(){q.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},q.Scene.prototype=Object.create(q.Object3D.prototype),q.Scene.prototype.constructor=q.Scene,q.Scene.prototype.clone=function(e){return void 0===e&&(e=new q.Scene),q.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},q.Fog=function(e,t,n){this.name="",this.color=new q.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},q.Fog.prototype.clone=function(){return new q.Fog(this.color.getHex(),this.near,this.far)},q.FogExp2=function(e,t){this.name="",this.color=new q.Color(e),this.density=void 0!==t?t:25e-5},q.FogExp2.prototype.clone=function(){return new q.FogExp2(this.color.getHex(),this.density)},q.ShaderChunk={},q.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n",q.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",q.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n",q.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",q.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",q.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",q.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",q.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",q.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",q.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",q.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",q.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",q.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",q.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",q.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",q.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",q.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",q.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",q.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",q.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif",q.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",q.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",q.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",q.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif",q.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",q.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",q.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",q.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",q.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",q.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",q.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",q.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",q.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",q.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",q.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",q.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",q.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",q.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",q.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",q.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",q.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",q.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",q.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",q.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",q.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",q.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",q.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n",q.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n",q.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",q.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",q.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",q.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",q.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",q.UniformsUtils={merge:function(e){for(var t={},n=0;n<e.length;n++){var r=this.clone(e[n]);for(var i in r)t[i]=r[i]}return t},clone:function(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i instanceof q.Color||i instanceof q.Vector2||i instanceof q.Vector3||i instanceof q.Vector4||i instanceof q.Matrix4||i instanceof q.Texture?t[n][r]=i.clone():t[n][r]=i instanceof Array?i.slice():i}return t}},q.UniformsLib={common:{diffuse:{type:"c",value:new q.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new q.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new q.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new q.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new q.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new q.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new q.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},q.ShaderLib={basic:{uniforms:q.UniformsUtils.merge([q.UniformsLib.common,q.UniformsLib.fog,q.UniformsLib.shadowmap]),vertexShader:[q.ShaderChunk.common,q.ShaderChunk.map_pars_vertex,q.ShaderChunk.lightmap_pars_vertex,q.ShaderChunk.envmap_pars_vertex,q.ShaderChunk.color_pars_vertex,q.ShaderChunk.morphtarget_pars_vertex,q.ShaderChunk.skinning_pars_vertex,q.ShaderChunk.shadowmap_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.map_vertex,q.ShaderChunk.lightmap_vertex,q.ShaderChunk.color_vertex,q.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",q.ShaderChunk.morphnormal_vertex,q.ShaderChunk.skinnormal_vertex,q.ShaderChunk.defaultnormal_vertex,"\t#endif",q.ShaderChunk.morphtarget_vertex,q.ShaderChunk.skinning_vertex,q.ShaderChunk.default_vertex,q.ShaderChunk.logdepthbuf_vertex,q.ShaderChunk.worldpos_vertex,q.ShaderChunk.envmap_vertex,q.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",q.ShaderChunk.common,q.ShaderChunk.color_pars_fragment,q.ShaderChunk.map_pars_fragment,q.ShaderChunk.alphamap_pars_fragment,q.ShaderChunk.lightmap_pars_fragment,q.ShaderChunk.envmap_pars_fragment,q.ShaderChunk.fog_pars_fragment,q.ShaderChunk.shadowmap_pars_fragment,q.ShaderChunk.specularmap_pars_fragment,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",q.ShaderChunk.logdepthbuf_fragment,q.ShaderChunk.map_fragment,q.ShaderChunk.color_fragment,q.ShaderChunk.alphamap_fragment,q.ShaderChunk.alphatest_fragment,q.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",q.ShaderChunk.lightmap_fragment,q.ShaderChunk.envmap_fragment,q.ShaderChunk.shadowmap_fragment,q.ShaderChunk.linear_to_gamma_fragment,q.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:q.UniformsUtils.merge([q.UniformsLib.common,q.UniformsLib.fog,q.UniformsLib.lights,q.UniformsLib.shadowmap,{emissive:{type:"c",value:new q.Color(0)},wrapRGB:{type:"v3",value:new q.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",q.ShaderChunk.common,q.ShaderChunk.map_pars_vertex,q.ShaderChunk.lightmap_pars_vertex,q.ShaderChunk.envmap_pars_vertex,q.ShaderChunk.lights_lambert_pars_vertex,q.ShaderChunk.color_pars_vertex,q.ShaderChunk.morphtarget_pars_vertex,q.ShaderChunk.skinning_pars_vertex,q.ShaderChunk.shadowmap_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.map_vertex,q.ShaderChunk.lightmap_vertex,q.ShaderChunk.color_vertex,q.ShaderChunk.morphnormal_vertex,q.ShaderChunk.skinbase_vertex,q.ShaderChunk.skinnormal_vertex,q.ShaderChunk.defaultnormal_vertex,q.ShaderChunk.morphtarget_vertex,q.ShaderChunk.skinning_vertex,q.ShaderChunk.default_vertex,q.ShaderChunk.logdepthbuf_vertex,q.ShaderChunk.worldpos_vertex,q.ShaderChunk.envmap_vertex,q.ShaderChunk.lights_lambert_vertex,q.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",q.ShaderChunk.common,q.ShaderChunk.color_pars_fragment,q.ShaderChunk.map_pars_fragment,q.ShaderChunk.alphamap_pars_fragment,q.ShaderChunk.lightmap_pars_fragment,q.ShaderChunk.envmap_pars_fragment,q.ShaderChunk.fog_pars_fragment,q.ShaderChunk.shadowmap_pars_fragment,q.ShaderChunk.specularmap_pars_fragment,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",q.ShaderChunk.logdepthbuf_fragment,q.ShaderChunk.map_fragment,q.ShaderChunk.color_fragment,q.ShaderChunk.alphamap_fragment,q.ShaderChunk.alphatest_fragment,q.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",q.ShaderChunk.lightmap_fragment,q.ShaderChunk.envmap_fragment,q.ShaderChunk.shadowmap_fragment,q.ShaderChunk.linear_to_gamma_fragment,q.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:q.UniformsUtils.merge([q.UniformsLib.common,q.UniformsLib.bump,q.UniformsLib.normalmap,q.UniformsLib.fog,q.UniformsLib.lights,q.UniformsLib.shadowmap,{emissive:{type:"c",value:new q.Color(0)},specular:{type:"c",value:new q.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new q.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",q.ShaderChunk.common,q.ShaderChunk.map_pars_vertex,q.ShaderChunk.lightmap_pars_vertex,q.ShaderChunk.envmap_pars_vertex,q.ShaderChunk.lights_phong_pars_vertex,q.ShaderChunk.color_pars_vertex,q.ShaderChunk.morphtarget_pars_vertex,q.ShaderChunk.skinning_pars_vertex,q.ShaderChunk.shadowmap_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.map_vertex,q.ShaderChunk.lightmap_vertex,q.ShaderChunk.color_vertex,q.ShaderChunk.morphnormal_vertex,q.ShaderChunk.skinbase_vertex,q.ShaderChunk.skinnormal_vertex,q.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",q.ShaderChunk.morphtarget_vertex,q.ShaderChunk.skinning_vertex,q.ShaderChunk.default_vertex,q.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",q.ShaderChunk.worldpos_vertex,q.ShaderChunk.envmap_vertex,q.ShaderChunk.lights_phong_vertex,q.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",q.ShaderChunk.common,q.ShaderChunk.color_pars_fragment,q.ShaderChunk.map_pars_fragment,q.ShaderChunk.alphamap_pars_fragment,q.ShaderChunk.lightmap_pars_fragment,q.ShaderChunk.envmap_pars_fragment,q.ShaderChunk.fog_pars_fragment,q.ShaderChunk.lights_phong_pars_fragment,q.ShaderChunk.shadowmap_pars_fragment,q.ShaderChunk.bumpmap_pars_fragment,q.ShaderChunk.normalmap_pars_fragment,q.ShaderChunk.specularmap_pars_fragment,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",q.ShaderChunk.logdepthbuf_fragment,q.ShaderChunk.map_fragment,q.ShaderChunk.color_fragment,q.ShaderChunk.alphamap_fragment,q.ShaderChunk.alphatest_fragment,q.ShaderChunk.specularmap_fragment,q.ShaderChunk.lights_phong_fragment,q.ShaderChunk.lightmap_fragment,q.ShaderChunk.envmap_fragment,q.ShaderChunk.shadowmap_fragment,q.ShaderChunk.linear_to_gamma_fragment,q.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:q.UniformsUtils.merge([q.UniformsLib.particle,q.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",q.ShaderChunk.common,q.ShaderChunk.color_pars_vertex,q.ShaderChunk.shadowmap_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",q.ShaderChunk.logdepthbuf_vertex,q.ShaderChunk.worldpos_vertex,q.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",q.ShaderChunk.common,q.ShaderChunk.color_pars_fragment,q.ShaderChunk.map_particle_pars_fragment,q.ShaderChunk.fog_pars_fragment,q.ShaderChunk.shadowmap_pars_fragment,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",q.ShaderChunk.logdepthbuf_fragment,q.ShaderChunk.map_particle_fragment,q.ShaderChunk.color_fragment,q.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",q.ShaderChunk.shadowmap_fragment,q.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:q.UniformsUtils.merge([q.UniformsLib.common,q.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",q.ShaderChunk.common,q.ShaderChunk.color_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",q.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",q.ShaderChunk.common,q.ShaderChunk.color_pars_fragment,q.ShaderChunk.fog_pars_fragment,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",q.ShaderChunk.logdepthbuf_fragment,q.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",q.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[q.ShaderChunk.common,q.ShaderChunk.morphtarget_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.morphtarget_vertex,q.ShaderChunk.default_vertex,q.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",q.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",q.ShaderChunk.common,q.ShaderChunk.morphtarget_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",q.ShaderChunk.morphtarget_vertex,q.ShaderChunk.default_vertex,q.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",q.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",q.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",q.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",q.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",q.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[q.ShaderChunk.common,q.ShaderChunk.morphtarget_pars_vertex,q.ShaderChunk.skinning_pars_vertex,q.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",q.ShaderChunk.skinbase_vertex,q.ShaderChunk.morphtarget_vertex,q.ShaderChunk.skinning_vertex,q.ShaderChunk.default_vertex,q.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[q.ShaderChunk.common,q.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",q.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},q.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",q.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),n=void 0!==e.context?e.context:null,r=1,i=void 0!==e.precision?e.precision:"highp",o=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,c=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,d=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,h=new q.Color(0),f=0,p=[],m={},g=[],v=[],y=[],_=[],b=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=q.PCFShadowMap,this.shadowMapCullFace=q.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var x,w=this,E=[],A=null,M=null,S=-1,T="",C=null,P=0,L=0,D=0,R=t.width,I=t.height,j=0,O=0,N=new q.Frustum,k=new q.Matrix4,F=new q.Vector3,V=new q.Vector3,B=!0,U={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var z={alpha:o,depth:s,stencil:a,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:u};if(null===(x=n||t.getContext("webgl",z)||t.getContext("experimental-webgl",z)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";t.addEventListener("webglcontextlost",(function(e){e.preventDefault(),Y(),X(),m={}}),!1)}catch(e){q.error("THREE.WebGLRenderer: "+e)}var G=new q.WebGLState(x,ot);void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var H=new q.WebGLExtensions(x);H.get("OES_texture_float"),H.get("OES_texture_float_linear"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),d&&H.get("EXT_frag_depth");var W=function(e,t,n,r){!0===c&&(e*=r,t*=r,n*=r),x.clearColor(e,t,n,r)},X=function(){x.clearColor(0,0,0,1),x.clearDepth(1),x.clearStencil(0),x.enable(x.DEPTH_TEST),x.depthFunc(x.LEQUAL),x.frontFace(x.CCW),x.cullFace(x.BACK),x.enable(x.CULL_FACE),x.enable(x.BLEND),x.blendEquation(x.FUNC_ADD),x.blendFunc(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA),x.viewport(L,D,R,I),W(h.r,h.g,h.b,f)},Y=function(){A=null,C=null,T="",S=-1,B=!0,G.reset()};X(),this.context=x,this.state=G;var K,Q=x.getParameter(x.MAX_TEXTURE_IMAGE_UNITS),Z=x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=x.getParameter(x.MAX_TEXTURE_SIZE),$=x.getParameter(x.MAX_CUBE_MAP_TEXTURE_SIZE),ee=Z>0,te=ee&&H.get("OES_texture_float"),ne=x.getShaderPrecisionFormat(x.VERTEX_SHADER,x.HIGH_FLOAT),re=x.getShaderPrecisionFormat(x.VERTEX_SHADER,x.MEDIUM_FLOAT),ie=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT),oe=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.MEDIUM_FLOAT),se=function(){if(void 0!==K)return K;if(K=[],H.get("WEBGL_compressed_texture_pvrtc")||H.get("WEBGL_compressed_texture_s3tc"))for(var e=x.getParameter(x.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)K.push(e[t]);return K},ae=ne.precision>0&&ie.precision>0,le=re.precision>0&&oe.precision>0;"highp"!==i||ae||(le?(i="mediump",q.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(i="lowp",q.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==i||le||(i="lowp",q.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var ce,ue=new q.ShadowMapPlugin(this,p,m,g),de=new q.SpritePlugin(this,_),he=new q.LensFlarePlugin(this,b);function fe(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglNormalBuffer=x.createBuffer(),e.__webglTangentBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),e.__webglUVBuffer=x.createBuffer(),e.__webglUV2Buffer=x.createBuffer(),e.__webglSkinIndicesBuffer=x.createBuffer(),e.__webglSkinWeightsBuffer=x.createBuffer(),e.__webglFaceBuffer=x.createBuffer(),e.__webglLineBuffer=x.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var n=0,r=t;n<r;n++)e.__webglMorphTargetsBuffers.push(x.createBuffer())}var i=e.numMorphNormals;if(i){e.__webglMorphNormalsBuffers=[];for(n=0,r=i;n<r;n++)e.__webglMorphNormalsBuffers.push(x.createBuffer())}w.info.memory.geometries++}this.getContext=function(){return x},this.forceContextLoss=function(){H.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return ee},this.supportsFloatTextures=function(){return H.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return H.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return H.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return H.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return H.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return H.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==ce)return ce;var e=H.get("EXT_texture_filter_anisotropic");return ce=null!==e?x.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return i},this.getPixelRatio=function(){return r},this.setPixelRatio=function(e){r=e},this.setSize=function(e,n,i){t.width=e*r,t.height=n*r,!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n)},this.setViewport=function(e,t,n,i){L=e*r,D=t*r,R=n*r,I=i*r,x.viewport(L,D,R,I)},this.setScissor=function(e,t,n,i){x.scissor(e*r,t*r,n*r,i*r)},this.enableScissorTest=function(e){e?x.enable(x.SCISSOR_TEST):x.disable(x.SCISSOR_TEST)},this.getClearColor=function(){return h},this.setClearColor=function(e,t){h.set(e),f=void 0!==t?t:1,W(h.r,h.g,h.b,f)},this.getClearAlpha=function(){return f},this.setClearAlpha=function(e){f=e,W(h.r,h.g,h.b,f)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=x.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=x.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=x.STENCIL_BUFFER_BIT),x.clear(r)},this.clearColor=function(){x.clear(x.COLOR_BUFFER_BIT)},this.clearDepth=function(){x.clear(x.DEPTH_BUFFER_BIT)},this.clearStencil=function(){x.clear(x.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.resetGLState=Y;var pe=function e(t){t.target.traverse((function(t){t.removeEventListener("remove",e),function(e){e instanceof q.Mesh||e instanceof q.PointCloud||e instanceof q.Line?delete m[e.id]:(e instanceof q.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}(g,e);delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}(t)}))},me=function e(t){var n=t.target;n.removeEventListener("dispose",e),be(n)},ge=function e(t){var n=t.target;n.removeEventListener("dispose",e),xe(n),w.info.memory.textures--},ve=function e(t){var n=t.target;n.removeEventListener("dispose",e),we(n),w.info.memory.textures--},ye=function e(t){var n=t.target;n.removeEventListener("dispose",e),Ee(n)},_e=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],n=0,r=t.length;n<r;n++){void 0!==e[i=t[n]]&&(x.deleteBuffer(e[i]),delete e[i])}if(void 0!==e.__webglCustomAttributesList){for(var i in e.__webglCustomAttributesList)x.deleteBuffer(e.__webglCustomAttributesList[i].buffer);delete e.__webglCustomAttributesList}w.info.memory.geometries--},be=function(e){if(delete e.__webglInit,e instanceof q.BufferGeometry){for(var t in e.attributes){var n=e.attributes[t];void 0!==n.buffer&&(x.deleteBuffer(n.buffer),delete n.buffer)}w.info.memory.geometries--}else{var r=Ne[e.id];if(void 0!==r){for(var i=0,o=r.length;i<o;i++){var s=r[i];if(void 0!==s.numMorphTargets){for(var a=0,l=s.numMorphTargets;a<l;a++)x.deleteBuffer(s.__webglMorphTargetsBuffers[a]);delete s.__webglMorphTargetsBuffers}if(void 0!==s.numMorphNormals){for(a=0,l=s.numMorphNormals;a<l;a++)x.deleteBuffer(s.__webglMorphNormalsBuffers[a]);delete s.__webglMorphNormalsBuffers}_e(s)}delete Ne[e.id]}else _e(e)}T=""},xe=function(e){if(e.image&&e.image.__webglTextureCube)x.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;x.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},we=function(e){if(e&&void 0!==e.__webglTexture){if(x.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof q.WebGLRenderTargetCube)for(var t=0;t<6;t++)x.deleteFramebuffer(e.__webglFramebuffer[t]),x.deleteRenderbuffer(e.__webglRenderbuffer[t]);else x.deleteFramebuffer(e.__webglFramebuffer),x.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Ee=function(e){var t=e.program.program;if(void 0!==t){var n,r,i;e.program=void 0;var o=!1;for(n=0,r=E.length;n<r;n++)if((i=E[n]).program===t){i.usedTimes--,0===i.usedTimes&&(o=!0);break}if(!0===o){var s=[];for(n=0,r=E.length;n<r;n++)(i=E[n]).program!==t&&s.push(i);E=s,x.deleteProgram(t),w.info.memory.programs--}}};function Ae(e){var t=e.geometry,n=e.material,r=t.vertices.length;if(n.attributes)for(var i in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),n.attributes){var o=n.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(r*s),o.buffer=x.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}function Me(e,t){var n=t.geometry,r=e.faces3,i=3*r.length,o=1*r.length,s=3*r.length,a=Se(t,e);e.__vertexArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__uvArray=new Float32Array(2*i),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*i)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*i)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*i),e.__skinWeightArray=new Float32Array(4*i));var l=null!==H.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=l,e.__faceArray=new l(3*o),e.__lineArray=new l(2*s);var c=e.numMorphTargets;if(c){e.__morphTargetsArrays=[];for(var u=0,d=c;u<d;u++)e.__morphTargetsArrays.push(new Float32Array(3*i))}var h=e.numMorphNormals;if(h){e.__morphNormalsArrays=[];for(u=0,d=h;u<d;u++)e.__morphNormalsArrays.push(new Float32Array(3*i))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes)for(var f in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),a.attributes){var p=a.attributes[f],m={};for(var g in p)m[g]=p[g];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var v=1;"v2"===m.type?v=2:"v3"===m.type?v=3:"v4"===m.type?v=4:"c"===m.type&&(v=3),m.size=v,m.array=new Float32Array(i*v),m.buffer=x.createBuffer(),m.buffer.belongsToAttribute=f,p.needsUpdate=!0,m.__original=p}e.__webglCustomAttributesList.push(m)}e.__inittedArrays=!0}function Se(e,t){return e.material instanceof q.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Te(e,t,n,r,i){if(e.__inittedArrays){var o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,w,E,A,M,S,T,C,P,L,D,R,I,j,O,N,k,F,V,B,U,z,G,H,W,X,Y=function(e){return e instanceof q.MeshPhongMaterial==!1&&e.shading===q.FlatShading}(i),K=0,Q=0,Z=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,oe=0,se=0,ae=e.__vertexArray,le=e.__uvArray,ce=e.__uv2Array,ue=e.__normalArray,de=e.__tangentArray,he=e.__colorArray,fe=e.__skinIndexArray,pe=e.__skinWeightArray,me=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,ve=e.__webglCustomAttributesList,ye=e.__faceArray,_e=e.__lineArray,be=t.geometry,xe=be.verticesNeedUpdate,we=be.elementsNeedUpdate,Ee=be.uvsNeedUpdate,Ae=be.normalsNeedUpdate,Me=be.tangentsNeedUpdate,Se=be.colorsNeedUpdate,Te=be.morphTargetsNeedUpdate,Ce=be.vertices,Pe=e.faces3,Le=be.faces,De=be.faceVertexUvs[0],Re=be.faceVertexUvs[1],Ie=be.skinIndices,je=be.skinWeights,Oe=be.morphTargets,Ne=be.morphNormals;if(xe){for(o=0,s=Pe.length;o<s;o++)m=Ce[(a=Le[Pe[o]]).a],g=Ce[a.b],v=Ce[a.c],ae[Q]=m.x,ae[Q+1]=m.y,ae[Q+2]=m.z,ae[Q+3]=g.x,ae[Q+4]=g.y,ae[Q+5]=g.z,ae[Q+6]=v.x,ae[Q+7]=v.y,ae[Q+8]=v.z,Q+=9;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,ae,n)}if(Te)for(V=0,B=Oe.length;V<B;V++){for(oe=0,o=0,s=Pe.length;o<s;o++)a=Le[G=Pe[o]],m=Oe[V].vertices[a.a],g=Oe[V].vertices[a.b],v=Oe[V].vertices[a.c],(U=me[V])[oe]=m.x,U[oe+1]=m.y,U[oe+2]=m.z,U[oe+3]=g.x,U[oe+4]=g.y,U[oe+5]=g.z,U[oe+6]=v.x,U[oe+7]=v.y,U[oe+8]=v.z,i.morphNormals&&(Y?(E=w=Ne[V].faceNormals[G],A=w):(w=(H=Ne[V].vertexNormals[G]).a,E=H.b,A=H.c),(z=ge[V])[oe]=w.x,z[oe+1]=w.y,z[oe+2]=w.z,z[oe+3]=E.x,z[oe+4]=E.y,z[oe+5]=E.z,z[oe+6]=A.x,z[oe+7]=A.y,z[oe+8]=A.z),oe+=9;x.bindBuffer(x.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[V]),x.bufferData(x.ARRAY_BUFFER,me[V],n),i.morphNormals&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[V]),x.bufferData(x.ARRAY_BUFFER,ge[V],n))}if(je.length){for(o=0,s=Pe.length;o<s;o++)C=je[(a=Le[Pe[o]]).a],P=je[a.b],L=je[a.c],pe[ie]=C.x,pe[ie+1]=C.y,pe[ie+2]=C.z,pe[ie+3]=C.w,pe[ie+4]=P.x,pe[ie+5]=P.y,pe[ie+6]=P.z,pe[ie+7]=P.w,pe[ie+8]=L.x,pe[ie+9]=L.y,pe[ie+10]=L.z,pe[ie+11]=L.w,D=Ie[a.a],R=Ie[a.b],I=Ie[a.c],fe[ie]=D.x,fe[ie+1]=D.y,fe[ie+2]=D.z,fe[ie+3]=D.w,fe[ie+4]=R.x,fe[ie+5]=R.y,fe[ie+6]=R.z,fe[ie+7]=R.w,fe[ie+8]=I.x,fe[ie+9]=I.y,fe[ie+10]=I.z,fe[ie+11]=I.w,ie+=12;ie>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),x.bufferData(x.ARRAY_BUFFER,fe,n),x.bindBuffer(x.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),x.bufferData(x.ARRAY_BUFFER,pe,n))}if(Se){for(o=0,s=Pe.length;o<s;o++)u=(a=Le[Pe[o]]).vertexColors,d=a.color,3===u.length&&i.vertexColors===q.VertexColors?(M=u[0],S=u[1],T=u[2]):(M=d,S=d,T=d),he[re]=M.r,he[re+1]=M.g,he[re+2]=M.b,he[re+3]=S.r,he[re+4]=S.g,he[re+5]=S.b,he[re+6]=T.r,he[re+7]=T.g,he[re+8]=T.b,re+=9;re>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,he,n))}if(Me&&be.hasTangents){for(o=0,s=Pe.length;o<s;o++)y=(h=(a=Le[Pe[o]]).vertexTangents)[0],_=h[1],b=h[2],de[te]=y.x,de[te+1]=y.y,de[te+2]=y.z,de[te+3]=y.w,de[te+4]=_.x,de[te+5]=_.y,de[te+6]=_.z,de[te+7]=_.w,de[te+8]=b.x,de[te+9]=b.y,de[te+10]=b.z,de[te+11]=b.w,te+=12;x.bindBuffer(x.ARRAY_BUFFER,e.__webglTangentBuffer),x.bufferData(x.ARRAY_BUFFER,de,n)}if(Ae){for(o=0,s=Pe.length;o<s;o++)if(l=(a=Le[Pe[o]]).vertexNormals,c=a.normal,3===l.length&&!1===Y)for(j=0;j<3;j++)N=l[j],ue[ee]=N.x,ue[ee+1]=N.y,ue[ee+2]=N.z,ee+=3;else for(j=0;j<3;j++)ue[ee]=c.x,ue[ee+1]=c.y,ue[ee+2]=c.z,ee+=3;x.bindBuffer(x.ARRAY_BUFFER,e.__webglNormalBuffer),x.bufferData(x.ARRAY_BUFFER,ue,n)}if(Ee&&De){for(o=0,s=Pe.length;o<s;o++)if(void 0!==(f=De[Pe[o]]))for(j=0;j<3;j++)k=f[j],le[Z]=k.x,le[Z+1]=k.y,Z+=2;Z>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUVBuffer),x.bufferData(x.ARRAY_BUFFER,le,n))}if(Ee&&Re){for(o=0,s=Pe.length;o<s;o++)if(void 0!==(p=Re[Pe[o]]))for(j=0;j<3;j++)F=p[j],ce[J]=F.x,ce[J+1]=F.y,J+=2;J>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUV2Buffer),x.bufferData(x.ARRAY_BUFFER,ce,n))}if(we){for(o=0,s=Pe.length;o<s;o++)ye[$]=K,ye[$+1]=K+1,ye[$+2]=K+2,$+=3,_e[ne]=K,_e[ne+1]=K+1,_e[ne+2]=K,_e[ne+3]=K+2,_e[ne+4]=K+1,_e[ne+5]=K+2,ne+=6,K+=3;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,ye,n),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,_e,n)}if(ve)for(j=0,O=ve.length;j<O;j++)if((X=ve[j]).__original.needsUpdate){if(se=0,1===X.size){if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)a=Le[Pe[o]],X.array[se]=X.value[a.a],X.array[se+1]=X.value[a.b],X.array[se+2]=X.value[a.c],se+=3;else if("faces"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)W=X.value[Pe[o]],X.array[se]=W,X.array[se+1]=W,X.array[se+2]=W,se+=3}else if(2===X.size){if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)a=Le[Pe[o]],m=X.value[a.a],g=X.value[a.b],v=X.value[a.c],X.array[se]=m.x,X.array[se+1]=m.y,X.array[se+2]=g.x,X.array[se+3]=g.y,X.array[se+4]=v.x,X.array[se+5]=v.y,se+=6;else if("faces"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)m=W=X.value[Pe[o]],g=W,v=W,X.array[se]=m.x,X.array[se+1]=m.y,X.array[se+2]=g.x,X.array[se+3]=g.y,X.array[se+4]=v.x,X.array[se+5]=v.y,se+=6}else if(3===X.size){var ke;if(ke="c"===X.type?["r","g","b"]:["x","y","z"],void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)a=Le[Pe[o]],m=X.value[a.a],g=X.value[a.b],v=X.value[a.c],X.array[se]=m[ke[0]],X.array[se+1]=m[ke[1]],X.array[se+2]=m[ke[2]],X.array[se+3]=g[ke[0]],X.array[se+4]=g[ke[1]],X.array[se+5]=g[ke[2]],X.array[se+6]=v[ke[0]],X.array[se+7]=v[ke[1]],X.array[se+8]=v[ke[2]],se+=9;else if("faces"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)m=W=X.value[Pe[o]],g=W,v=W,X.array[se]=m[ke[0]],X.array[se+1]=m[ke[1]],X.array[se+2]=m[ke[2]],X.array[se+3]=g[ke[0]],X.array[se+4]=g[ke[1]],X.array[se+5]=g[ke[2]],X.array[se+6]=v[ke[0]],X.array[se+7]=v[ke[1]],X.array[se+8]=v[ke[2]],se+=9;else if("faceVertices"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)m=(W=X.value[Pe[o]])[0],g=W[1],v=W[2],X.array[se]=m[ke[0]],X.array[se+1]=m[ke[1]],X.array[se+2]=m[ke[2]],X.array[se+3]=g[ke[0]],X.array[se+4]=g[ke[1]],X.array[se+5]=g[ke[2]],X.array[se+6]=v[ke[0]],X.array[se+7]=v[ke[1]],X.array[se+8]=v[ke[2]],se+=9}else if(4===X.size)if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)a=Le[Pe[o]],m=X.value[a.a],g=X.value[a.b],v=X.value[a.c],X.array[se]=m.x,X.array[se+1]=m.y,X.array[se+2]=m.z,X.array[se+3]=m.w,X.array[se+4]=g.x,X.array[se+5]=g.y,X.array[se+6]=g.z,X.array[se+7]=g.w,X.array[se+8]=v.x,X.array[se+9]=v.y,X.array[se+10]=v.z,X.array[se+11]=v.w,se+=12;else if("faces"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)m=W=X.value[Pe[o]],g=W,v=W,X.array[se]=m.x,X.array[se+1]=m.y,X.array[se+2]=m.z,X.array[se+3]=m.w,X.array[se+4]=g.x,X.array[se+5]=g.y,X.array[se+6]=g.z,X.array[se+7]=g.w,X.array[se+8]=v.x,X.array[se+9]=v.y,X.array[se+10]=v.z,X.array[se+11]=v.w,se+=12;else if("faceVertices"===X.boundTo)for(o=0,s=Pe.length;o<s;o++)m=(W=X.value[Pe[o]])[0],g=W[1],v=W[2],X.array[se]=m.x,X.array[se+1]=m.y,X.array[se+2]=m.z,X.array[se+3]=m.w,X.array[se+4]=g.x,X.array[se+5]=g.y,X.array[se+6]=g.z,X.array[se+7]=g.w,X.array[se+8]=v.x,X.array[se+9]=v.y,X.array[se+10]=v.z,X.array[se+11]=v.w,se+=12;x.bindBuffer(x.ARRAY_BUFFER,X.buffer),x.bufferData(x.ARRAY_BUFFER,X.array,n)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Ce(e,t,n,r){for(var i=n.attributes,o=t.attributes,s=t.attributesKeys,a=0,l=s.length;a<l;a++){var c=s[a],u=o[c];if(u>=0){var d=i[c];if(void 0!==d){var h=d.itemSize;x.bindBuffer(x.ARRAY_BUFFER,d.buffer),G.enableAttribute(u),x.vertexAttribPointer(u,h,x.FLOAT,!1,0,r*h*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[c].length?x.vertexAttrib2fv(u,e.defaultAttributeValues[c]):3===e.defaultAttributeValues[c].length&&x.vertexAttrib3fv(u,e.defaultAttributeValues[c]))}}G.disableUnusedAttributes()}function Pe(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Le(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function De(e,t){return t[0]-e[0]}function Re(e,t,n,r,i){for(var o,s=0,a=e.length;s<a;s++){var l=e[s],c=l.object,u=l.buffer;if(Qe(c,t),i)o=i;else{if(!(o=l.material))continue;We(o)}w.setMaterialFaces(o),u instanceof q.BufferGeometry?w.renderBufferDirect(t,n,r,o,u,c):w.renderBuffer(t,n,r,o,u,c)}}function Ie(e,t,n,r,i,o){for(var s,a=0,l=e.length;a<l;a++){var c=e[a],u=c.object;if(u.visible){if(o)s=o;else{if(!(s=c[t]))continue;We(s)}w.renderImmediateObject(n,r,i,s,u)}}}function je(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Oe(e){var t=e.object,n=e.buffer,r=t.geometry,i=t.material;if(i instanceof q.MeshFaceMaterial){var o=r instanceof q.BufferGeometry?0:n.materialIndex;i=i.materials[o],e.material=i,i.transparent?y.push(e):v.push(e)}else i&&(e.material=i,i.transparent?y.push(e):v.push(e))}this.renderBufferImmediate=function(e,t,n){if(G.initAttributes(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=x.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=x.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=x.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=x.createBuffer()),e.hasPositions&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,e.positionArray,x.DYNAMIC_DRAW),G.enableAttribute(t.attributes.position),x.vertexAttribPointer(t.attributes.position,3,x.FLOAT,!1,0,0)),e.hasNormals){if(x.bindBuffer(x.ARRAY_BUFFER,e.__webglNormalBuffer),n instanceof q.MeshPhongMaterial==!1&&n.shading===q.FlatShading){var r,i,o,s,a,l,c,u,d,h,f,p=3*e.count;for(f=0;f<p;f+=9)s=(h=e.normalArray)[f],l=h[f+1],u=h[f+2],a=h[f+3],c=h[f+4],d=h[f+5],r=(s+a+h[f+6])/3,i=(l+c+h[f+7])/3,o=(u+d+h[f+8])/3,h[f]=r,h[f+1]=i,h[f+2]=o,h[f+3]=r,h[f+4]=i,h[f+5]=o,h[f+6]=r,h[f+7]=i,h[f+8]=o}x.bufferData(x.ARRAY_BUFFER,e.normalArray,x.DYNAMIC_DRAW),G.enableAttribute(t.attributes.normal),x.vertexAttribPointer(t.attributes.normal,3,x.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUvBuffer),x.bufferData(x.ARRAY_BUFFER,e.uvArray,x.DYNAMIC_DRAW),G.enableAttribute(t.attributes.uv),x.vertexAttribPointer(t.attributes.uv,2,x.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==q.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,e.colorArray,x.DYNAMIC_DRAW),G.enableAttribute(t.attributes.color),x.vertexAttribPointer(t.attributes.color,3,x.FLOAT,!1,0,0)),G.disableUnusedAttributes(),x.drawArrays(x.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,o,s){if(!1!==i.visible){Be(s);var a=Xe(e,t,n,i,s),l=!1,c=i.wireframe?1:0,u="direct_"+o.id+"_"+a.id+"_"+c;if(u!==T&&(T=u,l=!0),l&&G.initAttributes(),s instanceof q.Mesh){var d=!0===i.wireframe?x.LINES:x.TRIANGLES;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&H.get("OES_element_index_uint")?(v=x.UNSIGNED_INT,y=4):(v=x.UNSIGNED_SHORT,y=2),0===(_=o.offsets).length)l&&(Ce(i,a,o,0),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(d,g.array.length,v,0),w.info.render.calls++,w.info.render.vertices+=g.array.length,w.info.render.faces+=g.array.length/3;else{l=!0;for(var h=0,f=_.length;h<f;h++){var p=_[h].index;l&&(Ce(i,a,o,p),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(d,_[h].count,v,_[h].start*y),w.info.render.calls++,w.info.render.vertices+=_[h].count,w.info.render.faces+=_[h].count/3}}}else{l&&Ce(i,a,o,0);var m=o.attributes.position;x.drawArrays(d,0,m.array.length/m.itemSize),w.info.render.calls++,w.info.render.vertices+=m.array.length/m.itemSize,w.info.render.faces+=m.array.length/(3*m.itemSize)}}else if(s instanceof q.PointCloud){d=x.POINTS;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&H.get("OES_element_index_uint")?(v=x.UNSIGNED_INT,y=4):(v=x.UNSIGNED_SHORT,y=2),0===(_=o.offsets).length)l&&(Ce(i,a,o,0),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(d,g.array.length,v,0),w.info.render.calls++,w.info.render.points+=g.array.length;else{_.length>1&&(l=!0);for(h=0,f=_.length;h<f;h++){p=_[h].index;l&&(Ce(i,a,o,p),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(d,_[h].count,v,_[h].start*y),w.info.render.calls++,w.info.render.points+=_[h].count}}}else{l&&Ce(i,a,o,0);m=o.attributes.position;if(0===(_=o.offsets).length)x.drawArrays(d,0,m.array.length/3),w.info.render.calls++,w.info.render.points+=m.array.length/3;else for(h=0,f=_.length;h<f;h++)x.drawArrays(d,_[h].index,_[h].count),w.info.render.calls++,w.info.render.points+=_[h].count}}else if(s instanceof q.Line){var g;d=s.mode===q.LineStrip?x.LINE_STRIP:x.LINES;if(G.setLineWidth(i.linewidth*r),g=o.attributes.index){var v,y;if(g.array instanceof Uint32Array?(v=x.UNSIGNED_INT,y=4):(v=x.UNSIGNED_SHORT,y=2),0===(_=o.offsets).length)l&&(Ce(i,a,o,0),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(d,g.array.length,v,0),w.info.render.calls++,w.info.render.vertices+=g.array.length;else{_.length>1&&(l=!0);for(h=0,f=_.length;h<f;h++){p=_[h].index;l&&(Ce(i,a,o,p),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(d,_[h].count,v,_[h].start*y),w.info.render.calls++,w.info.render.vertices+=_[h].count}}}else{l&&Ce(i,a,o,0);var _;m=o.attributes.position;if(0===(_=o.offsets).length)x.drawArrays(d,0,m.array.length/3),w.info.render.calls++,w.info.render.vertices+=m.array.length/3;else for(h=0,f=_.length;h<f;h++)x.drawArrays(d,_[h].index,_[h].count),w.info.render.calls++,w.info.render.vertices+=_[h].count}}}},this.renderBuffer=function(e,t,n,i,o,s){if(!1!==i.visible){Be(s);var a=Xe(e,t,n,i,s),l=a.attributes,c=!1,u=i.wireframe?1:0,d=o.id+"_"+a.id+"_"+u;if(d!==T&&(T=d,c=!0),c&&G.initAttributes(),!i.morphTargets&&l.position>=0?c&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglVertexBuffer),G.enableAttribute(l.position),x.vertexAttribPointer(l.position,3,x.FLOAT,!1,0,0)):s.morphTargetBase&&function(e,t,n){var r=e.program.attributes;-1!==n.morphTargetBase&&r.position>=0?(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]),G.enableAttribute(r.position),x.vertexAttribPointer(r.position,3,x.FLOAT,!1,0,0)):r.position>=0&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglVertexBuffer),G.enableAttribute(r.position),x.vertexAttribPointer(r.position,3,x.FLOAT,!1,0,0));if(n.morphTargetForcedOrder.length)for(var i=0,o=n.morphTargetForcedOrder,s=n.morphTargetInfluences;i<e.numSupportedMorphTargets&&i<o.length;)(a=r["morphTarget"+i])>=0&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[i]]),G.enableAttribute(a),x.vertexAttribPointer(a,3,x.FLOAT,!1,0,0)),(a=r["morphNormal"+i])>=0&&e.morphNormals&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[i]]),G.enableAttribute(a),x.vertexAttribPointer(a,3,x.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=s[o[i]],i++;else{var a,l=[],c=(s=n.morphTargetInfluences,n.geometry.morphTargets);s.length>c.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),s.length=c.length);for(var u=0,d=s.length;u<d;u++){var h=s[u];l.push([h,u])}l.length>e.numSupportedMorphTargets?(l.sort(De),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(De):0===l.length&&l.push([0,0]);i=0;for(var f=e.numSupportedMorphTargets;i<f;i++)if(l[i]){var p=l[i][1];(a=r["morphTarget"+i])>=0&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]),G.enableAttribute(a),x.vertexAttribPointer(a,3,x.FLOAT,!1,0,0)),(a=r["morphNormal"+i])>=0&&e.morphNormals&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[p]),G.enableAttribute(a),x.vertexAttribPointer(a,3,x.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=s[p]}else n.__webglMorphTargetInfluences[i]=0}null!==e.program.uniforms.morphTargetInfluences&&x.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}(i,o,s),c){if(o.__webglCustomAttributesList)for(var h=0,f=o.__webglCustomAttributesList.length;h<f;h++){var p=o.__webglCustomAttributesList[h];l[p.buffer.belongsToAttribute]>=0&&(x.bindBuffer(x.ARRAY_BUFFER,p.buffer),G.enableAttribute(l[p.buffer.belongsToAttribute]),x.vertexAttribPointer(l[p.buffer.belongsToAttribute],p.size,x.FLOAT,!1,0,0))}l.color>=0&&(s.geometry.colors.length>0||s.geometry.faces.length>0?(x.bindBuffer(x.ARRAY_BUFFER,o.__webglColorBuffer),G.enableAttribute(l.color),x.vertexAttribPointer(l.color,3,x.FLOAT,!1,0,0)):void 0!==i.defaultAttributeValues&&x.vertexAttrib3fv(l.color,i.defaultAttributeValues.color)),l.normal>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglNormalBuffer),G.enableAttribute(l.normal),x.vertexAttribPointer(l.normal,3,x.FLOAT,!1,0,0)),l.tangent>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglTangentBuffer),G.enableAttribute(l.tangent),x.vertexAttribPointer(l.tangent,4,x.FLOAT,!1,0,0)),l.uv>=0&&(s.geometry.faceVertexUvs[0]?(x.bindBuffer(x.ARRAY_BUFFER,o.__webglUVBuffer),G.enableAttribute(l.uv),x.vertexAttribPointer(l.uv,2,x.FLOAT,!1,0,0)):void 0!==i.defaultAttributeValues&&x.vertexAttrib2fv(l.uv,i.defaultAttributeValues.uv)),l.uv2>=0&&(s.geometry.faceVertexUvs[1]?(x.bindBuffer(x.ARRAY_BUFFER,o.__webglUV2Buffer),G.enableAttribute(l.uv2),x.vertexAttribPointer(l.uv2,2,x.FLOAT,!1,0,0)):void 0!==i.defaultAttributeValues&&x.vertexAttrib2fv(l.uv2,i.defaultAttributeValues.uv2)),i.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),G.enableAttribute(l.skinIndex),x.vertexAttribPointer(l.skinIndex,4,x.FLOAT,!1,0,0),x.bindBuffer(x.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),G.enableAttribute(l.skinWeight),x.vertexAttribPointer(l.skinWeight,4,x.FLOAT,!1,0,0)),l.lineDistance>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglLineDistanceBuffer),G.enableAttribute(l.lineDistance),x.vertexAttribPointer(l.lineDistance,1,x.FLOAT,!1,0,0))}if(G.disableUnusedAttributes(),s instanceof q.Mesh){var m=o.__typeArray===Uint32Array?x.UNSIGNED_INT:x.UNSIGNED_SHORT;i.wireframe?(G.setLineWidth(i.wireframeLinewidth*r),c&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),x.drawElements(x.LINES,o.__webglLineCount,m,0)):(c&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),x.drawElements(x.TRIANGLES,o.__webglFaceCount,m,0)),w.info.render.calls++,w.info.render.vertices+=o.__webglFaceCount,w.info.render.faces+=o.__webglFaceCount/3}else if(s instanceof q.Line){var g=s.mode===q.LineStrip?x.LINE_STRIP:x.LINES;G.setLineWidth(i.linewidth*r),x.drawArrays(g,0,o.__webglLineCount),w.info.render.calls++}else s instanceof q.PointCloud&&(x.drawArrays(x.POINTS,0,o.__webglParticleCount),w.info.render.calls++,w.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,n,r){if(t instanceof q.Camera!=!1){var i=e.fog;T="",S=-1,C=null,B=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse((function(e){e instanceof q.SkinnedMesh&&e.skeleton.update()})),t.matrixWorldInverse.getInverse(t.matrixWorld),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromMatrix(k),p.length=0,v.length=0,y.length=0,_.length=0,b.length=0,function e(t){if(!1===t.visible)return;if(t instanceof q.Scene||t instanceof q.Group);else if(function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new q.Matrix4,e._normalMatrix=new q.Matrix3,e.addEventListener("removed",pe));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",me),t instanceof q.BufferGeometry?w.info.memory.geometries++:e instanceof q.Mesh?Fe(e,t):e instanceof q.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),e.__webglLineDistanceBuffer=x.createBuffer(),w.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__lineDistanceArray=new Float32Array(1*n),e.__webglLineCount=n,Ae(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof q.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),w.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__webglParticleCount=n,Ae(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof q.Mesh){if(t instanceof q.BufferGeometry)Ve(m,t,e);else if(t instanceof q.Geometry)for(var n=Ne[t.id],r=0,i=n.length;r<i;r++)Ve(m,n[r],e)}else e instanceof q.Line||e instanceof q.PointCloud?Ve(m,t,e):(e instanceof q.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}(g,e)}(t),t instanceof q.Light)p.push(t);else if(t instanceof q.Sprite)_.push(t);else if(t instanceof q.LensFlare)b.push(t);else{var n=m[t.id];if(n&&(!1===t.frustumCulled||!0===N.intersectsObject(t)))for(var r=0,i=n.length;r<i;r++){var o=n[r];Oe(o),o.render=!0,!0===w.sortObjects&&(F.setFromMatrixPosition(t.matrixWorld),F.applyProjection(k),o.z=F.z)}}for(r=0,i=t.children.length;r<i;r++)e(t.children[r])}(e),!0===w.sortObjects&&(v.sort(Pe),y.sort(Le)),ue.render(e,t),w.info.render.calls=0,w.info.render.vertices=0,w.info.render.faces=0,w.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var o=0,s=g.length;o<s;o++){var a=g[o],l=a.object;l.visible&&(Qe(l,t),je(a))}if(e.overrideMaterial){var c=e.overrideMaterial;We(c),Re(v,t,p,i,c),Re(y,t,p,i,c),Ie(g,"",t,p,i,c)}else G.setBlending(q.NoBlending),Re(v,t,p,i,null),Ie(g,"opaque",t,p,i,null),Re(y,t,p,i,null),Ie(g,"transparent",t,p,i,null);de.render(e,t),he.render(e,t,j,O),n&&n.generateMipmaps&&n.minFilter!==q.NearestFilter&&n.minFilter!==q.LinearFilter&&function(e){e instanceof q.WebGLRenderTargetCube?(x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture),x.generateMipmap(x.TEXTURE_CUBE_MAP),x.bindTexture(x.TEXTURE_CUBE_MAP,null)):(x.bindTexture(x.TEXTURE_2D,e.__webglTexture),x.generateMipmap(x.TEXTURE_2D),x.bindTexture(x.TEXTURE_2D,null))}(n),G.setDepthTest(!0),G.setDepthWrite(!0),G.setColorWrite(!0)}else q.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,n,r,i){var o=Xe(e,t,n,r,i);T="",w.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(o,x,N):i.render((function(e){w.renderBufferImmediate(e,o,r)}))};var Ne={},ke=0;function Fe(e,t){var n=e.material,r=!1;void 0!==Ne[t.id]&&!0!==t.groupsNeedUpdate||(delete m[e.id],Ne[t.id]=function(e,t){for(var n,r,i=H.get("OES_element_index_uint")?4294967296:65535,o={},s=e.morphTargets.length,a=e.morphNormals.length,l={},c=[],u=0,d=e.faces.length;u<d;u++){var h=e.faces[u],f=t?h.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),(n=o[f].hash+"_"+o[f].counter)in l||(r={id:ke++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:s,numMorphNormals:a},l[n]=r,c.push(r)),l[n].vertices+3>i&&(o[f].counter+=1,(n=o[f].hash+"_"+o[f].counter)in l||(r={id:ke++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:s,numMorphNormals:a},l[n]=r,c.push(r))),l[n].faces3.push(u),l[n].vertices+=3}return c}(t,n instanceof q.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var i=Ne[t.id],o=0,s=i.length;o<s;o++){var a=i[o];void 0===a.__webglVertexBuffer?(fe(a),Me(a,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,r=!0):r=!1,(r||void 0===e.__webglActive)&&Ve(m,a,e)}e.__webglActive=!0}function Ve(e,t,n){var r=n.id;e[r]=e[r]||[],e[r].push({id:r,buffer:t,object:n,material:null,z:0})}function Be(e){var t=e.geometry;if(t instanceof q.BufferGeometry)for(var n=t.attributes,r=t.attributesKeys,i=0,o=r.length;i<o;i++){var s=r[i],a=n[s],l="index"===s?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER;void 0===a.buffer?(a.buffer=x.createBuffer(),x.bindBuffer(l,a.buffer),x.bufferData(l,a.array,a instanceof q.DynamicBufferAttribute?x.DYNAMIC_DRAW:x.STATIC_DRAW),a.needsUpdate=!1):!0===a.needsUpdate&&(x.bindBuffer(l,a.buffer),void 0===a.updateRange||-1===a.updateRange.count?x.bufferSubData(l,0,a.array):0===a.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(x.bufferSubData(l,a.updateRange.offset*a.array.BYTES_PER_ELEMENT,a.array.subarray(a.updateRange.offset,a.updateRange.offset+a.updateRange.count)),a.updateRange.count=0),a.needsUpdate=!1)}else if(e instanceof q.Mesh){!0===t.groupsNeedUpdate&&Fe(e,t);for(var c=Ne[t.id],u=(i=0,c.length);i<u;i++){var d=c[i],h=(f=Se(e,d)).attributes&&Ue(f);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||h)&&Te(d,e,x.DYNAMIC_DRAW,!t.dynamic,f)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,f.attributes&&ze(f)}else if(e instanceof q.Line){h=(f=Se(e,t)).attributes&&Ue(f);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||h)&&function(e,t){var n,r,i,o,s,a,l,c,u,d,h,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,_=g.length,b=e.__vertexArray,w=e.__colorArray,E=e.__lineDistanceArray,A=e.verticesNeedUpdate,M=e.colorsNeedUpdate,S=e.lineDistancesNeedUpdate,T=e.__webglCustomAttributesList;if(A){for(n=0;n<v;n++)o=p[n],b[s=3*n]=o.x,b[s+1]=o.y,b[s+2]=o.z;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,b,t)}if(M){for(r=0;r<y;r++)a=m[r],w[s=3*r]=a.r,w[s+1]=a.g,w[s+2]=a.b;x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,w,t)}if(S){for(i=0;i<_;i++)E[i]=g[i];x.bindBuffer(x.ARRAY_BUFFER,e.__webglLineDistanceBuffer),x.bufferData(x.ARRAY_BUFFER,E,t)}if(T)for(l=0,c=T.length;l<c;l++)if((f=T[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(s=0,d=f.value.length,1===f.size)for(u=0;u<d;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.r,f.array[s+1]=h.g,f.array[s+2]=h.b,s+=3;else for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,f.array[s+2]=h.z,s+=3;else if(4===f.size)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,f.array[s+2]=h.z,f.array[s+3]=h.w,s+=4;x.bindBuffer(x.ARRAY_BUFFER,f.buffer),x.bufferData(x.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}(t,x.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,f.attributes&&ze(f)}else if(e instanceof q.PointCloud){var f;h=(f=Se(e,t)).attributes&&Ue(f);(t.verticesNeedUpdate||t.colorsNeedUpdate||h)&&function(e,t,n){var r,i,o,s,a,l,c,u,d,h,f,p=e.vertices,m=p.length,g=e.colors,v=g.length,y=e.__vertexArray,_=e.__colorArray,b=e.verticesNeedUpdate,w=e.colorsNeedUpdate,E=e.__webglCustomAttributesList;if(b){for(r=0;r<m;r++)o=p[r],y[s=3*r]=o.x,y[s+1]=o.y,y[s+2]=o.z;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,y,t)}if(w){for(i=0;i<v;i++)a=g[i],_[s=3*i]=a.r,_[s+1]=a.g,_[s+2]=a.b;x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,_,t)}if(E)for(l=0,c=E.length;l<c;l++){if((f=E[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(d=f.value.length,s=0,1===f.size)for(u=0;u<d;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.r,f.array[s+1]=h.g,f.array[s+2]=h.b,s+=3;else for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,f.array[s+2]=h.z,s+=3;else if(4===f.size)for(u=0;u<d;u++)h=f.value[u],f.array[s]=h.x,f.array[s+1]=h.y,f.array[s+2]=h.z,f.array[s+3]=h.w,s+=4;x.bindBuffer(x.ARRAY_BUFFER,f.buffer),x.bufferData(x.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}(t,x.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,f.attributes&&ze(f)}}function Ue(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function ze(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}var Ge={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function He(e,t,n,r){e.addEventListener("dispose",ye);var o=Ge[e.type];if(o){var s=q.ShaderLib[o];e.__webglShader={uniforms:q.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var a=function(e){for(var t=0,n=0,r=0,i=0,o=0,s=e.length;o<s;o++){var a=e[o];a.onlyShadow||!1===a.visible||(a instanceof q.DirectionalLight&&t++,a instanceof q.PointLight&&n++,a instanceof q.SpotLight&&r++,a instanceof q.HemisphereLight&&i++)}return{directional:t,point:n,spot:r,hemi:i}}(t),l=function(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];i.castShadow&&(i instanceof q.SpotLight&&t++,i instanceof q.DirectionalLight&&!i.shadowCascade&&t++)}return t}(t),c=function(e){if(te&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=x.getParameter(x.MAX_VERTEX_UNIFORM_VECTORS),n=Math.floor((t-20)/4);return void 0!==e&&e instanceof q.SkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n))<e.skeleton.bones.length&&q.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)"),n}(r),u={precision:i,supportsVertexTextures:ee,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof q.FogExp2,flatShading:e.shading===q.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:d,skinning:e.skinning,maxBones:c,useVertexTexture:te&&r&&r.skeleton&&r.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:w.maxMorphTargets,maxMorphNormals:w.maxMorphNormals,maxDirLights:a.directional,maxPointLights:a.point,maxSpotLights:a.spot,maxHemiLights:a.hemi,maxShadows:l,shadowMapEnabled:w.shadowMapEnabled&&r.receiveShadow&&l>0,shadowMapType:w.shadowMapType,shadowMapDebug:w.shadowMapDebug,shadowMapCascade:w.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===q.DoubleSide,flipSided:e.side===q.BackSide},h=[];if(o?h.push(o):(h.push(e.fragmentShader),h.push(e.vertexShader)),void 0!==e.defines)for(var f in e.defines)h.push(f),h.push(e.defines[f]);for(var f in u)h.push(f),h.push(u[f]);for(var p,m=h.join(),g=0,v=E.length;g<v;g++){var y=E[g];if(y.code===m){(p=y).usedTimes++;break}}void 0===p&&(p=new q.WebGLProgram(w,m,e,u),E.push(p),w.info.memory.programs=E.length),e.program=p;var _=p.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var b="morphTarget",A=0;A<w.maxMorphTargets;A++)_[b+A]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;b="morphNormal";for(A=0;A<w.maxMorphNormals;A++)_[b+A]>=0&&e.numSupportedMorphNormals++}for(var M in e.uniformsList=[],e.__webglShader.uniforms){var S=e.program.uniforms[M];S&&e.uniformsList.push([e.__webglShader.uniforms[M],S])}}function We(e){!0===e.transparent?G.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):G.setBlending(q.NoBlending),G.setDepthTest(e.depthTest),G.setDepthWrite(e.depthWrite),G.setColorWrite(e.colorWrite),G.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Xe(e,n,r,i,o){P=0,i.needsUpdate&&(i.program&&Ee(i),He(i,n,r,o),i.needsUpdate=!1),i.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(w.maxMorphTargets)));var s=!1,a=!1,l=!1,c=i.program,u=c.uniforms,h=i.__webglShader.uniforms;if(c.id!==A&&(x.useProgram(c.program),A=c.id,s=!0,a=!0,l=!0),i.id!==S&&(-1===S&&(l=!0),S=i.id,a=!0),(s||e!==C)&&(x.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),d&&x.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==C&&(C=e),(i instanceof q.ShaderMaterial||i instanceof q.MeshPhongMaterial||i.envMap)&&null!==u.cameraPosition&&(F.setFromMatrixPosition(e.matrixWorld),x.uniform3f(u.cameraPosition,F.x,F.y,F.z)),(i instanceof q.MeshPhongMaterial||i instanceof q.MeshLambertMaterial||i instanceof q.MeshBasicMaterial||i instanceof q.ShaderMaterial||i.skinning)&&null!==u.viewMatrix&&x.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)),i.skinning)if(o.bindMatrix&&null!==u.bindMatrix&&x.uniformMatrix4fv(u.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==u.bindMatrixInverse&&x.uniformMatrix4fv(u.bindMatrixInverse,!1,o.bindMatrixInverse.elements),te&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==u.boneTexture){var f=Ke();x.uniform1i(u.boneTexture,f),w.setTexture(o.skeleton.boneTexture,f)}null!==u.boneTextureWidth&&x.uniform1i(u.boneTextureWidth,o.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&x.uniform1i(u.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==u.boneGlobalMatrices&&x.uniformMatrix4fv(u.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return a&&(r&&i.fog&&function(e,t){e.fogColor.value=t.color,t instanceof q.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof q.FogExp2&&(e.fogDensity.value=t.density)}(h,r),(i instanceof q.MeshPhongMaterial||i instanceof q.MeshLambertMaterial||i.lights)&&(B&&(l=!0,function(e){var t,n,r,i,o,s,a,l,c=0,u=0,d=0,h=U,f=h.directional.colors,p=h.directional.positions,m=h.point.colors,g=h.point.positions,v=h.point.distances,y=h.point.decays,_=h.spot.colors,b=h.spot.positions,x=h.spot.distances,w=h.spot.directions,E=h.spot.anglesCos,A=h.spot.exponents,M=h.spot.decays,S=h.hemi.skyColors,T=h.hemi.groundColors,C=h.hemi.positions,P=0,L=0,D=0,R=0,I=0,j=0,O=0,N=0,k=0,B=0,z=0,G=0;for(t=0,n=e.length;t<n;t++)if(!(r=e[t]).onlyShadow)if(i=r.color,a=r.intensity,l=r.distance,r instanceof q.AmbientLight){if(!r.visible)continue;c+=i.r,u+=i.g,d+=i.b}else if(r instanceof q.DirectionalLight){if(I+=1,!r.visible)continue;V.setFromMatrixPosition(r.matrixWorld),F.setFromMatrixPosition(r.target.matrixWorld),V.sub(F),V.normalize(),p[k=3*P]=V.x,p[k+1]=V.y,p[k+2]=V.z,Ze(f,k,i,a),P+=1}else if(r instanceof q.PointLight){if(j+=1,!r.visible)continue;Ze(m,B=3*L,i,a),F.setFromMatrixPosition(r.matrixWorld),g[B]=F.x,g[B+1]=F.y,g[B+2]=F.z,v[L]=l,y[L]=0===r.distance?0:r.decay,L+=1}else if(r instanceof q.SpotLight){if(O+=1,!r.visible)continue;Ze(_,z=3*D,i,a),V.setFromMatrixPosition(r.matrixWorld),b[z]=V.x,b[z+1]=V.y,b[z+2]=V.z,x[D]=l,F.setFromMatrixPosition(r.target.matrixWorld),V.sub(F),V.normalize(),w[z]=V.x,w[z+1]=V.y,w[z+2]=V.z,E[D]=Math.cos(r.angle),A[D]=r.exponent,M[D]=0===r.distance?0:r.decay,D+=1}else if(r instanceof q.HemisphereLight){if(N+=1,!r.visible)continue;V.setFromMatrixPosition(r.matrixWorld),V.normalize(),C[G=3*R]=V.x,C[G+1]=V.y,C[G+2]=V.z,o=r.color,s=r.groundColor,Ze(S,G,o,a),Ze(T,G,s,a),R+=1}for(t=3*P,n=Math.max(f.length,3*I);t<n;t++)f[t]=0;for(t=3*L,n=Math.max(m.length,3*j);t<n;t++)m[t]=0;for(t=3*D,n=Math.max(_.length,3*O);t<n;t++)_[t]=0;for(t=3*R,n=Math.max(S.length,3*N);t<n;t++)S[t]=0;for(t=3*R,n=Math.max(T.length,3*N);t<n;t++)T[t]=0;h.directional.length=P,h.point.length=L,h.spot.length=D,h.hemi.length=R,h.ambient[0]=c,h.ambient[1]=u,h.ambient[2]=d}(n),B=!1),l?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(h,U),Ye(h,!0)):Ye(h,!1)),(i instanceof q.MeshBasicMaterial||i instanceof q.MeshLambertMaterial||i instanceof q.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var n;t.map?n=t.map:t.specularMap?n=t.specularMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.alphaMap&&(n=t.alphaMap);if(void 0!==n){var r=n.offset,i=n.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof q.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(h,i),i instanceof q.LineBasicMaterial?qe(h,i):i instanceof q.LineDashedMaterial?(qe(h,i),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(h,i)):i instanceof q.PointCloudMaterial?function(e,n){if(e.psColor.value=n.color,e.opacity.value=n.opacity,e.size.value=n.size,e.scale.value=t.height/2,e.map.value=n.map,null!==n.map){var r=n.map.offset,i=n.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}(h,i):i instanceof q.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(h,i):i instanceof q.MeshLambertMaterial?function(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(h,i):i instanceof q.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=i.opacity):i instanceof q.MeshNormalMaterial&&(h.opacity.value=i.opacity),o.receiveShadow&&!i._shadowPass&&function(e,t){if(e.shadowMatrix)for(var n=0,r=0,i=t.length;r<i;r++){var o=t[r];o.castShadow&&((o instanceof q.SpotLight||o instanceof q.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[n]=o.shadowMap,e.shadowMapSize.value[n]=o.shadowMapSize,e.shadowMatrix.value[n]=o.shadowMatrix,e.shadowDarkness.value[n]=o.shadowDarkness,e.shadowBias.value[n]=o.shadowBias,n++))}}(h,n),function(e){for(var t,n,r,i=0,o=e.length;i<o;i++){var s=e[i][0];if(!1!==s.needsUpdate){var a=s.type,l=s.value,c=e[i][1];switch(a){case"1i":x.uniform1i(c,l);break;case"1f":x.uniform1f(c,l);break;case"2f":x.uniform2f(c,l[0],l[1]);break;case"3f":x.uniform3f(c,l[0],l[1],l[2]);break;case"4f":x.uniform4f(c,l[0],l[1],l[2],l[3]);break;case"1iv":x.uniform1iv(c,l);break;case"3iv":x.uniform3iv(c,l);break;case"1fv":x.uniform1fv(c,l);break;case"2fv":x.uniform2fv(c,l);break;case"3fv":x.uniform3fv(c,l);break;case"4fv":x.uniform4fv(c,l);break;case"Matrix3fv":x.uniformMatrix3fv(c,!1,l);break;case"Matrix4fv":x.uniformMatrix4fv(c,!1,l);break;case"i":x.uniform1i(c,l);break;case"f":x.uniform1f(c,l);break;case"v2":x.uniform2f(c,l.x,l.y);break;case"v3":x.uniform3f(c,l.x,l.y,l.z);break;case"v4":x.uniform4f(c,l.x,l.y,l.z,l.w);break;case"c":x.uniform3f(c,l.r,l.g,l.b);break;case"iv1":x.uniform1iv(c,l);break;case"iv":x.uniform3iv(c,l);break;case"fv1":x.uniform1fv(c,l);break;case"fv":x.uniform3fv(c,l);break;case"v2v":void 0===s._array&&(s._array=new Float32Array(2*l.length));for(var u=0,d=l.length;u<d;u++)r=2*u,s._array[r]=l[u].x,s._array[r+1]=l[u].y;x.uniform2fv(c,s._array);break;case"v3v":void 0===s._array&&(s._array=new Float32Array(3*l.length));for(u=0,d=l.length;u<d;u++)r=3*u,s._array[r]=l[u].x,s._array[r+1]=l[u].y,s._array[r+2]=l[u].z;x.uniform3fv(c,s._array);break;case"v4v":void 0===s._array&&(s._array=new Float32Array(4*l.length));for(u=0,d=l.length;u<d;u++)r=4*u,s._array[r]=l[u].x,s._array[r+1]=l[u].y,s._array[r+2]=l[u].z,s._array[r+3]=l[u].w;x.uniform4fv(c,s._array);break;case"m3":x.uniformMatrix3fv(c,!1,l.elements);break;case"m3v":void 0===s._array&&(s._array=new Float32Array(9*l.length));for(u=0,d=l.length;u<d;u++)l[u].flattenToArrayOffset(s._array,9*u);x.uniformMatrix3fv(c,!1,s._array);break;case"m4":x.uniformMatrix4fv(c,!1,l.elements);break;case"m4v":void 0===s._array&&(s._array=new Float32Array(16*l.length));for(u=0,d=l.length;u<d;u++)l[u].flattenToArrayOffset(s._array,16*u);x.uniformMatrix4fv(c,!1,s._array);break;case"t":if(t=l,n=Ke(),x.uniform1i(c,n),!t)continue;t instanceof q.CubeTexture||t.image instanceof Array&&6===t.image.length?et(t,n):t instanceof q.WebGLRenderTargetCube?tt(t,n):w.setTexture(t,n);break;case"tv":void 0===s._array&&(s._array=[]);for(u=0,d=s.value.length;u<d;u++)s._array[u]=Ke();x.uniform1iv(c,s._array);for(u=0,d=s.value.length;u<d;u++)t=s.value[u],n=s._array[u],t&&w.setTexture(t,n);break;default:q.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}(i.uniformsList)),function(e,t){x.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&x.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}(u,o),null!==u.modelMatrix&&x.uniformMatrix4fv(u.modelMatrix,!1,o.matrixWorld.elements),c}function qe(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Ye(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Ke(){var e=P;return e>=Q&&q.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Q),P+=1,e}function Qe(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Ze(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function Je(e,t,n){var r;n?(x.texParameteri(e,x.TEXTURE_WRAP_S,ot(t.wrapS)),x.texParameteri(e,x.TEXTURE_WRAP_T,ot(t.wrapT)),x.texParameteri(e,x.TEXTURE_MAG_FILTER,ot(t.magFilter)),x.texParameteri(e,x.TEXTURE_MIN_FILTER,ot(t.minFilter))):(x.texParameteri(e,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(e,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),t.wrapS===q.ClampToEdgeWrapping&&t.wrapT===q.ClampToEdgeWrapping||q.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),x.texParameteri(e,x.TEXTURE_MAG_FILTER,it(t.magFilter)),x.texParameteri(e,x.TEXTURE_MIN_FILTER,it(t.minFilter)),t.minFilter!==q.NearestFilter&&t.minFilter!==q.LinearFilter&&q.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(r=H.get("EXT_texture_filter_anisotropic"))&&t.type!==q.FloatType&&t.type!==q.HalfFloatType&&(t.anisotropy>1||t.__currentAnisotropy)&&(x.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,w.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function $e(e,t){if(e.width>t||e.height>t){var n=t/Math.max(e.width,e.height),r=document.createElement("canvas");return r.width=Math.floor(e.width*n),r.height=Math.floor(e.height*n),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),q.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function et(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",ge),e.image.__webglTextureCube=x.createTexture(),w.info.memory.textures++),x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var n=e instanceof q.CompressedTexture,r=e.image[0]instanceof q.DataTexture,i=[],o=0;o<6;o++)!w.autoScaleCubemaps||n||r?i[o]=r?e.image[o].image:e.image[o]:i[o]=$e(e.image[o],$);var s=i[0],a=q.Math.isPowerOfTwo(s.width)&&q.Math.isPowerOfTwo(s.height),l=ot(e.format),c=ot(e.type);Je(x.TEXTURE_CUBE_MAP,e,a);for(o=0;o<6;o++)if(n)for(var u,d=i[o].mipmaps,h=0,f=d.length;h<f;h++)u=d[h],e.format!==q.RGBAFormat&&e.format!==q.RGBFormat?se().indexOf(l)>-1?x.compressedTexImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,h,l,u.width,u.height,0,u.data):q.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,h,l,u.width,u.height,0,l,c,u.data);else r?x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,i[o].width,i[o].height,0,l,c,i[o].data):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,c,i[o]);e.generateMipmaps&&a&&x.generateMipmap(x.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function tt(e,t){x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture)}function nt(e,t,n){x.bindFramebuffer(x.FRAMEBUFFER,e),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function rt(e,t){x.bindRenderbuffer(x.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(x.renderbufferStorage(x.RENDERBUFFER,x.DEPTH_COMPONENT16,t.width,t.height),x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(x.renderbufferStorage(x.RENDERBUFFER,x.DEPTH_STENCIL,t.width,t.height),x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,e)):x.renderbufferStorage(x.RENDERBUFFER,x.RGBA4,t.width,t.height)}function it(e){return e===q.NearestFilter||e===q.NearestMipMapNearestFilter||e===q.NearestMipMapLinearFilter?x.NEAREST:x.LINEAR}function ot(e){var t;if(e===q.RepeatWrapping)return x.REPEAT;if(e===q.ClampToEdgeWrapping)return x.CLAMP_TO_EDGE;if(e===q.MirroredRepeatWrapping)return x.MIRRORED_REPEAT;if(e===q.NearestFilter)return x.NEAREST;if(e===q.NearestMipMapNearestFilter)return x.NEAREST_MIPMAP_NEAREST;if(e===q.NearestMipMapLinearFilter)return x.NEAREST_MIPMAP_LINEAR;if(e===q.LinearFilter)return x.LINEAR;if(e===q.LinearMipMapNearestFilter)return x.LINEAR_MIPMAP_NEAREST;if(e===q.LinearMipMapLinearFilter)return x.LINEAR_MIPMAP_LINEAR;if(e===q.UnsignedByteType)return x.UNSIGNED_BYTE;if(e===q.UnsignedShort4444Type)return x.UNSIGNED_SHORT_4_4_4_4;if(e===q.UnsignedShort5551Type)return x.UNSIGNED_SHORT_5_5_5_1;if(e===q.UnsignedShort565Type)return x.UNSIGNED_SHORT_5_6_5;if(e===q.ByteType)return x.BYTE;if(e===q.ShortType)return x.SHORT;if(e===q.UnsignedShortType)return x.UNSIGNED_SHORT;if(e===q.IntType)return x.INT;if(e===q.UnsignedIntType)return x.UNSIGNED_INT;if(e===q.FloatType)return x.FLOAT;if(null!==(t=H.get("OES_texture_half_float"))&&e===q.HalfFloatType)return t.HALF_FLOAT_OES;if(e===q.AlphaFormat)return x.ALPHA;if(e===q.RGBFormat)return x.RGB;if(e===q.RGBAFormat)return x.RGBA;if(e===q.LuminanceFormat)return x.LUMINANCE;if(e===q.LuminanceAlphaFormat)return x.LUMINANCE_ALPHA;if(e===q.AddEquation)return x.FUNC_ADD;if(e===q.SubtractEquation)return x.FUNC_SUBTRACT;if(e===q.ReverseSubtractEquation)return x.FUNC_REVERSE_SUBTRACT;if(e===q.ZeroFactor)return x.ZERO;if(e===q.OneFactor)return x.ONE;if(e===q.SrcColorFactor)return x.SRC_COLOR;if(e===q.OneMinusSrcColorFactor)return x.ONE_MINUS_SRC_COLOR;if(e===q.SrcAlphaFactor)return x.SRC_ALPHA;if(e===q.OneMinusSrcAlphaFactor)return x.ONE_MINUS_SRC_ALPHA;if(e===q.DstAlphaFactor)return x.DST_ALPHA;if(e===q.OneMinusDstAlphaFactor)return x.ONE_MINUS_DST_ALPHA;if(e===q.DstColorFactor)return x.DST_COLOR;if(e===q.OneMinusDstColorFactor)return x.ONE_MINUS_DST_COLOR;if(e===q.SrcAlphaSaturateFactor)return x.SRC_ALPHA_SATURATE;if(null!==(t=H.get("WEBGL_compressed_texture_s3tc"))){if(e===q.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===q.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===q.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===q.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=H.get("WEBGL_compressed_texture_pvrtc"))){if(e===q.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===q.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===q.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===q.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=H.get("EXT_blend_minmax"))){if(e===q.MinEquation)return t.MIN_EXT;if(e===q.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===q.CullFaceNone?x.disable(x.CULL_FACE):(t===q.FrontFaceDirectionCW?x.frontFace(x.CW):x.frontFace(x.CCW),e===q.CullFaceBack?x.cullFace(x.BACK):e===q.CullFaceFront?x.cullFace(x.FRONT):x.cullFace(x.FRONT_AND_BACK),x.enable(x.CULL_FACE))},this.setMaterialFaces=function(e){G.setDoubleSided(e.side===q.DoubleSide),G.setFlipSided(e.side===q.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",ge),e.__webglTexture=x.createTexture(),w.info.memory.textures++),x.bindTexture(x.TEXTURE_2D,e.__webglTexture),x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,e.flipY),x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),x.pixelStorei(x.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=$e(e.image,J);var t=e.image,n=q.Math.isPowerOfTwo(t.width)&&q.Math.isPowerOfTwo(t.height),r=ot(e.format),i=ot(e.type);Je(x.TEXTURE_2D,e,n);var o,s=e.mipmaps;if(e instanceof q.DataTexture)if(s.length>0&&n){for(var a=0,l=s.length;a<l;a++)o=s[a],x.texImage2D(x.TEXTURE_2D,a,r,o.width,o.height,0,r,i,o.data);e.generateMipmaps=!1}else x.texImage2D(x.TEXTURE_2D,0,r,t.width,t.height,0,r,i,t.data);else if(e instanceof q.CompressedTexture)for(a=0,l=s.length;a<l;a++)o=s[a],e.format!==q.RGBAFormat&&e.format!==q.RGBFormat?se().indexOf(r)>-1?x.compressedTexImage2D(x.TEXTURE_2D,a,r,o.width,o.height,0,o.data):q.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x.texImage2D(x.TEXTURE_2D,a,r,o.width,o.height,0,r,i,o.data);else if(s.length>0&&n){for(a=0,l=s.length;a<l;a++)o=s[a],x.texImage2D(x.TEXTURE_2D,a,r,r,i,o);e.generateMipmaps=!1}else x.texImage2D(x.TEXTURE_2D,0,r,r,i,e.image);e.generateMipmaps&&n&&x.generateMipmap(x.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){x.activeTexture(x.TEXTURE0+t),e.needsUpdate?w.uploadTexture(e):x.bindTexture(x.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,n,r,i,o,s=e instanceof q.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ve),e.__webglTexture=x.createTexture(),w.info.memory.textures++;var a=q.Math.isPowerOfTwo(e.width)&&q.Math.isPowerOfTwo(e.height),l=ot(e.format),c=ot(e.type);if(s){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture),Je(x.TEXTURE_CUBE_MAP,e,a);for(var u=0;u<6;u++)e.__webglFramebuffer[u]=x.createFramebuffer(),e.__webglRenderbuffer[u]=x.createRenderbuffer(),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer[u],e,x.TEXTURE_CUBE_MAP_POSITIVE_X+u),rt(e.__webglRenderbuffer[u],e);a&&x.generateMipmap(x.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=x.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=x.createRenderbuffer(),x.bindTexture(x.TEXTURE_2D,e.__webglTexture),Je(x.TEXTURE_2D,e,a),x.texImage2D(x.TEXTURE_2D,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer,e,x.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,e.__webglRenderbuffer):rt(e.__webglRenderbuffer,e),a&&x.generateMipmap(x.TEXTURE_2D);s?x.bindTexture(x.TEXTURE_CUBE_MAP,null):x.bindTexture(x.TEXTURE_2D,null),x.bindRenderbuffer(x.RENDERBUFFER,null),x.bindFramebuffer(x.FRAMEBUFFER,null)}e?(t=s?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,r=e.height,i=0,o=0):(t=null,n=R,r=I,i=L,o=D),t!==M&&(x.bindFramebuffer(x.FRAMEBUFFER,t),x.viewport(i,o,n,r),M=t),j=n,O=r},this.readRenderTargetPixels=function(e,t,n,r,i,o){if(e instanceof q.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==q.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var s=!1;e.__webglFramebuffer!==M&&(x.bindFramebuffer(x.FRAMEBUFFER,e.__webglFramebuffer),s=!0),x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?x.readPixels(t,n,r,i,x.RGBA,x.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&x.bindFramebuffer(x.FRAMEBUFFER,M)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.initMaterial=function(){q.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){q.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){q.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){q.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},q.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:q.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:q.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:q.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:q.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new q.Vector2(0,0),this.repeat=new q.Vector2(1,1),this.format=void 0!==n.format?n.format:q.RGBAFormat,this.type=void 0!==n.type?n.type:q.UnsignedByteType,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==n.shareDepthFrom?n.shareDepthFrom:null},q.WebGLRenderTarget.prototype={constructor:q.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new q.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},q.EventDispatcher.prototype.apply(q.WebGLRenderTarget.prototype),q.WebGLRenderTargetCube=function(e,t,n){q.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},q.WebGLRenderTargetCube.prototype=Object.create(q.WebGLRenderTarget.prototype),q.WebGLRenderTargetCube.prototype.constructor=q.WebGLRenderTargetCube,q.WebGLExtensions=function(e){var t={};this.get=function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&q.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}},q.WebGLProgram=(O=0,function(e,t,n,r){var i=e,o=i.context,s=n.defines,a=n.__webglShader.uniforms,l=n.attributes,c=n.__webglShader.vertexShader,u=n.__webglShader.fragmentShader,d=n.index0AttributeName;void 0===d&&!0===r.morphTargets&&(d="position");var h="SHADOWMAP_TYPE_BASIC";r.shadowMapType===q.PCFShadowMap?h="SHADOWMAP_TYPE_PCF":r.shadowMapType===q.PCFSoftShadowMap&&(h="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(n.envMap.mapping){case q.CubeReflectionMapping:case q.CubeRefractionMapping:f="ENVMAP_TYPE_CUBE";break;case q.EquirectangularReflectionMapping:case q.EquirectangularRefractionMapping:f="ENVMAP_TYPE_EQUIREC";break;case q.SphericalReflectionMapping:f="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case q.CubeRefractionMapping:case q.EquirectangularRefractionMapping:p="ENVMAP_MODE_REFRACTION"}switch(n.combine){case q.MultiplyOperation:m="ENVMAP_BLENDING_MULTIPLY";break;case q.MixOperation:m="ENVMAP_BLENDING_MIX";break;case q.AddOperation:m="ENVMAP_BLENDING_ADD"}}var g,v,y=e.gammaFactor>0?e.gammaFactor:1,_=function(e){var t,n,r=[];for(var i in e)!1!==(t=e[i])&&(n="#define "+i+" "+t,r.push(n));return r.join("\n")}(s),b=o.createProgram();n instanceof q.RawShaderMaterial?(g="",v=""):(g=["precision "+r.precision+" float;","precision "+r.precision+" int;",_,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+p:"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+h:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),v=["precision "+r.precision+" float;","precision "+r.precision+" int;",r.bumpMap||r.normalMap||r.flatShading?"#extension GL_OES_standard_derivatives : enable":"",_,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+f:"",r.envMap?"#define "+p:"",r.envMap?"#define "+m:"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.metal?"#define METAL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+h:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var x=new q.WebGLShader(o,o.VERTEX_SHADER,g+c),w=new q.WebGLShader(o,o.FRAGMENT_SHADER,v+u);o.attachShader(b,x),o.attachShader(b,w),void 0!==d&&o.bindAttribLocation(b,0,d),o.linkProgram(b);var E=o.getProgramInfoLog(b);!1===o.getProgramParameter(b,o.LINK_STATUS)&&q.error("THREE.WebGLProgram: shader error: "+o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(b,o.VALIDATE_STATUS),"gl.getPRogramInfoLog",E),""!==E&&q.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+E),o.deleteShader(x),o.deleteShader(w);var A=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var M in r.useVertexTexture?(A.push("boneTexture"),A.push("boneTextureWidth"),A.push("boneTextureHeight")):A.push("boneGlobalMatrices"),r.logarithmicDepthBuffer&&A.push("logDepthBufFC"),a)A.push(M);this.uniforms=function(e,t,n){for(var r={},i=0,o=n.length;i<o;i++){var s=n[i];r[s]=e.getUniformLocation(t,s)}return r}(o,b,A),A=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var S=0;S<r.maxMorphTargets;S++)A.push("morphTarget"+S);for(S=0;S<r.maxMorphNormals;S++)A.push("morphNormal"+S);for(var T in l)A.push(T);return this.attributes=function(e,t,n){for(var r={},i=0,o=n.length;i<o;i++){var s=n[i];r[s]=e.getAttribLocation(t,s)}return r}(o,b,A),this.attributesKeys=Object.keys(this.attributes),this.id=O++,this.code=t,this.usedTimes=1,this.program=b,this.vertexShader=x,this.fragmentShader=w,this}),q.WebGLShader=function(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&q.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&q.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(r),function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n)),r},q.WebGLState=function(e,t){var n=new Uint8Array(16),r=new Uint8Array(16),i=null,o=null,s=null,a=null,l=null,c=null,u=null,d=null,h=null,f=null,p=null,m=null,g=null,v=null,y=null,_=null;this.initAttributes=function(){for(var e=0,t=n.length;e<t;e++)n[e]=0},this.enableAttribute=function(t){n[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1)},this.disableUnusedAttributes=function(){for(var t=0,i=r.length;t<i;t++)r[t]!==n[t]&&(e.disableVertexAttribArray(t),r[t]=0)},this.setBlending=function(n,r,d,h,f,p,m){n!==i&&(n===q.NoBlending?e.disable(e.BLEND):n===q.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):n===q.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):n===q.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):n===q.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),i=n),n===q.CustomBlending?(f=f||r,p=p||d,m=m||h,r===o&&f===l||(e.blendEquationSeparate(t(r),t(f)),o=r,l=f),d===s&&h===a&&p===c&&m===u||(e.blendFuncSeparate(t(d),t(h),t(p),t(m)),s=d,a=h,c=p,u=m)):(o=null,s=null,a=null,l=null,c=null,u=null)},this.setDepthTest=function(t){d!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),d=t)},this.setDepthWrite=function(t){h!==t&&(e.depthMask(t),h=t)},this.setColorWrite=function(t){f!==t&&(e.colorMask(t,t,t,t),f=t)},this.setDoubleSided=function(t){p!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),p=t)},this.setFlipSided=function(t){m!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),m=t)},this.setLineWidth=function(t){t!==g&&(e.lineWidth(t),g=t)},this.setPolygonOffset=function(t,n,r){v!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),v=t),!t||y===n&&_===r||(e.polygonOffset(n,r),y=n,_=r)},this.reset=function(){for(var e=0;e<r.length;e++)r[e]=0;i=null,d=null,h=null,f=null,p=null,m=null}},q.LensFlarePlugin=function(e,t){var n,r,i,o,s,a,l,c,u=e.context,d=function(){var t,d=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),h=new Uint16Array([0,1,2,0,2,3]);n=u.createBuffer(),r=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,n),u.bufferData(u.ARRAY_BUFFER,d,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),u.bufferData(u.ELEMENT_ARRAY_BUFFER,h,u.STATIC_DRAW),l=u.createTexture(),c=u.createTexture(),u.bindTexture(u.TEXTURE_2D,l),u.texImage2D(u.TEXTURE_2D,0,u.RGB,16,16,0,u.RGB,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,16,16,0,u.RGBA,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),t=(a=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},i=function(t){var n=u.createProgram(),r=u.createShader(u.FRAGMENT_SHADER),i=u.createShader(u.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return u.shaderSource(r,o+t.fragmentShader),u.shaderSource(i,o+t.vertexShader),u.compileShader(r),u.compileShader(i),u.attachShader(n,r),u.attachShader(n,i),u.linkProgram(n),n}(t),o={vertex:u.getAttribLocation(i,"position"),uv:u.getAttribLocation(i,"uv")},s={renderType:u.getUniformLocation(i,"renderType"),map:u.getUniformLocation(i,"map"),occlusionMap:u.getUniformLocation(i,"occlusionMap"),opacity:u.getUniformLocation(i,"opacity"),color:u.getUniformLocation(i,"color"),scale:u.getUniformLocation(i,"scale"),rotation:u.getUniformLocation(i,"rotation"),screenPosition:u.getUniformLocation(i,"screenPosition")}};this.render=function(h,f,p,m){if(0!==t.length){var g=new q.Vector3,v=m/p,y=.5*p,_=.5*m,b=16/m,x=new q.Vector2(b*v,b),w=new q.Vector3(1,1,0),E=new q.Vector2(1,1);void 0===i&&d(),u.useProgram(i),u.enableVertexAttribArray(o.vertex),u.enableVertexAttribArray(o.uv),u.uniform1i(s.occlusionMap,0),u.uniform1i(s.map,1),u.bindBuffer(u.ARRAY_BUFFER,n),u.vertexAttribPointer(o.vertex,2,u.FLOAT,!1,16,0),u.vertexAttribPointer(o.uv,2,u.FLOAT,!1,16,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),u.disable(u.CULL_FACE),u.depthMask(!1);for(var A=0,M=t.length;A<M;A++){b=16/m,x.set(b*v,b);var S=t[A];if(g.set(S.matrixWorld.elements[12],S.matrixWorld.elements[13],S.matrixWorld.elements[14]),g.applyMatrix4(f.matrixWorldInverse),g.applyProjection(f.projectionMatrix),w.copy(g),E.x=w.x*y+y,E.y=w.y*_+_,a||E.x>0&&E.x<p&&E.y>0&&E.y<m){u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGB,E.x-8,E.y-8,16,16,0),u.uniform1i(s.renderType,0),u.uniform2f(s.scale,x.x,x.y),u.uniform3f(s.screenPosition,w.x,w.y,w.z),u.disable(u.BLEND),u.enable(u.DEPTH_TEST),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,E.x-8,E.y-8,16,16,0),u.uniform1i(s.renderType,1),u.disable(u.DEPTH_TEST),u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),S.positionScreen.copy(w),S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),u.uniform1i(s.renderType,2),u.enable(u.BLEND);for(var T=0,C=S.lensFlares.length;T<C;T++){var P=S.lensFlares[T];P.opacity>.001&&P.scale>.001&&(w.x=P.x,w.y=P.y,w.z=P.z,b=P.size*P.scale/m,x.x=b*v,x.y=b,u.uniform3f(s.screenPosition,w.x,w.y,w.z),u.uniform2f(s.scale,x.x,x.y),u.uniform1f(s.rotation,P.rotation),u.uniform1f(s.opacity,P.opacity),u.uniform3f(s.color,P.color.r,P.color.g,P.color.b),e.state.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),e.setTexture(P.texture,1),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0))}}}u.enable(u.CULL_FACE),u.enable(u.DEPTH_TEST),u.depthMask(!0),e.resetGLState()}}},q.ShadowMapPlugin=function(e,t,n,r){var i,o,s,a,l=e.context,c=new q.Frustum,u=new q.Matrix4,d=new q.Vector3,h=new q.Vector3,f=new q.Vector3,p=[],m=q.ShaderLib.depthRGBA,g=q.UniformsUtils.clone(m.uniforms);function v(e,t,r){if(t.visible){var i=n[t.id];if(i&&t.castShadow&&(!1===t.frustumCulled||!0===c.intersectsObject(t)))for(var o=0,s=i.length;o<s;o++){var a=i[o];t._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),p.push(a)}for(o=0,s=t.children.length;o<s;o++)v(e,t.children[o],r)}}function y(e,t){var n=new q.DirectionalLight;n.isVirtual=!0,n.onlyShadow=!0,n.castShadow=!0,n.shadowCameraNear=e.shadowCameraNear,n.shadowCameraFar=e.shadowCameraFar,n.shadowCameraLeft=e.shadowCameraLeft,n.shadowCameraRight=e.shadowCameraRight,n.shadowCameraBottom=e.shadowCameraBottom,n.shadowCameraTop=e.shadowCameraTop,n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t],n.shadowMapWidth=e.shadowCascadeWidth[t],n.shadowMapHeight=e.shadowCascadeHeight[t],n.pointsWorld=[],n.pointsFrustum=[];for(var r=n.pointsWorld,i=n.pointsFrustum,o=0;o<8;o++)r[o]=new q.Vector3,i[o]=new q.Vector3;var s=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t];return i[0].set(-1,-1,s),i[1].set(1,-1,s),i[2].set(-1,1,s),i[3].set(1,1,s),i[4].set(-1,-1,a),i[5].set(1,-1,a),i[6].set(-1,1,a),i[7].set(1,1,a),n}function _(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],o=n.pointsFrustum;o[0].z=r,o[1].z=r,o[2].z=r,o[3].z=r,o[4].z=i,o[5].z=i,o[6].z=i,o[7].z=i}function b(e,t){var n=t.shadowCamera,r=t.pointsFrustum,i=t.pointsWorld;d.set(1/0,1/0,1/0),h.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var s=i[o];s.copy(r[o]),s.unproject(e),s.applyMatrix4(n.matrixWorldInverse),s.x<d.x&&(d.x=s.x),s.x>h.x&&(h.x=s.x),s.y<d.y&&(d.y=s.y),s.y>h.y&&(h.y=s.y),s.z<d.z&&(d.z=s.z),s.z>h.z&&(h.z=s.z)}n.left=d.x,n.right=h.x,n.top=h.y,n.bottom=d.y,n.updateProjectionMatrix()}function x(e){return e.material instanceof q.MeshFaceMaterial?e.material.materials[0]:e.material}i=new q.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),o=new q.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0}),s=new q.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0}),a=new q.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0}),i._shadowPass=!0,o._shadowPass=!0,s._shadowPass=!0,a._shadowPass=!0,this.render=function(n,d){if(!1!==e.shadowMapEnabled){var h,m,g,w,E,A,M,S,T,C,P,L,D,R=[],I=0;for(l.clearColor(1,1,1,1),l.disable(l.BLEND),l.enable(l.CULL_FACE),l.frontFace(l.CCW),e.shadowMapCullFace===q.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.BACK),e.state.setDepthTest(!0),h=0,m=t.length;h<m;h++)if((D=t[h]).castShadow)if(D instanceof q.DirectionalLight&&D.shadowCascade)for(E=0;E<D.shadowCascadeCount;E++){var j;if(D.shadowCascadeArray[E])j=D.shadowCascadeArray[E];else{(j=y(D,E)).originalCamera=d;var O=new q.Gyroscope;O.position.copy(D.shadowCascadeOffset),O.add(j),O.add(j.target),d.add(O),D.shadowCascadeArray[E]=j}_(D,E),R[I]=j,I++}else R[I]=D,I++;for(h=0,m=R.length;h<m;h++){if(!(D=R[h]).shadowMap){var N=q.LinearFilter;e.shadowMapType===q.PCFSoftShadowMap&&(N=q.NearestFilter);var k={minFilter:N,magFilter:N,format:q.RGBAFormat};D.shadowMap=new q.WebGLRenderTarget(D.shadowMapWidth,D.shadowMapHeight,k),D.shadowMapSize=new q.Vector2(D.shadowMapWidth,D.shadowMapHeight),D.shadowMatrix=new q.Matrix4}if(!D.shadowCamera){if(D instanceof q.SpotLight)D.shadowCamera=new q.PerspectiveCamera(D.shadowCameraFov,D.shadowMapWidth/D.shadowMapHeight,D.shadowCameraNear,D.shadowCameraFar);else{if(!(D instanceof q.DirectionalLight)){q.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",D);continue}D.shadowCamera=new q.OrthographicCamera(D.shadowCameraLeft,D.shadowCameraRight,D.shadowCameraTop,D.shadowCameraBottom,D.shadowCameraNear,D.shadowCameraFar)}n.add(D.shadowCamera),!0===n.autoUpdate&&n.updateMatrixWorld()}var F,V,B;for(D.shadowCameraVisible&&!D.cameraHelper&&(D.cameraHelper=new q.CameraHelper(D.shadowCamera),n.add(D.cameraHelper)),D.isVirtual&&j.originalCamera==d&&b(d,D),A=D.shadowMap,M=D.shadowMatrix,(S=D.shadowCamera).position.setFromMatrixPosition(D.matrixWorld),f.setFromMatrixPosition(D.target.matrixWorld),S.lookAt(f),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),D.cameraHelper&&(D.cameraHelper.visible=D.shadowCameraVisible),D.shadowCameraVisible&&D.cameraHelper.update(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(S.projectionMatrix),M.multiply(S.matrixWorldInverse),u.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),c.setFromMatrix(u),e.setRenderTarget(A),e.clear(),p.length=0,v(n,n,S),g=0,w=p.length;g<w;g++)L=(P=p[g]).object,T=P.buffer,F=x(L),V=void 0!==L.geometry.morphTargets&&L.geometry.morphTargets.length>0&&F.morphTargets,B=L instanceof q.SkinnedMesh&&F.skinning,C=L.customDepthMaterial?L.customDepthMaterial:B?V?a:s:V?o:i,e.setMaterialFaces(F),T instanceof q.BufferGeometry?e.renderBufferDirect(S,t,null,C,T,L):e.renderBuffer(S,t,null,C,T,L);for(g=0,w=r.length;g<w;g++)(L=(P=r[g]).object).visible&&L.castShadow&&(L._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,L.matrixWorld),e.renderImmediateObject(S,t,null,i,L))}var U=e.getClearColor(),z=e.getClearAlpha();l.clearColor(U.r,U.g,U.b,z),l.enable(l.BLEND),e.shadowMapCullFace===q.CullFaceFront&&l.cullFace(l.BACK),e.resetGLState()}}},q.SpritePlugin=function(e,t){var n,r,i,o,s,a,l=e.context,c=new q.Vector3,u=new q.Quaternion,d=new q.Vector3,h=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),c=new Uint16Array([0,1,2,0,2,3]);n=l.createBuffer(),r=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,n),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),l.bufferData(l.ELEMENT_ARRAY_BUFFER,c,l.STATIC_DRAW),i=function(){var t=l.createProgram(),n=l.createShader(l.VERTEX_SHADER),r=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(n),l.compileShader(r),l.attachShader(t,n),l.attachShader(t,r),l.linkProgram(t),t}(),o={position:l.getAttribLocation(i,"position"),uv:l.getAttribLocation(i,"uv")},s={uvOffset:l.getUniformLocation(i,"uvOffset"),uvScale:l.getUniformLocation(i,"uvScale"),rotation:l.getUniformLocation(i,"rotation"),scale:l.getUniformLocation(i,"scale"),color:l.getUniformLocation(i,"color"),map:l.getUniformLocation(i,"map"),opacity:l.getUniformLocation(i,"opacity"),modelViewMatrix:l.getUniformLocation(i,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(i,"projectionMatrix"),fogType:l.getUniformLocation(i,"fogType"),fogDensity:l.getUniformLocation(i,"fogDensity"),fogNear:l.getUniformLocation(i,"fogNear"),fogFar:l.getUniformLocation(i,"fogFar"),fogColor:l.getUniformLocation(i,"fogColor"),alphaTest:l.getUniformLocation(i,"alphaTest")};var u=document.createElement("canvas");u.width=8,u.height=8;var d=u.getContext("2d");d.fillStyle="white",d.fillRect(0,0,8,8),(a=new q.Texture(u)).needsUpdate=!0};function f(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(p,m){if(0!==t.length){void 0===i&&h(),l.useProgram(i),l.enableVertexAttribArray(o.position),l.enableVertexAttribArray(o.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,n),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),l.uniformMatrix4fv(s.projectionMatrix,!1,m.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(s.map,0);var g=0,v=0,y=p.fog;y?(l.uniform3f(s.fogColor,y.color.r,y.color.g,y.color.b),y instanceof q.Fog?(l.uniform1f(s.fogNear,y.near),l.uniform1f(s.fogFar,y.far),l.uniform1i(s.fogType,1),g=1,v=1):y instanceof q.FogExp2&&(l.uniform1f(s.fogDensity,y.density),l.uniform1i(s.fogType,2),g=2,v=2)):(l.uniform1i(s.fogType,0),g=0,v=0);for(var _=0,b=t.length;_<b;_++){(w=t[_])._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]}t.sort(f);var x=[];for(_=0,b=t.length;_<b;_++){var w,E=(w=t[_]).material;l.uniform1f(s.alphaTest,E.alphaTest),l.uniformMatrix4fv(s.modelViewMatrix,!1,w._modelViewMatrix.elements),w.matrixWorld.decompose(c,u,d),x[0]=d.x,x[1]=d.y;var A=0;p.fog&&E.fog&&(A=v),g!==A&&(l.uniform1i(s.fogType,A),g=A),null!==E.map?(l.uniform2f(s.uvOffset,E.map.offset.x,E.map.offset.y),l.uniform2f(s.uvScale,E.map.repeat.x,E.map.repeat.y)):(l.uniform2f(s.uvOffset,0,0),l.uniform2f(s.uvScale,1,1)),l.uniform1f(s.opacity,E.opacity),l.uniform3f(s.color,E.color.r,E.color.g,E.color.b),l.uniform1f(s.rotation,E.rotation),l.uniform2fv(s.scale,x),e.state.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),e.state.setDepthTest(E.depthTest),e.state.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?e.setTexture(E.map,0):e.setTexture(a,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),e.resetGLState()}}},q.GeometryUtils={merge:function(e,t,n){var r;q.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof q.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return q.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},q.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,n,r){var i=new q.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new q.Texture(void 0,t);return i.load(e,(function(e){o.image=e,o.needsUpdate=!0,n&&n(o)}),void 0,(function(e){r&&r(e)})),o.sourceFile=e,o},loadTextureCube:function(e,t,n,r){var i=new q.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new q.CubeTexture([],t);o.flipY=!1;for(var s=0,a=function(t){i.load(e[t],(function(e){o.images[t]=e,6===(s+=1)&&(o.needsUpdate=!0,n&&n(o))}),void 0,r)},l=0,c=e.length;l<c;++l)a(l);return o},loadCompressedTexture:function(){q.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){q.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},r=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var i=e.width,o=e.height,s=document.createElement("canvas");s.width=i,s.height=o;var a=s.getContext("2d");a.drawImage(e,0,0);for(var l,c,u=a.getImageData(0,0,i,o).data,d=a.createImageData(i,o),h=d.data,f=0;f<i;f++)for(var p=0;p<o;p++){var m=p-1<0?0:p-1,g=p+1>o-1?o-1:p+1,v=f-1<0?0:f-1,y=f+1>i-1?i-1:f+1,_=[],b=[0,0,u[4*(p*i+f)]/255*t];_.push([-1,0,u[4*(p*i+v)]/255*t]),_.push([-1,-1,u[4*(m*i+v)]/255*t]),_.push([0,-1,u[4*(m*i+f)]/255*t]),_.push([1,-1,u[4*(m*i+y)]/255*t]),_.push([1,0,u[4*(p*i+y)]/255*t]),_.push([1,1,u[4*(g*i+y)]/255*t]),_.push([0,1,u[4*(g*i+f)]/255*t]),_.push([-1,1,u[4*(g*i+v)]/255*t]);for(var x=[],w=_.length,E=0;E<w;E++){var A=_[E],M=_[(E+1)%w];A=n(A,b),M=n(M,b),x.push(r((c=M,[(l=A)[1]*c[2]-l[2]*c[1],l[2]*c[0]-l[0]*c[2],l[0]*c[1]-l[1]*c[0]])))}var S=[0,0,0];for(E=0;E<x.length;E++)S[0]+=x[E][0],S[1]+=x[E][1],S[2]+=x[E][2];S[0]/=x.length,S[1]/=x.length,S[2]/=x.length;var T=4*(p*i+f);h[T]=(S[0]+1)/2*255|0,h[T+1]=(S[1]+1)/2*255|0,h[T+2]=255*S[2]|0,h[T+3]=255}return a.putImageData(d,0,0),s},generateDataTexture:function(e,t,n){for(var r=e*t,i=new Uint8Array(3*r),o=Math.floor(255*n.r),s=Math.floor(255*n.g),a=Math.floor(255*n.b),l=0;l<r;l++)i[3*l]=o,i[3*l+1]=s,i[3*l+2]=a;var c=new q.DataTexture(i,e,t,q.RGBFormat);return c.needsUpdate=!0,c}},q.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new q.Object3D,r=0,i=t.length;r<i;r++)n.add(new q.Mesh(e,t[r]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new q.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},q.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,n=this.getFace(),r=this.size/n.resolution,i=0,o=String(e).split(""),s=o.length,a=[];for(t=0;t<s;t++){var l=new q.Path,c=this.extractGlyphPoints(o[t],n,r,i,l);i+=c.offset,a.push(c.path)}return{paths:a,offset:i/2}},extractGlyphPoints:function(e,t,n,r,i){var o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E=[],A=t.glyphs[e]||t.glyphs["?"];if(A){if(A.o)for(c=(l=A._cachedOutline||(A._cachedOutline=A.o.split(" "))).length,u=n,d=n,o=0;o<c;)switch(l[o++]){case"m":h=l[o++]*u+r,f=l[o++]*d,i.moveTo(h,f);break;case"l":h=l[o++]*u+r,f=l[o++]*d,i.lineTo(h,f);break;case"q":if(p=l[o++]*u+r,m=l[o++]*d,y=l[o++]*u+r,_=l[o++]*d,i.quadraticCurveTo(y,_,p,m),w=E[E.length-1])for(g=w.x,v=w.y,s=1,a=this.divisions;s<=a;s++){var M=s/a;q.Shape.Utils.b2(M,g,y,p),q.Shape.Utils.b2(M,v,_,m)}break;case"b":if(p=l[o++]*u+r,m=l[o++]*d,y=l[o++]*u+r,_=l[o++]*d,b=l[o++]*u+r,x=l[o++]*d,i.bezierCurveTo(y,_,b,x,p,m),w=E[E.length-1])for(g=w.x,v=w.y,s=1,a=this.divisions;s<=a;s++){M=s/a;q.Shape.Utils.b3(M,g,y,b,p),q.Shape.Utils.b3(M,v,_,x,m)}}return{offset:A.ha*n,path:i}}}},q.FontUtils.generateShapes=function(e,t){var n=void 0!==(t=t||{}).size?t.size:100,r=void 0!==t.curveSegments?t.curveSegments:4,i=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";q.FontUtils.size=n,q.FontUtils.divisions=r,q.FontUtils.face=i,q.FontUtils.weight=o,q.FontUtils.style=s;for(var a=q.FontUtils.drawText(e).paths,l=[],c=0,u=a.length;c<u;c++)Array.prototype.push.apply(l,a[c].toShapes());return l},N=q.FontUtils,k=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},F=function(e,t,n,r,i,o){var s,a,l,c,u,d,h,f,p,m,g,v,y,_,b;if(a=e[o[t]].x,l=e[o[t]].y,c=e[o[n]].x,u=e[o[n]].y,d=e[o[r]].x,1e-10>(c-a)*((h=e[o[r]].y)-l)-(u-l)*(d-a))return!1;for(m=d-c,g=h-u,v=a-d,y=l-h,_=c-a,b=u-l,s=0;s<i;s++)if(f=e[o[s]].x,p=e[o[s]].y,!(f===a&&p===l||f===c&&p===u||f===d&&p===h)&&m*(p-u)-g*(f-c)>=-1e-10&&v*(p-h)-y*(f-d)>=-1e-10&&_*(p-l)-b*(f-a)>=-1e-10)return!1;return!0},N.Triangulate=function(e,t){var n=e.length;if(n<3)return null;var r,i,o,s=[],a=[],l=[];if(k(e)>0)for(i=0;i<n;i++)a[i]=i;else for(i=0;i<n;i++)a[i]=n-1-i;var c=n,u=2*c;for(i=c-1;c>2;){if(u--<=0)return q.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?l:s;if(c<=(r=i)&&(r=0),c<=(i=r+1)&&(i=0),c<=(o=i+1)&&(o=0),F(e,r,i,o,c,a)){var d,h,f,p,m;for(d=a[r],h=a[i],f=a[o],s.push([e[d],e[h],e[f]]),l.push([a[r],a[i],a[o]]),p=i,m=i+1;m<c;p++,m++)a[p]=a[m];u=2*--c}}return t?l:s},N.Triangulate.area=k,q.Audio=function(e){q.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},q.Audio.prototype=Object.create(q.Object3D.prototype),q.Audio.prototype.constructor=q.Audio,q.Audio.prototype.load=function(e){var t=this,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){t.context.decodeAudioData(this.response,(function(e){t.source.buffer=e,t.autoplay&&t.play()}))},n.send(),this},q.Audio.prototype.play=function(){if(!0!==this.isPlaying){var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e}else q.warn("THREE.Audio: Audio is already playing.")},q.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},q.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},q.Audio.prototype.onEnded=function(){this.isPlaying=!1},q.Audio.prototype.setLoop=function(e){this.source.loop=e},q.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},q.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},q.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},q.Audio.prototype.updateMatrixWorld=function(){var e=new q.Vector3;return function(t){q.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),q.AudioListener=function(){q.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},q.AudioListener.prototype=Object.create(q.Object3D.prototype),q.AudioListener.prototype.constructor=q.AudioListener,q.AudioListener.prototype.updateMatrixWorld=function(){var e=new q.Vector3,t=new q.Quaternion,n=new q.Vector3,r=new q.Vector3,i=new q.Vector3,o=new q.Vector3;return function(s){q.Object3D.prototype.updateMatrixWorld.call(this,s);var a=this.context.listener,l=this.up;this.matrixWorld.decompose(e,t,n),r.set(0,0,-1).applyQuaternion(t),i.subVectors(e,o),a.setPosition(e.x,e.y,e.z),a.setOrientation(r.x,r.y,r.z,l.x,l.y,l.z),a.setVelocity(i.x,i.y,i.z),o.copy(e)}}(),q.Curve=function(){},q.Curve.prototype.getPoint=function(e){return q.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},q.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},q.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},q.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},q.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},q.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r,r},q.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},q.Curve.prototype.getUtoTmapping=function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=r[i=Math.floor(a+(l-a)/2)]-n)<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(r[i=l]==n)return i/(o-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(o-1)},q.Curve.prototype.getTangent=function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},q.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},q.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var o=.5*(n-e),s=.5*(r-t),a=i*i;return(2*t-2*n+o+s)*(i*a)+(-3*t+3*n-2*o-s)*a+o*i+t}},q.Curve.create=function(e,t){return e.prototype=Object.create(q.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},q.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},q.CurvePath.prototype=Object.create(q.Curve.prototype),q.CurvePath.prototype.constructor=q.CurvePath,q.CurvePath.prototype.add=function(e){this.curves.push(e)},q.CurvePath.prototype.checkConnection=function(){},q.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new q.LineCurve(t,e))},q.CurvePath.prototype.getPoint=function(e){for(var t,n=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var o=1-(r[i]-n)/(t=this.curves[i]).getLength();return t.getPointAt(o)}i++}return null},q.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},q.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],n=0,r=this.curves.length;for(e=0;e<r;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t,t},q.CurvePath.prototype.getBoundingBox=function(){var e,t,n,r,i,o,s,a,l,c,u=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=i=Number.POSITIVE_INFINITY;var d=u[0]instanceof q.Vector3;for(c=d?new q.Vector3:new q.Vector2,a=0,l=u.length;a<l;a++)(s=u[a]).x>e?e=s.x:s.x<r&&(r=s.x),s.y>t?t=s.y:s.y<i&&(i=s.y),d&&(s.z>n?n=s.z:s.z<o&&(o=s.z)),c.add(s);var h={minX:r,minY:i,maxX:e,maxY:t};return d&&(h.maxZ=n,h.minZ=o),h},q.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},q.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},q.CurvePath.prototype.createGeometry=function(e){for(var t=new q.Geometry,n=0;n<e.length;n++)t.vertices.push(new q.Vector3(e[n].x,e[n].y,e[n].z||0));return t},q.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},q.CurvePath.prototype.getTransformedPoints=function(e,t){var n,r,i=this.getPoints(e);for(t||(t=this.bends),n=0,r=t.length;n<r;n++)i=this.getWrapPoints(i,t[n]);return i},q.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n,r,i=this.getSpacedPoints(e);for(t||(t=this.bends),n=0,r=t.length;n<r;n++)i=this.getWrapPoints(i,t[n]);return i},q.CurvePath.prototype.getWrapPoints=function(e,t){var n,r,i,o,s,a,l=this.getBoundingBox();for(n=0,r=e.length;n<r;n++){o=(i=e[n]).x,s=i.y,a=o/l.maxX,a=t.getUtoTmapping(a,o);var c=t.getPoint(a),u=t.getTangent(a);u.set(-u.y,u.x).multiplyScalar(s),i.x=c.x+u.x,i.y=c.y+u.y}return e},q.Gyroscope=function(){q.Object3D.call(this)},q.Gyroscope.prototype=Object.create(q.Object3D.prototype),q.Gyroscope.prototype.constructor=q.Gyroscope,q.Gyroscope.prototype.updateMatrixWorld=(V=new q.Vector3,B=new q.Quaternion,U=new q.Vector3,z=new q.Vector3,G=new q.Quaternion,H=new q.Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(z,G,H),this.matrix.decompose(V,B,U),this.matrixWorld.compose(z,B,H)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}),q.Path=function(e){q.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},q.Path.prototype=Object.create(q.CurvePath.prototype),q.Path.prototype.constructor=q.Path,q.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},q.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},q.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:q.PathActions.MOVE_TO,args:n})},q.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],o=r[r.length-1],s=new q.LineCurve(new q.Vector2(i,o),new q.Vector2(e,t));this.curves.push(s),this.actions.push({action:q.PathActions.LINE_TO,args:n})},q.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,s=o[o.length-2],a=o[o.length-1],l=new q.QuadraticBezierCurve(new q.Vector2(s,a),new q.Vector2(e,t),new q.Vector2(n,r));this.curves.push(l),this.actions.push({action:q.PathActions.QUADRATIC_CURVE_TO,args:i})},q.Path.prototype.bezierCurveTo=function(e,t,n,r,i,o){var s=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,l=a[a.length-2],c=a[a.length-1],u=new q.CubicBezierCurve(new q.Vector2(l,c),new q.Vector2(e,t),new q.Vector2(n,r),new q.Vector2(i,o));this.curves.push(u),this.actions.push({action:q.PathActions.BEZIER_CURVE_TO,args:s})},q.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],i=n[n.length-1],o=[new q.Vector2(r,i)];Array.prototype.push.apply(o,e);var s=new q.SplineCurve(o);this.curves.push(s),this.actions.push({action:q.PathActions.CSPLINE_THRU,args:t})},q.Path.prototype.arc=function(e,t,n,r,i,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,n,r,i,o)},q.Path.prototype.absarc=function(e,t,n,r,i,o){this.absellipse(e,t,n,n,r,i,o)},q.Path.prototype.ellipse=function(e,t,n,r,i,o,s){var a=this.actions[this.actions.length-1].args,l=a[a.length-2],c=a[a.length-1];this.absellipse(e+l,t+c,n,r,i,o,s)},q.Path.prototype.absellipse=function(e,t,n,r,i,o,s){var a=Array.prototype.slice.call(arguments),l=new q.EllipseCurve(e,t,n,r,i,o,s);this.curves.push(l);var c=l.getPoint(1);a.push(c.x),a.push(c.y),this.actions.push({action:q.PathActions.ELLIPSE,args:a})},q.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],r=0;r<e;r++)n.push(this.getPoint(r/e));return n},q.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n,r,i,o,s,a,l,c,u,d,h,f,p,m,g,v,y,_,b=[];for(n=0,r=this.actions.length;n<r;n++)switch(o=(i=this.actions[n]).action,s=i.args,o){case q.PathActions.MOVE_TO:case q.PathActions.LINE_TO:b.push(new q.Vector2(s[0],s[1]));break;case q.PathActions.QUADRATIC_CURVE_TO:for(a=s[2],l=s[3],d=s[0],h=s[1],b.length>0?(f=(m=b[b.length-1]).x,p=m.y):(f=(m=this.actions[n-1].args)[m.length-2],p=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=q.Shape.Utils.b2(v,f,d,a),_=q.Shape.Utils.b2(v,p,h,l),b.push(new q.Vector2(y,_));break;case q.PathActions.BEZIER_CURVE_TO:for(a=s[4],l=s[5],d=s[0],h=s[1],c=s[2],u=s[3],b.length>0?(f=(m=b[b.length-1]).x,p=m.y):(f=(m=this.actions[n-1].args)[m.length-2],p=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=q.Shape.Utils.b3(v,f,d,c,a),_=q.Shape.Utils.b3(v,p,h,u,l),b.push(new q.Vector2(y,_));break;case q.PathActions.CSPLINE_THRU:m=this.actions[n-1].args;var x=[new q.Vector2(m[m.length-2],m[m.length-1])],w=e*s[0].length;x=x.concat(s[0]);var E=new q.SplineCurve(x);for(g=1;g<=w;g++)b.push(E.getPointAt(g/w));break;case q.PathActions.ARC:var A=s[0],M=s[1],S=s[2],T=s[3],C=s[4],P=!!s[5],L=C-T,D=2*e;for(g=1;g<=D;g++)v=g/D,P||(v=1-v),R=T+v*L,y=A+S*Math.cos(R),_=M+S*Math.sin(R),b.push(new q.Vector2(y,_));break;case q.PathActions.ELLIPSE:A=s[0],M=s[1];var R,I=s[2],j=s[3];T=s[4],C=s[5],P=!!s[6],L=C-T,D=2*e;for(g=1;g<=D;g++)v=g/D,P||(v=1-v),R=T+v*L,y=A+I*Math.cos(R),_=M+j*Math.sin(R),b.push(new q.Vector2(y,_))}var O=b[b.length-1];return Math.abs(O.x-b[0].x)<1e-10&&Math.abs(O.y-b[0].y)<1e-10&&b.splice(b.length-1,1),t&&b.push(b[0]),b},q.Path.prototype.toShapes=function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new q.Shape;o.actions=i.actions,o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var s=t[i],a=t[o],l=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>1e-10){if(c<0&&(s=t[o],l=-l,a=t[i],c=-c),e.y<s.y||e.y>a.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var u=c*(e.x-s.x)-l*(e.y-s.y);if(0==u)return!0;if(u<0)continue;r=!r}}else{if(e.y!=s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return r}var i=function(e){var t,n,r,i,o,s=[],a=new q.Path;for(t=0,n=e.length;t<n;t++)o=(r=e[t]).args,(i=r.action)==q.PathActions.MOVE_TO&&0!=a.actions.length&&(s.push(a),a=new q.Path),a[i].apply(a,o);return 0!=a.actions.length&&s.push(a),s}(this.actions);if(0==i.length)return[];if(!0===t)return n(i);var o,s,a,l=[];if(1==i.length)return s=i[0],(a=new q.Shape).actions=s.actions,a.curves=s.curves,l.push(a),l;var c=!q.Shape.Utils.isClockWise(i[0].getPoints());c=e?!c:c;var u,d,h,f,p,m,g=[],v=[],y=[],_=0;for(v[_]=void 0,y[_]=[],d=0,h=i.length;d<h;d++)u=(s=i[d]).getPoints(),o=q.Shape.Utils.isClockWise(u),(o=e?!o:o)?(!c&&v[_]&&_++,v[_]={s:new q.Shape,p:u},v[_].s.actions=s.actions,v[_].s.curves=s.curves,c&&_++,y[_]=[]):y[_].push({h:s,p:u[0]});if(!v[0])return n(i);if(v.length>1){for(var b=!1,x=[],w=0,E=v.length;w<E;w++)g[w]=[];for(w=0,E=v.length;w<E;w++)for(var A=y[w],M=0;M<A.length;M++){for(var S=A[M],T=!0,C=0;C<v.length;C++)r(S.p,v[C].p)&&(w!=C&&x.push({froms:w,tos:C,hole:M}),T?(T=!1,g[C].push(S)):b=!0);T&&g[w].push(S)}x.length>0&&(b||(y=g))}for(d=0,h=v.length;d<h;d++)for(a=v[d].s,l.push(a),p=0,m=(f=y[d]).length;p<m;p++)a.holes.push(f[p].h);return l},q.Shape=function(){q.Path.apply(this,arguments),this.holes=[]},q.Shape.prototype=Object.create(q.Path.prototype),q.Shape.prototype.constructor=q.Shape,q.Shape.prototype.extrude=function(e){return new q.ExtrudeGeometry(this,e)},q.Shape.prototype.makeGeometry=function(e){return new q.ShapeGeometry(this,e)},q.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},q.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},q.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},q.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},q.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},q.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function r(e,t,r,i,o){var s=t.x-e.x,a=t.y-e.y,l=i.x-r.x,c=i.y-r.y,u=e.x-r.x,d=e.y-r.y,h=a*l-s*c,f=a*u-s*d;if(Math.abs(h)>1e-10){var p;if(h>0){if(f<0||f>h)return[];if((p=c*u-l*d)<0||p>h)return[]}else{if(f>0||f<h)return[];if((p=c*u-l*d)>0||p<h)return[]}if(0==p)return!o||0!=f&&f!=h?[e]:[];if(p==h)return!o||0!=f&&f!=h?[t]:[];if(0==f)return[r];if(f==h)return[i];var m=p/h;return[{x:e.x+m*s,y:e.y+m*a}]}if(0!=f||c*u!=l*d)return[];var g,v,y,_,b,x,w,E,A=0==s&&0==a,M=0==l&&0==c;return A&&M?e.x!=r.x||e.y!=r.y?[]:[e]:A?n(r,i,e)?[e]:[]:M?n(e,t,r)?[r]:[]:(0!=s?(e.x<t.x?(g=e,y=e.x,v=t,_=t.x):(g=t,y=t.x,v=e,_=e.x),r.x<i.x?(b=r,w=r.x,x=i,E=i.x):(b=i,w=i.x,x=r,E=r.x)):(e.y<t.y?(g=e,y=e.y,v=t,_=t.y):(g=t,y=t.y,v=e,_=e.y),r.y<i.y?(b=r,w=r.y,x=i,E=i.y):(b=i,w=i.y,x=r,E=r.y)),y<=w?_<w?[]:_==w?o?[]:[b]:_<=E?[b,v]:[b,x]:y>E?[]:y==E?o?[]:[g]:_<=E?[g,v]:[g,x])}function i(e,t,n,r){var i=t.x-e.x,o=t.y-e.y,s=n.x-e.x,a=n.y-e.y,l=r.x-e.x,c=r.y-e.y,u=i*a-o*s,d=i*c-o*l;if(Math.abs(u)>1e-10){var h=l*a-c*s;return u>0?d>=0&&h>=0:d>=0||h>=0}return d>0}for(var o,s,a,l,c,u,d={},h=e.concat(),f=0,p=t.length;f<p;f++)Array.prototype.push.apply(h,t[f]);for(o=0,s=h.length;o<s;o++)void 0!==d[c=h[o].x+":"+h[o].y]&&q.warn("THREE.Shape: Duplicate point",c),d[c]=o;var m=function(e,t){var n,o=e.concat();function s(e,t){var r=o.length-1,s=e-1;s<0&&(s=r);var a=e+1;a>r&&(a=0);var l=i(o[e],o[s],o[a],n[t]);if(!l)return!1;var c=n.length-1,u=t-1;u<0&&(u=c);var d=t+1;return d>c&&(d=0),!!(l=i(n[t],n[u],n[d],o[e]))}function a(e,t){var n,i;for(n=0;n<o.length;n++)if(i=n+1,i%=o.length,r(e,t,o[n],o[i],!0).length>0)return!0;return!1}var l=[];function c(e,n){var i,o,s,a;for(i=0;i<l.length;i++)for(o=t[l[i]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,r(e,n,o[s],o[a],!0).length>0)return!0;return!1}for(var u,d,h,f,p,m,g,v,y,_,b=[],x=0,w=t.length;x<w;x++)l.push(x);for(var E=0,A=2*l.length;l.length>0;){if(--A<0){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(d=E;d<o.length;d++){h=o[d],u=-1;for(x=0;x<l.length;x++)if(p=l[x],void 0===b[m=h.x+":"+h.y+":"+p]){n=t[p];for(var M=0;M<n.length;M++)if(f=n[M],s(d,M)&&!a(h,f)&&!c(h,f)){u=M,l.splice(x,1),g=o.slice(0,d+1),v=o.slice(d),y=n.slice(u),_=n.slice(0,u+1),o=g.concat(y).concat(_).concat(v),E=d;break}if(u>=0)break;b[m]=!0}if(u>=0)break}}return o}(e,t),g=q.FontUtils.Triangulate(m,!1);for(o=0,s=g.length;o<s;o++)for(l=g[o],a=0;a<3;a++)void 0!==(u=d[c=l[a].x+":"+l[a].y])&&(l[a]=u);return g.concat()},isClockWise:function(e){return q.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},q.LineCurve=function(e,t){this.v1=e,this.v2=t},q.LineCurve.prototype=Object.create(q.Curve.prototype),q.LineCurve.prototype.constructor=q.LineCurve,q.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},q.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},q.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},q.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},q.QuadraticBezierCurve.prototype=Object.create(q.Curve.prototype),q.QuadraticBezierCurve.prototype.constructor=q.QuadraticBezierCurve,q.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new q.Vector2;return t.x=q.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=q.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},q.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new q.Vector2;return t.x=q.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=q.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},q.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},q.CubicBezierCurve.prototype=Object.create(q.Curve.prototype),q.CubicBezierCurve.prototype.constructor=q.CubicBezierCurve,q.CubicBezierCurve.prototype.getPoint=function(e){var t,n;return t=q.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=q.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new q.Vector2(t,n)},q.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=q.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=q.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new q.Vector2(t,n);return r.normalize(),r},q.SplineCurve=function(e){this.points=null==e?[]:e},q.SplineCurve.prototype=Object.create(q.Curve.prototype),q.SplineCurve.prototype.constructor=q.SplineCurve,q.SplineCurve.prototype.getPoint=function(e){var t=this.points,n=(t.length-1)*e,r=Math.floor(n),i=n-r,o=t[0==r?r:r-1],s=t[r],a=t[r>t.length-2?t.length-1:r+1],l=t[r>t.length-3?t.length-1:r+2],c=new q.Vector2;return c.x=q.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,i),c.y=q.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,i),c},q.EllipseCurve=function(e,t,n,r,i,o,s){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s},q.EllipseCurve.prototype=Object.create(q.Curve.prototype),q.EllipseCurve.prototype.constructor=q.EllipseCurve,q.EllipseCurve.prototype.getPoint=function(e){var t,n=this.aEndAngle-this.aStartAngle;n<0&&(n+=2*Math.PI),n>2*Math.PI&&(n-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-n):this.aStartAngle+e*n;var r=new q.Vector2;return r.x=this.aX+this.xRadius*Math.cos(t),r.y=this.aY+this.yRadius*Math.sin(t),r},q.ArcCurve=function(e,t,n,r,i,o){q.EllipseCurve.call(this,e,t,n,n,r,i,o)},q.ArcCurve.prototype=Object.create(q.EllipseCurve.prototype),q.ArcCurve.prototype.constructor=q.ArcCurve,q.LineCurve3=q.Curve.create((function(e,t){this.v1=e,this.v2=t}),(function(e){var t=new q.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t})),q.QuadraticBezierCurve3=q.Curve.create((function(e,t,n){this.v0=e,this.v1=t,this.v2=n}),(function(e){var t=new q.Vector3;return t.x=q.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=q.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=q.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t})),q.CubicBezierCurve3=q.Curve.create((function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r}),(function(e){var t=new q.Vector3;return t.x=q.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=q.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=q.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t})),q.SplineCurve3=q.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t=this.points,n=(t.length-1)*e,r=Math.floor(n),i=n-r,o=t[0==r?r:r-1],s=t[r],a=t[r>t.length-2?t.length-1:r+1],l=t[r>t.length-3?t.length-1:r+2],c=new q.Vector3;return c.x=q.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,i),c.y=q.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,i),c.z=q.Curve.Utils.interpolate(o.z,s.z,a.z,l.z,i),c})),q.ClosedSplineCurve3=q.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t=this.points,n=(t.length-0)*e,r=Math.floor(n),i=n-r,o=t[((r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length)-1)%t.length],s=t[r%t.length],a=t[(r+1)%t.length],l=t[(r+2)%t.length],c=new q.Vector3;return c.x=q.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,i),c.y=q.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,i),c.z=q.Curve.Utils.interpolate(o.z,s.z,a.z,l.z,i),c})),q.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){q.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){q.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){q.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof q.Quaternion)){var r=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=(new q.Quaternion).fromArray(r)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var i={};for(n=0;n<e.hierarchy[t].keys.length;n++)for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++){i[a=e.hierarchy[t].keys[n].morphTargets[o]]=-1}e.hierarchy[t].usedMorphTargets=i;for(n=0;n<e.hierarchy[t].keys.length;n++){var s={};for(var a in i){for(o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++)if(e.hierarchy[t].keys[n].morphTargets[o]===a){s[a]=e.hierarchy[t].keys[n].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[n].morphTargets.length&&(s[a]=0)}e.hierarchy[t].keys[n].morphTargetsInfluences=s}}for(n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},parse:function(e){var t=[];if(e instanceof q.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)t.push(e.skeleton.bones[n]);else!function e(t,n){n.push(t);for(var r=0;r<t.children.length;r++)e(t.children[r],n)}(e,t);return t},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(t=0;t<this.animations.length;t++)this.animations[t].update(e)}},q.Animation=function(e,t){this.root=e,this.data=q.AnimationHandler.init(t),this.hierarchy=q.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=q.AnimationHandler.LINEAR},q.Animation.prototype={constructor:q.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),q.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,q.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];void 0===n.animationCache&&(n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var r=this.data.name,i=n.animationCache.animations,o=i[r];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:n.matrix},i[r]=o);for(var s=0;s<3;s++){for(var a=this.keyTypes[s],l=this.data.hierarchy[e].keys[0],c=this.getNextKeyWith(a,e,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(a,e,c.index+1);o.prevKey[a]=l,o.nextKey[a]=c}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e].animationCache;if(void 0!==n){var r=n.blending;r.positionWeight=0,r.quaternionWeight=0,r.scaleWeight=0}}},update:function(){var e=[],t=new q.Vector3,n=new q.Vector3,r=new q.Quaternion,i=function(e,t){var n,r,i,s,a,l,c,u,d,h=[],f=[];return i=(n=(e.length-1)*t)-(r=Math.floor(n)),h[0]=0===r?r:r-1,h[1]=r,h[2]=r>e.length-2?r:r+1,h[3]=r>e.length-3?r:r+2,l=e[h[0]],c=e[h[1]],u=e[h[2]],d=e[h[3]],a=i*(s=i*i),f[0]=o(l[0],c[0],u[0],d[0],i,s,a),f[1]=o(l[1],c[1],u[1],d[1],i,s,a),f[2]=o(l[2],c[2],u[2],d[2],i,s,a),f},o=function(e,t,n,r,i,o,s){var a=.5*(n-e),l=.5*(r-t);return(2*(t-n)+a+l)*s+(-3*(t-n)-2*a-l)*o+a*i+t};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var s=this.data.length;(this.currentTime>s||this.currentTime<0)&&(this.loop?(this.currentTime%=s,this.currentTime<0&&(this.currentTime+=s),this.reset()):this.stop());for(var a=0,l=this.hierarchy.length;a<l;a++)for(var c=this.hierarchy[a],u=c.animationCache.animations[this.data.name],d=c.animationCache.blending,h=0;h<3;h++){var f=this.keyTypes[h],p=u.prevKey[f],m=u.nextKey[f];if(this.timeScale>0&&m.time<=this.currentTime||this.timeScale<0&&p.time>=this.currentTime){for(p=this.data.hierarchy[a].keys[0],m=this.getNextKeyWith(f,a,1);m.time<this.currentTime&&m.index>p.index;)p=m,m=this.getNextKeyWith(f,a,m.index+1);u.prevKey[f]=p,u.nextKey[f]=m}var g=(this.currentTime-p.time)/(m.time-p.time),v=p[f],y=m[f];if(g<0&&(g=0),g>1&&(g=1),"pos"===f){if(this.interpolationType===q.AnimationHandler.LINEAR){n.x=v[0]+(y[0]-v[0])*g,n.y=v[1]+(y[1]-v[1])*g,n.z=v[2]+(y[2]-v[2])*g;var _=this.weight/(this.weight+d.positionWeight);c.position.lerp(n,_),d.positionWeight+=this.weight}else if(this.interpolationType===q.AnimationHandler.CATMULLROM||this.interpolationType===q.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",a,p.index-1).pos,e[1]=v,e[2]=y,e[3]=this.getNextKeyWith("pos",a,m.index+1).pos;var b=i(e,g=.33*g+.33);_=this.weight/(this.weight+d.positionWeight);d.positionWeight+=this.weight;var x=c.position;if(x.x=x.x+(b[0]-x.x)*_,x.y=x.y+(b[1]-x.y)*_,x.z=x.z+(b[2]-x.z)*_,this.interpolationType===q.AnimationHandler.CATMULLROM_FORWARD){var w=i(e,1.01*g);t.set(w[0],w[1],w[2]),t.sub(x),t.y=0,t.normalize();var E=Math.atan2(t.x,t.z);c.rotation.set(0,E,0)}}}else if("rot"===f)if(q.Quaternion.slerp(v,y,r,g),0===d.quaternionWeight)c.quaternion.copy(r),d.quaternionWeight=this.weight;else{_=this.weight/(this.weight+d.quaternionWeight);q.Quaternion.slerp(c.quaternion,r,c.quaternion,_),d.quaternionWeight+=this.weight}else if("scl"===f){n.x=v[0]+(y[0]-v[0])*g,n.y=v[1]+(y[1]-v[1])*g,n.z=v[2]+(y[2]-v[2])*g;_=this.weight/(this.weight+d.scaleWeight);c.scale.lerp(n,_),d.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,n){var r=this.data.hierarchy[t].keys;for(this.interpolationType===q.AnimationHandler.CATMULLROM||this.interpolationType===q.AnimationHandler.CATMULLROM_FORWARD?n=n<r.length-1?n:r.length-1:n%=r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===q.AnimationHandler.CATMULLROM||this.interpolationType===q.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]}},q.KeyFrameAnimation=function(e){this.root=e.node,this.data=q.AnimationHandler.init(e),this.hierarchy=q.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,n=this.hierarchy.length;t<n;t++){var r=this.data.hierarchy[t].keys,i=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(r.length&&i){for(var s=0;s<i.length;s++){var a=i[s],l=this.getNextKeyWith(a,t,0);l&&l.apply(a)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},q.KeyFrameAnimation.prototype={constructor:q.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,n,r,i=this.hierarchy.length;for(t=0;t<i;t++){n=this.hierarchy[t],void 0===(r=this.data.hierarchy[t]).animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n.matrix);var o=this.data.hierarchy[t].keys;o.length&&(r.animationCache.prevKey=o[0],r.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,q.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,q.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;r.copy(t.matrix),t.matrix=r,delete n.animationCache}}},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.hierarchy[n],o=this.data.hierarchy[n],s=o.keys,a=o.animationCache;if(s.length){var l=a.prevKey,c=a.nextKey;if(c.time<=this.currentTime){for(;c.time<this.currentTime&&c.index>l.index;)c=s[(l=c).index+1];a.prevKey=l,a.nextKey=c}c.time>=this.currentTime?l.interpolate(c,this.currentTime):l.interpolate(c,c.time),this.data.hierarchy[n].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,n){var r=this.data.hierarchy[t].keys;for(n%=r.length;n<r.length;n++)if(r[n].hasTarget(e))return r[n];return r[0]},getPrevKeyWith:function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=n>=0?n:n+r.length;n>=0;n--)if(r[n].hasTarget(e))return r[n];return r[r.length-1]}},q.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},q.MorphAnimation.prototype={constructor:q.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,n=Math.floor(this.currentTime/t),r=this.mesh.morphTargetInfluences;n!=this.currentFrame&&(r[this.lastFrame]=0,r[this.currentFrame]=1,r[n]=0,this.lastFrame=this.currentFrame,this.currentFrame=n),r[n]=this.currentTime%t/t,r[this.lastFrame]=1-r[n]}}},q.BoxGeometry=function(e,t,n,r,i,o){q.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=o||1;var s=this,a=e/2,l=t/2,c=n/2;function u(e,t,n,r,i,o,a,l){var c,u,d,h=s.widthSegments,f=s.heightSegments,p=i/2,m=o/2,g=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",f=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",h=s.depthSegments);var v=h+1,y=f+1,_=i/h,b=o/f,x=new q.Vector3;for(x[c]=a>0?1:-1,d=0;d<y;d++)for(u=0;u<v;u++){var w=new q.Vector3;w[e]=(u*_-p)*n,w[t]=(d*b-m)*r,w[c]=a,s.vertices.push(w)}for(d=0;d<f;d++)for(u=0;u<h;u++){var E=u+v*d,A=u+v*(d+1),M=u+1+v*(d+1),S=u+1+v*d,T=new q.Vector2(u/h,1-d/f),C=new q.Vector2(u/h,1-(d+1)/f),P=new q.Vector2((u+1)/h,1-(d+1)/f),L=new q.Vector2((u+1)/h,1-d/f),D=new q.Face3(E+g,A+g,S+g);D.normal.copy(x),D.vertexNormals.push(x.clone(),x.clone(),x.clone()),D.materialIndex=l,s.faces.push(D),s.faceVertexUvs[0].push([T,C,L]),(D=new q.Face3(A+g,M+g,S+g)).normal.copy(x),D.vertexNormals.push(x.clone(),x.clone(),x.clone()),D.materialIndex=l,s.faces.push(D),s.faceVertexUvs[0].push([C.clone(),P,L.clone()])}}u("z","y",-1,-1,n,t,a,0),u("z","y",1,-1,n,t,-a,1),u("x","z",1,1,e,n,l,2),u("x","z",1,-1,e,n,-l,3),u("x","y",1,-1,e,t,c,4),u("x","y",-1,-1,e,t,-c,5),this.mergeVertices()},q.BoxGeometry.prototype=Object.create(q.Geometry.prototype),q.BoxGeometry.prototype.constructor=q.BoxGeometry,q.CircleGeometry=function(e,t,n,r){q.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o=[],s=new q.Vector3,a=new q.Vector2(.5,.5);for(this.vertices.push(s),o.push(a),i=0;i<=t;i++){var l=new q.Vector3,c=n+i/t*r;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),o.push(new q.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var u=new q.Vector3(0,0,1);for(i=1;i<=t;i++)this.faces.push(new q.Face3(i,i+1,0,[u.clone(),u.clone(),u.clone()])),this.faceVertexUvs[0].push([o[i].clone(),o[i+1].clone(),a.clone()]);this.computeFaceNormals(),this.boundingSphere=new q.Sphere(new q.Vector3,e)},q.CircleGeometry.prototype=Object.create(q.Geometry.prototype),q.CircleGeometry.prototype.constructor=q.CircleGeometry,q.CubeGeometry=function(e,t,n,r,i,o){return q.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new q.BoxGeometry(e,t,n,r,i,o)},q.CylinderGeometry=function(e,t,n,r,i,o,s,a){q.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,r=r||8,i=i||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var l,c,u=n/2,d=[],h=[];for(c=0;c<=i;c++){var f=[],p=[],m=c/i,g=m*(t-e)+e;for(l=0;l<=r;l++){var v=l/r,y=new q.Vector3;y.x=g*Math.sin(v*a+s),y.y=-m*n+u,y.z=g*Math.cos(v*a+s),this.vertices.push(y),f.push(this.vertices.length-1),p.push(new q.Vector2(v,1-m))}d.push(f),h.push(p)}var _,b,x=(t-e)/n;for(l=0;l<r;l++)for(0!==e?(_=this.vertices[d[0][l]].clone(),b=this.vertices[d[0][l+1]].clone()):(_=this.vertices[d[1][l]].clone(),b=this.vertices[d[1][l+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*x).normalize(),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*x).normalize(),c=0;c<i;c++){var w=d[c][l],E=d[c+1][l],A=d[c+1][l+1],M=d[c][l+1],S=_.clone(),T=_.clone(),C=b.clone(),P=b.clone(),L=h[c][l].clone(),D=h[c+1][l].clone(),R=h[c+1][l+1].clone(),I=h[c][l+1].clone();this.faces.push(new q.Face3(w,E,M,[S,T,P])),this.faceVertexUvs[0].push([L,D,I]),this.faces.push(new q.Face3(E,A,M,[T.clone(),C,P.clone()])),this.faceVertexUvs[0].push([D.clone(),R,I.clone()])}if(!1===o&&e>0)for(this.vertices.push(new q.Vector3(0,u,0)),l=0;l<r;l++){w=d[0][l],E=d[0][l+1],A=this.vertices.length-1,S=new q.Vector3(0,1,0),T=new q.Vector3(0,1,0),C=new q.Vector3(0,1,0),L=h[0][l].clone(),D=h[0][l+1].clone(),R=new q.Vector2(D.x,0);this.faces.push(new q.Face3(w,E,A,[S,T,C])),this.faceVertexUvs[0].push([L,D,R])}if(!1===o&&t>0)for(this.vertices.push(new q.Vector3(0,-u,0)),l=0;l<r;l++){w=d[i][l+1],E=d[i][l],A=this.vertices.length-1,S=new q.Vector3(0,-1,0),T=new q.Vector3(0,-1,0),C=new q.Vector3(0,-1,0),L=h[i][l+1].clone(),D=h[i][l].clone(),R=new q.Vector2(D.x,1);this.faces.push(new q.Face3(w,E,A,[S,T,C])),this.faceVertexUvs[0].push([L,D,R])}this.computeFaceNormals()},q.CylinderGeometry.prototype=Object.create(q.Geometry.prototype),q.CylinderGeometry.prototype.constructor=q.CylinderGeometry,q.ExtrudeGeometry=function(e,t){void 0!==e?(q.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},q.ExtrudeGeometry.prototype=Object.create(q.Geometry.prototype),q.ExtrudeGeometry.prototype.constructor=q.ExtrudeGeometry,q.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];this.addShape(i,t)}},q.ExtrudeGeometry.prototype.addShape=function(e,t){var n,r,i,o,s,a,l,c,u=void 0!==t.amount?t.amount:100,d=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:d-2,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,_=t.material,b=t.extrudeMaterial,x=void 0!==t.UVGenerator?t.UVGenerator:q.ExtrudeGeometry.WorldUVGenerator;v&&(n=v.getSpacedPoints(g),y=!0,p=!1,r=void 0!==t.frames?t.frames:new q.TubeGeometry.FrenetFrames(v,g,!1),i=new q.Vector3,o=new q.Vector3,s=new q.Vector3),p||(f=0,d=0,h=0);var w=this,E=this.vertices.length,A=e.extractPoints(m),M=A.shape,S=A.holes,T=!q.Shape.Utils.isClockWise(M);if(T){for(M=M.reverse(),l=0,c=S.length;l<c;l++)a=S[l],q.Shape.Utils.isClockWise(a)&&(S[l]=a.reverse());T=!1}var C=q.Shape.Utils.triangulateShape(M,S),P=M;for(l=0,c=S.length;l<c;l++)a=S[l],M=M.concat(a);function L(e,t,n){return t||q.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var D,R,I,j,O,N,k=M.length,F=C.length;function V(e,t,n){var r,i,o=1,s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,d=s*c-a*l;if(Math.abs(d)>1e-10){var h=Math.sqrt(u),f=Math.sqrt(l*l+c*c),p=t.x-a/h,m=t.y+s/h,g=((n.x-c/f-p)*c-(n.y+l/f-m)*l)/(s*c-a*l),v=(r=p+s*g-e.x)*r+(i=m+a*g-e.y)*i;if(v<=2)return new q.Vector2(r,i);o=Math.sqrt(v/2)}else{var y=!1;s>1e-10?l>1e-10&&(y=!0):s<-1e-10?l<-1e-10&&(y=!0):Math.sign(a)==Math.sign(c)&&(y=!0),y?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new q.Vector2(r/o,i/o)}for(var B=[],U=0,z=P.length,G=z-1,H=U+1;U<z;U++,G++,H++)G===z&&(G=0),H===z&&(H=0),B[U]=V(P[U],P[G],P[H]);var W,X,Y=[],K=B.concat();for(l=0,c=S.length;l<c;l++){for(a=S[l],W=[],U=0,G=(z=a.length)-1,H=U+1;U<z;U++,G++,H++)G===z&&(G=0),H===z&&(H=0),W[U]=V(a[U],a[G],a[H]);Y.push(W),K=K.concat(W)}for(D=0;D<f;D++){for(j=d*(1-(I=D/f)),R=h*Math.sin(I*Math.PI/2),U=0,z=P.length;U<z;U++)Z((O=L(P[U],B[U],R)).x,O.y,-j);for(l=0,c=S.length;l<c;l++)for(a=S[l],W=Y[l],U=0,z=a.length;U<z;U++)Z((O=L(a[U],W[U],R)).x,O.y,-j)}for(R=h,U=0;U<k;U++)O=p?L(M[U],K[U],R):M[U],y?(o.copy(r.normals[0]).multiplyScalar(O.x),i.copy(r.binormals[0]).multiplyScalar(O.y),s.copy(n[0]).add(o).add(i),Z(s.x,s.y,s.z)):Z(O.x,O.y,0);for(X=1;X<=g;X++)for(U=0;U<k;U++)O=p?L(M[U],K[U],R):M[U],y?(o.copy(r.normals[X]).multiplyScalar(O.x),i.copy(r.binormals[X]).multiplyScalar(O.y),s.copy(n[X]).add(o).add(i),Z(s.x,s.y,s.z)):Z(O.x,O.y,u/g*X);for(D=f-1;D>=0;D--){for(j=d*(1-(I=D/f)),R=h*Math.sin(I*Math.PI/2),U=0,z=P.length;U<z;U++)Z((O=L(P[U],B[U],R)).x,O.y,u+j);for(l=0,c=S.length;l<c;l++)for(a=S[l],W=Y[l],U=0,z=a.length;U<z;U++)O=L(a[U],W[U],R),y?Z(O.x,O.y+n[g-1].y,n[g-1].x+j):Z(O.x,O.y,u+j)}function Q(e,t){var n,r;for(U=e.length;--U>=0;){n=U,(r=U-1)<0&&(r=e.length-1);var i=0,o=g+2*f;for(i=0;i<o;i++){var s=k*i,a=k*(i+1);$(t+n+s,t+r+s,t+r+a,t+n+a,e,i,o,n,r)}}}function Z(e,t,n){w.vertices.push(new q.Vector3(e,t,n))}function J(e,t,n){e+=E,t+=E,n+=E,w.faces.push(new q.Face3(e,t,n,null,null,_));var r=x.generateTopUV(w,e,t,n);w.faceVertexUvs[0].push(r)}function $(e,t,n,r,i,o,s,a,l){e+=E,t+=E,n+=E,r+=E,w.faces.push(new q.Face3(e,t,r,null,null,b)),w.faces.push(new q.Face3(t,n,r,null,null,b));var c=x.generateSideWallUV(w,e,t,n,r);w.faceVertexUvs[0].push([c[0],c[1],c[3]]),w.faceVertexUvs[0].push([c[1],c[2],c[3]])}!function(){if(p){var e=0,t=k*e;for(U=0;U<F;U++)J((N=C[U])[2]+t,N[1]+t,N[0]+t);for(t=k*(e=g+2*f),U=0;U<F;U++)J((N=C[U])[0]+t,N[1]+t,N[2]+t)}else{for(U=0;U<F;U++)J((N=C[U])[2],N[1],N[0]);for(U=0;U<F;U++)J((N=C[U])[0]+k*g,N[1]+k*g,N[2]+k*g)}}(),function(){var e=0;for(Q(P,e),e+=P.length,l=0,c=S.length;l<c;l++)Q(a=S[l],e),e+=a.length}()},q.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r){var i=e.vertices,o=i[t],s=i[n],a=i[r];return[new q.Vector2(o.x,o.y),new q.Vector2(s.x,s.y),new q.Vector2(a.x,a.y)]},generateSideWallUV:function(e,t,n,r,i){var o=e.vertices,s=o[t],a=o[n],l=o[r],c=o[i];return Math.abs(s.y-a.y)<.01?[new q.Vector2(s.x,1-s.z),new q.Vector2(a.x,1-a.z),new q.Vector2(l.x,1-l.z),new q.Vector2(c.x,1-c.z)]:[new q.Vector2(s.y,1-s.z),new q.Vector2(a.y,1-a.z),new q.Vector2(l.y,1-l.z),new q.Vector2(c.y,1-c.z)]}},q.ShapeGeometry=function(e,t){q.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},q.ShapeGeometry.prototype=Object.create(q.Geometry.prototype),q.ShapeGeometry.prototype.constructor=q.ShapeGeometry,q.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},q.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n,r,i,o=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,a=void 0===t.UVGenerator?q.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,c=e.extractPoints(o),u=c.shape,d=c.holes,h=!q.Shape.Utils.isClockWise(u);if(h){for(u=u.reverse(),n=0,r=d.length;n<r;n++)i=d[n],q.Shape.Utils.isClockWise(i)&&(d[n]=i.reverse());h=!1}var f=q.Shape.Utils.triangulateShape(u,d);for(n=0,r=d.length;n<r;n++)i=d[n],u=u.concat(i);var p,m,g=u.length,v=f.length;for(n=0;n<g;n++)p=u[n],this.vertices.push(new q.Vector3(p.x,p.y,0));for(n=0;n<v;n++){var y=(m=f[n])[0]+l,_=m[1]+l,b=m[2]+l;this.faces.push(new q.Face3(y,_,b,null,null,s)),this.faceVertexUvs[0].push(a.generateTopUV(this,y,_,b))}},q.LatheGeometry=function(e,t,n,r){q.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=t||12,n=n||0,r=r||2*Math.PI;for(var i=1/(e.length-1),o=1/t,s=0,a=t;s<=a;s++)for(var l=n+s*o*r,c=Math.cos(l),u=Math.sin(l),d=0,h=e.length;d<h;d++){var f=e[d],p=new q.Vector3;p.x=c*f.x-u*f.y,p.y=u*f.x+c*f.y,p.z=f.z,this.vertices.push(p)}var m=e.length;for(s=0,a=t;s<a;s++)for(d=0,h=e.length-1;d<h;d++){var g=d+m*s,v=g,y=g+m,_=(c=g+1+m,g+1),b=s*o,x=d*i,w=b+o,E=x+i;this.faces.push(new q.Face3(v,y,_)),this.faceVertexUvs[0].push([new q.Vector2(b,x),new q.Vector2(w,x),new q.Vector2(b,E)]),this.faces.push(new q.Face3(y,c,_)),this.faceVertexUvs[0].push([new q.Vector2(w,x),new q.Vector2(w,E),new q.Vector2(b,E)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},q.LatheGeometry.prototype=Object.create(q.Geometry.prototype),q.LatheGeometry.prototype.constructor=q.LatheGeometry,q.PlaneGeometry=function(e,t,n,r){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),q.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new q.PlaneBufferGeometry(e,t,n,r))},q.PlaneGeometry.prototype=Object.create(q.Geometry.prototype),q.PlaneGeometry.prototype.constructor=q.PlaneGeometry,q.PlaneBufferGeometry=function(e,t,n,r){q.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};for(var i=e/2,o=t/2,s=n||1,a=r||1,l=s+1,c=a+1,u=e/s,d=t/a,h=new Float32Array(l*c*3),f=new Float32Array(l*c*3),p=new Float32Array(l*c*2),m=0,g=0,v=0;v<c;v++)for(var y=v*d-o,_=0;_<l;_++){var b=_*u-i;h[m]=b,h[m+1]=-y,f[m+2]=1,p[g]=_/s,p[g+1]=1-v/a,m+=3,g+=2}m=0;var x=new(h.length/3>65535?Uint32Array:Uint16Array)(s*a*6);for(v=0;v<a;v++)for(_=0;_<s;_++){var w=_+l*v,E=_+l*(v+1),A=_+1+l*(v+1),M=_+1+l*v;x[m]=w,x[m+1]=E,x[m+2]=M,x[m+3]=E,x[m+4]=A,x[m+5]=M,m+=6}this.addAttribute("index",new q.BufferAttribute(x,1)),this.addAttribute("position",new q.BufferAttribute(h,3)),this.addAttribute("normal",new q.BufferAttribute(f,3)),this.addAttribute("uv",new q.BufferAttribute(p,2))},q.PlaneBufferGeometry.prototype=Object.create(q.BufferGeometry.prototype),q.PlaneBufferGeometry.prototype.constructor=q.PlaneBufferGeometry,q.RingGeometry=function(e,t,n,r,i,o){q.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},e=e||0,t=t||50,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var s,a,l=[],c=e,u=(t-e)/(r=void 0!==r?Math.max(1,r):8);for(s=0;s<r+1;s++){for(a=0;a<n+1;a++){var d=new q.Vector3,h=i+a/n*o;d.x=c*Math.cos(h),d.y=c*Math.sin(h),this.vertices.push(d),l.push(new q.Vector2((d.x/t+1)/2,(d.y/t+1)/2))}c+=u}var f=new q.Vector3(0,0,1);for(s=0;s<r;s++){var p=s*(n+1);for(a=0;a<n;a++){var m=h=a+p,g=h+n+1,v=h+n+2;this.faces.push(new q.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=h,g=h+n+2,v=h+1,this.faces.push(new q.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new q.Sphere(new q.Vector3,c)},q.RingGeometry.prototype=Object.create(q.Geometry.prototype),q.RingGeometry.prototype.constructor=q.RingGeometry,q.SphereGeometry=function(e,t,n,r,i,o,s){q.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;var a,l,c=[],u=[];for(l=0;l<=n;l++){var d=[],h=[];for(a=0;a<=t;a++){var f=a/t,p=l/n,m=new q.Vector3;m.x=-e*Math.cos(r+f*i)*Math.sin(o+p*s),m.y=e*Math.cos(o+p*s),m.z=e*Math.sin(r+f*i)*Math.sin(o+p*s),this.vertices.push(m),d.push(this.vertices.length-1),h.push(new q.Vector2(f,1-p))}c.push(d),u.push(h)}for(l=0;l<n;l++)for(a=0;a<t;a++){var g=c[l][a+1],v=c[l][a],y=c[l+1][a],_=c[l+1][a+1],b=this.vertices[g].clone().normalize(),x=this.vertices[v].clone().normalize(),w=this.vertices[y].clone().normalize(),E=this.vertices[_].clone().normalize(),A=u[l][a+1].clone(),M=u[l][a].clone(),S=u[l+1][a].clone(),T=u[l+1][a+1].clone();Math.abs(this.vertices[g].y)===e?(A.x=(A.x+M.x)/2,this.faces.push(new q.Face3(g,y,_,[b,w,E])),this.faceVertexUvs[0].push([A,S,T])):Math.abs(this.vertices[y].y)===e?(S.x=(S.x+T.x)/2,this.faces.push(new q.Face3(g,v,y,[b,x,w])),this.faceVertexUvs[0].push([A,M,S])):(this.faces.push(new q.Face3(g,v,_,[b,x,E])),this.faceVertexUvs[0].push([A,M,T]),this.faces.push(new q.Face3(v,y,_,[x.clone(),w,E.clone()])),this.faceVertexUvs[0].push([M.clone(),S,T.clone()]))}this.computeFaceNormals(),this.boundingSphere=new q.Sphere(new q.Vector3,e)},q.SphereGeometry.prototype=Object.create(q.Geometry.prototype),q.SphereGeometry.prototype.constructor=q.SphereGeometry,q.TextGeometry=function(e,t){t=t||{};var n=q.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),q.ExtrudeGeometry.call(this,n,t),this.type="TextGeometry"},q.TextGeometry.prototype=Object.create(q.ExtrudeGeometry.prototype),q.TextGeometry.prototype.constructor=q.TextGeometry,q.TorusGeometry=function(e,t,n,r,i){q.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||100,t=t||40,n=n||8,r=r||6,i=i||2*Math.PI;for(var o=new q.Vector3,s=[],a=[],l=0;l<=n;l++)for(var c=0;c<=r;c++){var u=c/r*i,d=l/n*Math.PI*2;o.x=e*Math.cos(u),o.y=e*Math.sin(u);var h=new q.Vector3;h.x=(e+t*Math.cos(d))*Math.cos(u),h.y=(e+t*Math.cos(d))*Math.sin(u),h.z=t*Math.sin(d),this.vertices.push(h),s.push(new q.Vector2(c/r,l/n)),a.push(h.clone().sub(o).normalize())}for(l=1;l<=n;l++)for(c=1;c<=r;c++){var f=(r+1)*l+c-1,p=(r+1)*(l-1)+c-1,m=(r+1)*(l-1)+c,g=(r+1)*l+c,v=new q.Face3(f,p,g,[a[f].clone(),a[p].clone(),a[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([s[f].clone(),s[p].clone(),s[g].clone()]),v=new q.Face3(p,m,g,[a[p].clone(),a[m].clone(),a[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[g].clone()])}this.computeFaceNormals()},q.TorusGeometry.prototype=Object.create(q.Geometry.prototype),q.TorusGeometry.prototype.constructor=q.TorusGeometry,q.TorusKnotGeometry=function(e,t,n,r,i,o,s){q.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,p:i,q:o,heightScale:s},e=e||100,t=t||40,n=n||64,r=r||8,i=i||2,o=o||3,s=s||1;for(var a=new Array(n),l=new q.Vector3,c=new q.Vector3,u=new q.Vector3,d=0;d<n;++d){a[d]=new Array(r);var h=d/n*2*i*Math.PI,f=L(h,o,i,e,s),p=L(h+.01,o,i,e,s);l.subVectors(p,f),c.addVectors(p,f),u.crossVectors(l,c),c.crossVectors(u,l),u.normalize(),c.normalize();for(var m=0;m<r;++m){var g=m/r*2*Math.PI,v=-t*Math.cos(g),y=t*Math.sin(g),_=new q.Vector3;_.x=f.x+v*c.x+y*u.x,_.y=f.y+v*c.y+y*u.y,_.z=f.z+v*c.z+y*u.z,a[d][m]=this.vertices.push(_)-1}}for(d=0;d<n;++d)for(m=0;m<r;++m){var b=(d+1)%n,x=(m+1)%r,w=a[d][m],E=a[b][m],A=a[b][x],M=a[d][x],S=new q.Vector2(d/n,m/r),T=new q.Vector2((d+1)/n,m/r),C=new q.Vector2((d+1)/n,(m+1)/r),P=new q.Vector2(d/n,(m+1)/r);this.faces.push(new q.Face3(w,E,M)),this.faceVertexUvs[0].push([S,T,P]),this.faces.push(new q.Face3(E,A,M)),this.faceVertexUvs[0].push([T.clone(),C,P.clone()])}function L(e,t,n,r,i){var o=Math.cos(e),s=Math.sin(e),a=t/n*e,l=Math.cos(a),c=r*(2+l)*.5*o,u=r*(2+l)*s*.5,d=i*r*Math.sin(a)*.5;return new q.Vector3(c,u,d)}this.computeFaceNormals(),this.computeVertexNormals()},q.TorusKnotGeometry.prototype=Object.create(q.Geometry.prototype),q.TorusKnotGeometry.prototype.constructor=q.TorusKnotGeometry,q.TubeGeometry=function(e,t,n,r,i,o){q.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1,o=o||q.TubeGeometry.NoTaper;var s,a,l,c,u,d,h,f,p,m,g,v,y,_,b,x,w,E,A,M,S=[],T=this,C=t+1,P=new q.Vector3,L=new q.TubeGeometry.FrenetFrames(e,t,i),D=L.tangents,R=L.normals,I=L.binormals;function j(e,t,n){return T.vertices.push(new q.Vector3(e,t,n))-1}for(this.tangents=D,this.normals=R,this.binormals=I,p=0;p<C;p++)for(S[p]=[],l=p/(C-1),f=e.getPointAt(l),D[p],s=R[p],a=I[p],u=n*o(l),m=0;m<r;m++)c=m/r*2*Math.PI,d=-u*Math.cos(c),h=u*Math.sin(c),P.copy(f),P.x+=d*s.x+h*a.x,P.y+=d*s.y+h*a.y,P.z+=d*s.z+h*a.z,S[p][m]=j(P.x,P.y,P.z);for(p=0;p<t;p++)for(m=0;m<r;m++)g=i?(p+1)%t:p+1,v=(m+1)%r,y=S[p][m],_=S[g][m],b=S[g][v],x=S[p][v],w=new q.Vector2(p/t,m/r),E=new q.Vector2((p+1)/t,m/r),A=new q.Vector2((p+1)/t,(m+1)/r),M=new q.Vector2(p/t,(m+1)/r),this.faces.push(new q.Face3(y,_,x)),this.faceVertexUvs[0].push([w,E,M]),this.faces.push(new q.Face3(_,b,x)),this.faceVertexUvs[0].push([E.clone(),A,M.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},q.TubeGeometry.prototype=Object.create(q.Geometry.prototype),q.TubeGeometry.prototype.constructor=q.TubeGeometry,q.TubeGeometry.NoTaper=function(e){return 1},q.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},q.TubeGeometry.FrenetFrames=function(e,t,n){var r,i,o,s,a,l,c,u=new q.Vector3,d=[],h=[],f=[],p=new q.Vector3,m=new q.Matrix4,g=t+1;for(this.tangents=d,this.normals=h,this.binormals=f,l=0;l<g;l++)c=l/(g-1),d[l]=e.getTangentAt(c),d[l].normalize();for(function(){h[0]=new q.Vector3,f[0]=new q.Vector3,i=Number.MAX_VALUE,o=Math.abs(d[0].x),s=Math.abs(d[0].y),a=Math.abs(d[0].z),o<=i&&(i=o,u.set(1,0,0));s<=i&&(i=s,u.set(0,1,0));a<=i&&u.set(0,0,1);p.crossVectors(d[0],u).normalize(),h[0].crossVectors(d[0],p),f[0].crossVectors(d[0],h[0])}(),l=1;l<g;l++)h[l]=h[l-1].clone(),f[l]=f[l-1].clone(),p.crossVectors(d[l-1],d[l]),p.length()>1e-4&&(p.normalize(),r=Math.acos(q.Math.clamp(d[l-1].dot(d[l]),-1,1)),h[l].applyMatrix4(m.makeRotationAxis(p,r))),f[l].crossVectors(d[l],h[l]);if(n)for(r=Math.acos(q.Math.clamp(h[0].dot(h[g-1]),-1,1)),r/=g-1,d[0].dot(p.crossVectors(h[0],h[g-1]))>0&&(r=-r),l=1;l<g;l++)h[l].applyMatrix4(m.makeRotationAxis(d[l],r*l)),f[l].crossVectors(d[l],h[l])},q.PolyhedronGeometry=function(e,t,n,r){q.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1,r=r||0;for(var i=this,o=0,s=e.length;o<s;o+=3)b(new q.Vector3(e[o],e[o+1],e[o+2]));var a=this.vertices,l=[],c=(o=0,0);for(s=t.length;o<s;o+=3,c++){var u=a[t[o]],d=a[t[o+1]],h=a[t[o+2]];l[c]=new q.Face3(u.index,d.index,h.index,[u.clone(),d.clone(),h.clone()])}var f=new q.Vector3;for(o=0,s=l.length;o<s;o++)w(l[o],r);for(o=0,s=this.faceVertexUvs[0].length;o<s;o++){var p=this.faceVertexUvs[0][o],m=p[0].x,g=p[1].x,v=p[2].x,y=Math.max(m,Math.max(g,v)),_=Math.min(m,Math.min(g,v));y>.9&&_<.1&&(m<.2&&(p[0].x+=1),g<.2&&(p[1].x+=1),v<.2&&(p[2].x+=1))}for(o=0,s=this.vertices.length;o<s;o++)this.vertices[o].multiplyScalar(n);function b(e){var t=e.normalize().clone();t.index=i.vertices.push(t)-1;var n=E(e)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new q.Vector2(n,1-r),t}function x(e,t,n){var r=new q.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);i.faces.push(r),f.copy(e).add(t).add(n).divideScalar(3);var o=E(f);i.faceVertexUvs[0].push([A(e.uv,e,o),A(t.uv,t,o),A(n.uv,n,o)])}function w(e,t){for(var n=Math.pow(2,t),r=b(i.vertices[e.a]),o=b(i.vertices[e.b]),s=b(i.vertices[e.c]),a=[],l=0;l<=n;l++){a[l]=[];for(var c=b(r.clone().lerp(s,l/n)),u=b(o.clone().lerp(s,l/n)),d=n-l,h=0;h<=d;h++)a[l][h]=0==h&&l==n?c:b(c.clone().lerp(u,h/d))}for(l=0;l<n;l++)for(h=0;h<2*(n-l)-1;h++){var f=Math.floor(h/2);h%2==0?x(a[l][f+1],a[l+1][f],a[l][f]):x(a[l][f+1],a[l+1][f+1],a[l+1][f])}}function E(e){return Math.atan2(e.z,-e.x)}function A(e,t,n){return n<0&&1===e.x&&(e=new q.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new q.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new q.Sphere(new q.Vector3,n)},q.PolyhedronGeometry.prototype=Object.create(q.Geometry.prototype),q.PolyhedronGeometry.prototype.constructor=q.PolyhedronGeometry,q.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];q.PolyhedronGeometry.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)},q.DodecahedronGeometry.prototype=Object.create(q.Geometry.prototype),q.DodecahedronGeometry.prototype.constructor=q.DodecahedronGeometry,q.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];q.PolyhedronGeometry.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},q.IcosahedronGeometry.prototype=Object.create(q.Geometry.prototype),q.IcosahedronGeometry.prototype.constructor=q.IcosahedronGeometry,q.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};q.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},q.OctahedronGeometry.prototype=Object.create(q.Geometry.prototype),q.OctahedronGeometry.prototype.constructor=q.OctahedronGeometry,q.TetrahedronGeometry=function(e,t){q.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},q.TetrahedronGeometry.prototype=Object.create(q.Geometry.prototype),q.TetrahedronGeometry.prototype.constructor=q.TetrahedronGeometry,q.ParametricGeometry=function(e,t,n){q.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var r,i,o,s,a,l,c,u,d,h,f,p,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=t+1;for(r=0;r<=n;r++)for(s=r/n,i=0;i<=t;i++)o=e(i/t,s),m.push(o);for(r=0;r<n;r++)for(i=0;i<t;i++)a=r*y+i,l=r*y+i+1,c=(r+1)*y+i+1,u=(r+1)*y+i,d=new q.Vector2(i/t,r/n),h=new q.Vector2((i+1)/t,r/n),f=new q.Vector2((i+1)/t,(r+1)/n),p=new q.Vector2(i/t,(r+1)/n),g.push(new q.Face3(a,l,u)),v.push([d,h,p]),g.push(new q.Face3(l,c,u)),v.push([h.clone(),f,p.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},q.ParametricGeometry.prototype=Object.create(q.Geometry.prototype),q.ParametricGeometry.prototype.constructor=q.ParametricGeometry,q.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new q.BufferGeometry;r.addAttribute("position",new q.BufferAttribute(t,3)),r.addAttribute("color",new q.BufferAttribute(n,3));var i=new q.LineBasicMaterial({vertexColors:q.VertexColors});q.Line.call(this,r,i,q.LinePieces)},q.AxisHelper.prototype=Object.create(q.Line.prototype),q.AxisHelper.prototype.constructor=q.AxisHelper,q.ArrowHelper=function(){var e=new q.Geometry;e.vertices.push(new q.Vector3(0,0,0),new q.Vector3(0,1,0));var t=new q.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new q.Matrix4).makeTranslation(0,-.5,0)),function(n,r,i,o,s,a){q.Object3D.call(this),void 0===o&&(o=16776960),void 0===i&&(i=1),void 0===s&&(s=.2*i),void 0===a&&(a=.2*s),this.position.copy(r),this.line=new q.Line(e,new q.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new q.Mesh(t,new q.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(i,s,a)}}(),q.ArrowHelper.prototype=Object.create(q.Object3D.prototype),q.ArrowHelper.prototype.constructor=q.ArrowHelper,q.ArrowHelper.prototype.setDirection=(X=new q.Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(X.set(e.z,0,-e.x).normalize(),W=Math.acos(e.y),this.quaternion.setFromAxisAngle(X,W))}),q.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},q.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},q.BoxHelper=function(e){var t=new q.BufferGeometry;t.addAttribute("position",new q.BufferAttribute(new Float32Array(72),3)),q.Line.call(this,t,new q.LineBasicMaterial({color:16776960}),q.LinePieces),void 0!==e&&this.update(e)},q.BoxHelper.prototype=Object.create(q.Line.prototype),q.BoxHelper.prototype.constructor=q.BoxHelper,q.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,r=t.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=n.x,i[4]=r.y,i[5]=r.z,i[6]=n.x,i[7]=r.y,i[8]=r.z,i[9]=n.x,i[10]=n.y,i[11]=r.z,i[12]=n.x,i[13]=n.y,i[14]=r.z,i[15]=r.x,i[16]=n.y,i[17]=r.z,i[18]=r.x,i[19]=n.y,i[20]=r.z,i[21]=r.x,i[22]=r.y,i[23]=r.z,i[24]=r.x,i[25]=r.y,i[26]=n.z,i[27]=n.x,i[28]=r.y,i[29]=n.z,i[30]=n.x,i[31]=r.y,i[32]=n.z,i[33]=n.x,i[34]=n.y,i[35]=n.z,i[36]=n.x,i[37]=n.y,i[38]=n.z,i[39]=r.x,i[40]=n.y,i[41]=n.z,i[42]=r.x,i[43]=n.y,i[44]=n.z,i[45]=r.x,i[46]=r.y,i[47]=n.z,i[48]=r.x,i[49]=r.y,i[50]=r.z,i[51]=r.x,i[52]=r.y,i[53]=n.z,i[54]=n.x,i[55]=r.y,i[56]=r.z,i[57]=n.x,i[58]=r.y,i[59]=n.z,i[60]=n.x,i[61]=n.y,i[62]=r.z,i[63]=n.x,i[64]=n.y,i[65]=n.z,i[66]=r.x,i[67]=n.y,i[68]=r.z,i[69]=r.x,i[70]=n.y,i[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},q.BoundingBoxHelper=function(e,t){var n=void 0!==t?t:8947848;this.object=e,this.box=new q.Box3,q.Mesh.call(this,new q.BoxGeometry(1,1,1),new q.MeshBasicMaterial({color:n,wireframe:!0}))},q.BoundingBoxHelper.prototype=Object.create(q.Mesh.prototype),q.BoundingBoxHelper.prototype.constructor=q.BoundingBoxHelper,q.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},q.CameraHelper=function(e){var t=new q.Geometry,n=new q.LineBasicMaterial({color:16777215,vertexColors:q.FaceColors}),r={};function i(e,t,n){o(e,n),o(t,n)}function o(e,n){t.vertices.push(new q.Vector3),t.colors.push(new q.Color(n)),void 0===r[e]&&(r[e]=[]),r[e].push(t.vertices.length-1)}i("n1","n2",16755200),i("n2","n4",16755200),i("n4","n3",16755200),i("n3","n1",16755200),i("f1","f2",16755200),i("f2","f4",16755200),i("f4","f3",16755200),i("f3","f1",16755200),i("n1","f1",16755200),i("n2","f2",16755200),i("n3","f3",16755200),i("n4","f4",16755200),i("p","n1",16711680),i("p","n2",16711680),i("p","n3",16711680),i("p","n4",16711680),i("u1","u2",43775),i("u2","u3",43775),i("u3","u1",43775),i("c","t",16777215),i("p","c",3355443),i("cn1","cn2",3355443),i("cn3","cn4",3355443),i("cf1","cf2",3355443),i("cf3","cf4",3355443),q.Line.call(this,t,n,q.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()},q.CameraHelper.prototype=Object.create(q.Line.prototype),q.CameraHelper.prototype.constructor=q.CameraHelper,q.CameraHelper.prototype.update=function(){var e,t,n=new q.Vector3,r=new q.Camera,i=function(i,o,s,a){n.set(o,s,a).unproject(r);var l=t[i];if(void 0!==l)for(var c=0,u=l.length;c<u;c++)e.vertices[l[c]].copy(n)};return function(){e=this.geometry,t=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),e.verticesNeedUpdate=!0}}(),q.DirectionalLightHelper=function(e,t){q.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new q.Geometry;n.vertices.push(new q.Vector3(-t,t,0),new q.Vector3(t,t,0),new q.Vector3(t,-t,0),new q.Vector3(-t,-t,0),new q.Vector3(-t,t,0));var r=new q.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new q.Line(n,r),this.add(this.lightPlane),(n=new q.Geometry).vertices.push(new q.Vector3,new q.Vector3),(r=new q.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new q.Line(n,r),this.add(this.targetLine),this.update()},q.DirectionalLightHelper.prototype=Object.create(q.Object3D.prototype),q.DirectionalLightHelper.prototype.constructor=q.DirectionalLightHelper,q.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},q.DirectionalLightHelper.prototype.update=function(){var e=new q.Vector3,t=new q.Vector3,n=new q.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),q.EdgesHelper=function(e,t,n){var r=void 0!==t?t:16777215;n=void 0!==n?n:1;var i,o=Math.cos(q.Math.degToRad(n)),s=[0,0],a={},l=function(e,t){return e-t},c=["a","b","c"],u=new q.BufferGeometry;e.geometry instanceof q.BufferGeometry?(i=new q.Geometry).fromBufferGeometry(e.geometry):i=e.geometry.clone(),i.mergeVertices(),i.computeFaceNormals();for(var d=i.vertices,h=i.faces,f=0,p=0,m=h.length;p<m;p++)for(var g=h[p],v=0;v<3;v++){s[0]=g[c[v]],s[1]=g[c[(v+1)%3]],s.sort(l),void 0===a[b=s.toString()]?(a[b]={vert1:s[0],vert2:s[1],face1:p,face2:void 0},f++):a[b].face2=p}var y=new Float32Array(2*f*3),_=0;for(var b in a){var x=a[b];if(void 0===x.face2||h[x.face1].normal.dot(h[x.face2].normal)<=o){var w=d[x.vert1];y[_++]=w.x,y[_++]=w.y,y[_++]=w.z,w=d[x.vert2],y[_++]=w.x,y[_++]=w.y,y[_++]=w.z}}u.addAttribute("position",new q.BufferAttribute(y,3)),q.Line.call(this,u,new q.LineBasicMaterial({color:r}),q.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},q.EdgesHelper.prototype=Object.create(q.Line.prototype),q.EdgesHelper.prototype.constructor=q.EdgesHelper,q.FaceNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==n?n:16776960,o=void 0!==r?r:1,s=new q.Geometry,a=0,l=this.object.geometry.faces.length;a<l;a++)s.vertices.push(new q.Vector3,new q.Vector3);q.Line.call(this,s,new q.LineBasicMaterial({color:i,linewidth:o}),q.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new q.Matrix3,this.update()},q.FaceNormalsHelper.prototype=Object.create(q.Line.prototype),q.FaceNormalsHelper.prototype.constructor=q.FaceNormalsHelper,q.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,r=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var o=0,s=0,a=r.length;o<a;o++,s+=2){var l=r[o];e[s].copy(n[l.a]).add(n[l.b]).add(n[l.c]).divideScalar(3).applyMatrix4(i),e[s+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[s])}return this.geometry.verticesNeedUpdate=!0,this},q.GridHelper=function(e,t){var n=new q.Geometry,r=new q.LineBasicMaterial({vertexColors:q.VertexColors});this.color1=new q.Color(4473924),this.color2=new q.Color(8947848);for(var i=-e;i<=e;i+=t){n.vertices.push(new q.Vector3(-e,0,i),new q.Vector3(e,0,i),new q.Vector3(i,0,-e),new q.Vector3(i,0,e));var o=0===i?this.color1:this.color2;n.colors.push(o,o,o,o)}q.Line.call(this,n,r,q.LinePieces)},q.GridHelper.prototype=Object.create(q.Line.prototype),q.GridHelper.prototype.constructor=q.GridHelper,q.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},q.HemisphereLightHelper=function(e,t){q.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new q.Color,new q.Color];var n=new q.SphereGeometry(t,4,2);n.applyMatrix((new q.Matrix4).makeRotationX(-Math.PI/2));for(var r=0;r<8;r++)n.faces[r].color=this.colors[r<4?0:1];var i=new q.MeshBasicMaterial({vertexColors:q.FaceColors,wireframe:!0});this.lightSphere=new q.Mesh(n,i),this.add(this.lightSphere),this.update()},q.HemisphereLightHelper.prototype=Object.create(q.Object3D.prototype),q.HemisphereLightHelper.prototype.constructor=q.HemisphereLightHelper,q.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},q.HemisphereLightHelper.prototype.update=function(){var e=new q.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),q.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new q.SphereGeometry(t,4,2),r=new q.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),q.Mesh.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},q.PointLightHelper.prototype=Object.create(q.Mesh.prototype),q.PointLightHelper.prototype.constructor=q.PointLightHelper,q.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},q.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},q.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new q.Geometry,n=0;n<this.bones.length;n++){this.bones[n].parent instanceof q.Bone&&(t.vertices.push(new q.Vector3),t.vertices.push(new q.Vector3),t.colors.push(new q.Color(0,0,1)),t.colors.push(new q.Color(0,1,0)))}var r=new q.LineBasicMaterial({vertexColors:q.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});q.Line.call(this,t,r,q.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},q.SkeletonHelper.prototype=Object.create(q.Line.prototype),q.SkeletonHelper.prototype.constructor=q.SkeletonHelper,q.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof q.Bone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,this.getBoneList(e.children[n]));return t},q.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new q.Matrix4).getInverse(this.root.matrixWorld),n=new q.Matrix4,r=0,i=0;i<this.bones.length;i++){var o=this.bones[i];o.parent instanceof q.Bone&&(n.multiplyMatrices(t,o.matrixWorld),e.vertices[r].setFromMatrixPosition(n),n.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[r+1].setFromMatrixPosition(n),r+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},q.SpotLightHelper=function(e){q.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new q.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new q.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new q.Matrix4).makeRotationX(-Math.PI/2));var n=new q.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new q.Mesh(t,n),this.add(this.cone),this.update()},q.SpotLightHelper.prototype=Object.create(q.Object3D.prototype),q.SpotLightHelper.prototype.constructor=q.SpotLightHelper,q.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},q.SpotLightHelper.prototype.update=function(){var e=new q.Vector3,t=new q.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),q.VertexNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==n?n:16711680,o=void 0!==r?r:1,s=new q.Geometry,a=e.geometry.faces,l=0,c=a.length;l<c;l++)for(var u=0,d=a[l].vertexNormals.length;u<d;u++)s.vertices.push(new q.Vector3,new q.Vector3);q.Line.call(this,s,new q.LineBasicMaterial({color:i,linewidth:o}),q.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new q.Matrix3,this.update()},q.VertexNormalsHelper.prototype=Object.create(q.Line.prototype),q.VertexNormalsHelper.prototype.constructor=q.VertexNormalsHelper,q.VertexNormalsHelper.prototype.update=function(e){var t=new q.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,i=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,c=o.length;l<c;l++)for(var u=o[l],d=0,h=u.vertexNormals.length;d<h;d++){var f=i[u[n[d]]],p=u.vertexNormals[d];r[a].copy(f).applyMatrix4(s),t.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(r[a]),r[a+=1].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),q.VertexTangentsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==n?n:255,o=void 0!==r?r:1,s=new q.Geometry,a=e.geometry.faces,l=0,c=a.length;l<c;l++)for(var u=0,d=a[l].vertexTangents.length;u<d;u++)s.vertices.push(new q.Vector3),s.vertices.push(new q.Vector3);q.Line.call(this,s,new q.LineBasicMaterial({color:i,linewidth:o}),q.LinePieces),this.matrixAutoUpdate=!1,this.update()},q.VertexTangentsHelper.prototype=Object.create(q.Line.prototype),q.VertexTangentsHelper.prototype.constructor=q.VertexTangentsHelper,q.VertexTangentsHelper.prototype.update=function(e){var t=new q.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,i=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,c=o.length;l<c;l++)for(var u=o[l],d=0,h=u.vertexTangents.length;d<h;d++){var f=i[u[n[d]]],p=u.vertexTangents[d];r[a].copy(f).applyMatrix4(s),t.copy(p).transformDirection(s).multiplyScalar(this.size),t.add(r[a]),r[a+=1].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),q.WireframeHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],i={},o=function(e,t){return e-t},s=["a","b","c"],a=new q.BufferGeometry;if(e.geometry instanceof q.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,u=0,d=new Uint32Array(6*c.length),h=0,f=c.length;h<f;h++)for(var p=c[h],m=0;m<3;m++){r[0]=p[s[m]],r[1]=p[s[(m+1)%3]],r.sort(o),void 0===i[S=r.toString()]&&(d[2*u]=r[0],d[2*u+1]=r[1],i[S]=!0,u++)}var g=new Float32Array(2*u*3);for(h=0,f=u;h<f;h++)for(m=0;m<2;m++){var v=l[d[2*h+m]];g[(A=6*h+3*m)+0]=v.x,g[A+1]=v.y,g[A+2]=v.z}a.addAttribute("position",new q.BufferAttribute(g,3))}else if(e.geometry instanceof q.BufferGeometry)if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;var y=e.geometry.attributes.index.array,_=e.geometry.drawcalls;u=0;0===_.length&&(_=[{count:y.length,index:0,start:0}]);d=new Uint32Array(2*y.length);for(var b=0,x=_.length;b<x;++b)for(var w=_[b].start,E=_[b].count,A=_[b].index,M=(h=w,w+E);h<M;h+=3)for(m=0;m<3;m++){var S;r[0]=A+y[h+m],r[1]=A+y[h+(m+1)%3],r.sort(o),void 0===i[S=r.toString()]&&(d[2*u]=r[0],d[2*u+1]=r[1],i[S]=!0,u++)}for(g=new Float32Array(2*u*3),h=0,f=u;h<f;h++)for(m=0;m<2;m++){A=6*h+3*m;var T=3*d[2*h+m];g[A+0]=l[T],g[A+1]=l[T+1],g[A+2]=l[T+2]}a.addAttribute("position",new q.BufferAttribute(g,3))}else{var C=(u=(l=e.geometry.attributes.position.array).length/3)/3;for(g=new Float32Array(2*u*3),h=0,f=C;h<f;h++)for(m=0;m<3;m++){var P=9*h+3*m;g[(A=18*h+6*m)+0]=l[P],g[A+1]=l[P+1],g[A+2]=l[P+2];T=9*h+(m+1)%3*3;g[A+3]=l[T],g[A+4]=l[T+1],g[A+5]=l[T+2]}a.addAttribute("position",new q.BufferAttribute(g,3))}q.Line.call(this,a,new q.LineBasicMaterial({color:n}),q.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},q.WireframeHelper.prototype=Object.create(q.Line.prototype),q.WireframeHelper.prototype.constructor=q.WireframeHelper,q.ImmediateRenderObject=function(){q.Object3D.call(this),this.render=function(e){}},q.ImmediateRenderObject.prototype=Object.create(q.Object3D.prototype),q.ImmediateRenderObject.prototype.constructor=q.ImmediateRenderObject,q.MorphBlendMesh=function(e,t){q.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,r=n-1,i=n/1;this.createAnimation("__default",0,r,i),this.setAnimationWeight("__default",1)},q.MorphBlendMesh.prototype=Object.create(q.Mesh.prototype),q.MorphBlendMesh.prototype.constructor=q.MorphBlendMesh,q.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){var i={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},q.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,n=/([a-z]+)_?(\d+)/,r={},i=this.geometry,o=0,s=i.morphTargets.length;o<s;o++){var a=i.morphTargets[o].name.match(n);if(a&&a.length>1)r[l=a[1]]||(r[l]={start:1/0,end:-1/0}),o<(c=r[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}for(var l in r){var c=r[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},q.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},q.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},q.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},q.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},q.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},q.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},q.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},q.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},q.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):q.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},q.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},q.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.startFrame+q.Math.clamp(Math.floor(r.time/i),0,r.length-1),s=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var a=r.time%i/i;r.directionBackwards&&(a=1-a),this.morphTargetInfluences[r.currentFrame]=a*s,this.morphTargetInfluences[r.lastFrame]=(1-a)*s}}}}).call(this,n(/*! ./../../node_modules/webpack/buildin/module.js */"./node_modules/webpack/buildin/module.js")(e))}});